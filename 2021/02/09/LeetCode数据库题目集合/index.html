<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>LeetCodeæ•°æ®åº“é¢˜ç›®é›†åˆ | MiChongçš„ğŸ¡</title><meta name="keywords" content="LeetCode,ç¬”è¯•é¢˜"><meta name="author" content="MiChong,qjzxzxd@gmail.com"><meta name="copyright" content="MiChong"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="LeetCodeæ•°æ®åº“é¢˜ç›®é›†åˆ--123é¢˜">
<meta property="og:type" content="article">
<meta property="og:title" content="LeetCodeæ•°æ®åº“é¢˜ç›®é›†åˆ">
<meta property="og:url" content="https://www.buildworld.cn/2021/02/09/LeetCode%E6%95%B0%E6%8D%AE%E5%BA%93%E9%A2%98%E7%9B%AE%E9%9B%86%E5%90%88/index.html">
<meta property="og:site_name" content="MiChongçš„ğŸ¡">
<meta property="og:description" content="LeetCodeæ•°æ®åº“é¢˜ç›®é›†åˆ--123é¢˜">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://file.buildworld.cn/img/20210209161641.png">
<meta property="article:published_time" content="2021-02-09T08:13:56.000Z">
<meta property="article:modified_time" content="2021-04-09T02:11:41.451Z">
<meta property="article:author" content="MiChong">
<meta property="article:tag" content="LeetCode">
<meta property="article:tag" content="ç¬”è¯•é¢˜">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://file.buildworld.cn/img/20210209161641.png"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://www.buildworld.cn/2021/02/09/LeetCode%E6%95%B0%E6%8D%AE%E5%BA%93%E9%A2%98%E7%9B%AE%E9%9B%86%E5%90%88/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'LeetCodeæ•°æ®åº“é¢˜ç›®é›†åˆ',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-04-09 10:11:41'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="MiChongçš„ğŸ¡" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">åŠ è½½ä¸­...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/header.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">78</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">74</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">21</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/talk/"><i class="fa-fw fas fa-comment"></i><span> è¯´è¯´</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> å¨±ä¹</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> æ­Œå•</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book"></i><span> ä¹¦å•</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-film"></i><span> å½±å•</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fas fa-images"></i><span> å›¾é›†</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/tools/"><i class="fa-fw fa fa-rocket"></i><span> å·¥å…·</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> å…³äºæˆ‘</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-comment-dots"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://file.buildworld.cn/img/20210209161943.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">MiChongçš„ğŸ¡</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/talk/"><i class="fa-fw fas fa-comment"></i><span> è¯´è¯´</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> å¨±ä¹</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> æ­Œå•</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book"></i><span> ä¹¦å•</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-film"></i><span> å½±å•</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fas fa-images"></i><span> å›¾é›†</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/tools/"><i class="fa-fw fa fa-rocket"></i><span> å·¥å…·</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> å…³äºæˆ‘</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-comment-dots"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">LeetCodeæ•°æ®åº“é¢˜ç›®é›†åˆ</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2021-02-09T08:13:56.000Z" title="å‘è¡¨äº 2021-02-09 16:13:56">2021-02-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2021-04-09T02:11:41.451Z" title="æ›´æ–°äº 2021-04-09 10:11:41">2021-04-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/SQL/">SQL</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="LeetCodeæ•°æ®åº“é¢˜ç›®é›†åˆ"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problemset/database/">https://leetcode-cn.com/problemset/database/</a></p>
<p>é¢˜ç›®éƒ½æ˜¯leetcode ä¸Šäº†å¯ä»¥ç‚¹å‡»é¢˜ç›®ä¼šæœ‰ç›¸åº”çš„é“¾æ¥</p>
<p>ç”±äºä¸ªäººæ¯”è¾ƒå–œæ¬¢ç”¨å¼€çª—å‡½æ•°ï¼Œæ‰€ä»¥éƒ½ä¼˜å…ˆç”¨äº†å¼€çª— ï¼Œå½“ç„¶è¿™äº›å¹¶ä¸ä¸€å®šéƒ½æ˜¯æœ€ä¼˜è§£ï¼Œç­”æ¡ˆä»…ä¾›å‚è€ƒ</p>
<p>æ¯é“é¢˜åé¢éƒ½åº”ç›¸åº”çš„éš¾åº¦ç­‰çº§ï¼Œå¦‚æœæ²¡æ—¶é—´åšçš„è¯ å¯ä»¥åœ¨leetcode æŒ‰å‡ºé¢˜é¢‘ç‡åˆ·é¢˜</p>
<p>æˆ‘æ˜¯å®‰é¡ºåºåˆ·çš„é¢˜ï¼Œåç»­è¿˜ä¼šç»§ç»­æ›´æ–°</p>
<p>ç¥å¤§å®¶é¢è¯•å–å¾—å¥½çš„æˆç»©</p>
</blockquote>
<h4 id="175-ç»„åˆä¸¤ä¸ªè¡¨"><a href="#175-ç»„åˆä¸¤ä¸ªè¡¨" class="headerlink" title="175. ç»„åˆä¸¤ä¸ªè¡¨"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/combine-two-tables/">175. ç»„åˆä¸¤ä¸ªè¡¨</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>è¡¨1: <code>Person</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| åˆ—å         | ç±»å‹     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| PersonId    | int     |</span><br><span class="line">| FirstName   | varchar |</span><br><span class="line">| LastName    | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">PersonId æ˜¯ä¸Šè¡¨ä¸»é”®</span><br></pre></td></tr></table></figure>

<p>è¡¨2: <code>Address</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| åˆ—å         | ç±»å‹    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| AddressId   | int     |</span><br><span class="line">| PersonId    | int     |</span><br><span class="line">| City        | varchar |</span><br><span class="line">| State       | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">AddressId æ˜¯ä¸Šè¡¨ä¸»é”®</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ»¡è¶³æ¡ä»¶ï¼šæ— è®º person æ˜¯å¦æœ‰åœ°å€ä¿¡æ¯ï¼Œéƒ½éœ€è¦åŸºäºä¸Šè¿°ä¸¤è¡¨æä¾› person çš„ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FirstName, LastName, City, State</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> FirstName,LastName,City,State</span><br><span class="line"><span class="keyword">from</span> Person  p</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span>  Address a </span><br><span class="line"><span class="keyword">on</span> a.PersonId <span class="operator">=</span> p.PersonId</span><br></pre></td></tr></table></figure>

<h4 id="176-ç¬¬äºŒé«˜çš„è–ªæ°´"><a href="#176-ç¬¬äºŒé«˜çš„è–ªæ°´" class="headerlink" title="176. ç¬¬äºŒé«˜çš„è–ªæ°´"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/second-highest-salary/">176. ç¬¬äºŒé«˜çš„è–ªæ°´</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œè·å– <code>Employee</code> è¡¨ä¸­ç¬¬äºŒé«˜çš„è–ªæ°´ï¼ˆSalaryï¼‰ ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+----+--------+</span><br><span class="line">| Id | Salary |</span><br><span class="line">+----+--------+</span><br><span class="line">| 1  | 100    |</span><br><span class="line">| 2  | 200    |</span><br><span class="line">| 3  | 300    |</span><br><span class="line">+----+--------+</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ä¸Šè¿° <code>Employee</code> è¡¨ï¼ŒSQLæŸ¥è¯¢åº”è¯¥è¿”å› <code>200</code> ä½œä¸ºç¬¬äºŒé«˜çš„è–ªæ°´ã€‚å¦‚æœä¸å­˜åœ¨ç¬¬äºŒé«˜çš„è–ªæ°´ï¼Œé‚£ä¹ˆæŸ¥è¯¢åº”è¿”å› <code>null</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+---------------------+</span><br><span class="line">| SecondHighestSalary |</span><br><span class="line">+---------------------+</span><br><span class="line">| 200                 |</span><br><span class="line">+---------------------+</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    IFNULL(</span><br><span class="line">      (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> Salary</span><br><span class="line">       <span class="keyword">FROM</span> Employee</span><br><span class="line">       <span class="keyword">ORDER</span> <span class="keyword">BY</span> Salary <span class="keyword">DESC</span></span><br><span class="line">        LIMIT <span class="number">1</span> <span class="keyword">OFFSET</span> <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">NULL</span>) <span class="keyword">AS</span> SecondHighestSalary</span><br></pre></td></tr></table></figure>

<h4 id="177-ç¬¬Né«˜çš„è–ªæ°´"><a href="#177-ç¬¬Né«˜çš„è–ªæ°´" class="headerlink" title="177. ç¬¬Né«˜çš„è–ªæ°´"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/nth-highest-salary/">177. ç¬¬Né«˜çš„è–ªæ°´</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œè·å– <code>Employee</code> è¡¨ä¸­ç¬¬ <em>n</em> é«˜çš„è–ªæ°´ï¼ˆSalaryï¼‰ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+----+--------+</span><br><span class="line">| Id | Salary |</span><br><span class="line">+----+--------+</span><br><span class="line">| 1  | 100    |</span><br><span class="line">| 2  | 200    |</span><br><span class="line">| 3  | 300    |</span><br><span class="line">+----+--------+</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ä¸Šè¿° <code>Employee</code> è¡¨ï¼Œ<em>n = 2</em> æ—¶ï¼Œåº”è¿”å›ç¬¬äºŒé«˜çš„è–ªæ°´ <code>200</code>ã€‚å¦‚æœä¸å­˜åœ¨ç¬¬ <em>n</em> é«˜çš„è–ªæ°´ï¼Œé‚£ä¹ˆæŸ¥è¯¢åº”è¿”å› <code>null</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+------------------------+</span><br><span class="line">| getNthHighestSalary(2) |</span><br><span class="line">+------------------------+</span><br><span class="line">| 200                    |</span><br><span class="line">+------------------------+</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> getNthHighestSalary(N <span class="type">INT</span>) <span class="keyword">RETURNS</span> <span class="type">INT</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">SET</span> N <span class="operator">=</span> N<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">RETURN</span> (</span><br><span class="line">        <span class="keyword">select</span> ifnull((</span><br><span class="line">                          <span class="keyword">select</span> <span class="keyword">distinct</span> Salary</span><br><span class="line">                          <span class="keyword">from</span> Employee <span class="keyword">order</span> <span class="keyword">by</span> Salary <span class="keyword">desc</span> limit N,<span class="number">1</span>),</span><br><span class="line">                      <span class="keyword">NULL</span>)</span><br><span class="line">    );</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<h4 id="178-åˆ†æ•°æ’å"><a href="#178-åˆ†æ•°æ’å" class="headerlink" title="178. åˆ†æ•°æ’å"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/rank-scores/">178. åˆ†æ•°æ’å</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢æ¥å®ç°åˆ†æ•°æ’åã€‚</p>
<p>å¦‚æœä¸¤ä¸ªåˆ†æ•°ç›¸åŒï¼Œåˆ™ä¸¤ä¸ªåˆ†æ•°æ’åï¼ˆRankï¼‰ç›¸åŒã€‚è¯·æ³¨æ„ï¼Œå¹³åˆ†åçš„ä¸‹ä¸€ä¸ªåæ¬¡åº”è¯¥æ˜¯ä¸‹ä¸€ä¸ªè¿ç»­çš„æ•´æ•°å€¼ã€‚æ¢å¥è¯è¯´ï¼Œåæ¬¡ä¹‹é—´ä¸åº”è¯¥æœ‰â€œé—´éš”â€ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+----+-------+</span><br><span class="line">| Id | Score |</span><br><span class="line">+----+-------+</span><br><span class="line">| 1  | 3.50  |</span><br><span class="line">| 2  | 3.65  |</span><br><span class="line">| 3  | 4.00  |</span><br><span class="line">| 4  | 3.85  |</span><br><span class="line">| 5  | 4.00  |</span><br><span class="line">| 6  | 3.65  |</span><br><span class="line">+----+-------+</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼Œæ ¹æ®ä¸Šè¿°ç»™å®šçš„ <code>Scores</code> è¡¨ï¼Œä½ çš„æŸ¥è¯¢åº”è¯¥è¿”å›ï¼ˆæŒ‰åˆ†æ•°ä»é«˜åˆ°ä½æ’åˆ—ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+-------+------+</span><br><span class="line">| Score | Rank |</span><br><span class="line">+-------+------+</span><br><span class="line">| 4.00  | 1    |</span><br><span class="line">| 4.00  | 1    |</span><br><span class="line">| 3.85  | 2    |</span><br><span class="line">| 3.65  | 3    |</span><br><span class="line">| 3.65  | 3    |</span><br><span class="line">| 3.50  | 4    |</span><br><span class="line">+-------+------+</span><br></pre></td></tr></table></figure>

<p><strong>é‡è¦æç¤ºï¼š</strong>å¯¹äº MySQL è§£å†³æ–¹æ¡ˆï¼Œå¦‚æœè¦è½¬ä¹‰ç”¨ä½œåˆ—åçš„ä¿ç•™å­—ï¼Œå¯ä»¥åœ¨å…³é”®å­—ä¹‹å‰å’Œä¹‹åä½¿ç”¨æ’‡å·ã€‚ä¾‹å¦‚ <strong><code>Rank</code></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> Score,</span><br><span class="line"><span class="built_in">dense_rank</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> Score <span class="keyword">desc</span>) `rank`</span><br><span class="line"><span class="keyword">from</span> Scores</span><br></pre></td></tr></table></figure>



<h4 id="180-è¿ç»­å‡ºç°çš„æ•°å­—"><a href="#180-è¿ç»­å‡ºç°çš„æ•°å­—" class="headerlink" title="180. è¿ç»­å‡ºç°çš„æ•°å­—"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/consecutive-numbers/">180. è¿ç»­å‡ºç°çš„æ•°å­—</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒæŸ¥æ‰¾æ‰€æœ‰è‡³å°‘è¿ç»­å‡ºç°ä¸‰æ¬¡çš„æ•°å­—ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+----+-----+</span><br><span class="line">| Id | Num |</span><br><span class="line">+----+-----+</span><br><span class="line">| 1  |  1  |</span><br><span class="line">| 2  |  1  |</span><br><span class="line">| 3  |  1  |</span><br><span class="line">| 4  |  2  |</span><br><span class="line">| 5  |  1  |</span><br><span class="line">| 6  |  2  |</span><br><span class="line">| 7  |  2  |</span><br><span class="line">+----+-----+</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼Œç»™å®šä¸Šé¢çš„ <code>Logs</code> è¡¨ï¼Œ <code>1</code> æ˜¯å”¯ä¸€è¿ç»­å‡ºç°è‡³å°‘ä¸‰æ¬¡çš„æ•°å­—ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">-----------------+</span></span><br><span class="line"><span class="operator">|</span> ConsecutiveNums <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>               <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+</span></span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> Num ConsecutiveNums</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">Num,</span><br><span class="line"><span class="built_in">lead</span>(Num,<span class="number">1</span>,<span class="keyword">null</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> id) n2,</span><br><span class="line"><span class="built_in">lead</span>(Num,<span class="number">2</span>,<span class="keyword">null</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> id) n3</span><br><span class="line"><span class="keyword">from</span> Logs</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> Num <span class="operator">=</span> n2 <span class="keyword">and</span> Num <span class="operator">=</span> n3</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> l1.num <span class="keyword">as</span> ConsecutiveNums</span><br><span class="line"><span class="keyword">from</span> logs l1</span><br><span class="line">         <span class="keyword">join</span> logs l2 <span class="keyword">on</span> l1.num <span class="operator">=</span> l2.num</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> l1.Id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">sum</span>(l1.Id <span class="operator">-</span> l2.Id <span class="keyword">between</span> <span class="number">0</span> <span class="keyword">and</span> <span class="number">2</span>) <span class="operator">&gt;</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h4 id="181-è¶…è¿‡ç»ç†æ”¶å…¥çš„å‘˜å·¥"><a href="#181-è¶…è¿‡ç»ç†æ”¶å…¥çš„å‘˜å·¥" class="headerlink" title="181. è¶…è¿‡ç»ç†æ”¶å…¥çš„å‘˜å·¥"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/employees-earning-more-than-their-managers/">181. è¶…è¿‡ç»ç†æ”¶å…¥çš„å‘˜å·¥</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p><code>Employee</code> è¡¨åŒ…å«æ‰€æœ‰å‘˜å·¥ï¼Œä»–ä»¬çš„ç»ç†ä¹Ÿå±äºå‘˜å·¥ã€‚æ¯ä¸ªå‘˜å·¥éƒ½æœ‰ä¸€ä¸ª Idï¼Œæ­¤å¤–è¿˜æœ‰ä¸€åˆ—å¯¹åº”å‘˜å·¥çš„ç»ç†çš„ Idã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----+-------+--------+-----------+</span><br><span class="line">| Id | Name  | Salary | ManagerId |</span><br><span class="line">+----+-------+--------+-----------+</span><br><span class="line">| 1  | Joe   | 70000  | 3         |</span><br><span class="line">| 2  | Henry | 80000  | 4         |</span><br><span class="line">| 3  | Sam   | 60000  | NULL      |</span><br><span class="line">| 4  | Max   | 90000  | NULL      |</span><br><span class="line">+----+-------+--------+-----------+</span><br></pre></td></tr></table></figure>

<p>ç»™å®š <code>Employee</code> è¡¨ï¼Œç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œè¯¥æŸ¥è¯¢å¯ä»¥è·å–æ”¶å…¥è¶…è¿‡ä»–ä»¬ç»ç†çš„å‘˜å·¥çš„å§“åã€‚åœ¨ä¸Šé¢çš„è¡¨æ ¼ä¸­ï¼ŒJoe æ˜¯å”¯ä¸€ä¸€ä¸ªæ”¶å…¥è¶…è¿‡ä»–çš„ç»ç†çš„å‘˜å·¥ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">----------+</span></span><br><span class="line"><span class="operator">|</span> Employee <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+</span></span><br><span class="line"><span class="operator">|</span> Joe      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+</span></span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.Name  Employee </span><br><span class="line"><span class="keyword">from</span> Employee a </span><br><span class="line"><span class="keyword">join</span> Employee b</span><br><span class="line"><span class="keyword">on</span> a.ManagerId <span class="operator">=</span> b.id</span><br><span class="line"><span class="keyword">where</span> a.Salary<span class="operator">&gt;</span>b.Salary</span><br></pre></td></tr></table></figure>



<h4 id="182-æŸ¥æ‰¾é‡å¤çš„ç”µå­é‚®ç®±"><a href="#182-æŸ¥æ‰¾é‡å¤çš„ç”µå­é‚®ç®±" class="headerlink" title="182. æŸ¥æ‰¾é‡å¤çš„ç”µå­é‚®ç®±"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/duplicate-emails/">182. æŸ¥æ‰¾é‡å¤çš„ç”µå­é‚®ç®±</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒæŸ¥æ‰¾ <code>Person</code> è¡¨ä¸­æ‰€æœ‰é‡å¤çš„ç”µå­é‚®ç®±ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+----+---------+</span><br><span class="line">| Id | Email   |</span><br><span class="line">+----+---------+</span><br><span class="line">| 1  | a@b.com |</span><br><span class="line">| 2  | c@d.com |</span><br><span class="line">| 3  | a@b.com |</span><br><span class="line">+----+---------+</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®ä»¥ä¸Šè¾“å…¥ï¼Œä½ çš„æŸ¥è¯¢åº”è¿”å›ä»¥ä¸‹ç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+---------+</span><br><span class="line">| Email   |</span><br><span class="line">+---------+</span><br><span class="line">| a@b.com |</span><br><span class="line">+---------+</span><br></pre></td></tr></table></figure>

<p><strong>è¯´æ˜ï¼š</strong>æ‰€æœ‰ç”µå­é‚®ç®±éƒ½æ˜¯å°å†™å­—æ¯ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> Email</span><br><span class="line"><span class="keyword">from</span> Person</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> Email</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">&gt;</span><span class="number">1</span></span><br></pre></td></tr></table></figure>



<h4 id="183-ä»ä¸è®¢è´­çš„å®¢æˆ·"><a href="#183-ä»ä¸è®¢è´­çš„å®¢æˆ·" class="headerlink" title="183. ä»ä¸è®¢è´­çš„å®¢æˆ·"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/customers-who-never-order/">183. ä»ä¸è®¢è´­çš„å®¢æˆ·</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>æŸç½‘ç«™åŒ…å«ä¸¤ä¸ªè¡¨ï¼Œ<code>Customers</code> è¡¨å’Œ <code>Orders</code> è¡¨ã€‚ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ‰¾å‡ºæ‰€æœ‰ä»ä¸è®¢è´­ä»»ä½•ä¸œè¥¿çš„å®¢æˆ·ã€‚</p>
<p><code>Customers</code> è¡¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----+-------+</span><br><span class="line">| Id | Name  |</span><br><span class="line">+----+-------+</span><br><span class="line">| 1  | Joe   |</span><br><span class="line">| 2  | Henry |</span><br><span class="line">| 3  | Sam   |</span><br><span class="line">| 4  | Max   |</span><br><span class="line">+----+-------+</span><br></pre></td></tr></table></figure>

<p><code>Orders</code> è¡¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+----+------------+</span><br><span class="line">| Id | CustomerId |</span><br><span class="line">+----+------------+</span><br><span class="line">| 1  | 3          |</span><br><span class="line">| 2  | 1          |</span><br><span class="line">+----+------------+</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ç»™å®šä¸Šè¿°è¡¨æ ¼ï¼Œä½ çš„æŸ¥è¯¢åº”è¿”å›ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">-----------+</span></span><br><span class="line"><span class="operator">|</span> Customers <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+</span></span><br><span class="line"><span class="operator">|</span> Henry     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Max       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  c.Name Customers</span><br><span class="line"><span class="keyword">from</span> Customers  c <span class="keyword">left</span> <span class="keyword">join</span> Orders  o</span><br><span class="line"><span class="keyword">on</span> c.id <span class="operator">=</span> o.CustomerId</span><br><span class="line"><span class="keyword">where</span> o.id <span class="keyword">is</span> <span class="keyword">null</span></span><br></pre></td></tr></table></figure>



<h4 id="184-éƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥"><a href="#184-éƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥" class="headerlink" title="184. éƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/department-highest-salary/">184. éƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p><code>Employee</code> è¡¨åŒ…å«æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ï¼Œæ¯ä¸ªå‘˜å·¥æœ‰å…¶å¯¹åº”çš„ Id, salary å’Œ department Idã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----+-------+--------+--------------+</span><br><span class="line">| Id | Name  | Salary | DepartmentId |</span><br><span class="line">+----+-------+--------+--------------+</span><br><span class="line">| 1  | Joe   | 70000  | 1            |</span><br><span class="line">| 2  | Henry | 80000  | 2            |</span><br><span class="line">| 3  | Sam   | 60000  | 2            |</span><br><span class="line">| 4  | Max   | 90000  | 1            |</span><br><span class="line">+----+-------+--------+--------------+</span><br></pre></td></tr></table></figure>

<p><code>Department</code> è¡¨åŒ…å«å…¬å¸æ‰€æœ‰éƒ¨é—¨çš„ä¿¡æ¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+----+----------+</span><br><span class="line">| Id | Name     |</span><br><span class="line">+----+----------+</span><br><span class="line">| 1  | IT       |</span><br><span class="line">| 2  | Sales    |</span><br><span class="line">+----+----------+</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ‰¾å‡ºæ¯ä¸ªéƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥ã€‚ä¾‹å¦‚ï¼Œæ ¹æ®ä¸Šè¿°ç»™å®šçš„è¡¨æ ¼ï¼ŒMax åœ¨ IT éƒ¨é—¨æœ‰æœ€é«˜å·¥èµ„ï¼ŒHenry åœ¨ Sales éƒ¨é—¨æœ‰æœ€é«˜å·¥èµ„ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">------------+----------+--------+</span></span><br><span class="line"><span class="operator">|</span> Department <span class="operator">|</span> Employee <span class="operator">|</span> Salary <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+----------+--------+</span></span><br><span class="line"><span class="operator">|</span> IT         <span class="operator">|</span> Max      <span class="operator">|</span> <span class="number">90000</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Sales      <span class="operator">|</span> Henry    <span class="operator">|</span> <span class="number">80000</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+----------+--------+</span></span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> Department,Employee,Salary</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span> d.Name  Department,e.Name Employee, e.Salary,</span><br><span class="line"><span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> d.id <span class="keyword">order</span> <span class="keyword">by</span> Salary <span class="keyword">desc</span>) rk</span><br><span class="line"><span class="keyword">from</span> Employee e <span class="keyword">join</span> Department d</span><br><span class="line"><span class="keyword">on</span> e.DepartmentId<span class="operator">=</span>d.id</span><br><span class="line">)tmp</span><br><span class="line"><span class="keyword">where</span> rk <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>



<h4 id="185-éƒ¨é—¨å·¥èµ„å‰ä¸‰é«˜çš„æ‰€æœ‰å‘˜å·¥"><a href="#185-éƒ¨é—¨å·¥èµ„å‰ä¸‰é«˜çš„æ‰€æœ‰å‘˜å·¥" class="headerlink" title="185. éƒ¨é—¨å·¥èµ„å‰ä¸‰é«˜çš„æ‰€æœ‰å‘˜å·¥"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/department-top-three-salaries/">185. éƒ¨é—¨å·¥èµ„å‰ä¸‰é«˜çš„æ‰€æœ‰å‘˜å·¥</a></h4><p>éš¾åº¦å›°éš¾</p>
<p>SQLæ¶æ„</p>
<p><code>Employee</code> è¡¨åŒ…å«æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ï¼Œæ¯ä¸ªå‘˜å·¥æœ‰å…¶å¯¹åº”çš„å·¥å· <code>Id</code>ï¼Œå§“å <code>Name</code>ï¼Œå·¥èµ„ <code>Salary</code> å’Œéƒ¨é—¨ç¼–å· <code>DepartmentId</code> ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+----+-------+--------+--------------+</span><br><span class="line">| Id | Name  | Salary | DepartmentId |</span><br><span class="line">+----+-------+--------+--------------+</span><br><span class="line">| 1  | Joe   | 85000  | 1            |</span><br><span class="line">| 2  | Henry | 80000  | 2            |</span><br><span class="line">| 3  | Sam   | 60000  | 2            |</span><br><span class="line">| 4  | Max   | 90000  | 1            |</span><br><span class="line">| 5  | Janet | 69000  | 1            |</span><br><span class="line">| 6  | Randy | 85000  | 1            |</span><br><span class="line">| 7  | Will  | 70000  | 1            |</span><br><span class="line">+----+-------+--------+--------------+</span><br></pre></td></tr></table></figure>

<p><code>Department</code> è¡¨åŒ…å«å…¬å¸æ‰€æœ‰éƒ¨é—¨çš„ä¿¡æ¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+----+----------+</span><br><span class="line">| Id | Name     |</span><br><span class="line">+----+----------+</span><br><span class="line">| 1  | IT       |</span><br><span class="line">| 2  | Sales    |</span><br><span class="line">+----+----------+</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ‰¾å‡ºæ¯ä¸ªéƒ¨é—¨è·å¾—å‰ä¸‰é«˜å·¥èµ„çš„æ‰€æœ‰å‘˜å·¥ã€‚ä¾‹å¦‚ï¼Œæ ¹æ®ä¸Šè¿°ç»™å®šçš„è¡¨ï¼ŒæŸ¥è¯¢ç»“æœåº”è¿”å›ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+------------+----------+--------+</span><br><span class="line">| Department | Employee | Salary |</span><br><span class="line">+------------+----------+--------+</span><br><span class="line">| IT         | Max      | 90000  |</span><br><span class="line">| IT         | Randy    | 85000  |</span><br><span class="line">| IT         | Joe      | 85000  |</span><br><span class="line">| IT         | Will     | 70000  |</span><br><span class="line">| Sales      | Henry    | 80000  |</span><br><span class="line">| Sales      | Sam      | 60000  |</span><br><span class="line">+------------+----------+--------+</span><br></pre></td></tr></table></figure>

<p><strong>è§£é‡Šï¼š</strong></p>
<p>IT éƒ¨é—¨ä¸­ï¼ŒMax è·å¾—äº†æœ€é«˜çš„å·¥èµ„ï¼ŒRandy å’Œ Joe éƒ½æ‹¿åˆ°äº†ç¬¬äºŒé«˜çš„å·¥èµ„ï¼ŒWill çš„å·¥èµ„æ’ç¬¬ä¸‰ã€‚é”€å”®éƒ¨é—¨ï¼ˆSalesï¼‰åªæœ‰ä¸¤åå‘˜å·¥ï¼ŒHenry çš„å·¥èµ„æœ€é«˜ï¼ŒSam çš„å·¥èµ„æ’ç¬¬äºŒã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> Department,Employee,Salary</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span> d.Name  Department,e.Name Employee, e.Salary,</span><br><span class="line"><span class="built_in">dense_rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> d.id <span class="keyword">order</span> <span class="keyword">by</span> Salary <span class="keyword">desc</span>) rk</span><br><span class="line"><span class="keyword">from</span> Employee e <span class="keyword">join</span> Department d</span><br><span class="line"><span class="keyword">on</span> e.DepartmentId<span class="operator">=</span>d.id</span><br><span class="line">)tmp</span><br><span class="line"><span class="keyword">where</span> rk <span class="operator">&lt;=</span><span class="number">3</span></span><br></pre></td></tr></table></figure>



<h4 id="196-åˆ é™¤é‡å¤çš„ç”µå­é‚®ç®±"><a href="#196-åˆ é™¤é‡å¤çš„ç”µå­é‚®ç®±" class="headerlink" title="196. åˆ é™¤é‡å¤çš„ç”µå­é‚®ç®±"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/delete-duplicate-emails/">196. åˆ é™¤é‡å¤çš„ç”µå­é‚®ç®±</a></h4><p>éš¾åº¦ç®€å•</p>
<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ¥åˆ é™¤ <code>Person</code> è¡¨ä¸­æ‰€æœ‰é‡å¤çš„ç”µå­é‚®ç®±ï¼Œé‡å¤çš„é‚®ç®±é‡Œåªä¿ç•™ <strong>Id</strong> <em>æœ€å°</em> çš„é‚£ä¸ªã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----+------------------+</span><br><span class="line">| Id | Email            |</span><br><span class="line">+----+------------------+</span><br><span class="line">| 1  | john@example.com |</span><br><span class="line">| 2  | bob@example.com  |</span><br><span class="line">| 3  | john@example.com |</span><br><span class="line">+----+------------------+</span><br><span class="line">Id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼Œåœ¨è¿è¡Œä½ çš„æŸ¥è¯¢è¯­å¥ä¹‹åï¼Œä¸Šé¢çš„ <code>Person</code> è¡¨åº”è¿”å›ä»¥ä¸‹å‡ è¡Œ:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+----+------------------+</span><br><span class="line">| Id | Email            |</span><br><span class="line">+----+------------------+</span><br><span class="line">| 1  | john@example.com |</span><br><span class="line">| 2  | bob@example.com  |</span><br><span class="line">+----+------------------+</span><br></pre></td></tr></table></figure>

<p><strong>æç¤ºï¼š</strong></p>
<ul>
<li><p>æ‰§è¡Œ SQL ä¹‹åï¼Œè¾“å‡ºæ˜¯æ•´ä¸ª <code>Person</code> è¡¨ã€‚</p>
</li>
<li><p>ä½¿ç”¨ <code>delete</code> è¯­å¥ã€‚</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> p1 <span class="keyword">FROM</span> Person p1,</span><br><span class="line">    Person p2</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    p1.Email <span class="operator">=</span> p2.Email <span class="keyword">AND</span> p1.Id <span class="operator">&gt;</span> p2.Id</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„æ˜¯åˆ é™¤ ï¼Œä¸æ˜¯æŸ¥è¯¢</p>
</blockquote>
<h4 id="197-ä¸Šå‡çš„æ¸©åº¦"><a href="#197-ä¸Šå‡çš„æ¸©åº¦" class="headerlink" title="197. ä¸Šå‡çš„æ¸©åº¦"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/rising-temperature/">197. ä¸Šå‡çš„æ¸©åº¦</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>ç»™å®šä¸€ä¸ª <code>Weather</code> è¡¨ï¼Œç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ¥æŸ¥æ‰¾ä¸ä¹‹å‰ï¼ˆæ˜¨å¤©çš„ï¼‰æ—¥æœŸç›¸æ¯”æ¸©åº¦æ›´é«˜çš„æ‰€æœ‰æ—¥æœŸçš„ Idã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------+------------------+------------------+</span><br><span class="line">| Id(INT) | RecordDate(DATE) | Temperature(INT) |</span><br><span class="line">+---------+------------------+------------------+</span><br><span class="line">|       1 |       2015-01-01 |               10 |</span><br><span class="line">|       2 |       2015-01-02 |               25 |</span><br><span class="line">|       3 |       2015-01-03 |               20 |</span><br><span class="line">|       4 |       2015-01-04 |               30 |</span><br><span class="line">+---------+------------------+------------------+</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼Œæ ¹æ®ä¸Šè¿°ç»™å®šçš„ <code>Weather</code> è¡¨æ ¼ï¼Œè¿”å›å¦‚ä¸‹ Id:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">----+</span></span><br><span class="line"><span class="operator">|</span> Id <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+</span></span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">Id</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> Id,RecordDate,Temperature,</span><br><span class="line"><span class="built_in">lag</span>(RecordDate,<span class="number">1</span>,<span class="number">9999</span><span class="number">-99</span><span class="number">-99</span>) <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> RecordDate) yd,</span><br><span class="line"><span class="built_in">lag</span>(Temperature,<span class="number">1</span>,<span class="number">999</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> RecordDate ) yt</span><br><span class="line"><span class="keyword">from</span> Weather </span><br><span class="line">)tmp</span><br><span class="line"><span class="keyword">where</span> Temperature <span class="operator">&gt;</span>yt</span><br><span class="line"><span class="keyword">and</span> datediff(RecordDate,yd)<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.Id <span class="keyword">from</span> Weather a ,Weather b </span><br><span class="line">    <span class="keyword">where</span> a.Temperature <span class="operator">&gt;</span> b.Temperature </span><br><span class="line">    <span class="keyword">and</span> datediff(a.RecordDate,b.RecordDate) <span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure>



<h4 id="262-è¡Œç¨‹å’Œç”¨æˆ·"><a href="#262-è¡Œç¨‹å’Œç”¨æˆ·" class="headerlink" title="262. è¡Œç¨‹å’Œç”¨æˆ·"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/trips-and-users/">262. è¡Œç¨‹å’Œç”¨æˆ·</a></h4><p>éš¾åº¦å›°éš¾</p>
<p>SQLæ¶æ„</p>
<p><code>Trips</code> è¡¨ä¸­å­˜æ‰€æœ‰å‡ºç§Ÿè½¦çš„è¡Œç¨‹ä¿¡æ¯ã€‚æ¯æ®µè¡Œç¨‹æœ‰å”¯ä¸€é”® Idï¼ŒClient_Id å’Œ Driver_Id æ˜¯ <code>Users</code> è¡¨ä¸­ Users_Id çš„å¤–é”®ã€‚Status æ˜¯æšä¸¾ç±»å‹ï¼Œæšä¸¾æˆå‘˜ä¸º (â€˜completedâ€™, â€˜cancelled_by_driverâ€™, â€˜cancelled_by_clientâ€™)ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">+----+-----------+-----------+---------+--------------------+----------+</span><br><span class="line">| Id | Client_Id | Driver_Id | City_Id |        Status      |Request_at|</span><br><span class="line">+----+-----------+-----------+---------+--------------------+----------+</span><br><span class="line">| 1  |     1     |    10     |    1    |     completed      |2013-10-01|</span><br><span class="line">| 2  |     2     |    11     |    1    | cancelled_by_driver|2013-10-01|</span><br><span class="line">| 3  |     3     |    12     |    6    |     completed      |2013-10-01|</span><br><span class="line">| 4  |     4     |    13     |    6    | cancelled_by_client|2013-10-01|</span><br><span class="line">| 5  |     1     |    10     |    1    |     completed      |2013-10-02|</span><br><span class="line">| 6  |     2     |    11     |    6    |     completed      |2013-10-02|</span><br><span class="line">| 7  |     3     |    12     |    6    |     completed      |2013-10-02|</span><br><span class="line">| 8  |     2     |    12     |    12   |     completed      |2013-10-03|</span><br><span class="line">| 9  |     3     |    10     |    12   |     completed      |2013-10-03| </span><br><span class="line">| 10 |     4     |    13     |    12   | cancelled_by_driver|2013-10-03|</span><br><span class="line">+----+-----------+-----------+---------+--------------------+----------+</span><br></pre></td></tr></table></figure>

<p><code>Users</code> è¡¨å­˜æ‰€æœ‰ç”¨æˆ·ã€‚æ¯ä¸ªç”¨æˆ·æœ‰å”¯ä¸€é”® Users_Idã€‚Banned è¡¨ç¤ºè¿™ä¸ªç”¨æˆ·æ˜¯å¦è¢«ç¦æ­¢ï¼ŒRole åˆ™æ˜¯ä¸€ä¸ªè¡¨ç¤ºï¼ˆâ€˜clientâ€™, â€˜driverâ€™, â€˜partnerâ€™ï¼‰çš„æšä¸¾ç±»å‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+----------+--------+--------+</span><br><span class="line">| Users_Id | Banned |  Role  |</span><br><span class="line">+----------+--------+--------+</span><br><span class="line">|    1     |   No   | client |</span><br><span class="line">|    2     |   Yes  | client |</span><br><span class="line">|    3     |   No   | client |</span><br><span class="line">|    4     |   No   | client |</span><br><span class="line">|    10    |   No   | driver |</span><br><span class="line">|    11    |   No   | driver |</span><br><span class="line">|    12    |   No   | driver |</span><br><span class="line">|    13    |   No   | driver |</span><br><span class="line">+----------+--------+--------+</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€æ®µ SQL è¯­å¥æŸ¥å‡º <strong>2013å¹´10æœˆ1æ—¥</strong> è‡³ <strong>2013å¹´10æœˆ3æ—¥</strong> æœŸé—´éç¦æ­¢ç”¨æˆ·çš„å–æ¶ˆç‡ã€‚åŸºäºä¸Šè¡¨ï¼Œä½ çš„ SQL è¯­å¥åº”è¿”å›å¦‚ä¸‹ç»“æœï¼Œå–æ¶ˆç‡ï¼ˆCancellation Rateï¼‰ä¿ç•™ä¸¤ä½å°æ•°ã€‚</p>
<p>å–æ¶ˆç‡çš„è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š(è¢«å¸æœºæˆ–ä¹˜å®¢å–æ¶ˆçš„éç¦æ­¢ç”¨æˆ·ç”Ÿæˆçš„è®¢å•æ•°é‡) / (éç¦æ­¢ç”¨æˆ·ç”Ÿæˆçš„è®¢å•æ€»æ•°)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">------------+-------------------+</span></span><br><span class="line"><span class="operator">|</span>     <span class="keyword">Day</span>    <span class="operator">|</span> Cancellation Rate <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2013</span><span class="number">-10</span><span class="number">-01</span> <span class="operator">|</span>       <span class="number">0.33</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2013</span><span class="number">-10</span><span class="number">-02</span> <span class="operator">|</span>       <span class="number">0.00</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2013</span><span class="number">-10</span><span class="number">-03</span> <span class="operator">|</span>       <span class="number">0.50</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-------------------+</span></span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> T.request_at <span class="keyword">AS</span> `<span class="keyword">Day</span>`, </span><br><span class="line">	ROUND(</span><br><span class="line">			<span class="built_in">SUM</span>(</span><br><span class="line">				IF(T.STATUS <span class="operator">=</span> <span class="string">&#x27;completed&#x27;</span>,<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">			)</span><br><span class="line">			<span class="operator">/</span> </span><br><span class="line">			<span class="built_in">COUNT</span>(T.STATUS),</span><br><span class="line">			<span class="number">2</span></span><br><span class="line">	) <span class="keyword">AS</span> `Cancellation Rate`</span><br><span class="line"><span class="keyword">FROM</span> trips <span class="keyword">AS</span> T</span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line">T.Client_Id <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> users_id</span><br><span class="line">	<span class="keyword">FROM</span> users</span><br><span class="line">	<span class="keyword">WHERE</span> banned <span class="operator">=</span> <span class="string">&#x27;Yes&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">AND</span></span><br><span class="line">T.Driver_Id <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> users_id</span><br><span class="line">	<span class="keyword">FROM</span> users</span><br><span class="line">	<span class="keyword">WHERE</span> banned <span class="operator">=</span> <span class="string">&#x27;Yes&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">AND</span> T.request_at <span class="keyword">BETWEEN</span> <span class="string">&#x27;2013-10-01&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2013-10-03&#x27;</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> T.request_at</span><br></pre></td></tr></table></figure>



<h4 id="511-æ¸¸æˆç©æ³•åˆ†æ-I"><a href="#511-æ¸¸æˆç©æ³•åˆ†æ-I" class="headerlink" title="511. æ¸¸æˆç©æ³•åˆ†æ I"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/game-play-analysis-i/">511. æ¸¸æˆç©æ³•åˆ†æ I</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>æ´»åŠ¨è¡¨ <code>Activity</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| player_id    | int     |</span><br><span class="line">| device_id    | int     |</span><br><span class="line">| event_date   | date    |</span><br><span class="line">| games_played | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">è¡¨çš„ä¸»é”®æ˜¯ (player_id, event_date)ã€‚</span><br><span class="line">è¿™å¼ è¡¨å±•ç¤ºäº†ä¸€äº›æ¸¸æˆç©å®¶åœ¨æ¸¸æˆå¹³å°ä¸Šçš„è¡Œä¸ºæ´»åŠ¨ã€‚</span><br><span class="line">æ¯è¡Œæ•°æ®è®°å½•äº†ä¸€åç©å®¶åœ¨é€€å‡ºå¹³å°ä¹‹å‰ï¼Œå½“å¤©ä½¿ç”¨åŒä¸€å°è®¾å¤‡ç™»å½•å¹³å°åæ‰“å¼€çš„æ¸¸æˆçš„æ•°ç›®ï¼ˆå¯èƒ½æ˜¯ 0 ä¸ªï¼‰ã€‚</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€æ¡ SQL æŸ¥è¯¢è¯­å¥è·å–æ¯ä½ç©å®¶ <strong>ç¬¬ä¸€æ¬¡ç™»é™†å¹³å°çš„æ—¥æœŸ</strong>ã€‚</p>
<p>æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Activity è¡¨ï¼š</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| player_id | device_id | event_date | games_played |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| 1         | 2         | 2016-03-01 | 5            |</span><br><span class="line">| 1         | 2         | 2016-05-02 | 6            |</span><br><span class="line">| 2         | 3         | 2017-06-25 | 1            |</span><br><span class="line">| 3         | 1         | 2016-03-02 | 0            |</span><br><span class="line">| 3         | 4         | 2018-07-03 | 5            |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+-----------+-------------+</span><br><span class="line">| player_id | first_login |</span><br><span class="line">+-----------+-------------+</span><br><span class="line">| 1         | 2016-03-01  |</span><br><span class="line">| 2         | 2017-06-25  |</span><br><span class="line">| 3         | 2016-03-02  |</span><br><span class="line">+-----------+-------------+</span><br></pre></td></tr></table></figure>

<p>1.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> player_id ,event_date first_login</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span> player_id ,event_date,</span><br><span class="line"><span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> player_id <span class="keyword">order</span> <span class="keyword">by</span> event_date) rk</span><br><span class="line"><span class="keyword">from</span> Activity</span><br><span class="line">) tmp</span><br><span class="line"><span class="keyword">where</span> rk <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>2.æœ€ä¼˜ ï¼ˆé€‰æœ€å°æ—¥æœŸï¼‰</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> player_id ,<span class="built_in">min</span>(event_date) first_login</span><br><span class="line"><span class="keyword">from</span> Activity</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> player_id </span><br></pre></td></tr></table></figure>





<h4 id="512-æ¸¸æˆç©æ³•åˆ†æ-II"><a href="#512-æ¸¸æˆç©æ³•åˆ†æ-II" class="headerlink" title="512. æ¸¸æˆç©æ³•åˆ†æ II"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/game-play-analysis-ii/">512. æ¸¸æˆç©æ³•åˆ†æ II</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>Table: <code>Activity</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| player_id    | int     |</span><br><span class="line">| device_id    | int     |</span><br><span class="line">| event_date   | date    |</span><br><span class="line">| games_played | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">(player_id, event_date) æ˜¯è¿™ä¸ªè¡¨çš„ä¸¤ä¸ªä¸»é”®</span><br><span class="line">è¿™ä¸ªè¡¨æ˜¾ç¤ºçš„æ˜¯æŸäº›æ¸¸æˆç©å®¶çš„æ¸¸æˆæ´»åŠ¨æƒ…å†µ</span><br><span class="line">æ¯ä¸€è¡Œæ˜¯åœ¨æŸå¤©ä½¿ç”¨æŸä¸ªè®¾å¤‡ç™»å‡ºä¹‹å‰ç™»å½•å¹¶ç©å¤šä¸ªæ¸¸æˆï¼ˆå¯èƒ½ä¸º0ï¼‰çš„ç©å®¶çš„è®°å½•</span><br></pre></td></tr></table></figure>

<p>è¯·ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæè¿°æ¯ä¸€ä¸ªç©å®¶é¦–æ¬¡ç™»é™†çš„è®¾å¤‡åç§°</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Activity table:</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| player_id | device_id | event_date | games_played |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| 1         | 2         | 2016-03-01 | 5            |</span><br><span class="line">| 1         | 2         | 2016-05-02 | 6            |</span><br><span class="line">| 2         | 3         | 2017-06-25 | 1            |</span><br><span class="line">| 3         | 1         | 2016-03-02 | 0            |</span><br><span class="line">| 3         | 4         | 2018-07-03 | 5            |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-----------+-----------+</span><br><span class="line">| player_id | device_id |</span><br><span class="line">+-----------+-----------+</span><br><span class="line">| 1         | 2         |</span><br><span class="line">| 2         | 3         |</span><br><span class="line">| 3         | 1         |</span><br><span class="line">+-----------+-----------+</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> player_id ,device_id</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span> player_id ,event_date,device_id,</span><br><span class="line"><span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> player_id <span class="keyword">order</span> <span class="keyword">by</span> event_date) rk</span><br><span class="line"><span class="keyword">from</span> Activity</span><br><span class="line">) tmp</span><br><span class="line"><span class="keyword">where</span> rk <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h4 id="534-æ¸¸æˆç©æ³•åˆ†æ-III"><a href="#534-æ¸¸æˆç©æ³•åˆ†æ-III" class="headerlink" title="534. æ¸¸æˆç©æ³•åˆ†æ III"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/game-play-analysis-iii/">534. æ¸¸æˆç©æ³•åˆ†æ III</a></h4><p>éš¾åº¦ä¸­ç­‰20æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡å…³æ³¨åé¦ˆ</p>
<p>SQLæ¶æ„</p>
<p>Table: <code>Activity</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| player_id    | int     |</span><br><span class="line">| device_id    | int     |</span><br><span class="line">| event_date   | date    |</span><br><span class="line">| games_played | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">ï¼ˆplayer_idï¼Œevent_dateï¼‰æ˜¯æ­¤è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¿™å¼ è¡¨æ˜¾ç¤ºäº†æŸäº›æ¸¸æˆçš„ç©å®¶çš„æ´»åŠ¨æƒ…å†µã€‚</span><br><span class="line">æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªç©å®¶çš„è®°å½•ï¼Œä»–åœ¨æŸä¸€å¤©ä½¿ç”¨æŸä¸ªè®¾å¤‡æ³¨é”€ä¹‹å‰ç™»å½•å¹¶ç©äº†å¾ˆå¤šæ¸¸æˆï¼ˆå¯èƒ½æ˜¯ 0 ï¼‰ã€‚</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒåŒæ—¶æŠ¥å‘Šæ¯ç»„ç©å®¶å’Œæ—¥æœŸï¼Œä»¥åŠç©å®¶åˆ°ç›®å‰ä¸ºæ­¢ç©äº†å¤šå°‘æ¸¸æˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ­¤æ—¥æœŸä¹‹å‰ç©å®¶æ‰€ç©çš„æ¸¸æˆæ€»æ•°ã€‚è¯¦ç»†æƒ…å†µè¯·æŸ¥çœ‹ç¤ºä¾‹ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Activity table:</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| player_id | device_id | event_date | games_played |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| 1         | 2         | 2016-03-01 | 5            |</span><br><span class="line">| 1         | 2         | 2016-05-02 | 6            |</span><br><span class="line">| 1         | 3         | 2017-06-25 | 1            |</span><br><span class="line">| 3         | 1         | 2016-03-02 | 0            |</span><br><span class="line">| 3         | 4         | 2018-07-03 | 5            |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-----------+------------+---------------------+</span><br><span class="line">| player_id | event_date | games_played_so_far |</span><br><span class="line">+-----------+------------+---------------------+</span><br><span class="line">| 1         | 2016-03-01 | 5                   |</span><br><span class="line">| 1         | 2016-05-02 | 11                  |</span><br><span class="line">| 1         | 2017-06-25 | 12                  |</span><br><span class="line">| 3         | 2016-03-02 | 0                   |</span><br><span class="line">| 3         | 2018-07-03 | 5                   |</span><br><span class="line">+-----------+------------+---------------------+</span><br><span class="line">å¯¹äº ID ä¸º 1 çš„ç©å®¶ï¼Œ2016-05-02 å…±ç©äº† 5+6=11 ä¸ªæ¸¸æˆï¼Œ2017-06-25 å…±ç©äº† 5+6+1=12 ä¸ªæ¸¸æˆã€‚</span><br><span class="line">å¯¹äº ID ä¸º 3 çš„ç©å®¶ï¼Œ2018-07-03 å…±ç©äº† 0+5=5 ä¸ªæ¸¸æˆã€‚</span><br><span class="line">è¯·æ³¨æ„ï¼Œå¯¹äºæ¯ä¸ªç©å®¶ï¼Œæˆ‘ä»¬åªå…³å¿ƒç©å®¶çš„ç™»å½•æ—¥æœŸã€‚</span><br></pre></td></tr></table></figure>

<p>å¼€çª—</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> player_id,event_date ,</span><br><span class="line"><span class="built_in">sum</span>(games_played) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> player_id <span class="keyword">order</span> <span class="keyword">by</span>  event_date )games_played_so_far</span><br><span class="line"><span class="keyword">from</span> Activity</span><br></pre></td></tr></table></figure>

<p>è‡ªè¿æ¥</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    a1.player_id,</span><br><span class="line">    a1.event_date,</span><br><span class="line">    <span class="built_in">sum</span>(a2.games_played) games_played_so_far</span><br><span class="line"><span class="keyword">from</span> Activity a1,Activity a2</span><br><span class="line"><span class="keyword">where</span> a1.player_id<span class="operator">=</span>a2.player_id <span class="keyword">and</span> </span><br><span class="line">      a1.event_date<span class="operator">&gt;=</span>a2.event_date</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="number">1</span>,<span class="number">2</span>;</span><br></pre></td></tr></table></figure>



<h4 id="550-æ¸¸æˆç©æ³•åˆ†æ-IV"><a href="#550-æ¸¸æˆç©æ³•åˆ†æ-IV" class="headerlink" title="550. æ¸¸æˆç©æ³•åˆ†æ IV"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/game-play-analysis-iv/">550. æ¸¸æˆç©æ³•åˆ†æ IV</a></h4><p>éš¾åº¦ä¸­ç­‰17æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡å…³æ³¨åé¦ˆ</p>
<p>SQLæ¶æ„</p>
<p>Table: <code>Activity</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| player_id    | int     |</span><br><span class="line">| device_id    | int     |</span><br><span class="line">| event_date   | date    |</span><br><span class="line">| games_played | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">ï¼ˆplayer_idï¼Œevent_dateï¼‰æ˜¯æ­¤è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¿™å¼ è¡¨æ˜¾ç¤ºäº†æŸäº›æ¸¸æˆçš„ç©å®¶çš„æ´»åŠ¨æƒ…å†µã€‚</span><br><span class="line">æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªç©å®¶çš„è®°å½•ï¼Œä»–åœ¨æŸä¸€å¤©ä½¿ç”¨æŸä¸ªè®¾å¤‡æ³¨é”€ä¹‹å‰ç™»å½•å¹¶ç©äº†å¾ˆå¤šæ¸¸æˆï¼ˆå¯èƒ½æ˜¯ 0ï¼‰ã€‚</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒæŠ¥å‘Šåœ¨é¦–æ¬¡ç™»å½•çš„ç¬¬äºŒå¤©å†æ¬¡ç™»å½•çš„ç©å®¶çš„åˆ†æ•°ï¼Œå››èˆäº”å…¥åˆ°å°æ•°ç‚¹åä¸¤ä½ã€‚æ¢å¥è¯è¯´ï¼Œæ‚¨éœ€è¦è®¡ç®—ä»é¦–æ¬¡ç™»å½•æ—¥æœŸå¼€å§‹è‡³å°‘è¿ç»­ä¸¤å¤©ç™»å½•çš„ç©å®¶çš„æ•°é‡ï¼Œç„¶åé™¤ä»¥ç©å®¶æ€»æ•°ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Activity table:</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| player_id | device_id | event_date | games_played |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| 1         | 2         | 2016-03-01 | 5            |</span><br><span class="line">| 1         | 2         | 2016-03-02 | 6            |</span><br><span class="line">| 2         | 3         | 2017-06-25 | 1            |</span><br><span class="line">| 3         | 1         | 2016-03-02 | 0            |</span><br><span class="line">| 3         | 4         | 2018-07-03 | 5            |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-----------+</span><br><span class="line">| fraction  |</span><br><span class="line">+-----------+</span><br><span class="line">| 0.33      |</span><br><span class="line">+-----------+</span><br><span class="line">åªæœ‰ ID ä¸º 1 çš„ç©å®¶åœ¨ç¬¬ä¸€å¤©ç™»å½•åæ‰é‡æ–°ç™»å½•ï¼Œæ‰€ä»¥ç­”æ¡ˆæ˜¯ 1/3 = 0.33</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> round(<span class="built_in">avg</span>(a.event_date <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>), <span class="number">2</span>) fraction</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">    (<span class="keyword">select</span> player_id, <span class="built_in">min</span>(event_date) <span class="keyword">as</span> login</span><br><span class="line">    <span class="keyword">from</span> activity</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> player_id) p </span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> activity a </span><br><span class="line"><span class="keyword">on</span> p.player_id<span class="operator">=</span>a.player_id <span class="keyword">and</span> datediff(a.event_date, p.login)<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿™ä¸ªavgç”¨çš„å¦™</p>
<p>is not nullåˆ¤æ–­åï¼Œæœ‰eventdateå€¼çš„è¿”å›1ï¼Œnullçš„è¿”å›0ï¼Œavgç›¸å½“äºæ±‚å’Œå(å³ç¬¦åˆæ¡ä»¶çš„idä¸ªæ•°)é™¤ä»¥æ€»idæ•°å³æ‰€æ±‚æ¯”ä¾‹</p>
</blockquote>
<h4 id="569-å‘˜å·¥è–ªæ°´ä¸­ä½æ•°"><a href="#569-å‘˜å·¥è–ªæ°´ä¸­ä½æ•°" class="headerlink" title="569. å‘˜å·¥è–ªæ°´ä¸­ä½æ•°"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/median-employee-salary/">569. å‘˜å·¥è–ªæ°´ä¸­ä½æ•°</a></h4><p>éš¾åº¦å›°éš¾</p>
<p>SQLæ¶æ„</p>
<p><code>Employee</code> è¡¨åŒ…å«æ‰€æœ‰å‘˜å·¥ã€‚<code>Employee</code> è¡¨æœ‰ä¸‰åˆ—ï¼šå‘˜å·¥Idï¼Œå…¬å¸åå’Œè–ªæ°´ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">+-----+------------+--------+</span><br><span class="line">|Id   | Company    | Salary |</span><br><span class="line">+-----+------------+--------+</span><br><span class="line">|1    | A          | 2341   |</span><br><span class="line">|2    | A          | 341    |</span><br><span class="line">|3    | A          | 15     |</span><br><span class="line">|4    | A          | 15314  |</span><br><span class="line">|5    | A          | 451    |</span><br><span class="line">|6    | A          | 513    |</span><br><span class="line">|7    | B          | 15     |</span><br><span class="line">|8    | B          | 13     |</span><br><span class="line">|9    | B          | 1154   |</span><br><span class="line">|10   | B          | 1345   |</span><br><span class="line">|11   | B          | 1221   |</span><br><span class="line">|12   | B          | 234    |</span><br><span class="line">|13   | C          | 2345   |</span><br><span class="line">|14   | C          | 2645   |</span><br><span class="line">|15   | C          | 2645   |</span><br><span class="line">|16   | C          | 2652   |</span><br><span class="line">|17   | C          | 65     |</span><br><span class="line">+-----+------------+--------+</span><br></pre></td></tr></table></figure>

<p>è¯·ç¼–å†™SQLæŸ¥è¯¢æ¥æŸ¥æ‰¾æ¯ä¸ªå…¬å¸çš„è–ªæ°´ä¸­ä½æ•°ã€‚æŒ‘æˆ˜ç‚¹ï¼šä½ æ˜¯å¦å¯ä»¥åœ¨ä¸ä½¿ç”¨ä»»ä½•å†…ç½®çš„SQLå‡½æ•°çš„æƒ…å†µä¸‹è§£å†³æ­¤é—®é¢˜ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-----+------------+--------+</span><br><span class="line">|Id   | Company    | Salary |</span><br><span class="line">+-----+------------+--------+</span><br><span class="line">|5    | A          | 451    |</span><br><span class="line">|6    | A          | 513    |</span><br><span class="line">|12   | B          | 234    |</span><br><span class="line">|9    | B          | 1154   |</span><br><span class="line">|14   | C          | 2645   |</span><br><span class="line">+-----+------------+--------+</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> Id,Company,Salary</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span> Id,Company,Salary,</span><br><span class="line"><span class="built_in">ROW_NUMBER</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> Company <span class="keyword">order</span> <span class="keyword">by</span> Salary) rk,</span><br><span class="line"><span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> Company) cnt</span><br><span class="line"><span class="keyword">from</span> Employee</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> rk <span class="keyword">IN</span> (<span class="built_in">FLOOR</span>((cnt <span class="operator">+</span> <span class="number">1</span>)<span class="operator">/</span><span class="number">2</span>), <span class="built_in">FLOOR</span>((cnt <span class="operator">+</span> <span class="number">2</span>)<span class="operator">/</span><span class="number">2</span>))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸­ä½æ•°ï¼š</p>
<p>+1å‘ä¸‹å–æ•´ +2 å‘ä¸‹å–æ•´æ•°</p>
</blockquote>
<h4 id="570-è‡³å°‘æœ‰5åç›´æ¥ä¸‹å±çš„ç»ç†"><a href="#570-è‡³å°‘æœ‰5åç›´æ¥ä¸‹å±çš„ç»ç†" class="headerlink" title="570. è‡³å°‘æœ‰5åç›´æ¥ä¸‹å±çš„ç»ç†"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/managers-with-at-least-5-direct-reports/">570. è‡³å°‘æœ‰5åç›´æ¥ä¸‹å±çš„ç»ç†</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p><code>Employee</code> è¡¨åŒ…å«æ‰€æœ‰å‘˜å·¥å’Œä»–ä»¬çš„ç»ç†ã€‚æ¯ä¸ªå‘˜å·¥éƒ½æœ‰ä¸€ä¸ª Idï¼Œå¹¶ä¸”è¿˜æœ‰ä¸€åˆ—æ˜¯ç»ç†çš„ Idã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+------+----------+-----------+----------+</span><br><span class="line">|Id    |Name 	  |Department |ManagerId |</span><br><span class="line">+------+----------+-----------+----------+</span><br><span class="line">|101   |John 	  |A 	      |null      |</span><br><span class="line">|102   |Dan 	  |A 	      |101       |</span><br><span class="line">|103   |James 	  |A 	      |101       |</span><br><span class="line">|104   |Amy 	  |A 	      |101       |</span><br><span class="line">|105   |Anne 	  |A 	      |101       |</span><br><span class="line">|106   |Ron 	  |B 	      |101       |</span><br><span class="line">+------+----------+-----------+----------+</span><br></pre></td></tr></table></figure>

<p>ç»™å®š <code>Employee</code> è¡¨ï¼Œè¯·ç¼–å†™ä¸€ä¸ªSQLæŸ¥è¯¢æ¥æŸ¥æ‰¾è‡³å°‘æœ‰5åç›´æ¥ä¸‹å±çš„ç»ç†ã€‚å¯¹äºä¸Šè¡¨ï¼Œæ‚¨çš„SQLæŸ¥è¯¢åº”è¯¥è¿”å›ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+-------+</span><br><span class="line">| Name  |</span><br><span class="line">+-------+</span><br><span class="line">| John  |</span><br><span class="line">+-------+</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„:</strong><br>æ²¡æœ‰äººæ˜¯è‡ªå·±çš„ä¸‹å±ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> Name</span><br><span class="line"><span class="keyword">from</span> Employee</span><br><span class="line"><span class="keyword">where</span> Id <span class="keyword">in</span> (</span><br><span class="line"><span class="keyword">select</span> ManagerId</span><br><span class="line"><span class="keyword">from</span> Employee</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> ManagerId</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">&gt;=</span><span class="number">5</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<h4 id="571-ç»™å®šæ•°å­—çš„é¢‘ç‡æŸ¥è¯¢ä¸­ä½æ•°"><a href="#571-ç»™å®šæ•°å­—çš„é¢‘ç‡æŸ¥è¯¢ä¸­ä½æ•°" class="headerlink" title="571. ç»™å®šæ•°å­—çš„é¢‘ç‡æŸ¥è¯¢ä¸­ä½æ•°"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/find-median-given-frequency-of-numbers/">571. ç»™å®šæ•°å­—çš„é¢‘ç‡æŸ¥è¯¢ä¸­ä½æ•°</a></h4><p>éš¾åº¦å›°éš¾</p>
<p>SQLæ¶æ„</p>
<p><code>Numbers</code> è¡¨ä¿å­˜æ•°å­—çš„å€¼åŠå…¶é¢‘ç‡ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----------+-------------+</span><br><span class="line">|  Number  |  Frequency  |</span><br><span class="line">+----------+-------------|</span><br><span class="line">|  0       |  7          |</span><br><span class="line">|  1       |  1          |</span><br><span class="line">|  2       |  3          |</span><br><span class="line">|  3       |  1          |</span><br><span class="line">+----------+-------------+</span><br></pre></td></tr></table></figure>

<p>åœ¨æ­¤è¡¨ä¸­ï¼Œæ•°å­—ä¸º <code>0, 0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 3</code>ï¼Œæ‰€ä»¥ä¸­ä½æ•°æ˜¯ <code>(0 + 0) / 2 = 0</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+--------+</span><br><span class="line">| median |</span><br><span class="line">+--------|</span><br><span class="line">| 0.0000 |</span><br><span class="line">+--------+</span><br></pre></td></tr></table></figure>

<p>è¯·ç¼–å†™ä¸€ä¸ªæŸ¥è¯¢æ¥æŸ¥æ‰¾æ‰€æœ‰æ•°å­—çš„ä¸­ä½æ•°å¹¶å°†ç»“æœå‘½åä¸º <code>median</code> ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    <span class="built_in">avg</span>(<span class="built_in">cast</span>(number <span class="keyword">as</span> <span class="type">float</span>)) median</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> </span><br><span class="line">            Number,</span><br><span class="line">            Frequency,</span><br><span class="line">            <span class="built_in">sum</span>(Frequency) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> Number) <span class="operator">-</span> Frequency prev_sum,</span><br><span class="line">            <span class="built_in">sum</span>(Frequency) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> Number) curr_sum</span><br><span class="line">        <span class="keyword">from</span> Numbers</span><br><span class="line">    ) t1,</span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> </span><br><span class="line">            <span class="built_in">sum</span>(Frequency) total_sum</span><br><span class="line">        <span class="keyword">from</span> Numbers</span><br><span class="line">    ) t2</span><br><span class="line"><span class="keyword">where</span> </span><br><span class="line">    t1.prev_sum <span class="operator">&lt;=</span> (<span class="built_in">cast</span>(t2.total_sum <span class="keyword">as</span> <span class="type">float</span>) <span class="operator">/</span> <span class="number">2</span>) <span class="keyword">and</span> </span><br><span class="line">    t1.curr_sum <span class="operator">&gt;=</span> (<span class="built_in">cast</span>(t2.total_sum <span class="keyword">as</span> <span class="type">float</span>) <span class="operator">/</span> <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœ n1.Number ä¸ºä¸­ä½æ•°ï¼Œn1.Numberï¼ˆåŒ…å«æœ¬èº«ï¼‰å‰ç´¯è®¡çš„æ•°å­—åº”å¤§äºç­‰äºæ€»æ•°/2 åŒæ—¶n1.Numberï¼ˆä¸åŒ…å«æœ¬èº«ï¼‰å‰ç´¯è®¡æ•°å­—åº”å°äºç­‰äºæ€»æ•°/2</p>
<p>ä¾‹å¦‚ï¼š0, 0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 3 å…±12ä¸ªæ•°</p>
<p> ä¸­ä½æ•°0ï¼ˆåŒ…å«æœ¬èº«ï¼‰å‰ç´¯è®¡çš„æ•°å­— 7 &gt;=6  0ï¼ˆä¸åŒ…å«æœ¬èº«ï¼‰å‰ç´¯è®¡æ•°å­— 0 &lt;=6<br>ä¾‹å¦‚ï¼š0ï¼Œ0ï¼Œ0ï¼Œ3ï¼Œ3ï¼Œ3 å…±6ä¸ªæ•°</p>
<p> ä¸­ä½æ•°0ï¼ˆåŒ…å«æœ¬èº«ï¼‰å‰ç´¯è®¡çš„æ•°å­— 3 &gt;=3  0ï¼ˆä¸åŒ…å«æœ¬èº«ï¼‰å‰ç´¯è®¡æ•°å­— 0 &lt;=3</p>
<p> ä¸­ä½æ•°3ï¼ˆåŒ…å«æœ¬èº«ï¼‰å‰ç´¯è®¡çš„æ•°å­— 6 &gt;=3  3ï¼ˆä¸åŒ…å«æœ¬èº«ï¼‰å‰ç´¯è®¡æ•°å­— 3 &lt;=3</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"><span class="built_in">AVG</span>(Number)median </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">(<span class="keyword">SELECT</span> n1.Number <span class="keyword">FROM</span> Numbers n1 <span class="keyword">JOIN</span> Numbers n2 <span class="keyword">ON</span> n1.Number<span class="operator">&gt;=</span>n2.Number </span><br><span class="line"> <span class="keyword">GROUP</span> <span class="keyword">BY</span> </span><br><span class="line"> n1.Number </span><br><span class="line"> <span class="keyword">HAVING</span> </span><br><span class="line"> <span class="built_in">SUM</span>(n2.Frequency)<span class="operator">&gt;=</span>(<span class="keyword">SELECT</span> <span class="built_in">SUM</span>(Frequency) <span class="keyword">FROM</span> Numbers)<span class="operator">/</span><span class="number">2</span> </span><br><span class="line"> <span class="keyword">AND</span> </span><br><span class="line"> <span class="built_in">SUM</span>(n2.Frequency)<span class="operator">-</span><span class="built_in">AVG</span>(n1.Frequency)<span class="operator">&lt;=</span>(<span class="keyword">SELECT</span> <span class="built_in">SUM</span>(Frequency) <span class="keyword">FROM</span> Numbers)<span class="operator">/</span><span class="number">2</span></span><br><span class="line">)s</span><br></pre></td></tr></table></figure>

<h4 id="574-å½“é€‰è€…"><a href="#574-å½“é€‰è€…" class="headerlink" title="574. å½“é€‰è€…"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/winning-candidate/">574. å½“é€‰è€…</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>è¡¨: <code>Candidate</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-----+---------+</span><br><span class="line">| id  | Name    |</span><br><span class="line">+-----+---------+</span><br><span class="line">| 1   | A       |</span><br><span class="line">| 2   | B       |</span><br><span class="line">| 3   | C       |</span><br><span class="line">| 4   | D       |</span><br><span class="line">| 5   | E       |</span><br><span class="line">+-----+---------+  </span><br></pre></td></tr></table></figure>

<p>è¡¨: <code>Vote</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+-----+--------------+</span><br><span class="line">| id  | CandidateId  |</span><br><span class="line">+-----+--------------+</span><br><span class="line">| 1   |     2        |</span><br><span class="line">| 2   |     4        |</span><br><span class="line">| 3   |     3        |</span><br><span class="line">| 4   |     2        |</span><br><span class="line">| 5   |     5        |</span><br><span class="line">+-----+--------------+</span><br><span class="line">id æ˜¯è‡ªåŠ¨é€’å¢çš„ä¸»é”®ï¼Œ</span><br><span class="line">CandidateId æ˜¯ Candidate è¡¨ä¸­çš„ id.</span><br></pre></td></tr></table></figure>

<p>è¯·ç¼–å†™ sql è¯­å¥æ¥æ‰¾åˆ°å½“é€‰è€…çš„åå­—ï¼Œä¸Šé¢çš„ä¾‹å­å°†è¿”å›å½“é€‰è€… <code>B</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+------+</span><br><span class="line">| Name |</span><br><span class="line">+------+</span><br><span class="line">| B    |</span><br><span class="line">+------+</span><br></pre></td></tr></table></figure>



<p>ç”¨äº†order by å…¨å±€æ’åº ä¸å¤Ÿå¥½</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    Name</span><br><span class="line"><span class="keyword">from</span> Candidate c</span><br><span class="line">    <span class="keyword">left</span> <span class="keyword">join</span> Vote v</span><br><span class="line">    <span class="keyword">on</span> c.id <span class="operator">=</span> v.CandidateId</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> Name</span><br><span class="line">    <span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">desc</span></span><br><span class="line">    limit <span class="number">1</span>   </span><br></pre></td></tr></table></figure>

<p>å…ˆè¿‡æ»¤å†  æ•ˆç‡é«˜å¾ˆå¤š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> Name</span><br><span class="line"><span class="keyword">from</span> Candidate</span><br><span class="line"><span class="keyword">where</span> id <span class="operator">=</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> CandidateId</span><br><span class="line">    <span class="keyword">from</span>    </span><br><span class="line">        (</span><br><span class="line">        <span class="keyword">select</span> CandidateId, </span><br><span class="line">        <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> CandidateId ) cnt</span><br><span class="line">        <span class="keyword">from</span> Vote</span><br><span class="line">        <span class="keyword">order</span> <span class="keyword">by</span> cnt <span class="keyword">desc</span> </span><br><span class="line">        limit <span class="number">1</span></span><br><span class="line">        )t1</span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<h4 id="577-å‘˜å·¥å¥–é‡‘"><a href="#577-å‘˜å·¥å¥–é‡‘" class="headerlink" title="577. å‘˜å·¥å¥–é‡‘"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/employee-bonus/">577. å‘˜å·¥å¥–é‡‘</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>é€‰å‡ºæ‰€æœ‰ bonus &lt; 1000 çš„å‘˜å·¥çš„ name åŠå…¶ bonusã€‚</p>
<p><code>Employee</code> è¡¨å•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-------+--------+-----------+--------+</span><br><span class="line">| empId |  name  | supervisor| salary |</span><br><span class="line">+-------+--------+-----------+--------+</span><br><span class="line">|   1   | John   |  3        | 1000   |</span><br><span class="line">|   2   | Dan    |  3        | 2000   |</span><br><span class="line">|   3   | Brad   |  null     | 4000   |</span><br><span class="line">|   4   | Thomas |  3        | 4000   |</span><br><span class="line">+-------+--------+-----------+--------+</span><br><span class="line">empId æ˜¯è¿™å¼ è¡¨å•çš„ä¸»å…³é”®å­—</span><br></pre></td></tr></table></figure>

<p><code>Bonus</code> è¡¨å•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+-------+-------+</span><br><span class="line">| empId | bonus |</span><br><span class="line">+-------+-------+</span><br><span class="line">| 2     | 500   |</span><br><span class="line">| 4     | 2000  |</span><br><span class="line">+-------+-------+</span><br><span class="line">empId æ˜¯è¿™å¼ è¡¨å•çš„ä¸»å…³é”®å­—</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+-------+-------+</span><br><span class="line">| name  | bonus |</span><br><span class="line">+-------+-------+</span><br><span class="line">| John  | null  |</span><br><span class="line">| Dan   | 500   |</span><br><span class="line">| Brad  | null  |</span><br><span class="line">+-------+-------+</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name,bonus</span><br><span class="line"><span class="keyword">from</span> Employee e</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Bonus b <span class="keyword">on</span>  e.empId<span class="operator">=</span>b.empId</span><br><span class="line"><span class="keyword">where</span> bonus<span class="operator">&lt;</span><span class="number">1000</span> <span class="keyword">or</span> bonus <span class="keyword">is</span> <span class="keyword">null</span></span><br></pre></td></tr></table></figure>



<h4 id="578-æŸ¥è¯¢å›ç­”ç‡æœ€é«˜çš„é—®é¢˜"><a href="#578-æŸ¥è¯¢å›ç­”ç‡æœ€é«˜çš„é—®é¢˜" class="headerlink" title="578. æŸ¥è¯¢å›ç­”ç‡æœ€é«˜çš„é—®é¢˜"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/get-highest-answer-rate-question/">578. æŸ¥è¯¢å›ç­”ç‡æœ€é«˜çš„é—®é¢˜</a></h4><p>éš¾åº¦ä¸­ç­‰3æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡å…³æ³¨åé¦ˆ</p>
<p>SQLæ¶æ„</p>
<p>ä» <code>survey_log</code> è¡¨ä¸­è·å¾—å›ç­”ç‡æœ€é«˜çš„é—®é¢˜ï¼Œ<code>survey_log</code> è¡¨åŒ…å«è¿™äº›åˆ—<strong>ï¼šid</strong>, <strong>action</strong>, <strong>question_id</strong>, <strong>answer_id</strong>, <strong>q_num</strong>, <strong>timestamp</strong>ã€‚</p>
<p>id è¡¨ç¤ºç”¨æˆ· idï¼›action æœ‰ä»¥ä¸‹å‡ ç§å€¼ï¼šâ€showâ€ï¼Œâ€answerâ€ï¼Œâ€skipâ€ï¼›å½“ action å€¼ä¸º â€œanswerâ€ æ—¶ answer_id éç©ºï¼Œè€Œ action å€¼ä¸º â€œshowâ€ æˆ–è€… â€œskipâ€ æ—¶ answer_id ä¸ºç©ºï¼›q_num è¡¨ç¤ºå½“å‰ä¼šè¯ä¸­é—®é¢˜çš„ç¼–å·ã€‚</p>
<p>è¯·ç¼–å†™ SQL æŸ¥è¯¢æ¥æ‰¾åˆ°å…·æœ‰æœ€é«˜å›ç­”ç‡çš„é—®é¢˜ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š</span><br><span class="line">+------+-----------+--------------+------------+-----------+------------+</span><br><span class="line">| id   | action    | question_id  | answer_id  | q_num     | timestamp  |</span><br><span class="line">+------+-----------+--------------+------------+-----------+------------+</span><br><span class="line">| 5    | show      | 285          | null       | 1         | 123        |</span><br><span class="line">| 5    | answer    | 285          | 124124     | 1         | 124        |</span><br><span class="line">| 5    | show      | 369          | null       | 2         | 125        |</span><br><span class="line">| 5    | skip      | 369          | null       | 2         | 126        |</span><br><span class="line">+------+-----------+--------------+------------+-----------+------------+</span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">+-------------+</span><br><span class="line">| survey_log  |</span><br><span class="line">+-------------+</span><br><span class="line">|    285      |</span><br><span class="line">+-------------+</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">é—®é¢˜ 285 çš„å›ç­”ç‡ä¸º 1/1ï¼Œè€Œé—®é¢˜ 369 å›ç­”ç‡ä¸º 0/1ï¼Œå› æ­¤è¾“å‡º 285 ã€‚</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> question_id  survey_log</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">  <span class="keyword">select</span></span><br><span class="line">      question_id,</span><br><span class="line">      <span class="built_in">sum</span>(if(action <span class="operator">=</span> <span class="string">&#x27;answer&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) <span class="keyword">as</span> AnswerCnt,</span><br><span class="line">      <span class="built_in">sum</span>(if(action <span class="operator">=</span> <span class="string">&#x27;show&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) <span class="keyword">as</span> ShowCnt</span><br><span class="line">  <span class="keyword">from</span></span><br><span class="line">      survey_log</span><br><span class="line">  <span class="keyword">group</span> <span class="keyword">by</span> question_id</span><br><span class="line">) <span class="keyword">as</span> tbl</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> (AnswerCnt <span class="operator">/</span> ShowCnt) <span class="keyword">desc</span></span><br><span class="line">limit <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>ç›´æ¥ä¸åµŒå¥—</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> question_id  survey_log</span><br><span class="line"><span class="keyword">from</span> survey_log</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> question_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">sum</span>(if(action <span class="operator">=</span> <span class="string">&#x27;answer&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) <span class="operator">/</span> <span class="built_in">sum</span>(if(action <span class="operator">=</span> <span class="string">&#x27;show&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) <span class="keyword">desc</span></span><br><span class="line">limit <span class="number">1</span></span><br></pre></td></tr></table></figure>



<h4 id="579-æŸ¥è¯¢å‘˜å·¥çš„ç´¯è®¡è–ªæ°´"><a href="#579-æŸ¥è¯¢å‘˜å·¥çš„ç´¯è®¡è–ªæ°´" class="headerlink" title="579. æŸ¥è¯¢å‘˜å·¥çš„ç´¯è®¡è–ªæ°´"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/find-cumulative-salary-of-an-employee/">579. æŸ¥è¯¢å‘˜å·¥çš„ç´¯è®¡è–ªæ°´</a></h4><p>éš¾åº¦å›°éš¾</p>
<p>SQLæ¶æ„</p>
<p><strong>Employee</strong> è¡¨ä¿å­˜äº†ä¸€å¹´å†…çš„è–ªæ°´ä¿¡æ¯ã€‚</p>
<p>è¯·ä½ ç¼–å†™ SQL è¯­å¥ï¼Œå¯¹äºæ¯ä¸ªå‘˜å·¥ï¼ŒæŸ¥è¯¢ä»–é™¤æœ€è¿‘ä¸€ä¸ªæœˆï¼ˆå³æœ€å¤§æœˆï¼‰ä¹‹å¤–ï¼Œå‰©ä¸‹æ¯ä¸ªæœˆçš„è¿‘ä¸‰ä¸ªæœˆçš„ç´¯è®¡è–ªæ°´ï¼ˆä¸è¶³ä¸‰ä¸ªæœˆä¹Ÿè¦è®¡ç®—ï¼‰ã€‚</p>
<p>ç»“æœè¯·æŒ‰ <code>Id</code> å‡åºï¼Œç„¶åæŒ‰ <code>Month</code> é™åºæ˜¾ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š</strong><br><strong>è¾“å…¥ï¼š</strong></p>
<table>
<thead>
<tr>
<th>Id</th>
<th>Month</th>
<th>Salary</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
<td>20</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>20</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>30</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>30</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
<td>40</td>
</tr>
<tr>
<td>1</td>
<td>3</td>
<td>40</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
<td>60</td>
</tr>
<tr>
<td>1</td>
<td>4</td>
<td>60</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>70</td>
</tr>
</tbody></table>
<p><strong>è¾“å‡ºï¼š</strong></p>
<table>
<thead>
<tr>
<th>Id</th>
<th>Month</th>
<th>Salary</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>3</td>
<td>90</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>50</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>20</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>20</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
<td>100</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
<td>40</td>
</tr>
</tbody></table>
<p><strong>è§£é‡Šï¼š</strong></p>
<p>å‘˜å·¥ â€˜1â€™ é™¤å»æœ€è¿‘ä¸€ä¸ªæœˆï¼ˆæœˆä»½ â€˜4â€™ï¼‰ï¼Œæœ‰ä¸‰ä¸ªæœˆçš„è–ªæ°´è®°å½•ï¼šæœˆä»½ â€˜3â€™ è–ªæ°´ä¸º 40ï¼Œæœˆä»½ â€˜2â€™ è–ªæ°´ä¸º 30ï¼Œæœˆä»½ â€˜1â€™ è–ªæ°´ä¸º 20ã€‚</p>
<p>æ‰€ä»¥è¿‘ 3 ä¸ªæœˆçš„è–ªæ°´ç´¯è®¡åˆ†åˆ«ä¸º (40 + 30 + 20) = 90ï¼Œ(30 + 20) = 50 å’Œ 20ã€‚</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>Month</th>
<th>Salary</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>3</td>
<td>90</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>50</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>20</td>
</tr>
</tbody></table>
<p>å‘˜å·¥ â€˜2â€™ é™¤å»æœ€è¿‘çš„ä¸€ä¸ªæœˆï¼ˆæœˆä»½ â€˜2â€™ï¼‰çš„è¯ï¼Œåªæœ‰æœˆä»½ â€˜1â€™ è¿™ä¸€ä¸ªæœˆçš„è–ªæ°´è®°å½•ã€‚</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>Month</th>
<th>Salary</th>
</tr>
</thead>
<tbody><tr>
<td>2</td>
<td>1</td>
<td>20</td>
</tr>
</tbody></table>
<p>å‘˜å·¥ â€˜3â€™ é™¤å»æœ€è¿‘ä¸€ä¸ªæœˆï¼ˆæœˆä»½ â€˜4â€™ï¼‰åæœ‰ä¸¤ä¸ªæœˆï¼Œåˆ†åˆ«ä¸ºï¼šæœˆä»½ â€˜4â€™ è–ªæ°´ä¸º 60 å’Œ æœˆä»½ â€˜2â€™ è–ªæ°´ä¸º 40ã€‚æ‰€ä»¥å„æœˆçš„ç´¯è®¡æƒ…å†µå¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>Month</th>
<th>Salary</th>
</tr>
</thead>
<tbody><tr>
<td>3</td>
<td>3</td>
<td>100</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
<td>40</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> Id,<span class="keyword">Month</span>,</span><br><span class="line"><span class="built_in">sum</span>(Salary) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> Id <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">Month</span> <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="number">2</span> PRECEDING <span class="keyword">AND</span> <span class="keyword">CURRENT</span> <span class="type">ROW</span>) Salary</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> Id,<span class="keyword">Month</span>,Salary,</span><br><span class="line">    <span class="built_in">lead</span>(<span class="keyword">Month</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> Id <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">Month</span>) lm</span><br><span class="line">    <span class="keyword">from</span> Employee </span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> lm <span class="operator">!=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span>  Id,<span class="keyword">Month</span> <span class="keyword">desc</span></span><br></pre></td></tr></table></figure>



<h4 id="580-ç»Ÿè®¡å„ä¸“ä¸šå­¦ç”Ÿäººæ•°"><a href="#580-ç»Ÿè®¡å„ä¸“ä¸šå­¦ç”Ÿäººæ•°" class="headerlink" title="580. ç»Ÿè®¡å„ä¸“ä¸šå­¦ç”Ÿäººæ•°"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/count-student-number-in-departments/">580. ç»Ÿè®¡å„ä¸“ä¸šå­¦ç”Ÿäººæ•°</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>ä¸€æ‰€å¤§å­¦æœ‰ 2 ä¸ªæ•°æ®è¡¨ï¼Œåˆ†åˆ«æ˜¯ <em><strong>student</strong></em> å’Œ <em><strong>department</strong></em> ï¼Œè¿™ä¸¤ä¸ªè¡¨ä¿å­˜ç€æ¯ä¸ªä¸“ä¸šçš„å­¦ç”Ÿæ•°æ®å’Œé™¢ç³»æ•°æ®ã€‚</p>
<p>å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼ŒæŸ¥è¯¢ <em><strong>department</strong></em> è¡¨ä¸­æ¯ä¸ªä¸“ä¸šçš„å­¦ç”Ÿäººæ•° ï¼ˆå³ä½¿æ²¡æœ‰å­¦ç”Ÿçš„ä¸“ä¸šä¹Ÿéœ€åˆ—å‡ºï¼‰ã€‚</p>
<p>å°†ä½ çš„æŸ¥è¯¢ç»“æœæŒ‰ç…§å­¦ç”Ÿäººæ•°é™åºæ’åˆ—ã€‚ å¦‚æœæœ‰ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šä¸“ä¸šæœ‰ç›¸åŒçš„å­¦ç”Ÿæ•°ç›®ï¼Œå°†è¿™äº›éƒ¨é—¨æŒ‰ç…§éƒ¨é—¨åå­—çš„å­—å…¸åºä»å°åˆ°å¤§æ’åˆ—ã€‚</p>
<p>*<strong>student*</strong> è¡¨æ ¼å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody><tr>
<td>student_id</td>
<td>Integer</td>
</tr>
<tr>
<td>student_name</td>
<td>String</td>
</tr>
<tr>
<td>gender</td>
<td>Character</td>
</tr>
<tr>
<td>dept_id</td>
<td>Integer</td>
</tr>
</tbody></table>
<p>å…¶ä¸­ï¼Œ student_id æ˜¯å­¦ç”Ÿçš„å­¦å·ï¼Œ student_name æ˜¯å­¦ç”Ÿçš„å§“åï¼Œ gender æ˜¯å­¦ç”Ÿçš„æ€§åˆ«ï¼Œ dept_id æ˜¯å­¦ç”Ÿæ‰€å±ä¸“ä¸šçš„ä¸“ä¸šç¼–å·ã€‚</p>
<p>*<strong>department*</strong> è¡¨æ ¼å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody><tr>
<td>dept_id</td>
<td>Integer</td>
</tr>
<tr>
<td>dept_name</td>
<td>String</td>
</tr>
</tbody></table>
<p>dept_id æ˜¯ä¸“ä¸šç¼–å·ï¼Œ dept_name æ˜¯ä¸“ä¸šåå­—ã€‚</p>
<p>è¿™é‡Œæ˜¯ä¸€ä¸ªç¤ºä¾‹è¾“å…¥ï¼š<br>*<strong>student*</strong> è¡¨æ ¼ï¼š</p>
<table>
<thead>
<tr>
<th>student_id</th>
<th>student_name</th>
<th>gender</th>
<th>dept_id</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Jack</td>
<td>M</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>Jane</td>
<td>F</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>Mark</td>
<td>M</td>
<td>2</td>
</tr>
</tbody></table>
<p>*<strong>department*</strong> è¡¨æ ¼ï¼š</p>
<table>
<thead>
<tr>
<th>dept_id</th>
<th>dept_name</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Engineering</td>
</tr>
<tr>
<td>2</td>
<td>Science</td>
</tr>
<tr>
<td>3</td>
<td>Law</td>
</tr>
</tbody></table>
<p>ç¤ºä¾‹è¾“å‡ºä¸ºï¼š</p>
<table>
<thead>
<tr>
<th>dept_name</th>
<th>student_number</th>
</tr>
</thead>
<tbody><tr>
<td>Engineering</td>
<td>2</td>
</tr>
<tr>
<td>Science</td>
<td>1</td>
</tr>
<tr>
<td>Law</td>
<td>0</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  dept_name ,<span class="built_in">count</span>(student_id) student_number</span><br><span class="line"><span class="keyword">from</span> department d <span class="keyword">left</span> <span class="keyword">join</span> student s</span><br><span class="line"><span class="keyword">on</span> d.dept_id<span class="operator">=</span>s.dept_id </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> dept_name</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> student_number <span class="keyword">desc</span></span><br></pre></td></tr></table></figure>





<h4 id="584-å¯»æ‰¾ç”¨æˆ·æ¨èäºº"><a href="#584-å¯»æ‰¾ç”¨æˆ·æ¨èäºº" class="headerlink" title="584. å¯»æ‰¾ç”¨æˆ·æ¨èäºº"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/find-customer-referee/">584. å¯»æ‰¾ç”¨æˆ·æ¨èäºº</a></h4><p>éš¾åº¦ç®€å•9æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡å…³æ³¨åé¦ˆ</p>
<p>SQLæ¶æ„</p>
<p>ç»™å®šè¡¨ <code>customer</code> ï¼Œé‡Œé¢ä¿å­˜äº†æ‰€æœ‰å®¢æˆ·ä¿¡æ¯å’Œä»–ä»¬çš„æ¨èäººã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+------+------+-----------+</span><br><span class="line">| id   | name | referee_id|</span><br><span class="line">+------+------+-----------+</span><br><span class="line">|    1 | Will |      NULL |</span><br><span class="line">|    2 | Jane |      NULL |</span><br><span class="line">|    3 | Alex |         2 |</span><br><span class="line">|    4 | Bill |      NULL |</span><br><span class="line">|    5 | Zack |         1 |</span><br><span class="line">|    6 | Mark |         2 |</span><br><span class="line">+------+------+-----------+</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œè¿”å›ä¸€ä¸ªç¼–å·åˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­ç¼–å·çš„æ¨èäººçš„ç¼–å·éƒ½ <strong>ä¸æ˜¯</strong> 2ã€‚</p>
<p>å¯¹äºä¸Šé¢çš„ç¤ºä¾‹æ•°æ®ï¼Œç»“æœä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+------+</span><br><span class="line">| name |</span><br><span class="line">+------+</span><br><span class="line">| Will |</span><br><span class="line">| Jane |</span><br><span class="line">| Bill |</span><br><span class="line">| Zack |</span><br><span class="line">+------+</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> customer <span class="keyword">WHERE</span> referee_id <span class="operator">!=</span> <span class="number">2</span> <span class="keyword">OR</span> referee_id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>MySQL ä½¿ç”¨ä¸‰å€¼é€»è¾‘ â€”â€” TRUE, FALSE å’Œ UNKNOWNã€‚ä»»ä½•ä¸ NULL å€¼è¿›è¡Œçš„æ¯”è¾ƒéƒ½ä¼šä¸ç¬¬ä¸‰ç§å€¼ UNKNOWN åšæ¯”è¾ƒã€‚è¿™ä¸ªâ€œä»»ä½•å€¼â€åŒ…æ‹¬ NULL æœ¬èº«ï¼è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ MySQL æä¾› IS NULL å’Œ IS NOT NULL ä¸¤ç§æ“ä½œæ¥å¯¹ NULL ç‰¹æ®Šåˆ¤æ–­ã€‚</p>
<p>å› æ­¤ï¼Œåœ¨ WHERE è¯­å¥ä¸­æˆ‘ä»¬éœ€è¦åšä¸€ä¸ªé¢å¤–çš„æ¡ä»¶åˆ¤æ–­ `referee_id IS NULLâ€™ã€‚</p>
</blockquote>
<h4 id="585-2016å¹´çš„æŠ•èµ„"><a href="#585-2016å¹´çš„æŠ•èµ„" class="headerlink" title="585. 2016å¹´çš„æŠ•èµ„"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/investments-in-2016/">585. 2016å¹´çš„æŠ•èµ„</a></h4><p>éš¾åº¦ä¸­ç­‰14æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡å…³æ³¨åé¦ˆ</p>
<p>SQLæ¶æ„</p>
<p>å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œå°† 2016 å¹´ (<strong>TIV_2016</strong>) æ‰€æœ‰æˆåŠŸæŠ•èµ„çš„é‡‘é¢åŠ èµ·æ¥ï¼Œä¿ç•™ 2 ä½å°æ•°ã€‚</p>
<p>å¯¹äºä¸€ä¸ªæŠ•ä¿äººï¼Œä»–åœ¨ 2016 å¹´æˆåŠŸæŠ•èµ„çš„æ¡ä»¶æ˜¯ï¼š</p>
<ol>
<li>ä»–åœ¨ 2015 å¹´çš„æŠ•ä¿é¢ (<strong>TIV_2015</strong>) è‡³å°‘è·Ÿä¸€ä¸ªå…¶ä»–æŠ•ä¿äººåœ¨ 2015 å¹´çš„æŠ•ä¿é¢ç›¸åŒã€‚</li>
<li>ä»–æ‰€åœ¨çš„åŸå¸‚å¿…é¡»ä¸å…¶ä»–æŠ•ä¿äººéƒ½ä¸åŒï¼ˆä¹Ÿå°±æ˜¯è¯´ç»´åº¦å’Œç»åº¦ä¸èƒ½è·Ÿå…¶ä»–ä»»ä½•ä¸€ä¸ªæŠ•ä¿äººå®Œå…¨ç›¸åŒï¼‰ã€‚</li>
</ol>
<p><strong>è¾“å…¥æ ¼å¼:</strong><br>è¡¨ *<strong>insurance*</strong> æ ¼å¼å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
</tr>
</thead>
<tbody><tr>
<td>PID</td>
<td>INTEGER(11)</td>
</tr>
<tr>
<td>TIV_2015</td>
<td>NUMERIC(15,2)</td>
</tr>
<tr>
<td>TIV_2016</td>
<td>NUMERIC(15,2)</td>
</tr>
<tr>
<td>LAT</td>
<td>NUMERIC(5,2)</td>
</tr>
<tr>
<td>LON</td>
<td>NUMERIC(5,2)</td>
</tr>
</tbody></table>
<p><strong>PID</strong> å­—æ®µæ˜¯æŠ•ä¿äººçš„æŠ•ä¿ç¼–å·ï¼Œ <strong>TIV_2015</strong> æ˜¯è¯¥æŠ•ä¿äººåœ¨2015å¹´çš„æ€»æŠ•ä¿é‡‘é¢ï¼Œ <strong>TIV_2016</strong> æ˜¯è¯¥æŠ•ä¿äººåœ¨2016å¹´çš„æŠ•ä¿é‡‘é¢ï¼Œ <strong>LAT</strong> æ˜¯æŠ•ä¿äººæ‰€åœ¨åŸå¸‚çš„ç»´åº¦ï¼Œ <strong>LON</strong> æ˜¯æŠ•ä¿äººæ‰€åœ¨åŸå¸‚çš„ç»åº¦ã€‚</p>
<p><strong>æ ·ä¾‹è¾“å…¥</strong></p>
<table>
<thead>
<tr>
<th>PID</th>
<th>TIV_2015</th>
<th>TIV_2016</th>
<th>LAT</th>
<th>LON</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>10</td>
<td>5</td>
<td>10</td>
<td>10</td>
</tr>
<tr>
<td>2</td>
<td>20</td>
<td>20</td>
<td>20</td>
<td>20</td>
</tr>
<tr>
<td>3</td>
<td>10</td>
<td>30</td>
<td>20</td>
<td>20</td>
</tr>
<tr>
<td>4</td>
<td>10</td>
<td>40</td>
<td>40</td>
<td>40</td>
</tr>
</tbody></table>
<p><strong>æ ·ä¾‹è¾“å‡º</strong></p>
<table>
<thead>
<tr>
<th>TIV_2016</th>
</tr>
</thead>
<tbody><tr>
<td>45.00</td>
</tr>
</tbody></table>
<p><strong>è§£é‡Š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">å°±å¦‚æœ€åä¸€ä¸ªæŠ•ä¿äººï¼Œç¬¬ä¸€ä¸ªæŠ•ä¿äººåŒæ—¶æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</span><br><span class="line">1. ä»–åœ¨ 2015 å¹´çš„æŠ•ä¿é‡‘é¢ TIV_2015 ä¸º &#x27;10&#x27; ï¼Œä¸ç¬¬ä¸‰ä¸ªå’Œç¬¬å››ä¸ªæŠ•ä¿äººåœ¨ 2015 å¹´çš„æŠ•ä¿é‡‘é¢ç›¸åŒã€‚</span><br><span class="line">2. ä»–æ‰€åœ¨åŸå¸‚çš„ç»çº¬åº¦æ˜¯ç‹¬ä¸€æ— äºŒçš„ã€‚</span><br><span class="line"></span><br><span class="line">ç¬¬äºŒä¸ªæŠ•ä¿äººä¸¤ä¸ªæ¡ä»¶éƒ½ä¸æ»¡è¶³ã€‚ä»–åœ¨ 2015 å¹´çš„æŠ•èµ„ TIV_2015 ä¸å…¶ä»–ä»»ä½•æŠ•ä¿äººéƒ½ä¸ç›¸åŒã€‚</span><br><span class="line">ä¸”ä»–æ‰€åœ¨åŸå¸‚çš„ç»çº¬åº¦ä¸ç¬¬ä¸‰ä¸ªæŠ•ä¿äººç›¸åŒã€‚åŸºäºåŒæ ·çš„åŸå› ï¼Œç¬¬ä¸‰ä¸ªæŠ•ä¿äººæŠ•èµ„å¤±è´¥ã€‚</span><br><span class="line"></span><br><span class="line">æ‰€ä»¥è¿”å›çš„ç»“æœæ˜¯ç¬¬ä¸€ä¸ªæŠ•ä¿äººå’Œæœ€åä¸€ä¸ªæŠ•ä¿äººçš„ TIV_2016 ä¹‹å’Œï¼Œç»“æœæ˜¯ 45 ã€‚</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(TIV_2016) TIV_2016</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> PID,TIV_2016,cnt,</span><br><span class="line">    <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> loc ) lcnt</span><br><span class="line">    <span class="keyword">from</span> (</span><br><span class="line">        <span class="keyword">select</span> PID,TIV_2016,</span><br><span class="line">        <span class="built_in">count</span>(TIV_2015) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> TIV_2015 ) cnt,</span><br><span class="line">        concat_ws(&quot;,&quot;,LAT,LON) loc</span><br><span class="line">        <span class="keyword">from</span> insurance </span><br><span class="line">    )t1</span><br><span class="line">)t2</span><br><span class="line"><span class="keyword">where</span> lcnt<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> cnt<span class="operator">!=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„å»é‡é¡ºåº ä¸è¦å…ˆå¯¹TIV_2015å»é‡  ä¸ç„¶ localå»é‡æ—¶ä¼šä¸¢å¤±æ•°æ®</p>
</blockquote>
<p>ä¼˜åŒ– çª—å£</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    ROUND(<span class="built_in">SUM</span>(TIV_2016), <span class="number">2</span>) <span class="keyword">as</span> TIV_2016</span><br><span class="line"><span class="keyword">FROM</span>(</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">        <span class="operator">*</span>,</span><br><span class="line">        <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> TIV_2015) <span class="keyword">as</span> cnt_1,</span><br><span class="line">        <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> LAT, LON) <span class="keyword">as</span> cnt_2</span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">        insurance</span><br><span class="line">) a </span><br><span class="line"><span class="keyword">WHERE</span> a.cnt_1 <span class="operator">&gt;</span> <span class="number">1</span> <span class="keyword">AND</span> a.cnt_2 <span class="operator">&lt;</span> <span class="number">2</span></span><br></pre></td></tr></table></figure>



<h4 id="586-è®¢å•æœ€å¤šçš„å®¢æˆ·"><a href="#586-è®¢å•æœ€å¤šçš„å®¢æˆ·" class="headerlink" title="586. è®¢å•æœ€å¤šçš„å®¢æˆ·"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/customer-placing-the-largest-number-of-orders/">586. è®¢å•æœ€å¤šçš„å®¢æˆ·</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>åœ¨è¡¨ <strong>orders</strong> ä¸­æ‰¾åˆ°è®¢å•æ•°æœ€å¤šå®¢æˆ·å¯¹åº”çš„ <strong>customer_number</strong> ã€‚</p>
<p>æ•°æ®ä¿è¯è®¢å•æ•°æœ€å¤šçš„é¡¾å®¢æ°å¥½åªæœ‰ä¸€ä½ã€‚</p>
<p>è¡¨ *<strong>orders*</strong> å®šä¹‰å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
</tr>
</thead>
<tbody><tr>
<td>order_number (PK)</td>
<td>int</td>
</tr>
<tr>
<td>customer_number</td>
<td>int</td>
</tr>
<tr>
<td>order_date</td>
<td>date</td>
</tr>
<tr>
<td>required_date</td>
<td>date</td>
</tr>
<tr>
<td>shipped_date</td>
<td>date</td>
</tr>
<tr>
<td>status</td>
<td>char(15)</td>
</tr>
<tr>
<td>comment</td>
<td>char(200)</td>
</tr>
</tbody></table>
<p><strong>æ ·ä¾‹è¾“å…¥</strong></p>
<table>
<thead>
<tr>
<th>order_number</th>
<th>customer_number</th>
<th>order_date</th>
<th>required_date</th>
<th>shipped_date</th>
<th>status</th>
<th>comment</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
<td>2017-04-09</td>
<td>2017-04-13</td>
<td>2017-04-12</td>
<td>Closed</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>2017-04-15</td>
<td>2017-04-20</td>
<td>2017-04-18</td>
<td>Closed</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>3</td>
<td>2017-04-16</td>
<td>2017-04-25</td>
<td>2017-04-20</td>
<td>Closed</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>3</td>
<td>2017-04-18</td>
<td>2017-04-28</td>
<td>2017-04-25</td>
<td>Closed</td>
<td></td>
</tr>
</tbody></table>
<p><strong>æ ·ä¾‹è¾“å‡º</strong></p>
<table>
<thead>
<tr>
<th>customer_number</th>
</tr>
</thead>
<tbody><tr>
<td>3</td>
</tr>
</tbody></table>
<p><strong>è§£é‡Š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">customer_number ä¸º &#x27;3&#x27; çš„é¡¾å®¢æœ‰ä¸¤ä¸ªè®¢å•ï¼Œæ¯”é¡¾å®¢ &#x27;1&#x27; æˆ–è€… &#x27;2&#x27; éƒ½è¦å¤šï¼Œå› ä¸ºä»–ä»¬åªæœ‰ä¸€ä¸ªè®¢å•</span><br><span class="line">æ‰€ä»¥ç»“æœæ˜¯è¯¥é¡¾å®¢çš„ customer_number ï¼Œä¹Ÿå°±æ˜¯ 3 ã€‚</span><br></pre></td></tr></table></figure>

<p><strong>è¿›é˜¶ï¼š</strong> å¦‚æœæœ‰å¤šä½é¡¾å®¢è®¢å•æ•°å¹¶åˆ—æœ€å¤šï¼Œä½ èƒ½æ‰¾åˆ°ä»–ä»¬æ‰€æœ‰çš„ customer_number å—ï¼Ÿ</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> customer_number</span><br><span class="line"><span class="keyword">from</span> orders</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> customer_number </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">count</span>(<span class="operator">*</span>)  <span class="keyword">desc</span></span><br><span class="line">limit <span class="number">1</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¦‚æœ æ•°æ®é‡å¾ˆå¤§ order by ä¸å¤ªå¥½</p>
</blockquote>
<h4 id="595-å¤§çš„å›½å®¶"><a href="#595-å¤§çš„å›½å®¶" class="headerlink" title="595. å¤§çš„å›½å®¶"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/big-countries/">595. å¤§çš„å›½å®¶</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>è¿™é‡Œæœ‰å¼  <code>World</code> è¡¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-----------------+------------+------------+--------------+---------------+</span><br><span class="line">| name            | continent  | area       | population   | gdp           |</span><br><span class="line">+-----------------+------------+------------+--------------+---------------+</span><br><span class="line">| Afghanistan     | Asia       | 652230     | 25500100     | 20343000      |</span><br><span class="line">| Albania         | Europe     | 28748      | 2831741      | 12960000      |</span><br><span class="line">| Algeria         | Africa     | 2381741    | 37100000     | 188681000     |</span><br><span class="line">| Andorra         | Europe     | 468        | 78115        | 3712000       |</span><br><span class="line">| Angola          | Africa     | 1246700    | 20609294     | 100990000     |</span><br><span class="line">+-----------------+------------+------------+--------------+---------------+</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸€ä¸ªå›½å®¶çš„é¢ç§¯è¶…è¿‡300ä¸‡å¹³æ–¹å…¬é‡Œï¼Œæˆ–è€…äººå£è¶…è¿‡2500ä¸‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå›½å®¶å°±æ˜¯å¤§å›½å®¶ã€‚</p>
<p>ç¼–å†™ä¸€ä¸ªSQLæŸ¥è¯¢ï¼Œè¾“å‡ºè¡¨ä¸­æ‰€æœ‰å¤§å›½å®¶çš„åç§°ã€äººå£å’Œé¢ç§¯ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæ ¹æ®ä¸Šè¡¨ï¼Œæˆ‘ä»¬åº”è¯¥è¾“å‡º:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+--------------+-------------+--------------+</span><br><span class="line">| name         | population  | area         |</span><br><span class="line">+--------------+-------------+--------------+</span><br><span class="line">| Afghanistan  | 25500100    | 652230       |</span><br><span class="line">| Algeria      | 37100000    | 2381741      |</span><br><span class="line">+--------------+-------------+--------------+</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  name ,population,area  </span><br><span class="line"><span class="keyword">from</span> World</span><br><span class="line"><span class="keyword">where</span> area  <span class="operator">&gt;</span><span class="number">3000000</span> <span class="keyword">or</span> population <span class="operator">&gt;</span><span class="number">25000000</span></span><br></pre></td></tr></table></figure>



<h4 id="596-è¶…è¿‡5åå­¦ç”Ÿçš„è¯¾"><a href="#596-è¶…è¿‡5åå­¦ç”Ÿçš„è¯¾" class="headerlink" title="596. è¶…è¿‡5åå­¦ç”Ÿçš„è¯¾"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/classes-more-than-5-students/">596. è¶…è¿‡5åå­¦ç”Ÿçš„è¯¾</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>æœ‰ä¸€ä¸ª<code>courses</code> è¡¨ ï¼Œæœ‰: <strong>student (å­¦ç”Ÿ)</strong> å’Œ **class (è¯¾ç¨‹)**ã€‚</p>
<p>è¯·åˆ—å‡ºæ‰€æœ‰è¶…è¿‡æˆ–ç­‰äº5åå­¦ç”Ÿçš„è¯¾ã€‚</p>
<p>ä¾‹å¦‚,è¡¨:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+---------+------------+</span><br><span class="line">| student | class      |</span><br><span class="line">+---------+------------+</span><br><span class="line">| A       | Math       |</span><br><span class="line">| B       | English    |</span><br><span class="line">| C       | Math       |</span><br><span class="line">| D       | Biology    |</span><br><span class="line">| E       | Math       |</span><br><span class="line">| F       | Computer   |</span><br><span class="line">| G       | Math       |</span><br><span class="line">| H       | Math       |</span><br><span class="line">| I       | Math       |</span><br><span class="line">+---------+------------+</span><br></pre></td></tr></table></figure>

<p>åº”è¯¥è¾“å‡º:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+---------+</span><br><span class="line">| class   |</span><br><span class="line">+---------+</span><br><span class="line">| Math    |</span><br><span class="line">+---------+</span><br></pre></td></tr></table></figure>

<p><strong>Note:</strong><br>å­¦ç”Ÿåœ¨æ¯ä¸ªè¯¾ä¸­ä¸åº”è¢«é‡å¤è®¡ç®—ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  class </span><br><span class="line"><span class="keyword">from</span> courses</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> class </span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> student)<span class="operator">&gt;=</span><span class="number">5</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸€ä¸ªå­¦ç”Ÿå¯èƒ½å¤šæ¬¡é€‰è¯¾ã€‚ã€‚è®°å¾—distinct</p>
</blockquote>
<h4 id="597-å¥½å‹ç”³è¯·-I-ï¼šæ€»ä½“é€šè¿‡ç‡"><a href="#597-å¥½å‹ç”³è¯·-I-ï¼šæ€»ä½“é€šè¿‡ç‡" class="headerlink" title="597. å¥½å‹ç”³è¯· I ï¼šæ€»ä½“é€šè¿‡ç‡"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/friend-requests-i-overall-acceptance-rate/">597. å¥½å‹ç”³è¯· I ï¼šæ€»ä½“é€šè¿‡ç‡</a></h4><p>éš¾åº¦ç®€å•21æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡å…³æ³¨åé¦ˆ</p>
<p>SQLæ¶æ„</p>
<p>åœ¨ Facebook æˆ–è€… Twitter è¿™æ ·çš„ç¤¾äº¤åº”ç”¨ä¸­ï¼Œäººä»¬ç»å¸¸ä¼šå‘å¥½å‹ç”³è¯·ä¹Ÿä¼šæ”¶åˆ°å…¶ä»–äººçš„å¥½å‹ç”³è¯·ã€‚ç°åœ¨ç»™å¦‚ä¸‹ä¸¤ä¸ªè¡¨ï¼š</p>
<p>è¡¨ï¼š friend_request</p>
<table>
<thead>
<tr>
<th>sender_id</th>
<th>send_to_id</th>
<th>request_date</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>2</td>
<td>2016_06-01</td>
</tr>
<tr>
<td>1</td>
<td>3</td>
<td>2016_06-01</td>
</tr>
<tr>
<td>1</td>
<td>4</td>
<td>2016_06-01</td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>2016_06-02</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>2016-06-09</td>
</tr>
</tbody></table>
<p>è¡¨ï¼š request_accepted</p>
<table>
<thead>
<tr>
<th>requester_id</th>
<th>accepter_id</th>
<th>accept_date</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>2</td>
<td>2016_06-03</td>
</tr>
<tr>
<td>1</td>
<td>3</td>
<td>2016-06-08</td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>2016-06-08</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>2016-06-09</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>2016-06-10</td>
</tr>
</tbody></table>
<p>å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œæ±‚å‡ºå¥½å‹ç”³è¯·çš„é€šè¿‡ç‡ï¼Œç”¨ 2 ä½å°æ•°è¡¨ç¤ºã€‚é€šè¿‡ç‡ç”±æ¥å—å¥½å‹ç”³è¯·çš„æ•°ç›®é™¤ä»¥ç”³è¯·æ€»æ•°ã€‚</p>
<p>å¯¹äºä¸Šé¢çš„æ ·ä¾‹æ•°æ®ï¼Œä½ çš„æŸ¥è¯¢è¯­å¥åº”è¯¥è¿”å›å¦‚ä¸‹ç»“æœã€‚</p>
<table>
<thead>
<tr>
<th>accept_rate</th>
</tr>
</thead>
<tbody><tr>
<td>0.80</td>
</tr>
</tbody></table>
<p>æ³¨æ„:</p>
<p>é€šè¿‡çš„å¥½å‹ç”³è¯·ä¸ä¸€å®šéƒ½åœ¨è¡¨ friend_request ä¸­ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ åªéœ€è¦ç»Ÿè®¡æ€»çš„è¢«é€šè¿‡çš„ç”³è¯·æ•°ï¼ˆä¸ç®¡å®ƒä»¬åœ¨ä¸åœ¨åŸæ¥çš„ç”³è¯·ä¸­ï¼‰ï¼Œå¹¶å°†å®ƒé™¤ä»¥ç”³è¯·æ€»æ•°ï¼Œå¾—åˆ°é€šè¿‡ç‡<br>ä¸€ä¸ªå¥½å‹ç”³è¯·å‘é€è€…æœ‰å¯èƒ½ä¼šç»™æ¥å—è€…å‘å‡ æ¡å¥½å‹ç”³è¯·ï¼Œä¹Ÿæœ‰å¯èƒ½ä¸€ä¸ªå¥½å‹ç”³è¯·ä¼šè¢«é€šè¿‡å¥½å‡ æ¬¡ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œé‡å¤çš„å¥½å‹ç”³è¯·åªç»Ÿè®¡ä¸€æ¬¡ã€‚<br>å¦‚æœä¸€ä¸ªå¥½å‹ç”³è¯·éƒ½æ²¡æœ‰ï¼Œé€šè¿‡ç‡ä¸º 0.00 ã€‚</p>
<p>è§£é‡Šï¼š æ€»å…±æœ‰ 5 ä¸ªç”³è¯·ï¼Œå…¶ä¸­ 4 ä¸ªæ˜¯ä¸é‡å¤ä¸”è¢«é€šè¿‡çš„å¥½å‹ç”³è¯·ï¼Œæ‰€ä»¥æˆåŠŸç‡æ˜¯ 0.80 ã€‚</p>
<p>è¿›é˜¶:</p>
<p>ä½ èƒ½å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥å¾—åˆ°æ¯ä¸ªæœˆçš„é€šè¿‡ç‡å—ï¼Ÿ<br>ä½ èƒ½æ±‚å‡ºæ¯ä¸€å¤©çš„ç´¯è®¡é€šè¿‡ç‡å—ï¼Ÿ</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">round(</span><br><span class="line">    ifnull(</span><br><span class="line">    (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">distinct</span> requester_id, accepter_id <span class="keyword">from</span> request_accepted) <span class="keyword">as</span> A)</span><br><span class="line">    <span class="operator">/</span></span><br><span class="line">    (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">distinct</span> sender_id, send_to_id <span class="keyword">from</span> friend_request) <span class="keyword">as</span> B),</span><br><span class="line">    <span class="number">0</span>)</span><br><span class="line">, <span class="number">2</span>) <span class="keyword">as</span> accept_rate;</span><br></pre></td></tr></table></figure>



<h4 id="601-ä½“è‚²é¦†çš„äººæµé‡"><a href="#601-ä½“è‚²é¦†çš„äººæµé‡" class="headerlink" title="601. ä½“è‚²é¦†çš„äººæµé‡"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/human-traffic-of-stadium/">601. ä½“è‚²é¦†çš„äººæµé‡</a></h4><p>éš¾åº¦å›°éš¾113æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡å…³æ³¨åé¦ˆ</p>
<p>SQLæ¶æ„</p>
<p>X å¸‚å»ºäº†ä¸€ä¸ªæ–°çš„ä½“è‚²é¦†ï¼Œæ¯æ—¥äººæµé‡ä¿¡æ¯è¢«è®°å½•åœ¨è¿™ä¸‰åˆ—ä¿¡æ¯ä¸­ï¼š<strong>åºå·</strong> (id)ã€<strong>æ—¥æœŸ</strong> (visit_date)ã€ <strong>äººæµé‡</strong> (people)ã€‚</p>
<p>è¯·ç¼–å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œæ‰¾å‡ºäººæµé‡çš„é«˜å³°æœŸã€‚é«˜å³°æœŸæ—¶ï¼Œè‡³å°‘è¿ç»­ä¸‰è¡Œè®°å½•ä¸­çš„äººæµé‡ä¸å°‘äº100ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè¡¨ <code>stadium</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+------+------------+-----------+</span><br><span class="line">| id   | visit_date | people    |</span><br><span class="line">+------+------------+-----------+</span><br><span class="line">| 1    | 2017-01-01 | 10        |</span><br><span class="line">| 2    | 2017-01-02 | 109       |</span><br><span class="line">| 3    | 2017-01-03 | 150       |</span><br><span class="line">| 4    | 2017-01-04 | 99        |</span><br><span class="line">| 5    | 2017-01-05 | 145       |</span><br><span class="line">| 6    | 2017-01-06 | 1455      |</span><br><span class="line">| 7    | 2017-01-07 | 199       |</span><br><span class="line">| 8    | 2017-01-08 | 188       |</span><br><span class="line">+------+------------+-----------+</span><br></pre></td></tr></table></figure>

<p>å¯¹äºä¸Šé¢çš„ç¤ºä¾‹æ•°æ®ï¼Œè¾“å‡ºä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+------+------------+-----------+</span><br><span class="line">| id   | visit_date | people    |</span><br><span class="line">+------+------------+-----------+</span><br><span class="line">| 5    | 2017-01-05 | 145       |</span><br><span class="line">| 6    | 2017-01-06 | 1455      |</span><br><span class="line">| 7    | 2017-01-07 | 199       |</span><br><span class="line">| 8    | 2017-01-08 | 188       |</span><br><span class="line">+------+------------+-----------+ </span><br></pre></td></tr></table></figure>

<p><strong>æç¤ºï¼š</strong><br>æ¯å¤©åªæœ‰ä¸€è¡Œè®°å½•ï¼Œæ—¥æœŸéšç€ id çš„å¢åŠ è€Œå¢åŠ ã€‚</p>
<p>3è¡¨ç›¸è¿(244 ms)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> t1.<span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> stadium t1, stadium t2, stadium t3</span><br><span class="line"><span class="keyword">where</span> t1.people <span class="operator">&gt;=</span> <span class="number">100</span> <span class="keyword">and</span> t2.people <span class="operator">&gt;=</span> <span class="number">100</span> <span class="keyword">and</span> t3.people <span class="operator">&gt;=</span> <span class="number">100</span></span><br><span class="line"><span class="keyword">and</span></span><br><span class="line">(</span><br><span class="line">		(t1.id <span class="operator">-</span> t2.id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">and</span> t1.id <span class="operator">-</span> t3.id <span class="operator">=</span> <span class="number">2</span> <span class="keyword">and</span> t2.id <span class="operator">-</span> t3.id <span class="operator">=</span><span class="number">1</span>)  <span class="comment">-- t1, t2, t3</span></span><br><span class="line">    <span class="keyword">or</span></span><br><span class="line">    (t2.id <span class="operator">-</span> t1.id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">and</span> t2.id <span class="operator">-</span> t3.id <span class="operator">=</span> <span class="number">2</span> <span class="keyword">and</span> t1.id <span class="operator">-</span> t3.id <span class="operator">=</span><span class="number">1</span>) <span class="comment">-- t2, t1, t3</span></span><br><span class="line">    <span class="keyword">or</span></span><br><span class="line">    (t3.id <span class="operator">-</span> t2.id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">and</span> t2.id <span class="operator">-</span> t1.id <span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> t3.id <span class="operator">-</span> t1.id <span class="operator">=</span> <span class="number">2</span>) <span class="comment">-- t3, t2, t1</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> t1.id</span><br></pre></td></tr></table></figure>

<p>çª—å£å‡½æ•°(272 ms)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,visit_date,people <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> id</span><br><span class="line">    ,<span class="built_in">lead</span>(people,<span class="number">1</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> id) ld</span><br><span class="line">    ,<span class="built_in">lead</span>(people,<span class="number">2</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> id) ld2</span><br><span class="line">    ,visit_date</span><br><span class="line">    ,<span class="built_in">lag</span>(people,<span class="number">1</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> id) lg</span><br><span class="line">    ,<span class="built_in">lag</span>(people,<span class="number">2</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> id) lg2</span><br><span class="line">    ,people</span><br><span class="line">    <span class="keyword">from</span> stadium</span><br><span class="line">    ) a</span><br><span class="line"><span class="keyword">where</span> (a.ld<span class="operator">&gt;=</span><span class="number">100</span> <span class="keyword">and</span> a.lg<span class="operator">&gt;=</span><span class="number">100</span> <span class="keyword">and</span> a.people<span class="operator">&gt;=</span><span class="number">100</span>)</span><br><span class="line"><span class="keyword">or</span> (a.ld<span class="operator">&gt;=</span><span class="number">100</span> <span class="keyword">and</span> a.ld2<span class="operator">&gt;=</span><span class="number">100</span> <span class="keyword">and</span> a.people<span class="operator">&gt;=</span><span class="number">100</span>)</span><br><span class="line"><span class="keyword">or</span> (a.lg<span class="operator">&gt;=</span><span class="number">100</span> <span class="keyword">and</span> a.lg2<span class="operator">&gt;=</span><span class="number">100</span> <span class="keyword">and</span> a.people<span class="operator">&gt;=</span><span class="number">100</span>)</span><br></pre></td></tr></table></figure>



<h4 id="602-å¥½å‹ç”³è¯·-II-ï¼šè°æœ‰æœ€å¤šçš„å¥½å‹"><a href="#602-å¥½å‹ç”³è¯·-II-ï¼šè°æœ‰æœ€å¤šçš„å¥½å‹" class="headerlink" title="602. å¥½å‹ç”³è¯· II ï¼šè°æœ‰æœ€å¤šçš„å¥½å‹"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/friend-requests-ii-who-has-the-most-friends/">602. å¥½å‹ç”³è¯· II ï¼šè°æœ‰æœ€å¤šçš„å¥½å‹</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>åœ¨ Facebook æˆ–è€… Twitter è¿™æ ·çš„ç¤¾äº¤åº”ç”¨ä¸­ï¼Œäººä»¬ç»å¸¸ä¼šå‘å¥½å‹ç”³è¯·ä¹Ÿä¼šæ”¶åˆ°å…¶ä»–äººçš„å¥½å‹ç”³è¯·ã€‚</p>
<p>è¡¨ <code>request_accepted</code> å­˜å‚¨äº†æ‰€æœ‰å¥½å‹ç”³è¯·é€šè¿‡çš„æ•°æ®è®°å½•ï¼Œå…¶ä¸­ï¼Œ <strong>requester_id</strong> å’Œ <strong>accepter_id</strong> éƒ½æ˜¯ç”¨æˆ·çš„ç¼–å·ã€‚</p>
<table>
<thead>
<tr>
<th>requester_id</th>
<th>accepter_id</th>
<th>accept_date</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>2</td>
<td>2016_06-03</td>
</tr>
<tr>
<td>1</td>
<td>3</td>
<td>2016-06-08</td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>2016-06-08</td>
</tr>
<tr>
<td>3</td>
<td>4</td>
<td>2016-06-09</td>
</tr>
</tbody></table>
<p>å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œæ±‚å‡ºè°æ‹¥æœ‰æœ€å¤šçš„å¥½å‹å’Œä»–æ‹¥æœ‰çš„å¥½å‹æ•°ç›®ã€‚å¯¹äºä¸Šé¢çš„æ ·ä¾‹æ•°æ®ï¼Œç»“æœä¸ºï¼š</p>
<table>
<thead>
<tr>
<th>id</th>
<th>num</th>
</tr>
</thead>
<tbody><tr>
<td>3</td>
<td>3</td>
</tr>
</tbody></table>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>ä¿è¯æ‹¥æœ‰æœ€å¤šå¥½å‹æ•°ç›®çš„åªæœ‰ 1 ä¸ªäººã€‚</li>
<li>å¥½å‹ç”³è¯·åªä¼šè¢«æ¥å—ä¸€æ¬¡ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰ <strong>requester_id</strong> å’Œ <strong>accepter_id</strong> å€¼éƒ½ç›¸åŒçš„é‡å¤è®°å½•ã€‚</li>
</ul>
<p><strong>è§£é‡Šï¼š</strong></p>
<p>ç¼–å·ä¸º â€˜3â€™ çš„äººæ˜¯ç¼–å·ä¸º â€˜1â€™ï¼Œâ€™2â€™ å’Œ â€˜4â€™ çš„å¥½å‹ï¼Œæ‰€ä»¥ä»–æ€»å…±æœ‰ 3 ä¸ªå¥½å‹ï¼Œæ¯”å…¶ä»–äººéƒ½å¤šã€‚</p>
<p><strong>è¿›é˜¶ï¼š</strong></p>
<p>åœ¨çœŸå®ä¸–ç•Œé‡Œï¼Œå¯èƒ½ä¼šæœ‰å¤šä¸ªäººæ‹¥æœ‰å¥½å‹æ•°ç›¸åŒä¸”æœ€å¤šï¼Œä½ èƒ½æ‰¾åˆ°æ‰€æœ‰è¿™äº›äººå—ï¼Ÿ</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> rid <span class="keyword">as</span> `id`,<span class="built_in">count</span>(aid) <span class="keyword">as</span> `num`</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> R1.requester_id <span class="keyword">as</span> rid,R1.accepter_id <span class="keyword">as</span> aid</span><br><span class="line">    <span class="keyword">from</span> request_accepted <span class="keyword">as</span> R1</span><br><span class="line">    <span class="keyword">UNION</span> <span class="keyword">all</span></span><br><span class="line">    <span class="keyword">select</span> R2.accepter_id <span class="keyword">as</span> rid,R2.requester_id <span class="keyword">as</span> aid</span><br><span class="line">    <span class="keyword">from</span> request_accepted <span class="keyword">as</span> R2</span><br><span class="line">) <span class="keyword">as</span> A</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> rid</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> num <span class="keyword">desc</span></span><br><span class="line">limit <span class="number">0</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure>



<h4 id="603-è¿ç»­ç©ºä½™åº§ä½"><a href="#603-è¿ç»­ç©ºä½™åº§ä½" class="headerlink" title="603. è¿ç»­ç©ºä½™åº§ä½"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/consecutive-available-seats/">603. è¿ç»­ç©ºä½™åº§ä½</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>å‡ ä¸ªæœ‹å‹æ¥åˆ°ç”µå½±é™¢çš„å”®ç¥¨å¤„ï¼Œå‡†å¤‡é¢„çº¦è¿ç»­ç©ºä½™åº§ä½ã€‚</p>
<p>ä½ èƒ½åˆ©ç”¨è¡¨ <code>cinema</code> ï¼Œå¸®ä»–ä»¬å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œè·å–æ‰€æœ‰ç©ºä½™åº§ä½ï¼Œå¹¶å°†å®ƒä»¬æŒ‰ç…§ seat_id æ’åºåè¿”å›å—ï¼Ÿ</p>
<table>
<thead>
<tr>
<th>seat_id</th>
<th>free</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>0</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
</tr>
<tr>
<td>4</td>
<td>1</td>
</tr>
<tr>
<td>5</td>
<td>1</td>
</tr>
</tbody></table>
<p>å¯¹äºå¦‚ä¸Šæ ·ä¾‹ï¼Œä½ çš„æŸ¥è¯¢è¯­å¥åº”è¯¥è¿”å›å¦‚ä¸‹ç»“æœã€‚</p>
<table>
<thead>
<tr>
<th>seat_id</th>
</tr>
</thead>
<tbody><tr>
<td>3</td>
</tr>
<tr>
<td>4</td>
</tr>
<tr>
<td>5</td>
</tr>
</tbody></table>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>seat_id å­—æ®µæ˜¯ä¸€ä¸ªè‡ªå¢çš„æ•´æ•°ï¼Œfree å­—æ®µæ˜¯å¸ƒå°”ç±»å‹ï¼ˆâ€™1â€™ è¡¨ç¤ºç©ºä½™ï¼Œ â€˜0â€™ è¡¨ç¤ºå·²è¢«å æ®ï¼‰ã€‚</li>
<li>è¿ç»­ç©ºä½™åº§ä½çš„å®šä¹‰æ˜¯å¤§äºç­‰äº 2 ä¸ªè¿ç»­ç©ºä½™çš„åº§ä½ã€‚</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> seat_id</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span> seat_id,</span><br><span class="line"><span class="built_in">lag</span>(seat_id,<span class="number">1</span>,<span class="number">-99</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> seat_id) ls,</span><br><span class="line"><span class="built_in">lead</span>(seat_id,<span class="number">1</span>,<span class="number">-99</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> seat_id) rs</span><br><span class="line"><span class="keyword">from</span> cinema</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">free</span><span class="operator">=</span><span class="number">1</span></span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span>  seat_id<span class="operator">-</span>ls <span class="operator">=</span> <span class="number">1</span> <span class="keyword">or</span> rs<span class="operator">-</span>seat_id <span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<h4 id="607-é”€å”®å‘˜"><a href="#607-é”€å”®å‘˜" class="headerlink" title="607. é”€å”®å‘˜"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/sales-person/">607. é”€å”®å‘˜</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p><strong>æè¿°</strong></p>
<p>ç»™å®š 3 ä¸ªè¡¨ï¼š <code>salesperson</code>ï¼Œ <code>company</code>ï¼Œ <code>orders</code>ã€‚<br>è¾“å‡ºæ‰€æœ‰è¡¨ <code>salesperson</code> ä¸­ï¼Œæ²¡æœ‰å‘å…¬å¸ â€˜REDâ€™ é”€å”®ä»»ä½•ä¸œè¥¿çš„é”€å”®å‘˜ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š</strong><br><strong>è¾“å…¥</strong></p>
<p>è¡¨ï¼š <code>salesperson</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+----------+------+--------+-----------------+-----------+</span><br><span class="line">| sales_id | name | salary | commission_rate | hire_date |</span><br><span class="line">+----------+------+--------+-----------------+-----------+</span><br><span class="line">|   1      | John | 100000 |     6           | 4/1/2006  |</span><br><span class="line">|   2      | Amy  | 120000 |     5           | 5/1/2010  |</span><br><span class="line">|   3      | Mark | 65000  |     12          | 12/25/2008|</span><br><span class="line">|   4      | Pam  | 25000  |     25          | 1/1/2005  |</span><br><span class="line">|   5      | Alex | 50000  |     10          | 2/3/2007  |</span><br><span class="line">+----------+------+--------+-----------------+-----------+</span><br></pre></td></tr></table></figure>

<p>è¡¨ <code>salesperson</code> å­˜å‚¨äº†æ‰€æœ‰é”€å”®å‘˜çš„ä¿¡æ¯ã€‚æ¯ä¸ªé”€å”®å‘˜éƒ½æœ‰ä¸€ä¸ªé”€å”®å‘˜ç¼–å· <strong>sales_id</strong> å’Œä»–çš„åå­— <strong>name</strong> ã€‚</p>
<p>è¡¨ï¼š <code>company</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------+--------+------------+</span><br><span class="line">| com_id  |  name  |    city    |</span><br><span class="line">+---------+--------+------------+</span><br><span class="line">|   1     |  RED   |   Boston   |</span><br><span class="line">|   2     | ORANGE |   New York |</span><br><span class="line">|   3     | YELLOW |   Boston   |</span><br><span class="line">|   4     | GREEN  |   Austin   |</span><br><span class="line">+---------+--------+------------+</span><br></pre></td></tr></table></figure>

<p>è¡¨ <code>company</code> å­˜å‚¨äº†æ‰€æœ‰å…¬å¸çš„ä¿¡æ¯ã€‚æ¯ä¸ªå…¬å¸éƒ½æœ‰ä¸€ä¸ªå…¬å¸ç¼–å· <strong>com_id</strong> å’Œå®ƒçš„åå­— <strong>name</strong> ã€‚</p>
<p>è¡¨ï¼š <code>orders</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----------+------------+---------+----------+--------+</span><br><span class="line">| order_id | order_date | com_id  | sales_id | amount |</span><br><span class="line">+----------+------------+---------+----------+--------+</span><br><span class="line">| 1        |   1/1/2014 |    3    |    4     | 100000 |</span><br><span class="line">| 2        |   2/1/2014 |    4    |    5     | 5000   |</span><br><span class="line">| 3        |   3/1/2014 |    1    |    1     | 50000  |</span><br><span class="line">| 4        |   4/1/2014 |    1    |    4     | 25000  |</span><br><span class="line">+----------+----------+---------+----------+--------+</span><br></pre></td></tr></table></figure>

<p>è¡¨ <code>orders</code> å­˜å‚¨äº†æ‰€æœ‰çš„é”€å”®æ•°æ®ï¼ŒåŒ…æ‹¬é”€å”®å‘˜ç¼–å· <strong>sales_id</strong> å’Œå…¬å¸ç¼–å· <strong>com_id</strong> ã€‚</p>
<p><strong>è¾“å‡º</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+------+</span><br><span class="line">| name | </span><br><span class="line">+------+</span><br><span class="line">| Amy  | </span><br><span class="line">| Mark | </span><br><span class="line">| Alex |</span><br><span class="line">+------+</span><br></pre></td></tr></table></figure>

<p><strong>è§£é‡Š</strong></p>
<p>æ ¹æ®è¡¨ <code>orders</code> ä¸­çš„è®¢å• â€˜3â€™ å’Œ â€˜4â€™ ï¼Œå®¹æ˜“çœ‹å‡ºåªæœ‰ â€˜Johnâ€™ å’Œ â€˜Pamâ€™ ä¸¤ä¸ªé”€å”®å‘˜æ›¾ç»å‘å…¬å¸ â€˜REDâ€™ é”€å”®è¿‡ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦è¾“å‡ºè¡¨ <code>salesperson</code> ä¸­æ‰€æœ‰å…¶ä»–äººçš„åå­—ã€‚\</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name</span><br><span class="line"><span class="keyword">from</span> salesperson</span><br><span class="line"><span class="keyword">where</span> sales_id <span class="keyword">not</span> <span class="keyword">in</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> sales_id</span><br><span class="line">    <span class="keyword">from</span> orders</span><br><span class="line">    <span class="keyword">where</span> com_id <span class="operator">=</span></span><br><span class="line">            (</span><br><span class="line">            <span class="keyword">select</span> com_id </span><br><span class="line">            <span class="keyword">from</span> company</span><br><span class="line">            <span class="keyword">where</span> name <span class="operator">=</span><span class="string">&#x27;RED&#x27;</span></span><br><span class="line">            )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<h4 id="608-æ ‘èŠ‚ç‚¹"><a href="#608-æ ‘èŠ‚ç‚¹" class="headerlink" title="608. æ ‘èŠ‚ç‚¹"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/tree-node/">608. æ ‘èŠ‚ç‚¹</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>ç»™å®šä¸€ä¸ªè¡¨ <code>tree</code>ï¼Œ<strong>id</strong> æ˜¯æ ‘èŠ‚ç‚¹çš„ç¼–å·ï¼Œ <strong>p_id</strong> æ˜¯å®ƒçˆ¶èŠ‚ç‚¹çš„ <strong>id ã€‚</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+----+------+</span><br><span class="line">| id | p_id |</span><br><span class="line">+----+------+</span><br><span class="line">| 1  | null |</span><br><span class="line">| 2  | 1    |</span><br><span class="line">| 3  | 1    |</span><br><span class="line">| 4  | 2    |</span><br><span class="line">| 5  | 2    |</span><br><span class="line">+----+------+</span><br></pre></td></tr></table></figure>

<p>æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹å±äºä»¥ä¸‹ä¸‰ç§ç±»å‹ä¹‹ä¸€ï¼š</p>
<ul>
<li>å¶å­ï¼šå¦‚æœè¿™ä¸ªèŠ‚ç‚¹æ²¡æœ‰ä»»ä½•å­©å­èŠ‚ç‚¹ã€‚</li>
<li>æ ¹ï¼šå¦‚æœè¿™ä¸ªèŠ‚ç‚¹æ˜¯æ•´æ£µæ ‘çš„æ ¹ï¼Œå³æ²¡æœ‰çˆ¶èŠ‚ç‚¹ã€‚</li>
<li>å†…éƒ¨èŠ‚ç‚¹ï¼šå¦‚æœè¿™ä¸ªèŠ‚ç‚¹æ—¢ä¸æ˜¯å¶å­èŠ‚ç‚¹ä¹Ÿä¸æ˜¯æ ¹èŠ‚ç‚¹ã€‚</li>
</ul>
<p>å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œè¾“å‡ºæ‰€æœ‰èŠ‚ç‚¹çš„ç¼–å·å’ŒèŠ‚ç‚¹çš„ç±»å‹ï¼Œå¹¶å°†ç»“æœæŒ‰ç…§èŠ‚ç‚¹ç¼–å·æ’åºã€‚ä¸Šé¢æ ·ä¾‹çš„ç»“æœä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+----+------+</span><br><span class="line">| id | Type |</span><br><span class="line">+----+------+</span><br><span class="line">| 1  | Root |</span><br><span class="line">| 2  | Inner|</span><br><span class="line">| 3  | Leaf |</span><br><span class="line">| 4  | Leaf |</span><br><span class="line">| 5  | Leaf |</span><br><span class="line">+----+------+</span><br></pre></td></tr></table></figure>

<p><strong>è§£é‡Š</strong></p>
<ul>
<li><p>èŠ‚ç‚¹ â€˜1â€™ æ˜¯æ ¹èŠ‚ç‚¹ï¼Œå› ä¸ºå®ƒçš„çˆ¶èŠ‚ç‚¹æ˜¯ NULL ï¼ŒåŒæ—¶å®ƒæœ‰å­©å­èŠ‚ç‚¹ â€˜2â€™ å’Œ â€˜3â€™ ã€‚</p>
</li>
<li><p>èŠ‚ç‚¹ â€˜2â€™ æ˜¯å†…éƒ¨èŠ‚ç‚¹ï¼Œå› ä¸ºå®ƒæœ‰çˆ¶èŠ‚ç‚¹ â€˜1â€™ ï¼Œä¹Ÿæœ‰å­©å­èŠ‚ç‚¹ â€˜4â€™ å’Œ â€˜5â€™ ã€‚</p>
</li>
<li><p>èŠ‚ç‚¹ â€˜3â€™, â€˜4â€™ å’Œ â€˜5â€™ éƒ½æ˜¯å¶å­èŠ‚ç‚¹ï¼Œå› ä¸ºå®ƒä»¬éƒ½æœ‰çˆ¶èŠ‚ç‚¹åŒæ—¶æ²¡æœ‰å­©å­èŠ‚ç‚¹ã€‚</p>
</li>
<li><p>æ ·ä¾‹ä¸­æ ‘çš„å½¢æ€å¦‚ä¸‹ï¼š </p>
<p>â€‹              1<br>â€‹            /   <br>â€‹          2       3<br>â€‹        /   <br>â€‹     4       5</p>
</li>
</ul>
<p><strong>æ³¨æ„</strong></p>
<p>å¦‚æœæ ‘ä¸­åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä½ åªéœ€è¦è¾“å‡ºå®ƒçš„æ ¹å±æ€§ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,</span><br><span class="line">    (<span class="keyword">case</span> <span class="keyword">when</span> p_id <span class="keyword">is</span> <span class="keyword">null</span> <span class="keyword">then</span> &quot;Root&quot;</span><br><span class="line">    <span class="keyword">when</span> id <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> ifnull(p_id,<span class="number">0</span>) <span class="keyword">from</span> tree) <span class="keyword">then</span> &quot;Leaf&quot;</span><br><span class="line">    <span class="keyword">else</span> &quot;Inner&quot; <span class="keyword">end</span>)  Type</span><br><span class="line"><span class="keyword">from</span> tree</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="610-åˆ¤æ–­ä¸‰è§’å½¢"><a href="#610-åˆ¤æ–­ä¸‰è§’å½¢" class="headerlink" title="610. åˆ¤æ–­ä¸‰è§’å½¢"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/triangle-judgement/">610. åˆ¤æ–­ä¸‰è§’å½¢</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>ä¸€ä¸ªå°å­¦ç”Ÿ Tim çš„ä½œä¸šæ˜¯åˆ¤æ–­ä¸‰æ¡çº¿æ®µæ˜¯å¦èƒ½å½¢æˆä¸€ä¸ªä¸‰è§’å½¢ã€‚</p>
<p>ç„¶è€Œï¼Œè¿™ä¸ªä½œä¸šéå¸¸ç¹é‡ï¼Œå› ä¸ºæœ‰å‡ ç™¾ç»„çº¿æ®µéœ€è¦åˆ¤æ–­ã€‚</p>
<p>å‡è®¾è¡¨ <code>triangle</code> ä¿å­˜äº†æ‰€æœ‰ä¸‰æ¡çº¿æ®µçš„ä¸‰å…ƒç»„ x, y, z ï¼Œä½ èƒ½å¸® Tim å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œæ¥åˆ¤æ–­æ¯ä¸ªä¸‰å…ƒç»„æ˜¯å¦å¯ä»¥ç»„æˆä¸€ä¸ªä¸‰è§’å½¢å—ï¼Ÿ</p>
<table>
<thead>
<tr>
<th>x</th>
<th>y</th>
<th>z</th>
</tr>
</thead>
<tbody><tr>
<td>13</td>
<td>15</td>
<td>30</td>
</tr>
<tr>
<td>10</td>
<td>20</td>
<td>15</td>
</tr>
</tbody></table>
<p>å¯¹äºå¦‚ä¸Šæ ·ä¾‹æ•°æ®ï¼Œä½ çš„æŸ¥è¯¢è¯­å¥åº”è¯¥è¿”å›å¦‚ä¸‹ç»“æœï¼š</p>
<table>
<thead>
<tr>
<th>x</th>
<th>y</th>
<th>z</th>
<th>triangle</th>
</tr>
</thead>
<tbody><tr>
<td>13</td>
<td>15</td>
<td>30</td>
<td>No</td>
</tr>
<tr>
<td>10</td>
<td>20</td>
<td>15</td>
<td>Yes</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> x,y,z, </span><br><span class="line">if(x<span class="operator">+</span>y<span class="operator">&gt;</span>z <span class="operator">&amp;&amp;</span> x<span class="operator">+</span>z<span class="operator">&gt;</span>y <span class="operator">&amp;&amp;</span> y<span class="operator">+</span>z<span class="operator">&gt;</span>x,<span class="string">&#x27;Yes&#x27;</span>,<span class="string">&#x27;No&#x27;</span>) triangle</span><br><span class="line"><span class="keyword">from</span> triangle</span><br></pre></td></tr></table></figure>



<h4 id="612-å¹³é¢ä¸Šçš„æœ€è¿‘è·ç¦»"><a href="#612-å¹³é¢ä¸Šçš„æœ€è¿‘è·ç¦»" class="headerlink" title="612. å¹³é¢ä¸Šçš„æœ€è¿‘è·ç¦»"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/shortest-distance-in-a-plane/">612. å¹³é¢ä¸Šçš„æœ€è¿‘è·ç¦»</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>è¡¨ <code>point_2d</code> ä¿å­˜äº†æ‰€æœ‰ç‚¹ï¼ˆå¤šäº 2 ä¸ªç‚¹ï¼‰çš„åæ ‡ (x,y) ï¼Œè¿™äº›ç‚¹åœ¨å¹³é¢ä¸Šä¸¤ä¸¤ä¸é‡åˆã€‚</p>
<p>å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥æ‰¾åˆ°ä¸¤ç‚¹ä¹‹é—´çš„æœ€è¿‘è·ç¦»ï¼Œä¿ç•™ 2 ä½å°æ•°ã€‚</p>
<table>
<thead>
<tr>
<th>x</th>
<th>y</th>
</tr>
</thead>
<tbody><tr>
<td>-1</td>
<td>-1</td>
</tr>
<tr>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>-1</td>
<td>-2</td>
</tr>
</tbody></table>
<p>æœ€è¿‘è·ç¦»åœ¨ç‚¹ (-1,-1) å’Œ(-1,2) ä¹‹é—´ï¼Œè·ç¦»ä¸º 1.00 ã€‚æ‰€ä»¥è¾“å‡ºåº”è¯¥ä¸ºï¼š </p>
<table>
<thead>
<tr>
<th>shortest</th>
</tr>
</thead>
<tbody><tr>
<td>1.00</td>
</tr>
</tbody></table>
<p><strong>æ³¨æ„ï¼š</strong>ä»»æ„ç‚¹ä¹‹é—´çš„æœ€è¿œè·ç¦»å°äº 10000 ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    ROUND(<span class="built_in">SQRT</span>(<span class="built_in">MIN</span>((POW(p1.x <span class="operator">-</span> p2.x, <span class="number">2</span>) <span class="operator">+</span> POW(p1.y <span class="operator">-</span> p2.y, <span class="number">2</span>)))), <span class="number">2</span>) <span class="keyword">AS</span> shortest</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    point_2d p1</span><br><span class="line">        <span class="keyword">JOIN</span></span><br><span class="line">    point_2d p2 <span class="keyword">ON</span> p1.x <span class="operator">!=</span> p2.x <span class="keyword">OR</span> p1.y <span class="operator">!=</span> p2.y</span><br></pre></td></tr></table></figure>

<p>ä¼˜åŒ– ï¼šå‡å°‘é‡å¤è®¡ç®—</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    ROUND(<span class="built_in">SQRT</span>(<span class="built_in">MIN</span>((POW(p1.x <span class="operator">-</span> p2.x, <span class="number">2</span>) <span class="operator">+</span> POW(p1.y <span class="operator">-</span> p2.y, <span class="number">2</span>)))),<span class="number">2</span>) <span class="keyword">AS</span> shortest</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    point_2d p1</span><br><span class="line">        <span class="keyword">JOIN</span></span><br><span class="line">    point_2d p2 <span class="keyword">ON</span> (p1.x <span class="operator">&lt;=</span> p2.x <span class="keyword">AND</span> p1.y <span class="operator">&lt;</span> p2.y)</span><br><span class="line">        <span class="keyword">OR</span> (p1.x <span class="operator">&lt;=</span> p2.x <span class="keyword">AND</span> p1.y <span class="operator">&gt;</span> p2.y)</span><br><span class="line">        <span class="keyword">OR</span> (p1.x <span class="operator">&lt;</span> p2.x <span class="keyword">AND</span> p1.y <span class="operator">=</span> p2.y)</span><br></pre></td></tr></table></figure>

<h4 id="613-ç›´çº¿ä¸Šçš„æœ€è¿‘è·ç¦»"><a href="#613-ç›´çº¿ä¸Šçš„æœ€è¿‘è·ç¦»" class="headerlink" title="613. ç›´çº¿ä¸Šçš„æœ€è¿‘è·ç¦»"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/shortest-distance-in-a-line/">613. ç›´çº¿ä¸Šçš„æœ€è¿‘è·ç¦»</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>è¡¨ <code>point</code> ä¿å­˜äº†ä¸€äº›ç‚¹åœ¨ x è½´ä¸Šçš„åæ ‡ï¼Œè¿™äº›åæ ‡éƒ½æ˜¯æ•´æ•°ã€‚</p>
<p>å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œæ‰¾åˆ°è¿™äº›ç‚¹ä¸­æœ€è¿‘ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»ã€‚</p>
<table>
<thead>
<tr>
<th>x</th>
</tr>
</thead>
<tbody><tr>
<td>-1</td>
</tr>
<tr>
<td>0</td>
</tr>
<tr>
<td>2</td>
</tr>
</tbody></table>
<p>æœ€è¿‘è·ç¦»æ˜¾ç„¶æ˜¯ â€˜1â€™ ï¼Œæ˜¯ç‚¹ â€˜-1â€™ å’Œ â€˜0â€™ ä¹‹é—´çš„è·ç¦»ã€‚æ‰€ä»¥è¾“å‡ºåº”è¯¥å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>shortest</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
</tr>
</tbody></table>
<p><strong>æ³¨æ„ï¼š</strong>æ¯ä¸ªç‚¹éƒ½ä¸å…¶ä»–ç‚¹åæ ‡ä¸åŒï¼Œè¡¨ <code>table</code> ä¸ä¼šæœ‰é‡å¤åæ ‡å‡ºç°ã€‚</p>
<p><strong>è¿›é˜¶ï¼š</strong>å¦‚æœè¿™äº›ç‚¹åœ¨ x è½´ä¸Šä»å·¦åˆ°å³éƒ½æœ‰ä¸€ä¸ªç¼–å·ï¼Œè¾“å‡ºç»“æœæ—¶éœ€è¦è¾“å‡ºæœ€è¿‘ç‚¹å¯¹çš„ç¼–å·å‘¢ï¼Ÿ</p>
<p> å¼€çª—æ–¹æ³• 178m</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">min</span>(l<span class="operator">-</span>x) shortest</span><br><span class="line"><span class="keyword">from</span>( </span><br><span class="line"><span class="keyword">select</span> x,<span class="built_in">lead</span>(x,<span class="number">1</span>,<span class="keyword">null</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> x) l</span><br><span class="line"><span class="keyword">from</span> point</span><br><span class="line">)t1</span><br></pre></td></tr></table></figure>

<p>joinæ–¹æ³• 268m</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="built_in">MIN</span>(<span class="built_in">ABS</span>(p1.x <span class="operator">-</span> p2.x)) <span class="keyword">AS</span> shortest</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    point p1</span><br><span class="line">        <span class="keyword">JOIN</span></span><br><span class="line">    point p2 <span class="keyword">ON</span> p1.x <span class="operator">!=</span> p2.x</span><br><span class="line">;</span><br></pre></td></tr></table></figure>





<h4 id="614-äºŒçº§å…³æ³¨è€…"><a href="#614-äºŒçº§å…³æ³¨è€…" class="headerlink" title="614. äºŒçº§å…³æ³¨è€…"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/second-degree-follower/">614. äºŒçº§å…³æ³¨è€…</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>åœ¨ facebook ä¸­ï¼Œè¡¨ <code>follow</code> ä¼šæœ‰ 2 ä¸ªå­—æ®µï¼š <strong>followee</strong>, <strong>follower</strong> ï¼Œåˆ†åˆ«è¡¨ç¤ºè¢«å…³æ³¨è€…å’Œå…³æ³¨è€…ã€‚</p>
<p>è¯·å†™ä¸€ä¸ª sql æŸ¥è¯¢è¯­å¥ï¼Œå¯¹æ¯ä¸€ä¸ªå…³æ³¨è€…ï¼ŒæŸ¥è¯¢å…³æ³¨ä»–çš„å…³æ³¨è€…çš„æ•°ç›®ã€‚</p>
<p>æ¯”æ–¹è¯´ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+------------+</span><br><span class="line">| followee    | follower   |</span><br><span class="line">+-------------+------------+</span><br><span class="line">|     A       |     B      |</span><br><span class="line">|     B       |     C      |</span><br><span class="line">|     B       |     D      |</span><br><span class="line">|     D       |     E      |</span><br><span class="line">+-------------+------------+</span><br></pre></td></tr></table></figure>

<p>åº”è¯¥è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+-------------+------------+</span><br><span class="line">| follower    | num        |</span><br><span class="line">+-------------+------------+</span><br><span class="line">|     B       |  2         |</span><br><span class="line">|     D       |  1         |</span><br><span class="line">+-------------+------------+</span><br></pre></td></tr></table></figure>

<p><strong>è§£é‡Šï¼š</strong></p>
<p>B å’Œ D éƒ½åœ¨åœ¨ <strong>follower</strong> å­—æ®µä¸­å‡ºç°ï¼Œä½œä¸ºè¢«å…³æ³¨è€…ï¼ŒB è¢« C å’Œ D å…³æ³¨ï¼ŒD è¢« E å…³æ³¨ã€‚A ä¸åœ¨ <strong>follower</strong> å­—æ®µå†…ï¼Œæ‰€ä»¥Aä¸åœ¨è¾“å‡ºåˆ—è¡¨ä¸­ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>è¢«å…³æ³¨è€…æ°¸è¿œä¸ä¼šè¢«ä»– / å¥¹è‡ªå·±å…³æ³¨ã€‚</li>
<li>å°†ç»“æœæŒ‰ç…§å­—å…¸åºè¿”å›ã€‚</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> followee follower,<span class="built_in">count</span>(<span class="keyword">distinct</span> follower) num</span><br><span class="line"><span class="keyword">from</span> follow</span><br><span class="line"><span class="keyword">where</span> followee  <span class="keyword">in</span> (</span><br><span class="line">    <span class="keyword">select</span> follower</span><br><span class="line">    <span class="keyword">from</span> follow</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> follower</span><br><span class="line">)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> followee</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> follower </span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿™é‡Œå‡ºç°äº†é‡å¤å…³æ³¨ ï¼Œéœ€è¦å»é‡</p>
</blockquote>
<h4 id="615-å¹³å‡å·¥èµ„ï¼šéƒ¨é—¨ä¸å…¬å¸æ¯”è¾ƒ"><a href="#615-å¹³å‡å·¥èµ„ï¼šéƒ¨é—¨ä¸å…¬å¸æ¯”è¾ƒ" class="headerlink" title="615. å¹³å‡å·¥èµ„ï¼šéƒ¨é—¨ä¸å…¬å¸æ¯”è¾ƒ"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/average-salary-departments-vs-company/">615. å¹³å‡å·¥èµ„ï¼šéƒ¨é—¨ä¸å…¬å¸æ¯”è¾ƒ</a></h4><p>éš¾åº¦å›°éš¾</p>
<p>SQLæ¶æ„</p>
<p>ç»™å¦‚ä¸‹ä¸¤ä¸ªè¡¨ï¼Œå†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œæ±‚å‡ºåœ¨æ¯ä¸€ä¸ªå·¥èµ„å‘æ”¾æ—¥ï¼Œæ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„ä¸å…¬å¸çš„å¹³å‡å·¥èµ„çš„æ¯”è¾ƒç»“æœ ï¼ˆé«˜ / ä½ / ç›¸åŒï¼‰ã€‚</p>
<p>è¡¨ï¼š <code>salary</code></p>
<table>
<thead>
<tr>
<th>id</th>
<th>employee_id</th>
<th>amount</th>
<th>pay_date</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
<td>9000</td>
<td>2017-03-31</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>6000</td>
<td>2017-03-31</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
<td>10000</td>
<td>2017-03-31</td>
</tr>
<tr>
<td>4</td>
<td>1</td>
<td>7000</td>
<td>2017-02-28</td>
</tr>
<tr>
<td>5</td>
<td>2</td>
<td>6000</td>
<td>2017-02-28</td>
</tr>
<tr>
<td>6</td>
<td>3</td>
<td>8000</td>
<td>2017-02-28</td>
</tr>
</tbody></table>
<p><strong>employee_id</strong> å­—æ®µæ˜¯è¡¨ <code>employee</code> ä¸­ <strong>employee_id</strong> å­—æ®µçš„å¤–é”®ã€‚</p>
<table>
<thead>
<tr>
<th>employee_id</th>
<th>department_id</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
</tr>
</tbody></table>
<p>å¯¹äºå¦‚ä¸Šæ ·ä¾‹æ•°æ®ï¼Œç»“æœä¸ºï¼š</p>
<table>
<thead>
<tr>
<th>pay_month</th>
<th>department_id</th>
<th>comparison</th>
</tr>
</thead>
<tbody><tr>
<td>2017-03</td>
<td>1</td>
<td>higher</td>
</tr>
<tr>
<td>2017-03</td>
<td>2</td>
<td>lower</td>
</tr>
<tr>
<td>2017-02</td>
<td>1</td>
<td>same</td>
</tr>
<tr>
<td>2017-02</td>
<td>2</td>
<td>same</td>
</tr>
</tbody></table>
<p><strong>è§£é‡Š</strong></p>
<p>åœ¨ä¸‰æœˆï¼Œå…¬å¸çš„å¹³å‡å·¥èµ„æ˜¯ (9000+6000+10000)/3 = 8333.33â€¦</p>
<p>ç”±äºéƒ¨é—¨ â€˜1â€™ é‡Œåªæœ‰ä¸€ä¸ª <strong>employee_id</strong> ä¸º â€˜1â€™ çš„å‘˜å·¥ï¼Œæ‰€ä»¥éƒ¨é—¨ â€˜1â€™ çš„å¹³å‡å·¥èµ„å°±æ˜¯æ­¤äººçš„å·¥èµ„ 9000 ã€‚å› ä¸º 9000 &gt; 8333.33 ï¼Œæ‰€ä»¥æ¯”è¾ƒç»“æœæ˜¯ â€˜higherâ€™ã€‚</p>
<p>ç¬¬äºŒä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„ä¸º <strong>employee_id</strong> ä¸º â€˜2â€™ å’Œ â€˜3â€™ ä¸¤ä¸ªäººçš„å¹³å‡å·¥èµ„ï¼Œä¸º (6000+10000)/2=8000 ã€‚å› ä¸º 8000 &lt; 8333.33 ï¼Œæ‰€ä»¥æ¯”è¾ƒç»“æœæ˜¯ â€˜lowerâ€™ ã€‚</p>
<p>åœ¨äºŒæœˆç”¨åŒæ ·çš„å…¬å¼æ±‚å¹³å‡å·¥èµ„å¹¶æ¯”è¾ƒï¼Œæ¯”è¾ƒç»“æœä¸º â€˜sameâ€™ ï¼Œå› ä¸ºéƒ¨é—¨ â€˜1â€™ å’Œéƒ¨é—¨ â€˜2â€™ çš„å¹³å‡å·¥èµ„ä¸å…¬å¸çš„å¹³å‡å·¥èµ„ç›¸åŒï¼Œéƒ½æ˜¯ 7000 ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    pay_month,</span><br><span class="line">    department_id,</span><br><span class="line">     (<span class="keyword">case</span> <span class="keyword">when</span> avgs<span class="operator">&gt;</span>ts <span class="keyword">then</span> <span class="string">&#x27;higher&#x27;</span></span><br><span class="line">            <span class="keyword">when</span> avgs<span class="operator">&lt;</span>ts <span class="keyword">then</span> <span class="string">&#x27;lower&#x27;</span></span><br><span class="line">            <span class="keyword">else</span> <span class="string">&#x27;same&#x27;</span> <span class="keyword">end</span>) <span class="keyword">as</span> comparison</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> </span><br><span class="line">        date_format(pay_date,<span class="string">&#x27;%Y-%m&#x27;</span>)pay_month,</span><br><span class="line">        department_id,</span><br><span class="line">        <span class="built_in">avg</span>(amount) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> date_format(pay_date,<span class="string">&#x27;%Y-%m&#x27;</span>) )ts,</span><br><span class="line">        <span class="built_in">avg</span>(amount) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> date_format(pay_date,<span class="string">&#x27;%Y-%m&#x27;</span>),department_id) avgs</span><br><span class="line">    <span class="keyword">from</span> salary s</span><br><span class="line">    <span class="keyword">left</span> <span class="keyword">join</span> employee e</span><br><span class="line">    <span class="keyword">on</span> s.employee_id <span class="operator">=</span> e.employee_id</span><br><span class="line">   </span><br><span class="line">)t1</span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> pay_month, department_id</span><br></pre></td></tr></table></figure>



<blockquote>
<p>ä¹Ÿå¯ä»¥ç”¨if</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IF(avgs<span class="operator">&gt;</span>ts,<span class="string">&#x27;higher&#x27;</span>,IF(avgs<span class="operator">=</span>ts,<span class="string">&#x27;same&#x27;</span>,<span class="string">&#x27;lower&#x27;</span>)) <span class="keyword">AS</span> comparison</span><br></pre></td></tr></table></figure>

<h4 id="618-å­¦ç”Ÿåœ°ç†ä¿¡æ¯æŠ¥å‘Š"><a href="#618-å­¦ç”Ÿåœ°ç†ä¿¡æ¯æŠ¥å‘Š" class="headerlink" title="618. å­¦ç”Ÿåœ°ç†ä¿¡æ¯æŠ¥å‘Š"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/students-report-by-geography/">618. å­¦ç”Ÿåœ°ç†ä¿¡æ¯æŠ¥å‘Š</a></h4><p>éš¾åº¦å›°éš¾</p>
<p>SQLæ¶æ„</p>
<p>ä¸€æ‰€ç¾å›½å¤§å­¦æœ‰æ¥è‡ªäºšæ´²ã€æ¬§æ´²å’Œç¾æ´²çš„å­¦ç”Ÿï¼Œä»–ä»¬çš„åœ°ç†ä¿¡æ¯å­˜æ”¾åœ¨å¦‚ä¸‹ <code>student</code> è¡¨ä¸­ã€‚</p>
<table>
<thead>
<tr>
<th>name</th>
<th>continent</th>
</tr>
</thead>
<tbody><tr>
<td>Jack</td>
<td>America</td>
</tr>
<tr>
<td>Pascal</td>
<td>Europe</td>
</tr>
<tr>
<td>Xi</td>
<td>Asia</td>
</tr>
<tr>
<td>Jane</td>
<td>America</td>
</tr>
</tbody></table>
<p>å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥å®ç°å¯¹å¤§æ´²ï¼ˆcontinentï¼‰åˆ—çš„ <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E9%80%8F%E8%A7%86%E8%A1%A8">é€è§†è¡¨</a> æ“ä½œï¼Œä½¿å¾—æ¯ä¸ªå­¦ç”ŸæŒ‰ç…§å§“åçš„å­—æ¯é¡ºåºä¾æ¬¡æ’åˆ—åœ¨å¯¹åº”çš„å¤§æ´²ä¸‹é¢ã€‚è¾“å‡ºçš„æ ‡é¢˜åº”ä¾æ¬¡ä¸ºç¾æ´²ï¼ˆAmericaï¼‰ã€äºšæ´²ï¼ˆAsiaï¼‰å’Œæ¬§æ´²ï¼ˆEuropeï¼‰ã€‚æ•°æ®ä¿è¯æ¥è‡ªç¾æ´²çš„å­¦ç”Ÿä¸å°‘äºæ¥è‡ªäºšæ´²æˆ–è€…æ¬§æ´²çš„å­¦ç”Ÿã€‚</p>
<p>å¯¹äºæ ·ä¾‹è¾“å…¥ï¼Œå®ƒçš„å¯¹åº”è¾“å‡ºæ˜¯ï¼š</p>
<table>
<thead>
<tr>
<th>America</th>
<th>Asia</th>
<th>Europe</th>
</tr>
</thead>
<tbody><tr>
<td>Jack</td>
<td>Xi</td>
<td>Pascal</td>
</tr>
<tr>
<td>Jane</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><strong>è¿›é˜¶ï¼š</strong>å¦‚æœä¸èƒ½ç¡®å®šå“ªä¸ªå¤§æ´²çš„å­¦ç”Ÿæ•°æœ€å¤šï¼Œä½ å¯ä»¥å†™å‡ºä¸€ä¸ªæŸ¥è¯¢å»ç”Ÿæˆä¸Šè¿°å­¦ç”ŸæŠ¥å‘Šå—ï¼Ÿ</p>
<p>å¼€çª—</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line"><span class="built_in">max</span>(if(continent<span class="operator">=</span><span class="string">&#x27;America&#x27;</span>,name,<span class="keyword">null</span>)) America,</span><br><span class="line"><span class="built_in">max</span>(if(continent<span class="operator">=</span><span class="string">&#x27;Asia&#x27;</span>,name,<span class="keyword">null</span>)) Asia,</span><br><span class="line"><span class="built_in">max</span>(if(continent<span class="operator">=</span><span class="string">&#x27;Europe&#x27;</span>,name,<span class="keyword">null</span>)) Europe</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">    (<span class="keyword">select</span> <span class="operator">*</span>, <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> continent <span class="keyword">order</span> <span class="keyword">by</span> name) rk</span><br><span class="line">    <span class="keyword">from</span> student) t</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> rk</span><br></pre></td></tr></table></figure>



<p>å˜é‡</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    America, Asia, Europe</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="variable">@as</span>:<span class="operator">=</span><span class="number">0</span>, <span class="variable">@am</span>:<span class="operator">=</span><span class="number">0</span>, <span class="variable">@eu</span>:<span class="operator">=</span><span class="number">0</span>) t,</span><br><span class="line">    (<span class="keyword">SELECT</span> </span><br><span class="line">        <span class="variable">@as</span>:<span class="operator">=</span><span class="variable">@as</span> <span class="operator">+</span> <span class="number">1</span> <span class="keyword">AS</span> asid, name <span class="keyword">AS</span> Asia</span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">        student</span><br><span class="line">    <span class="keyword">WHERE</span></span><br><span class="line">        continent <span class="operator">=</span> <span class="string">&#x27;Asia&#x27;</span></span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> Asia) <span class="keyword">AS</span> t1</span><br><span class="line">        <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span></span><br><span class="line">    (<span class="keyword">SELECT</span> </span><br><span class="line">        <span class="variable">@am</span>:<span class="operator">=</span><span class="variable">@am</span> <span class="operator">+</span> <span class="number">1</span> <span class="keyword">AS</span> amid, name <span class="keyword">AS</span> America</span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">        student</span><br><span class="line">    <span class="keyword">WHERE</span></span><br><span class="line">        continent <span class="operator">=</span> <span class="string">&#x27;America&#x27;</span></span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> America) <span class="keyword">AS</span> t2 <span class="keyword">ON</span> asid <span class="operator">=</span> amid</span><br><span class="line">        <span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">    (<span class="keyword">SELECT</span> </span><br><span class="line">        <span class="variable">@eu</span>:<span class="operator">=</span><span class="variable">@eu</span> <span class="operator">+</span> <span class="number">1</span> <span class="keyword">AS</span> euid, name <span class="keyword">AS</span> Europe</span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">        student</span><br><span class="line">    <span class="keyword">WHERE</span></span><br><span class="line">        continent <span class="operator">=</span> <span class="string">&#x27;Europe&#x27;</span></span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> Europe) <span class="keyword">AS</span> t3 <span class="keyword">ON</span> amid <span class="operator">=</span> euid</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å®˜æ–¹ç»™å‡ºçš„ã€‚ã€‚åŒä¸‹æ–¹å¼€çª—</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> America,Asia,Europe </span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> name) <span class="keyword">as</span> rn,name <span class="keyword">as</span> America <span class="keyword">from</span> student</span><br><span class="line">    <span class="keyword">where</span> continent<span class="operator">=</span><span class="string">&#x27;America&#x27;</span></span><br><span class="line">) a</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span>(</span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> name) <span class="keyword">as</span> rn,name <span class="keyword">as</span> Asia <span class="keyword">from</span> student</span><br><span class="line">    <span class="keyword">where</span> continent<span class="operator">=</span><span class="string">&#x27;Asia&#x27;</span></span><br><span class="line">) b <span class="keyword">on</span> a.rn<span class="operator">=</span>b.rn</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span>(</span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> name) <span class="keyword">as</span> rn,name <span class="keyword">as</span> Europe <span class="keyword">from</span> student</span><br><span class="line">    <span class="keyword">where</span> continent<span class="operator">=</span><span class="string">&#x27;Europe&#x27;</span></span><br><span class="line">) c <span class="keyword">on</span> a.rn<span class="operator">=</span>c.rn</span><br></pre></td></tr></table></figure>



<h4 id="619-åªå‡ºç°ä¸€æ¬¡çš„æœ€å¤§æ•°å­—"><a href="#619-åªå‡ºç°ä¸€æ¬¡çš„æœ€å¤§æ•°å­—" class="headerlink" title="619. åªå‡ºç°ä¸€æ¬¡çš„æœ€å¤§æ•°å­—"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/biggest-single-number/">619. åªå‡ºç°ä¸€æ¬¡çš„æœ€å¤§æ•°å­—</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>è¡¨ <code>my_numbers</code> çš„ <strong>num</strong> å­—æ®µåŒ…å«å¾ˆå¤šæ•°å­—ï¼Œå…¶ä¸­åŒ…æ‹¬å¾ˆå¤šé‡å¤çš„æ•°å­—ã€‚</p>
<p>ä½ èƒ½å†™ä¸€ä¸ª SQL æŸ¥è¯¢è¯­å¥ï¼Œæ‰¾åˆ°åªå‡ºç°è¿‡ä¸€æ¬¡çš„æ•°å­—ä¸­ï¼Œæœ€å¤§çš„ä¸€ä¸ªæ•°å­—å—ï¼Ÿ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---+</span><br><span class="line">|num|</span><br><span class="line">+---+</span><br><span class="line">| 8 |</span><br><span class="line">| 8 |</span><br><span class="line">| 3 |</span><br><span class="line">| 3 |</span><br><span class="line">| 1 |</span><br><span class="line">| 4 |</span><br><span class="line">| 5 |</span><br><span class="line">| 6 | </span><br></pre></td></tr></table></figure>

<p>å¯¹äºä¸Šé¢ç»™å‡ºçš„æ ·ä¾‹æ•°æ®ï¼Œä½ çš„æŸ¥è¯¢è¯­å¥åº”è¯¥è¿”å›å¦‚ä¸‹ç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+---+</span><br><span class="line">|num|</span><br><span class="line">+---+</span><br><span class="line">| 6 |</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„ï¼š</strong></p>
<p>å¦‚æœæ²¡æœ‰åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—ï¼Œè¾“å‡º <strong>null</strong> ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="built_in">MAX</span>(num) <span class="keyword">AS</span> num</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    (<span class="keyword">SELECT</span></span><br><span class="line">        num</span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">        my_numbers</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> num</span><br><span class="line">    <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(num) <span class="operator">=</span> <span class="number">1</span>) t1</span><br></pre></td></tr></table></figure>



<h4 id="620-æœ‰è¶£çš„ç”µå½±"><a href="#620-æœ‰è¶£çš„ç”µå½±" class="headerlink" title="620. æœ‰è¶£çš„ç”µå½±"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/not-boring-movies/">620. æœ‰è¶£çš„ç”µå½±</a></h4><p>éš¾åº¦ç®€å•86æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡å…³æ³¨åé¦ˆ</p>
<p>SQLæ¶æ„</p>
<p>æŸåŸå¸‚å¼€äº†ä¸€å®¶æ–°çš„ç”µå½±é™¢ï¼Œå¸å¼•äº†å¾ˆå¤šäººè¿‡æ¥çœ‹ç”µå½±ã€‚è¯¥ç”µå½±é™¢ç‰¹åˆ«æ³¨æ„ç”¨æˆ·ä½“éªŒï¼Œä¸“é—¨æœ‰ä¸ª LEDæ˜¾ç¤ºæ¿åšç”µå½±æ¨èï¼Œä¸Šé¢å…¬å¸ƒç€å½±è¯„å’Œç›¸å…³ç”µå½±æè¿°ã€‚</p>
<p>ä½œä¸ºè¯¥ç”µå½±é™¢çš„ä¿¡æ¯éƒ¨ä¸»ç®¡ï¼Œæ‚¨éœ€è¦ç¼–å†™ä¸€ä¸ª SQLæŸ¥è¯¢ï¼Œæ‰¾å‡ºæ‰€æœ‰å½±ç‰‡æè¿°ä¸º<strong>é</strong> <code>boring</code> (ä¸æ— èŠ) çš„å¹¶ä¸” <strong>id ä¸ºå¥‡æ•°</strong> çš„å½±ç‰‡ï¼Œç»“æœè¯·æŒ‰ç­‰çº§ <code>rating</code> æ’åˆ—ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸‹è¡¨ <code>cinema</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------+-----------+--------------+-----------+</span><br><span class="line">|   id    | movie     |  description |  rating   |</span><br><span class="line">+---------+-----------+--------------+-----------+</span><br><span class="line">|   1     | War       |   great 3D   |   8.9     |</span><br><span class="line">|   2     | Science   |   fiction    |   8.5     |</span><br><span class="line">|   3     | irish     |   boring     |   6.2     |</span><br><span class="line">|   4     | Ice song  |   Fantacy    |   8.6     |</span><br><span class="line">|   5     | House card|   Interesting|   9.1     |</span><br><span class="line">+---------+-----------+--------------+-----------+</span><br></pre></td></tr></table></figure>

<p>å¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œåˆ™æ­£ç¡®çš„è¾“å‡ºæ˜¯ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+---------+-----------+--------------+-----------+</span><br><span class="line">|   id    | movie     |  description |  rating   |</span><br><span class="line">+---------+-----------+--------------+-----------+</span><br><span class="line">|   5     | House card|   Interesting|   9.1     |</span><br><span class="line">|   1     | War       |   great 3D   |   8.9     |</span><br><span class="line">+---------+-----------+--------------+-----------+</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  id,movie,description,rating </span><br><span class="line"><span class="keyword">from</span> cinema</span><br><span class="line"><span class="keyword">where</span> id<span class="operator">%</span><span class="number">2</span><span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> description <span class="operator">!=</span><span class="string">&#x27;boring&#x27;</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> rating <span class="keyword">desc</span>,id,movie,description</span><br></pre></td></tr></table></figure>



<h4 id="626-æ¢åº§ä½"><a href="#626-æ¢åº§ä½" class="headerlink" title="626. æ¢åº§ä½"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/exchange-seats/">626. æ¢åº§ä½</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>å°ç¾æ˜¯ä¸€æ‰€ä¸­å­¦çš„ä¿¡æ¯ç§‘æŠ€è€å¸ˆï¼Œå¥¹æœ‰ä¸€å¼  <code>seat</code> åº§ä½è¡¨ï¼Œå¹³æ—¶ç”¨æ¥å‚¨å­˜å­¦ç”Ÿåå­—å’Œä¸ä»–ä»¬ç›¸å¯¹åº”çš„åº§ä½ idã€‚</p>
<p>å…¶ä¸­çºµåˆ—çš„ <strong>id</strong> æ˜¯è¿ç»­é€’å¢çš„</p>
<p>å°ç¾æƒ³æ”¹å˜ç›¸é‚»ä¿©å­¦ç”Ÿçš„åº§ä½ã€‚</p>
<p>ä½ èƒ½ä¸èƒ½å¸®å¥¹å†™ä¸€ä¸ª SQL query æ¥è¾“å‡ºå°ç¾æƒ³è¦çš„ç»“æœå‘¢ï¼Ÿ </p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------+---------+</span><br><span class="line">|    id   | student |</span><br><span class="line">+---------+---------+</span><br><span class="line">|    1    | Abbot   |</span><br><span class="line">|    2    | Doris   |</span><br><span class="line">|    3    | Emerson |</span><br><span class="line">|    4    | Green   |</span><br><span class="line">|    5    | Jeames  |</span><br><span class="line">+---------+---------+</span><br></pre></td></tr></table></figure>

<p>å‡å¦‚æ•°æ®è¾“å…¥çš„æ˜¯ä¸Šè¡¨ï¼Œåˆ™è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------+---------+</span><br><span class="line">|    id   | student |</span><br><span class="line">+---------+---------+</span><br><span class="line">|    1    | Doris   |</span><br><span class="line">|    2    | Abbot   |</span><br><span class="line">|    3    | Green   |</span><br><span class="line">|    4    | Emerson |</span><br><span class="line">|    5    | Jeames  |</span><br><span class="line">+---------+---------+</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„ï¼š</strong></p>
<p>å¦‚æœå­¦ç”Ÿäººæ•°æ˜¯å¥‡æ•°ï¼Œåˆ™ä¸éœ€è¦æ”¹å˜æœ€åä¸€ä¸ªåŒå­¦çš„åº§ä½ã€‚</p>
<p>å¼€çª—</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,</span><br><span class="line">(<span class="keyword">case</span> <span class="keyword">when</span> id<span class="operator">%</span><span class="number">2</span><span class="operator">=</span><span class="number">0</span> <span class="keyword">then</span> f</span><br><span class="line">      <span class="keyword">when</span> id<span class="operator">%</span><span class="number">2</span><span class="operator">=</span><span class="number">1</span> <span class="operator">&amp;&amp;</span> b <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">then</span> b</span><br><span class="line">      <span class="keyword">else</span> student <span class="keyword">end</span>) student</span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line">    <span class="keyword">select</span> id,student,</span><br><span class="line">    <span class="built_in">lag</span>(student,<span class="number">1</span>,<span class="keyword">null</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> id) f,</span><br><span class="line">    <span class="built_in">lead</span>(student,<span class="number">1</span>,<span class="keyword">null</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> id) b</span><br><span class="line">    <span class="keyword">from</span> seat</span><br><span class="line">)t1</span><br></pre></td></tr></table></figure>

<p>éåµŒå¥—</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    if(id<span class="operator">%</span><span class="number">2</span><span class="operator">=</span><span class="number">0</span>,</span><br><span class="line">        id<span class="number">-1</span>,</span><br><span class="line">        if(id<span class="operator">=</span>(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> id) <span class="keyword">from</span> seat),</span><br><span class="line">            id,</span><br><span class="line">            id<span class="operator">+</span><span class="number">1</span>)) </span><br><span class="line">    <span class="keyword">as</span> id,student </span><br><span class="line"><span class="keyword">from</span> seat </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> id;</span><br></pre></td></tr></table></figure>

<p>ç”¨å¼‚æˆ–</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> b.id,a.student <span class="keyword">from</span> </span><br><span class="line">seat <span class="keyword">as</span> a,seat <span class="keyword">as</span> b,(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> cnt <span class="keyword">from</span> seat) <span class="keyword">as</span> c </span><br><span class="line"><span class="keyword">where</span> b.id<span class="operator">=</span><span class="number">1</span><span class="operator">^</span>(a.id<span class="number">-1</span>)<span class="operator">+</span><span class="number">1</span></span><br><span class="line"><span class="comment">-- where a.id=1^(b.id-1)+1; ä¹Ÿå¯ä»¥è¿™æ ·å†™ï¼Œæ›´å®¹æ˜“ç†è§£</span></span><br><span class="line"> <span class="operator">||</span> (c.cnt<span class="operator">%</span><span class="number">2</span> <span class="operator">&amp;&amp;</span> b.id<span class="operator">=</span>c.cnt <span class="operator">&amp;&amp;</span> a.id<span class="operator">=</span>c.cnt);</span><br></pre></td></tr></table></figure>

<h4 id="627-äº¤æ¢å·¥èµ„"><a href="#627-äº¤æ¢å·¥èµ„" class="headerlink" title="627. äº¤æ¢å·¥èµ„"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/swap-salary/">627. äº¤æ¢å·¥èµ„</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>ç»™å®šä¸€ä¸ª <code>salary</code> è¡¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œæœ‰ m = ç”·æ€§ å’Œ f = å¥³æ€§ çš„å€¼ã€‚äº¤æ¢æ‰€æœ‰çš„ f å’Œ m å€¼ï¼ˆä¾‹å¦‚ï¼Œå°†æ‰€æœ‰ f å€¼æ›´æ”¹ä¸º mï¼Œåä¹‹äº¦ç„¶ï¼‰ã€‚è¦æ±‚åªä½¿ç”¨ä¸€ä¸ªæ›´æ–°ï¼ˆUpdateï¼‰è¯­å¥ï¼Œå¹¶ä¸”æ²¡æœ‰ä¸­é—´çš„ä¸´æ—¶è¡¨ã€‚</p>
<p>æ³¨æ„ï¼Œæ‚¨å¿…åªèƒ½å†™ä¸€ä¸ª Update è¯­å¥ï¼Œè¯·ä¸è¦ç¼–å†™ä»»ä½• Select è¯­å¥ã€‚</p>
<p><strong>ä¾‹å¦‚ï¼š</strong></p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>sex</th>
<th>salary</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>A</td>
<td>m</td>
<td>2500</td>
</tr>
<tr>
<td>2</td>
<td>B</td>
<td>f</td>
<td>1500</td>
</tr>
<tr>
<td>3</td>
<td>C</td>
<td>m</td>
<td>5500</td>
</tr>
<tr>
<td>4</td>
<td>D</td>
<td>f</td>
<td>500</td>
</tr>
</tbody></table>
<p>è¿è¡Œä½ æ‰€ç¼–å†™çš„æ›´æ–°è¯­å¥ä¹‹åï¼Œå°†ä¼šå¾—åˆ°ä»¥ä¸‹è¡¨:</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>sex</th>
<th>salary</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>A</td>
<td>f</td>
<td>2500</td>
</tr>
<tr>
<td>2</td>
<td>B</td>
<td>m</td>
<td>1500</td>
</tr>
<tr>
<td>3</td>
<td>C</td>
<td>f</td>
<td>5500</td>
</tr>
<tr>
<td>4</td>
<td>D</td>
<td>m</td>
<td>500</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">UPDATE salary</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">    sex <span class="operator">=</span> <span class="keyword">CASE</span> sex</span><br><span class="line">        <span class="keyword">WHEN</span> <span class="string">&#x27;m&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;f&#x27;</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="string">&#x27;m&#x27;</span></span><br><span class="line">    <span class="keyword">END</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Update å’Œsetçš„ä½¿ç”¨</p>
</blockquote>
<h4 id="1045-ä¹°ä¸‹æ‰€æœ‰äº§å“çš„å®¢æˆ·"><a href="#1045-ä¹°ä¸‹æ‰€æœ‰äº§å“çš„å®¢æˆ·" class="headerlink" title="1045. ä¹°ä¸‹æ‰€æœ‰äº§å“çš„å®¢æˆ·"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/customers-who-bought-all-products/">1045. ä¹°ä¸‹æ‰€æœ‰äº§å“çš„å®¢æˆ·</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p><code>Customer</code> è¡¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| customer_id | int     |</span><br><span class="line">| product_key | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">product_key æ˜¯ Customer è¡¨çš„å¤–é”®ã€‚</span><br></pre></td></tr></table></figure>

<p><code>Product</code> è¡¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| product_key | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">product_key æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€æ¡ SQL æŸ¥è¯¢è¯­å¥ï¼Œä» <code>Customer</code> è¡¨ä¸­æŸ¥è¯¢è´­ä¹°äº† <code>Product</code> è¡¨ä¸­æ‰€æœ‰äº§å“çš„å®¢æˆ·çš„ idã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Customer è¡¨ï¼š</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| customer_id | product_key |</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| 1           | 5           |</span><br><span class="line">| 2           | 6           |</span><br><span class="line">| 3           | 5           |</span><br><span class="line">| 3           | 6           |</span><br><span class="line">| 1           | 6           |</span><br><span class="line">+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Product è¡¨ï¼š</span><br><span class="line">+-------------+</span><br><span class="line">| product_key |</span><br><span class="line">+-------------+</span><br><span class="line">| 5           |</span><br><span class="line">| 6           |</span><br><span class="line">+-------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+-------------+</span><br><span class="line">| customer_id |</span><br><span class="line">+-------------+</span><br><span class="line">| 1           |</span><br><span class="line">| 3           |</span><br><span class="line">+-------------+</span><br><span class="line">è´­ä¹°äº†æ‰€æœ‰äº§å“ï¼ˆ5 å’Œ 6ï¼‰çš„å®¢æˆ·çš„ id æ˜¯ 1 å’Œ 3 ã€‚</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> customer_id</span><br><span class="line"><span class="keyword">from</span> Customer</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> customer_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> product_key)<span class="operator">=</span>(</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) cnt</span><br><span class="line"><span class="keyword">from</span> Product)</span><br></pre></td></tr></table></figure>



<h4 id="1050-åˆä½œè¿‡è‡³å°‘ä¸‰æ¬¡çš„æ¼”å‘˜å’Œå¯¼æ¼”"><a href="#1050-åˆä½œè¿‡è‡³å°‘ä¸‰æ¬¡çš„æ¼”å‘˜å’Œå¯¼æ¼”" class="headerlink" title="1050. åˆä½œè¿‡è‡³å°‘ä¸‰æ¬¡çš„æ¼”å‘˜å’Œå¯¼æ¼”"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/actors-and-directors-who-cooperated-at-least-three-times/">1050. åˆä½œè¿‡è‡³å°‘ä¸‰æ¬¡çš„æ¼”å‘˜å’Œå¯¼æ¼”</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p><code>ActorDirector</code> è¡¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| actor_id    | int     |</span><br><span class="line">| director_id | int     |</span><br><span class="line">| timestamp   | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">timestamp æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®.</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€æ¡SQLæŸ¥è¯¢è¯­å¥è·å–åˆä½œè¿‡è‡³å°‘ä¸‰æ¬¡çš„æ¼”å‘˜å’Œå¯¼æ¼”çš„ id å¯¹ <code>(actor_id, director_id)</code></p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ActorDirector è¡¨ï¼š</span><br><span class="line">+-------------+-------------+-------------+</span><br><span class="line">| actor_id    | director_id | timestamp   |</span><br><span class="line">+-------------+-------------+-------------+</span><br><span class="line">| 1           | 1           | 0           |</span><br><span class="line">| 1           | 1           | 1           |</span><br><span class="line">| 1           | 1           | 2           |</span><br><span class="line">| 1           | 2           | 3           |</span><br><span class="line">| 1           | 2           | 4           |</span><br><span class="line">| 2           | 1           | 5           |</span><br><span class="line">| 2           | 1           | 6           |</span><br><span class="line">+-------------+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| actor_id    | director_id |</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| 1           | 1           |</span><br><span class="line">+-------------+-------------+</span><br><span class="line">å”¯ä¸€çš„ id å¯¹æ˜¯ (1, 1)ï¼Œä»–ä»¬æ°å¥½åˆä½œäº† 3 æ¬¡ã€‚</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> actor_id,director_id</span><br><span class="line"><span class="keyword">from</span> ActorDirector</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> actor_id,director_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">&gt;=</span><span class="number">3</span></span><br></pre></td></tr></table></figure>

<h4 id="1068-äº§å“é”€å”®åˆ†æ-I"><a href="#1068-äº§å“é”€å”®åˆ†æ-I" class="headerlink" title="1068. äº§å“é”€å”®åˆ†æ I"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/product-sales-analysis-i/">1068. äº§å“é”€å”®åˆ†æ I</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>é”€å”®è¡¨ <code>Sales</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+-------------+-------+</span><br><span class="line">| Column Name | Type  |</span><br><span class="line">+-------------+-------+</span><br><span class="line">| sale_id     | int   |</span><br><span class="line">| product_id  | int   |</span><br><span class="line">| year        | int   |</span><br><span class="line">| quantity    | int   |</span><br><span class="line">| price       | int   |</span><br><span class="line">+-------------+-------+</span><br><span class="line">(sale_id, year) æ˜¯é”€å”®è¡¨ Sales çš„ä¸»é”®.</span><br><span class="line">product_id æ˜¯äº§å“è¡¨ Product çš„å¤–é”®.</span><br><span class="line">æ³¨æ„: price è¡¨ç¤ºæ¯å•ä½ä»·æ ¼</span><br></pre></td></tr></table></figure>

<p>äº§å“è¡¨ <code>Product</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| product_id   | int     |</span><br><span class="line">| product_name | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">product_id æ˜¯è¡¨çš„ä¸»é”®.</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€æ¡SQL æŸ¥è¯¢è¯­å¥è·å–äº§å“è¡¨ <code>Product</code> ä¸­æ‰€æœ‰çš„ <strong>äº§å“åç§° product name</strong> ä»¥åŠ è¯¥äº§å“åœ¨ <code>Sales</code> è¡¨ä¸­ç›¸å¯¹åº”çš„ <strong>ä¸Šå¸‚å¹´ä»½ year</strong> å’Œ <strong>ä»·æ ¼ price</strong>ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Sales è¡¨ï¼š</span><br><span class="line">+---------+------------+------+----------+-------+</span><br><span class="line">| sale_id | product_id | year | quantity | price |</span><br><span class="line">+---------+------------+------+----------+-------+ </span><br><span class="line">| 1       | 100        | 2008 | 10       | 5000  |</span><br><span class="line">| 2       | 100        | 2009 | 12       | 5000  |</span><br><span class="line">| 7       | 200        | 2011 | 15       | 9000  |</span><br><span class="line">+---------+------------+------+----------+-------+</span><br><span class="line"></span><br><span class="line">Product è¡¨ï¼š</span><br><span class="line">+------------+--------------+</span><br><span class="line">| product_id | product_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| 100        | Nokia        |</span><br><span class="line">| 200        | Apple        |</span><br><span class="line">| 300        | Samsung      |</span><br><span class="line">+------------+--------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+--------------+-------+-------+</span><br><span class="line">| product_name | year  | price |</span><br><span class="line">+--------------+-------+-------+</span><br><span class="line">| Nokia        | 2008  | 5000  |</span><br><span class="line">| Nokia        | 2009  | 5000  |</span><br><span class="line">| Apple        | 2011  | 9000  |</span><br><span class="line">+--------------+-------+-------+</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> product_name,<span class="keyword">year</span>,price</span><br><span class="line"><span class="keyword">from</span> Sales s <span class="keyword">left</span> <span class="keyword">join</span> Product p</span><br><span class="line"><span class="keyword">on</span> s.product_id  <span class="operator">=</span> p.product_id </span><br></pre></td></tr></table></figure>



<h4 id="1069-äº§å“é”€å”®åˆ†æ-II"><a href="#1069-äº§å“é”€å”®åˆ†æ-II" class="headerlink" title="1069. äº§å“é”€å”®åˆ†æ II"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/product-sales-analysis-ii/">1069. äº§å“é”€å”®åˆ†æ II</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>é”€å”®è¡¨ï¼š<code>Sales</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+-------------+-------+</span><br><span class="line">| Column Name | Type  |</span><br><span class="line">+-------------+-------+</span><br><span class="line">| sale_id     | int   |</span><br><span class="line">| product_id  | int   |</span><br><span class="line">| year        | int   |</span><br><span class="line">| quantity    | int   |</span><br><span class="line">| price       | int   |</span><br><span class="line">+-------------+-------+</span><br><span class="line">sale_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">product_id æ˜¯ Product è¡¨çš„å¤–é”®ã€‚</span><br><span class="line">è¯·æ³¨æ„ä»·æ ¼æ˜¯æ¯å•ä½çš„ã€‚</span><br></pre></td></tr></table></figure>

<p>äº§å“è¡¨ï¼š<code>Product</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| product_id   | int     |</span><br><span class="line">| product_name | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">product_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒæŒ‰äº§å“ id <code>product_id</code> æ¥ç»Ÿè®¡æ¯ä¸ªäº§å“çš„é”€å”®æ€»é‡ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹é¢ä¾‹å­æ‰€ç¤º:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Sales è¡¨ï¼š</span><br><span class="line">+---------+------------+------+----------+-------+</span><br><span class="line">| sale_id | product_id | year | quantity | price |</span><br><span class="line">+---------+------------+------+----------+-------+ </span><br><span class="line">| 1       | 100        | 2008 | 10       | 5000  |</span><br><span class="line">| 2       | 100        | 2009 | 12       | 5000  |</span><br><span class="line">| 7       | 200        | 2011 | 15       | 9000  |</span><br><span class="line">+---------+------------+------+----------+-------+</span><br><span class="line"></span><br><span class="line">Product è¡¨ï¼š</span><br><span class="line">+------------+--------------+</span><br><span class="line">| product_id | product_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| 100        | Nokia        |</span><br><span class="line">| 200        | Apple        |</span><br><span class="line">| 300        | Samsung      |</span><br><span class="line">+------------+--------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+--------------+----------------+</span><br><span class="line">| product_id   | total_quantity |</span><br><span class="line">+--------------+----------------+</span><br><span class="line">| 100          | 22             |</span><br><span class="line">| 200          | 15             |</span><br><span class="line">+--------------+----------------+</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s.product_id,<span class="built_in">sum</span>(quantity) total_quantity</span><br><span class="line"><span class="keyword">from</span> Sales s <span class="keyword">left</span> <span class="keyword">join</span> Product p</span><br><span class="line"><span class="keyword">on</span> s.product_id  <span class="operator">=</span> p.product_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> s.product_id</span><br></pre></td></tr></table></figure>



<h4 id="1070-äº§å“é”€å”®åˆ†æ-III"><a href="#1070-äº§å“é”€å”®åˆ†æ-III" class="headerlink" title="1070. äº§å“é”€å”®åˆ†æ III"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/product-sales-analysis-iii/">1070. äº§å“é”€å”®åˆ†æ III</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>é”€å”®è¡¨ <code>Sales</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+-------------+-------+</span><br><span class="line">| Column Name | Type  |</span><br><span class="line">+-------------+-------+</span><br><span class="line">| sale_id     | int   |</span><br><span class="line">| product_id  | int   |</span><br><span class="line">| year        | int   |</span><br><span class="line">| quantity    | int   |</span><br><span class="line">| price       | int   |</span><br><span class="line">+-------------+-------+</span><br><span class="line">sale_id æ˜¯æ­¤è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">product_id æ˜¯äº§å“è¡¨çš„å¤–é”®ã€‚</span><br><span class="line">è¯·æ³¨æ„ï¼Œä»·æ ¼æ˜¯æŒ‰æ¯å•ä½è®¡çš„ã€‚</span><br></pre></td></tr></table></figure>

<p>äº§å“è¡¨ <code>Product</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| product_id   | int     |</span><br><span class="line">| product_name | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">product_id æ˜¯æ­¤è¡¨çš„ä¸»é”®ã€‚</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œé€‰å‡ºæ¯ä¸ªé”€å”®äº§å“çš„ <strong>ç¬¬ä¸€å¹´</strong> çš„ <strong>äº§å“ id</strong>ã€<strong>å¹´ä»½</strong>ã€<strong>æ•°é‡</strong> å’Œ <strong>ä»·æ ¼</strong>ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Sales table:</span><br><span class="line">+---------+------------+------+----------+-------+</span><br><span class="line">| sale_id | product_id | year | quantity | price |</span><br><span class="line">+---------+------------+------+----------+-------+ </span><br><span class="line">| 1       | 100        | 2008 | 10       | 5000  |</span><br><span class="line">| 2       | 100        | 2009 | 12       | 5000  |</span><br><span class="line">| 7       | 200        | 2011 | 15       | 9000  |</span><br><span class="line">+---------+------------+------+----------+-------+</span><br><span class="line"></span><br><span class="line">Product table:</span><br><span class="line">+------------+--------------+</span><br><span class="line">| product_id | product_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| 100        | Nokia        |</span><br><span class="line">| 200        | Apple        |</span><br><span class="line">| 300        | Samsung      |</span><br><span class="line">+------------+--------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+------------+----------+-------+</span><br><span class="line">| product_id | first_year | quantity | price |</span><br><span class="line">+------------+------------+----------+-------+ </span><br><span class="line">| 100        | 2008       | 10       | 5000  |</span><br><span class="line">| 200        | 2011       | 15       | 9000  |</span><br><span class="line">+------------+------------+----------+-------+</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> product_id,<span class="keyword">year</span> first_year,quantity,price</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span> s.product_id,<span class="keyword">year</span>,quantity,price,</span><br><span class="line"><span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> product_id <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">year</span>) rk</span><br><span class="line"><span class="keyword">from</span> Sales s <span class="keyword">left</span> <span class="keyword">join</span> Product p</span><br><span class="line"><span class="keyword">on</span> s.product_id  <span class="operator">=</span> p.product_id</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> rk <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h4 id="1075-é¡¹ç›®å‘˜å·¥-I"><a href="#1075-é¡¹ç›®å‘˜å·¥-I" class="headerlink" title="1075. é¡¹ç›®å‘˜å·¥ I"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/project-employees-i/">1075. é¡¹ç›®å‘˜å·¥ I</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>é¡¹ç›®è¡¨ <code>Project</code>ï¼š </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| project_id  | int     |</span><br><span class="line">| employee_id | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">ä¸»é”®ä¸º (project_id, employee_id)ã€‚</span><br><span class="line">employee_id æ˜¯å‘˜å·¥è¡¨ Employee è¡¨çš„å¤–é”®ã€‚</span><br></pre></td></tr></table></figure>

<p>å‘˜å·¥è¡¨ <code>Employee</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+------------------+---------+</span><br><span class="line">| Column Name      | Type    |</span><br><span class="line">+------------------+---------+</span><br><span class="line">| employee_id      | int     |</span><br><span class="line">| name             | varchar |</span><br><span class="line">| experience_years | int     |</span><br><span class="line">+------------------+---------+</span><br><span class="line">ä¸»é”®æ˜¯ employee_idã€‚</span><br></pre></td></tr></table></figure>

<p>è¯·å†™ä¸€ä¸ª SQL è¯­å¥ï¼ŒæŸ¥è¯¢æ¯ä¸€ä¸ªé¡¹ç›®ä¸­å‘˜å·¥çš„ <strong>å¹³å‡</strong> å·¥ä½œå¹´é™ï¼Œ<strong>ç²¾ç¡®åˆ°å°æ•°ç‚¹åä¸¤ä½</strong>ã€‚</p>
<p>æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Project è¡¨ï¼š</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| project_id  | employee_id |</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| 1           | 1           |</span><br><span class="line">| 1           | 2           |</span><br><span class="line">| 1           | 3           |</span><br><span class="line">| 2           | 1           |</span><br><span class="line">| 2           | 4           |</span><br><span class="line">+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Employee è¡¨ï¼š</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line">| employee_id | name   | experience_years |</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line">| 1           | Khaled | 3                |</span><br><span class="line">| 2           | Ali    | 2                |</span><br><span class="line">| 3           | John   | 1                |</span><br><span class="line">| 4           | Doe    | 2                |</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| project_id  | average_years |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 1           | 2.00          |</span><br><span class="line">| 2           | 2.50          |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">ç¬¬ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œå‘˜å·¥çš„å¹³å‡å·¥ä½œå¹´é™æ˜¯ (3 + 2 + 1) / 3 = 2.00ï¼›ç¬¬äºŒä¸ªé¡¹ç›®ä¸­ï¼Œå‘˜å·¥çš„å¹³å‡å·¥ä½œå¹´é™æ˜¯ (3 + 2) / 2 = 2.50</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> project_id,round(<span class="built_in">avg</span>(experience_years),<span class="number">2</span>) average_years</span><br><span class="line"><span class="keyword">from</span> Project p <span class="keyword">join</span> Employee e</span><br><span class="line"><span class="keyword">on</span> p.employee_id<span class="operator">=</span>e.employee_id </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> project_id</span><br></pre></td></tr></table></figure>

<h4 id="1076-é¡¹ç›®å‘˜å·¥II"><a href="#1076-é¡¹ç›®å‘˜å·¥II" class="headerlink" title="1076. é¡¹ç›®å‘˜å·¥II"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/project-employees-ii/">1076. é¡¹ç›®å‘˜å·¥II</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>Table: <code>Project</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| project_id  | int     |</span><br><span class="line">| employee_id | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">ä¸»é”®ä¸º (project_id, employee_id)ã€‚</span><br><span class="line">employee_id æ˜¯å‘˜å·¥è¡¨ Employee è¡¨çš„å¤–é”®ã€‚</span><br></pre></td></tr></table></figure>

<p>Table: <code>Employee</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+------------------+---------+</span><br><span class="line">| Column Name      | Type    |</span><br><span class="line">+------------------+---------+</span><br><span class="line">| employee_id      | int     |</span><br><span class="line">| name             | varchar |</span><br><span class="line">| experience_years | int     |</span><br><span class="line">+------------------+---------+</span><br><span class="line">ä¸»é”®æ˜¯ employee_idã€‚</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ä¸€ä¸ªSQLæŸ¥è¯¢ï¼ŒæŠ¥å‘Šæ‰€æœ‰é›‡å‘˜æœ€å¤šçš„é¡¹ç›®ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Project table:</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| project_id  | employee_id |</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| 1           | 1           |</span><br><span class="line">| 1           | 2           |</span><br><span class="line">| 1           | 3           |</span><br><span class="line">| 2           | 1           |</span><br><span class="line">| 2           | 4           |</span><br><span class="line">+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Employee table:</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line">| employee_id | name   | experience_years |</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line">| 1           | Khaled | 3                |</span><br><span class="line">| 2           | Ali    | 2                |</span><br><span class="line">| 3           | John   | 1                |</span><br><span class="line">| 4           | Doe    | 2                |</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-------------+</span><br><span class="line">| project_id  |</span><br><span class="line">+-------------+</span><br><span class="line">| 1           |</span><br><span class="line">+-------------+</span><br><span class="line">ç¬¬ä¸€ä¸ªé¡¹ç›®æœ‰3åå‘˜å·¥ï¼Œç¬¬äºŒä¸ªé¡¹ç›®æœ‰2åå‘˜å·¥ã€‚</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> project_id </span><br><span class="line"><span class="keyword">from</span> Project </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> project_id </span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="operator">=</span> </span><br><span class="line">(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) `num` <span class="keyword">from</span> Project <span class="keyword">group</span> <span class="keyword">by</span> project_id <span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">desc</span> limit <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>å¼€çª—</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> project_id <span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> project_id,<span class="built_in">rank</span>()<span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">count</span>(employee_id) <span class="keyword">desc</span>) ranking <span class="keyword">from</span> Project <span class="keyword">group</span> <span class="keyword">by</span> project_id) temp <span class="keyword">where</span> ranking<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>



<h4 id="1077-é¡¹ç›®å‘˜å·¥-III"><a href="#1077-é¡¹ç›®å‘˜å·¥-III" class="headerlink" title="1077. é¡¹ç›®å‘˜å·¥ III"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/project-employees-iii/">1077. é¡¹ç›®å‘˜å·¥ III</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>é¡¹ç›®è¡¨ <code>Project</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| project_id  | int     |</span><br><span class="line">| employee_id | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">(project_id, employee_id) æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®</span><br><span class="line">employee_id æ˜¯å‘˜å·¥è¡¨ Employee çš„å¤–é”®</span><br></pre></td></tr></table></figure>

<p>å‘˜å·¥è¡¨ <code>Employee</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+------------------+---------+</span><br><span class="line">| Column Name      | Type    |</span><br><span class="line">+------------------+---------+</span><br><span class="line">| employee_id      | int     |</span><br><span class="line">| name             | varchar |</span><br><span class="line">| experience_years | int     |</span><br><span class="line">+------------------+---------+</span><br><span class="line">employee_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®</span><br></pre></td></tr></table></figure>

<p>å†™ ä¸€ä¸ª SQL æŸ¥è¯¢è¯­å¥ï¼ŒæŠ¥å‘Šåœ¨æ¯ä¸€ä¸ªé¡¹ç›®ä¸­ç»éªŒæœ€ä¸°å¯Œçš„é›‡å‘˜æ˜¯è°ã€‚å¦‚æœå‡ºç°ç»éªŒå¹´æ•°ç›¸åŒçš„æƒ…å†µï¼Œè¯·æŠ¥å‘Šæ‰€æœ‰å…·æœ‰æœ€å¤§ç»éªŒå¹´æ•°çš„å‘˜å·¥ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Project è¡¨ï¼š</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| project_id  | employee_id |</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| 1           | 1           |</span><br><span class="line">| 1           | 2           |</span><br><span class="line">| 1           | 3           |</span><br><span class="line">| 2           | 1           |</span><br><span class="line">| 2           | 4           |</span><br><span class="line">+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Employee è¡¨ï¼š</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line">| employee_id | name   | experience_years |</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line">| 1           | Khaled | 3                |</span><br><span class="line">| 2           | Ali    | 2                |</span><br><span class="line">| 3           | John   | 3                |</span><br><span class="line">| 4           | Doe    | 2                |</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| project_id  | employee_id   |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 1           | 1             |</span><br><span class="line">| 1           | 3             |</span><br><span class="line">| 2           | 1             |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">employee_id ä¸º 1 å’Œ 3 çš„å‘˜å·¥åœ¨ project_id ä¸º 1 çš„é¡¹ç›®ä¸­æ‹¥æœ‰æœ€ä¸°å¯Œçš„ç»éªŒã€‚åœ¨ project_id ä¸º 2 çš„é¡¹ç›®ä¸­ï¼Œemployee_id ä¸º 1 çš„å‘˜å·¥æ‹¥æœ‰æœ€ä¸°å¯Œçš„ç»éªŒã€‚</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> project_id ,employee_id</span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line"><span class="keyword">select</span> project_id,e.employee_id,</span><br><span class="line"><span class="built_in">rank</span>()<span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> project_id <span class="keyword">order</span> <span class="keyword">by</span> experience_years <span class="keyword">desc</span>) rk</span><br><span class="line"><span class="keyword">from</span> Project p <span class="keyword">join</span> Employee e</span><br><span class="line"><span class="keyword">on</span> p.employee_id<span class="operator">=</span>e.employee_id </span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> rk<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>





<h4 id="1082-é”€å”®åˆ†æ-I"><a href="#1082-é”€å”®åˆ†æ-I" class="headerlink" title="1082. é”€å”®åˆ†æ I "></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/sales-analysis-i/">1082. é”€å”®åˆ†æ I </a></h4><p>éš¾åº¦ç®€å•22</p>
<p>SQLæ¶æ„</p>
<p>äº§å“è¡¨ï¼š<code>Product</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| product_id   | int     |</span><br><span class="line">| product_name | varchar |</span><br><span class="line">| unit_price   | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">product_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®.</span><br></pre></td></tr></table></figure>

<p>é”€å”®è¡¨ï¼š<code>Sales</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| seller_id   | int     |</span><br><span class="line">| product_id  | int     |</span><br><span class="line">| buyer_id    | int     |</span><br><span class="line">| sale_date   | date    |</span><br><span class="line">| quantity    | int     |</span><br><span class="line">| price       | int     |</span><br><span class="line">+------ ------+---------+</span><br><span class="line">è¿™ä¸ªè¡¨æ²¡æœ‰ä¸»é”®ï¼Œå®ƒå¯ä»¥æœ‰é‡å¤çš„è¡Œ.</span><br><span class="line">product_id æ˜¯ Product è¡¨çš„å¤–é”®.</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒæŸ¥è¯¢æ€»é”€å”®é¢æœ€é«˜çš„é”€å”®è€…ï¼Œå¦‚æœæœ‰å¹¶åˆ—çš„ï¼Œå°±éƒ½å±•ç¤ºå‡ºæ¥ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Product è¡¨ï¼š</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line">| product_id | product_name | unit_price |</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line">| 1          | S8           | 1000       |</span><br><span class="line">| 2          | G4           | 800        |</span><br><span class="line">| 3          | iPhone       | 1400       |</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line"></span><br><span class="line">Sales è¡¨ï¼š</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line">| seller_id | product_id | buyer_id | sale_date  | quantity | price |</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line">| 1         | 1          | 1        | 2019-01-21 | 2        | 2000  |</span><br><span class="line">| 1         | 2          | 2        | 2019-02-17 | 1        | 800   |</span><br><span class="line">| 2         | 2          | 3        | 2019-06-02 | 1        | 800   |</span><br><span class="line">| 3         | 3          | 4        | 2019-05-13 | 2        | 2800  |</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+-------------+</span><br><span class="line">| seller_id   |</span><br><span class="line">+-------------+</span><br><span class="line">| 1           |</span><br><span class="line">| 3           |</span><br><span class="line">+-------------+</span><br><span class="line">Id ä¸º 1 å’Œ 3 çš„é”€å”®è€…ï¼Œé”€å”®æ€»é‡‘é¢éƒ½ä¸ºæœ€é«˜çš„ 2800ã€‚</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> seller_id</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span> seller_id ,<span class="built_in">sum</span>(price) tp,<span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">sum</span>(price) <span class="keyword">desc</span>) rk</span><br><span class="line"><span class="keyword">from</span> Sales</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> seller_id</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> rk <span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>



<h4 id="1083-é”€å”®åˆ†æ-II"><a href="#1083-é”€å”®åˆ†æ-II" class="headerlink" title="1083. é”€å”®åˆ†æ II"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/sales-analysis-ii/">1083. é”€å”®åˆ†æ II</a></h4><p>éš¾åº¦ç®€å•13</p>
<p>SQLæ¶æ„</p>
<p>Table: <code>Product</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| product_id   | int     |</span><br><span class="line">| product_name | varchar |</span><br><span class="line">| unit_price   | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">product_id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®</span><br></pre></td></tr></table></figure>

<p>Table: <code>Sales</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| seller_id   | int     |</span><br><span class="line">| product_id  | int     |</span><br><span class="line">| buyer_id    | int     |</span><br><span class="line">| sale_date   | date    |</span><br><span class="line">| quantity    | int     |</span><br><span class="line">| price       | int     |</span><br><span class="line">+------ ------+---------+</span><br><span class="line">è¿™ä¸ªè¡¨æ²¡æœ‰ä¸»é”®ï¼Œå®ƒå¯ä»¥æœ‰é‡å¤çš„è¡Œ.</span><br><span class="line">product_id æ˜¯ Product è¡¨çš„å¤–é”®.</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒæŸ¥è¯¢è´­ä¹°äº† S8 æ‰‹æœºå´æ²¡æœ‰è´­ä¹° iPhone çš„ä¹°å®¶ã€‚æ³¨æ„è¿™é‡Œ S8 å’Œ iPhone æ˜¯ Product è¡¨ä¸­çš„äº§å“ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹å›¾è¡¨ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Product table:</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line">| product_id | product_name | unit_price |</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line">| 1          | S8           | 1000       |</span><br><span class="line">| 2          | G4           | 800        |</span><br><span class="line">| 3          | iPhone       | 1400       |</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line"></span><br><span class="line">Sales table:</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line">| seller_id | product_id | buyer_id | sale_date  | quantity | price |</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line">| 1         | 1          | 1        | 2019-01-21 | 2        | 2000  |</span><br><span class="line">| 1         | 2          | 2        | 2019-02-17 | 1        | 800   |</span><br><span class="line">| 2         | 1          | 3        | 2019-06-02 | 1        | 800   |</span><br><span class="line">| 3         | 3          | 3        | 2019-05-13 | 2        | 2800  |</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-------------+</span><br><span class="line">| buyer_id    |</span><br><span class="line">+-------------+</span><br><span class="line">| 1           |</span><br><span class="line">+-------------+</span><br><span class="line">id ä¸º 1 çš„ä¹°å®¶è´­ä¹°äº†ä¸€éƒ¨ S8ï¼Œä½†æ˜¯å´æ²¡æœ‰è´­ä¹° iPhoneï¼Œè€Œ id ä¸º 3 çš„ä¹°å®¶å´åŒæ—¶è´­ä¹°äº†è¿™ 2 éƒ¨æ‰‹æœºã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> t.buyer_id <span class="keyword">from</span>(</span><br><span class="line"><span class="keyword">select</span> s.buyer_id, p.product_name</span><br><span class="line"><span class="keyword">from</span> sales s</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span></span><br><span class="line">product p</span><br><span class="line"><span class="keyword">on</span> s.product_id<span class="operator">=</span>p.product_id <span class="keyword">and</span> (p.product_name<span class="operator">=</span><span class="string">&#x27;S8&#x27;</span> <span class="keyword">or</span> p.product_name<span class="operator">=</span><span class="string">&#x27;iPhone&#x27;</span>)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> s.buyer_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> p.product_name) <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">) t</span><br><span class="line"><span class="keyword">where</span> t.product_name<span class="operator">=</span><span class="string">&#x27;S8&#x27;</span></span><br></pre></td></tr></table></figure>

<p>æ•ˆç‡ä½</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s.buyer_id </span><br><span class="line"><span class="keyword">from</span> sales <span class="keyword">as</span> s <span class="keyword">left</span> <span class="keyword">join</span> product <span class="keyword">as</span> p </span><br><span class="line"><span class="keyword">on</span> s.product_id<span class="operator">=</span>p.product_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> buyer_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">sum</span>(p.product_name<span class="operator">=</span><span class="string">&#x27;S8&#x27;</span>)<span class="operator">&gt;</span><span class="number">0</span> <span class="keyword">and</span> <span class="built_in">sum</span>(p.product_name<span class="operator">=</span><span class="string">&#x27;iPhone&#x27;</span>)<span class="operator">=</span><span class="number">0</span></span><br></pre></td></tr></table></figure>



<h4 id="1084-é”€å”®åˆ†æIII"><a href="#1084-é”€å”®åˆ†æIII" class="headerlink" title="1084. é”€å”®åˆ†æIII"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/sales-analysis-iii/">1084. é”€å”®åˆ†æIII</a></h4><p>éš¾åº¦ç®€å•13</p>
<p>SQLæ¶æ„</p>
<p>Table: <code>Product</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| product_id   | int     |</span><br><span class="line">| product_name | varchar |</span><br><span class="line">| unit_price   | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">product_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®</span><br></pre></td></tr></table></figure>

<p>Table: <code>Sales</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| seller_id   | int     |</span><br><span class="line">| product_id  | int     |</span><br><span class="line">| buyer_id    | int     |</span><br><span class="line">| sale_date   | date    |</span><br><span class="line">| quantity    | int     |</span><br><span class="line">| price       | int     |</span><br><span class="line">+------ ------+---------+</span><br><span class="line">è¿™ä¸ªè¡¨æ²¡æœ‰ä¸»é”®ï¼Œå®ƒå¯ä»¥æœ‰é‡å¤çš„è¡Œ.</span><br><span class="line">product_id æ˜¯ Product è¡¨çš„å¤–é”®.</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ä¸€ä¸ªSQLæŸ¥è¯¢ï¼ŒæŠ¥å‘Š2019å¹´æ˜¥å­£æ‰å”®å‡ºçš„äº§å“ã€‚å³<strong>ä»…</strong>åœ¨<strong>2019-01-01</strong>è‡³<strong>2019-03-31</strong>ï¼ˆå«ï¼‰ä¹‹é—´å‡ºå”®çš„å•†å“ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Product table:</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line">| product_id | product_name | unit_price |</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line">| 1          | S8           | 1000       |</span><br><span class="line">| 2          | G4           | 800        |</span><br><span class="line">| 3          | iPhone       | 1400       |</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line"></span><br><span class="line">Sales table:</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line">| seller_id | product_id | buyer_id | sale_date  | quantity | price |</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line">| 1         | 1          | 1        | 2019-01-21 | 2        | 2000  |</span><br><span class="line">| 1         | 2          | 2        | 2019-02-17 | 1        | 800   |</span><br><span class="line">| 2         | 2          | 3        | 2019-06-02 | 1        | 800   |</span><br><span class="line">| 3         | 3          | 4        | 2019-05-13 | 2        | 2800  |</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| product_id  | product_name |</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| 1           | S8           |</span><br><span class="line">+-------------+--------------+</span><br><span class="line">idä¸º1çš„äº§å“ä»…åœ¨2019å¹´æ˜¥å­£é”€å”®ï¼Œå…¶ä»–ä¸¤ä¸ªäº§å“åœ¨ä¹‹åé”€å”®ã€‚</span><br></pre></td></tr></table></figure>

<p>876ms</p>
<p>æ­£å¸¸è§£æ³•</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> product_id, product_name  </span><br><span class="line"><span class="keyword">from</span> product </span><br><span class="line"><span class="keyword">where</span> product_id <span class="keyword">not</span> <span class="keyword">in</span> (</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> product_id <span class="keyword">from</span> sales </span><br><span class="line"><span class="keyword">where</span> sale_date <span class="operator">&gt;</span> <span class="string">&#x27;2019-03-31&#x27;</span> <span class="keyword">or</span> sale_date <span class="operator">&lt;</span> <span class="string">&#x27;2019-01-01&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>867ms</p>
<p>sum = count</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> product_id, product_name</span><br><span class="line"><span class="keyword">from</span> Sales <span class="keyword">join</span> Product</span><br><span class="line"><span class="keyword">using</span>(product_id)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> product_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">sum</span>(sale_date <span class="keyword">between</span> &quot;2019-01-01&quot; <span class="keyword">and</span> &quot;2019-03-31&quot;) <span class="operator">=</span> <span class="built_in">count</span>(sale_date)</span><br></pre></td></tr></table></figure>

<p>987ms</p>
<p>sum ä¸º0 ç±»ä¼¼äºç¬¬ä¸€ç§è§£æ³•ï¼Œè®¡ç®—äº†sumæ•ˆç‡å°±ä½äº†</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> p.product_id, p.product_name</span><br><span class="line"><span class="keyword">from</span> sales s, product p</span><br><span class="line"><span class="keyword">where</span> s.product_id <span class="operator">=</span> p.product_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> s.product_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">sum</span>(s.sale_date<span class="operator">&gt;</span> <span class="string">&#x27;2019-03-31&#x27;</span>)<span class="operator">=</span><span class="number">0</span> <span class="keyword">and</span> <span class="built_in">sum</span>(s.sale_date <span class="operator">&lt;</span> <span class="string">&#x27;2019-01-01&#x27;</span>) <span class="operator">=</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šä¸€è§£æ³•sumæ¢æˆmax</p>
<p>859ms</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> p.product_id, p.product_name</span><br><span class="line"><span class="keyword">from</span> sales s, product p</span><br><span class="line"><span class="keyword">where</span> s.product_id <span class="operator">=</span> p.product_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> s.product_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">min</span>(s.sale_date)<span class="operator">&gt;=</span><span class="string">&#x27;2019-01-01&#x27;</span> <span class="keyword">and</span> <span class="built_in">max</span>(s.sale_date) <span class="operator">&lt;=</span> <span class="string">&#x27;2019-03-31&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="1097-æ¸¸æˆç©æ³•åˆ†æ-V"><a href="#1097-æ¸¸æˆç©æ³•åˆ†æ-V" class="headerlink" title="1097. æ¸¸æˆç©æ³•åˆ†æ V"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/game-play-analysis-v/">1097. æ¸¸æˆç©æ³•åˆ†æ V</a></h4><p>éš¾åº¦å›°éš¾</p>
<p>SQLæ¶æ„</p>
<p><code>Activity</code> æ´»åŠ¨è®°å½•è¡¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| player_id    | int     |</span><br><span class="line">| device_id    | int     |</span><br><span class="line">| event_date   | date    |</span><br><span class="line">| games_played | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">ï¼ˆplayer_idï¼Œevent_dateï¼‰æ˜¯æ­¤è¡¨çš„ä¸»é”®</span><br><span class="line">è¿™å¼ è¡¨æ˜¾ç¤ºäº†æŸäº›æ¸¸æˆçš„ç©å®¶çš„æ´»åŠ¨æƒ…å†µ</span><br><span class="line">æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªç©å®¶çš„è®°å½•ï¼Œä»–åœ¨æŸä¸€å¤©ä½¿ç”¨æŸä¸ªè®¾å¤‡æ³¨é”€ä¹‹å‰ç™»å½•å¹¶ç©äº†å¾ˆå¤šæ¸¸æˆï¼ˆå¯èƒ½æ˜¯ 0ï¼‰</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å°†ç©å®¶çš„å®‰è£…æ—¥æœŸå®šä¹‰ä¸ºè¯¥ç©å®¶çš„ç¬¬ä¸€ä¸ªç™»å½•æ—¥ã€‚</p>
<p>æˆ‘ä»¬è¿˜å°†æŸä¸ªæ—¥æœŸ <code>X</code> çš„ç¬¬ 1 å¤©ç•™å­˜æ—¶é—´å®šä¹‰ä¸ºå®‰è£…æ—¥æœŸä¸º <code>X</code> çš„ç©å®¶çš„æ•°é‡ï¼Œä»–ä»¬åœ¨ <code>X</code> ä¹‹åçš„ä¸€å¤©é‡æ–°ç™»å½•ï¼Œé™¤ä»¥å®‰è£…æ—¥æœŸä¸º <code>X</code> çš„ç©å®¶çš„æ•°é‡ï¼Œå››èˆäº”å…¥åˆ°å°æ•°ç‚¹åä¸¤ä½ã€‚</p>
<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒæŠ¥å‘Šæ¯ä¸ªå®‰è£…æ—¥æœŸã€å½“å¤©å®‰è£…æ¸¸æˆçš„ç©å®¶æ•°é‡å’Œç¬¬ä¸€å¤©çš„ç•™å­˜æ—¶é—´ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Activity è¡¨ï¼š</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| player_id | device_id | event_date | games_played |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| 1         | 2         | 2016-03-01 | 5            |</span><br><span class="line">| 1         | 2         | 2016-03-02 | 6            |</span><br><span class="line">| 2         | 3         | 2017-06-25 | 1            |</span><br><span class="line">| 3         | 1         | 2016-03-01 | 0            |</span><br><span class="line">| 3         | 4         | 2016-07-03 | 5            |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+------------+----------+----------------+</span><br><span class="line">| install_dt | installs | Day1_retention |</span><br><span class="line">+------------+----------+----------------+</span><br><span class="line">| 2016-03-01 | 2        | 0.50           |</span><br><span class="line">| 2017-06-25 | 1        | 0.00           |</span><br><span class="line">+------------+----------+----------------+</span><br><span class="line">ç©å®¶ 1 å’Œ 3 åœ¨ 2016-03-01 å®‰è£…äº†æ¸¸æˆï¼Œä½†åªæœ‰ç©å®¶ 1 åœ¨ 2016-03-02 é‡æ–°ç™»å½•ï¼Œæ‰€ä»¥ 2016-03-01 çš„ç¬¬ä¸€å¤©ç•™å­˜æ—¶é—´æ˜¯ 1/2=0.50</span><br><span class="line">ç©å®¶ 2 åœ¨ 2017-06-25 å®‰è£…äº†æ¸¸æˆï¼Œä½†åœ¨ 2017-06-26 æ²¡æœ‰é‡æ–°ç™»å½•ï¼Œå› æ­¤ 2017-06-25 çš„ç¬¬ä¸€å¤©ç•™å­˜æ—¶é—´ä¸º 0/1=0.00</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> install_dt,<span class="built_in">count</span>(<span class="keyword">distinct</span> player_id)installs,</span><br><span class="line">       round(<span class="built_in">sum</span>(if(datediff(event_date,install_dt)<span class="operator">=</span><span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>))<span class="operator">/</span><span class="built_in">count</span>(<span class="keyword">distinct</span> player_id),<span class="number">2</span>) Day1_retention </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> <span class="operator">*</span>,<span class="built_in">min</span>(event_date) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> player_id) install_dt</span><br><span class="line">    <span class="keyword">from</span> Activity</span><br><span class="line">)t1   </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> install_dt</span><br></pre></td></tr></table></figure>



<h4 id="1098-å°ä¼—ä¹¦ç±"><a href="#1098-å°ä¼—ä¹¦ç±" class="headerlink" title="1098. å°ä¼—ä¹¦ç±"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/unpopular-books/">1098. å°ä¼—ä¹¦ç±</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>ä¹¦ç±è¡¨ <code>Books</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| book_id        | int     |</span><br><span class="line">| name           | varchar |</span><br><span class="line">| available_from | date    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">book_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚</span><br></pre></td></tr></table></figure>

<p>è®¢å•è¡¨ <code>Orders</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| order_id       | int     |</span><br><span class="line">| book_id        | int     |</span><br><span class="line">| quantity       | int     |</span><br><span class="line">| dispatch_date  | date    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">order_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">book_id  æ˜¯ Books è¡¨çš„å¤–é”®ã€‚</span><br></pre></td></tr></table></figure>

<p>ä½ éœ€è¦å†™ä¸€æ®µ SQL å‘½ä»¤ï¼Œç­›é€‰å‡ºè¿‡å»ä¸€å¹´ä¸­è®¢å•æ€»é‡ <strong>å°‘äº10æœ¬</strong> çš„ <strong>ä¹¦ç±</strong> ã€‚</p>
<p>æ³¨æ„ï¼š<strong>ä¸è€ƒè™‘</strong> ä¸Šæ¶ï¼ˆavailable fromï¼‰è·ä»Š <strong>ä¸æ»¡ä¸€ä¸ªæœˆ</strong> çš„ä¹¦ç±ã€‚å¹¶ä¸” <strong>å‡è®¾ä»Šå¤©æ˜¯</strong> <strong>2019-06-23</strong> ã€‚</p>
<p> Write an SQL query that reports the books that have sold less than 10 copies in the last year, excluding books that have been available for less than 1 month from today. Assume today is 2019-06-23.</p>
<p>ä¸‹é¢æ˜¯æ ·ä¾‹è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Books è¡¨ï¼š</span><br><span class="line">+---------+--------------------+----------------+</span><br><span class="line">| book_id | name               | available_from |</span><br><span class="line">+---------+--------------------+----------------+</span><br><span class="line">| 1       | &quot;Kalila And Demna&quot; | 2010-01-01     |</span><br><span class="line">| 2       | &quot;28 Letters&quot;       | 2012-05-12     |</span><br><span class="line">| 3       | &quot;The Hobbit&quot;       | 2019-06-10     |</span><br><span class="line">| 4       | &quot;13 Reasons Why&quot;   | 2019-06-01     |</span><br><span class="line">| 5       | &quot;The Hunger Games&quot; | 2008-09-21     |</span><br><span class="line">+---------+--------------------+----------------+</span><br><span class="line"></span><br><span class="line">Orders è¡¨ï¼š</span><br><span class="line">+----------+---------+----------+---------------+</span><br><span class="line">| order_id | book_id | quantity | dispatch_date |</span><br><span class="line">+----------+---------+----------+---------------+</span><br><span class="line">| 1        | 1       | 2        | 2018-07-26    |</span><br><span class="line">| 2        | 1       | 1        | 2018-11-05    |</span><br><span class="line">| 3        | 3       | 8        | 2019-06-11    |</span><br><span class="line">| 4        | 4       | 6        | 2019-06-05    |</span><br><span class="line">| 5        | 4       | 5        | 2019-06-20    |</span><br><span class="line">| 6        | 5       | 9        | 2009-02-02    |</span><br><span class="line">| 7        | 5       | 8        | 2010-04-13    |</span><br><span class="line">+----------+---------+----------+---------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+-----------+--------------------+</span><br><span class="line">| book_id   | name               |</span><br><span class="line">+-----------+--------------------+</span><br><span class="line">| 1         | &quot;Kalila And Demna&quot; |</span><br><span class="line">| 2         | &quot;28 Letters&quot;       |</span><br><span class="line">| 5         | &quot;The Hunger Games&quot; |</span><br><span class="line">+-----------+--------------------+</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿™é¢˜ä¸­è‹±æ–‡ éƒ½æœ‰æ­§ä¹‰ï¼Œçœ‹ç»“æœè¿›è¡Œåˆ†æ</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> a.book_id, a.name </span><br><span class="line"><span class="keyword">FROM</span> books a <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> orders b <span class="keyword">ON</span> a.book_id<span class="operator">=</span>b.book_id </span><br><span class="line"><span class="keyword">AND</span> dispatch_date <span class="keyword">BETWEEN</span> DATE_ADD(<span class="string">&#x27;2019-06-23&#x27;</span>, <span class="type">INTERVAL</span> <span class="number">-1</span> <span class="keyword">YEAR</span>) <span class="keyword">AND</span> <span class="string">&#x27;2019-06-23&#x27;</span> </span><br><span class="line"><span class="keyword">WHERE</span> a.available_from <span class="operator">&lt;=</span> DATE_ADD(<span class="string">&#x27;2019-06-23&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">-1</span> <span class="keyword">MONTH</span>) </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> a.book_id, a.name </span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">SUM</span>(IFNULL(b.quantity,<span class="number">0</span>)) <span class="operator">&lt;</span> <span class="number">10</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> a.book_id;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ­¤é¢˜æœ‰å‘ï¼Œé¦–å…ˆè®¢å•è¿‘ä¸€å¹´ï¼Œå†è€…quantityä¸ºnullï¼Œè¿˜æœ‰è¿‘ä¸€æœˆå‡ºç‰ˆï¼Œsumä¸æ˜¯è®¢å•æ˜¯æœ¬æ•°</p>
<p>è¿˜æœ‰å°±æ˜¯date_addè¿™ä¸ªå‡½æ•°åœ¨hiveé‡Œå’Œmysqlè¯­æ³•ä¸Šæœ‰ç‚¹å°åŒºåˆ«</p>
</blockquote>
<h4 id="1107-æ¯æ—¥æ–°ç”¨æˆ·ç»Ÿè®¡"><a href="#1107-æ¯æ—¥æ–°ç”¨æˆ·ç»Ÿè®¡" class="headerlink" title="1107. æ¯æ—¥æ–°ç”¨æˆ·ç»Ÿè®¡"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/new-users-daily-count/">1107. æ¯æ—¥æ–°ç”¨æˆ·ç»Ÿè®¡</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p><code>Traffic</code> è¡¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| activity      | enum    |</span><br><span class="line">| activity_date | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">è¯¥è¡¨æ²¡æœ‰ä¸»é”®ï¼Œå®ƒå¯èƒ½æœ‰é‡å¤çš„è¡Œã€‚</span><br><span class="line">activity åˆ—æ˜¯ ENUM ç±»å‹ï¼Œå¯èƒ½å– (&#x27;login&#x27;, &#x27;logout&#x27;, &#x27;jobs&#x27;, &#x27;groups&#x27;, &#x27;homepage&#x27;) å‡ ä¸ªå€¼ä¹‹ä¸€ã€‚</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œä»¥æŸ¥è¯¢ä»ä»Šå¤©èµ·æœ€å¤š 90 å¤©å†…ï¼Œæ¯ä¸ªæ—¥æœŸè¯¥æ—¥æœŸé¦–æ¬¡ç™»å½•çš„ç”¨æˆ·æ•°ã€‚å‡è®¾ä»Šå¤©æ˜¯ <strong>2019-06-30</strong>.</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Traffic è¡¨ï¼š</span><br><span class="line">+---------+----------+---------------+</span><br><span class="line">| user_id | activity | activity_date |</span><br><span class="line">+---------+----------+---------------+</span><br><span class="line">| 1       | login    | 2019-05-01    |</span><br><span class="line">| 1       | homepage | 2019-05-01    |</span><br><span class="line">| 1       | logout   | 2019-05-01    |</span><br><span class="line">| 2       | login    | 2019-06-21    |</span><br><span class="line">| 2       | logout   | 2019-06-21    |</span><br><span class="line">| 3       | login    | 2019-01-01    |</span><br><span class="line">| 3       | jobs     | 2019-01-01    |</span><br><span class="line">| 3       | logout   | 2019-01-01    |</span><br><span class="line">| 4       | login    | 2019-06-21    |</span><br><span class="line">| 4       | groups   | 2019-06-21    |</span><br><span class="line">| 4       | logout   | 2019-06-21    |</span><br><span class="line">| 5       | login    | 2019-03-01    |</span><br><span class="line">| 5       | logout   | 2019-03-01    |</span><br><span class="line">| 5       | login    | 2019-06-21    |</span><br><span class="line">| 5       | logout   | 2019-06-21    |</span><br><span class="line">+---------+----------+---------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+------------+-------------+</span><br><span class="line">| login_date | user_count  |</span><br><span class="line">+------------+-------------+</span><br><span class="line">| 2019-05-01 | 1           |</span><br><span class="line">| 2019-06-21 | 2           |</span><br><span class="line">+------------+-------------+</span><br><span class="line">è¯·æ³¨æ„ï¼Œæˆ‘ä»¬åªå…³å¿ƒç”¨æˆ·æ•°éé›¶çš„æ—¥æœŸ.</span><br><span class="line">ID ä¸º 5 çš„ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»é™†äº 2019-03-01ï¼Œå› æ­¤ä»–ä¸ç®—åœ¨ 2019-06-21 çš„çš„ç»Ÿè®¡å†…ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> login_date,<span class="built_in">count</span>(<span class="operator">*</span>) user_count</span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line">    <span class="keyword">select</span> user_id,<span class="built_in">min</span>(activity_date) login_date</span><br><span class="line">    <span class="keyword">from</span> Traffic</span><br><span class="line">    <span class="keyword">where</span> activity <span class="operator">=</span> <span class="string">&#x27;login&#x27;</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> user_id</span><br><span class="line">    <span class="keyword">having</span> login_date<span class="operator">&gt;=</span> DATE_ADD(<span class="string">&#x27;2019-06-30&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">-90</span> <span class="keyword">DAY</span>) </span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> login_date</span><br></pre></td></tr></table></figure>

<h4 id="1112-æ¯ä½å­¦ç”Ÿçš„æœ€é«˜æˆç»©"><a href="#1112-æ¯ä½å­¦ç”Ÿçš„æœ€é«˜æˆç»©" class="headerlink" title="1112. æ¯ä½å­¦ç”Ÿçš„æœ€é«˜æˆç»©"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/highest-grade-for-each-student/">1112. æ¯ä½å­¦ç”Ÿçš„æœ€é«˜æˆç»©</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>è¡¨ï¼š<code>Enrollments</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| student_id    | int     |</span><br><span class="line">| course_id     | int     |</span><br><span class="line">| grade         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(student_id, course_id) æ˜¯è¯¥è¡¨çš„ä¸»é”®ã€‚</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒæŸ¥è¯¢æ¯ä½å­¦ç”Ÿè·å¾—çš„æœ€é«˜æˆç»©å’Œå®ƒæ‰€å¯¹åº”çš„ç§‘ç›®ï¼Œè‹¥ç§‘ç›®æˆç»©å¹¶åˆ—ï¼Œå– <code>course_id</code> æœ€å°çš„ä¸€é—¨ã€‚æŸ¥è¯¢ç»“æœéœ€æŒ‰ <code>student_id</code> å¢åºè¿›è¡Œæ’åºã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Enrollments è¡¨ï¼š</span><br><span class="line">+------------+-------------------+</span><br><span class="line">| student_id | course_id | grade |</span><br><span class="line">+------------+-----------+-------+</span><br><span class="line">| 2          | 2         | 95    |</span><br><span class="line">| 2          | 3         | 95    |</span><br><span class="line">| 1          | 1         | 90    |</span><br><span class="line">| 1          | 2         | 99    |</span><br><span class="line">| 3          | 1         | 80    |</span><br><span class="line">| 3          | 2         | 75    |</span><br><span class="line">| 3          | 3         | 82    |</span><br><span class="line">+------------+-----------+-------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+------------+-------------------+</span><br><span class="line">| student_id | course_id | grade |</span><br><span class="line">+------------+-----------+-------+</span><br><span class="line">| 1          | 2         | 99    |</span><br><span class="line">| 2          | 2         | 95    |</span><br><span class="line">| 3          | 3         | 82    |</span><br><span class="line">+------------+-----------+-------+</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> student_id,course_id ,grade</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span> student_id,course_id ,grade,</span><br><span class="line"><span class="built_in">rank</span>()<span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> student_id <span class="keyword">order</span> <span class="keyword">by</span> grade <span class="keyword">desc</span>,course_id) rK</span><br><span class="line"><span class="keyword">from</span> Enrollments</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> rk <span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>



<h4 id="1113-æŠ¥å‘Šçš„è®°å½•"><a href="#1113-æŠ¥å‘Šçš„è®°å½•" class="headerlink" title="1113. æŠ¥å‘Šçš„è®°å½•"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/reported-posts/">1113. æŠ¥å‘Šçš„è®°å½•</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>åŠ¨ä½œè¡¨ï¼š<code>Actions</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| post_id       | int     |</span><br><span class="line">| action_date   | date    | </span><br><span class="line">| action        | enum    |</span><br><span class="line">| extra         | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">æ­¤è¡¨æ²¡æœ‰ä¸»é”®ï¼Œæ‰€ä»¥å¯èƒ½ä¼šæœ‰é‡å¤çš„è¡Œã€‚</span><br><span class="line">action å­—æ®µæ˜¯ ENUM ç±»å‹çš„ï¼ŒåŒ…å«:(&#x27;view&#x27;, &#x27;like&#x27;, &#x27;reaction&#x27;, &#x27;comment&#x27;, &#x27;report&#x27;, &#x27;share&#x27;)</span><br><span class="line">extra å­—æ®µæ˜¯å¯é€‰çš„ä¿¡æ¯ï¼ˆå¯èƒ½ä¸º nullï¼‰ï¼Œå…¶ä¸­çš„ä¿¡æ¯ä¾‹å¦‚æœ‰ï¼š1.æŠ¥å‘Šç†ç”±(a reason for report) 2.ååº”ç±»å‹(a type of reaction)</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ä¸€æ¡SQLï¼ŒæŸ¥è¯¢æ¯ç§ <em><strong>æŠ¥å‘Šç†ç”±</strong></em>ï¼ˆreport reasonï¼‰åœ¨æ˜¨å¤©çš„æŠ¥å‘Šæ•°é‡ã€‚å‡è®¾ä»Šå¤©æ˜¯ <strong>2019-07-05</strong>ã€‚</p>
<p>æŸ¥è¯¢åŠç»“æœçš„æ ¼å¼ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Actions table:</span><br><span class="line">+---------+---------+-------------+--------+--------+</span><br><span class="line">| user_id | post_id | action_date | action | extra  |</span><br><span class="line">+---------+---------+-------------+--------+--------+</span><br><span class="line">| 1       | 1       | 2019-07-01  | view   | null   |</span><br><span class="line">| 1       | 1       | 2019-07-01  | like   | null   |</span><br><span class="line">| 1       | 1       | 2019-07-01  | share  | null   |</span><br><span class="line">| 2       | 4       | 2019-07-04  | view   | null   |</span><br><span class="line">| 2       | 4       | 2019-07-04  | report | spam   |</span><br><span class="line">| 3       | 4       | 2019-07-04  | view   | null   |</span><br><span class="line">| 3       | 4       | 2019-07-04  | report | spam   |</span><br><span class="line">| 4       | 3       | 2019-07-02  | view   | null   |</span><br><span class="line">| 4       | 3       | 2019-07-02  | report | spam   |</span><br><span class="line">| 5       | 2       | 2019-07-04  | view   | null   |</span><br><span class="line">| 5       | 2       | 2019-07-04  | report | racism |</span><br><span class="line">| 5       | 5       | 2019-07-04  | view   | null   |</span><br><span class="line">| 5       | 5       | 2019-07-04  | report | racism |</span><br><span class="line">+---------+---------+-------------+--------+--------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+---------------+--------------+</span><br><span class="line">| report_reason | report_count |</span><br><span class="line">+---------------+--------------+</span><br><span class="line">| spam          | 1            |</span><br><span class="line">| racism        | 2            |</span><br><span class="line">+---------------+--------------+ </span><br><span class="line">æ³¨æ„ï¼Œæˆ‘ä»¬åªå…³å¿ƒæŠ¥å‘Šæ•°é‡éé›¶çš„ç»“æœã€‚</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	extra <span class="keyword">AS</span> report_reason,</span><br><span class="line">	<span class="built_in">COUNT</span>(<span class="keyword">distinct</span> post_id) <span class="keyword">AS</span> report_count</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	Actions</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	`action` <span class="operator">=</span> <span class="string">&#x27;report&#x27;</span> <span class="keyword">AND</span> action_date <span class="operator">=</span> date_add(<span class="string">&#x27;2019-07-05&#x27;</span>,<span class="type">Interval</span> <span class="number">-1</span> <span class="keyword">day</span>)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">	extra;</span><br></pre></td></tr></table></figure>

<h4 id="1132-æŠ¥å‘Šçš„è®°å½•-II"><a href="#1132-æŠ¥å‘Šçš„è®°å½•-II" class="headerlink" title="1132. æŠ¥å‘Šçš„è®°å½• II"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/reported-posts-ii/">1132. æŠ¥å‘Šçš„è®°å½• II</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>åŠ¨ä½œè¡¨ï¼š <code>Actions</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| post_id       | int     |</span><br><span class="line">| action_date   | date    |</span><br><span class="line">| action        | enum    |</span><br><span class="line">| extra         | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">è¿™å¼ è¡¨æ²¡æœ‰ä¸»é”®ï¼Œå¹¶æœ‰å¯èƒ½å­˜åœ¨é‡å¤çš„è¡Œã€‚</span><br><span class="line">action åˆ—çš„ç±»å‹æ˜¯ ENUMï¼Œå¯èƒ½çš„å€¼ä¸º (&#x27;view&#x27;, &#x27;like&#x27;, &#x27;reaction&#x27;, &#x27;comment&#x27;, &#x27;report&#x27;, &#x27;share&#x27;)ã€‚</span><br><span class="line">extra åˆ—æ‹¥æœ‰ä¸€äº›å¯é€‰ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šæŠ¥å‘Šç†ç”±ï¼ˆa reason for reportï¼‰æˆ–ååº”ç±»å‹ï¼ˆa type of reactionï¼‰ç­‰ã€‚</span><br></pre></td></tr></table></figure>

<p>ç§»é™¤è¡¨ï¼š <code>Removals</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| post_id       | int     |</span><br><span class="line">| remove_date   | date    | </span><br><span class="line">+---------------+---------+</span><br><span class="line">è¿™å¼ è¡¨çš„ä¸»é”®æ˜¯ post_idã€‚</span><br><span class="line">è¿™å¼ è¡¨çš„æ¯ä¸€è¡Œè¡¨ç¤ºä¸€ä¸ªè¢«ç§»é™¤çš„å¸–å­ï¼ŒåŸå› å¯èƒ½æ˜¯ç”±äºè¢«ä¸¾æŠ¥æˆ–è¢«ç®¡ç†å‘˜å®¡æŸ¥ã€‚</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ä¸€æ®µ SQL æ¥æŸ¥æ‰¾ï¼šåœ¨è¢«æŠ¥å‘Šä¸ºåƒåœ¾å¹¿å‘Šçš„å¸–å­ä¸­ï¼Œè¢«ç§»é™¤çš„å¸–å­çš„æ¯æ—¥å¹³å‡å æ¯”ï¼Œ<strong>å››èˆäº”å…¥åˆ°å°æ•°ç‚¹å 2 ä½</strong>ã€‚</p>
<p>æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Actions table:</span><br><span class="line">+---------+---------+-------------+--------+--------+</span><br><span class="line">| user_id | post_id | action_date | action | extra  |</span><br><span class="line">+---------+---------+-------------+--------+--------+</span><br><span class="line">| 1       | 1       | 2019-07-01  | view   | null   |</span><br><span class="line">| 1       | 1       | 2019-07-01  | like   | null   |</span><br><span class="line">| 1       | 1       | 2019-07-01  | share  | null   |</span><br><span class="line">| 2       | 2       | 2019-07-04  | view   | null   |</span><br><span class="line">| 2       | 2       | 2019-07-04  | report | spam   |</span><br><span class="line">| 3       | 4       | 2019-07-04  | view   | null   |</span><br><span class="line">| 3       | 4       | 2019-07-04  | report | spam   |</span><br><span class="line">| 4       | 3       | 2019-07-02  | view   | null   |</span><br><span class="line">| 4       | 3       | 2019-07-02  | report | spam   |</span><br><span class="line">| 5       | 2       | 2019-07-03  | view   | null   |</span><br><span class="line">| 5       | 2       | 2019-07-03  | report | racism |</span><br><span class="line">| 5       | 5       | 2019-07-03  | view   | null   |</span><br><span class="line">| 5       | 5       | 2019-07-03  | report | racism |</span><br><span class="line">+---------+---------+-------------+--------+--------+</span><br><span class="line"></span><br><span class="line">Removals table:</span><br><span class="line">+---------+-------------+</span><br><span class="line">| post_id | remove_date |</span><br><span class="line">+---------+-------------+</span><br><span class="line">| 2       | 2019-07-20  |</span><br><span class="line">| 3       | 2019-07-18  |</span><br><span class="line">+---------+-------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-----------------------+</span><br><span class="line">| average_daily_percent |</span><br><span class="line">+-----------------------+</span><br><span class="line">| 75.00                 |</span><br><span class="line">+-----------------------+</span><br><span class="line">2019-07-04 çš„åƒåœ¾å¹¿å‘Šç§»é™¤ç‡æ˜¯ 50%ï¼Œå› ä¸ºæœ‰ä¸¤å¼ å¸–å­è¢«æŠ¥å‘Šä¸ºåƒåœ¾å¹¿å‘Šï¼Œä½†åªæœ‰ä¸€ä¸ªå¾—åˆ°ç§»é™¤ã€‚</span><br><span class="line">2019-07-02 çš„åƒåœ¾å¹¿å‘Šç§»é™¤ç‡æ˜¯ 100%ï¼Œå› ä¸ºæœ‰ä¸€å¼ å¸–å­è¢«ä¸¾æŠ¥ä¸ºåƒåœ¾å¹¿å‘Šå¹¶å¾—åˆ°ç§»é™¤ã€‚</span><br><span class="line">å…¶ä½™å‡ å¤©æ²¡æœ‰æ”¶åˆ°åƒåœ¾å¹¿å‘Šçš„ä¸¾æŠ¥ï¼Œå› æ­¤å¹³å‡å€¼ä¸ºï¼š(50 + 100) / 2 = 75%</span><br><span class="line">æ³¨æ„ï¼Œè¾“å‡ºä»…éœ€è¦ä¸€ä¸ªå¹³å‡å€¼å³å¯ï¼Œæˆ‘ä»¬å¹¶ä¸å…³æ³¨ç§»é™¤æ“ä½œçš„æ—¥æœŸã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="built_in">AVG</span>(proportion) <span class="operator">*</span> <span class="number">100</span>, <span class="number">2</span>) <span class="keyword">AS</span> average_daily_percent  </span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> actions.action_date, <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> removals.post_id)<span class="operator">/</span><span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> actions.post_id) <span class="keyword">AS</span> proportion</span><br><span class="line">    <span class="keyword">FROM</span> actions</span><br><span class="line">    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> removals</span><br><span class="line">    <span class="keyword">ON</span> actions.post_id <span class="operator">=</span> removals.post_id</span><br><span class="line">    <span class="keyword">WHERE</span> extra <span class="operator">=</span> <span class="string">&#x27;spam&#x27;</span> </span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> actions.action_date</span><br><span class="line">) a</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¦ç†è§£spamçš„å«ä¹‰</p>
</blockquote>
<h4 id="1126-æŸ¥è¯¢æ´»è·ƒä¸šåŠ¡"><a href="#1126-æŸ¥è¯¢æ´»è·ƒä¸šåŠ¡" class="headerlink" title="1126. æŸ¥è¯¢æ´»è·ƒä¸šåŠ¡"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/active-businesses/">1126. æŸ¥è¯¢æ´»è·ƒä¸šåŠ¡</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>äº‹ä»¶è¡¨ï¼š<code>Events</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| business_id   | int     |</span><br><span class="line">| event_type    | varchar |</span><br><span class="line">| occurences    | int     | </span><br><span class="line">+---------------+---------+</span><br><span class="line">æ­¤è¡¨çš„ä¸»é”®æ˜¯ (business_id, event_type)ã€‚</span><br><span class="line">è¡¨ä¸­çš„æ¯ä¸€è¡Œè®°å½•äº†æŸç§ç±»å‹çš„äº‹ä»¶åœ¨æŸäº›ä¸šåŠ¡ä¸­å¤šæ¬¡å‘ç”Ÿçš„ä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€æ®µ SQL æ¥æŸ¥è¯¢æ‰€æœ‰æ´»è·ƒçš„ä¸šåŠ¡ã€‚</p>
<p>å¦‚æœä¸€ä¸ªä¸šåŠ¡çš„æŸä¸ªäº‹ä»¶ç±»å‹çš„å‘ç”Ÿæ¬¡æ•°å¤§äºæ­¤äº‹ä»¶ç±»å‹åœ¨æ‰€æœ‰ä¸šåŠ¡ä¸­çš„å¹³å‡å‘ç”Ÿæ¬¡æ•°ï¼Œå¹¶ä¸”è¯¥ä¸šåŠ¡è‡³å°‘æœ‰ä¸¤ä¸ªè¿™æ ·çš„äº‹ä»¶ç±»å‹ï¼Œé‚£ä¹ˆè¯¥ä¸šåŠ¡å°±å¯è¢«çœ‹åšæ˜¯æ´»è·ƒä¸šåŠ¡ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Events table:</span><br><span class="line">+-------------+------------+------------+</span><br><span class="line">| business_id | event_type | occurences |</span><br><span class="line">+-------------+------------+------------+</span><br><span class="line">| 1           | reviews    | 7          |</span><br><span class="line">| 3           | reviews    | 3          |</span><br><span class="line">| 1           | ads        | 11         |</span><br><span class="line">| 2           | ads        | 7          |</span><br><span class="line">| 3           | ads        | 6          |</span><br><span class="line">| 1           | page views | 3          |</span><br><span class="line">| 2           | page views | 12         |</span><br><span class="line">+-------------+------------+------------+</span><br><span class="line"></span><br><span class="line">ç»“æœè¡¨</span><br><span class="line">+-------------+</span><br><span class="line">| business_id |</span><br><span class="line">+-------------+</span><br><span class="line">| 1           |</span><br><span class="line">+-------------+ </span><br><span class="line">&#x27;reviews&#x27;ã€ &#x27;ads&#x27; å’Œ &#x27;page views&#x27; çš„æ€»å¹³å‡å‘ç”Ÿæ¬¡æ•°åˆ†åˆ«æ˜¯ (7+3)/2=5, (11+7+6)/3=8, (3+12)/2=7.5ã€‚</span><br><span class="line">id ä¸º 1 çš„ä¸šåŠ¡æœ‰ 7 ä¸ª &#x27;reviews&#x27; äº‹ä»¶ï¼ˆå¤§äº 5ï¼‰å’Œ 11 ä¸ª &#x27;ads&#x27; äº‹ä»¶ï¼ˆå¤§äº 8ï¼‰ï¼Œæ‰€ä»¥å®ƒæ˜¯æ´»è·ƒä¸šåŠ¡ã€‚</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> business_id</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> business_id,occurences,</span><br><span class="line">    <span class="built_in">avg</span>(occurences) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> event_type) avo</span><br><span class="line">    <span class="keyword">from</span> Events</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span>  occurences <span class="operator">&gt;</span> avo</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> business_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">&gt;=</span><span class="number">2</span></span><br></pre></td></tr></table></figure>

<h4 id="1127-ç”¨æˆ·è´­ä¹°å¹³å°"><a href="#1127-ç”¨æˆ·è´­ä¹°å¹³å°" class="headerlink" title="1127. ç”¨æˆ·è´­ä¹°å¹³å°"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/user-purchase-platform/">1127. ç”¨æˆ·è´­ä¹°å¹³å°</a></h4><p>éš¾åº¦å›°éš¾</p>
<p>SQLæ¶æ„</p>
<p>æ”¯å‡ºè¡¨: <code>Spending</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| user_id     | int     |</span><br><span class="line">| spend_date  | date    |</span><br><span class="line">| platform    | enum    | </span><br><span class="line">| amount      | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">è¿™å¼ è¡¨è®°å½•äº†ç”¨æˆ·åœ¨ä¸€ä¸ªåœ¨çº¿è´­ç‰©ç½‘ç«™çš„æ”¯å‡ºå†å²ï¼Œè¯¥åœ¨çº¿è´­ç‰©å¹³å°åŒæ—¶æ‹¥æœ‰æ¡Œé¢ç«¯ï¼ˆ&#x27;desktop&#x27;ï¼‰å’Œæ‰‹æœºç«¯ï¼ˆ&#x27;mobile&#x27;ï¼‰çš„åº”ç”¨ç¨‹åºã€‚</span><br><span class="line">è¿™å¼ è¡¨çš„ä¸»é”®æ˜¯ (user_id, spend_date, platform)ã€‚</span><br><span class="line">å¹³å°åˆ— platform æ˜¯ä¸€ç§ ENUM ï¼Œç±»å‹ä¸ºï¼ˆ&#x27;desktop&#x27;, &#x27;mobile&#x27;ï¼‰ã€‚</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€æ®µ SQL æ¥æŸ¥æ‰¾æ¯å¤© <strong>ä»…</strong> ä½¿ç”¨æ‰‹æœºç«¯ç”¨æˆ·ã€<strong>ä»…</strong> ä½¿ç”¨æ¡Œé¢ç«¯ç”¨æˆ·å’Œ <strong>åŒæ—¶</strong> ä½¿ç”¨æ¡Œé¢ç«¯å’Œæ‰‹æœºç«¯çš„ç”¨æˆ·äººæ•°å’Œæ€»æ”¯å‡ºé‡‘é¢ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Spending table:</span><br><span class="line">+---------+------------+----------+--------+</span><br><span class="line">| user_id | spend_date | platform | amount |</span><br><span class="line">+---------+------------+----------+--------+</span><br><span class="line">| 1       | 2019-07-01 | mobile   | 100    |</span><br><span class="line">| 1       | 2019-07-01 | desktop  | 100    |</span><br><span class="line">| 2       | 2019-07-01 | mobile   | 100    |</span><br><span class="line">| 2       | 2019-07-02 | mobile   | 100    |</span><br><span class="line">| 3       | 2019-07-01 | desktop  | 100    |</span><br><span class="line">| 3       | 2019-07-02 | desktop  | 100    |</span><br><span class="line">+---------+------------+----------+--------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+----------+--------------+-------------+</span><br><span class="line">| spend_date | platform | total_amount | total_users |</span><br><span class="line">+------------+----------+--------------+-------------+</span><br><span class="line">| 2019-07-01 | desktop  | 100          | 1           |</span><br><span class="line">| 2019-07-01 | mobile   | 100          | 1           |</span><br><span class="line">| 2019-07-01 | both     | 200          | 1           |</span><br><span class="line">| 2019-07-02 | desktop  | 100          | 1           |</span><br><span class="line">| 2019-07-02 | mobile   | 100          | 1           |</span><br><span class="line">| 2019-07-02 | both     | 0            | 0           |</span><br><span class="line">+------------+----------+--------------+-------------+ </span><br><span class="line">åœ¨ 2019-07-01, ç”¨æˆ·1 åŒæ—¶ ä½¿ç”¨æ¡Œé¢ç«¯å’Œæ‰‹æœºç«¯è´­ä¹°, ç”¨æˆ·2 ä»… ä½¿ç”¨äº†æ‰‹æœºç«¯è´­ä¹°ï¼Œè€Œç”¨æˆ·3 ä»… ä½¿ç”¨äº†æ¡Œé¢ç«¯è´­ä¹°ã€‚</span><br><span class="line">åœ¨ 2019-07-02, ç”¨æˆ·2 ä»… ä½¿ç”¨äº†æ‰‹æœºç«¯è´­ä¹°, ç”¨æˆ·3 ä»… ä½¿ç”¨äº†æ¡Œé¢ç«¯è´­ä¹°ï¼Œä¸”æ²¡æœ‰ç”¨æˆ· åŒæ—¶ ä½¿ç”¨æ¡Œé¢ç«¯å’Œæ‰‹æœºç«¯è´­ä¹°ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">    spend_date, platform,</span><br><span class="line">    ifnull(<span class="built_in">sum</span>(total_am),<span class="number">0</span>) total_amount,</span><br><span class="line">    ifnull(<span class="built_in">sum</span>(total_u),<span class="number">0</span>) total_users</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> p.spend_date, p.platform, t.total_am, t.total_u</span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">distinct</span> spend_date, &quot;desktop&quot; platform <span class="keyword">from</span> Spending</span><br><span class="line">        <span class="keyword">union</span></span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">distinct</span> spend_date, &quot;mobile&quot; platform <span class="keyword">from</span> Spending</span><br><span class="line">        <span class="keyword">union</span></span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">distinct</span> spend_date, &quot;both&quot; platform <span class="keyword">from</span> Spending</span><br><span class="line">    ) p</span><br><span class="line">    <span class="keyword">left</span> <span class="keyword">join</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> spend_date, </span><br><span class="line">            if(<span class="built_in">count</span>(<span class="keyword">distinct</span> platform)<span class="operator">=</span><span class="number">1</span>, platform, <span class="string">&#x27;both&#x27;</span>) plat,</span><br><span class="line">            <span class="built_in">sum</span>(amount) total_am,</span><br><span class="line">            <span class="built_in">count</span>(<span class="keyword">distinct</span> user_id) total_u</span><br><span class="line">        <span class="keyword">from</span> Spending</span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> spend_date, user_id</span><br><span class="line">    ) t</span><br><span class="line">    <span class="keyword">on</span> p.platform <span class="operator">=</span> t.plat <span class="keyword">and</span> p.spend_date <span class="operator">=</span> t.spend_date</span><br><span class="line">) temp</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> spend_date, platform</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¿…é¡»ä¿è¯ desktop mobile bothçš„é¡ºåº ï¼Œæ‰€ä»¥ å…ˆåˆ—å‡ºä¸‰ä¸ªå­—æ®µ</p>
</blockquote>
<h4 id="1141-æŸ¥è¯¢è¿‘30å¤©æ´»è·ƒç”¨æˆ·æ•°"><a href="#1141-æŸ¥è¯¢è¿‘30å¤©æ´»è·ƒç”¨æˆ·æ•°" class="headerlink" title="1141. æŸ¥è¯¢è¿‘30å¤©æ´»è·ƒç”¨æˆ·æ•°"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/user-activity-for-the-past-30-days-i/">1141. æŸ¥è¯¢è¿‘30å¤©æ´»è·ƒç”¨æˆ·æ•°</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>æ´»åŠ¨è®°å½•è¡¨ï¼š<code>Activity</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| session_id    | int     |</span><br><span class="line">| activity_date | date    |</span><br><span class="line">| activity_type | enum    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">è¯¥è¡¨æ˜¯ç”¨æˆ·åœ¨ç¤¾äº¤ç½‘ç«™çš„æ´»åŠ¨è®°å½•ã€‚</span><br><span class="line">è¯¥è¡¨æ²¡æœ‰ä¸»é”®ï¼Œå¯èƒ½åŒ…å«é‡å¤æ•°æ®ã€‚</span><br><span class="line">activity_type å­—æ®µä¸ºä»¥ä¸‹å››ç§å€¼ (&#x27;open_session&#x27;, &#x27;end_session&#x27;, &#x27;scroll_down&#x27;, &#x27;send_message&#x27;)ã€‚</span><br><span class="line">æ¯ä¸ª session_id åªå±äºä¸€ä¸ªç”¨æˆ·ã€‚</span><br></pre></td></tr></table></figure>

<p>è¯·å†™SQLæŸ¥è¯¢å‡ºæˆªè‡³ <strong>2019-07-27</strong>ï¼ˆåŒ…å«2019-07-27ï¼‰<strong>ï¼Œè¿‘</strong> 30å¤©çš„æ¯æ—¥æ´»è·ƒç”¨æˆ·æ•°ï¼ˆå½“å¤©åªè¦æœ‰ä¸€æ¡æ´»åŠ¨è®°å½•ï¼Œå³ä¸ºæ´»è·ƒç”¨æˆ·ï¼‰ã€‚</p>
<p>æŸ¥è¯¢ç»“æœç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Activity table:</span><br><span class="line">+---------+------------+---------------+---------------+</span><br><span class="line">| user_id | session_id | activity_date | activity_type |</span><br><span class="line">+---------+------------+---------------+---------------+</span><br><span class="line">| 1       | 1          | 2019-07-20    | open_session  |</span><br><span class="line">| 1       | 1          | 2019-07-20    | scroll_down   |</span><br><span class="line">| 1       | 1          | 2019-07-20    | end_session   |</span><br><span class="line">| 2       | 4          | 2019-07-20    | open_session  |</span><br><span class="line">| 2       | 4          | 2019-07-21    | send_message  |</span><br><span class="line">| 2       | 4          | 2019-07-21    | end_session   |</span><br><span class="line">| 3       | 2          | 2019-07-21    | open_session  |</span><br><span class="line">| 3       | 2          | 2019-07-21    | send_message  |</span><br><span class="line">| 3       | 2          | 2019-07-21    | end_session   |</span><br><span class="line">| 4       | 3          | 2019-06-25    | open_session  |</span><br><span class="line">| 4       | 3          | 2019-06-25    | end_session   |</span><br><span class="line">+---------+------------+---------------+---------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+--------------+ </span><br><span class="line">| day        | active_users |</span><br><span class="line">+------------+--------------+ </span><br><span class="line">| 2019-07-20 | 2            |</span><br><span class="line">| 2019-07-21 | 2            |</span><br><span class="line">+------------+--------------+ </span><br><span class="line">éæ´»è·ƒç”¨æˆ·çš„è®°å½•ä¸éœ€è¦å±•ç¤ºã€‚</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> activity_date <span class="keyword">day</span>,<span class="built_in">count</span>(<span class="keyword">distinct</span> user_id) active_users</span><br><span class="line"><span class="keyword">from</span> Activity</span><br><span class="line"><span class="keyword">where</span> activity_date <span class="operator">&gt;</span> date_add(<span class="string">&#x27;2019-07-27&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">-1</span> <span class="keyword">MONTH</span>)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> activity_date</span><br></pre></td></tr></table></figure>

<h4 id="1142-è¿‡å»30å¤©çš„ç”¨æˆ·æ´»åŠ¨-II"><a href="#1142-è¿‡å»30å¤©çš„ç”¨æˆ·æ´»åŠ¨-II" class="headerlink" title="1142. è¿‡å»30å¤©çš„ç”¨æˆ·æ´»åŠ¨ II"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/user-activity-for-the-past-30-days-ii/">1142. è¿‡å»30å¤©çš„ç”¨æˆ·æ´»åŠ¨ II</a></h4><p>éš¾åº¦ç®€å•7æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡å…³æ³¨åé¦ˆ</p>
<p>SQLæ¶æ„</p>
<p>Table: <code>Activity</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| session_id    | int     |</span><br><span class="line">| activity_date | date    |</span><br><span class="line">| activity_type | enum    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">è¯¥è¡¨æ²¡æœ‰ä¸»é”®ï¼Œå®ƒå¯èƒ½æœ‰é‡å¤çš„è¡Œã€‚</span><br><span class="line">activity_typeåˆ—æ˜¯ä¸€ç§ç±»å‹çš„ENUMï¼ˆâ€œ open_sessionâ€ï¼Œâ€œ end_sessionâ€ï¼Œâ€œ scroll_downâ€ï¼Œâ€œ send_messageâ€ï¼‰ã€‚</span><br><span class="line">è¯¥è¡¨æ˜¾ç¤ºäº†ç¤¾äº¤åª’ä½“ç½‘ç«™çš„ç”¨æˆ·æ´»åŠ¨ã€‚</span><br><span class="line">è¯·æ³¨æ„ï¼Œæ¯ä¸ªä¼šè¯å®Œå…¨å±äºä¸€ä¸ªç”¨æˆ·ã€‚</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™SQLæŸ¥è¯¢ä»¥æŸ¥æ‰¾æˆªè‡³2019å¹´7æœˆ27æ—¥ï¼ˆå«ï¼‰çš„30å¤©å†…æ¯ä¸ªç”¨æˆ·çš„å¹³å‡ä¼šè¯æ•°ï¼Œå››èˆäº”å…¥åˆ°å°æ•°ç‚¹åä¸¤ä½ã€‚æˆ‘ä»¬åªç»Ÿè®¡é‚£äº›ä¼šè¯æœŸé—´ç”¨æˆ·è‡³å°‘è¿›è¡Œä¸€é¡¹æ´»åŠ¨çš„æœ‰æ•ˆä¼šè¯ã€‚ </p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Activity table:</span><br><span class="line">+---------+------------+---------------+---------------+</span><br><span class="line">| user_id | session_id | activity_date | activity_type |</span><br><span class="line">+---------+------------+---------------+---------------+</span><br><span class="line">| 1       | 1          | 2019-07-20    | open_session  |</span><br><span class="line">| 1       | 1          | 2019-07-20    | scroll_down   |</span><br><span class="line">| 1       | 1          | 2019-07-20    | end_session   |</span><br><span class="line">| 2       | 4          | 2019-07-20    | open_session  |</span><br><span class="line">| 2       | 4          | 2019-07-21    | send_message  |</span><br><span class="line">| 2       | 4          | 2019-07-21    | end_session   |</span><br><span class="line">| 3       | 2          | 2019-07-21    | open_session  |</span><br><span class="line">| 3       | 2          | 2019-07-21    | send_message  |</span><br><span class="line">| 3       | 2          | 2019-07-21    | end_session   |</span><br><span class="line">| 3       | 5          | 2019-07-21    | open_session  |</span><br><span class="line">| 3       | 5          | 2019-07-21    | scroll_down   |</span><br><span class="line">| 3       | 5          | 2019-07-21    | end_session   |</span><br><span class="line">| 4       | 3          | 2019-06-25    | open_session  |</span><br><span class="line">| 4       | 3          | 2019-06-25    | end_session   |</span><br><span class="line">+---------+------------+---------------+---------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+---------------------------+ </span><br><span class="line">| average_sessions_per_user |</span><br><span class="line">+---------------------------+ </span><br><span class="line">| 1.33                      |</span><br><span class="line">+---------------------------+ </span><br><span class="line">User 1 å’Œ 2 åœ¨è¿‡å»30å¤©å†…å„è‡ªè¿›è¡Œäº†1æ¬¡ä¼šè¯ï¼Œè€Œç”¨æˆ·3è¿›è¡Œäº†2æ¬¡ä¼šè¯ï¼Œå› æ­¤å¹³å‡å€¼ä¸ºï¼ˆ1 +1 + 2ï¼‰/ 3 = 1.33ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> IFNULL(ROUND(<span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> session_id) <span class="operator">/</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> user_id), <span class="number">2</span>), <span class="number">0</span>) <span class="keyword">AS</span> average_sessions_per_user</span><br><span class="line"><span class="keyword">from</span> Activity</span><br><span class="line"><span class="keyword">where</span> activity_date <span class="operator">&gt;</span> date_add(<span class="string">&#x27;2019-07-27&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">-1</span> <span class="keyword">MONTH</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>1ä¸ªsession id ä»£è¡¨ä¸€æ¬¡ä¼šè¯</p>
</blockquote>
<h4 id="1148-æ–‡ç« æµè§ˆ-I"><a href="#1148-æ–‡ç« æµè§ˆ-I" class="headerlink" title="1148. æ–‡ç« æµè§ˆ I"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/article-views-i/">1148. æ–‡ç« æµè§ˆ I</a></h4><p>éš¾åº¦ç®€å•3æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡å…³æ³¨åé¦ˆ</p>
<p>SQLæ¶æ„</p>
<p><code>Views</code> è¡¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| article_id    | int     |</span><br><span class="line">| author_id     | int     |</span><br><span class="line">| viewer_id     | int     |</span><br><span class="line">| view_date     | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">æ­¤è¡¨æ— ä¸»é”®ï¼Œå› æ­¤å¯èƒ½ä¼šå­˜åœ¨é‡å¤è¡Œã€‚</span><br><span class="line">æ­¤è¡¨çš„æ¯ä¸€è¡Œéƒ½è¡¨ç¤ºæŸäººåœ¨æŸå¤©æµè§ˆäº†æŸä½ä½œè€…çš„æŸç¯‡æ–‡ç« ã€‚</span><br><span class="line">è¯·æ³¨æ„ï¼ŒåŒä¸€äººçš„ author_id å’Œ viewer_id æ˜¯ç›¸åŒçš„ã€‚</span><br></pre></td></tr></table></figure>

<p>è¯·ç¼–å†™ä¸€æ¡ SQL æŸ¥è¯¢ä»¥æ‰¾å‡ºæ‰€æœ‰æµè§ˆè¿‡è‡ªå·±æ–‡ç« çš„ä½œè€…ï¼Œç»“æœæŒ‰ç…§ id å‡åºæ’åˆ—ã€‚</p>
<p>æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Views è¡¨ï¼š</span><br><span class="line">+------------+-----------+-----------+------------+</span><br><span class="line">| article_id | author_id | viewer_id | view_date  |</span><br><span class="line">+------------+-----------+-----------+------------+</span><br><span class="line">| 1          | 3         | 5         | 2019-08-01 |</span><br><span class="line">| 1          | 3         | 6         | 2019-08-02 |</span><br><span class="line">| 2          | 7         | 7         | 2019-08-01 |</span><br><span class="line">| 2          | 7         | 6         | 2019-08-02 |</span><br><span class="line">| 4          | 7         | 1         | 2019-07-22 |</span><br><span class="line">| 3          | 4         | 4         | 2019-07-21 |</span><br><span class="line">| 3          | 4         | 4         | 2019-07-21 |</span><br><span class="line">+------------+-----------+-----------+------------+</span><br><span class="line"></span><br><span class="line">ç»“æœè¡¨ï¼š</span><br><span class="line">+------+</span><br><span class="line">| id   |</span><br><span class="line">+------+</span><br><span class="line">| 4    |</span><br><span class="line">| 7    |</span><br><span class="line">+------+</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> author_id id</span><br><span class="line"><span class="keyword">from</span> Views</span><br><span class="line"><span class="keyword">where</span> author_id<span class="operator">=</span>  viewer_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> id</span><br></pre></td></tr></table></figure>



<h4 id="1149-æ–‡ç« æµè§ˆ-II"><a href="#1149-æ–‡ç« æµè§ˆ-II" class="headerlink" title="1149. æ–‡ç« æµè§ˆ II"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/article-views-ii/">1149. æ–‡ç« æµè§ˆ II</a></h4><p>éš¾åº¦ä¸­ç­‰4æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡å…³æ³¨åé¦ˆ</p>
<p>SQLæ¶æ„</p>
<p>Table: <code>Views</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| article_id    | int     |</span><br><span class="line">| author_id     | int     |</span><br><span class="line">| viewer_id     | int     |</span><br><span class="line">| view_date     | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">æ­¤è¡¨æ— ä¸»é”®ï¼Œå› æ­¤å¯èƒ½ä¼šå­˜åœ¨é‡å¤è¡Œã€‚æ­¤è¡¨çš„æ¯ä¸€è¡Œéƒ½è¡¨ç¤ºæŸäººåœ¨æŸå¤©æµè§ˆäº†æŸä½ä½œè€…çš„æŸç¯‡æ–‡ç« ã€‚ è¯·æ³¨æ„ï¼ŒåŒä¸€äººçš„ author_id å’Œ viewer_id æ˜¯ç›¸åŒçš„ã€‚</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ä¸€æ¡ SQL æŸ¥è¯¢æ¥æ‰¾å‡ºåœ¨åŒä¸€å¤©é˜…è¯»è‡³å°‘ä¸¤ç¯‡æ–‡ç« çš„äººï¼Œç»“æœæŒ‰ç…§ id å‡åºæ’åºã€‚</p>
<p>æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Views table:</span><br><span class="line">+------------+-----------+-----------+------------+</span><br><span class="line">| article_id | author_id | viewer_id | view_date  |</span><br><span class="line">+------------+-----------+-----------+------------+</span><br><span class="line">| 1          | 3         | 5         | 2019-08-01 |</span><br><span class="line">| 3          | 4         | 5         | 2019-08-01 |</span><br><span class="line">| 1          | 3         | 6         | 2019-08-02 |</span><br><span class="line">| 2          | 7         | 7         | 2019-08-01 |</span><br><span class="line">| 2          | 7         | 6         | 2019-08-02 |</span><br><span class="line">| 4          | 7         | 1         | 2019-07-22 |</span><br><span class="line">| 3          | 4         | 4         | 2019-07-21 |</span><br><span class="line">| 3          | 4         | 4         | 2019-07-21 |</span><br><span class="line">+------------+-----------+-----------+------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------+</span><br><span class="line">| id   |</span><br><span class="line">+------+</span><br><span class="line">| 5    |</span><br><span class="line">| 6    |</span><br><span class="line">+------+</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> viewer_id <span class="keyword">AS</span> id</span><br><span class="line"><span class="keyword">FROM</span> Views</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> view_date, viewer_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> article_id) <span class="operator">&gt;=</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> viewer_id</span><br></pre></td></tr></table></figure>

<h4 id="1158-å¸‚åœºåˆ†æ-I"><a href="#1158-å¸‚åœºåˆ†æ-I" class="headerlink" title="1158. å¸‚åœºåˆ†æ I"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/market-analysis-i/">1158. å¸‚åœºåˆ†æ I</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>Table: <code>Users</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| user_id        | int     |</span><br><span class="line">| join_date      | date    |</span><br><span class="line">| favorite_brand | varchar |</span><br><span class="line">+----------------+---------+</span><br><span class="line">æ­¤è¡¨ä¸»é”®æ˜¯ user_idï¼Œè¡¨ä¸­æè¿°äº†è´­ç‰©ç½‘ç«™çš„ç”¨æˆ·ä¿¡æ¯ï¼Œç”¨æˆ·å¯ä»¥åœ¨æ­¤ç½‘ç«™ä¸Šè¿›è¡Œå•†å“ä¹°å–ã€‚</span><br></pre></td></tr></table></figure>

<p>Table: <code>Orders</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| order_id      | int     |</span><br><span class="line">| order_date    | date    |</span><br><span class="line">| item_id       | int     |</span><br><span class="line">| buyer_id      | int     |</span><br><span class="line">| seller_id     | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">æ­¤è¡¨ä¸»é”®æ˜¯ order_idï¼Œå¤–é”®æ˜¯ item_id å’Œï¼ˆbuyer_idï¼Œseller_idï¼‰ã€‚</span><br></pre></td></tr></table></figure>

<p>Table: <code>Item</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| item_id       | int     |</span><br><span class="line">| item_brand    | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">æ­¤è¡¨ä¸»é”®æ˜¯ item_idã€‚</span><br></pre></td></tr></table></figure>

<p>è¯·å†™å‡ºä¸€æ¡SQLè¯­å¥ä»¥æŸ¥è¯¢æ¯ä¸ªç”¨æˆ·çš„æ³¨å†Œæ—¥æœŸå’Œåœ¨ <strong>2019</strong> å¹´ä½œä¸ºä¹°å®¶çš„è®¢å•æ€»æ•°ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">Users table:</span><br><span class="line">+---------+------------+----------------+</span><br><span class="line">| user_id | join_date  | favorite_brand |</span><br><span class="line">+---------+------------+----------------+</span><br><span class="line">| 1       | 2018-01-01 | Lenovo         |</span><br><span class="line">| 2       | 2018-02-09 | Samsung        |</span><br><span class="line">| 3       | 2018-01-19 | LG             |</span><br><span class="line">| 4       | 2018-05-21 | HP             |</span><br><span class="line">+---------+------------+----------------+</span><br><span class="line"></span><br><span class="line">Orders table:</span><br><span class="line">+----------+------------+---------+----------+-----------+</span><br><span class="line">| order_id | order_date | item_id | buyer_id | seller_id |</span><br><span class="line">+----------+------------+---------+----------+-----------+</span><br><span class="line">| 1        | 2019-08-01 | 4       | 1        | 2         |</span><br><span class="line">| 2        | 2018-08-02 | 2       | 1        | 3         |</span><br><span class="line">| 3        | 2019-08-03 | 3       | 2        | 3         |</span><br><span class="line">| 4        | 2018-08-04 | 1       | 4        | 2         |</span><br><span class="line">| 5        | 2018-08-04 | 1       | 3        | 4         |</span><br><span class="line">| 6        | 2019-08-05 | 2       | 2        | 4         |</span><br><span class="line">+----------+------------+---------+----------+-----------+</span><br><span class="line"></span><br><span class="line">Items table:</span><br><span class="line">+---------+------------+</span><br><span class="line">| item_id | item_brand |</span><br><span class="line">+---------+------------+</span><br><span class="line">| 1       | Samsung    |</span><br><span class="line">| 2       | Lenovo     |</span><br><span class="line">| 3       | LG         |</span><br><span class="line">| 4       | HP         |</span><br><span class="line">+---------+------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-----------+------------+----------------+</span><br><span class="line">| buyer_id  | join_date  | orders_in_2019 |</span><br><span class="line">+-----------+------------+----------------+</span><br><span class="line">| 1         | 2018-01-01 | 1              |</span><br><span class="line">| 2         | 2018-02-09 | 2              |</span><br><span class="line">| 3         | 2018-01-19 | 0              |</span><br><span class="line">| 4         | 2018-05-21 | 0              |</span><br><span class="line">+-----------+------------+----------------+</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> user_id buyer_id,join_date, ifnull(cnt,<span class="number">0</span>)orders_in_2019</span><br><span class="line"><span class="keyword">from</span> Users u <span class="keyword">left</span> <span class="keyword">join</span> </span><br><span class="line">(<span class="keyword">select</span> buyer_id,<span class="built_in">count</span>(<span class="operator">*</span>) cnt</span><br><span class="line"><span class="keyword">from</span> Orders</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">year</span>(order_date) <span class="operator">=</span> <span class="number">2019</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span>  buyer_id</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">on</span> u.user_id <span class="operator">=</span>t1.buyer_id</span><br></pre></td></tr></table></figure>

<h4 id="1159-å¸‚åœºåˆ†æ-II"><a href="#1159-å¸‚åœºåˆ†æ-II" class="headerlink" title="1159. å¸‚åœºåˆ†æ II"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/market-analysis-ii/">1159. å¸‚åœºåˆ†æ II</a></h4><p>éš¾åº¦å›°éš¾</p>
<p>SQLæ¶æ„</p>
<p>è¡¨: <code>Users</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| user_id        | int     |</span><br><span class="line">| join_date      | date    |</span><br><span class="line">| favorite_brand | varchar |</span><br><span class="line">+----------------+---------+</span><br><span class="line">user_id æ˜¯è¯¥è¡¨çš„ä¸»é”®</span><br><span class="line">è¡¨ä¸­åŒ…å«ä¸€ä½åœ¨çº¿è´­ç‰©ç½‘ç«™ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ï¼Œç”¨æˆ·å¯ä»¥åœ¨è¯¥ç½‘ç«™å‡ºå”®å’Œè´­ä¹°å•†å“ã€‚</span><br></pre></td></tr></table></figure>

<p>è¡¨: <code>Orders</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| order_id      | int     |</span><br><span class="line">| order_date    | date    |</span><br><span class="line">| item_id       | int     |</span><br><span class="line">| buyer_id      | int     |</span><br><span class="line">| seller_id     | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">order_id æ˜¯è¯¥è¡¨çš„ä¸»é”®</span><br><span class="line">item_id æ˜¯ Items è¡¨çš„å¤–é”®</span><br><span class="line">buyer_id å’Œ seller_id æ˜¯ Users è¡¨çš„å¤–é”®</span><br></pre></td></tr></table></figure>

<p>è¡¨: <code>Items</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| item_id       | int     |</span><br><span class="line">| item_brand    | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">item_id æ˜¯è¯¥è¡¨çš„ä¸»é”®</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€ä¸ª SQL æŸ¥è¯¢ç¡®å®šæ¯ä¸€ä¸ªç”¨æˆ·æŒ‰æ—¥æœŸé¡ºåºå–å‡ºçš„ç¬¬äºŒä»¶å•†å“çš„å“ç‰Œæ˜¯å¦æ˜¯ä»–ä»¬æœ€å–œçˆ±çš„å“ç‰Œã€‚å¦‚æœä¸€ä¸ªç”¨æˆ·å–å‡ºå°‘äºä¸¤ä»¶å•†å“ï¼ŒæŸ¥è¯¢çš„ç»“æœæ˜¯ <code>no</code> ã€‚</p>
<p>é¢˜ç›®ä¿è¯æ²¡æœ‰ä¸€ä¸ªç”¨æˆ·åœ¨ä¸€å¤©ä¸­å–å‡ºè¶…è¿‡ä¸€ä»¶å•†å“</p>
<p>ä¸‹é¢æ˜¯æŸ¥è¯¢ç»“æœæ ¼å¼çš„ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">Users table:</span><br><span class="line">+---------+------------+----------------+</span><br><span class="line">| user_id | join_date  | favorite_brand |</span><br><span class="line">+---------+------------+----------------+</span><br><span class="line">| 1       | 2019-01-01 | Lenovo         |</span><br><span class="line">| 2       | 2019-02-09 | Samsung        |</span><br><span class="line">| 3       | 2019-01-19 | LG             |</span><br><span class="line">| 4       | 2019-05-21 | HP             |</span><br><span class="line">+---------+------------+----------------+</span><br><span class="line"></span><br><span class="line">Orders table:</span><br><span class="line">+----------+------------+---------+----------+-----------+</span><br><span class="line">| order_id | order_date | item_id | buyer_id | seller_id |</span><br><span class="line">+----------+------------+---------+----------+-----------+</span><br><span class="line">| 1        | 2019-08-01 | 4       | 1        | 2         |</span><br><span class="line">| 2        | 2019-08-02 | 2       | 1        | 3         |</span><br><span class="line">| 3        | 2019-08-03 | 3       | 2        | 3         |</span><br><span class="line">| 4        | 2019-08-04 | 1       | 4        | 2         |</span><br><span class="line">| 5        | 2019-08-04 | 1       | 3        | 4         |</span><br><span class="line">| 6        | 2019-08-05 | 2       | 2        | 4         |</span><br><span class="line">+----------+------------+---------+----------+-----------+</span><br><span class="line"></span><br><span class="line">Items table:</span><br><span class="line">+---------+------------+</span><br><span class="line">| item_id | item_brand |</span><br><span class="line">+---------+------------+</span><br><span class="line">| 1       | Samsung    |</span><br><span class="line">| 2       | Lenovo     |</span><br><span class="line">| 3       | LG         |</span><br><span class="line">| 4       | HP         |</span><br><span class="line">+---------+------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-----------+--------------------+</span><br><span class="line">| seller_id | 2nd_item_fav_brand |</span><br><span class="line">+-----------+--------------------+</span><br><span class="line">| 1         | no                 |</span><br><span class="line">| 2         | yes                |</span><br><span class="line">| 3         | yes                |</span><br><span class="line">| 4         | no                 |</span><br><span class="line">+-----------+--------------------+</span><br><span class="line"></span><br><span class="line">id ä¸º 1 çš„ç”¨æˆ·çš„æŸ¥è¯¢ç»“æœæ˜¯ noï¼Œå› ä¸ºä»–ä»€ä¹ˆä¹Ÿæ²¡æœ‰å–å‡º</span><br><span class="line">idä¸º 2 å’Œ 3 çš„ç”¨æˆ·çš„æŸ¥è¯¢ç»“æœæ˜¯ yesï¼Œå› ä¸ºä»–ä»¬å–å‡ºçš„ç¬¬äºŒä»¶å•†å“çš„å“ç‰Œæ˜¯ä»–ä»¬è‡ªå·±æœ€å–œçˆ±çš„å“ç‰Œ</span><br><span class="line">idä¸º 4 çš„ç”¨æˆ·çš„æŸ¥è¯¢ç»“æœæ˜¯ noï¼Œå› ä¸ºä»–å–å‡ºçš„ç¬¬äºŒä»¶å•†å“çš„å“ç‰Œä¸æ˜¯ä»–æœ€å–œçˆ±çš„å“ç‰Œ</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> user_id seller_id, if(item_brand<span class="operator">=</span>favorite_brand,<span class="string">&#x27;yes&#x27;</span>,<span class="string">&#x27;no&#x27;</span>) <span class="number">2</span>nd_item_fav_brand </span><br><span class="line"><span class="keyword">from</span> Users u</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> i.item_id,seller_id,item_brand</span><br><span class="line">    <span class="keyword">from</span> Items i</span><br><span class="line">    <span class="keyword">join</span> </span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> seller_id,item_id,<span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> seller_id  <span class="keyword">order</span> <span class="keyword">by</span> order_date ) rk</span><br><span class="line">        <span class="keyword">from</span> Orders </span><br><span class="line">    )t1 </span><br><span class="line">    <span class="keyword">on</span> i.item_id <span class="operator">=</span> t1.item_id </span><br><span class="line">    <span class="keyword">where</span> rk  <span class="operator">=</span><span class="number">2</span></span><br><span class="line">)t2</span><br><span class="line"><span class="keyword">on</span> u.user_id <span class="operator">=</span> t2.seller_id</span><br></pre></td></tr></table></figure>

<h4 id="1164-æŒ‡å®šæ—¥æœŸçš„äº§å“ä»·æ ¼"><a href="#1164-æŒ‡å®šæ—¥æœŸçš„äº§å“ä»·æ ¼" class="headerlink" title="1164. æŒ‡å®šæ—¥æœŸçš„äº§å“ä»·æ ¼"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/product-price-at-a-given-date/">1164. æŒ‡å®šæ—¥æœŸçš„äº§å“ä»·æ ¼</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>äº§å“æ•°æ®è¡¨: <code>Products</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| new_price     | int     |</span><br><span class="line">| change_date   | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">è¿™å¼ è¡¨çš„ä¸»é”®æ˜¯ (product_id, change_date)ã€‚</span><br><span class="line">è¿™å¼ è¡¨çš„æ¯ä¸€è¡Œåˆ†åˆ«è®°å½•äº† æŸäº§å“ åœ¨æŸä¸ªæ—¥æœŸ æ›´æ”¹å çš„æ–°ä»·æ ¼ã€‚</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€æ®µ SQLæ¥æŸ¥æ‰¾åœ¨ <strong>2019-08-16</strong> æ—¶å…¨éƒ¨äº§å“çš„ä»·æ ¼ï¼Œå‡è®¾æ‰€æœ‰äº§å“åœ¨ä¿®æ”¹å‰çš„ä»·æ ¼éƒ½æ˜¯ <strong>10ã€‚</strong></p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Products table:</span><br><span class="line">+------------+-----------+-------------+</span><br><span class="line">| product_id | new_price | change_date |</span><br><span class="line">+------------+-----------+-------------+</span><br><span class="line">| 1          | 20        | 2019-08-14  |</span><br><span class="line">| 2          | 50        | 2019-08-14  |</span><br><span class="line">| 1          | 30        | 2019-08-15  |</span><br><span class="line">| 1          | 35        | 2019-08-16  |</span><br><span class="line">| 2          | 65        | 2019-08-17  |</span><br><span class="line">| 3          | 20        | 2019-08-18  |</span><br><span class="line">+------------+-----------+-------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+-------+</span><br><span class="line">| product_id | price |</span><br><span class="line">+------------+-------+</span><br><span class="line">| 2          | 50    |</span><br><span class="line">| 1          | 35    |</span><br><span class="line">| 3          | 10    |</span><br><span class="line">+------------+-------+</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> p.product_id,ifnull(t1.new_price,<span class="number">10</span>) price</span><br><span class="line"><span class="keyword">from</span> Products p</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> product_id,new_price</span><br><span class="line">    <span class="keyword">from</span> (</span><br><span class="line">        <span class="keyword">select</span> product_id,new_price,change_date,<span class="built_in">Max</span>(change_date) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> product_id  ) md</span><br><span class="line">        <span class="keyword">from</span>  Products</span><br><span class="line">        <span class="keyword">where</span> change_date<span class="operator">&lt;=</span><span class="string">&#x27;2019-08-16&#x27;</span></span><br><span class="line">    )tmp</span><br><span class="line">    <span class="keyword">where</span> change_date <span class="operator">=</span> md</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">on</span> p. product_id <span class="operator">=</span> t1.product_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> price <span class="keyword">desc</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="1173-å³æ—¶é£Ÿç‰©é…é€-I"><a href="#1173-å³æ—¶é£Ÿç‰©é…é€-I" class="headerlink" title="1173. å³æ—¶é£Ÿç‰©é…é€ I"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/immediate-food-delivery-i/">1173. å³æ—¶é£Ÿç‰©é…é€ I</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>é…é€è¡¨: <code>Delivery</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+-----------------------------+---------+</span><br><span class="line">| Column Name                 | Type    |</span><br><span class="line">+-----------------------------+---------+</span><br><span class="line">| delivery_id                 | int     |</span><br><span class="line">| customer_id                 | int     |</span><br><span class="line">| order_date                  | date    |</span><br><span class="line">| customer_pref_delivery_date | date    |</span><br><span class="line">+-----------------------------+---------+</span><br><span class="line">delivery_id æ˜¯è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¯¥è¡¨ä¿å­˜ç€é¡¾å®¢çš„é£Ÿç‰©é…é€ä¿¡æ¯ï¼Œé¡¾å®¢åœ¨æŸä¸ªæ—¥æœŸä¸‹äº†è®¢å•ï¼Œå¹¶æŒ‡å®šäº†ä¸€ä¸ªæœŸæœ›çš„é…é€æ—¥æœŸï¼ˆå’Œä¸‹å•æ—¥æœŸç›¸åŒæˆ–è€…åœ¨é‚£ä¹‹åï¼‰ã€‚</span><br></pre></td></tr></table></figure>

<p>å¦‚æœé¡¾å®¢æœŸæœ›çš„é…é€æ—¥æœŸå’Œä¸‹å•æ—¥æœŸç›¸åŒï¼Œåˆ™è¯¥è®¢å•ç§°ä¸º ã€Œå³æ—¶è®¢å•ã€ï¼Œå¦åˆ™ç§°ä¸ºã€Œè®¡åˆ’è®¢å•ã€ã€‚</p>
<p>å†™ä¸€æ¡ SQL æŸ¥è¯¢è¯­å¥è·å–å³æ—¶è®¢å•æ‰€å çš„ç™¾åˆ†æ¯”ï¼Œ <strong>ä¿ç•™ä¸¤ä½å°æ•°ã€‚</strong></p>
<p>æŸ¥è¯¢ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Delivery è¡¨:</span><br><span class="line">+-------------+-------------+------------+-----------------------------+</span><br><span class="line">| delivery_id | customer_id | order_date | customer_pref_delivery_date |</span><br><span class="line">+-------------+-------------+------------+-----------------------------+</span><br><span class="line">| 1           | 1           | 2019-08-01 | 2019-08-02                  |</span><br><span class="line">| 2           | 5           | 2019-08-02 | 2019-08-02                  |</span><br><span class="line">| 3           | 1           | 2019-08-11 | 2019-08-11                  |</span><br><span class="line">| 4           | 3           | 2019-08-24 | 2019-08-26                  |</span><br><span class="line">| 5           | 4           | 2019-08-21 | 2019-08-22                  |</span><br><span class="line">| 6           | 2           | 2019-08-11 | 2019-08-13                  |</span><br><span class="line">+-------------+-------------+------------+-----------------------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+----------------------+</span><br><span class="line">| immediate_percentage |</span><br><span class="line">+----------------------+</span><br><span class="line">| 33.33                |</span><br><span class="line">+----------------------+</span><br><span class="line">2 å’Œ 3 å·è®¢å•ä¸ºå³æ—¶è®¢å•ï¼Œå…¶ä»–çš„ä¸ºè®¡åˆ’è®¢å•ã€‚</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> round(<span class="built_in">sum</span>(if(order_date<span class="operator">=</span>customer_pref_delivery_date,<span class="number">1</span>,<span class="number">0</span>))<span class="operator">/</span><span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">*</span><span class="number">100</span>,<span class="number">2</span>) immediate_percentage</span><br><span class="line"><span class="keyword">from</span> Delivery</span><br></pre></td></tr></table></figure>

<h4 id="1174-å³æ—¶é£Ÿç‰©é…é€-II"><a href="#1174-å³æ—¶é£Ÿç‰©é…é€-II" class="headerlink" title="1174. å³æ—¶é£Ÿç‰©é…é€ II"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/immediate-food-delivery-ii/">1174. å³æ—¶é£Ÿç‰©é…é€ II</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>é…é€è¡¨: <code>Delivery</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+-----------------------------+---------+</span><br><span class="line">| Column Name                 | Type    |</span><br><span class="line">+-----------------------------+---------+</span><br><span class="line">| delivery_id                 | int     |</span><br><span class="line">| customer_id                 | int     |</span><br><span class="line">| order_date                  | date    |</span><br><span class="line">| customer_pref_delivery_date | date    |</span><br><span class="line">+-----------------------------+---------+</span><br><span class="line">delivery_id æ˜¯è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¯¥è¡¨ä¿å­˜ç€é¡¾å®¢çš„é£Ÿç‰©é…é€ä¿¡æ¯ï¼Œé¡¾å®¢åœ¨æŸä¸ªæ—¥æœŸä¸‹äº†è®¢å•ï¼Œå¹¶æŒ‡å®šäº†ä¸€ä¸ªæœŸæœ›çš„é…é€æ—¥æœŸï¼ˆå’Œä¸‹å•æ—¥æœŸç›¸åŒæˆ–è€…åœ¨é‚£ä¹‹åï¼‰ã€‚</span><br></pre></td></tr></table></figure>

<p>å¦‚æœé¡¾å®¢æœŸæœ›çš„é…é€æ—¥æœŸå’Œä¸‹å•æ—¥æœŸç›¸åŒï¼Œåˆ™è¯¥è®¢å•ç§°ä¸º ã€Œå³æ—¶è®¢å•ã€ï¼Œå¦åˆ™ç§°ä¸ºã€Œè®¡åˆ’è®¢å•ã€ã€‚</p>
<p>ã€Œé¦–æ¬¡è®¢å•ã€æ˜¯é¡¾å®¢æœ€æ—©åˆ›å»ºçš„è®¢å•ã€‚æˆ‘ä»¬ä¿è¯ä¸€ä¸ªé¡¾å®¢åªä¼šæœ‰ä¸€ä¸ªã€Œé¦–æ¬¡è®¢å•ã€ã€‚</p>
<p>å†™ä¸€æ¡ SQL æŸ¥è¯¢è¯­å¥è·å–å³æ—¶è®¢å•åœ¨æ‰€æœ‰ç”¨æˆ·çš„é¦–æ¬¡è®¢å•ä¸­çš„æ¯”ä¾‹ã€‚<strong>ä¿ç•™ä¸¤ä½å°æ•°ã€‚</strong></p>
<p>æŸ¥è¯¢ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Delivery è¡¨ï¼š</span><br><span class="line">+-------------+-------------+------------+-----------------------------+</span><br><span class="line">| delivery_id | customer_id | order_date | customer_pref_delivery_date |</span><br><span class="line">+-------------+-------------+------------+-----------------------------+</span><br><span class="line">| 1           | 1           | 2019-08-01 | 2019-08-02                  |</span><br><span class="line">| 2           | 2           | 2019-08-02 | 2019-08-02                  |</span><br><span class="line">| 3           | 1           | 2019-08-11 | 2019-08-12                  |</span><br><span class="line">| 4           | 3           | 2019-08-24 | 2019-08-24                  |</span><br><span class="line">| 5           | 3           | 2019-08-21 | 2019-08-22                  |</span><br><span class="line">| 6           | 2           | 2019-08-11 | 2019-08-13                  |</span><br><span class="line">| 7           | 4           | 2019-08-09 | 2019-08-09                  |</span><br><span class="line">+-------------+-------------+------------+-----------------------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+----------------------+</span><br><span class="line">| immediate_percentage |</span><br><span class="line">+----------------------+</span><br><span class="line">| 50.00                |</span><br><span class="line">+----------------------+</span><br><span class="line">1 å·é¡¾å®¢çš„ 1 å·è®¢å•æ˜¯é¦–æ¬¡è®¢å•ï¼Œå¹¶ä¸”æ˜¯è®¡åˆ’è®¢å•ã€‚</span><br><span class="line">2 å·é¡¾å®¢çš„ 2 å·è®¢å•æ˜¯é¦–æ¬¡è®¢å•ï¼Œå¹¶ä¸”æ˜¯å³æ—¶è®¢å•ã€‚</span><br><span class="line">3 å·é¡¾å®¢çš„ 5 å·è®¢å•æ˜¯é¦–æ¬¡è®¢å•ï¼Œå¹¶ä¸”æ˜¯è®¡åˆ’è®¢å•ã€‚</span><br><span class="line">4 å·é¡¾å®¢çš„ 7 å·è®¢å•æ˜¯é¦–æ¬¡è®¢å•ï¼Œå¹¶ä¸”æ˜¯å³æ—¶è®¢å•ã€‚</span><br><span class="line">å› æ­¤ï¼Œä¸€åŠé¡¾å®¢çš„é¦–æ¬¡è®¢å•æ˜¯å³æ—¶çš„ã€‚</span><br></pre></td></tr></table></figure>

<p>å¼€çª—</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> round(<span class="built_in">sum</span>(if(order_date <span class="operator">=</span> fo <span class="operator">&amp;&amp;</span> fo<span class="operator">=</span>d,<span class="number">1</span>,<span class="number">0</span>))<span class="operator">/</span><span class="built_in">count</span>(<span class="keyword">distinct</span> customer_id)<span class="operator">*</span><span class="number">100</span>,<span class="number">2</span>) immediate_percentage </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> customer_id,order_date,<span class="built_in">min</span>(order_date)<span class="keyword">over</span> ( <span class="keyword">partition</span> <span class="keyword">by</span> customer_id) fo,</span><br><span class="line">    if(order_date<span class="operator">=</span>customer_pref_delivery_date,order_date ,<span class="keyword">null</span>) d</span><br><span class="line"><span class="keyword">from</span> Delivery</span><br><span class="line">)t1</span><br></pre></td></tr></table></figure>

<p>å¦ä¸€ç§æ€è·¯</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> round (</span><br><span class="line">    <span class="built_in">sum</span>(order_date <span class="operator">=</span> customer_pref_delivery_date) <span class="operator">*</span> <span class="number">100</span> <span class="operator">/</span></span><br><span class="line">    <span class="built_in">count</span>(<span class="operator">*</span>),</span><br><span class="line">    <span class="number">2</span></span><br><span class="line">) <span class="keyword">as</span> immediate_percentage</span><br><span class="line"><span class="keyword">from</span> Delivery</span><br><span class="line"><span class="keyword">where</span> (customer_id, order_date) <span class="keyword">in</span> (</span><br><span class="line">    <span class="keyword">select</span> customer_id, <span class="built_in">min</span>(order_date)</span><br><span class="line">    <span class="keyword">from</span> delivery</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> customer_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<h4 id="1179-é‡æ–°æ ¼å¼åŒ–éƒ¨é—¨è¡¨"><a href="#1179-é‡æ–°æ ¼å¼åŒ–éƒ¨é—¨è¡¨" class="headerlink" title="1179. é‡æ–°æ ¼å¼åŒ–éƒ¨é—¨è¡¨"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/reformat-department-table/">1179. é‡æ–°æ ¼å¼åŒ–éƒ¨é—¨è¡¨</a></h4><p>éš¾åº¦</p>
<p>SQLæ¶æ„</p>
<p>éƒ¨é—¨è¡¨ <code>Department</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| revenue       | int     |</span><br><span class="line">| month         | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(id, month) æ˜¯è¡¨çš„è”åˆä¸»é”®ã€‚</span><br><span class="line">è¿™ä¸ªè¡¨æ ¼æœ‰å…³äºæ¯ä¸ªéƒ¨é—¨æ¯æœˆæ”¶å…¥çš„ä¿¡æ¯ã€‚</span><br><span class="line">æœˆä»½ï¼ˆmonthï¼‰å¯ä»¥å–ä¸‹åˆ—å€¼ [&quot;Jan&quot;,&quot;Feb&quot;,&quot;Mar&quot;,&quot;Apr&quot;,&quot;May&quot;,&quot;Jun&quot;,&quot;Jul&quot;,&quot;Aug&quot;,&quot;Sep&quot;,&quot;Oct&quot;,&quot;Nov&quot;,&quot;Dec&quot;]ã€‚</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢æ¥é‡æ–°æ ¼å¼åŒ–è¡¨ï¼Œä½¿å¾—æ–°çš„è¡¨ä¸­æœ‰ä¸€ä¸ªéƒ¨é—¨ id åˆ—å’Œä¸€äº›å¯¹åº” <strong>æ¯ä¸ªæœˆ</strong> çš„æ”¶å…¥ï¼ˆrevenueï¼‰åˆ—ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Department è¡¨ï¼š</span><br><span class="line">+------+---------+-------+</span><br><span class="line">| id   | revenue | month |</span><br><span class="line">+------+---------+-------+</span><br><span class="line">| 1    | 8000    | Jan   |</span><br><span class="line">| 2    | 9000    | Jan   |</span><br><span class="line">| 3    | 10000   | Feb   |</span><br><span class="line">| 1    | 7000    | Feb   |</span><br><span class="line">| 1    | 6000    | Mar   |</span><br><span class="line">+------+---------+-------+</span><br><span class="line"></span><br><span class="line">æŸ¥è¯¢å¾—åˆ°çš„ç»“æœè¡¨ï¼š</span><br><span class="line">+------+-------------+-------------+-------------+-----+-------------+</span><br><span class="line">| id   | Jan_Revenue | Feb_Revenue | Mar_Revenue | ... | Dec_Revenue |</span><br><span class="line">+------+-------------+-------------+-------------+-----+-------------+</span><br><span class="line">| 1    | 8000        | 7000        | 6000        | ... | null        |</span><br><span class="line">| 2    | 9000        | null        | null        | ... | null        |</span><br><span class="line">| 3    | null        | 10000       | null        | ... | null        |</span><br><span class="line">+------+-------------+-------------+-------------+-----+-------------+</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼Œç»“æœè¡¨æœ‰ 13 åˆ— (1ä¸ªéƒ¨é—¨ id åˆ— + 12ä¸ªæœˆä»½çš„æ”¶å…¥åˆ—)ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,</span><br><span class="line"><span class="built_in">SUM</span>(<span class="keyword">CASE</span> `<span class="keyword">month</span>` <span class="keyword">WHEN</span> <span class="string">&#x27;Jan&#x27;</span> <span class="keyword">THEN</span> revenue <span class="keyword">END</span>) Jan_Revenue,</span><br><span class="line"><span class="built_in">SUM</span>(<span class="keyword">CASE</span> `<span class="keyword">month</span>` <span class="keyword">WHEN</span> <span class="string">&#x27;Feb&#x27;</span> <span class="keyword">THEN</span> revenue <span class="keyword">END</span>) Feb_Revenue,</span><br><span class="line"><span class="built_in">SUM</span>(<span class="keyword">CASE</span> `<span class="keyword">month</span>` <span class="keyword">WHEN</span> <span class="string">&#x27;Mar&#x27;</span> <span class="keyword">THEN</span> revenue <span class="keyword">END</span>) Mar_Revenue,</span><br><span class="line"><span class="built_in">SUM</span>(<span class="keyword">CASE</span> `<span class="keyword">month</span>` <span class="keyword">WHEN</span> <span class="string">&#x27;Apr&#x27;</span> <span class="keyword">THEN</span> revenue <span class="keyword">END</span>) Apr_Revenue,</span><br><span class="line"><span class="built_in">SUM</span>(<span class="keyword">CASE</span> `<span class="keyword">month</span>` <span class="keyword">WHEN</span> <span class="string">&#x27;May&#x27;</span> <span class="keyword">THEN</span> revenue <span class="keyword">END</span>) May_Revenue,</span><br><span class="line"><span class="built_in">SUM</span>(<span class="keyword">CASE</span> `<span class="keyword">month</span>` <span class="keyword">WHEN</span> <span class="string">&#x27;Jun&#x27;</span> <span class="keyword">THEN</span> revenue <span class="keyword">END</span>) Jun_Revenue,</span><br><span class="line"><span class="built_in">SUM</span>(<span class="keyword">CASE</span> `<span class="keyword">month</span>` <span class="keyword">WHEN</span> <span class="string">&#x27;Jul&#x27;</span> <span class="keyword">THEN</span> revenue <span class="keyword">END</span>) Jul_Revenue,</span><br><span class="line"><span class="built_in">SUM</span>(<span class="keyword">CASE</span> `<span class="keyword">month</span>` <span class="keyword">WHEN</span> <span class="string">&#x27;Aug&#x27;</span> <span class="keyword">THEN</span> revenue <span class="keyword">END</span>) Aug_Revenue,</span><br><span class="line"><span class="built_in">SUM</span>(<span class="keyword">CASE</span> `<span class="keyword">month</span>` <span class="keyword">WHEN</span> <span class="string">&#x27;Sep&#x27;</span> <span class="keyword">THEN</span> revenue <span class="keyword">END</span>) Sep_Revenue,</span><br><span class="line"><span class="built_in">SUM</span>(<span class="keyword">CASE</span> `<span class="keyword">month</span>` <span class="keyword">WHEN</span> <span class="string">&#x27;Oct&#x27;</span> <span class="keyword">THEN</span> revenue <span class="keyword">END</span>) Oct_Revenue,</span><br><span class="line"><span class="built_in">SUM</span>(<span class="keyword">CASE</span> `<span class="keyword">month</span>` <span class="keyword">WHEN</span> <span class="string">&#x27;Nov&#x27;</span> <span class="keyword">THEN</span> revenue <span class="keyword">END</span>) Nov_Revenue,</span><br><span class="line"><span class="built_in">SUM</span>(<span class="keyword">CASE</span> `<span class="keyword">month</span>` <span class="keyword">WHEN</span> <span class="string">&#x27;Dec&#x27;</span> <span class="keyword">THEN</span> revenue <span class="keyword">END</span>) Dec_Revenue</span><br><span class="line"><span class="keyword">FROM</span> Department</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> id;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1193.</span> æ¯æœˆäº¤æ˜“ I</span><br><span class="line"><span class="keyword">SQL</span>æ¶æ„</span><br><span class="line"><span class="keyword">Table</span>: Transactions</span><br><span class="line"></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name   <span class="operator">|</span> Type    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line"><span class="operator">|</span> id            <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> country       <span class="operator">|</span> <span class="type">varchar</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> state         <span class="operator">|</span> enum    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> amount        <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> trans_date    <span class="operator">|</span> <span class="type">date</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line">id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¯¥è¡¨åŒ…å«æœ‰å…³ä¼ å…¥äº‹åŠ¡çš„ä¿¡æ¯ã€‚</span><br><span class="line">state åˆ—ç±»å‹ä¸º â€œ[â€æ‰¹å‡†â€œï¼Œâ€æ‹’ç»â€œ] ä¹‹ä¸€ã€‚</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">ç¼–å†™ä¸€ä¸ª <span class="keyword">sql</span> æŸ¥è¯¢æ¥æŸ¥æ‰¾æ¯ä¸ªæœˆå’Œæ¯ä¸ªå›½å®¶<span class="operator">/</span>åœ°åŒºçš„äº‹åŠ¡æ•°åŠå…¶æ€»é‡‘é¢ã€å·²æ‰¹å‡†çš„äº‹åŠ¡æ•°åŠå…¶æ€»é‡‘é¢ã€‚</span><br><span class="line"></span><br><span class="line">æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</span><br><span class="line"></span><br><span class="line">Transactions <span class="keyword">table</span>:</span><br><span class="line"><span class="operator">+</span><span class="comment">------+---------+----------+--------+------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> country <span class="operator">|</span> state    <span class="operator">|</span> amount <span class="operator">|</span> trans_date <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+---------+----------+--------+------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">121</span>  <span class="operator">|</span> US      <span class="operator">|</span> approved <span class="operator">|</span> <span class="number">1000</span>   <span class="operator">|</span> <span class="number">2018</span><span class="number">-12</span><span class="number">-18</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">122</span>  <span class="operator">|</span> US      <span class="operator">|</span> declined <span class="operator">|</span> <span class="number">2000</span>   <span class="operator">|</span> <span class="number">2018</span><span class="number">-12</span><span class="number">-19</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">123</span>  <span class="operator">|</span> US      <span class="operator">|</span> approved <span class="operator">|</span> <span class="number">2000</span>   <span class="operator">|</span> <span class="number">2019</span><span class="number">-01</span><span class="number">-01</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">124</span>  <span class="operator">|</span> DE      <span class="operator">|</span> approved <span class="operator">|</span> <span class="number">2000</span>   <span class="operator">|</span> <span class="number">2019</span><span class="number">-01</span><span class="number">-07</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+---------+----------+--------+------------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Result</span> <span class="keyword">table</span>:</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+---------+-------------+----------------+--------------------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">month</span>    <span class="operator">|</span> country <span class="operator">|</span> trans_count <span class="operator">|</span> approved_count <span class="operator">|</span> trans_total_amount <span class="operator">|</span> approved_total_amount <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+---------+-------------+----------------+--------------------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2018</span><span class="number">-12</span>  <span class="operator">|</span> US      <span class="operator">|</span> <span class="number">2</span>           <span class="operator">|</span> <span class="number">1</span>              <span class="operator">|</span> <span class="number">3000</span>               <span class="operator">|</span> <span class="number">1000</span>                  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2019</span><span class="number">-01</span>  <span class="operator">|</span> US      <span class="operator">|</span> <span class="number">1</span>           <span class="operator">|</span> <span class="number">1</span>              <span class="operator">|</span> <span class="number">2000</span>               <span class="operator">|</span> <span class="number">2000</span>                  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2019</span><span class="number">-01</span>  <span class="operator">|</span> DE      <span class="operator">|</span> <span class="number">1</span>           <span class="operator">|</span> <span class="number">1</span>              <span class="operator">|</span> <span class="number">2000</span>               <span class="operator">|</span> <span class="number">2000</span>                  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+---------+-------------+----------------+--------------------+-----------------------+</span></span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DATE_FORMAT(trans_date, <span class="string">&#x27;%Y-%m&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">month</span>,</span><br><span class="line">    country,</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> trans_count,</span><br><span class="line">    <span class="built_in">COUNT</span>(IF(state <span class="operator">=</span> <span class="string">&#x27;approved&#x27;</span>, <span class="number">1</span>, <span class="keyword">NULL</span>)) <span class="keyword">AS</span> approved_count,</span><br><span class="line">    <span class="built_in">SUM</span>(amount) <span class="keyword">AS</span> trans_total_amount,</span><br><span class="line">    <span class="built_in">SUM</span>(IF(state <span class="operator">=</span> <span class="string">&#x27;approved&#x27;</span>, amount, <span class="number">0</span>)) <span class="keyword">AS</span> approved_total_amount</span><br><span class="line"><span class="keyword">FROM</span> Transactions</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span>, country</span><br></pre></td></tr></table></figure>



<h4 id="1193-æ¯æœˆäº¤æ˜“-I"><a href="#1193-æ¯æœˆäº¤æ˜“-I" class="headerlink" title="1193. æ¯æœˆäº¤æ˜“ I"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/monthly-transactions-i/">1193. æ¯æœˆäº¤æ˜“ I</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>Table: <code>Transactions</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| country       | varchar |</span><br><span class="line">| state         | enum    |</span><br><span class="line">| amount        | int     |</span><br><span class="line">| trans_date    | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¯¥è¡¨åŒ…å«æœ‰å…³ä¼ å…¥äº‹åŠ¡çš„ä¿¡æ¯ã€‚</span><br><span class="line">state åˆ—ç±»å‹ä¸º â€œ[â€æ‰¹å‡†â€œï¼Œâ€æ‹’ç»â€œ] ä¹‹ä¸€ã€‚</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ä¸€ä¸ª sql æŸ¥è¯¢æ¥æŸ¥æ‰¾æ¯ä¸ªæœˆå’Œæ¯ä¸ªå›½å®¶/åœ°åŒºçš„äº‹åŠ¡æ•°åŠå…¶æ€»é‡‘é¢ã€å·²æ‰¹å‡†çš„äº‹åŠ¡æ•°åŠå…¶æ€»é‡‘é¢ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Transactions table:</span><br><span class="line">+------+---------+----------+--------+------------+</span><br><span class="line">| id   | country | state    | amount | trans_date |</span><br><span class="line">+------+---------+----------+--------+------------+</span><br><span class="line">| 121  | US      | approved | 1000   | 2018-12-18 |</span><br><span class="line">| 122  | US      | declined | 2000   | 2018-12-19 |</span><br><span class="line">| 123  | US      | approved | 2000   | 2019-01-01 |</span><br><span class="line">| 124  | DE      | approved | 2000   | 2019-01-07 |</span><br><span class="line">+------+---------+----------+--------+------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+----------+---------+-------------+----------------+--------------------+-----------------------+</span><br><span class="line">| month    | country | trans_count | approved_count | trans_total_amount | approved_total_amount |</span><br><span class="line">+----------+---------+-------------+----------------+--------------------+-----------------------+</span><br><span class="line">| 2018-12  | US      | 2           | 1              | 3000               | 1000                  |</span><br><span class="line">| 2019-01  | US      | 1           | 1              | 2000               | 2000                  |</span><br><span class="line">| 2019-01  | DE      | 1           | 1              | 2000               | 2000                  |</span><br><span class="line">+----------+---------+-------------+----------------+--------------------+-----------------------+</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DATE_FORMAT(trans_date, <span class="string">&#x27;%Y-%m&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">month</span>,</span><br><span class="line">    country,</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> trans_count,</span><br><span class="line">    <span class="built_in">COUNT</span>(IF(state <span class="operator">=</span> <span class="string">&#x27;approved&#x27;</span>, <span class="number">1</span>, <span class="keyword">NULL</span>)) <span class="keyword">AS</span> approved_count,</span><br><span class="line">    <span class="built_in">SUM</span>(amount) <span class="keyword">AS</span> trans_total_amount,</span><br><span class="line">    <span class="built_in">SUM</span>(IF(state <span class="operator">=</span> <span class="string">&#x27;approved&#x27;</span>, amount, <span class="number">0</span>)) <span class="keyword">AS</span> approved_total_amount</span><br><span class="line"><span class="keyword">FROM</span> Transactions</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span>, country</span><br></pre></td></tr></table></figure>



<h4 id="1205-æ¯æœˆäº¤æ˜“II"><a href="#1205-æ¯æœˆäº¤æ˜“II" class="headerlink" title="1205. æ¯æœˆäº¤æ˜“II"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/monthly-transactions-ii/">1205. æ¯æœˆäº¤æ˜“II</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p><code>Transactions</code> è®°å½•è¡¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| id             | int     |</span><br><span class="line">| country        | varchar |</span><br><span class="line">| state          | enum    |</span><br><span class="line">| amount         | int     |</span><br><span class="line">| trans_date     | date    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¯¥è¡¨åŒ…å«æœ‰å…³ä¼ å…¥äº‹åŠ¡çš„ä¿¡æ¯ã€‚</span><br><span class="line">çŠ¶æ€åˆ—æ˜¯ç±»å‹ä¸º [approvedï¼ˆå·²æ‰¹å‡†ï¼‰ã€declinedï¼ˆå·²æ‹’ç»ï¼‰] çš„æšä¸¾ã€‚</span><br></pre></td></tr></table></figure>

<p><code>Chargebacks</code> è¡¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| trans_id       | int     |</span><br><span class="line">| charge_date    | date    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">é€€å•åŒ…å«æœ‰å…³æ”¾ç½®åœ¨äº‹åŠ¡è¡¨ä¸­çš„æŸäº›äº‹åŠ¡çš„ä¼ å…¥é€€å•çš„åŸºæœ¬ä¿¡æ¯ã€‚</span><br><span class="line">trans_id æ˜¯ transactions è¡¨çš„ id åˆ—çš„å¤–é”®ã€‚</span><br><span class="line">æ¯é¡¹é€€å•éƒ½å¯¹åº”äºä¹‹å‰è¿›è¡Œçš„äº¤æ˜“ï¼Œå³ä½¿æœªç»æ‰¹å‡†ã€‚</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œä»¥æŸ¥æ‰¾æ¯ä¸ªæœˆå’Œæ¯ä¸ªå›½å®¶/åœ°åŒºçš„å·²æ‰¹å‡†äº¤æ˜“çš„æ•°é‡åŠå…¶æ€»é‡‘é¢ã€é€€å•çš„æ•°é‡åŠå…¶æ€»é‡‘é¢ã€‚</p>
<p>æ³¨æ„ï¼šåœ¨æ‚¨çš„æŸ¥è¯¢ä¸­ï¼Œç»™å®šæœˆä»½å’Œå›½å®¶ï¼Œå¿½ç•¥æ‰€æœ‰ä¸ºé›¶çš„è¡Œã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Transactions è¡¨ï¼š</span><br><span class="line">+------+---------+----------+--------+------------+</span><br><span class="line">| id   | country | state    | amount | trans_date |</span><br><span class="line">+------+---------+----------+--------+------------+</span><br><span class="line">| 101  | US      | approved | 1000   | 2019-05-18 |</span><br><span class="line">| 102  | US      | declined | 2000   | 2019-05-19 |</span><br><span class="line">| 103  | US      | approved | 3000   | 2019-06-10 |</span><br><span class="line">| 104  | US      | declined | 4000   | 2019-06-13 |</span><br><span class="line">| 105  | US      | approved | 5000   | 2019-06-15 |</span><br><span class="line">+------+---------+----------+--------+------------+</span><br><span class="line"></span><br><span class="line">Chargebacks è¡¨ï¼š</span><br><span class="line">+------------+------------+</span><br><span class="line">| trans_id   | trans_date |</span><br><span class="line">+------------+------------+</span><br><span class="line">| 102        | 2019-05-29 |</span><br><span class="line">| 101        | 2019-06-30 |</span><br><span class="line">| 105        | 2019-09-18 |</span><br><span class="line">+------------+------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+----------+---------+----------------+-----------------+-------------------+--------------------+</span><br><span class="line">| month    | country | approved_count | approved_amount | chargeback_count  | chargeback_amount  |</span><br><span class="line">+----------+---------+----------------+-----------------+-------------------+--------------------+</span><br><span class="line">| 2019-05  | US      | 1              | 1000            | 1                 | 2000               |</span><br><span class="line">| 2019-06  | US      | 2              | 8000            | 1                 | 1000               |</span><br><span class="line">| 2019-09  | US      | 0              | 0               | 1                 | 5000               |</span><br><span class="line">+----------+---------+----------------+-----------------+-------------------+--------------------+</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    date_format(trans_date, <span class="string">&#x27;%Y-%m&#x27;</span>) <span class="keyword">month</span>, </span><br><span class="line">    country,</span><br><span class="line">    <span class="built_in">sum</span>(state <span class="operator">=</span> <span class="string">&#x27;approved&#x27;</span>) approved_count,</span><br><span class="line">    <span class="built_in">sum</span>(if(state <span class="operator">=</span> <span class="string">&#x27;approved&#x27;</span>, amount, <span class="number">0</span>)) approved_amount,</span><br><span class="line">    <span class="built_in">sum</span>(state <span class="operator">=</span> <span class="string">&#x27;chargeback&#x27;</span>) chargeback_count,</span><br><span class="line">    <span class="built_in">sum</span>(if(state <span class="operator">=</span> <span class="string">&#x27;chargeback&#x27;</span>, amount, <span class="number">0</span>)) chargeback_amount</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> transactions</span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">    <span class="keyword">select</span> id, country, <span class="string">&#x27;chargeback&#x27;</span> state, amount, c.trans_date</span><br><span class="line">    <span class="keyword">from</span> chargebacks c <span class="keyword">left</span> <span class="keyword">join</span> transactions t </span><br><span class="line">    <span class="keyword">on</span> c.trans_id <span class="operator">=</span> t.id</span><br><span class="line">) tmp </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">month</span>, country</span><br><span class="line"><span class="keyword">having</span> approved_amount <span class="keyword">or</span> chargeback_amount</span><br></pre></td></tr></table></figure>

<h4 id="1194-é”¦æ ‡èµ›ä¼˜èƒœè€…"><a href="#1194-é”¦æ ‡èµ›ä¼˜èƒœè€…" class="headerlink" title="1194. é”¦æ ‡èµ›ä¼˜èƒœè€…"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/tournament-winners/">1194. é”¦æ ‡èµ›ä¼˜èƒœè€…</a></h4><p>éš¾åº¦å›°éš¾</p>
<p>SQLæ¶æ„</p>
<p><code>Players</code> ç©å®¶è¡¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+-------+</span><br><span class="line">| Column Name | Type  |</span><br><span class="line">+-------------+-------+</span><br><span class="line">| player_id   | int   |</span><br><span class="line">| group_id    | int   |</span><br><span class="line">+-------------+-------+</span><br><span class="line">ç©å®¶ ID æ˜¯æ­¤è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">æ­¤è¡¨çš„æ¯ä¸€è¡Œè¡¨ç¤ºæ¯ä¸ªç©å®¶çš„ç»„ã€‚</span><br></pre></td></tr></table></figure>

<p><code>Matches</code> èµ›äº‹è¡¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| match_id      | int     |</span><br><span class="line">| first_player  | int     |</span><br><span class="line">| second_player | int     | </span><br><span class="line">| first_score   | int     |</span><br><span class="line">| second_score  | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">match_id æ˜¯æ­¤è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">æ¯ä¸€è¡Œæ˜¯ä¸€åœºæ¯”èµ›çš„è®°å½•ï¼Œç¬¬ä¸€åå’Œç¬¬äºŒåçƒå‘˜åŒ…å«æ¯åœºæ¯”èµ›çš„çƒå‘˜ IDã€‚</span><br><span class="line">ç¬¬ä¸€ä¸ªç©å®¶å’Œç¬¬äºŒä¸ªç©å®¶çš„åˆ†æ•°åˆ†åˆ«åŒ…å«ç¬¬ä¸€ä¸ªç©å®¶å’Œç¬¬äºŒä¸ªç©å®¶çš„åˆ†æ•°ã€‚</span><br><span class="line">ä½ å¯ä»¥å‡è®¾ï¼Œåœ¨æ¯ä¸€åœºæ¯”èµ›ä¸­ï¼Œçƒå‘˜éƒ½å±äºåŒä¸€ç»„ã€‚</span><br></pre></td></tr></table></figure>

<p>æ¯ç»„çš„è·èƒœè€…æ˜¯åœ¨ç»„å†…å¾—åˆ†æœ€é«˜çš„é€‰æ‰‹ã€‚å¦‚æœå¹³å±€ï¼Œplayer_id <strong>æœ€å°</strong> çš„é€‰æ‰‹è·èƒœã€‚</p>
<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢æ¥æŸ¥æ‰¾æ¯ç»„ä¸­çš„è·èƒœè€…ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Players è¡¨:</span><br><span class="line">+-----------+------------+</span><br><span class="line">| player_id | group_id   |</span><br><span class="line">+-----------+------------+</span><br><span class="line">| 15        | 1          |</span><br><span class="line">| 25        | 1          |</span><br><span class="line">| 30        | 1          |</span><br><span class="line">| 45        | 1          |</span><br><span class="line">| 10        | 2          |</span><br><span class="line">| 35        | 2          |</span><br><span class="line">| 50        | 2          |</span><br><span class="line">| 20        | 3          |</span><br><span class="line">| 40        | 3          |</span><br><span class="line">+-----------+------------+</span><br><span class="line"></span><br><span class="line">Matches è¡¨:</span><br><span class="line">+------------+--------------+---------------+-------------+--------------+</span><br><span class="line">| match_id   | first_player | second_player | first_score | second_score |</span><br><span class="line">+------------+--------------+---------------+-------------+--------------+</span><br><span class="line">| 1          | 15           | 45            | 3           | 0            |</span><br><span class="line">| 2          | 30           | 25            | 1           | 2            |</span><br><span class="line">| 3          | 30           | 15            | 2           | 0            |</span><br><span class="line">| 4          | 40           | 20            | 5           | 2            |</span><br><span class="line">| 5          | 35           | 50            | 1           | 1            |</span><br><span class="line">+------------+--------------+---------------+-------------+--------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+-----------+------------+</span><br><span class="line">| group_id  | player_id  |</span><br><span class="line">+-----------+------------+ </span><br><span class="line">| 1         | 15         |</span><br><span class="line">| 2         | 35         |</span><br><span class="line">| 3         | 40         |</span><br><span class="line">+-----------+------------+</span><br></pre></td></tr></table></figure>

<p>union all</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> group_id, player_id</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> group_id, player_id, <span class="built_in">SUM</span>(score) <span class="keyword">AS</span> score</span><br><span class="line">    <span class="keyword">FROM</span> (</span><br><span class="line">        <span class="comment">-- æ¯ä¸ªç”¨æˆ·æ€»çš„ first_score</span></span><br><span class="line">        <span class="keyword">SELECT</span> Players.group_id, Players.player_id, <span class="built_in">SUM</span>(Matches.first_score) <span class="keyword">AS</span> score</span><br><span class="line">        <span class="keyword">FROM</span> Players <span class="keyword">JOIN</span> <span class="keyword">Matches</span> <span class="keyword">ON</span> Players.player_id <span class="operator">=</span> Matches.first_player</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> Players.player_id</span><br><span class="line"></span><br><span class="line">        <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">-- æ¯ä¸ªç”¨æˆ·æ€»çš„ second_score</span></span><br><span class="line">        <span class="keyword">SELECT</span> Players.group_id, Players.player_id, <span class="built_in">SUM</span>(Matches.second_score) <span class="keyword">AS</span> score</span><br><span class="line">        <span class="keyword">FROM</span> Players <span class="keyword">JOIN</span> <span class="keyword">Matches</span> <span class="keyword">ON</span> Players.player_id <span class="operator">=</span> Matches.second_player</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> Players.player_id</span><br><span class="line">    ) s</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> player_id</span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> score <span class="keyword">DESC</span>, player_id</span><br><span class="line">) <span class="keyword">result</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> group_id</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> group_id, player_id</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> players.<span class="operator">*</span>, <span class="built_in">sum</span>(if(player_id <span class="operator">=</span> first_player, first_score, second_score)) score</span><br><span class="line">    <span class="keyword">from</span> players <span class="keyword">join</span> <span class="keyword">matches</span></span><br><span class="line">    <span class="keyword">on</span> player_id <span class="operator">=</span> first_player <span class="keyword">or</span> player_id <span class="operator">=</span> second_player</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> player_id</span><br><span class="line">    <span class="keyword">order</span> <span class="keyword">by</span> score <span class="keyword">desc</span>, player_id</span><br><span class="line">) tmp</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> group_id</span><br></pre></td></tr></table></figure>



<h4 id="1204-æœ€åä¸€ä¸ªèƒ½è¿›å…¥ç”µæ¢¯çš„äºº"><a href="#1204-æœ€åä¸€ä¸ªèƒ½è¿›å…¥ç”µæ¢¯çš„äºº" class="headerlink" title="1204. æœ€åä¸€ä¸ªèƒ½è¿›å…¥ç”µæ¢¯çš„äºº"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/last-person-to-fit-in-the-elevator/">1204. æœ€åä¸€ä¸ªèƒ½è¿›å…¥ç”µæ¢¯çš„äºº</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>è¡¨: <code>Queue</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| person_id   | int     |</span><br><span class="line">| person_name | varchar |</span><br><span class="line">| weight      | int     |</span><br><span class="line">| turn        | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">person_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¯¥è¡¨å±•ç¤ºäº†æ‰€æœ‰ç­‰å¾…ç”µæ¢¯çš„äººçš„ä¿¡æ¯ã€‚</span><br><span class="line">è¡¨ä¸­ person_id å’Œ turn åˆ—å°†åŒ…å«ä» 1 åˆ° n çš„æ‰€æœ‰æ•°å­—ï¼Œå…¶ä¸­ n æ˜¯è¡¨ä¸­çš„è¡Œæ•°ã€‚</span><br></pre></td></tr></table></figure>

<p>ç”µæ¢¯æœ€å¤§è½½é‡é‡ä¸º <strong>1000</strong>ã€‚</p>
<p>å†™ä¸€æ¡ SQL æŸ¥è¯¢è¯­å¥æŸ¥æ‰¾æœ€åä¸€ä¸ªèƒ½è¿›å…¥ç”µæ¢¯ä¸”ä¸è¶…è¿‡é‡é‡é™åˆ¶çš„ <code>person_name</code> ã€‚é¢˜ç›®ç¡®ä¿é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä½çš„äººå¯ä»¥è¿›å…¥ç”µæ¢¯ ã€‚</p>
<p>æŸ¥è¯¢ç»“æœå¦‚ä¸‹æ‰€ç¤º :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Queue è¡¨</span><br><span class="line">+-----------+-------------------+--------+------+</span><br><span class="line">| person_id | person_name       | weight | turn |</span><br><span class="line">+-----------+-------------------+--------+------+</span><br><span class="line">| 5         | George Washington | 250    | 1    |</span><br><span class="line">| 3         | John Adams        | 350    | 2    |</span><br><span class="line">| 6         | Thomas Jefferson  | 400    | 3    |</span><br><span class="line">| 2         | Will Johnliams    | 200    | 4    |</span><br><span class="line">| 4         | Thomas Jefferson  | 175    | 5    |</span><br><span class="line">| 1         | James Elephant    | 500    | 6    |</span><br><span class="line">+-----------+-------------------+--------+------+</span><br><span class="line"></span><br><span class="line">Result è¡¨</span><br><span class="line">+-------------------+</span><br><span class="line">| person_name       |</span><br><span class="line">+-------------------+</span><br><span class="line">| Thomas Jefferson  |</span><br><span class="line">+-------------------+</span><br><span class="line"></span><br><span class="line">ä¸ºäº†ç®€åŒ–ï¼ŒQueue è¡¨æŒ‰ turn åˆ—ç”±å°åˆ°å¤§æ’åºã€‚</span><br><span class="line">ä¸Šä¾‹ä¸­ George Washington(id 5), John Adams(id 3) å’Œ Thomas Jefferson(id 6) å°†å¯ä»¥è¿›å…¥ç”µæ¢¯,å› ä¸ºä»–ä»¬çš„ä½“é‡å’Œä¸º 250 + 350 + 400 = 1000ã€‚</span><br><span class="line">Thomas Jefferson(id 6) æ˜¯æœ€åä¸€ä¸ªä½“é‡åˆé€‚å¹¶è¿›å…¥ç”µæ¢¯çš„äººã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> person_name</span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line">    <span class="keyword">select</span> person_name  ,<span class="built_in">sum</span>(weight) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> turn) t</span><br><span class="line">    <span class="keyword">from</span> Queue</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> t<span class="operator">&lt;=</span><span class="number">1000</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> t <span class="keyword">desc</span> </span><br><span class="line">limit <span class="number">1</span></span><br></pre></td></tr></table></figure>



<h4 id="1211-æŸ¥è¯¢ç»“æœçš„è´¨é‡å’Œå æ¯”"><a href="#1211-æŸ¥è¯¢ç»“æœçš„è´¨é‡å’Œå æ¯”" class="headerlink" title="1211. æŸ¥è¯¢ç»“æœçš„è´¨é‡å’Œå æ¯”"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/queries-quality-and-percentage/">1211. æŸ¥è¯¢ç»“æœçš„è´¨é‡å’Œå æ¯”</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>æŸ¥è¯¢è¡¨ <code>Queries</code>ï¼š </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| query_name  | varchar |</span><br><span class="line">| result      | varchar |</span><br><span class="line">| position    | int     |</span><br><span class="line">| rating      | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">æ­¤è¡¨æ²¡æœ‰ä¸»é”®ï¼Œå¹¶å¯èƒ½æœ‰é‡å¤çš„è¡Œã€‚</span><br><span class="line">æ­¤è¡¨åŒ…å«äº†ä¸€äº›ä»æ•°æ®åº“ä¸­æ”¶é›†çš„æŸ¥è¯¢ä¿¡æ¯ã€‚</span><br><span class="line">â€œä½ç½®â€ï¼ˆpositionï¼‰åˆ—çš„å€¼ä¸º 1 åˆ° 500 ã€‚</span><br><span class="line">â€œè¯„åˆ†â€ï¼ˆratingï¼‰åˆ—çš„å€¼ä¸º 1 åˆ° 5 ã€‚è¯„åˆ†å°äº 3 çš„æŸ¥è¯¢è¢«å®šä¹‰ä¸ºè´¨é‡å¾ˆå·®çš„æŸ¥è¯¢ã€‚</span><br></pre></td></tr></table></figure>

<p>å°†æŸ¥è¯¢ç»“æœçš„è´¨é‡ <code>quality</code> å®šä¹‰ä¸ºï¼š</p>
<blockquote>
<p>å„æŸ¥è¯¢ç»“æœçš„è¯„åˆ†ä¸å…¶ä½ç½®ä¹‹é—´æ¯”ç‡çš„å¹³å‡å€¼ã€‚</p>
</blockquote>
<p>å°†åŠ£è´¨æŸ¥è¯¢ç™¾åˆ†æ¯” <code>poor_query_percentage</code> ä¸ºï¼š</p>
<blockquote>
<p>è¯„åˆ†å°äº 3 çš„æŸ¥è¯¢ç»“æœå å…¨éƒ¨æŸ¥è¯¢ç»“æœçš„ç™¾åˆ†æ¯”ã€‚</p>
</blockquote>
<p>ç¼–å†™ä¸€ç»„ SQL æ¥æŸ¥æ‰¾æ¯æ¬¡æŸ¥è¯¢çš„<code>åç§°</code>(<code>query_name</code>)ã€<code>è´¨é‡</code>(<code>quality</code>) å’Œ <code>åŠ£è´¨æŸ¥è¯¢ç™¾åˆ†æ¯”</code>(<code>poor_query_percentage</code>)ã€‚</p>
<p><code>è´¨é‡</code>(<code>quality</code>) å’Œ<code>åŠ£è´¨æŸ¥è¯¢ç™¾åˆ†æ¯”</code>(<code>poor_query_percentage</code>) éƒ½åº”å››èˆäº”å…¥åˆ°å°æ•°ç‚¹åä¸¤ä½ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Queries table:</span><br><span class="line">+------------+-------------------+----------+--------+</span><br><span class="line">| query_name | result            | position | rating |</span><br><span class="line">+------------+-------------------+----------+--------+</span><br><span class="line">| Dog        | Golden Retriever  | 1        | 5      |</span><br><span class="line">| Dog        | German Shepherd   | 2        | 5      |</span><br><span class="line">| Dog        | Mule              | 200      | 1      |</span><br><span class="line">| Cat        | Shirazi           | 5        | 2      |</span><br><span class="line">| Cat        | Siamese           | 3        | 3      |</span><br><span class="line">| Cat        | Sphynx            | 7        | 4      |</span><br><span class="line">+------------+-------------------+----------+--------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+---------+-----------------------+</span><br><span class="line">| query_name | quality | poor_query_percentage |</span><br><span class="line">+------------+---------+-----------------------+</span><br><span class="line">| Dog        | 2.50    | 33.33                 |</span><br><span class="line">| Cat        | 0.66    | 33.33                 |</span><br><span class="line">+------------+---------+-----------------------+</span><br><span class="line"></span><br><span class="line">Dog æŸ¥è¯¢ç»“æœçš„è´¨é‡ä¸º ((5 / 1) + (5 / 2) + (1 / 200)) / 3 = 2.50</span><br><span class="line">Dog æŸ¥è¯¢ç»“æœçš„åŠ£è´¨æŸ¥è¯¢ç™¾åˆ†æ¯”ä¸º (1 / 3) * 100 = 33.33</span><br><span class="line"></span><br><span class="line">Cat æŸ¥è¯¢ç»“æœçš„è´¨é‡ä¸º ((2 / 5) + (3 / 3) + (4 / 7)) / 3 = 0.66</span><br><span class="line">Cat æŸ¥è¯¢ç»“æœçš„åŠ£è´¨æŸ¥è¯¢ç™¾åˆ†æ¯”ä¸º (1 / 3) * 100 = 33.33</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> query_name,</span><br><span class="line">    round(<span class="built_in">avg</span>(rating<span class="operator">/</span>position),<span class="number">2</span>) quality,</span><br><span class="line">    round(<span class="built_in">sum</span>(if(rating<span class="operator">&lt;</span><span class="number">3</span>,<span class="number">1</span>,<span class="number">0</span>))<span class="operator">/</span><span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">*</span><span class="number">100</span>,<span class="number">2</span>) poor_query_percentage</span><br><span class="line"><span class="keyword">from</span> Queries</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> query_name</span><br></pre></td></tr></table></figure>

<h4 id="1212-æŸ¥è¯¢çƒé˜Ÿç§¯åˆ†"><a href="#1212-æŸ¥è¯¢çƒé˜Ÿç§¯åˆ†" class="headerlink" title="1212. æŸ¥è¯¢çƒé˜Ÿç§¯åˆ†"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/team-scores-in-football-tournament/">1212. æŸ¥è¯¢çƒé˜Ÿç§¯åˆ†</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>Table: <code>Teams</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+---------------+----------+</span><br><span class="line">| Column Name   | Type     |</span><br><span class="line">+---------------+----------+</span><br><span class="line">| team_id       | int      |</span><br><span class="line">| team_name     | varchar  |</span><br><span class="line">+---------------+----------+</span><br><span class="line">æ­¤è¡¨çš„ä¸»é”®æ˜¯ team_idï¼Œè¡¨ä¸­çš„æ¯ä¸€è¡Œéƒ½ä»£è¡¨ä¸€æ”¯ç‹¬ç«‹è¶³çƒé˜Ÿã€‚</span><br></pre></td></tr></table></figure>

<p>Table: <code>Matches</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| match_id      | int     |</span><br><span class="line">| host_team     | int     |</span><br><span class="line">| guest_team    | int     | </span><br><span class="line">| host_goals    | int     |</span><br><span class="line">| guest_goals   | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">æ­¤è¡¨çš„ä¸»é”®æ˜¯ match_idï¼Œè¡¨ä¸­çš„æ¯ä¸€è¡Œéƒ½ä»£è¡¨ä¸€åœºå·²ç»“æŸçš„æ¯”èµ›ï¼Œæ¯”èµ›çš„ä¸»å®¢é˜Ÿåˆ†åˆ«ç”±å®ƒä»¬è‡ªå·±çš„ id è¡¨ç¤ºï¼Œä»–ä»¬çš„è¿›çƒç”± host_goals å’Œ guest_goals åˆ†åˆ«è¡¨ç¤ºã€‚</span><br></pre></td></tr></table></figure>

<p>ç§¯åˆ†è§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li>èµ¢ä¸€åœºå¾—ä¸‰åˆ†ï¼›</li>
<li>å¹³ä¸€åœºå¾—ä¸€åˆ†ï¼›</li>
<li>è¾“ä¸€åœºä¸å¾—åˆ†ã€‚</li>
</ul>
<p>å†™å‡ºä¸€æ¡SQLè¯­å¥ä»¥æŸ¥è¯¢æ¯ä¸ªé˜Ÿçš„ <strong>team_id</strong>ï¼Œ<strong>team_name</strong> å’Œ <strong>num_points</strong>ã€‚ç»“æœæ ¹æ® num_points <strong>é™åºæ’åº</strong>ï¼Œå¦‚æœæœ‰ä¸¤é˜Ÿç§¯åˆ†ç›¸åŒï¼Œé‚£ä¹ˆè¿™ä¸¤é˜ŸæŒ‰ team_id <strong>å‡åºæ’åº</strong>ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Teams table:</span><br><span class="line">+-----------+--------------+</span><br><span class="line">| team_id   | team_name    |</span><br><span class="line">+-----------+--------------+</span><br><span class="line">| 10        | Leetcode FC  |</span><br><span class="line">| 20        | NewYork FC   |</span><br><span class="line">| 30        | Atlanta FC   |</span><br><span class="line">| 40        | Chicago FC   |</span><br><span class="line">| 50        | Toronto FC   |</span><br><span class="line">+-----------+--------------+</span><br><span class="line"></span><br><span class="line">Matches table:</span><br><span class="line">+------------+--------------+---------------+-------------+--------------+</span><br><span class="line">| match_id   | host_team    | guest_team    | host_goals  | guest_goals  |</span><br><span class="line">+------------+--------------+---------------+-------------+--------------+</span><br><span class="line">| 1          | 10           | 20            | 3           | 0            |</span><br><span class="line">| 2          | 30           | 10            | 2           | 2            |</span><br><span class="line">| 3          | 10           | 50            | 5           | 1            |</span><br><span class="line">| 4          | 20           | 30            | 1           | 0            |</span><br><span class="line">| 5          | 50           | 30            | 1           | 0            |</span><br><span class="line">+------------+--------------+---------------+-------------+--------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+--------------+---------------+</span><br><span class="line">| team_id    | team_name    | num_points    |</span><br><span class="line">+------------+--------------+---------------+</span><br><span class="line">| 10         | Leetcode FC  | 7             |</span><br><span class="line">| 20         | NewYork FC   | 3             |</span><br><span class="line">| 50         | Toronto FC   | 3             |</span><br><span class="line">| 30         | Atlanta FC   | 1             |</span><br><span class="line">| 40         | Chicago FC   | 0             |</span><br><span class="line">+------------+--------------+---------------+</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> team_id , team_name ,<span class="built_in">sum</span>(</span><br><span class="line">if(team_id <span class="operator">=</span> host_team <span class="operator">&amp;&amp;</span> host_goals<span class="operator">&gt;</span>guest_goals ,<span class="number">3</span>,<span class="number">0</span>)<span class="operator">+</span></span><br><span class="line">if(team_id <span class="operator">=</span> host_team <span class="operator">&amp;&amp;</span> host_goals<span class="operator">=</span>guest_goals,<span class="number">1</span>,<span class="number">0</span>)<span class="operator">+</span></span><br><span class="line">if(team_id <span class="operator">=</span> guest_team <span class="operator">&amp;&amp;</span> host_goals<span class="operator">=</span>guest_goals,<span class="number">1</span>,<span class="number">0</span>)<span class="operator">+</span></span><br><span class="line">if(team_id <span class="operator">=</span> guest_team <span class="operator">&amp;&amp;</span> host_goals<span class="operator">&lt;</span>guest_goals ,<span class="number">3</span>,<span class="number">0</span>)</span><br><span class="line">)num_points</span><br><span class="line"><span class="keyword">from</span> Teams t <span class="keyword">left</span> <span class="keyword">join</span> <span class="keyword">Matches</span> m</span><br><span class="line"><span class="keyword">on</span> t.team_id <span class="operator">=</span>m.host_team  <span class="keyword">or</span> t.team_id <span class="operator">=</span>m.guest_team  </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> team_id ,team_name</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> num_points <span class="keyword">desc</span>,team_id</span><br></pre></td></tr></table></figure>

<h4 id="1225-æŠ¥å‘Šç³»ç»ŸçŠ¶æ€çš„è¿ç»­æ—¥æœŸ"><a href="#1225-æŠ¥å‘Šç³»ç»ŸçŠ¶æ€çš„è¿ç»­æ—¥æœŸ" class="headerlink" title="1225. æŠ¥å‘Šç³»ç»ŸçŠ¶æ€çš„è¿ç»­æ—¥æœŸ"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/report-contiguous-dates/">1225. æŠ¥å‘Šç³»ç»ŸçŠ¶æ€çš„è¿ç»­æ—¥æœŸ</a></h4><p>éš¾åº¦å›°éš¾</p>
<p>SQLæ¶æ„</p>
<p>Table: <code>Failed</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| fail_date    | date    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">è¯¥è¡¨ä¸»é”®ä¸º fail_dateã€‚</span><br><span class="line">è¯¥è¡¨åŒ…å«å¤±è´¥ä»»åŠ¡çš„å¤©æ•°.</span><br></pre></td></tr></table></figure>

<p>Table: <code>Succeeded</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| success_date | date    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">è¯¥è¡¨ä¸»é”®ä¸º success_dateã€‚</span><br><span class="line">è¯¥è¡¨åŒ…å«æˆåŠŸä»»åŠ¡çš„å¤©æ•°.</span><br></pre></td></tr></table></figure>

<p>ç³»ç»Ÿ <strong>æ¯å¤©</strong> è¿è¡Œä¸€ä¸ªä»»åŠ¡ã€‚æ¯ä¸ªä»»åŠ¡éƒ½ç‹¬ç«‹äºå…ˆå‰çš„ä»»åŠ¡ã€‚ä»»åŠ¡çš„çŠ¶æ€å¯ä»¥æ˜¯å¤±è´¥æˆ–æ˜¯æˆåŠŸã€‚</p>
<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ <strong>2019-01-01</strong> åˆ° <strong>2019-12-31</strong> æœŸé—´ä»»åŠ¡è¿ç»­åŒçŠ¶æ€ <code>period_state</code> çš„èµ·æ­¢æ—¥æœŸï¼ˆ<code>start_date</code> å’Œ <code>end_date</code>ï¼‰ã€‚å³å¦‚æœä»»åŠ¡å¤±è´¥äº†ï¼Œå°±æ˜¯å¤±è´¥çŠ¶æ€çš„èµ·æ­¢æ—¥æœŸï¼Œå¦‚æœä»»åŠ¡æˆåŠŸäº†ï¼Œå°±æ˜¯æˆåŠŸçŠ¶æ€çš„èµ·æ­¢æ—¥æœŸã€‚</p>
<p>æœ€åç»“æœæŒ‰ç…§èµ·å§‹æ—¥æœŸ <code>start_date</code> æ’åº</p>
<p>æŸ¥è¯¢ç»“æœæ ·ä¾‹å¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">Failed table:</span><br><span class="line">+-------------------+</span><br><span class="line">| fail_date         |</span><br><span class="line">+-------------------+</span><br><span class="line">| 2018-12-28        |</span><br><span class="line">| 2018-12-29        |</span><br><span class="line">| 2019-01-04        |</span><br><span class="line">| 2019-01-05        |</span><br><span class="line">+-------------------+</span><br><span class="line"></span><br><span class="line">Succeeded table:</span><br><span class="line">+-------------------+</span><br><span class="line">| success_date      |</span><br><span class="line">+-------------------+</span><br><span class="line">| 2018-12-30        |</span><br><span class="line">| 2018-12-31        |</span><br><span class="line">| 2019-01-01        |</span><br><span class="line">| 2019-01-02        |</span><br><span class="line">| 2019-01-03        |</span><br><span class="line">| 2019-01-06        |</span><br><span class="line">+-------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+--------------+--------------+--------------+</span><br><span class="line">| period_state | start_date   | end_date     |</span><br><span class="line">+--------------+--------------+--------------+</span><br><span class="line">| succeeded    | 2019-01-01   | 2019-01-03   |</span><br><span class="line">| failed       | 2019-01-04   | 2019-01-05   |</span><br><span class="line">| succeeded    | 2019-01-06   | 2019-01-06   |</span><br><span class="line">+--------------+--------------+--------------+</span><br><span class="line"></span><br><span class="line">ç»“æœå¿½ç•¥äº† 2018 å¹´çš„è®°å½•ï¼Œå› ä¸ºæˆ‘ä»¬åªå…³å¿ƒä» 2019-01-01 åˆ° 2019-12-31 çš„è®°å½•</span><br><span class="line">ä» 2019-01-01 åˆ° 2019-01-03 æ‰€æœ‰ä»»åŠ¡æˆåŠŸï¼Œç³»ç»ŸçŠ¶æ€ä¸º &quot;succeeded&quot;ã€‚</span><br><span class="line">ä» 2019-01-04 åˆ° 2019-01-05 æ‰€æœ‰ä»»åŠ¡å¤±è´¥ï¼Œç³»ç»ŸçŠ¶æ€ä¸º &quot;failed&quot;ã€‚</span><br><span class="line">ä» 2019-01-06 åˆ° 2019-01-06 æ‰€æœ‰ä»»åŠ¡æˆåŠŸï¼Œç³»ç»ŸçŠ¶æ€ä¸º &quot;succeeded&quot;ã€‚</span><br></pre></td></tr></table></figure>

<p>å¼€çª—å‡½æ•°</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> type  period_state, <span class="built_in">min</span>(<span class="type">date</span>) start_date, <span class="built_in">max</span>(<span class="type">date</span>) <span class="keyword">as</span> end_date</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> type, <span class="type">date</span>, subdate(<span class="type">date</span>,<span class="built_in">row_number</span>()<span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> type <span class="keyword">order</span> <span class="keyword">by</span> <span class="type">date</span>)) <span class="keyword">as</span> diff</span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> <span class="string">&#x27;failed&#x27;</span> <span class="keyword">as</span> type, fail_date <span class="keyword">as</span> <span class="type">date</span> <span class="keyword">from</span> Failed</span><br><span class="line">        <span class="keyword">where</span> fail_date <span class="keyword">between</span> <span class="string">&#x27;2019-01-01&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;2019-12-31&#x27;</span></span><br><span class="line">        <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">        <span class="keyword">select</span> <span class="string">&#x27;succeeded&#x27;</span> <span class="keyword">as</span> type, success_date <span class="keyword">as</span> <span class="type">date</span> <span class="keyword">from</span> Succeeded</span><br><span class="line">        <span class="keyword">where</span> success_date <span class="keyword">between</span> <span class="string">&#x27;2019-01-01&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;2019-12-31&#x27;</span></span><br><span class="line">    ) a</span><br><span class="line">)b</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> type,diff</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> start_date</span><br></pre></td></tr></table></figure>



<h4 id="1241-æ¯ä¸ªå¸–å­çš„è¯„è®ºæ•°"><a href="#1241-æ¯ä¸ªå¸–å­çš„è¯„è®ºæ•°" class="headerlink" title="1241. æ¯ä¸ªå¸–å­çš„è¯„è®ºæ•°"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/number-of-comments-per-post/">1241. æ¯ä¸ªå¸–å­çš„è¯„è®ºæ•°</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>è¡¨ <code>Submissions</code> ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+----------+</span><br><span class="line">| åˆ—å           | ç±»å‹     |</span><br><span class="line">+---------------+----------+</span><br><span class="line">| sub_id        | int      |</span><br><span class="line">| parent_id     | int      |</span><br><span class="line">+---------------+----------+</span><br><span class="line">ä¸Šè¡¨æ²¡æœ‰ä¸»é”®, æ‰€ä»¥å¯èƒ½ä¼šå‡ºç°é‡å¤çš„è¡Œã€‚</span><br><span class="line">æ¯è¡Œå¯ä»¥æ˜¯ä¸€ä¸ªå¸–å­æˆ–å¯¹è¯¥å¸–å­çš„è¯„è®ºã€‚</span><br><span class="line">å¦‚æœæ˜¯å¸–å­çš„è¯ï¼Œparent_id å°±æ˜¯ nullã€‚</span><br><span class="line">å¯¹äºè¯„è®ºæ¥è¯´ï¼Œparent_id å°±æ˜¯è¡¨ä¸­å¯¹åº”å¸–å­çš„ sub_idã€‚</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ SQL è¯­å¥ä»¥æŸ¥æ‰¾æ¯ä¸ªå¸–å­çš„è¯„è®ºæ•°ã€‚</p>
<p>ç»“æœè¡¨åº”åŒ…å«å¸–å­çš„ <code>post_id</code> å’Œå¯¹åº”çš„è¯„è®ºæ•° <code>number_of_comments</code> å¹¶ä¸”æŒ‰ <code>post_id</code> å‡åºæ’åˆ—ã€‚</p>
<p><code>Submissions</code> å¯èƒ½åŒ…å«é‡å¤çš„è¯„è®ºã€‚æ‚¨åº”è¯¥è®¡ç®—æ¯ä¸ªå¸–å­çš„å”¯ä¸€è¯„è®ºæ•°ã€‚</p>
<p><code>Submissions</code> å¯èƒ½åŒ…å«é‡å¤çš„å¸–å­ã€‚æ‚¨åº”è¯¥å°†å®ƒä»¬è§†ä¸ºä¸€ä¸ªå¸–å­ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Submissions table:</span><br><span class="line">+---------+------------+</span><br><span class="line">| sub_id  | parent_id  |</span><br><span class="line">+---------+------------+</span><br><span class="line">| 1       | Null       |</span><br><span class="line">| 2       | Null       |</span><br><span class="line">| 1       | Null       |</span><br><span class="line">| 12      | Null       |</span><br><span class="line">| 3       | 1          |</span><br><span class="line">| 5       | 2          |</span><br><span class="line">| 3       | 1          |</span><br><span class="line">| 4       | 1          |</span><br><span class="line">| 9       | 1          |</span><br><span class="line">| 10      | 2          |</span><br><span class="line">| 6       | 7          |</span><br><span class="line">+---------+------------+</span><br><span class="line"></span><br><span class="line">ç»“æœè¡¨ï¼š</span><br><span class="line">+---------+--------------------+</span><br><span class="line">| post_id | number_of_comments |</span><br><span class="line">+---------+--------------------+</span><br><span class="line">| 1       | 3                  |</span><br><span class="line">| 2       | 2                  |</span><br><span class="line">| 12      | 0                  |</span><br><span class="line">+---------+--------------------+</span><br><span class="line"></span><br><span class="line">è¡¨ä¸­ ID ä¸º 1 çš„å¸–å­æœ‰ ID ä¸º 3ã€4 å’Œ 9 çš„ä¸‰ä¸ªè¯„è®ºã€‚è¡¨ä¸­ ID ä¸º 3 çš„è¯„è®ºé‡å¤å‡ºç°äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªå¯¹å®ƒè¿›è¡Œäº†ä¸€æ¬¡è®¡æ•°ã€‚</span><br><span class="line">è¡¨ä¸­ ID ä¸º 2 çš„å¸–å­æœ‰ ID ä¸º 5 å’Œ 10 çš„ä¸¤ä¸ªè¯„è®ºã€‚</span><br><span class="line">ID ä¸º 12 çš„å¸–å­åœ¨è¡¨ä¸­æ²¡æœ‰è¯„è®ºã€‚</span><br><span class="line">è¡¨ä¸­ ID ä¸º 6 çš„è¯„è®ºæ˜¯å¯¹ ID ä¸º 7 çš„å·²åˆ é™¤å¸–å­çš„è¯„è®ºï¼Œå› æ­¤æˆ‘ä»¬å°†å…¶å¿½ç•¥ã€‚</span><br></pre></td></tr></table></figure>

<p>åjoin</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s.sub_id post_id,ifnull(number_of_comments,<span class="number">0</span>) number_of_comments</span><br><span class="line"><span class="keyword">from</span> Submissions s</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> (</span><br><span class="line">  <span class="keyword">select</span> parent_id ,<span class="built_in">count</span>(<span class="keyword">distinct</span> sub_id) number_of_comments</span><br><span class="line">  <span class="keyword">from</span> Submissions </span><br><span class="line">  <span class="keyword">group</span> <span class="keyword">by</span> parent_id</span><br><span class="line">) t1</span><br><span class="line"><span class="keyword">on</span> s.sub_id <span class="operator">=</span> t1.parent_id</span><br><span class="line"><span class="keyword">where</span> s.parent_id  <span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> post_id,number_of_comments</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> sub_id</span><br></pre></td></tr></table></figure>

<p>å…ˆjoin</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> post_id, <span class="built_in">COUNT</span>(sub_id) <span class="keyword">AS</span> number_of_comments</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> post.sub_id <span class="keyword">AS</span> post_id, sub.sub_id <span class="keyword">AS</span> sub_id</span><br><span class="line">    <span class="keyword">FROM</span> Submissions post</span><br><span class="line">    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Submissions sub</span><br><span class="line">    <span class="keyword">ON</span> post.sub_id <span class="operator">=</span> sub.parent_id</span><br><span class="line">    <span class="keyword">WHERE</span> post.parent_id <span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line">) T</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> post_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> post_id <span class="keyword">ASC</span></span><br></pre></td></tr></table></figure>



<h4 id="1251-å¹³å‡å”®ä»·"><a href="#1251-å¹³å‡å”®ä»·" class="headerlink" title="1251. å¹³å‡å”®ä»·"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/average-selling-price/">1251. å¹³å‡å”®ä»·</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>Table: <code>Prices</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| start_date    | date    |</span><br><span class="line">| end_date      | date    |</span><br><span class="line">| price         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(product_idï¼Œstart_dateï¼Œend_date) æ˜¯ Prices è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">Prices è¡¨çš„æ¯ä¸€è¡Œè¡¨ç¤ºçš„æ˜¯æŸä¸ªäº§å“åœ¨ä¸€æ®µæ—¶æœŸå†…çš„ä»·æ ¼ã€‚</span><br><span class="line">æ¯ä¸ªäº§å“çš„å¯¹åº”æ—¶é—´æ®µæ˜¯ä¸ä¼šé‡å çš„ï¼Œè¿™ä¹Ÿæ„å‘³ç€åŒä¸€ä¸ªäº§å“çš„ä»·æ ¼æ—¶æ®µä¸ä¼šå‡ºç°äº¤å‰ã€‚</span><br></pre></td></tr></table></figure>

<p>Table: <code>UnitsSold</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| purchase_date | date    |</span><br><span class="line">| units         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">UnitsSold è¡¨æ²¡æœ‰ä¸»é”®ï¼Œå®ƒå¯èƒ½åŒ…å«é‡å¤é¡¹ã€‚</span><br><span class="line">UnitsSold è¡¨çš„æ¯ä¸€è¡Œè¡¨ç¤ºçš„æ˜¯æ¯ç§äº§å“çš„å‡ºå”®æ—¥æœŸï¼Œå•ä½å’Œäº§å“ idã€‚</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™SQLæŸ¥è¯¢ä»¥æŸ¥æ‰¾æ¯ç§äº§å“çš„å¹³å‡å”®ä»·ã€‚<br><code>average_price</code> åº”è¯¥å››èˆäº”å…¥åˆ°å°æ•°ç‚¹åä¸¤ä½ã€‚<br>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Prices table:</span><br><span class="line">+------------+------------+------------+--------+</span><br><span class="line">| product_id | start_date | end_date   | price  |</span><br><span class="line">+------------+------------+------------+--------+</span><br><span class="line">| 1          | 2019-02-17 | 2019-02-28 | 5      |</span><br><span class="line">| 1          | 2019-03-01 | 2019-03-22 | 20     |</span><br><span class="line">| 2          | 2019-02-01 | 2019-02-20 | 15     |</span><br><span class="line">| 2          | 2019-02-21 | 2019-03-31 | 30     |</span><br><span class="line">+------------+------------+------------+--------+</span><br><span class="line"> </span><br><span class="line">UnitsSold table:</span><br><span class="line">+------------+---------------+-------+</span><br><span class="line">| product_id | purchase_date | units |</span><br><span class="line">+------------+---------------+-------+</span><br><span class="line">| 1          | 2019-02-25    | 100   |</span><br><span class="line">| 1          | 2019-03-01    | 15    |</span><br><span class="line">| 2          | 2019-02-10    | 200   |</span><br><span class="line">| 2          | 2019-03-22    | 30    |</span><br><span class="line">+------------+---------------+-------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+---------------+</span><br><span class="line">| product_id | average_price |</span><br><span class="line">+------------+---------------+</span><br><span class="line">| 1          | 6.96          |</span><br><span class="line">| 2          | 16.96         |</span><br><span class="line">+------------+---------------+</span><br><span class="line">å¹³å‡å”®ä»· = äº§å“æ€»ä»· / é”€å”®çš„äº§å“æ•°é‡ã€‚</span><br><span class="line">äº§å“ 1 çš„å¹³å‡å”®ä»· = ((100 * 5)+(15 * 20) )/ 115 = 6.96</span><br><span class="line">äº§å“ 2 çš„å¹³å‡å”®ä»· = ((200 * 15)+(30 * 30) )/ 230 = 16.96</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    product_id,</span><br><span class="line">    Round(<span class="built_in">SUM</span>(sales) <span class="operator">/</span> <span class="built_in">SUM</span>(units), <span class="number">2</span>) <span class="keyword">AS</span> average_price</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">        Prices.product_id <span class="keyword">AS</span> product_id,</span><br><span class="line">        Prices.price <span class="operator">*</span> UnitsSold.units <span class="keyword">AS</span> sales,</span><br><span class="line">        UnitsSold.units <span class="keyword">AS</span> units</span><br><span class="line">    <span class="keyword">FROM</span> Prices </span><br><span class="line">    <span class="keyword">JOIN</span> UnitsSold <span class="keyword">ON</span> Prices.product_id <span class="operator">=</span> UnitsSold.product_id</span><br><span class="line">    <span class="keyword">WHERE</span> UnitsSold.purchase_date <span class="keyword">BETWEEN</span> Prices.start_date <span class="keyword">AND</span> Prices.end_date</span><br><span class="line">) T</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> product_id</span><br></pre></td></tr></table></figure>

<blockquote>
<p>2è¡¨å…³è”çš„æ—¶å€™ç›´æ¥æŠŠæ—¥æœŸåšè¿‡æ»¤</p>
</blockquote>
<h4 id="1264-é¡µé¢æ¨è"><a href="#1264-é¡µé¢æ¨è" class="headerlink" title="1264. é¡µé¢æ¨è"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/page-recommendations/">1264. é¡µé¢æ¨è</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>æœ‹å‹å…³ç³»åˆ—è¡¨ï¼š <code>Friendship</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user1_id      | int     |</span><br><span class="line">| user2_id      | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">è¿™å¼ è¡¨çš„ä¸»é”®æ˜¯ (user1_id, user2_id)ã€‚</span><br><span class="line">è¿™å¼ è¡¨çš„æ¯ä¸€è¡Œä»£è¡¨ç€ user1_id å’Œ user2_id ä¹‹é—´å­˜åœ¨ç€æœ‹å‹å…³ç³»ã€‚</span><br></pre></td></tr></table></figure>

<p>å–œæ¬¢åˆ—è¡¨ï¼š <code>Likes</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| user_id     | int     |</span><br><span class="line">| page_id     | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">è¿™å¼ è¡¨çš„ä¸»é”®æ˜¯ (user_id, page_id)ã€‚</span><br><span class="line">è¿™å¼ è¡¨çš„æ¯ä¸€è¡Œä»£è¡¨ç€ user_id å–œæ¬¢ page_idã€‚</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€æ®µ SQL  å‘<code>user_id</code> = 1 çš„ç”¨æˆ·ï¼Œæ¨èå…¶æœ‹å‹ä»¬å–œæ¬¢çš„é¡µé¢ã€‚ä¸è¦æ¨èè¯¥ç”¨æˆ·å·²ç»å–œæ¬¢çš„é¡µé¢ã€‚</p>
<p>ä½ è¿”å›çš„ç»“æœä¸­ä¸åº”å½“åŒ…å«é‡å¤é¡¹ã€‚</p>
<p>è¿”å›ç»“æœçš„æ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">Friendship table:</span><br><span class="line">+----------+----------+</span><br><span class="line">| user1_id | user2_id |</span><br><span class="line">+----------+----------+</span><br><span class="line">| 1        | 2        |</span><br><span class="line">| 1        | 3        |</span><br><span class="line">| 1        | 4        |</span><br><span class="line">| 2        | 3        |</span><br><span class="line">| 2        | 4        |</span><br><span class="line">| 2        | 5        |</span><br><span class="line">| 6        | 1        |</span><br><span class="line">+----------+----------+</span><br><span class="line"> </span><br><span class="line">Likes table:</span><br><span class="line">+---------+---------+</span><br><span class="line">| user_id | page_id |</span><br><span class="line">+---------+---------+</span><br><span class="line">| 1       | 88      |</span><br><span class="line">| 2       | 23      |</span><br><span class="line">| 3       | 24      |</span><br><span class="line">| 4       | 56      |</span><br><span class="line">| 5       | 11      |</span><br><span class="line">| 6       | 33      |</span><br><span class="line">| 2       | 77      |</span><br><span class="line">| 3       | 77      |</span><br><span class="line">| 6       | 88      |</span><br><span class="line">+---------+---------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------------+</span><br><span class="line">| recommended_page |</span><br><span class="line">+------------------+</span><br><span class="line">| 23               |</span><br><span class="line">| 24               |</span><br><span class="line">| 56               |</span><br><span class="line">| 33               |</span><br><span class="line">| 77               |</span><br><span class="line">+------------------+</span><br><span class="line">ç”¨æˆ·1 åŒ ç”¨æˆ·2, 3, 4, 6 æ˜¯æœ‹å‹å…³ç³»ã€‚</span><br><span class="line">æ¨èé¡µé¢ä¸ºï¼š é¡µé¢23 æ¥è‡ªäº ç”¨æˆ·2, é¡µé¢24 æ¥è‡ªäº ç”¨æˆ·3, é¡µé¢56 æ¥è‡ªäº ç”¨æˆ·3 ä»¥åŠ é¡µé¢33 æ¥è‡ªäº ç”¨æˆ·6ã€‚</span><br><span class="line">é¡µé¢77 åŒæ—¶è¢« ç”¨æˆ·2 å’Œ ç”¨æˆ·3 æ¨èã€‚</span><br><span class="line">é¡µé¢88 æ²¡æœ‰è¢«æ¨èï¼Œå› ä¸º ç”¨æˆ·1 å·²ç»å–œæ¬¢äº†å®ƒã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> page_id  recommended_page</span><br><span class="line"><span class="keyword">from</span> Likes</span><br><span class="line"><span class="keyword">where</span> user_id <span class="keyword">in</span>(</span><br><span class="line"><span class="keyword">select</span> if(user1_id<span class="operator">=</span><span class="number">1</span>,user2_id,user1_id) user_id</span><br><span class="line"><span class="keyword">from</span>  Friendship</span><br><span class="line"><span class="keyword">where</span>  user1_id <span class="operator">=</span><span class="number">1</span> <span class="keyword">or</span> user2_id <span class="operator">=</span><span class="number">1</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">and</span> page_id <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> page_id <span class="keyword">from</span> Likes <span class="keyword">where</span> user_id<span class="operator">=</span><span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="1270-å‘å…¬å¸CEOæ±‡æŠ¥å·¥ä½œçš„æ‰€æœ‰äºº"><a href="#1270-å‘å…¬å¸CEOæ±‡æŠ¥å·¥ä½œçš„æ‰€æœ‰äºº" class="headerlink" title="1270. å‘å…¬å¸CEOæ±‡æŠ¥å·¥ä½œçš„æ‰€æœ‰äºº"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/all-people-report-to-the-given-manager/">1270. å‘å…¬å¸CEOæ±‡æŠ¥å·¥ä½œçš„æ‰€æœ‰äºº</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>å‘˜å·¥è¡¨ï¼š<code>Employees</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| employee_id   | int     |</span><br><span class="line">| employee_name | varchar |</span><br><span class="line">| manager_id    | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">employee_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¿™ä¸ªè¡¨ä¸­æ¯ä¸€è¡Œä¸­ï¼Œemployee_id è¡¨ç¤ºèŒå·¥çš„ IDï¼Œemployee_name è¡¨ç¤ºèŒå·¥çš„åå­—ï¼Œmanager_id è¡¨ç¤ºè¯¥èŒå·¥æ±‡æŠ¥å·¥ä½œçš„ç›´çº¿ç»ç†ã€‚</span><br><span class="line">è¿™ä¸ªå…¬å¸ CEO æ˜¯ employee_id = 1 çš„äººã€‚</span><br></pre></td></tr></table></figure>

<p>ç”¨ SQL æŸ¥è¯¢å‡ºæ‰€æœ‰ç›´æ¥æˆ–é—´æ¥å‘å…¬å¸ CEO æ±‡æŠ¥å·¥ä½œçš„èŒå·¥çš„ employee_id ã€‚</p>
<p>ç”±äºå…¬å¸è§„æ¨¡è¾ƒå°ï¼Œç»ç†ä¹‹é—´çš„é—´æ¥å…³ç³»ä¸è¶…è¿‡ 3 ä¸ªç»ç†ã€‚</p>
<p>å¯ä»¥ä»¥ä»»ä½•é¡ºåºè¿”å›çš„ç»“æœï¼Œä¸éœ€è¦å»é‡ã€‚</p>
<p>æŸ¥è¯¢ç»“æœç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Employees table:</span><br><span class="line">+-------------+---------------+------------+</span><br><span class="line">| employee_id | employee_name | manager_id |</span><br><span class="line">+-------------+---------------+------------+</span><br><span class="line">| 1           | Boss          | 1          |</span><br><span class="line">| 3           | Alice         | 3          |</span><br><span class="line">| 2           | Bob           | 1          |</span><br><span class="line">| 4           | Daniel        | 2          |</span><br><span class="line">| 7           | Luis          | 4          |</span><br><span class="line">| 8           | Jhon          | 3          |</span><br><span class="line">| 9           | Angela        | 8          |</span><br><span class="line">| 77          | Robert        | 1          |</span><br><span class="line">+-------------+---------------+------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-------------+</span><br><span class="line">| employee_id |</span><br><span class="line">+-------------+</span><br><span class="line">| 2           |</span><br><span class="line">| 77          |</span><br><span class="line">| 4           |</span><br><span class="line">| 7           |</span><br><span class="line">+-------------+</span><br><span class="line"></span><br><span class="line">å…¬å¸ CEO çš„ employee_id æ˜¯ 1.</span><br><span class="line">employee_id æ˜¯ 2 å’Œ 77 çš„èŒå‘˜ç›´æ¥æ±‡æŠ¥ç»™å…¬å¸ CEOã€‚</span><br><span class="line">employee_id æ˜¯ 4 çš„èŒå‘˜é—´æ¥æ±‡æŠ¥ç»™å…¬å¸ CEO 4 --&gt; 2 --&gt; 1 ã€‚</span><br><span class="line">employee_id æ˜¯ 7 çš„èŒå‘˜é—´æ¥æ±‡æŠ¥ç»™å…¬å¸ CEO 7 --&gt; 4 --&gt; 2 --&gt; 1 ã€‚</span><br><span class="line">employee_id æ˜¯ 3, 8 ï¼Œ9 çš„èŒå‘˜ä¸ä¼šç›´æ¥æˆ–é—´æ¥çš„æ±‡æŠ¥ç»™å…¬å¸ CEOã€‚ </span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> employee_id</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> a.employee_id</span><br><span class="line"><span class="keyword">from</span> Employees a </span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Employees b <span class="keyword">on</span> a.manager_id <span class="operator">=</span> b.employee_id</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Employees c <span class="keyword">on</span> b.manager_id <span class="operator">=</span> c.employee_id</span><br><span class="line"><span class="keyword">where</span> a.manager_id<span class="operator">=</span><span class="number">1</span> <span class="keyword">or</span> b.manager_id<span class="operator">=</span><span class="number">1</span>  <span class="keyword">or</span> c.manager_id<span class="operator">=</span><span class="number">1</span></span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> employee_id<span class="operator">!=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>



<h4 id="1280-å­¦ç”Ÿä»¬å‚åŠ å„ç§‘æµ‹è¯•çš„æ¬¡æ•°"><a href="#1280-å­¦ç”Ÿä»¬å‚åŠ å„ç§‘æµ‹è¯•çš„æ¬¡æ•°" class="headerlink" title="1280. å­¦ç”Ÿä»¬å‚åŠ å„ç§‘æµ‹è¯•çš„æ¬¡æ•°"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/students-and-examinations/">1280. å­¦ç”Ÿä»¬å‚åŠ å„ç§‘æµ‹è¯•çš„æ¬¡æ•°</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>å­¦ç”Ÿè¡¨: <code>Students</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| student_id    | int     |</span><br><span class="line">| student_name  | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">ä¸»é”®ä¸º student_idï¼ˆå­¦ç”ŸIDï¼‰ï¼Œè¯¥è¡¨å†…çš„æ¯ä¸€è¡Œéƒ½è®°å½•æœ‰å­¦æ ¡ä¸€åå­¦ç”Ÿçš„ä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure>

<p>ç§‘ç›®è¡¨: <code>Subjects</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| subject_name | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">ä¸»é”®ä¸º subject_nameï¼ˆç§‘ç›®åç§°ï¼‰ï¼Œæ¯ä¸€è¡Œè®°å½•å­¦æ ¡çš„ä¸€é—¨ç§‘ç›®åç§°ã€‚</span><br></pre></td></tr></table></figure>

<p>è€ƒè¯•è¡¨: <code>Examinations</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| student_id   | int     |</span><br><span class="line">| subject_name | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">è¿™å¼ è¡¨å‹æ ¹æ²¡æœ‰ä¸»é”®ï¼Œå¯èƒ½ä¼šæœ‰é‡å¤è¡Œã€‚</span><br><span class="line">å­¦ç”Ÿè¡¨é‡Œçš„ä¸€ä¸ªå­¦ç”Ÿä¿®è¯»ç§‘ç›®è¡¨é‡Œçš„æ¯ä¸€é—¨ç§‘ç›®ï¼Œè€Œè¿™å¼ è€ƒè¯•è¡¨çš„æ¯ä¸€è¡Œè®°å½•å°±è¡¨ç¤ºå­¦ç”Ÿè¡¨é‡Œçš„æŸä¸ªå­¦ç”Ÿå‚åŠ äº†ä¸€æ¬¡ç§‘ç›®è¡¨é‡ŒæŸé—¨ç§‘ç›®çš„æµ‹è¯•ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> a.student_id, a.student_name, b.subject_name, <span class="built_in">COUNT</span>(e.subject_name) <span class="keyword">AS</span> attended_exams</span><br><span class="line"><span class="keyword">FROM</span> Students a <span class="keyword">CROSS</span> <span class="keyword">JOIN</span> Subjects b</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Examinations e <span class="keyword">ON</span> a.student_id <span class="operator">=</span> e.student_id <span class="keyword">AND</span> b.subject_name <span class="operator">=</span> e.subject_name</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> a.student_id, b.subject_name</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> a.student_id, b.subject_name</span><br></pre></td></tr></table></figure>

<blockquote>
<p> CROSS JOIN Mysqlä¸­æ²¡æœ‰full outer join     hiveä¸­å¯ä»¥ç”¨</p>
</blockquote>
<h4 id="1285-æ‰¾åˆ°è¿ç»­åŒºé—´çš„å¼€å§‹å’Œç»“æŸæ•°å­—"><a href="#1285-æ‰¾åˆ°è¿ç»­åŒºé—´çš„å¼€å§‹å’Œç»“æŸæ•°å­—" class="headerlink" title="1285. æ‰¾åˆ°è¿ç»­åŒºé—´çš„å¼€å§‹å’Œç»“æŸæ•°å­—"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/find-the-start-and-end-number-of-continuous-ranges/">1285. æ‰¾åˆ°è¿ç»­åŒºé—´çš„å¼€å§‹å’Œç»“æŸæ•°å­—</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>è¡¨ï¼š<code>Logs</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| log_id        | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id æ˜¯ä¸Šè¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">ä¸Šè¡¨çš„æ¯ä¸€è¡ŒåŒ…å«æ—¥å¿—è¡¨ä¸­çš„ä¸€ä¸ª IDã€‚</span><br></pre></td></tr></table></figure>

<p>åæ¥ä¸€äº› ID ä» <code>Logs</code> è¡¨ä¸­åˆ é™¤ã€‚ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢å¾—åˆ° <code>Logs</code> è¡¨ä¸­çš„è¿ç»­åŒºé—´çš„å¼€å§‹æ•°å­—å’Œç»“æŸæ•°å­—ã€‚</p>
<p>å°†æŸ¥è¯¢è¡¨æŒ‰ç…§ <code>start_id</code> æ’åºã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Logs è¡¨ï¼š</span><br><span class="line">+------------+</span><br><span class="line">| log_id     |</span><br><span class="line">+------------+</span><br><span class="line">| 1          |</span><br><span class="line">| 2          |</span><br><span class="line">| 3          |</span><br><span class="line">| 7          |</span><br><span class="line">| 8          |</span><br><span class="line">| 10         |</span><br><span class="line">+------------+</span><br><span class="line"></span><br><span class="line">ç»“æœè¡¨ï¼š</span><br><span class="line">+------------+--------------+</span><br><span class="line">| start_id   | end_id       |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| 1          | 3            |</span><br><span class="line">| 7          | 8            |</span><br><span class="line">| 10         | 10           |</span><br><span class="line">+------------+--------------+</span><br><span class="line">ç»“æœè¡¨åº”åŒ…å« Logs è¡¨ä¸­çš„æ‰€æœ‰åŒºé—´ã€‚</span><br><span class="line">ä» 1 åˆ° 3 åœ¨è¡¨ä¸­ã€‚</span><br><span class="line">ä» 4 åˆ° 6 ä¸åœ¨è¡¨ä¸­ã€‚</span><br><span class="line">ä» 7 åˆ° 8 åœ¨è¡¨ä¸­ã€‚</span><br><span class="line">9 ä¸åœ¨è¡¨ä¸­ã€‚</span><br><span class="line">10 åœ¨è¡¨ä¸­ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="built_in">MIN</span>(log_id) start_id,</span><br><span class="line">    <span class="built_in">MAX</span>(log_id) end_id</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    (<span class="keyword">SELECT</span></span><br><span class="line">        log_id, </span><br><span class="line">        log_id <span class="operator">-</span> <span class="built_in">row_number</span>() <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> log_id) <span class="keyword">as</span> diff</span><br><span class="line">    <span class="keyword">FROM</span> Logs) t</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> diff</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç›¸ä¼¼1225é¢˜</p>
</blockquote>
<h4 id="1294-ä¸åŒå›½å®¶çš„å¤©æ°”ç±»å‹"><a href="#1294-ä¸åŒå›½å®¶çš„å¤©æ°”ç±»å‹" class="headerlink" title="1294. ä¸åŒå›½å®¶çš„å¤©æ°”ç±»å‹"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/weather-type-in-each-country/">1294. ä¸åŒå›½å®¶çš„å¤©æ°”ç±»å‹</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>å›½å®¶è¡¨ï¼š<code>Countries</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| country_id    | int     |</span><br><span class="line">| country_name  | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">country_id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¯¥è¡¨çš„æ¯è¡Œæœ‰ country_id å’Œ country_name ä¸¤åˆ—ã€‚</span><br></pre></td></tr></table></figure>

<p>å¤©æ°”è¡¨ï¼š<code>Weather</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| country_id    | int     |</span><br><span class="line">| weather_state | varchar |</span><br><span class="line">| day           | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(country_id, day) æ˜¯è¯¥è¡¨çš„å¤åˆä¸»é”®ã€‚</span><br><span class="line">è¯¥è¡¨çš„æ¯ä¸€è¡Œè®°å½•äº†æŸä¸ªå›½å®¶æŸä¸€å¤©çš„å¤©æ°”æƒ…å†µã€‚</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€æ®µ SQL æ¥æ‰¾åˆ°è¡¨ä¸­æ¯ä¸ªå›½å®¶åœ¨ 2019 å¹´ 11 æœˆçš„å¤©æ°”ç±»å‹ã€‚</p>
<p>å¤©æ°”ç±»å‹çš„å®šä¹‰å¦‚ä¸‹ï¼šå½“ weather_state çš„å¹³å‡å€¼å°äºæˆ–ç­‰äº15è¿”å› <strong>Cold</strong>ï¼Œå½“ weather_state çš„å¹³å‡å€¼å¤§äºæˆ–ç­‰äº 25 è¿”å› <strong>Hot</strong>ï¼Œå¦åˆ™è¿”å› <strong>Warm</strong>ã€‚</p>
<p>ä½ å¯ä»¥ä»¥ä»»æ„é¡ºåºè¿”å›ä½ çš„æŸ¥è¯¢ç»“æœã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">Countries table:</span><br><span class="line">+------------+--------------+</span><br><span class="line">| country_id | country_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| 2          | USA          |</span><br><span class="line">| 3          | Australia    |</span><br><span class="line">| 7          | Peru         |</span><br><span class="line">| 5          | China        |</span><br><span class="line">| 8          | Morocco      |</span><br><span class="line">| 9          | Spain        |</span><br><span class="line">+------------+--------------+</span><br><span class="line">Weather table:</span><br><span class="line">+------------+---------------+------------+</span><br><span class="line">| country_id | weather_state | day        |</span><br><span class="line">+------------+---------------+------------+</span><br><span class="line">| 2          | 15            | 2019-11-01 |</span><br><span class="line">| 2          | 12            | 2019-10-28 |</span><br><span class="line">| 2          | 12            | 2019-10-27 |</span><br><span class="line">| 3          | -2            | 2019-11-10 |</span><br><span class="line">| 3          | 0             | 2019-11-11 |</span><br><span class="line">| 3          | 3             | 2019-11-12 |</span><br><span class="line">| 5          | 16            | 2019-11-07 |</span><br><span class="line">| 5          | 18            | 2019-11-09 |</span><br><span class="line">| 5          | 21            | 2019-11-23 |</span><br><span class="line">| 7          | 25            | 2019-11-28 |</span><br><span class="line">| 7          | 22            | 2019-12-01 |</span><br><span class="line">| 7          | 20            | 2019-12-02 |</span><br><span class="line">| 8          | 25            | 2019-11-05 |</span><br><span class="line">| 8          | 27            | 2019-11-15 |</span><br><span class="line">| 8          | 31            | 2019-11-25 |</span><br><span class="line">| 9          | 7             | 2019-10-23 |</span><br><span class="line">| 9          | 3             | 2019-12-23 |</span><br><span class="line">+------------+---------------+------------+</span><br><span class="line">Result table:</span><br><span class="line">+--------------+--------------+</span><br><span class="line">| country_name | weather_type |</span><br><span class="line">+--------------+--------------+</span><br><span class="line">| USA          | Cold         |</span><br><span class="line">| Austraila    | Cold         |</span><br><span class="line">| Peru         | Hot          |</span><br><span class="line">| China        | Warm         |</span><br><span class="line">| Morocco      | Hot          |</span><br><span class="line">+--------------+--------------+</span><br><span class="line">USA 11 æœˆçš„å¹³å‡ weather_state ä¸º (15) / 1 = 15 æ‰€ä»¥å¤©æ°”ç±»å‹ä¸º Coldã€‚</span><br><span class="line">Australia 11 æœˆçš„å¹³å‡ weather_state ä¸º (-2 + 0 + 3) / 3 = 0.333 æ‰€ä»¥å¤©æ°”ç±»å‹ä¸º Coldã€‚</span><br><span class="line">Peru 11 æœˆçš„å¹³å‡ weather_state ä¸º (25) / 1 = 25 æ‰€ä»¥å¤©æ°”ç±»å‹ä¸º Hotã€‚</span><br><span class="line">China 11 æœˆçš„å¹³å‡ weather_state ä¸º (16 + 18 + 21) / 3 = 18.333 æ‰€ä»¥å¤©æ°”ç±»å‹ä¸º Warmã€‚</span><br><span class="line">Morocco 11 æœˆçš„å¹³å‡ weather_state ä¸º (25 + 27 + 31) / 3 = 27.667 æ‰€ä»¥å¤©æ°”ç±»å‹ä¸º Hotã€‚</span><br><span class="line">æˆ‘ä»¬å¹¶ä¸çŸ¥é“ Spain åœ¨ 11 æœˆçš„ weather_state æƒ…å†µæ‰€ä»¥æ— éœ€å°†ä»–åŒ…å«åœ¨ç»“æœä¸­ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> country_name,( <span class="keyword">case</span> <span class="keyword">when</span> <span class="built_in">avg</span>(weather_state)<span class="operator">&lt;=</span><span class="number">15</span> <span class="keyword">then</span> <span class="string">&#x27;Cold&#x27;</span></span><br><span class="line">                        <span class="keyword">when</span> <span class="built_in">avg</span>(weather_state)<span class="operator">&gt;=</span><span class="number">25</span> <span class="keyword">then</span> <span class="string">&#x27;Hot&#x27;</span></span><br><span class="line">                        <span class="keyword">else</span> <span class="string">&#x27;Warm&#x27;</span> <span class="keyword">end</span> ) weather_type</span><br><span class="line"><span class="keyword">from</span> Countries c <span class="keyword">join</span> Weather w <span class="keyword">on</span> c.country_id <span class="operator">=</span> w.country_id</span><br><span class="line"><span class="keyword">where</span> date_format(<span class="keyword">day</span>,&quot;%Y-%m&quot;)<span class="operator">=</span><span class="string">&#x27;2019-11&#x27;</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> country_name</span><br></pre></td></tr></table></figure>

<h4 id="1303-æ±‚å›¢é˜Ÿäººæ•°"><a href="#1303-æ±‚å›¢é˜Ÿäººæ•°" class="headerlink" title="1303. æ±‚å›¢é˜Ÿäººæ•°"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/find-the-team-size/">1303. æ±‚å›¢é˜Ÿäººæ•°</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>å‘˜å·¥è¡¨ï¼š<code>Employee</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| employee_id   | int     |</span><br><span class="line">| team_id       | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">employee_id å­—æ®µæ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ï¼Œè¡¨ä¸­çš„æ¯ä¸€è¡Œéƒ½åŒ…å«æ¯ä¸ªå‘˜å·¥çš„ ID å’Œä»–ä»¬æ‰€å±çš„å›¢é˜Ÿã€‚</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œä»¥æ±‚å¾—æ¯ä¸ªå‘˜å·¥æ‰€åœ¨å›¢é˜Ÿçš„æ€»äººæ•°ã€‚</p>
<p>æŸ¥è¯¢ç»“æœä¸­çš„é¡ºåºæ— ç‰¹å®šè¦æ±‚ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Employee Table:</span><br><span class="line">+-------------+------------+</span><br><span class="line">| employee_id | team_id    |</span><br><span class="line">+-------------+------------+</span><br><span class="line">|     1       |     8      |</span><br><span class="line">|     2       |     8      |</span><br><span class="line">|     3       |     8      |</span><br><span class="line">|     4       |     7      |</span><br><span class="line">|     5       |     9      |</span><br><span class="line">|     6       |     9      |</span><br><span class="line">+-------------+------------+</span><br><span class="line">Result table:</span><br><span class="line">+-------------+------------+</span><br><span class="line">| employee_id | team_size  |</span><br><span class="line">+-------------+------------+</span><br><span class="line">|     1       |     3      |</span><br><span class="line">|     2       |     3      |</span><br><span class="line">|     3       |     3      |</span><br><span class="line">|     4       |     1      |</span><br><span class="line">|     5       |     2      |</span><br><span class="line">|     6       |     2      |</span><br><span class="line">+-------------+------------+</span><br><span class="line">ID ä¸º 1ã€2ã€3 çš„å‘˜å·¥æ˜¯ team_id ä¸º 8 çš„å›¢é˜Ÿçš„æˆå‘˜ï¼Œ</span><br><span class="line">ID ä¸º 4 çš„å‘˜å·¥æ˜¯ team_id ä¸º 7 çš„å›¢é˜Ÿçš„æˆå‘˜ï¼Œ</span><br><span class="line">ID ä¸º 5ã€6 çš„å‘˜å·¥æ˜¯ team_id ä¸º 9 çš„å›¢é˜Ÿçš„æˆå‘˜ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> employee_id,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> team_id) team_size </span><br><span class="line"><span class="keyword">from</span> Employee</span><br></pre></td></tr></table></figure>

<h4 id="1308-ä¸åŒæ€§åˆ«æ¯æ—¥åˆ†æ•°æ€»è®¡"><a href="#1308-ä¸åŒæ€§åˆ«æ¯æ—¥åˆ†æ•°æ€»è®¡" class="headerlink" title="1308. ä¸åŒæ€§åˆ«æ¯æ—¥åˆ†æ•°æ€»è®¡"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/running-total-for-different-genders/">1308. ä¸åŒæ€§åˆ«æ¯æ—¥åˆ†æ•°æ€»è®¡</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>è¡¨: <code>Scores</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| player_name   | varchar |</span><br><span class="line">| gender        | varchar |</span><br><span class="line">| day           | date    |</span><br><span class="line">| score_points  | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(gender, day)æ˜¯è¯¥è¡¨çš„ä¸»é”®</span><br><span class="line">ä¸€åœºæ¯”èµ›æ˜¯åœ¨å¥³é˜Ÿå’Œç”·é˜Ÿä¹‹é—´ä¸¾è¡Œçš„</span><br><span class="line">è¯¥è¡¨çš„æ¯ä¸€è¡Œè¡¨ç¤ºä¸€ä¸ªåå« (player_name) æ€§åˆ«ä¸º (gender) çš„å‚èµ›è€…åœ¨æŸä¸€å¤©è·å¾—äº† (score_points) çš„åˆ†æ•°</span><br><span class="line">å¦‚æœå‚èµ›è€…æ˜¯å¥³æ€§ï¼Œé‚£ä¹ˆ gender åˆ—ä¸º &#x27;F&#x27;ï¼Œå¦‚æœå‚èµ›è€…æ˜¯ç”·æ€§ï¼Œé‚£ä¹ˆ gender åˆ—ä¸º &#x27;M&#x27;</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€æ¡SQLè¯­å¥æŸ¥è¯¢æ¯ç§æ€§åˆ«åœ¨æ¯ä¸€å¤©çš„æ€»åˆ†ï¼Œå¹¶æŒ‰æ€§åˆ«å’Œæ—¥æœŸå¯¹æŸ¥è¯¢ç»“æœæ’åº</p>
<p>ä¸‹é¢æ˜¯æŸ¥è¯¢ç»“æœæ ¼å¼çš„ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Scoresè¡¨:</span><br><span class="line">+-------------+--------+------------+--------------+</span><br><span class="line">| player_name | gender | day        | score_points |</span><br><span class="line">+-------------+--------+------------+--------------+</span><br><span class="line">| Aron        | F      | 2020-01-01 | 17           |</span><br><span class="line">| Alice       | F      | 2020-01-07 | 23           |</span><br><span class="line">| Bajrang     | M      | 2020-01-07 | 7            |</span><br><span class="line">| Khali       | M      | 2019-12-25 | 11           |</span><br><span class="line">| Slaman      | M      | 2019-12-30 | 13           |</span><br><span class="line">| Joe         | M      | 2019-12-31 | 3            |</span><br><span class="line">| Jose        | M      | 2019-12-18 | 2            |</span><br><span class="line">| Priya       | F      | 2019-12-31 | 23           |</span><br><span class="line">| Priyanka    | F      | 2019-12-30 | 17           |</span><br><span class="line">+-------------+--------+------------+--------------+</span><br><span class="line">ç»“æœè¡¨:</span><br><span class="line">+--------+------------+-------+</span><br><span class="line">| gender | day        | total |</span><br><span class="line">+--------+------------+-------+</span><br><span class="line">| F      | 2019-12-30 | 17    |</span><br><span class="line">| F      | 2019-12-31 | 40    |</span><br><span class="line">| F      | 2020-01-01 | 57    |</span><br><span class="line">| F      | 2020-01-07 | 80    |</span><br><span class="line">| M      | 2019-12-18 | 2     |</span><br><span class="line">| M      | 2019-12-25 | 13    |</span><br><span class="line">| M      | 2019-12-30 | 26    |</span><br><span class="line">| M      | 2019-12-31 | 29    |</span><br><span class="line">| M      | 2020-01-07 | 36    |</span><br><span class="line">+--------+------------+-------+</span><br><span class="line">å¥³æ€§é˜Ÿä¼:</span><br><span class="line">ç¬¬ä¸€å¤©æ˜¯ 2019-12-30ï¼ŒPriyanka è·å¾— 17 åˆ†ï¼Œé˜Ÿä¼çš„æ€»åˆ†æ˜¯ 17 åˆ†</span><br><span class="line">ç¬¬äºŒå¤©æ˜¯ 2019-12-31, Priya è·å¾— 23 åˆ†ï¼Œé˜Ÿä¼çš„æ€»åˆ†æ˜¯ 40 åˆ†</span><br><span class="line">ç¬¬ä¸‰å¤©æ˜¯ 2020-01-01, Aron è·å¾— 17 åˆ†ï¼Œé˜Ÿä¼çš„æ€»åˆ†æ˜¯ 57 åˆ†</span><br><span class="line">ç¬¬å››å¤©æ˜¯ 2020-01-07, Alice è·å¾— 23 åˆ†ï¼Œé˜Ÿä¼çš„æ€»åˆ†æ˜¯ 80 åˆ†</span><br><span class="line">ç”·æ€§é˜Ÿä¼ï¼š</span><br><span class="line">ç¬¬ä¸€å¤©æ˜¯ 2019-12-18, Jose è·å¾— 2 åˆ†ï¼Œé˜Ÿä¼çš„æ€»åˆ†æ˜¯ 2 åˆ†</span><br><span class="line">ç¬¬äºŒå¤©æ˜¯ 2019-12-25, Khali è·å¾— 11 åˆ†ï¼Œé˜Ÿä¼çš„æ€»åˆ†æ˜¯ 13 åˆ†</span><br><span class="line">ç¬¬ä¸‰å¤©æ˜¯ 2019-12-30, Slaman è·å¾— 13 åˆ†ï¼Œé˜Ÿä¼çš„æ€»åˆ†æ˜¯ 26 åˆ†</span><br><span class="line">ç¬¬å››å¤©æ˜¯ 2019-12-31, Joe è·å¾— 3 åˆ†ï¼Œé˜Ÿä¼çš„æ€»åˆ†æ˜¯ 29 åˆ†</span><br><span class="line">ç¬¬äº”å¤©æ˜¯ 2020-01-07, Bajrang è·å¾— 7 åˆ†ï¼Œé˜Ÿä¼çš„æ€»åˆ†æ˜¯ 36 åˆ†</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> gender , <span class="keyword">day</span>  ,<span class="built_in">sum</span>( score_points) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> gender <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">day</span>)  total</span><br><span class="line"><span class="keyword">from</span> Scores </span><br></pre></td></tr></table></figure>



<h4 id="1321-é¤é¦†è¥ä¸šé¢å˜åŒ–å¢é•¿"><a href="#1321-é¤é¦†è¥ä¸šé¢å˜åŒ–å¢é•¿" class="headerlink" title="1321. é¤é¦†è¥ä¸šé¢å˜åŒ–å¢é•¿"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/restaurant-growth/">1321. é¤é¦†è¥ä¸šé¢å˜åŒ–å¢é•¿</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>è¡¨: <code>Customer</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">| visited_on    | date    |</span><br><span class="line">| amount        | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(customer_id, visited_on) æ˜¯è¯¥è¡¨çš„ä¸»é”®</span><br><span class="line">è¯¥è¡¨åŒ…å«ä¸€å®¶é¤é¦†çš„é¡¾å®¢äº¤æ˜“æ•°æ®</span><br><span class="line">visited_on è¡¨ç¤º (customer_id) çš„é¡¾å®¢åœ¨ visited_on é‚£å¤©è®¿é—®äº†é¤é¦†</span><br><span class="line">amount æ˜¯ä¸€ä¸ªé¡¾å®¢æŸä¸€å¤©çš„æ¶ˆè´¹æ€»é¢</span><br></pre></td></tr></table></figure>

<p>ä½ æ˜¯é¤é¦†çš„è€æ¿ï¼Œç°åœ¨ä½ æƒ³åˆ†æä¸€ä¸‹å¯èƒ½çš„è¥ä¸šé¢å˜åŒ–å¢é•¿ï¼ˆæ¯å¤©è‡³å°‘æœ‰ä¸€ä½é¡¾å®¢ï¼‰</p>
<p>å†™ä¸€æ¡ SQL æŸ¥è¯¢è®¡ç®—ä»¥ 7 å¤©ï¼ˆæŸæ—¥æœŸ + è¯¥æ—¥æœŸå‰çš„ 6 å¤©ï¼‰ä¸ºä¸€ä¸ªæ—¶é—´æ®µçš„é¡¾å®¢æ¶ˆè´¹å¹³å‡å€¼</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼çš„ä¾‹å­å¦‚ä¸‹ï¼š</p>
<ul>
<li>æŸ¥è¯¢ç»“æœæŒ‰ <code>visited_on</code> æ’åº</li>
<li><code>average_amount</code> è¦ <strong>ä¿ç•™ä¸¤ä½å°æ•°</strong>ï¼Œæ—¥æœŸæ•°æ®çš„æ ¼å¼ä¸º (â€˜YYYY-MM-DDâ€™)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Customer è¡¨:</span><br><span class="line">+-------------+--------------+--------------+-------------+</span><br><span class="line">| customer_id | name         | visited_on   | amount      |</span><br><span class="line">+-------------+--------------+--------------+-------------+</span><br><span class="line">| 1           | Jhon         | 2019-01-01   | 100         |</span><br><span class="line">| 2           | Daniel       | 2019-01-02   | 110         |</span><br><span class="line">| 3           | Jade         | 2019-01-03   | 120         |</span><br><span class="line">| 4           | Khaled       | 2019-01-04   | 130         |</span><br><span class="line">| 5           | Winston      | 2019-01-05   | 110         | </span><br><span class="line">| 6           | Elvis        | 2019-01-06   | 140         | </span><br><span class="line">| 7           | Anna         | 2019-01-07   | 150         |</span><br><span class="line">| 8           | Maria        | 2019-01-08   | 80          |</span><br><span class="line">| 9           | Jaze         | 2019-01-09   | 110         | </span><br><span class="line">| 1           | Jhon         | 2019-01-10   | 130         | </span><br><span class="line">| 3           | Jade         | 2019-01-10   | 150         | </span><br><span class="line">+-------------+--------------+--------------+-------------+</span><br><span class="line"></span><br><span class="line">ç»“æœè¡¨:</span><br><span class="line">+--------------+--------------+----------------+</span><br><span class="line">| visited_on   | amount       | average_amount |</span><br><span class="line">+--------------+--------------+----------------+</span><br><span class="line">| 2019-01-07   | 860          | 122.86         |</span><br><span class="line">| 2019-01-08   | 840          | 120            |</span><br><span class="line">| 2019-01-09   | 840          | 120            |</span><br><span class="line">| 2019-01-10   | 1000         | 142.86         |</span><br><span class="line">+--------------+--------------+----------------+</span><br><span class="line"></span><br><span class="line">ç¬¬ä¸€ä¸ªä¸ƒå¤©æ¶ˆè´¹å¹³å‡å€¼ä» 2019-01-01 åˆ° 2019-01-07 æ˜¯ (100 + 110 + 120 + 130 + 110 + 140 + 150)/7 = 122.86</span><br><span class="line">ç¬¬äºŒä¸ªä¸ƒå¤©æ¶ˆè´¹å¹³å‡å€¼ä» 2019-01-02 åˆ° 2019-01-08 æ˜¯ (110 + 120 + 130 + 110 + 140 + 150 + 80)/7 = 120</span><br><span class="line">ç¬¬ä¸‰ä¸ªä¸ƒå¤©æ¶ˆè´¹å¹³å‡å€¼ä» 2019-01-03 åˆ° 2019-01-09 æ˜¯ (120 + 130 + 110 + 140 + 150 + 80 + 110)/7 = 120</span><br><span class="line">ç¬¬å››ä¸ªä¸ƒå¤©æ¶ˆè´¹å¹³å‡å€¼ä» 2019-01-04 åˆ° 2019-01-10 æ˜¯ (130 + 110 + 140 + 150 + 80 + 110 + 130 + 150)/7 = 142.86</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  visited_on,amount,round(amount<span class="operator">/</span><span class="number">7</span>,<span class="number">2</span>) average_amount</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> visited_on,ant,<span class="built_in">lag</span>(visited_on,<span class="number">6</span>,<span class="keyword">null</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> visited_on) lg,</span><br><span class="line">            <span class="built_in">sum</span>(ant) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> visited_on <span class="keyword">rows</span> <span class="keyword">between</span> <span class="number">6</span> PRECEDING <span class="keyword">and</span> <span class="keyword">current</span> <span class="type">row</span>) amount</span><br><span class="line">    <span class="keyword">from</span>(</span><br><span class="line">        <span class="keyword">select</span>  visited_on  ,<span class="built_in">sum</span>(amount) ant</span><br><span class="line">        <span class="keyword">from</span> Customer</span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> visited_on</span><br><span class="line">    )t1</span><br><span class="line">)t2</span><br><span class="line"><span class="keyword">where</span> lg <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br></pre></td></tr></table></figure>



<h4 id="1322-å¹¿å‘Šæ•ˆæœ"><a href="#1322-å¹¿å‘Šæ•ˆæœ" class="headerlink" title="1322. å¹¿å‘Šæ•ˆæœ"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/ads-performance/">1322. å¹¿å‘Šæ•ˆæœ</a></h4><p>éš¾åº¦ç®€å•8æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡å…³æ³¨åé¦ˆ</p>
<p>SQLæ¶æ„</p>
<p>è¡¨: <code>Ads</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| ad_id         | int     |</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| action        | enum    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(ad_id, user_id) æ˜¯è¯¥è¡¨çš„ä¸»é”®</span><br><span class="line">è¯¥è¡¨çš„æ¯ä¸€è¡ŒåŒ…å«ä¸€æ¡å¹¿å‘Šçš„ ID(ad_id)ï¼Œç”¨æˆ·çš„ ID(user_id) å’Œç”¨æˆ·å¯¹å¹¿å‘Šé‡‡å–çš„è¡Œä¸º (action)</span><br><span class="line">action åˆ—æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ (&#x27;Clicked&#x27;, &#x27;Viewed&#x27;, &#x27;Ignored&#x27;) ã€‚</span><br></pre></td></tr></table></figure>

<p>ä¸€å®¶å…¬å¸æ­£åœ¨è¿è¥è¿™äº›å¹¿å‘Šå¹¶æƒ³è®¡ç®—æ¯æ¡å¹¿å‘Šçš„æ•ˆæœã€‚</p>
<p>å¹¿å‘Šæ•ˆæœç”¨ç‚¹å‡»é€šè¿‡ç‡ï¼ˆClick-Through Rateï¼šCTRï¼‰æ¥è¡¡é‡ï¼Œå…¬å¼å¦‚ä¸‹:</p>
<p><img src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/03/06/sql1.png" alt="img"></p>
<p>å†™ä¸€æ¡SQLè¯­å¥æ¥æŸ¥è¯¢æ¯ä¸€æ¡å¹¿å‘Šçš„ <code>ctr</code> ï¼Œ</p>
<p> <code>ctr</code> è¦ä¿ç•™ä¸¤ä½å°æ•°ã€‚ç»“æœéœ€è¦æŒ‰ <code>ctr</code> <strong>é™åº</strong>ã€æŒ‰ <code>ad_id</code> <strong>å‡åº</strong> è¿›è¡Œæ’åºã€‚</p>
<p>æŸ¥è¯¢ç»“æœç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Ads è¡¨:</span><br><span class="line">+-------+---------+---------+</span><br><span class="line">| ad_id | user_id | action  |</span><br><span class="line">+-------+---------+---------+</span><br><span class="line">| 1     | 1       | Clicked |</span><br><span class="line">| 2     | 2       | Clicked |</span><br><span class="line">| 3     | 3       | Viewed  |</span><br><span class="line">| 5     | 5       | Ignored |</span><br><span class="line">| 1     | 7       | Ignored |</span><br><span class="line">| 2     | 7       | Viewed  |</span><br><span class="line">| 3     | 5       | Clicked |</span><br><span class="line">| 1     | 4       | Viewed  |</span><br><span class="line">| 2     | 11      | Viewed  |</span><br><span class="line">| 1     | 2       | Clicked |</span><br><span class="line">+-------+---------+---------+</span><br><span class="line">ç»“æœè¡¨:</span><br><span class="line">+-------+-------+</span><br><span class="line">| ad_id | ctr   |</span><br><span class="line">+-------+-------+</span><br><span class="line">| 1     | 66.67 |</span><br><span class="line">| 3     | 50.00 |</span><br><span class="line">| 2     | 33.33 |</span><br><span class="line">| 5     | 0.00  |</span><br><span class="line">+-------+-------+</span><br><span class="line">å¯¹äº ad_id = 1, ctr = (2/(2+1)) * 100 = 66.67</span><br><span class="line">å¯¹äº ad_id = 2, ctr = (1/(1+2)) * 100 = 33.33</span><br><span class="line">å¯¹äº ad_id = 3, ctr = (1/(1+1)) * 100 = 50.00</span><br><span class="line">å¯¹äº ad_id = 5, ctr = 0.00, æ³¨æ„ ad_id = 5 æ²¡æœ‰è¢«ç‚¹å‡» (Clicked) æˆ–æŸ¥çœ‹ (Viewed) è¿‡</span><br><span class="line">æ³¨æ„æˆ‘ä»¬ä¸å…³å¿ƒ action ä¸º Ingnored çš„å¹¿å‘Š</span><br><span class="line">ç»“æœæŒ‰ ctrï¼ˆé™åºï¼‰ï¼Œad_idï¼ˆå‡åºï¼‰æ’åº</span><br></pre></td></tr></table></figure>

<p>ç²¾ç®€</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ad_id,</span><br><span class="line">    ROUND(IFNULL(<span class="built_in">SUM</span>(action <span class="operator">=</span> <span class="string">&#x27;Clicked&#x27;</span>) <span class="operator">/</span></span><br><span class="line">        (<span class="built_in">SUM</span>(action <span class="operator">=</span> <span class="string">&#x27;Clicked&#x27;</span>) <span class="operator">+</span> <span class="built_in">SUM</span>(action <span class="operator">=</span> <span class="string">&#x27;Viewed&#x27;</span>)) <span class="operator">*</span> <span class="number">100</span>, <span class="number">0</span>), <span class="number">2</span>) <span class="keyword">AS</span> ctr</span><br><span class="line"><span class="keyword">FROM</span> Ads</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> ad_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> ctr <span class="keyword">DESC</span>, ad_id <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>

<p>ç¬¨æ–¹æ³•</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.ad_id,ifnull(ctr,<span class="number">0</span>) ctr</span><br><span class="line"><span class="keyword">from</span> Ads a</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> (</span><br><span class="line">    <span class="keyword">select</span> ad_id,round(<span class="built_in">sum</span>(if(action<span class="operator">=</span><span class="string">&#x27;Clicked&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>))<span class="operator">/</span><span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">*</span><span class="number">100</span>,<span class="number">2</span>) ctr </span><br><span class="line">    <span class="keyword">from</span> Ads </span><br><span class="line">    <span class="keyword">where</span> action <span class="operator">!=</span><span class="string">&#x27;Ignored&#x27;</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> ad_id</span><br><span class="line">)t1 </span><br><span class="line"><span class="keyword">on</span> a.ad_id<span class="operator">=</span> t1.ad_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> ad_id,ctr</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> ctr <span class="keyword">desc</span>,ad_id</span><br></pre></td></tr></table></figure>

<h4 id="1327-åˆ—å‡ºæŒ‡å®šæ—¶é—´æ®µå†…æ‰€æœ‰çš„ä¸‹å•äº§å“"><a href="#1327-åˆ—å‡ºæŒ‡å®šæ—¶é—´æ®µå†…æ‰€æœ‰çš„ä¸‹å•äº§å“" class="headerlink" title="1327. åˆ—å‡ºæŒ‡å®šæ—¶é—´æ®µå†…æ‰€æœ‰çš„ä¸‹å•äº§å“"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/list-the-products-ordered-in-a-period/">1327. åˆ—å‡ºæŒ‡å®šæ—¶é—´æ®µå†…æ‰€æœ‰çš„ä¸‹å•äº§å“</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>è¡¨: <code>Products</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+------------------+---------+</span><br><span class="line">| Column Name      | Type    |</span><br><span class="line">+------------------+---------+</span><br><span class="line">| product_id       | int     |</span><br><span class="line">| product_name     | varchar |</span><br><span class="line">| product_category | varchar |</span><br><span class="line">+------------------+---------+</span><br><span class="line">product_id æ˜¯è¯¥è¡¨ä¸»é”®ã€‚</span><br><span class="line">è¯¥è¡¨åŒ…å«è¯¥å…¬å¸äº§å“çš„æ•°æ®ã€‚</span><br></pre></td></tr></table></figure>

<p>è¡¨: <code>Orders</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| order_date    | date    |</span><br><span class="line">| unit          | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">è¯¥è¡¨æ— ä¸»é”®ï¼Œå¯èƒ½åŒ…å«é‡å¤è¡Œã€‚</span><br><span class="line">product_id æ˜¯è¡¨å• Products çš„å¤–é”®ã€‚</span><br><span class="line">unit æ˜¯åœ¨æ—¥æœŸ order_date å†…ä¸‹å•äº§å“çš„æ•°ç›®ã€‚</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€ä¸ª SQL è¯­å¥ï¼Œè¦æ±‚è·å–åœ¨ 2020 å¹´ 2 æœˆä»½ä¸‹å•çš„æ•°é‡ä¸å°‘äº 100 çš„äº§å“çš„åå­—å’Œæ•°ç›®ã€‚</p>
<p>è¿”å›ç»“æœè¡¨å•çš„é¡ºåºæ— è¦æ±‚ã€‚</p>
<p>æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">Products è¡¨:</span><br><span class="line">+-------------+-----------------------+------------------+</span><br><span class="line">| product_id  | product_name          | product_category |</span><br><span class="line">+-------------+-----------------------+------------------+</span><br><span class="line">| 1           | Leetcode Solutions    | Book             |</span><br><span class="line">| 2           | Jewels of Stringology | Book             |</span><br><span class="line">| 3           | HP                    | Laptop           |</span><br><span class="line">| 4           | Lenovo                | Laptop           |</span><br><span class="line">| 5           | Leetcode Kit          | T-shirt          |</span><br><span class="line">+-------------+-----------------------+------------------+</span><br><span class="line"></span><br><span class="line">Orders è¡¨:</span><br><span class="line">+--------------+--------------+----------+</span><br><span class="line">| product_id   | order_date   | unit     |</span><br><span class="line">+--------------+--------------+----------+</span><br><span class="line">| 1            | 2020-02-05   | 60       |</span><br><span class="line">| 1            | 2020-02-10   | 70       |</span><br><span class="line">| 2            | 2020-01-18   | 30       |</span><br><span class="line">| 2            | 2020-02-11   | 80       |</span><br><span class="line">| 3            | 2020-02-17   | 2        |</span><br><span class="line">| 3            | 2020-02-24   | 3        |</span><br><span class="line">| 4            | 2020-03-01   | 20       |</span><br><span class="line">| 4            | 2020-03-04   | 30       |</span><br><span class="line">| 4            | 2020-03-04   | 60       |</span><br><span class="line">| 5            | 2020-02-25   | 50       |</span><br><span class="line">| 5            | 2020-02-27   | 50       |</span><br><span class="line">| 5            | 2020-03-01   | 50       |</span><br><span class="line">+--------------+--------------+----------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+--------------------+---------+</span><br><span class="line">| product_name       | unit    |</span><br><span class="line">+--------------------+---------+</span><br><span class="line">| Leetcode Solutions | 130     |</span><br><span class="line">| Leetcode Kit       | 100     |</span><br><span class="line">+--------------------+---------+</span><br><span class="line"></span><br><span class="line">2020 å¹´ 2 æœˆä»½ä¸‹å• product_id = 1 çš„äº§å“çš„æ•°ç›®æ€»å’Œä¸º (60 + 70) = 130 ã€‚</span><br><span class="line">2020 å¹´ 2 æœˆä»½ä¸‹å• product_id = 2 çš„äº§å“çš„æ•°ç›®æ€»å’Œä¸º 80 ã€‚</span><br><span class="line">2020 å¹´ 2 æœˆä»½ä¸‹å• product_id = 3 çš„äº§å“çš„æ•°ç›®æ€»å’Œä¸º (2 + 3) = 5 ã€‚</span><br><span class="line">2020 å¹´ 2 æœˆä»½ product_id = 4 çš„äº§å“å¹¶æ²¡æœ‰ä¸‹å•ã€‚</span><br><span class="line">2020 å¹´ 2 æœˆä»½ä¸‹å• product_id = 5 çš„äº§å“çš„æ•°ç›®æ€»å’Œä¸º (50 + 50) = 100 ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> product_name,<span class="built_in">sum</span>(unit) unit </span><br><span class="line"><span class="keyword">from</span> Orders o <span class="keyword">left</span> <span class="keyword">join</span> Products p</span><br><span class="line"><span class="keyword">on</span> o.product_id<span class="operator">=</span>p.product_id</span><br><span class="line"><span class="keyword">where</span> date_format(order_date,<span class="string">&#x27;%Y-%m&#x27;</span>)<span class="operator">=</span><span class="string">&#x27;2020-02&#x27;</span> </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> product_name</span><br><span class="line"><span class="keyword">having</span> unit<span class="operator">&gt;=</span><span class="number">100</span></span><br></pre></td></tr></table></figure>

<h4 id="1336-æ¯æ¬¡è®¿é—®çš„äº¤æ˜“æ¬¡æ•°"><a href="#1336-æ¯æ¬¡è®¿é—®çš„äº¤æ˜“æ¬¡æ•°" class="headerlink" title="1336. æ¯æ¬¡è®¿é—®çš„äº¤æ˜“æ¬¡æ•°"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/number-of-transactions-per-visit/">1336. æ¯æ¬¡è®¿é—®çš„äº¤æ˜“æ¬¡æ•°</a></h4><p>éš¾åº¦å›°éš¾</p>
<p>SQLæ¶æ„</p>
<p>è¡¨: <code>Visits</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| visit_date    | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(user_id, visit_date) æ˜¯è¯¥è¡¨çš„ä¸»é”®</span><br><span class="line">è¯¥è¡¨çš„æ¯è¡Œè¡¨ç¤º user_id åœ¨ visit_date è®¿é—®äº†é“¶è¡Œ</span><br></pre></td></tr></table></figure>

<p>è¡¨: <code>Transactions</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+------------------+---------+</span><br><span class="line">| Column Name      | Type    |</span><br><span class="line">+------------------+---------+</span><br><span class="line">| user_id          | int     |</span><br><span class="line">| transaction_date | date    |</span><br><span class="line">| amount           | int     |</span><br><span class="line">+------------------+---------+</span><br><span class="line">è¯¥è¡¨æ²¡æœ‰ä¸»é”®ï¼Œæ‰€ä»¥å¯èƒ½æœ‰é‡å¤è¡Œ</span><br><span class="line">è¯¥è¡¨çš„æ¯ä¸€è¡Œè¡¨ç¤º user_id åœ¨ transaction_date å®Œæˆäº†ä¸€ç¬” amount æ•°é¢çš„äº¤æ˜“</span><br><span class="line">å¯ä»¥ä¿è¯ç”¨æˆ· (user) åœ¨ transaction_date è®¿é—®äº†é“¶è¡Œ (ä¹Ÿå°±æ˜¯è¯´ Visits è¡¨åŒ…å« (user_id, transaction_date) è¡Œ)</span><br></pre></td></tr></table></figure>

<p>é“¶è¡Œæƒ³è¦å¾—åˆ°é“¶è¡Œå®¢æˆ·åœ¨ä¸€æ¬¡è®¿é—®æ—¶çš„äº¤æ˜“æ¬¡æ•°å’Œç›¸åº”çš„åœ¨ä¸€æ¬¡è®¿é—®æ—¶è¯¥äº¤æ˜“æ¬¡æ•°çš„å®¢æˆ·æ•°é‡çš„å›¾è¡¨</p>
<p>å†™ä¸€æ¡ SQL æŸ¥è¯¢å¤šå°‘å®¢æˆ·è®¿é—®äº†é“¶è¡Œä½†æ²¡æœ‰è¿›è¡Œä»»ä½•äº¤æ˜“ï¼Œå¤šå°‘å®¢æˆ·è®¿é—®äº†é“¶è¡Œè¿›è¡Œäº†ä¸€æ¬¡äº¤æ˜“ç­‰ç­‰</p>
<p>ç»“æœåŒ…å«ä¸¤åˆ—ï¼š</p>
<ul>
<li><code>transactions_countï¼š</code> å®¢æˆ·åœ¨ä¸€æ¬¡è®¿é—®ä¸­çš„äº¤æ˜“æ¬¡æ•°</li>
<li><code>visits_countï¼š</code> åœ¨ <code>transactions_count</code> äº¤æ˜“æ¬¡æ•°ä¸‹ç›¸åº”çš„ä¸€æ¬¡è®¿é—®æ—¶çš„å®¢æˆ·æ•°é‡</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transactions_count` çš„å€¼ä» `0` åˆ°æ‰€æœ‰ç”¨æˆ·ä¸€æ¬¡è®¿é—®ä¸­çš„ `max(transactions_count)</span><br></pre></td></tr></table></figure>

<p>æŒ‰ <code>transactions_count</code> æ’åº</p>
<p>ä¸‹é¢æ˜¯æŸ¥è¯¢ç»“æœæ ¼å¼çš„ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">Visits è¡¨:</span><br><span class="line">+---------+------------+</span><br><span class="line">| user_id | visit_date |</span><br><span class="line">+---------+------------+</span><br><span class="line">| 1       | 2020-01-01 |</span><br><span class="line">| 2       | 2020-01-02 |</span><br><span class="line">| 12      | 2020-01-01 |</span><br><span class="line">| 19      | 2020-01-03 |</span><br><span class="line">| 1       | 2020-01-02 |</span><br><span class="line">| 2       | 2020-01-03 |</span><br><span class="line">| 1       | 2020-01-04 |</span><br><span class="line">| 7       | 2020-01-11 |</span><br><span class="line">| 9       | 2020-01-25 |</span><br><span class="line">| 8       | 2020-01-28 |</span><br><span class="line">+---------+------------+</span><br><span class="line">Transactions è¡¨:</span><br><span class="line">+---------+------------------+--------+</span><br><span class="line">| user_id | transaction_date | amount |</span><br><span class="line">+---------+------------------+--------+</span><br><span class="line">| 1       | 2020-01-02       | 120    |</span><br><span class="line">| 2       | 2020-01-03       | 22     |</span><br><span class="line">| 7       | 2020-01-11       | 232    |</span><br><span class="line">| 1       | 2020-01-04       | 7      |</span><br><span class="line">| 9       | 2020-01-25       | 33     |</span><br><span class="line">| 9       | 2020-01-25       | 66     |</span><br><span class="line">| 8       | 2020-01-28       | 1      |</span><br><span class="line">| 9       | 2020-01-25       | 99     |</span><br><span class="line">+---------+------------------+--------+</span><br><span class="line">ç»“æœè¡¨:</span><br><span class="line">+--------------------+--------------+</span><br><span class="line">| transactions_count | visits_count |</span><br><span class="line">+--------------------+--------------+</span><br><span class="line">| 0                  | 4            |</span><br><span class="line">| 1                  | 5            |</span><br><span class="line">| 2                  | 0            |</span><br><span class="line">| 3                  | 1            |</span><br><span class="line">+--------------------+--------------+</span><br><span class="line">* å¯¹äº transactions_count = 0, visits ä¸­ (1, &quot;2020-01-01&quot;), (2, &quot;2020-01-02&quot;), (12, &quot;2020-01-01&quot;) å’Œ (19, &quot;2020-01-03&quot;) æ²¡æœ‰è¿›è¡Œäº¤æ˜“ï¼Œæ‰€ä»¥ visits_count = 4 ã€‚</span><br><span class="line">* å¯¹äº transactions_count = 1, visits ä¸­ (2, &quot;2020-01-03&quot;), (7, &quot;2020-01-11&quot;), (8, &quot;2020-01-28&quot;), (1, &quot;2020-01-02&quot;) å’Œ (1, &quot;2020-01-04&quot;) è¿›è¡Œäº†ä¸€æ¬¡äº¤æ˜“ï¼Œæ‰€ä»¥ visits_count = 5 ã€‚</span><br><span class="line">* å¯¹äº transactions_count = 2, æ²¡æœ‰å®¢æˆ·è®¿é—®é“¶è¡Œè¿›è¡Œäº†ä¸¤æ¬¡äº¤æ˜“ï¼Œæ‰€ä»¥ visits_count = 0 ã€‚</span><br><span class="line">* å¯¹äº transactions_count = 3, visits ä¸­ (9, &quot;2020-01-25&quot;) è¿›è¡Œäº†ä¸‰æ¬¡äº¤æ˜“ï¼Œæ‰€ä»¥ visits_count = 1 ã€‚</span><br><span class="line">* å¯¹äº transactions_count &gt;= 4, æ²¡æœ‰å®¢æˆ·è®¿é—®é“¶è¡Œè¿›è¡Œäº†è¶…è¿‡3æ¬¡äº¤æ˜“ï¼Œæ‰€ä»¥æˆ‘ä»¬åœæ­¢åœ¨ transactions_count = 3 ã€‚</span><br><span class="line"></span><br><span class="line">å¦‚ä¸‹æ˜¯è¿™ä¸ªä¾‹å­çš„å›¾è¡¨ï¼š</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">SELECT</span> t5.rnb <span class="keyword">AS</span> transactions_count, IFNULL(visits_count, <span class="number">0</span>) <span class="keyword">AS</span> visits_count</span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="number">0</span> <span class="keyword">AS</span> rnb</span><br><span class="line">        <span class="keyword">UNION</span></span><br><span class="line">        <span class="keyword">SELECT</span> <span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span> () <span class="keyword">AS</span> rnb</span><br><span class="line">        <span class="keyword">FROM</span> Transactions</span><br><span class="line">    ) t5</span><br><span class="line">    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">SELECT</span></span><br><span class="line">            cnt <span class="keyword">AS</span> transactions_count</span><br><span class="line">            ,<span class="built_in">COUNT</span>(user_id) <span class="keyword">AS</span> visits_count</span><br><span class="line">        <span class="keyword">FROM</span></span><br><span class="line">        (</span><br><span class="line">            <span class="keyword">SELECT</span> t1.user_id, <span class="built_in">COUNT</span>(t2.amount) <span class="keyword">AS</span> cnt</span><br><span class="line">            <span class="keyword">FROM</span> Visits t1</span><br><span class="line">            <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Transactions t2</span><br><span class="line">            <span class="keyword">ON</span> t1.user_id <span class="operator">=</span> t2.user_id <span class="keyword">AND</span> t1.visit_date <span class="operator">=</span> t2.transaction_date</span><br><span class="line">            <span class="keyword">GROUP</span> <span class="keyword">BY</span> user_id, visit_date</span><br><span class="line">        ) t3</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> cnt</span><br><span class="line">    ) t4</span><br><span class="line">    <span class="keyword">ON</span> t5.rnb <span class="operator">=</span> t4.transactions_count</span><br><span class="line">) t6</span><br><span class="line"><span class="keyword">WHERE</span> transactions_count <span class="operator">&lt;=</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(t2.amount) <span class="keyword">AS</span> cnt</span><br><span class="line">    <span class="keyword">FROM</span> Visits t1</span><br><span class="line">    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Transactions t2</span><br><span class="line">    <span class="keyword">ON</span> t1.user_id <span class="operator">=</span> t2.user_id <span class="keyword">AND</span> t1.visit_date <span class="operator">=</span> t2.transaction_date</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> t1.user_id, visit_date</span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> cnt <span class="keyword">DESC</span></span><br><span class="line">    LIMIT <span class="number">1</span>)</span><br></pre></td></tr></table></figure>



<blockquote>
<p>éš¾ç‚¹ ä»0è‡ªå¢åºåˆ—ï¼Œ2äº¤æ˜“çš„äººæ•°ä¸º0</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> pcnt transactions_count,<span class="built_in">count</span>(<span class="operator">*</span>) visits_count</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span> visit_date,</span><br><span class="line">        <span class="built_in">sum</span>(if(amount <span class="keyword">is</span>  <span class="keyword">null</span>,<span class="number">0</span>,<span class="number">1</span>)) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> transaction_date ) pcnt,</span><br><span class="line">        <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span>  visit_date ) tcnt</span><br><span class="line"><span class="keyword">from</span> Visits v <span class="keyword">left</span> <span class="keyword">join</span> Transactions t</span><br><span class="line"><span class="keyword">on</span> v.user_id<span class="operator">=</span> t.user_id <span class="keyword">and</span> v.visit_date<span class="operator">=</span>t.transaction_date</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> pcnt</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå¾—å‡ºç»“æœæ˜¯[0, 4], [1, 5], [3, 3] å°‘äº†[2,0] è¿˜æ²¡æƒ³åˆ°ä»€ä¹ˆå¥½åŠæ³•èƒ½æŠŠ[2ï¼Œ0]åŠ è¿›å»ã€‚ã€‚ã€‚</p>
<h4 id="1341-ç”µå½±è¯„åˆ†"><a href="#1341-ç”µå½±è¯„åˆ†" class="headerlink" title="1341. ç”µå½±è¯„åˆ†"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/movie-rating/">1341. ç”µå½±è¯„åˆ†</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>è¡¨ï¼š<code>Movies</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| movie_id      | int     |</span><br><span class="line">| title         | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">movie_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">title æ˜¯ç”µå½±çš„åå­—ã€‚</span><br></pre></td></tr></table></figure>

<p>è¡¨ï¼š<code>Users</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">user_id æ˜¯è¡¨çš„ä¸»é”®ã€‚</span><br></pre></td></tr></table></figure>

<p>è¡¨ï¼š<code>Movie_Rating</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| movie_id      | int     |</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| rating        | int     |</span><br><span class="line">| created_at    | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(movie_id, user_id) æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¿™ä¸ªè¡¨åŒ…å«ç”¨æˆ·åœ¨å…¶è¯„è®ºä¸­å¯¹ç”µå½±çš„è¯„åˆ† rating ã€‚</span><br><span class="line">created_at æ˜¯ç”¨æˆ·çš„ç‚¹è¯„æ—¥æœŸã€‚ </span><br></pre></td></tr></table></figure>

<p>è¯·ä½ ç¼–å†™ä¸€ç»„ SQL æŸ¥è¯¢ï¼š</p>
<ul>
<li><p>æŸ¥æ‰¾è¯„è®ºç”µå½±æ•°é‡æœ€å¤šçš„ç”¨æˆ·åã€‚</p>
<p>å¦‚æœå‡ºç°å¹³å±€ï¼Œè¿”å›å­—å…¸åºè¾ƒå°çš„ç”¨æˆ·åã€‚</p>
</li>
<li><p>æŸ¥æ‰¾åœ¨</p>
<p>2020 å¹´ 2 æœˆ å¹³å‡è¯„åˆ†æœ€é«˜</p>
<p>çš„ç”µå½±åç§°ã€‚</p>
<p>å¦‚æœå‡ºç°å¹³å±€ï¼Œè¿”å›å­—å…¸åºè¾ƒå°çš„ç”µå½±åç§°ã€‚</p>
</li>
</ul>
<p>æŸ¥è¯¢åˆ†ä¸¤è¡Œè¿”å›ï¼ŒæŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">Movies è¡¨ï¼š</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| movie_id    |  title       |</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| 1           | Avengers     |</span><br><span class="line">| 2           | Frozen 2     |</span><br><span class="line">| 3           | Joker        |</span><br><span class="line">+-------------+--------------+</span><br><span class="line"></span><br><span class="line">Users è¡¨ï¼š</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| user_id     |  name        |</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| 1           | Daniel       |</span><br><span class="line">| 2           | Monica       |</span><br><span class="line">| 3           | Maria        |</span><br><span class="line">| 4           | James        |</span><br><span class="line">+-------------+--------------+</span><br><span class="line"></span><br><span class="line">Movie_Rating è¡¨ï¼š</span><br><span class="line">+-------------+--------------+--------------+-------------+</span><br><span class="line">| movie_id    | user_id      | rating       | created_at  |</span><br><span class="line">+-------------+--------------+--------------+-------------+</span><br><span class="line">| 1           | 1            | 3            | 2020-01-12  |</span><br><span class="line">| 1           | 2            | 4            | 2020-02-11  |</span><br><span class="line">| 1           | 3            | 2            | 2020-02-12  |</span><br><span class="line">| 1           | 4            | 1            | 2020-01-01  |</span><br><span class="line">| 2           | 1            | 5            | 2020-02-17  | </span><br><span class="line">| 2           | 2            | 2            | 2020-02-01  | </span><br><span class="line">| 2           | 3            | 2            | 2020-03-01  |</span><br><span class="line">| 3           | 1            | 3            | 2020-02-22  | </span><br><span class="line">| 3           | 2            | 4            | 2020-02-25  | </span><br><span class="line">+-------------+--------------+--------------+-------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+--------------+</span><br><span class="line">| results      |</span><br><span class="line">+--------------+</span><br><span class="line">| Daniel       |</span><br><span class="line">| Frozen 2     |</span><br><span class="line">+--------------+</span><br><span class="line"></span><br><span class="line">Daniel å’Œ Monica éƒ½ç‚¹è¯„äº† 3 éƒ¨ç”µå½±ï¼ˆ&quot;Avengers&quot;, &quot;Frozen 2&quot; å’Œ &quot;Joker&quot;ï¼‰ ä½†æ˜¯ Daniel å­—å…¸åºæ¯”è¾ƒå°ã€‚</span><br><span class="line">Frozen 2 å’Œ Joker åœ¨ 2 æœˆçš„è¯„åˆ†éƒ½æ˜¯ 3.5ï¼Œä½†æ˜¯ Frozen 2 çš„å­—å…¸åºæ¯”è¾ƒå°ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name results </span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> m.user_id ,u.name </span><br><span class="line">    <span class="keyword">from</span> Movie_Rating m <span class="keyword">left</span> <span class="keyword">join</span> Users u </span><br><span class="line">    <span class="keyword">on</span> m.user_id <span class="operator">=</span> u.user_id</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> user_id</span><br><span class="line">    <span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">desc</span>,name</span><br><span class="line">    limit <span class="number">1</span></span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">union</span> </span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> title results</span><br><span class="line"><span class="keyword">from</span> Movie_Rating r <span class="keyword">left</span> <span class="keyword">join</span> Movies m</span><br><span class="line"><span class="keyword">on</span> r.movie_id <span class="operator">=</span>m.movie_id </span><br><span class="line"><span class="keyword">where</span> date_format(created_at,<span class="string">&#x27;%Y-%m&#x27;</span>)<span class="operator">=</span><span class="string">&#x27;2020-02&#x27;</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> r.movie_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">avg</span>(rating) <span class="keyword">desc</span>,title </span><br><span class="line">limit <span class="number">1</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<h4 id="1350-é™¢ç³»æ— æ•ˆçš„å­¦ç”Ÿ"><a href="#1350-é™¢ç³»æ— æ•ˆçš„å­¦ç”Ÿ" class="headerlink" title="1350. é™¢ç³»æ— æ•ˆçš„å­¦ç”Ÿ"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/students-with-invalid-departments/">1350. é™¢ç³»æ— æ•ˆçš„å­¦ç”Ÿ</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>é™¢ç³»è¡¨: <code>Departments</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id æ˜¯è¯¥è¡¨çš„ä¸»é”®</span><br><span class="line">è¯¥è¡¨åŒ…å«ä¸€æ‰€å¤§å­¦æ¯ä¸ªé™¢ç³»çš„ id ä¿¡æ¯</span><br></pre></td></tr></table></figure>

<p>å­¦ç”Ÿè¡¨: <code>Students</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">| department_id | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id æ˜¯è¯¥è¡¨çš„ä¸»é”®</span><br><span class="line">è¯¥è¡¨åŒ…å«ä¸€æ‰€å¤§å­¦æ¯ä¸ªå­¦ç”Ÿçš„ id å’Œä»–/å¥¹å°±è¯»çš„é™¢ç³»ä¿¡æ¯</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€æ¡ SQL è¯­å¥ä»¥æŸ¥è¯¢é‚£äº›æ‰€åœ¨é™¢ç³»ä¸å­˜åœ¨çš„å­¦ç”Ÿçš„ id å’Œå§“å</p>
<p>å¯ä»¥ä»¥ä»»ä½•é¡ºåºè¿”å›ç»“æœ</p>
<p>ä¸‹é¢æ˜¯è¿”å›ç»“æœæ ¼å¼çš„ä¾‹å­</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">Departments è¡¨:</span><br><span class="line">+------+--------------------------+</span><br><span class="line">| id   | name                     |</span><br><span class="line">+------+--------------------------+</span><br><span class="line">| 1    | Electrical Engineering   |</span><br><span class="line">| 7    | Computer Engineering     |</span><br><span class="line">| 13   | Bussiness Administration |</span><br><span class="line">+------+--------------------------+</span><br><span class="line"></span><br><span class="line">Students è¡¨:</span><br><span class="line">+------+----------+---------------+</span><br><span class="line">| id   | name     | department_id |</span><br><span class="line">+------+----------+---------------+</span><br><span class="line">| 23   | Alice    | 1             |</span><br><span class="line">| 1    | Bob      | 7             |</span><br><span class="line">| 5    | Jennifer | 13            |</span><br><span class="line">| 2    | John     | 14            |</span><br><span class="line">| 4    | Jasmine  | 77            |</span><br><span class="line">| 3    | Steve    | 74            |</span><br><span class="line">| 6    | Luis     | 1             |</span><br><span class="line">| 8    | Jonathan | 7             |</span><br><span class="line">| 7    | Daiana   | 33            |</span><br><span class="line">| 11   | Madelynn | 1             |</span><br><span class="line">+------+----------+---------------+</span><br><span class="line"></span><br><span class="line">ç»“æœè¡¨:</span><br><span class="line">+------+----------+</span><br><span class="line">| id   | name     |</span><br><span class="line">+------+----------+</span><br><span class="line">| 2    | John     |</span><br><span class="line">| 7    | Daiana   |</span><br><span class="line">| 4    | Jasmine  |</span><br><span class="line">| 3    | Steve    |</span><br><span class="line">+------+----------+</span><br><span class="line"></span><br><span class="line">John, Daiana, Steve å’Œ Jasmine æ‰€åœ¨çš„é™¢ç³»åˆ†åˆ«æ˜¯ 14, 33, 74 å’Œ 77ï¼Œ å…¶ä¸­ 14, 33, 74 å’Œ 77 å¹¶ä¸å­˜åœ¨äºé™¢ç³»è¡¨</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,name  </span><br><span class="line"><span class="keyword">from</span> Students </span><br><span class="line"><span class="keyword">where</span> department_id <span class="keyword">not</span> <span class="keyword">in</span> </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> id </span><br><span class="line">    <span class="keyword">from</span> Departments</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="1355-æ´»åŠ¨å‚ä¸è€…"><a href="#1355-æ´»åŠ¨å‚ä¸è€…" class="headerlink" title="1355. æ´»åŠ¨å‚ä¸è€…"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/activity-participants/">1355. æ´»åŠ¨å‚ä¸è€…</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>è¡¨: <code>Friends</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">| activity      | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id æ˜¯æœ‹å‹çš„ id å’Œè¯¥è¡¨çš„ä¸»é”®</span><br><span class="line">name æ˜¯æœ‹å‹çš„åå­—</span><br><span class="line">activity æ˜¯æœ‹å‹å‚åŠ çš„æ´»åŠ¨çš„åå­—</span><br></pre></td></tr></table></figure>

<p>è¡¨: <code>Activities</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id æ˜¯è¯¥è¡¨çš„ä¸»é”®</span><br><span class="line">name æ˜¯æ´»åŠ¨çš„åå­—</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€æ¡ SQL æŸ¥è¯¢é‚£äº›æ—¢æ²¡æœ‰æœ€å¤šï¼Œä¹Ÿæ²¡æœ‰æœ€å°‘å‚ä¸è€…çš„æ´»åŠ¨çš„åå­—</p>
<p>å¯ä»¥ä»¥ä»»ä½•é¡ºåºè¿”å›ç»“æœï¼ŒActivities è¡¨çš„æ¯é¡¹æ´»åŠ¨çš„å‚ä¸è€…éƒ½æ¥è‡ª Friends è¡¨</p>
<p>ä¸‹é¢æ˜¯æŸ¥è¯¢ç»“æœæ ¼å¼çš„ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Friends è¡¨:</span><br><span class="line">+------+--------------+---------------+</span><br><span class="line">| id   | name         | activity      |</span><br><span class="line">+------+--------------+---------------+</span><br><span class="line">| 1    | Jonathan D.  | Eating        |</span><br><span class="line">| 2    | Jade W.      | Singing       |</span><br><span class="line">| 3    | Victor J.    | Singing       |</span><br><span class="line">| 4    | Elvis Q.     | Eating        |</span><br><span class="line">| 5    | Daniel A.    | Eating        |</span><br><span class="line">| 6    | Bob B.       | Horse Riding  |</span><br><span class="line">+------+--------------+---------------+</span><br><span class="line"></span><br><span class="line">Activities è¡¨:</span><br><span class="line">+------+--------------+</span><br><span class="line">| id   | name         |</span><br><span class="line">+------+--------------+</span><br><span class="line">| 1    | Eating       |</span><br><span class="line">| 2    | Singing      |</span><br><span class="line">| 3    | Horse Riding |</span><br><span class="line">+------+--------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+--------------+</span><br><span class="line">| activity     |</span><br><span class="line">+--------------+</span><br><span class="line">| Singing      |</span><br><span class="line">+--------------+</span><br><span class="line"></span><br><span class="line">Eating æ´»åŠ¨æœ‰ä¸‰ä¸ªäººå‚åŠ , æ˜¯æœ€å¤šäººå‚åŠ çš„æ´»åŠ¨ (Jonathan D. , Elvis Q. and Daniel A.)</span><br><span class="line">Horse Riding æ´»åŠ¨æœ‰ä¸€ä¸ªäººå‚åŠ , æ˜¯æœ€å°‘äººå‚åŠ çš„æ´»åŠ¨ (Bob B.)</span><br><span class="line">Singing æ´»åŠ¨æœ‰ä¸¤ä¸ªäººå‚åŠ  (Victor J. and Jade W.)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> activity</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> activity,</span><br><span class="line">    <span class="built_in">rank</span>()<span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> cnt) rk1,</span><br><span class="line">    <span class="built_in">rank</span>()<span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> cnt <span class="keyword">desc</span>) rk2</span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span>  activity  ,<span class="built_in">count</span>(<span class="operator">*</span>) cnt</span><br><span class="line">        <span class="keyword">from</span>  Friends</span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span>  activity </span><br><span class="line">    )t1</span><br><span class="line">)t2</span><br><span class="line"><span class="keyword">where</span> rk1 <span class="operator">!=</span><span class="number">1</span> <span class="keyword">and</span> rk2 <span class="operator">!=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸éœ€è¦å…³è” Activitiesè¡¨ï¼Œå› ä¸º è‡³å°‘æœ‰ä¸€äººå‚åŠ </p>
</blockquote>
<h4 id="1364-é¡¾å®¢çš„å¯ä¿¡è”ç³»äººæ•°é‡"><a href="#1364-é¡¾å®¢çš„å¯ä¿¡è”ç³»äººæ•°é‡" class="headerlink" title="1364. é¡¾å®¢çš„å¯ä¿¡è”ç³»äººæ•°é‡"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/number-of-trusted-contacts-of-a-customer/">1364. é¡¾å®¢çš„å¯ä¿¡è”ç³»äººæ•°é‡</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>é¡¾å®¢è¡¨ï¼š<code>Customers</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| customer_name | varchar |</span><br><span class="line">| email         | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">customer_id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">æ­¤è¡¨çš„æ¯ä¸€è¡ŒåŒ…å«äº†æŸåœ¨çº¿å•†åº—é¡¾å®¢çš„å§“åå’Œç”µå­é‚®ä»¶ã€‚</span><br></pre></td></tr></table></figure>

<p>è”ç³»æ–¹å¼è¡¨ï¼š<code>Contacts</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | id      |</span><br><span class="line">| contact_name  | varchar |</span><br><span class="line">| contact_email | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(user_id, contact_email) æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">æ­¤è¡¨çš„æ¯ä¸€è¡Œè¡¨ç¤ºç¼–å·ä¸º user_id çš„é¡¾å®¢çš„æŸä½è”ç³»äººçš„å§“åå’Œç”µå­é‚®ä»¶ã€‚</span><br><span class="line">æ­¤è¡¨åŒ…å«æ¯ä½é¡¾å®¢çš„è”ç³»äººä¿¡æ¯ï¼Œä½†é¡¾å®¢çš„è”ç³»äººä¸ä¸€å®šå­˜åœ¨äºé¡¾å®¢è¡¨ä¸­ã€‚</span><br></pre></td></tr></table></figure>

<p>å‘ç¥¨è¡¨ï¼š<code>Invoices</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| invoice_id   | int     |</span><br><span class="line">| price        | int     |</span><br><span class="line">| user_id      | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">invoice_id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">æ­¤è¡¨çš„æ¯ä¸€è¡Œåˆ†åˆ«è¡¨ç¤ºç¼–å·ä¸º user_id çš„é¡¾å®¢æ‹¥æœ‰æœ‰ä¸€å¼ ç¼–å·ä¸º invoice_idã€ä»·æ ¼ä¸º price çš„å‘ç¥¨ã€‚</span><br></pre></td></tr></table></figure>

<p>ä¸ºæ¯å¼ å‘ç¥¨ <code>invoice_id</code> ç¼–å†™ä¸€ä¸ªSQLæŸ¥è¯¢ä»¥æŸ¥æ‰¾ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li><code>customer_name</code>ï¼šä¸å‘ç¥¨ç›¸å…³çš„é¡¾å®¢åç§°ã€‚</li>
<li><code>price</code>ï¼šå‘ç¥¨çš„ä»·æ ¼ã€‚</li>
<li><code>contacts_cnt</code>ï¼šè¯¥é¡¾å®¢çš„è”ç³»äººæ•°é‡ã€‚</li>
<li><code>trusted_contacts_cnt</code>ï¼šå¯ä¿¡è”ç³»äººçš„æ•°é‡ï¼šæ—¢æ˜¯è¯¥é¡¾å®¢çš„è”ç³»äººåˆæ˜¯å•†åº—é¡¾å®¢çš„è”ç³»äººæ•°é‡ï¼ˆå³ï¼šå¯ä¿¡è”ç³»äººçš„ç”µå­é‚®ä»¶å­˜åœ¨äºå®¢æˆ·è¡¨ä¸­ï¼‰ã€‚</li>
</ul>
<p>å°†æŸ¥è¯¢çš„ç»“æœæŒ‰ç…§ <code>invoice_id</code> æ’åºã€‚</p>
<p>æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">Customers table:</span><br><span class="line">+-------------+---------------+--------------------+</span><br><span class="line">| customer_id | customer_name | email              |</span><br><span class="line">+-------------+---------------+--------------------+</span><br><span class="line">| 1           | Alice         | alice@leetcode.com |</span><br><span class="line">| 2           | Bob           | bob@leetcode.com   |</span><br><span class="line">| 13          | John          | john@leetcode.com  |</span><br><span class="line">| 6           | Alex          | alex@leetcode.com  |</span><br><span class="line">+-------------+---------------+--------------------+</span><br><span class="line">Contacts table:</span><br><span class="line">+-------------+--------------+--------------------+</span><br><span class="line">| user_id     | contact_name | contact_email      |</span><br><span class="line">+-------------+--------------+--------------------+</span><br><span class="line">| 1           | Bob          | bob@leetcode.com   |</span><br><span class="line">| 1           | John         | john@leetcode.com  |</span><br><span class="line">| 1           | Jal          | jal@leetcode.com   |</span><br><span class="line">| 2           | Omar         | omar@leetcode.com  |</span><br><span class="line">| 2           | Meir         | meir@leetcode.com  |</span><br><span class="line">| 6           | Alice        | alice@leetcode.com |</span><br><span class="line">+-------------+--------------+--------------------+</span><br><span class="line">Invoices table:</span><br><span class="line">+------------+-------+---------+</span><br><span class="line">| invoice_id | price | user_id |</span><br><span class="line">+------------+-------+---------+</span><br><span class="line">| 77         | 100   | 1       |</span><br><span class="line">| 88         | 200   | 1       |</span><br><span class="line">| 99         | 300   | 2       |</span><br><span class="line">| 66         | 400   | 2       |</span><br><span class="line">| 55         | 500   | 13      |</span><br><span class="line">| 44         | 60    | 6       |</span><br><span class="line">+------------+-------+---------+</span><br><span class="line">Result table:</span><br><span class="line">+------------+---------------+-------+--------------+----------------------+</span><br><span class="line">| invoice_id | customer_name | price | contacts_cnt | trusted_contacts_cnt |</span><br><span class="line">+------------+---------------+-------+--------------+----------------------+</span><br><span class="line">| 44         | Alex          | 60    | 1            | 1                    |</span><br><span class="line">| 55         | John          | 500   | 0            | 0                    |</span><br><span class="line">| 66         | Bob           | 400   | 2            | 0                    |</span><br><span class="line">| 77         | Alice         | 100   | 3            | 2                    |</span><br><span class="line">| 88         | Alice         | 200   | 3            | 2                    |</span><br><span class="line">| 99         | Bob           | 300   | 2            | 0                    |</span><br><span class="line">+------------+---------------+-------+--------------+----------------------+</span><br><span class="line">Alice æœ‰ä¸‰ä½è”ç³»äººï¼Œå…¶ä¸­ä¸¤ä½(Bob å’Œ John)æ˜¯å¯ä¿¡è”ç³»äººã€‚</span><br><span class="line">Bob æœ‰ä¸¤ä½è”ç³»äºº, ä»–ä»¬ä¸­çš„ä»»ä½•ä¸€ä½éƒ½ä¸æ˜¯å¯ä¿¡è”ç³»äººã€‚</span><br><span class="line">Alex åªæœ‰ä¸€ä½è”ç³»äºº(Alice)ï¼Œå¹¶æ˜¯ä¸€ä½å¯ä¿¡è”ç³»äººã€‚</span><br><span class="line">John æ²¡æœ‰ä»»ä½•è”ç³»äººã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> invoice_id ,customer_name,price,ifnull(cnt,<span class="number">0</span>) contacts_cnt,ifnull(bc,<span class="number">0</span>) trusted_contacts_cnt </span><br><span class="line"><span class="keyword">from</span> Invoices i</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> (</span><br><span class="line"><span class="keyword">select</span> user_id ,<span class="built_in">count</span>(<span class="operator">*</span>) cnt</span><br><span class="line"><span class="keyword">from</span> Contacts</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> user_id</span><br><span class="line">) t1</span><br><span class="line"><span class="keyword">on</span> i.user_id<span class="operator">=</span>t1.user_id</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> (</span><br><span class="line"><span class="keyword">select</span>  user_id ,<span class="built_in">count</span>(<span class="operator">*</span>) bc</span><br><span class="line"><span class="keyword">from</span> Contacts</span><br><span class="line">    <span class="keyword">where</span> contact_name <span class="keyword">in</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> customer_name</span><br><span class="line">        <span class="keyword">from</span> Customers</span><br><span class="line">    )</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> user_id </span><br><span class="line">)t2</span><br><span class="line"><span class="keyword">on</span> i.user_id <span class="operator">=</span> t2.user_id</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Customers c</span><br><span class="line"><span class="keyword">on</span> i.user_id<span class="operator">=</span> c.customer_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> invoice_id</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å°±æ˜¯éº»çƒ¦ç‚¹ å„ç§join</p>
</blockquote>
<h4 id="1369-è·å–æœ€è¿‘ç¬¬äºŒæ¬¡çš„æ´»åŠ¨"><a href="#1369-è·å–æœ€è¿‘ç¬¬äºŒæ¬¡çš„æ´»åŠ¨" class="headerlink" title="1369. è·å–æœ€è¿‘ç¬¬äºŒæ¬¡çš„æ´»åŠ¨"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/get-the-second-most-recent-activity/">1369. è·å–æœ€è¿‘ç¬¬äºŒæ¬¡çš„æ´»åŠ¨</a></h4><p>éš¾åº¦å›°éš¾</p>
<p>SQLæ¶æ„</p>
<p>è¡¨: <code>UserActivity</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| username      | varchar |</span><br><span class="line">| activity      | varchar |</span><br><span class="line">| startDate     | Date    |</span><br><span class="line">| endDate       | Date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">è¯¥è¡¨ä¸åŒ…å«ä¸»é”®</span><br><span class="line">è¯¥è¡¨åŒ…å«æ¯ä¸ªç”¨æˆ·åœ¨ä¸€æ®µæ—¶é—´å†…è¿›è¡Œçš„æ´»åŠ¨çš„ä¿¡æ¯</span><br><span class="line">åä¸º username çš„ç”¨æˆ·åœ¨ startDate åˆ° endDate æ—¥å†…æœ‰ä¸€æ¬¡æ´»åŠ¨</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€æ¡SQLæŸ¥è¯¢å±•ç¤ºæ¯ä¸€ä½ç”¨æˆ· <strong>æœ€è¿‘ç¬¬äºŒæ¬¡</strong> çš„æ´»åŠ¨</p>
<p>å¦‚æœç”¨æˆ·ä»…æœ‰ä¸€æ¬¡æ´»åŠ¨ï¼Œè¿”å›è¯¥æ´»åŠ¨</p>
<p>ä¸€ä¸ªç”¨æˆ·ä¸èƒ½åŒæ—¶è¿›è¡Œè¶…è¿‡ä¸€é¡¹æ´»åŠ¨ï¼Œä»¥ <strong>ä»»æ„</strong> é¡ºåºè¿”å›ç»“æœ</p>
<p>ä¸‹é¢æ˜¯æŸ¥è¯¢ç»“æœæ ¼å¼çš„ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">UserActivity è¡¨:</span><br><span class="line">+------------+--------------+-------------+-------------+</span><br><span class="line">| username   | activity     | startDate   | endDate     |</span><br><span class="line">+------------+--------------+-------------+-------------+</span><br><span class="line">| Alice      | Travel       | 2020-02-12  | 2020-02-20  |</span><br><span class="line">| Alice      | Dancing      | 2020-02-21  | 2020-02-23  |</span><br><span class="line">| Alice      | Travel       | 2020-02-24  | 2020-02-28  |</span><br><span class="line">| Bob        | Travel       | 2020-02-11  | 2020-02-18  |</span><br><span class="line">+------------+--------------+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+------------+--------------+-------------+-------------+</span><br><span class="line">| username   | activity     | startDate   | endDate     |</span><br><span class="line">+------------+--------------+-------------+-------------+</span><br><span class="line">| Alice      | Dancing      | 2020-02-21  | 2020-02-23  |</span><br><span class="line">| Bob        | Travel       | 2020-02-11  | 2020-02-18  |</span><br><span class="line">+------------+--------------+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Alice æœ€è¿‘ç¬¬äºŒæ¬¡çš„æ´»åŠ¨æ˜¯ä» 2020-02-24 åˆ° 2020-02-28 çš„æ—…è¡Œ, åœ¨æ­¤ä¹‹å‰çš„ 2020-02-21 åˆ° 2020-02-23 å¥¹è¿›è¡Œäº†èˆè¹ˆ</span><br><span class="line">Bob åªæœ‰ä¸€æ¡è®°å½•ï¼Œæˆ‘ä»¬å°±å–è¿™æ¡è®°å½•</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> username, activity ,startDate,endDate </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> username, activity ,startDate,endDate ,</span><br><span class="line">    <span class="built_in">rank</span>()<span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> username <span class="keyword">order</span> <span class="keyword">by</span> startDate <span class="keyword">desc</span>) rk,</span><br><span class="line">    <span class="built_in">lag</span>( startDate ,<span class="number">1</span>,<span class="keyword">null</span>)<span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> username <span class="keyword">order</span> <span class="keyword">by</span> startDate ) lg</span><br><span class="line"><span class="keyword">from</span> UserActivity</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> rk<span class="operator">=</span><span class="number">2</span> <span class="keyword">or</span>  (rk <span class="operator">=</span> <span class="number">1</span> <span class="operator">&amp;&amp;</span>  lg <span class="keyword">is</span> <span class="keyword">null</span>)</span><br></pre></td></tr></table></figure>

<h4 id="1378-ä½¿ç”¨å”¯ä¸€æ ‡è¯†ç æ›¿æ¢å‘˜å·¥ID"><a href="#1378-ä½¿ç”¨å”¯ä¸€æ ‡è¯†ç æ›¿æ¢å‘˜å·¥ID" class="headerlink" title="1378. ä½¿ç”¨å”¯ä¸€æ ‡è¯†ç æ›¿æ¢å‘˜å·¥ID"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/replace-employee-id-with-the-unique-identifier/">1378. ä½¿ç”¨å”¯ä¸€æ ‡è¯†ç æ›¿æ¢å‘˜å·¥ID</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p><code>Employees</code> è¡¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¿™å¼ è¡¨çš„æ¯ä¸€è¡Œåˆ†åˆ«ä»£è¡¨äº†æŸå…¬å¸å…¶ä¸­ä¸€ä½å‘˜å·¥çš„åå­—å’Œ ID ã€‚</span><br></pre></td></tr></table></figure>

<p><code>EmployeeUNI</code> è¡¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| unique_id     | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(id, unique_id) æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¿™å¼ è¡¨çš„æ¯ä¸€è¡ŒåŒ…å«äº†è¯¥å…¬å¸æŸä½å‘˜å·¥çš„ ID å’Œä»–çš„å”¯ä¸€æ ‡è¯†ç ï¼ˆunique IDï¼‰ã€‚</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€æ®µSQLæŸ¥è¯¢æ¥å±•ç¤ºæ¯ä½ç”¨æˆ·çš„ <strong>å”¯ä¸€æ ‡è¯†ç ï¼ˆunique ID ï¼‰</strong>ï¼›å¦‚æœæŸä½å‘˜å·¥æ²¡æœ‰å”¯ä¸€æ ‡è¯†ç ï¼Œä½¿ç”¨ null å¡«å……å³å¯ã€‚</p>
<p>ä½ å¯ä»¥ä»¥ <strong>ä»»æ„</strong> é¡ºåºè¿”å›ç»“æœè¡¨ã€‚</p>
<p>æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Employees table:</span><br><span class="line">+----+----------+</span><br><span class="line">| id | name     |</span><br><span class="line">+----+----------+</span><br><span class="line">| 1  | Alice    |</span><br><span class="line">| 7  | Bob      |</span><br><span class="line">| 11 | Meir     |</span><br><span class="line">| 90 | Winston  |</span><br><span class="line">| 3  | Jonathan |</span><br><span class="line">+----+----------+</span><br><span class="line"></span><br><span class="line">EmployeeUNI table:</span><br><span class="line">+----+-----------+</span><br><span class="line">| id | unique_id |</span><br><span class="line">+----+-----------+</span><br><span class="line">| 3  | 1         |</span><br><span class="line">| 11 | 2         |</span><br><span class="line">| 90 | 3         |</span><br><span class="line">+----+-----------+</span><br><span class="line"></span><br><span class="line">EmployeeUNI table:</span><br><span class="line">+-----------+----------+</span><br><span class="line">| unique_id | name     |</span><br><span class="line">+-----------+----------+</span><br><span class="line">| null      | Alice    |</span><br><span class="line">| null      | Bob      |</span><br><span class="line">| 2         | Meir     |</span><br><span class="line">| 3         | Winston  |</span><br><span class="line">| 1         | Jonathan |</span><br><span class="line">+-----------+----------+</span><br><span class="line"></span><br><span class="line">Alice and Bob æ²¡æœ‰å”¯ä¸€æ ‡è¯†ç , å› æ­¤æˆ‘ä»¬ä½¿ç”¨ null æ›¿ä»£ã€‚</span><br><span class="line">Meir çš„å”¯ä¸€æ ‡è¯†ç æ˜¯ 2 ã€‚</span><br><span class="line">Winston çš„å”¯ä¸€æ ‡è¯†ç æ˜¯ 3 ã€‚</span><br><span class="line">Jonathan å”¯ä¸€æ ‡è¯†ç æ˜¯ 1 ã€‚</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> unique_id,e.name</span><br><span class="line"><span class="keyword">from</span> Employees  e <span class="keyword">left</span> <span class="keyword">join</span> EmployeeUNI u</span><br><span class="line"><span class="keyword">on</span> e.id <span class="operator">=</span> u.id</span><br></pre></td></tr></table></figure>

<h4 id="1384-æŒ‰å¹´åº¦åˆ—å‡ºé”€å”®æ€»é¢"><a href="#1384-æŒ‰å¹´åº¦åˆ—å‡ºé”€å”®æ€»é¢" class="headerlink" title="1384. æŒ‰å¹´åº¦åˆ—å‡ºé”€å”®æ€»é¢"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/total-sales-amount-by-year/">1384. æŒ‰å¹´åº¦åˆ—å‡ºé”€å”®æ€»é¢</a></h4><p>éš¾åº¦å›°éš¾</p>
<p>SQLæ¶æ„</p>
<p> <code>Product</code> è¡¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| product_name  | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">product_id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">product_name æ˜¯äº§å“çš„åç§°ã€‚</span><br></pre></td></tr></table></figure>

<p><code>Sales</code> è¡¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------------+---------+</span><br><span class="line">| Column Name         | Type    |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">| product_id          | int     |</span><br><span class="line">| period_start        | varchar |</span><br><span class="line">| period_end          | date    |</span><br><span class="line">| average_daily_sales | int     |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">product_id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">period_start å’Œ period_end æ˜¯è¯¥äº§å“é”€å”®æœŸçš„èµ·å§‹æ—¥æœŸå’Œç»“æŸæ—¥æœŸï¼Œä¸”è¿™ä¸¤ä¸ªæ—¥æœŸåŒ…å«åœ¨é”€å”®æœŸå†…ã€‚</span><br><span class="line">average_daily_sales åˆ—å­˜å‚¨é”€å”®æœŸå†…è¯¥äº§å“çš„æ—¥å¹³å‡é”€å”®é¢ã€‚</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ä¸€æ®µSQLæŸ¥è¯¢æ¯ä¸ªäº§å“æ¯å¹´çš„æ€»é”€å”®é¢ï¼Œå¹¶åŒ…å« product_id, product_name ä»¥åŠ report_year ç­‰ä¿¡æ¯ã€‚</p>
<p>é”€å”®å¹´ä»½çš„æ—¥æœŸä»‹äº 2018 å¹´åˆ° 2020 å¹´ä¹‹é—´ã€‚ä½ è¿”å›çš„ç»“æœéœ€è¦æŒ‰ product_id å’Œ report_year <strong>æ’åº</strong>ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Product table:</span><br><span class="line">+------------+--------------+</span><br><span class="line">| product_id | product_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| 1          | LC Phone     |</span><br><span class="line">| 2          | LC T-Shirt   |</span><br><span class="line">| 3          | LC Keychain  |</span><br><span class="line">+------------+--------------+</span><br><span class="line"></span><br><span class="line">Sales table:</span><br><span class="line">+------------+--------------+-------------+---------------------+</span><br><span class="line">| product_id | period_start | period_end  | average_daily_sales |</span><br><span class="line">+------------+--------------+-------------+---------------------+</span><br><span class="line">| 1          | 2019-01-25   | 2019-02-28  | 100                 |</span><br><span class="line">| 2          | 2018-12-01   | 2020-01-01  | 10                  |</span><br><span class="line">| 3          | 2019-12-01   | 2020-01-31  | 1                   |</span><br><span class="line">+------------+--------------+-------------+---------------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+--------------+-------------+--------------+</span><br><span class="line">| product_id | product_name | report_year | total_amount |</span><br><span class="line">+------------+--------------+-------------+--------------+</span><br><span class="line">| 1          | LC Phone     |    2019     | 3500         |</span><br><span class="line">| 2          | LC T-Shirt   |    2018     | 310          |</span><br><span class="line">| 2          | LC T-Shirt   |    2019     | 3650         |</span><br><span class="line">| 2          | LC T-Shirt   |    2020     | 10           |</span><br><span class="line">| 3          | LC Keychain  |    2019     | 31           |</span><br><span class="line">| 3          | LC Keychain  |    2020     | 31           |</span><br><span class="line">+------------+--------------+-------------+--------------+</span><br><span class="line">LC Phone åœ¨ 2019-01-25 è‡³ 2019-02-28 æœŸé—´é”€å”®ï¼Œè¯¥äº§å“é”€å”®æ—¶é—´æ€»è®¡35å¤©ã€‚é”€å”®æ€»é¢ 35*100 = 3500ã€‚</span><br><span class="line">LC T-shirt åœ¨ 2018-12-01 è‡³ 2020-01-01 æœŸé—´é”€å”®ï¼Œè¯¥äº§å“åœ¨2018å¹´ã€2019å¹´ã€2020å¹´çš„é”€å”®æ—¶é—´åˆ†åˆ«æ˜¯31å¤©ã€365å¤©ã€1å¤©ï¼Œ2018å¹´ã€2019å¹´ã€2020å¹´çš„é”€å”®æ€»é¢åˆ†åˆ«æ˜¯31*10=310ã€365*10=3650ã€1*10=10ã€‚</span><br><span class="line">LC Keychain åœ¨ 2019-12-01 è‡³ 2020-01-31 æœŸé—´é”€å”®ï¼Œè¯¥äº§å“åœ¨2019å¹´ã€2020å¹´çš„é”€å”®æ—¶é—´åˆ†åˆ«æ˜¯ï¼š31å¤©ã€31å¤©ï¼Œ2019å¹´ã€2020å¹´çš„é”€å”®æ€»é¢åˆ†åˆ«æ˜¯31*1=31ã€31*1=31ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(</span><br><span class="line"> <span class="keyword">select</span> Sales.product_id, product_name, <span class="string">&#x27;2018&#x27;</span> <span class="keyword">as</span> <span class="string">&#x27;report_year&#x27;</span>, if(period_start<span class="operator">&lt;</span><span class="string">&#x27;2019-01-01&#x27;</span>, (datediff(if(period_end<span class="operator">&lt;</span><span class="string">&#x27;2019-01-01&#x27;</span>, period_end, <span class="type">date</span>(<span class="string">&#x27;2018-12-31&#x27;</span>)), if(period_start<span class="operator">&gt;=</span><span class="string">&#x27;2018-01-01&#x27;</span>, period_start, <span class="type">date</span>(<span class="string">&#x27;2018-01-01&#x27;</span>)))<span class="operator">+</span><span class="number">1</span>)<span class="operator">*</span>average_daily_sales, <span class="number">0</span>) <span class="keyword">as</span> total_amount</span><br><span class="line"><span class="keyword">from</span> Sales  </span><br><span class="line"><span class="keyword">join</span> Product <span class="keyword">on</span> Sales.product_id <span class="operator">=</span> Product.product_id </span><br><span class="line"><span class="keyword">having</span>  total_amount<span class="operator">&gt;</span><span class="number">0</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">union</span>(</span><br><span class="line"><span class="keyword">select</span> Sales.product_id, product_name, <span class="string">&#x27;2019&#x27;</span> <span class="keyword">as</span> <span class="string">&#x27;report_year&#x27;</span>, if( period_start<span class="operator">&lt;</span><span class="string">&#x27;2020-01-01&#x27;</span>, (datediff(if(period_end<span class="operator">&lt;</span><span class="string">&#x27;2020-01-01&#x27;</span>, period_end, <span class="type">date</span>(<span class="string">&#x27;2019-12-31&#x27;</span>)), if(period_start<span class="operator">&gt;=</span><span class="string">&#x27;2019-01-01&#x27;</span>, period_start, <span class="type">date</span>(<span class="string">&#x27;2019-01-01&#x27;</span>)))<span class="operator">+</span><span class="number">1</span>)<span class="operator">*</span>average_daily_sales , <span class="number">0</span>) <span class="keyword">as</span> total_amount</span><br><span class="line"><span class="keyword">from</span> Sales  </span><br><span class="line"><span class="keyword">join</span> Product <span class="keyword">on</span> (Sales.product_id <span class="operator">=</span> Product.product_id )</span><br><span class="line"><span class="keyword">having</span>  total_amount<span class="operator">&gt;</span><span class="number">0</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">union</span>(</span><br><span class="line"><span class="keyword">select</span> Sales.product_id, product_name, <span class="string">&#x27;2020&#x27;</span> <span class="keyword">as</span> <span class="string">&#x27;report_year&#x27;</span>, (datediff(if(period_end<span class="operator">&lt;</span><span class="string">&#x27;2021-01-01&#x27;</span>, period_end, <span class="type">date</span>(<span class="string">&#x27;2020-12-31&#x27;</span>)), if(period_start<span class="operator">&gt;=</span><span class="string">&#x27;2020-01-01&#x27;</span>, period_start, <span class="type">date</span>(<span class="string">&#x27;2020-01-01&#x27;</span>)))<span class="operator">+</span><span class="number">1</span>)<span class="operator">*</span>average_daily_sales <span class="keyword">as</span> total_amount</span><br><span class="line"><span class="keyword">from</span> Sales  </span><br><span class="line"><span class="keyword">join</span> Product  <span class="keyword">on</span> (Sales.product_id <span class="operator">=</span> Product.product_id)</span><br><span class="line"><span class="keyword">having</span> total_amount<span class="operator">&gt;</span><span class="number">0</span></span><br><span class="line">) </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> product_id, report_year</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å„ä¸ªå¹´ä»½è¿›è¡Œunion,å°±æ˜¯å¹´ä»½åˆ¤æ–­çš„æ—¶å€™éº»çƒ¦äº›</p>
</blockquote>
<h4 id="1393-è‚¡ç¥¨çš„èµ„æœ¬æŸç›Š"><a href="#1393-è‚¡ç¥¨çš„èµ„æœ¬æŸç›Š" class="headerlink" title="1393. è‚¡ç¥¨çš„èµ„æœ¬æŸç›Š"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/capital-gainloss/">1393. è‚¡ç¥¨çš„èµ„æœ¬æŸç›Š</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p><code>Stocks</code> è¡¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| stock_name    | varchar |</span><br><span class="line">| operation     | enum    |</span><br><span class="line">| operation_day | int     |</span><br><span class="line">| price         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(stock_name, day) æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®</span><br><span class="line">operation åˆ—ä½¿ç”¨çš„æ˜¯ä¸€ç§æšä¸¾ç±»å‹ï¼ŒåŒ…æ‹¬ï¼š(&#x27;Sell&#x27;,&#x27;Buy&#x27;)</span><br><span class="line">æ­¤è¡¨çš„æ¯ä¸€è¡Œä»£è¡¨äº†åä¸º stock_name çš„æŸæ”¯è‚¡ç¥¨åœ¨ operation_day è¿™ä¸€å¤©çš„æ“ä½œä»·æ ¼ã€‚</span><br><span class="line">ä¿è¯è‚¡ç¥¨çš„æ¯æ¬¡&#x27;Sell&#x27;æ“ä½œå‰ï¼Œéƒ½æœ‰ç›¸åº”çš„&#x27;Buy&#x27;æ“ä½œã€‚</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ä¸€ä¸ªSQLæŸ¥è¯¢æ¥æŠ¥å‘Šæ¯æ”¯è‚¡ç¥¨çš„èµ„æœ¬æŸç›Šã€‚</p>
<p>è‚¡ç¥¨çš„èµ„æœ¬æŸç›Šæ˜¯ä¸€æ¬¡æˆ–å¤šæ¬¡ä¹°å–è‚¡ç¥¨åçš„å…¨éƒ¨æ”¶ç›Šæˆ–æŸå¤±ã€‚</p>
<p>ä»¥ä»»æ„é¡ºåºè¿”å›ç»“æœå³å¯ã€‚</p>
<p>SQLæŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Stocks è¡¨:</span><br><span class="line">+---------------+-----------+---------------+--------+</span><br><span class="line">| stock_name    | operation | operation_day | price  |</span><br><span class="line">+---------------+-----------+---------------+--------+</span><br><span class="line">| Leetcode      | Buy       | 1             | 1000   |</span><br><span class="line">| Corona Masks  | Buy       | 2             | 10     |</span><br><span class="line">| Leetcode      | Sell      | 5             | 9000   |</span><br><span class="line">| Handbags      | Buy       | 17            | 30000  |</span><br><span class="line">| Corona Masks  | Sell      | 3             | 1010   |</span><br><span class="line">| Corona Masks  | Buy       | 4             | 1000   |</span><br><span class="line">| Corona Masks  | Sell      | 5             | 500    |</span><br><span class="line">| Corona Masks  | Buy       | 6             | 1000   |</span><br><span class="line">| Handbags      | Sell      | 29            | 7000   |</span><br><span class="line">| Corona Masks  | Sell      | 10            | 10000  |</span><br><span class="line">+---------------+-----------+---------------+--------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+---------------+-------------------+</span><br><span class="line">| stock_name    | capital_gain_loss |</span><br><span class="line">+---------------+-------------------+</span><br><span class="line">| Corona Masks  | 9500              |</span><br><span class="line">| Leetcode      | 8000              |</span><br><span class="line">| Handbags      | -23000            |</span><br><span class="line">+---------------+-------------------+</span><br><span class="line">Leetcode è‚¡ç¥¨åœ¨ç¬¬ä¸€å¤©ä»¥1000ç¾å…ƒçš„ä»·æ ¼ä¹°å…¥ï¼Œåœ¨ç¬¬äº”å¤©ä»¥9000ç¾å…ƒçš„ä»·æ ¼å–å‡ºã€‚èµ„æœ¬æ”¶ç›Š=9000-1000=8000ç¾å…ƒã€‚</span><br><span class="line">Handbags è‚¡ç¥¨åœ¨ç¬¬17å¤©ä»¥30000ç¾å…ƒçš„ä»·æ ¼ä¹°å…¥ï¼Œåœ¨ç¬¬29å¤©ä»¥7000ç¾å…ƒçš„ä»·æ ¼å–å‡ºã€‚èµ„æœ¬æŸå¤±=7000-30000=-23000ç¾å…ƒã€‚</span><br><span class="line">Corona Masks è‚¡ç¥¨åœ¨ç¬¬1å¤©ä»¥10ç¾å…ƒçš„ä»·æ ¼ä¹°å…¥ï¼Œåœ¨ç¬¬3å¤©ä»¥1010ç¾å…ƒçš„ä»·æ ¼å–å‡ºã€‚åœ¨ç¬¬4å¤©ä»¥1000ç¾å…ƒçš„ä»·æ ¼å†æ¬¡è´­ä¹°ï¼Œåœ¨ç¬¬5å¤©ä»¥500ç¾å…ƒçš„ä»·æ ¼å‡ºå”®ã€‚æœ€åï¼Œå®ƒåœ¨ç¬¬6å¤©ä»¥1000ç¾å…ƒçš„ä»·æ ¼è¢«ä¹°èµ°ï¼Œåœ¨ç¬¬10å¤©ä»¥10000ç¾å…ƒçš„ä»·æ ¼è¢«å–æ‰ã€‚èµ„æœ¬æŸç›Šæ˜¯æ¯æ¬¡ï¼ˆâ€™Buy&#x27;-&gt;&#x27;Sell&#x27;ï¼‰æ“ä½œèµ„æœ¬æ”¶ç›Šæˆ–æŸå¤±çš„å’Œ=ï¼ˆ1010-10ï¼‰+ï¼ˆ500-1000ï¼‰+ï¼ˆ10000-1000ï¼‰=1000-500+9000=9500ç¾å…ƒã€‚</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> stock_name,sell<span class="operator">-</span>buy capital_gain_loss</span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line"><span class="keyword">select</span> stock_name ,</span><br><span class="line">       <span class="built_in">sum</span>(if(operation<span class="operator">=</span><span class="string">&#x27;Buy&#x27;</span>, price,<span class="number">0</span>))<span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> stock_name ) buy,</span><br><span class="line">       <span class="built_in">sum</span>(if(operation<span class="operator">=</span><span class="string">&#x27;Sell&#x27;</span>,price,<span class="number">0</span>))<span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> stock_name) sell</span><br><span class="line"><span class="keyword">from</span> Stocks s</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> stock_name,buy,sell</span><br></pre></td></tr></table></figure>



<h4 id="1398-è´­ä¹°äº†äº§å“Aå’Œäº§å“Bå´æ²¡æœ‰è´­ä¹°äº§å“Cçš„é¡¾å®¢"><a href="#1398-è´­ä¹°äº†äº§å“Aå’Œäº§å“Bå´æ²¡æœ‰è´­ä¹°äº§å“Cçš„é¡¾å®¢" class="headerlink" title="1398. è´­ä¹°äº†äº§å“Aå’Œäº§å“Bå´æ²¡æœ‰è´­ä¹°äº§å“Cçš„é¡¾å®¢"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/customers-who-bought-products-a-and-b-but-not-c/">1398. è´­ä¹°äº†äº§å“Aå’Œäº§å“Bå´æ²¡æœ‰è´­ä¹°äº§å“Cçš„é¡¾å®¢</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p> <code>Customers</code> è¡¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------------+---------+</span><br><span class="line">| Column Name         | Type    |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">| customer_id         | int     |</span><br><span class="line">| customer_name       | varchar |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">customer_id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">customer_name æ˜¯é¡¾å®¢çš„åç§°ã€‚</span><br></pre></td></tr></table></figure>

<p><code>Orders</code> è¡¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| order_id      | int     |</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| product_name  | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">order_id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">customer_id æ˜¯è´­ä¹°äº†åä¸º &quot;product_name&quot; äº§å“é¡¾å®¢çš„idã€‚</span><br></pre></td></tr></table></figure>

<p>è¯·ä½ è®¾è®¡ SQL æŸ¥è¯¢æ¥æŠ¥å‘Šè´­ä¹°äº†äº§å“ A å’Œäº§å“ B å´æ²¡æœ‰è´­ä¹°äº§å“ C çš„é¡¾å®¢çš„ ID å’Œå§“åï¼ˆ <code>customer_id</code> å’Œ <code>customer_name</code> ï¼‰ï¼Œæˆ‘ä»¬å°†åŸºäºæ­¤ç»“æœä¸ºä»–ä»¬æ¨èäº§å“ C ã€‚<br>æ‚¨è¿”å›çš„æŸ¥è¯¢ç»“æœéœ€è¦æŒ‰ç…§ <code>customer_id</code> <strong>æ’åº</strong>ã€‚</p>
<p>æŸ¥è¯¢ç»“æœå¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Customers table:</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| customer_id | customer_name |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 1           | Daniel        |</span><br><span class="line">| 2           | Diana         |</span><br><span class="line">| 3           | Elizabeth     |</span><br><span class="line">| 4           | Jhon          |</span><br><span class="line">+-------------+---------------+</span><br><span class="line"></span><br><span class="line">Orders table:</span><br><span class="line">+------------+--------------+---------------+</span><br><span class="line">| order_id   | customer_id  | product_name  |</span><br><span class="line">+------------+--------------+---------------+</span><br><span class="line">| 10         |     1        |     A         |</span><br><span class="line">| 20         |     1        |     B         |</span><br><span class="line">| 30         |     1        |     D         |</span><br><span class="line">| 40         |     1        |     C         |</span><br><span class="line">| 50         |     2        |     A         |</span><br><span class="line">| 60         |     3        |     A         |</span><br><span class="line">| 70         |     3        |     B         |</span><br><span class="line">| 80         |     3        |     D         |</span><br><span class="line">| 90         |     4        |     C         |</span><br><span class="line">+------------+--------------+---------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| customer_id | customer_name |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 3           | Elizabeth     |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">åªæœ‰ customer_id ä¸º 3 çš„é¡¾å®¢è´­ä¹°äº†äº§å“ A å’Œäº§å“ B ï¼Œå´æ²¡æœ‰è´­ä¹°äº§å“ C ã€‚</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  o.customer_id, customer_name </span><br><span class="line"><span class="keyword">from</span> Orders o <span class="keyword">left</span> <span class="keyword">join</span>  Customers c</span><br><span class="line"><span class="keyword">on</span> o.customer_id<span class="operator">=</span>c.customer_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> customer_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">sum</span>(product_name <span class="operator">=</span><span class="string">&#x27;A&#x27;</span>)<span class="operator">&gt;=</span><span class="number">1</span> <span class="keyword">and</span> <span class="built_in">sum</span>(product_name<span class="operator">=</span><span class="string">&#x27;B&#x27;</span>)<span class="operator">&gt;=</span><span class="number">1</span> <span class="keyword">and</span> <span class="built_in">sum</span>(product_name<span class="operator">=</span><span class="string">&#x27;C&#x27;</span>)<span class="operator">=</span><span class="number">0</span></span><br></pre></td></tr></table></figure>

<h4 id="1407-æ’åé å‰çš„æ—…è¡Œè€…"><a href="#1407-æ’åé å‰çš„æ—…è¡Œè€…" class="headerlink" title="1407. æ’åé å‰çš„æ—…è¡Œè€…"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/top-travellers/">1407. æ’åé å‰çš„æ—…è¡Œè€…</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>è¡¨å•: <code>Users</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id æ˜¯è¯¥è¡¨å•ä¸»é”®.</span><br><span class="line">name æ˜¯ç”¨æˆ·åå­—.</span><br></pre></td></tr></table></figure>

<p>è¡¨å•: <code>Rides</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| distance      | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id æ˜¯è¯¥è¡¨å•ä¸»é”®.</span><br><span class="line">user_id æ˜¯æœ¬æ¬¡è¡Œç¨‹çš„ç”¨æˆ·çš„ id, è€Œè¯¥ç”¨æˆ·æ­¤æ¬¡è¡Œç¨‹è·ç¦»ä¸º distance.</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€æ®µ SQL , æŠ¥å‘Šæ¯ä¸ªç”¨æˆ·çš„æ—…è¡Œè·ç¦».</p>
<p>è¿”å›çš„ç»“æœè¡¨å•, ä»¥ <code>travelled_distance</code> é™åºæ’åˆ—, å¦‚æœæœ‰ä¸¤ä¸ªæˆ–è€…æ›´å¤šçš„ç”¨æˆ·æ—…è¡Œäº†ç›¸åŒçš„è·ç¦», é‚£ä¹ˆå†ä»¥ <code>name</code> å‡åºæ’åˆ—.</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼, å¦‚ä¸‹ä¾‹æ‰€ç¤º.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Users è¡¨å•:</span><br><span class="line">+------+-----------+</span><br><span class="line">| id   | name      |</span><br><span class="line">+------+-----------+</span><br><span class="line">| 1    | Alice     |</span><br><span class="line">| 2    | Bob       |</span><br><span class="line">| 3    | Alex      |</span><br><span class="line">| 4    | Donald    |</span><br><span class="line">| 7    | Lee       |</span><br><span class="line">| 13   | Jonathan  |</span><br><span class="line">| 19   | Elvis     |</span><br><span class="line">+------+-----------+</span><br><span class="line"></span><br><span class="line">Rides è¡¨å•:</span><br><span class="line">+------+----------+----------+</span><br><span class="line">| id   | user_id  | distance |</span><br><span class="line">+------+----------+----------+</span><br><span class="line">| 1    | 1        | 120      |</span><br><span class="line">| 2    | 2        | 317      |</span><br><span class="line">| 3    | 3        | 222      |</span><br><span class="line">| 4    | 7        | 100      |</span><br><span class="line">| 5    | 13       | 312      |</span><br><span class="line">| 6    | 19       | 50       |</span><br><span class="line">| 7    | 7        | 120      |</span><br><span class="line">| 8    | 19       | 400      |</span><br><span class="line">| 9    | 7        | 230      |</span><br><span class="line">+------+----------+----------+</span><br><span class="line"></span><br><span class="line">Result è¡¨å•:</span><br><span class="line">+----------+--------------------+</span><br><span class="line">| name     | travelled_distance |</span><br><span class="line">+----------+--------------------+</span><br><span class="line">| Elvis    | 450                |</span><br><span class="line">| Lee      | 450                |</span><br><span class="line">| Bob      | 317                |</span><br><span class="line">| Jonathan | 312                |</span><br><span class="line">| Alex     | 222                |</span><br><span class="line">| Alice    | 120                |</span><br><span class="line">| Donald   | 0                  |</span><br><span class="line">+----------+--------------------+</span><br><span class="line">Elvis å’Œ Lee æ—…è¡Œäº† 450 è‹±é‡Œ, Elvis æ˜¯æ’åé å‰çš„æ—…è¡Œè€…, å› ä¸ºä»–çš„åå­—åœ¨å­—æ¯è¡¨ä¸Šçš„æ’åºæ¯” Lee æ›´å°.</span><br><span class="line">Bob, Jonathan, Alex å’Œ Alice åªæœ‰ä¸€æ¬¡è¡Œç¨‹, æˆ‘ä»¬åªæŒ‰æ­¤æ¬¡è¡Œç¨‹çš„å…¨éƒ¨è·ç¦»å¯¹ä»–ä»¬æ’åº.</span><br><span class="line">Donald æ²¡æœ‰ä»»ä½•è¡Œç¨‹, ä»–çš„æ—…è¡Œè·ç¦»ä¸º 0.</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name,<span class="built_in">sum</span>(ifnull(distance,<span class="number">0</span>)) travelled_distance </span><br><span class="line"><span class="keyword">from</span> Users u <span class="keyword">left</span> <span class="keyword">join</span> Rides r</span><br><span class="line"><span class="keyword">on</span> u.id <span class="operator">=</span> r.user_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> name</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> travelled_distance  <span class="keyword">desc</span>, name </span><br></pre></td></tr></table></figure>

<h4 id="1412-æŸ¥æ‰¾æˆç»©å¤„äºä¸­æ¸¸çš„å­¦ç”Ÿ"><a href="#1412-æŸ¥æ‰¾æˆç»©å¤„äºä¸­æ¸¸çš„å­¦ç”Ÿ" class="headerlink" title="1412. æŸ¥æ‰¾æˆç»©å¤„äºä¸­æ¸¸çš„å­¦ç”Ÿ"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/find-the-quiet-students-in-all-exams/">1412. æŸ¥æ‰¾æˆç»©å¤„äºä¸­æ¸¸çš„å­¦ç”Ÿ</a></h4><p>éš¾åº¦å›°éš¾</p>
<p>SQLæ¶æ„</p>
<p>è¡¨: <code>Student</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------------+---------+</span><br><span class="line">| Column Name         | Type    |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">| student_id          | int     |</span><br><span class="line">| student_name        | varchar |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">student_id æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">student_name å­¦ç”Ÿåå­—.</span><br></pre></td></tr></table></figure>

<p>è¡¨: <code>Exam</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| exam_id       | int     |</span><br><span class="line">| student_id    | int     |</span><br><span class="line">| score         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(exam_id, student_id) æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">å­¦ç”Ÿ student_id åœ¨æµ‹éªŒ exam_id ä¸­å¾—åˆ†ä¸º score.</span><br></pre></td></tr></table></figure>

<p>æˆç»©å¤„äºä¸­æ¸¸çš„å­¦ç”Ÿæ˜¯æŒ‡è‡³å°‘å‚åŠ äº†ä¸€æ¬¡æµ‹éªŒ, ä¸”å¾—åˆ†æ—¢ä¸æ˜¯æœ€é«˜åˆ†ä¹Ÿä¸æ˜¯æœ€ä½åˆ†çš„å­¦ç”Ÿã€‚</p>
<p>å†™ä¸€ä¸ª SQL è¯­å¥ï¼Œæ‰¾å‡ºåœ¨æ‰€æœ‰æµ‹éªŒä¸­éƒ½å¤„äºä¸­æ¸¸çš„å­¦ç”Ÿ <code>(student_id, student_name)</code>ã€‚</p>
<p>ä¸è¦è¿”å›ä»æ¥æ²¡æœ‰å‚åŠ è¿‡æµ‹éªŒçš„å­¦ç”Ÿã€‚è¿”å›ç»“æœè¡¨æŒ‰ç…§ <code>student_id</code> æ’åºã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">Student è¡¨ï¼š</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| student_id  | student_name  |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 1           | Daniel        |</span><br><span class="line">| 2           | Jade          |</span><br><span class="line">| 3           | Stella        |</span><br><span class="line">| 4           | Jonathan      |</span><br><span class="line">| 5           | Will          |</span><br><span class="line">+-------------+---------------+</span><br><span class="line"></span><br><span class="line">Exam è¡¨ï¼š</span><br><span class="line">+------------+--------------+-----------+</span><br><span class="line">| exam_id    | student_id   | score     |</span><br><span class="line">+------------+--------------+-----------+</span><br><span class="line">| 10         |     1        |    70     |</span><br><span class="line">| 10         |     2        |    80     |</span><br><span class="line">| 10         |     3        |    90     |</span><br><span class="line">| 20         |     1        |    80     |</span><br><span class="line">| 30         |     1        |    70     |</span><br><span class="line">| 30         |     3        |    80     |</span><br><span class="line">| 30         |     4        |    90     |</span><br><span class="line">| 40         |     1        |    60     |</span><br><span class="line">| 40         |     2        |    70     |</span><br><span class="line">| 40         |     4        |    80     |</span><br><span class="line">+------------+--------------+-----------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| student_id  | student_name  |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 2           | Jade          |</span><br><span class="line">+-------------+---------------+</span><br><span class="line"></span><br><span class="line">å¯¹äºæµ‹éªŒ 1: å­¦ç”Ÿ 1 å’Œ 3 åˆ†åˆ«è·å¾—äº†æœ€ä½åˆ†å’Œæœ€é«˜åˆ†ã€‚</span><br><span class="line">å¯¹äºæµ‹éªŒ 2: å­¦ç”Ÿ 1 æ—¢è·å¾—äº†æœ€é«˜åˆ†, ä¹Ÿè·å¾—äº†æœ€ä½åˆ†ã€‚</span><br><span class="line">å¯¹äºæµ‹éªŒ 3 å’Œ 4: å­¦ç”Ÿ 1 å’Œ 4 åˆ†åˆ«è·å¾—äº†æœ€ä½åˆ†å’Œæœ€é«˜åˆ†ã€‚</span><br><span class="line">å­¦ç”Ÿ 2 å’Œ 5 æ²¡æœ‰åœ¨ä»»ä¸€åœºæµ‹éªŒä¸­è·å¾—äº†æœ€é«˜åˆ†æˆ–è€…æœ€ä½åˆ†ã€‚</span><br><span class="line">å› ä¸ºå­¦ç”Ÿ 5 ä»æ¥æ²¡æœ‰å‚åŠ è¿‡ä»»ä½•æµ‹éªŒ, æ‰€ä»¥ä»–è¢«æ’é™¤äºç»“æœè¡¨ã€‚</span><br><span class="line">ç”±æ­¤, æˆ‘ä»¬ä»…ä»…è¿”å›å­¦ç”Ÿ 2 çš„ä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.student_id,student_name</span><br><span class="line"><span class="keyword">from</span> Exam e <span class="keyword">left</span> <span class="keyword">join</span> Student s</span><br><span class="line"><span class="keyword">on</span> e.student_id<span class="operator">=</span>s.student_id</span><br><span class="line"><span class="keyword">where</span> e.student_id <span class="keyword">not</span> <span class="keyword">in</span>(</span><br><span class="line">    <span class="keyword">select</span> student_id</span><br><span class="line">    <span class="keyword">from</span>(</span><br><span class="line">        <span class="keyword">select</span> student_id,<span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> exam_id <span class="keyword">order</span> <span class="keyword">by</span> score <span class="keyword">desc</span>) rkmax, <span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> exam_id <span class="keyword">order</span> <span class="keyword">by</span> score ) rkmin</span><br><span class="line">        <span class="keyword">from</span> Exam </span><br><span class="line">    )t1</span><br><span class="line">    <span class="keyword">where</span> rkmax <span class="operator">=</span> <span class="number">1</span> <span class="keyword">or</span> rkmin <span class="operator">=</span><span class="number">1</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> e.student_id,student_name</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> e.student_id </span><br></pre></td></tr></table></figure>



<h4 id="1421-å‡€ç°å€¼æŸ¥è¯¢"><a href="#1421-å‡€ç°å€¼æŸ¥è¯¢" class="headerlink" title="1421. å‡€ç°å€¼æŸ¥è¯¢"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/npv-queries/">1421. å‡€ç°å€¼æŸ¥è¯¢</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>è¡¨: <code>NPV</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| year          | int     |</span><br><span class="line">| npv           | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(id, year) æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">è¯¥è¡¨æœ‰æ¯ä¸€ç¬”å­˜è´§çš„å¹´ä»½, id å’Œå¯¹åº”å‡€ç°å€¼çš„ä¿¡æ¯.</span><br></pre></td></tr></table></figure>

<p>è¡¨: <code>Queries</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| year          | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(id, year) æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">è¯¥è¡¨æœ‰æ¯ä¸€æ¬¡æŸ¥è¯¢æ‰€å¯¹åº”å­˜è´§çš„ id å’Œå¹´ä»½çš„ä¿¡æ¯.</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€ä¸ª SQL, æ‰¾åˆ° Queries è¡¨ä¸­æ¯ä¸€æ¬¡æŸ¥è¯¢çš„å‡€ç°å€¼.</p>
<p>ç»“æœè¡¨æ²¡æœ‰é¡ºåºè¦æ±‚.</p>
<p>æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">NPV è¡¨:</span><br><span class="line">+------+--------+--------+</span><br><span class="line">| id   | year   | npv    |</span><br><span class="line">+------+--------+--------+</span><br><span class="line">| 1    | 2018   | 100    |</span><br><span class="line">| 7    | 2020   | 30     |</span><br><span class="line">| 13   | 2019   | 40     |</span><br><span class="line">| 1    | 2019   | 113    |</span><br><span class="line">| 2    | 2008   | 121    |</span><br><span class="line">| 3    | 2009   | 12     |</span><br><span class="line">| 11   | 2020   | 99     |</span><br><span class="line">| 7    | 2019   | 0      |</span><br><span class="line">+------+--------+--------+</span><br><span class="line"></span><br><span class="line">Queries è¡¨:</span><br><span class="line">+------+--------+</span><br><span class="line">| id   | year   |</span><br><span class="line">+------+--------+</span><br><span class="line">| 1    | 2019   |</span><br><span class="line">| 2    | 2008   |</span><br><span class="line">| 3    | 2009   |</span><br><span class="line">| 7    | 2018   |</span><br><span class="line">| 7    | 2019   |</span><br><span class="line">| 7    | 2020   |</span><br><span class="line">| 13   | 2019   |</span><br><span class="line">+------+--------+</span><br><span class="line"></span><br><span class="line">ç»“æœè¡¨:</span><br><span class="line">+------+--------+--------+</span><br><span class="line">| id   | year   | npv    |</span><br><span class="line">+------+--------+--------+</span><br><span class="line">| 1    | 2019   | 113    |</span><br><span class="line">| 2    | 2008   | 121    |</span><br><span class="line">| 3    | 2009   | 12     |</span><br><span class="line">| 7    | 2018   | 0      |</span><br><span class="line">| 7    | 2019   | 0      |</span><br><span class="line">| 7    | 2020   | 30     |</span><br><span class="line">| 13   | 2019   | 40     |</span><br><span class="line">+------+--------+--------+</span><br><span class="line"></span><br><span class="line">(7, 2018)çš„å‡€ç°å€¼ä¸åœ¨ NPV è¡¨ä¸­, æˆ‘ä»¬æŠŠå®ƒçœ‹ä½œæ˜¯ 0.</span><br><span class="line">æ‰€æœ‰å…¶å®ƒæŸ¥è¯¢çš„å‡€ç°å€¼éƒ½èƒ½åœ¨ NPV è¡¨ä¸­æ‰¾åˆ°.</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> q.id,q.year,ifnull(npv,<span class="number">0</span>) npv</span><br><span class="line"><span class="keyword">from</span> Queries q <span class="keyword">left</span> <span class="keyword">join</span> NPV n</span><br><span class="line"><span class="keyword">on</span> q.id <span class="operator">=</span> n.id <span class="keyword">and</span> q.year <span class="operator">=</span> n.year</span><br></pre></td></tr></table></figure>

<blockquote>
<p>npv å‡€ç°å€¼æ¦‚å¿µ äº†è§£ä¸‹</p>
</blockquote>
<h4 id="1435-åˆ¶ä½œä¼šè¯æŸ±çŠ¶å›¾"><a href="#1435-åˆ¶ä½œä¼šè¯æŸ±çŠ¶å›¾" class="headerlink" title="1435. åˆ¶ä½œä¼šè¯æŸ±çŠ¶å›¾"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/create-a-session-bar-chart/">1435. åˆ¶ä½œä¼šè¯æŸ±çŠ¶å›¾</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>è¡¨ï¼š<code>Sessions</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------------+---------+</span><br><span class="line">| Column Name         | Type    |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">| session_id          | int     |</span><br><span class="line">| duration            | int     |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">session_id æ˜¯è¯¥è¡¨ä¸»é”®</span><br><span class="line">duration æ˜¯ç”¨æˆ·è®¿é—®åº”ç”¨çš„æ—¶é—´, ä»¥ç§’ä¸ºå•ä½</span><br></pre></td></tr></table></figure>

<p>ä½ æƒ³çŸ¥é“ç”¨æˆ·åœ¨ä½ çš„ app ä¸Šçš„è®¿é—®æ—¶é•¿æƒ…å†µã€‚å› æ­¤å†³å®šç»Ÿè®¡è®¿é—®æ—¶é•¿åŒºé—´åˆ†åˆ«ä¸º â€œ[0-5&gt;â€, â€œ[5-10&gt;â€, â€œ[10-15&gt;â€ å’Œ â€œ15 or moreâ€ ï¼ˆå•ä½ï¼šåˆ†é’Ÿï¼‰çš„ä¼šè¯æ•°é‡ï¼Œå¹¶ä»¥æ­¤ç»˜åˆ¶æŸ±çŠ¶å›¾ã€‚</p>
<p>å†™ä¸€ä¸ªSQLæŸ¥è¯¢æ¥æŠ¥å‘Šï¼ˆè®¿é—®æ—¶é•¿åŒºé—´ï¼Œä¼šè¯æ€»æ•°ï¼‰ã€‚ç»“æœå¯ç”¨ä»»ä½•é¡ºåºå‘ˆç°ã€‚</p>
<p><strong>ä¸‹æ–¹ä¸ºæŸ¥è¯¢çš„è¾“å‡ºæ ¼å¼ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Sessions è¡¨ï¼š</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| session_id  | duration      |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 1           | 30            |</span><br><span class="line">| 2           | 199           |</span><br><span class="line">| 3           | 299           |</span><br><span class="line">| 4           | 580           |</span><br><span class="line">| 5           | 1000          |</span><br><span class="line">+-------------+---------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+--------------+--------------+</span><br><span class="line">| bin          | total        |</span><br><span class="line">+--------------+--------------+</span><br><span class="line">| [0-5&gt;        | 3            |</span><br><span class="line">| [5-10&gt;       | 1            |</span><br><span class="line">| [10-15&gt;      | 0            |</span><br><span class="line">| 15 or more   | 1            |</span><br><span class="line">+--------------+--------------+</span><br><span class="line"></span><br><span class="line">å¯¹äº session_id 1ï¼Œ2 å’Œ 3 ï¼Œå®ƒä»¬çš„è®¿é—®æ—¶é—´å¤§äºç­‰äº 0 åˆ†é’Ÿä¸”å°äº 5 åˆ†é’Ÿã€‚</span><br><span class="line">å¯¹äº session_id 4ï¼Œå®ƒçš„è®¿é—®æ—¶é—´å¤§äºç­‰äº 5 åˆ†é’Ÿä¸”å°äº 10 åˆ†é’Ÿã€‚</span><br><span class="line">æ²¡æœ‰ä¼šè¯çš„è®¿é—®æ—¶é—´å¤§äºç­‰äº 10 åˆ†é’Ÿä¸”å°äº 15 åˆ†é’Ÿã€‚</span><br><span class="line">å¯¹äº session_id 5, å®ƒçš„è®¿é—®æ—¶é—´å¤§äºç­‰äº 15 åˆ†é’Ÿã€‚</span><br></pre></td></tr></table></figure>

<p>Union</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;[0-5&gt;&#x27;</span> <span class="keyword">as</span> bin, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> total <span class="keyword">from</span> Sessions <span class="keyword">where</span> duration<span class="operator">/</span><span class="number">60</span><span class="operator">&gt;=</span><span class="number">0</span> <span class="keyword">and</span> duration<span class="operator">/</span><span class="number">60</span><span class="operator">&lt;</span><span class="number">5</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;[5-10&gt;&#x27;</span> <span class="keyword">as</span> bin, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> total <span class="keyword">from</span> Sessions <span class="keyword">where</span> duration<span class="operator">/</span><span class="number">60</span><span class="operator">&gt;=</span><span class="number">5</span> <span class="keyword">and</span> duration<span class="operator">/</span><span class="number">60</span><span class="operator">&lt;</span><span class="number">10</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;[10-15&gt;&#x27;</span> <span class="keyword">as</span> bin, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> total <span class="keyword">from</span> Sessions <span class="keyword">where</span> duration<span class="operator">/</span><span class="number">60</span><span class="operator">&gt;=</span><span class="number">10</span> <span class="keyword">and</span> duration<span class="operator">/</span><span class="number">60</span><span class="operator">&lt;</span><span class="number">15</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;15 or more&#x27;</span><span class="keyword">as</span> bin, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> total <span class="keyword">from</span> Sessions <span class="keyword">where</span> duration<span class="operator">/</span><span class="number">60</span><span class="operator">&gt;=</span><span class="number">15</span></span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰å¾ˆå¤šå…¶ä»–è§£æ³•</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.bin, <span class="built_in">count</span>(b.bin) <span class="keyword">as</span> total</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> <span class="string">&#x27;[0-5&gt;&#x27;</span> <span class="keyword">as</span> bin <span class="keyword">union</span> <span class="keyword">select</span> <span class="string">&#x27;[5-10&gt;&#x27;</span> <span class="keyword">as</span> bin <span class="keyword">union</span> <span class="keyword">select</span> <span class="string">&#x27;[10-15&gt;&#x27;</span> <span class="keyword">as</span> bin <span class="keyword">union</span> <span class="keyword">select</span> <span class="string">&#x27;15 or more&#x27;</span> <span class="keyword">as</span> bin </span><br><span class="line">)a</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">case</span></span><br><span class="line">        <span class="keyword">when</span> duration <span class="operator">&lt;</span> <span class="number">300</span> <span class="keyword">then</span> <span class="string">&#x27;[0-5&gt;&#x27;</span></span><br><span class="line">        <span class="keyword">when</span> duration <span class="operator">&gt;=</span> <span class="number">300</span> <span class="keyword">and</span> duration <span class="operator">&lt;</span> <span class="number">600</span> <span class="keyword">then</span> <span class="string">&#x27;[5-10&gt;&#x27;</span></span><br><span class="line">        <span class="keyword">when</span> duration <span class="operator">&gt;=</span> <span class="number">600</span> <span class="keyword">and</span> duration <span class="operator">&lt;</span> <span class="number">900</span> <span class="keyword">then</span> <span class="string">&#x27;[10-15&gt;&#x27;</span></span><br><span class="line">        <span class="keyword">else</span> <span class="string">&#x27;15 or more&#x27;</span></span><br><span class="line">        <span class="keyword">end</span> bin</span><br><span class="line">    <span class="keyword">from</span> Sessions </span><br><span class="line">)b</span><br><span class="line"><span class="keyword">on</span> a.bin <span class="operator">=</span> b.bin</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> a.bin</span><br></pre></td></tr></table></figure>



<h4 id="1440-è®¡ç®—å¸ƒå°”è¡¨è¾¾å¼çš„å€¼"><a href="#1440-è®¡ç®—å¸ƒå°”è¡¨è¾¾å¼çš„å€¼" class="headerlink" title="1440. è®¡ç®—å¸ƒå°”è¡¨è¾¾å¼çš„å€¼"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/evaluate-boolean-expression/">1440. è®¡ç®—å¸ƒå°”è¡¨è¾¾å¼çš„å€¼</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>è¡¨ <code>Variables</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| name          | varchar |</span><br><span class="line">| value         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">name æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">è¯¥è¡¨åŒ…å«äº†å­˜å‚¨çš„å˜é‡åŠå…¶å¯¹åº”çš„å€¼.</span><br></pre></td></tr></table></figure>

<p>è¡¨ <code>Expressions</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| left_operand  | varchar |</span><br><span class="line">| operator      | enum    |</span><br><span class="line">| right_operand | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(left_operand, operator, right_operand) æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">è¯¥è¡¨åŒ…å«äº†éœ€è¦è®¡ç®—çš„å¸ƒå°”è¡¨è¾¾å¼.</span><br><span class="line">operator æ˜¯æšä¸¾ç±»å‹, å–å€¼äº(&#x27;&lt;&#x27;, &#x27;&gt;&#x27;, &#x27;=&#x27;)</span><br><span class="line">left_operand å’Œ right_operand çš„å€¼ä¿è¯å­˜åœ¨äº Variables è¡¨å•ä¸­.</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€ä¸ª SQL æŸ¥è¯¢, ä»¥è®¡ç®—è¡¨ <code>Expressions</code> ä¸­çš„å¸ƒå°”è¡¨è¾¾å¼.</p>
<p>è¿”å›çš„ç»“æœè¡¨æ²¡æœ‰é¡ºåºè¦æ±‚.</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤º.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Variables è¡¨:</span><br><span class="line">+------+-------+</span><br><span class="line">| name | value |</span><br><span class="line">+------+-------+</span><br><span class="line">| x    | 66    |</span><br><span class="line">| y    | 77    |</span><br><span class="line">+------+-------+</span><br><span class="line"></span><br><span class="line">Expressions è¡¨:</span><br><span class="line">+--------------+----------+---------------+</span><br><span class="line">| left_operand | operator | right_operand |</span><br><span class="line">+--------------+----------+---------------+</span><br><span class="line">| x            | &gt;        | y             |</span><br><span class="line">| x            | &lt;        | y             |</span><br><span class="line">| x            | =        | y             |</span><br><span class="line">| y            | &gt;        | x             |</span><br><span class="line">| y            | &lt;        | x             |</span><br><span class="line">| x            | =        | x             |</span><br><span class="line">+--------------+----------+---------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+--------------+----------+---------------+-------+</span><br><span class="line">| left_operand | operator | right_operand | value |</span><br><span class="line">+--------------+----------+---------------+-------+</span><br><span class="line">| x            | &gt;        | y             | false |</span><br><span class="line">| x            | &lt;        | y             | true  |</span><br><span class="line">| x            | =        | y             | false |</span><br><span class="line">| y            | &gt;        | x             | true  |</span><br><span class="line">| y            | &lt;        | x             | false |</span><br><span class="line">| x            | =        | x             | true  |</span><br><span class="line">+--------------+----------+---------------+-------+</span><br><span class="line">å¦‚ä¸Šæ‰€ç¤º, ä½ éœ€è¦é€šè¿‡ä½¿ç”¨ Variables è¡¨æ¥æ‰¾åˆ° Expressions è¡¨ä¸­çš„æ¯ä¸€ä¸ªå¸ƒå°”è¡¨è¾¾å¼çš„å€¼.</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.left_operand,e.operator,e.right_operand,</span><br><span class="line"><span class="keyword">case</span> e.operator</span><br><span class="line">    <span class="keyword">when</span> <span class="string">&#x27;&gt;&#x27;</span> <span class="keyword">then</span> if(v1.value<span class="operator">&gt;</span>v2.value,<span class="string">&#x27;true&#x27;</span>,<span class="string">&#x27;false&#x27;</span>)</span><br><span class="line">    <span class="keyword">when</span> <span class="string">&#x27;&lt;&#x27;</span> <span class="keyword">then</span> if(v1.value<span class="operator">&lt;</span>v2.value,<span class="string">&#x27;true&#x27;</span>,<span class="string">&#x27;false&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>  if(v1.value<span class="operator">=</span>v2.value,<span class="string">&#x27;true&#x27;</span>,<span class="string">&#x27;false&#x27;</span>)</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">value</span></span><br><span class="line"><span class="keyword">from</span> Expressions e</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Variables v1 <span class="keyword">on</span> v1.name <span class="operator">=</span> e.left_operand </span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Variables v2 <span class="keyword">on</span> v2.name <span class="operator">=</span> e.right_operand</span><br></pre></td></tr></table></figure>



<h4 id="1445-è‹¹æœå’Œæ¡”å­"><a href="#1445-è‹¹æœå’Œæ¡”å­" class="headerlink" title="1445. è‹¹æœå’Œæ¡”å­"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/apples-oranges/">1445. è‹¹æœå’Œæ¡”å­</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>è¡¨: <code>Sales</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| sale_date     | date    |</span><br><span class="line">| fruit         | enum    | </span><br><span class="line">| sold_num      | int     | </span><br><span class="line">+---------------+---------+</span><br><span class="line">(sale_date,fruit) æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">è¯¥è¡¨åŒ…å«äº†æ¯ä¸€å¤©ä¸­&quot;è‹¹æœ&quot; å’Œ &quot;æ¡”å­&quot;çš„é”€å”®æƒ…å†µ.</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€ä¸ª SQL æŸ¥è¯¢, æŠ¥å‘Šæ¯ä¸€å¤© <strong>è‹¹æœ</strong> å’Œ <strong>æ¡”å­</strong> é”€å”®çš„æ•°ç›®çš„å·®å¼‚.</p>
<p>è¿”å›çš„ç»“æœè¡¨, æŒ‰ç…§æ ¼å¼ä¸º (â€˜YYYY-MM-DDâ€™) çš„ <code>sale_date</code> æ’åº.</p>
<p>æŸ¥è¯¢ç»“æœè¡¨å¦‚ä¸‹ä¾‹æ‰€ç¤º:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Sales è¡¨:</span><br><span class="line">+------------+------------+-------------+</span><br><span class="line">| sale_date  | fruit      | sold_num    |</span><br><span class="line">+------------+------------+-------------+</span><br><span class="line">| 2020-05-01 | apples     | 10          |</span><br><span class="line">| 2020-05-01 | oranges    | 8           |</span><br><span class="line">| 2020-05-02 | apples     | 15          |</span><br><span class="line">| 2020-05-02 | oranges    | 15          |</span><br><span class="line">| 2020-05-03 | apples     | 20          |</span><br><span class="line">| 2020-05-03 | oranges    | 0           |</span><br><span class="line">| 2020-05-04 | apples     | 15          |</span><br><span class="line">| 2020-05-04 | oranges    | 16          |</span><br><span class="line">+------------+------------+-------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+------------+--------------+</span><br><span class="line">| sale_date  | diff         |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| 2020-05-01 | 2            |</span><br><span class="line">| 2020-05-02 | 0            |</span><br><span class="line">| 2020-05-03 | 20           |</span><br><span class="line">| 2020-05-04 | -1           |</span><br><span class="line">+------------+--------------+</span><br><span class="line"></span><br><span class="line">åœ¨ 2020-05-01, å–äº† 10 ä¸ªè‹¹æœ å’Œ 8 ä¸ªæ¡”å­ (å·®å¼‚ä¸º 10 - 8 = 2).</span><br><span class="line">åœ¨ 2020-05-02, å–äº† 15 ä¸ªè‹¹æœ å’Œ 15 ä¸ªæ¡”å­ (å·®å¼‚ä¸º 15 - 15 = 0).</span><br><span class="line">åœ¨ 2020-05-03, å–äº† 20 ä¸ªè‹¹æœ å’Œ 0 ä¸ªæ¡”å­ (å·®å¼‚ä¸º 20 - 0 = 20).</span><br><span class="line">åœ¨ 2020-05-04, å–äº† 15 ä¸ªè‹¹æœ å’Œ 16 ä¸ªæ¡”å­ (å·®å¼‚ä¸º 15 - 16 = -1).</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  sale_date,sold_num<span class="operator">-</span>ld diff</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> sale_date,sold_num , fruit ,<span class="built_in">lead</span>(sold_num ,<span class="number">1</span>,<span class="keyword">null</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span>  sale_date ) ld</span><br><span class="line"><span class="keyword">from</span> Sales</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> fruit<span class="operator">=</span><span class="string">&#x27;apples&#x27;</span></span><br></pre></td></tr></table></figure>



<h4 id="1454-æ´»è·ƒç”¨æˆ·"><a href="#1454-æ´»è·ƒç”¨æˆ·" class="headerlink" title="1454.  æ´»è·ƒç”¨æˆ·"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/active-users/">1454.  æ´»è·ƒç”¨æˆ·</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>è¡¨ <code>Accounts</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">è¯¥è¡¨åŒ…å«è´¦æˆ· id å’Œè´¦æˆ·çš„ç”¨æˆ·å.</span><br></pre></td></tr></table></figure>

<p>è¡¨ <code>Logins</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| login_date    | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">è¯¥è¡¨æ— ä¸»é”®, å¯èƒ½åŒ…å«é‡å¤é¡¹.</span><br><span class="line">è¯¥è¡¨åŒ…å«ç™»å½•ç”¨æˆ·çš„è´¦æˆ· id å’Œç™»å½•æ—¥æœŸ. ç”¨æˆ·ä¹Ÿè®¸ä¸€å¤©å†…ç™»å½•å¤šæ¬¡.</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€ä¸ª SQL æŸ¥è¯¢, æ‰¾åˆ°æ´»è·ƒç”¨æˆ·çš„ id å’Œ name.</p>
<p>æ´»è·ƒç”¨æˆ·æ˜¯æŒ‡é‚£äº›è‡³å°‘è¿ç»­ 5 å¤©ç™»å½•è´¦æˆ·çš„ç”¨æˆ·.</p>
<p>è¿”å›çš„ç»“æœè¡¨æŒ‰ç…§ id æ’åº.</p>
<p>ç»“æœè¡¨æ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤º:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Accounts è¡¨:</span><br><span class="line">+----+----------+</span><br><span class="line">| id | name     |</span><br><span class="line">+----+----------+</span><br><span class="line">| 1  | Winston  |</span><br><span class="line">| 7  | Jonathan |</span><br><span class="line">+----+----------+</span><br><span class="line"></span><br><span class="line">Logins è¡¨:</span><br><span class="line">+----+------------+</span><br><span class="line">| id | login_date |</span><br><span class="line">+----+------------+</span><br><span class="line">| 7  | 2020-05-30 |</span><br><span class="line">| 1  | 2020-05-30 |</span><br><span class="line">| 7  | 2020-05-31 |</span><br><span class="line">| 7  | 2020-06-01 |</span><br><span class="line">| 7  | 2020-06-02 |</span><br><span class="line">| 7  | 2020-06-02 |</span><br><span class="line">| 7  | 2020-06-03 |</span><br><span class="line">| 1  | 2020-06-07 |</span><br><span class="line">| 7  | 2020-06-10 |</span><br><span class="line">+----+------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+----+----------+</span><br><span class="line">| id | name     |</span><br><span class="line">+----+----------+</span><br><span class="line">| 7  | Jonathan |</span><br><span class="line">+----+----------+</span><br><span class="line">id = 1 çš„ç”¨æˆ· Winston ä»…ä»…åœ¨ä¸åŒçš„ 2 å¤©å†…ç™»å½•äº† 2 æ¬¡, æ‰€ä»¥, Winston ä¸æ˜¯æ´»è·ƒç”¨æˆ·.</span><br><span class="line">id = 7 çš„ç”¨æˆ· Jonathon åœ¨ä¸åŒçš„ 6 å¤©å†…ç™»å½•äº† 7 æ¬¡, , 6 å¤©ä¸­æœ‰ 5 å¤©æ˜¯è¿ç»­çš„, æ‰€ä»¥, Jonathan æ˜¯æ´»è·ƒç”¨æˆ·.</span><br></pre></td></tr></table></figure>

<p><strong>åç»­é—®é¢˜:</strong><br>å¦‚æœæ´»è·ƒç”¨æˆ·æ˜¯é‚£äº›è‡³å°‘è¿ç»­ <code>n</code> å¤©ç™»å½•è´¦æˆ·çš„ç”¨æˆ·, ä½ èƒ½å¦å†™å‡ºé€šç”¨çš„è§£å†³æ–¹æ¡ˆ?</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> t3.id,name</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">distinct</span> id</span><br><span class="line">    <span class="keyword">from</span> </span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> id,login_date,<span class="built_in">lead</span>(login_date,<span class="number">4</span>,<span class="keyword">null</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> id <span class="keyword">order</span> <span class="keyword">by</span> login_date) ld</span><br><span class="line">        <span class="keyword">from</span> </span><br><span class="line">        (</span><br><span class="line">            <span class="keyword">select</span> id,login_date </span><br><span class="line">            <span class="keyword">from</span> Logins</span><br><span class="line">            <span class="keyword">group</span> <span class="keyword">by</span> id,login_date</span><br><span class="line">        )t1</span><br><span class="line">    )t2</span><br><span class="line">    <span class="keyword">where</span> datediff(ld,login_date)<span class="operator">=</span><span class="number">4</span></span><br><span class="line">)t3</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Accounts a</span><br><span class="line"><span class="keyword">on</span> t3.id <span class="operator">=</span> a.id</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„ç”¨æˆ·å½“å¤©é‡å¤ç™»å…¥</p>
</blockquote>
<h4 id="1459-çŸ©å½¢é¢ç§¯"><a href="#1459-çŸ©å½¢é¢ç§¯" class="headerlink" title="1459. çŸ©å½¢é¢ç§¯"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/rectangles-area/">1459. çŸ©å½¢é¢ç§¯</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>è¡¨: <code>Points</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| x_value       | int     |</span><br><span class="line">| y_value       | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">æ¯ä¸ªç‚¹éƒ½è¡¨ç¤ºä¸ºäºŒç»´ç©ºé—´ (x_value, y_value).</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€ä¸ª SQL è¯­å¥, æŠ¥å‘Šç”±è¡¨ä¸­ä»»æ„ä¸¤ç‚¹å¯ä»¥å½¢æˆçš„æ‰€æœ‰å¯èƒ½çš„çŸ©å½¢. </p>
<p>ç»“æœè¡¨ä¸­çš„æ¯ä¸€è¡ŒåŒ…å«ä¸‰åˆ— (p1, p2, area) å¦‚ä¸‹:</p>
<ul>
<li><strong>p1</strong> å’Œ <strong>p2</strong> æ˜¯çŸ©å½¢ä¸¤ä¸ªå¯¹è§’çš„ id ä¸” p1 &lt; p2.</li>
<li>çŸ©å½¢çš„é¢ç§¯ç”±åˆ— <strong>area</strong> è¡¨ç¤º. </li>
</ul>
<p>è¯·æŒ‰ç…§é¢ç§¯å¤§å°é™åºæ’åˆ—ï¼Œå¦‚æœé¢ç§¯ç›¸åŒçš„è¯, åˆ™æŒ‰ç…§ p1 å’Œ p2 å‡åºå¯¹ç»“æœè¡¨æ’åº</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Points è¡¨:</span><br><span class="line">+----------+-------------+-------------+</span><br><span class="line">| id       | x_value     | y_value     |</span><br><span class="line">+----------+-------------+-------------+</span><br><span class="line">| 1        | 2           | 8           |</span><br><span class="line">| 2        | 4           | 7           |</span><br><span class="line">| 3        | 2           | 10          |</span><br><span class="line">+----------+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+----------+-------------+-------------+</span><br><span class="line">| p1       | p2          | area        |</span><br><span class="line">+----------+-------------+-------------+</span><br><span class="line">| 2        | 3           | 6           |</span><br><span class="line">| 1        | 2           | 2           |</span><br><span class="line">+----------+-------------+-------------+</span><br><span class="line"></span><br><span class="line">p1 åº”è¯¥å°äº p2 å¹¶ä¸”é¢ç§¯å¤§äº 0.</span><br><span class="line">p1 = 1 ä¸” p2 = 2 æ—¶, é¢ç§¯ç­‰äº |2-4| * |8-7| = 2.</span><br><span class="line">p1 = 2 ä¸” p2 = 3 æ—¶, é¢ç§¯ç­‰äº |4-2| * |7-10| = 6.</span><br><span class="line">p1 = 1 ä¸” p2 = 3 æ—¶, æ˜¯ä¸å¯èƒ½ä¸ºçŸ©å½¢çš„, å› ä¸ºé¢ç§¯ç­‰äº 0.</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.id P1,b.id P2,<span class="built_in">abs</span>(a.x_value<span class="operator">-</span>b.x_value)<span class="operator">*</span><span class="built_in">abs</span>(a.y_value<span class="operator">-</span>b.y_value) <span class="keyword">as</span> area</span><br><span class="line"><span class="keyword">from</span> Points a,Points b</span><br><span class="line"><span class="keyword">where</span> a.id<span class="operator">&lt;</span>b.id <span class="keyword">and</span> a.x_value <span class="operator">!=</span> b.x_value <span class="keyword">and</span> a.y_value <span class="operator">!=</span> b.y_value</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> area <span class="keyword">desc</span>,P1 ,P2 </span><br></pre></td></tr></table></figure>

<h4 id="1468-è®¡ç®—ç¨åå·¥èµ„"><a href="#1468-è®¡ç®—ç¨åå·¥èµ„" class="headerlink" title="1468. è®¡ç®—ç¨åå·¥èµ„"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/calculate-salaries/">1468. è®¡ç®—ç¨åå·¥èµ„</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p><code>Salaries</code> è¡¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| company_id    | int     |</span><br><span class="line">| employee_id   | int     |</span><br><span class="line">| employee_name | varchar |</span><br><span class="line">| salary        | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(company_id, employee_id) æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®</span><br><span class="line">è¿™ä¸ªè¡¨åŒ…æ‹¬å‘˜å·¥çš„company id, id, name å’Œ salary </span><br></pre></td></tr></table></figure>

<p>å†™ä¸€æ¡æŸ¥è¯¢ SQL æ¥æŸ¥æ‰¾æ¯ä¸ªå‘˜å·¥çš„ç¨åå·¥èµ„</p>
<p>æ¯ä¸ªå…¬å¸çš„ç¨ç‡è®¡ç®—ä¾ç…§ä»¥ä¸‹è§„åˆ™</p>
<ul>
<li>å¦‚æœè¿™ä¸ªå…¬å¸å‘˜å·¥æœ€é«˜å·¥èµ„ä¸åˆ° 1000 ï¼Œç¨ç‡ä¸º 0%</li>
<li>å¦‚æœè¿™ä¸ªå…¬å¸å‘˜å·¥æœ€é«˜å·¥èµ„åœ¨ 1000 åˆ° 10000 ä¹‹é—´ï¼Œç¨ç‡ä¸º 24%</li>
<li>å¦‚æœè¿™ä¸ªå…¬å¸å‘˜å·¥æœ€é«˜å·¥èµ„å¤§äº 10000 ï¼Œç¨ç‡ä¸º 49%</li>
</ul>
<p>æŒ‰ä»»æ„é¡ºåºè¿”å›ç»“æœï¼Œç¨åå·¥èµ„ç»“æœå–æ•´</p>
<p>ç»“æœè¡¨æ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">Salaries è¡¨ï¼š</span><br><span class="line">+------------+-------------+---------------+--------+</span><br><span class="line">| company_id | employee_id | employee_name | salary |</span><br><span class="line">+------------+-------------+---------------+--------+</span><br><span class="line">| 1          | 1           | Tony          | 2000   |</span><br><span class="line">| 1          | 2           | Pronub        | 21300  |</span><br><span class="line">| 1          | 3           | Tyrrox        | 10800  |</span><br><span class="line">| 2          | 1           | Pam           | 300    |</span><br><span class="line">| 2          | 7           | Bassem        | 450    |</span><br><span class="line">| 2          | 9           | Hermione      | 700    |</span><br><span class="line">| 3          | 7           | Bocaben       | 100    |</span><br><span class="line">| 3          | 2           | Ognjen        | 2200   |</span><br><span class="line">| 3          | 13          | Nyancat       | 3300   |</span><br><span class="line">| 3          | 15          | Morninngcat   | 1866   |</span><br><span class="line">+------------+-------------+---------------+--------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+------------+-------------+---------------+--------+</span><br><span class="line">| company_id | employee_id | employee_name | salary |</span><br><span class="line">+------------+-------------+---------------+--------+</span><br><span class="line">| 1          | 1           | Tony          | 1020   |</span><br><span class="line">| 1          | 2           | Pronub        | 10863  |</span><br><span class="line">| 1          | 3           | Tyrrox        | 5508   |</span><br><span class="line">| 2          | 1           | Pam           | 300    |</span><br><span class="line">| 2          | 7           | Bassem        | 450    |</span><br><span class="line">| 2          | 9           | Hermione      | 700    |</span><br><span class="line">| 3          | 7           | Bocaben       | 76     |</span><br><span class="line">| 3          | 2           | Ognjen        | 1672   |</span><br><span class="line">| 3          | 13          | Nyancat       | 2508   |</span><br><span class="line">| 3          | 15          | Morninngcat   | 5911   |</span><br><span class="line">+------------+-------------+---------------+--------+</span><br><span class="line">å¯¹äºå…¬å¸ 1 ï¼Œæœ€é«˜å·¥èµ„æ˜¯ 21300 ï¼Œå…¶æ¯ä¸ªå‘˜å·¥çš„ç¨ç‡ä¸º 49%</span><br><span class="line">å¯¹äºå…¬å¸ 2 ï¼Œæœ€é«˜å·¥èµ„æ˜¯ 700 ï¼Œå…¶æ¯ä¸ªå‘˜å·¥ç¨ç‡ä¸º 0%</span><br><span class="line">å¯¹äºå…¬å¸ 3 ï¼Œæœ€é«˜å·¥èµ„æ˜¯ 7777 ï¼Œå…¶æ¯ä¸ªå‘˜å·¥ç¨ç‡æ˜¯ 24%</span><br><span class="line">ç¨åå·¥èµ„è®¡ç®— = å·¥èµ„ - ( ç¨ç‡ / 100ï¼‰*å·¥èµ„</span><br><span class="line">å¯¹äºä¸Šè¿°æ¡ˆä¾‹ï¼ŒMorninngcat çš„ç¨åå·¥èµ„ = 7777 - 7777 * ( 24 / 100) = 7777 - 1866.48 = 5910.52 ï¼Œå–æ•´ä¸º 5911</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> company_id,employee_id , employee_name,</span><br><span class="line">round(<span class="keyword">case</span> <span class="keyword">when</span> maxsalary<span class="operator">&lt;</span><span class="number">1000</span> <span class="keyword">then</span> salary</span><br><span class="line">       <span class="keyword">when</span> maxsalary<span class="operator">&lt;</span><span class="number">10000</span> <span class="keyword">then</span> salary<span class="operator">*</span>(<span class="number">1</span><span class="number">-0.24</span>)</span><br><span class="line">       <span class="keyword">else</span> salary<span class="operator">*</span>(<span class="number">1</span><span class="number">-0.49</span>) <span class="keyword">end</span> ,<span class="number">0</span>)salary</span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line">    <span class="keyword">select</span> <span class="operator">*</span>,<span class="built_in">max</span>(salary) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> company_id ) maxsalary</span><br><span class="line">    <span class="keyword">from</span> Salaries </span><br><span class="line">)t1</span><br></pre></td></tr></table></figure>

<h4 id="1479-å‘¨å†…æ¯å¤©çš„é”€å”®æƒ…å†µ"><a href="#1479-å‘¨å†…æ¯å¤©çš„é”€å”®æƒ…å†µ" class="headerlink" title="1479. å‘¨å†…æ¯å¤©çš„é”€å”®æƒ…å†µ"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/sales-by-day-of-the-week/">1479. å‘¨å†…æ¯å¤©çš„é”€å”®æƒ…å†µ</a></h4><p>éš¾åº¦å›°éš¾</p>
<p>SQLæ¶æ„</p>
<p>è¡¨ï¼š<code>Orders</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| order_id      | int     |</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| order_date    | date    | </span><br><span class="line">| item_id       | varchar |</span><br><span class="line">| quantity      | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(order_id, item_id) æ˜¯è¯¥è¡¨ä¸»é”®</span><br><span class="line">è¯¥è¡¨åŒ…å«äº†è®¢å•ä¿¡æ¯</span><br><span class="line">order_date æ˜¯idä¸º item_id çš„å•†å“è¢«idä¸º customer_id çš„æ¶ˆè´¹è€…è®¢è´­çš„æ—¥æœŸ.</span><br></pre></td></tr></table></figure>

<p>è¡¨ï¼š<code>Items</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------------+---------+</span><br><span class="line">| Column Name         | Type    |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">| item_id             | varchar |</span><br><span class="line">| item_name           | varchar |</span><br><span class="line">| item_category       | varchar |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">item_id æ˜¯è¯¥è¡¨ä¸»é”®</span><br><span class="line">item_name æ˜¯å•†å“çš„åå­—</span><br><span class="line">item_category æ˜¯å•†å“çš„ç±»åˆ«</span><br></pre></td></tr></table></figure>

<p>ä½ æ˜¯ä¼ä¸šä¸»ï¼Œæƒ³è¦è·å¾—åˆ†ç±»å•†å“å’Œå‘¨å†…æ¯å¤©çš„é”€å”®æŠ¥å‘Šã€‚</p>
<p>å†™ä¸€ä¸ªSQLè¯­å¥ï¼ŒæŠ¥å‘Š <strong>å‘¨å†…æ¯å¤©</strong> æ¯ä¸ªå•†å“ç±»åˆ«ä¸‹è®¢è´­äº†å¤šå°‘å•ä½ã€‚</p>
<p>è¿”å›ç»“æœè¡¨å• <strong>æŒ‰å•†å“ç±»åˆ«æ’åº</strong> ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">Orders è¡¨ï¼š</span><br><span class="line">+------------+--------------+-------------+--------------+-------------+</span><br><span class="line">| order_id   | customer_id  | order_date  | item_id      | quantity    |</span><br><span class="line">+------------+--------------+-------------+--------------+-------------+</span><br><span class="line">| 1          | 1            | 2020-06-01  | 1            | 10          |</span><br><span class="line">| 2          | 1            | 2020-06-08  | 2            | 10          |</span><br><span class="line">| 3          | 2            | 2020-06-02  | 1            | 5           |</span><br><span class="line">| 4          | 3            | 2020-06-03  | 3            | 5           |</span><br><span class="line">| 5          | 4            | 2020-06-04  | 4            | 1           |</span><br><span class="line">| 6          | 4            | 2020-06-05  | 5            | 5           |</span><br><span class="line">| 7          | 5            | 2020-06-05  | 1            | 10          |</span><br><span class="line">| 8          | 5            | 2020-06-14  | 4            | 5           |</span><br><span class="line">| 9          | 5            | 2020-06-21  | 3            | 5           |</span><br><span class="line">+------------+--------------+-------------+--------------+-------------+</span><br><span class="line"></span><br><span class="line">Items è¡¨ï¼š</span><br><span class="line">+------------+----------------+---------------+</span><br><span class="line">| item_id    | item_name      | item_category |</span><br><span class="line">+------------+----------------+---------------+</span><br><span class="line">| 1          | LC Alg. Book   | Book          |</span><br><span class="line">| 2          | LC DB. Book    | Book          |</span><br><span class="line">| 3          | LC SmarthPhone | Phone         |</span><br><span class="line">| 4          | LC Phone 2020  | Phone         |</span><br><span class="line">| 5          | LC SmartGlass  | Glasses       |</span><br><span class="line">| 6          | LC T-Shirt XL  | T-Shirt       |</span><br><span class="line">+------------+----------------+---------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+------------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+</span><br><span class="line">| Category   | Monday    | Tuesday   | Wednesday | Thursday  | Friday    | Saturday  | Sunday    |</span><br><span class="line">+------------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+</span><br><span class="line">| Book       | 20        | 5         | 0         | 0         | 10        | 0         | 0         |</span><br><span class="line">| Glasses    | 0         | 0         | 0         | 0         | 5         | 0         | 0         |</span><br><span class="line">| Phone      | 0         | 0         | 5         | 1         | 0         | 0         | 10        |</span><br><span class="line">| T-Shirt    | 0         | 0         | 0         | 0         | 0         | 0         | 0         |</span><br><span class="line">+------------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+</span><br><span class="line">åœ¨å‘¨ä¸€(2020-06-01, 2020-06-08)ï¼ŒBookåˆ†ç±»(ids: 1, 2)ä¸‹ï¼Œæ€»å…±é”€å”®äº†20ä¸ªå•ä½(10 + 10)</span><br><span class="line">åœ¨å‘¨äºŒ(2020-06-02)ï¼ŒBookåˆ†ç±»(ids: 1, 2)ä¸‹ï¼Œæ€»å…±é”€å”®äº†5ä¸ªå•ä½</span><br><span class="line">åœ¨å‘¨ä¸‰(2020-06-03)ï¼ŒPhoneåˆ†ç±»(ids: 3, 4)ä¸‹ï¼Œæ€»å…±é”€å”®äº†5ä¸ªå•ä½</span><br><span class="line">åœ¨å‘¨å››(2020-06-04)ï¼ŒPhoneåˆ†ç±»(ids: 3, 4)ä¸‹ï¼Œæ€»å…±é”€å”®äº†1ä¸ªå•ä½</span><br><span class="line">åœ¨å‘¨äº”(2020-06-05)ï¼ŒBookåˆ†ç±»(ids: 1, 2)ä¸‹ï¼Œæ€»å…±é”€å”®äº†10ä¸ªå•ä½ï¼ŒGlassesåˆ†ç±»(ids: 5)ä¸‹ï¼Œæ€»å…±é”€å”®äº†5ä¸ªå•ä½</span><br><span class="line">åœ¨å‘¨å…­, æ²¡æœ‰å•†å“é”€å”®</span><br><span class="line">åœ¨å‘¨å¤©(2020-06-14, 2020-06-21)ï¼ŒPhoneåˆ†ç±»(ids: 3, 4)ä¸‹ï¼Œæ€»å…±é”€å”®äº†10ä¸ªå•ä½(5 + 5)</span><br><span class="line">æ²¡æœ‰é”€å”® T-Shirt ç±»åˆ«çš„å•†å“</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> item_category <span class="keyword">as</span> category, </span><br><span class="line"><span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> num <span class="operator">=</span> <span class="number">2</span> <span class="keyword">then</span> quantity <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> Monday,</span><br><span class="line"><span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> num <span class="operator">=</span> <span class="number">3</span> <span class="keyword">then</span> quantity <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> Tuesday,</span><br><span class="line"><span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> num <span class="operator">=</span> <span class="number">4</span> <span class="keyword">then</span> quantity <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> Wednesday,</span><br><span class="line"><span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> num <span class="operator">=</span> <span class="number">5</span> <span class="keyword">then</span> quantity <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> Thursday,</span><br><span class="line"><span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> num <span class="operator">=</span> <span class="number">6</span> <span class="keyword">then</span> quantity <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> Friday,</span><br><span class="line"><span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> num <span class="operator">=</span> <span class="number">7</span> <span class="keyword">then</span> quantity <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> Saturday,</span><br><span class="line"><span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> num <span class="operator">=</span> <span class="number">1</span> <span class="keyword">then</span> quantity <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> Sunday</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> item_category, quantity,dayofweek(order_date) <span class="keyword">as</span> num <span class="keyword">from</span> </span><br><span class="line">items i <span class="keyword">left</span> <span class="keyword">join</span> orders o </span><br><span class="line"><span class="keyword">on</span> i.item_id<span class="operator">=</span>o.item_id) t</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> item_category</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> item_category</span><br></pre></td></tr></table></figure>

<h4 id="1485-æŒ‰æ—¥æœŸåˆ†ç»„é”€å”®äº§å“"><a href="#1485-æŒ‰æ—¥æœŸåˆ†ç»„é”€å”®äº§å“" class="headerlink" title="1485. æŒ‰æ—¥æœŸåˆ†ç»„é”€å”®äº§å“"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/group-sold-products-by-the-date/">1485. æŒ‰æ—¥æœŸåˆ†ç»„é”€å”®äº§å“</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>è¡¨ <code>Activities</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| åˆ—å         | ç±»å‹    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| sell_date   | date    |</span><br><span class="line">| product     | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">æ­¤è¡¨æ²¡æœ‰ä¸»é”®ï¼Œå®ƒå¯èƒ½åŒ…å«é‡å¤é¡¹ã€‚</span><br><span class="line">æ­¤è¡¨çš„æ¯ä¸€è¡Œéƒ½åŒ…å«äº§å“åç§°å’Œåœ¨å¸‚åœºä¸Šé”€å”®çš„æ—¥æœŸã€‚</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢æ¥æŸ¥æ‰¾æ¯ä¸ªæ—¥æœŸã€é”€å”®çš„ä¸åŒäº§å“çš„æ•°é‡åŠå…¶åç§°ã€‚<br>æ¯ä¸ªæ—¥æœŸçš„é”€å”®äº§å“åç§°åº”æŒ‰è¯å…¸åºæ’åˆ—ã€‚<br>è¿”å›æŒ‰ <code>sell_date</code> æ’åºçš„ç»“æœè¡¨ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Activities è¡¨ï¼š</span><br><span class="line">+------------+-------------+</span><br><span class="line">| sell_date  | product     |</span><br><span class="line">+------------+-------------+</span><br><span class="line">| 2020-05-30 | Headphone   |</span><br><span class="line">| 2020-06-01 | Pencil      |</span><br><span class="line">| 2020-06-02 | Mask        |</span><br><span class="line">| 2020-05-30 | Basketball  |</span><br><span class="line">| 2020-06-01 | Bible       |</span><br><span class="line">| 2020-06-02 | Mask        |</span><br><span class="line">| 2020-05-30 | T-Shirt     |</span><br><span class="line">+------------+-------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+------------+----------+------------------------------+</span><br><span class="line">| sell_date  | num_sold | products                     |</span><br><span class="line">+------------+----------+------------------------------+</span><br><span class="line">| 2020-05-30 | 3        | Basketball,Headphone,T-shirt |</span><br><span class="line">| 2020-06-01 | 2        | Bible,Pencil                 |</span><br><span class="line">| 2020-06-02 | 1        | Mask                         |</span><br><span class="line">+------------+----------+------------------------------+</span><br><span class="line">å¯¹äº2020-05-30ï¼Œå‡ºå”®çš„ç‰©å“æ˜¯ (Headphone, Basketball, T-shirt)ï¼ŒæŒ‰è¯å…¸åºæ’åˆ—ï¼Œå¹¶ç”¨é€—å· &#x27;,&#x27; åˆ†éš”ã€‚</span><br><span class="line">å¯¹äº2020-06-01ï¼Œå‡ºå”®çš„ç‰©å“æ˜¯ (Pencil, Bible)ï¼ŒæŒ‰è¯å…¸åºæ’åˆ—ï¼Œå¹¶ç”¨é€—å·åˆ†éš”ã€‚</span><br><span class="line">å¯¹äº2020-06-02ï¼Œå‡ºå”®çš„ç‰©å“æ˜¯ (Mask)ï¼Œåªéœ€è¿”å›è¯¥ç‰©å“åã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> sell_date, <span class="built_in">count</span>(<span class="keyword">distinct</span> product) num_sold, </span><br><span class="line">    group_concat(<span class="keyword">distinct</span> product <span class="keyword">order</span> <span class="keyword">by</span> product) products</span><br><span class="line"><span class="keyword">from</span> Activities</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> sell_date</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¡Œè½¬åˆ—</p>
</blockquote>
<h4 id="1495-ä¸Šæœˆæ’­æ”¾çš„å„¿ç«¥é€‚å®œç”µå½±"><a href="#1495-ä¸Šæœˆæ’­æ”¾çš„å„¿ç«¥é€‚å®œç”µå½±" class="headerlink" title="1495. ä¸Šæœˆæ’­æ”¾çš„å„¿ç«¥é€‚å®œç”µå½±"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/friendly-movies-streamed-last-month/">1495. ä¸Šæœˆæ’­æ”¾çš„å„¿ç«¥é€‚å®œç”µå½±</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>è¡¨: <code>TVProgram</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| program_date  | date    |</span><br><span class="line">| content_id    | int     |</span><br><span class="line">| channel       | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(program_date, content_id) æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">è¯¥è¡¨åŒ…å«ç”µè§†ä¸Šçš„èŠ‚ç›®ä¿¡æ¯.</span><br><span class="line">content_id æ˜¯ç”µè§†ä¸€äº›é¢‘é“ä¸Šçš„èŠ‚ç›®çš„ id.</span><br></pre></td></tr></table></figure>

<p>è¡¨: <code>Content</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+------------------+---------+</span><br><span class="line">| Column Name      | Type    |</span><br><span class="line">+------------------+---------+</span><br><span class="line">| content_id       | varchar |</span><br><span class="line">| title            | varchar |</span><br><span class="line">| Kids_content     | enum    |</span><br><span class="line">| content_type     | varchar |</span><br><span class="line">+------------------+---------+</span><br><span class="line">content_id æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">Kids_content æ˜¯æšä¸¾ç±»å‹, å–å€¼ä¸º(&#x27;Y&#x27;, &#x27;N&#x27;), å…¶ä¸­: </span><br><span class="line">&#x27;Y&#x27; è¡¨ç¤ºå„¿ç«¥é€‚å®œå†…å®¹, è€Œ&#x27;N&#x27;è¡¨ç¤ºå„¿ç«¥ä¸å®œå†…å®¹.</span><br><span class="line">content_type è¡¨ç¤ºå†…å®¹çš„ç±»å‹, æ¯”å¦‚ç”µå½±, ç”µè§†å‰§ç­‰.</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€ä¸ª SQL è¯­å¥, æŠ¥å‘Šåœ¨ 2020 å¹´ 6 æœˆä»½æ’­æ”¾çš„å„¿ç«¥é€‚å®œç”µå½±çš„å»é‡ç”µå½±å.</p>
<p>è¿”å›çš„ç»“æœè¡¨å•æ²¡æœ‰é¡ºåºè¦æ±‚.</p>
<p>æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤º.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">TVProgram è¡¨:</span><br><span class="line">+--------------------+--------------+-------------+</span><br><span class="line">| program_date       | content_id   | channel     |</span><br><span class="line">+--------------------+--------------+-------------+</span><br><span class="line">| 2020-06-10 08:00   | 1            | LC-Channel  |</span><br><span class="line">| 2020-05-11 12:00   | 2            | LC-Channel  |</span><br><span class="line">| 2020-05-12 12:00   | 3            | LC-Channel  |</span><br><span class="line">| 2020-05-13 14:00   | 4            | Disney Ch   |</span><br><span class="line">| 2020-06-18 14:00   | 4            | Disney Ch   |</span><br><span class="line">| 2020-07-15 16:00   | 5            | Disney Ch   |</span><br><span class="line">+--------------------+--------------+-------------+</span><br><span class="line"></span><br><span class="line">Content è¡¨:</span><br><span class="line">+------------+----------------+---------------+---------------+</span><br><span class="line">| content_id | title          | Kids_content  | content_type  |</span><br><span class="line">+------------+----------------+---------------+---------------+</span><br><span class="line">| 1          | Leetcode Movie | N             | Movies        |</span><br><span class="line">| 2          | Alg. for Kids  | Y             | Series        |</span><br><span class="line">| 3          | Database Sols  | N             | Series        |</span><br><span class="line">| 4          | Aladdin        | Y             | Movies        |</span><br><span class="line">| 5          | Cinderella     | Y             | Movies        |</span><br><span class="line">+------------+----------------+---------------+---------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+--------------+</span><br><span class="line">| title        |</span><br><span class="line">+--------------+</span><br><span class="line">| Aladdin      |</span><br><span class="line">+--------------+</span><br><span class="line">&quot;Leetcode Movie&quot; æ˜¯å„¿ç«¥ä¸å®œçš„ç”µå½±.</span><br><span class="line">&quot;Alg. for Kids&quot; ä¸æ˜¯ç”µå½±.</span><br><span class="line">&quot;Database Sols&quot; ä¸æ˜¯ç”µå½±</span><br><span class="line">&quot;Alladin&quot; æ˜¯ç”µå½±, å„¿ç«¥é€‚å®œ, å¹¶ä¸”åœ¨ 2020 å¹´ 6 æœˆä»½æ’­æ”¾.</span><br><span class="line">&quot;Cinderella&quot; ä¸åœ¨ 2020 å¹´ 6 æœˆä»½æ’­æ”¾.</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> title   </span><br><span class="line"><span class="keyword">from</span> TVProgram t <span class="keyword">left</span> <span class="keyword">join</span> Content c</span><br><span class="line"><span class="keyword">on</span> t.content_id  <span class="operator">=</span> c.content_id </span><br><span class="line"><span class="keyword">where</span>  Kids_content <span class="operator">=</span><span class="string">&#x27;Y&#x27;</span> </span><br><span class="line"><span class="keyword">and</span> date_format(program_date ,<span class="string">&#x27;%Y-%m&#x27;</span>)<span class="operator">=</span><span class="string">&#x27;2020-06&#x27;</span></span><br><span class="line"><span class="keyword">and</span> content_type<span class="operator">=</span><span class="string">&#x27;Movies&#x27;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>LEFT()å‡½æ•°å‚è§ï¼š<a target="_blank" rel="noopener" href="https://www.begtut.com/sql/func-mysql-left.html">https://www.begtut.com/sql/func-mysql-left.html</a><br>REGEXPè¯­æ³•å‚è§ï¼š<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/timssd/p/5882742.html">https://www.cnblogs.com/timssd/p/5882742.html</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhaopanpan/p/10133224.html">https://www.cnblogs.com/zhaopanpan/p/10133224.html</a><br>DATE_FORMAT()å‡½æ•°å‚è§ï¼š<a target="_blank" rel="noopener" href="https://www.w3school.com.cn/sql/func_date_format.asp">https://www.w3school.com.cn/sql/func_date_format.asp</a><br>EXTRACT()å‡½æ•°å‚è§ï¼š<a target="_blank" rel="noopener" href="https://www.runoob.com/sql/func-extract.html">https://www.runoob.com/sql/func-extract.html</a><br>DATEDIFF()å‡½æ•°å‚è§ï¼š<a target="_blank" rel="noopener" href="https://www.runoob.com/sql/func-datediff-mysql.html">https://www.runoob.com/sql/func-datediff-mysql.html</a><br>YEAR()å‡½æ•°å‚è§ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/moakun/article/details/82528829">https://blog.csdn.net/moakun/article/details/82528829</a><br>MONTH()å‡½æ•°å‚è§ï¼š<a target="_blank" rel="noopener" href="https://www.yiibai.com/mysql/month.html">https://www.yiibai.com/mysql/month.html</a></p>
</blockquote>
<h4 id="1501-å¯ä»¥æ”¾å¿ƒæŠ•èµ„çš„å›½å®¶"><a href="#1501-å¯ä»¥æ”¾å¿ƒæŠ•èµ„çš„å›½å®¶" class="headerlink" title="1501. å¯ä»¥æ”¾å¿ƒæŠ•èµ„çš„å›½å®¶"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/countries-you-can-safely-invest-in/">1501. å¯ä»¥æ”¾å¿ƒæŠ•èµ„çš„å›½å®¶</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>è¡¨ <code>Person</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| id             | int     |</span><br><span class="line">| name           | varchar |</span><br><span class="line">| phone_number   | varchar |</span><br><span class="line">+----------------+---------+</span><br><span class="line">id æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">è¯¥è¡¨æ¯ä¸€è¡ŒåŒ…å«ä¸€ä¸ªäººçš„åå­—å’Œç”µè¯å·ç .</span><br><span class="line">ç”µè¯å·ç çš„æ ¼å¼æ˜¯:&#x27;xxx-yyyyyyy&#x27;, å…¶ä¸­xxxæ˜¯å›½å®¶ç (3ä¸ªå­—ç¬¦), yyyyyyyæ˜¯ç”µè¯å·ç (7ä¸ªå­—ç¬¦), xå’Œyéƒ½è¡¨ç¤ºæ•°å­—. åŒæ—¶, å›½å®¶ç å’Œç”µè¯å·ç éƒ½å¯ä»¥åŒ…å«å‰å¯¼0.</span><br></pre></td></tr></table></figure>

<p>è¡¨ <code>Country</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| name           | varchar |</span><br><span class="line">| country_code   | varchar |</span><br><span class="line">+----------------+---------+</span><br><span class="line">country_codeæ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">è¯¥è¡¨æ¯ä¸€è¡ŒåŒ…å«å›½å®¶åå’Œå›½å®¶ç . country_codeçš„æ ¼å¼æ˜¯&#x27;xxx&#x27;, xæ˜¯æ•°å­—.</span><br></pre></td></tr></table></figure>

<p>è¡¨ <code>Calls</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-------------+------+</span><br><span class="line">| Column Name | Type |</span><br><span class="line">+-------------+------+</span><br><span class="line">| caller_id   | int  |</span><br><span class="line">| callee_id   | int  |</span><br><span class="line">| duration    | int  |</span><br><span class="line">+-------------+------+</span><br><span class="line">è¯¥è¡¨æ— ä¸»é”®, å¯èƒ½åŒ…å«é‡å¤è¡Œ.</span><br><span class="line">æ¯ä¸€è¡ŒåŒ…å«å‘¼å«æ–¹id, è¢«å‘¼å«æ–¹idå’Œä»¥åˆ†é’Ÿä¸ºå•ä½çš„é€šè¯æ—¶é•¿. caller_id != callee_id</span><br></pre></td></tr></table></figure>

<p>ä¸€å®¶ç”µä¿¡å…¬å¸æƒ³è¦æŠ•èµ„æ–°çš„å›½å®¶. è¯¥å…¬å¸æƒ³è¦æŠ•èµ„çš„å›½å®¶æ˜¯: è¯¥å›½çš„å¹³å‡é€šè¯æ—¶é•¿è¦ä¸¥æ ¼åœ°å¤§äºå…¨çƒå¹³å‡é€šè¯æ—¶é•¿.</p>
<p>å†™ä¸€æ®µ SQL, æ‰¾åˆ°æ‰€æœ‰è¯¥å…¬å¸å¯ä»¥æŠ•èµ„çš„å›½å®¶.</p>
<p>è¿”å›çš„ç»“æœè¡¨æ²¡æœ‰é¡ºåºè¦æ±‚.</p>
<p>æŸ¥è¯¢çš„ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤º.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">Person è¡¨:</span><br><span class="line">+----+----------+--------------+</span><br><span class="line">| id | name     | phone_number |</span><br><span class="line">+----+----------+--------------+</span><br><span class="line">| 3  | Jonathan | 051-1234567  |</span><br><span class="line">| 12 | Elvis    | 051-7654321  |</span><br><span class="line">| 1  | Moncef   | 212-1234567  |</span><br><span class="line">| 2  | Maroua   | 212-6523651  |</span><br><span class="line">| 7  | Meir     | 972-1234567  |</span><br><span class="line">| 9  | Rachel   | 972-0011100  |</span><br><span class="line">+----+----------+--------------+</span><br><span class="line"></span><br><span class="line">Country è¡¨:</span><br><span class="line">+----------+--------------+</span><br><span class="line">| name     | country_code |</span><br><span class="line">+----------+--------------+</span><br><span class="line">| Peru     | 051          |</span><br><span class="line">| Israel   | 972          |</span><br><span class="line">| Morocco  | 212          |</span><br><span class="line">| Germany  | 049          |</span><br><span class="line">| Ethiopia | 251          |</span><br><span class="line">+----------+--------------+</span><br><span class="line"></span><br><span class="line">Calls è¡¨:</span><br><span class="line">+-----------+-----------+----------+</span><br><span class="line">| caller_id | callee_id | duration |</span><br><span class="line">+-----------+-----------+----------+</span><br><span class="line">| 1         | 9         | 33       |</span><br><span class="line">| 2         | 9         | 4        |</span><br><span class="line">| 1         | 2         | 59       |</span><br><span class="line">| 3         | 12        | 102      |</span><br><span class="line">| 3         | 12        | 330      |</span><br><span class="line">| 12        | 3         | 5        |</span><br><span class="line">| 7         | 9         | 13       |</span><br><span class="line">| 7         | 1         | 3        |</span><br><span class="line">| 9         | 7         | 1        |</span><br><span class="line">| 1         | 7         | 7        |</span><br><span class="line">+-----------+-----------+----------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+----------+</span><br><span class="line">| country  |</span><br><span class="line">+----------+</span><br><span class="line">| Peru     |</span><br><span class="line">+----------+</span><br><span class="line">å›½å®¶Peruçš„å¹³å‡é€šè¯æ—¶é•¿æ˜¯ (102 + 102 + 330 + 330 + 5 + 5) / 6 = 145.666667</span><br><span class="line">å›½å®¶Israelçš„å¹³å‡é€šè¯æ—¶é•¿æ˜¯ (33 + 4 + 13 + 13 + 3 + 1 + 1 + 7) / 8 = 9.37500</span><br><span class="line">å›½å®¶Moroccoçš„å¹³å‡é€šè¯æ—¶é•¿æ˜¯ (33 + 4 + 59 + 59 + 3 + 7) / 6 = 27.5000 </span><br><span class="line">å…¨çƒå¹³å‡é€šè¯æ—¶é•¿ = (2 * (33 + 3 + 59 + 102 + 330 + 5 + 13 + 3 + 1 + 7)) / 20 = 55.70000</span><br><span class="line">æ‰€ä»¥, Peruæ˜¯å”¯ä¸€çš„å¹³å‡é€šè¯æ—¶é•¿å¤§äºå…¨çƒå¹³å‡é€šè¯æ—¶é•¿çš„å›½å®¶, ä¹Ÿæ˜¯å”¯ä¸€çš„æ¨èæŠ•èµ„çš„å›½å®¶.</span><br></pre></td></tr></table></figure>

<p>ç¬›å¡å°”ç§¯</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> c2.name <span class="keyword">as</span> country </span><br><span class="line"><span class="keyword">from</span> Calls c1,Person p,Country c2</span><br><span class="line"><span class="keyword">where</span> (p.id<span class="operator">=</span>c1.caller_id <span class="keyword">or</span> p.id<span class="operator">=</span>c1.callee_id) <span class="keyword">and</span> c2.country_code<span class="operator">=</span><span class="keyword">left</span>(p.phone_number,<span class="number">3</span>)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> c2.name </span><br><span class="line"><span class="keyword">having</span> <span class="built_in">avg</span>(duration)<span class="operator">&gt;</span>(<span class="keyword">select</span> <span class="built_in">avg</span>(duration) <span class="keyword">from</span> Calls)</span><br></pre></td></tr></table></figure>

<p>æ€è·¯æ›´æ¸…æ™°</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> people_country <span class="keyword">as</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> id, c.name country</span><br><span class="line">    <span class="keyword">from</span> Person p <span class="keyword">left</span> <span class="keyword">join</span> Country c</span><br><span class="line">    <span class="keyword">on</span> <span class="keyword">left</span>(p.phone_number,<span class="number">3</span>) <span class="operator">=</span> c.country_code</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> country</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> country, <span class="built_in">avg</span>(duration) avgtime</span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> caller_id id, duration</span><br><span class="line">        <span class="keyword">from</span> Calls</span><br><span class="line">        <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">        <span class="keyword">select</span> callee_id, duration</span><br><span class="line">        <span class="keyword">from</span> Calls</span><br><span class="line">    ) t <span class="keyword">left</span> <span class="keyword">join</span> people_country</span><br><span class="line">    <span class="keyword">using</span>(id)</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> country</span><br><span class="line">) temp</span><br><span class="line"><span class="keyword">where</span> avgtime <span class="operator">&gt;</span> </span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> <span class="built_in">avg</span>(duration) avgtime</span><br><span class="line">        <span class="keyword">from</span></span><br><span class="line">        (</span><br><span class="line">            <span class="keyword">select</span> caller_id, duration</span><br><span class="line">            <span class="keyword">from</span> Calls</span><br><span class="line">            <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">            <span class="keyword">select</span> callee_id, duration</span><br><span class="line">            <span class="keyword">from</span> Calls</span><br><span class="line">        ) t</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>



<h4 id="1511-æ¶ˆè´¹è€…ä¸‹å•é¢‘ç‡"><a href="#1511-æ¶ˆè´¹è€…ä¸‹å•é¢‘ç‡" class="headerlink" title="1511. æ¶ˆè´¹è€…ä¸‹å•é¢‘ç‡"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/customer-order-frequency/">1511. æ¶ˆè´¹è€…ä¸‹å•é¢‘ç‡</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>è¡¨: <code>Customers</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">| country       | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">customer_id æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">è¯¥è¡¨åŒ…å«å…¬å¸æ¶ˆè´¹è€…çš„ä¿¡æ¯.</span><br></pre></td></tr></table></figure>

<p>è¡¨: <code>Product</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| description   | varchar |</span><br><span class="line">| price         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">product_id æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">è¯¥è¡¨åŒ…å«å…¬å¸äº§å“çš„ä¿¡æ¯.</span><br><span class="line">price æ˜¯æœ¬äº§å“çš„èŠ±é”€.</span><br></pre></td></tr></table></figure>

<p>è¡¨: <code>Orders</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| order_id      | int     |</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| order_date    | date    |</span><br><span class="line">| quantity      | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">order_id æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">è¯¥è¡¨åŒ…å«æ¶ˆè´¹è€…ä¸‹å•çš„ä¿¡æ¯.</span><br><span class="line">customer_id æ˜¯ä¹°äº†æ•°é‡ä¸º&quot;quantity&quot;, idä¸º&quot;product_id&quot;äº§å“çš„æ¶ˆè´¹è€…çš„ id.</span><br><span class="line">Order_date æ˜¯è®¢å•å‘è´§çš„æ—¥æœŸ, æ ¼å¼ä¸º(&#x27;YYYY-MM-DD&#x27;).</span><br></pre></td></tr></table></figure>

<p>å†™ä¸€ä¸ª SQL è¯­å¥, æŠ¥å‘Šæ¶ˆè´¹è€…çš„ id å’Œåå­—, å…¶ä¸­æ¶ˆè´¹è€…åœ¨ 2020 å¹´ 6 æœˆå’Œ 7 æœˆ, æ¯æœˆè‡³å°‘èŠ±è´¹äº†$100.</p>
<p>ç»“æœè¡¨æ— é¡ºåºè¦æ±‚.</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤º.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">Customers</span><br><span class="line">+--------------+-----------+-------------+</span><br><span class="line">| customer_id  | name      | country     |</span><br><span class="line">+--------------+-----------+-------------+</span><br><span class="line">| 1            | Winston   | USA         |</span><br><span class="line">| 2            | Jonathan  | Peru        |</span><br><span class="line">| 3            | Moustafa  | Egypt       |</span><br><span class="line">+--------------+-----------+-------------+</span><br><span class="line"></span><br><span class="line">Product</span><br><span class="line">+--------------+-------------+-------------+</span><br><span class="line">| product_id   | description | price       |</span><br><span class="line">+--------------+-------------+-------------+</span><br><span class="line">| 10           | LC Phone    | 300         |</span><br><span class="line">| 20           | LC T-Shirt  | 10          |</span><br><span class="line">| 30           | LC Book     | 45          |</span><br><span class="line">| 40           | LC Keychain | 2           |</span><br><span class="line">+--------------+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Orders</span><br><span class="line">+--------------+-------------+-------------+-------------+-----------+</span><br><span class="line">| order_id     | customer_id | product_id  | order_date  | quantity  |</span><br><span class="line">+--------------+-------------+-------------+-------------+-----------+</span><br><span class="line">| 1            | 1           | 10          | 2020-06-10  | 1         |</span><br><span class="line">| 2            | 1           | 20          | 2020-07-01  | 1         |</span><br><span class="line">| 3            | 1           | 30          | 2020-07-08  | 2         |</span><br><span class="line">| 4            | 2           | 10          | 2020-06-15  | 2         |</span><br><span class="line">| 5            | 2           | 40          | 2020-07-01  | 10        |</span><br><span class="line">| 6            | 3           | 20          | 2020-06-24  | 2         |</span><br><span class="line">| 7            | 3           | 30          | 2020-06-25  | 2         |</span><br><span class="line">| 9            | 3           | 30          | 2020-05-08  | 3         |</span><br><span class="line">+--------------+-------------+-------------+-------------+-----------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+--------------+------------+</span><br><span class="line">| customer_id  | name       |  </span><br><span class="line">+--------------+------------+</span><br><span class="line">| 1            | Winston    |</span><br><span class="line">+--------------+------------+ </span><br><span class="line">Winston åœ¨2020å¹´6æœˆèŠ±è´¹äº†$300(300 * 1), åœ¨7æœˆèŠ±è´¹äº†$100(10 * 1 + 45 * 2).</span><br><span class="line">Jonathan åœ¨2020å¹´6æœˆèŠ±è´¹äº†$600(300 * 2), åœ¨7æœˆèŠ±è´¹äº†$20(2 * 10).</span><br><span class="line">Moustafa åœ¨2020å¹´6æœˆèŠ±è´¹äº†$110 (10 * 2 + 45 * 2), åœ¨7æœˆèŠ±è´¹äº†$0.</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> customer_id,name</span><br><span class="line"><span class="keyword">from</span> Customers</span><br><span class="line"><span class="keyword">where</span> customer_id <span class="keyword">in</span></span><br><span class="line">(<span class="keyword">select</span> customer_id</span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">        (<span class="keyword">select</span> customer_id, <span class="keyword">month</span>(order_date) <span class="keyword">as</span> <span class="keyword">month</span> , <span class="built_in">sum</span>(quantity<span class="operator">*</span>price) <span class="keyword">as</span> total</span><br><span class="line">        <span class="keyword">from</span> Orders o <span class="keyword">left</span> <span class="keyword">join</span> Product p <span class="keyword">on</span> o.product_id <span class="operator">=</span> p.product_id</span><br><span class="line">        <span class="keyword">where</span> <span class="keyword">month</span>(order_date) <span class="operator">=</span> <span class="number">6</span> <span class="keyword">or</span> <span class="keyword">month</span>(order_date)<span class="operator">=</span><span class="number">7</span></span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> customer_id,<span class="keyword">month</span>(order_date)</span><br><span class="line">        ) <span class="keyword">as</span> t1</span><br><span class="line">    <span class="keyword">where</span> total <span class="operator">&gt;=</span><span class="number">100</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> customer_id</span><br><span class="line">    <span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">&gt;=</span><span class="number">2</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<h4 id="1517-Find-Users-With-Valid-E-Mails"><a href="#1517-Find-Users-With-Valid-E-Mails" class="headerlink" title="1517. Find Users With Valid E-Mails"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/find-users-with-valid-e-mails/">1517. Find Users With Valid E-Mails</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>Table: <code>Users</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">| mail          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">user_id is the primary key for this table.</span><br><span class="line">This table contains information of the users signed up in a website. Some e-mails are invalid.</span><br></pre></td></tr></table></figure>

<p>Write an SQL query to find the users who have <strong>valid emails</strong>.</p>
<p>A valid e-mail has a prefix name and a domain where: </p>
<ul>
<li><strong>The prefix name</strong> is a string that may contain letters (upper or lower case), digits, underscore <code>&#39;_&#39;</code>, period <code>&#39;.&#39;</code> and/or dash <code>&#39;-&#39;</code>. The prefix name <strong>must</strong> start with a letter.</li>
<li><strong>The domain</strong> is <code>&#39;@leetcode.com&#39;</code>.</li>
</ul>
<p>Return the result table in any order.</p>
<p>The query result format is in the following example.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Users</span><br><span class="line">+---------+-----------+-------------------------+</span><br><span class="line">| user_id | name      | mail                    |</span><br><span class="line">+---------+-----------+-------------------------+</span><br><span class="line">| 1       | Winston   | winston@leetcode.com    |</span><br><span class="line">| 2       | Jonathan  | jonathanisgreat         |</span><br><span class="line">| 3       | Annabelle | bella-@leetcode.com     |</span><br><span class="line">| 4       | Sally     | sally.come@leetcode.com |</span><br><span class="line">| 5       | Marwan    | quarz#2020@leetcode.com |</span><br><span class="line">| 6       | David     | david69@gmail.com       |</span><br><span class="line">| 7       | Shapiro   | .shapo@leetcode.com     |</span><br><span class="line">+---------+-----------+-------------------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+---------+-----------+-------------------------+</span><br><span class="line">| user_id | name      | mail                    |</span><br><span class="line">+---------+-----------+-------------------------+</span><br><span class="line">| 1       | Winston   | winston@leetcode.com    |</span><br><span class="line">| 3       | Annabelle | bella-@leetcode.com     |</span><br><span class="line">| 4       | Sally     | sally.come@leetcode.com |</span><br><span class="line">+---------+-----------+-------------------------+</span><br><span class="line">The mail of user 2 doesn&#x27;t have a domain.</span><br><span class="line">The mail of user 5 has # sign which is not allowed.</span><br><span class="line">The mail of user 6 doesn&#x27;t have leetcode domain.</span><br><span class="line">The mail of user 7 starts with a period.</span><br></pre></td></tr></table></figure>

<p>è€ƒå¯Ÿæ­£åˆ™è¡¨è¾¾å¼çš„ä½¿ç”¨</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> Users</span><br><span class="line"><span class="keyword">WHERE</span> mail REGEXP <span class="string">&#x27;^[a-zA-Z]+[\\w_\\.\\-]*@leetcode.com$&#x27;</span>   </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> user_id;</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Users</span><br><span class="line"><span class="keyword">where</span> mail regexp <span class="string">&#x27;^[a-zA-Z]+[a-zA-Z0-9_\\./\\-]&#123;0,&#125;@leetcode.com$&#x27;</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> user_id</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å‘ç‚¹ï¼š<br>1ã€å‰ç¼€å¯èƒ½æ˜¯ä¸€ä¸ªå­—æ¯ï¼Œæ¯”å¦‚â€œ<a href="mailto:&#x4a;&#x40;&#x6c;&#101;&#101;&#x74;&#99;&#111;&#100;&#x65;&#x2e;&#99;&#111;&#109;">&#x4a;&#x40;&#x6c;&#101;&#101;&#x74;&#99;&#111;&#100;&#x65;&#x2e;&#99;&#111;&#109;</a>â€ï¼Œæ‰€ä»¥åŒ¹é…éé¦–å­—æ¯å¤–çš„å‰ç¼€å­—ç¬¦æ•°é‡è¦ç”¨{0,}æˆ–*ï¼Œä¸èƒ½ç”¨+ã€‚<br>2ã€é¢˜æ„è¦æ±‚ï¼šunderscore â€˜â€™, period â€˜.â€™ and/or dash â€˜-â€˜ï¼Œ/æ²¡åŠ å•å¼•å·ï¼Œä¸ç•™ç¥å¯èƒ½å†™æ¼/ã€‚<br>3ã€åç¼€å¯èƒ½æ˜¯â€œ@leetcodeecomâ€ï¼Œæ‰€ä»¥è¦å¯¹â€œ.â€åŠ è½¬ä¹‰ç¬¦å·ã€‚<br>4ã€åç¼€å¯èƒ½æ˜¯â€œ@LEETCODE.COMâ€ï¼Œé»˜è®¤æ˜¯ä¸åŒºåˆ†å¤§å°å†™åŒ¹é…ï¼Œæ‰€ä»¥è¦åŠ ä¸Šâ€œBINARYâ€åŒºåˆ†å¤§å°å†™ã€‚<br>è¯­æ³•ï¼š<br>1ã€<a target="_blank" rel="noopener" href="https://www.cnblogs.com/timssd/p/5882742.html">https://www.cnblogs.com/timssd/p/5882742.html</a><br>2ã€<a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhaopanpan/p/10133224.html">https://www.cnblogs.com/zhaopanpan/p/10133224.html</a><br>3ã€â€åŒåæ–œæ +wâ€è¡¨ç¤ºå­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ï¼Œç›¸å¯¹â€a-zA-Z0-9â€çš„å†™æ³•æ›´ç®€æ´ã€‚</p>
</blockquote>
<h4 id="1527-Patients-With-a-Condition"><a href="#1527-Patients-With-a-Condition" class="headerlink" title="1527. Patients With a Condition"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/patients-with-a-condition/">1527. Patients With a Condition</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>Table: <code>Patients</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| patient_id   | int     |</span><br><span class="line">| patient_name | varchar |</span><br><span class="line">| conditions   | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">patient_id is the primary key for this table.</span><br><span class="line">&#x27;conditions&#x27; contains 0 or more code separated by spaces. </span><br><span class="line">This table contains information of the patients in the hospital.</span><br></pre></td></tr></table></figure>

<p>Write an SQL query to report the patient_id, patient_name all conditions of patients who have Type I Diabetes. Type I Diabetes always starts with <code>DIAB1</code> prefix</p>
<p>Return the result table in any order.</p>
<p>The query result format is in the following example.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Patients</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">| patient_id | patient_name | conditions   |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">| 1          | Daniel       | YFEV COUGH   |</span><br><span class="line">| 2          | Alice        |              |</span><br><span class="line">| 3          | Bob          | DIAB100 MYOP |</span><br><span class="line">| 4          | George       | ACNE DIAB100 |</span><br><span class="line">| 5          | Alain        | DIAB201      |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">| patient_id | patient_name | conditions   |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">| 3          | Bob          | DIAB100 MYOP |</span><br><span class="line">| 4          | George       | ACNE DIAB100 | </span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">Bob and George both have a condition that starts with DIAB1.</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  patient_id , patient_name ,conditions </span><br><span class="line"><span class="keyword">from</span> Patients</span><br><span class="line"><span class="keyword">where</span> conditions <span class="keyword">like</span> <span class="string">&#x27;%DIAB1%&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="1532-The-Most-Recent-Three-Orders"><a href="#1532-The-Most-Recent-Three-Orders" class="headerlink" title="1532. The Most Recent Three Orders"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/the-most-recent-three-orders/">1532. The Most Recent Three Orders</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>Table: <code>Customers</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">customer_id is the primary key for this table.</span><br><span class="line">This table contains information about customers.</span><br></pre></td></tr></table></figure>

<p>Table: <code>Orders</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| order_id      | int     |</span><br><span class="line">| order_date    | date    |</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| cost          | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">order_id is the primary key for this table.</span><br><span class="line">This table contains information about the orders made by customer_id.</span><br><span class="line">Each customer has one order per day.</span><br></pre></td></tr></table></figure>

<p>Write an SQL query to find the most recent 3 orders of each user. If a user ordered less than 3 orders return all of their orders.</p>
<p>Return the result table sorted by <code>customer_name</code> in <strong>ascending</strong> order and in case of a tie by the <code>customer_id</code> in <strong>ascending</strong> order. If there still a tie, order them by the <code>order_date</code> in <strong>descending</strong> order.</p>
<p>The query result format is in the following example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">Customers</span><br><span class="line">+-------------+-----------+</span><br><span class="line">| customer_id | name      |</span><br><span class="line">+-------------+-----------+</span><br><span class="line">| 1           | Winston   |</span><br><span class="line">| 2           | Jonathan  |</span><br><span class="line">| 3           | Annabelle |</span><br><span class="line">| 4           | Marwan    |</span><br><span class="line">| 5           | Khaled    |</span><br><span class="line">+-------------+-----------+</span><br><span class="line"></span><br><span class="line">Orders</span><br><span class="line">+----------+------------+-------------+------+</span><br><span class="line">| order_id | order_date | customer_id | cost |</span><br><span class="line">+----------+------------+-------------+------+</span><br><span class="line">| 1        | 2020-07-31 | 1           | 30   |</span><br><span class="line">| 2        | 2020-07-30 | 2           | 40   |</span><br><span class="line">| 3        | 2020-07-31 | 3           | 70   |</span><br><span class="line">| 4        | 2020-07-29 | 4           | 100  |</span><br><span class="line">| 5        | 2020-06-10 | 1           | 1010 |</span><br><span class="line">| 6        | 2020-08-01 | 2           | 102  |</span><br><span class="line">| 7        | 2020-08-01 | 3           | 111  |</span><br><span class="line">| 8        | 2020-08-03 | 1           | 99   |</span><br><span class="line">| 9        | 2020-08-07 | 2           | 32   |</span><br><span class="line">| 10       | 2020-07-15 | 1           | 2    |</span><br><span class="line">+----------+------------+-------------+------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+---------------+-------------+----------+------------+</span><br><span class="line">| customer_name | customer_id | order_id | order_date |</span><br><span class="line">+---------------+-------------+----------+------------+</span><br><span class="line">| Annabelle     | 3           | 7        | 2020-08-01 |</span><br><span class="line">| Annabelle     | 3           | 3        | 2020-07-31 |</span><br><span class="line">| Jonathan      | 2           | 9        | 2020-08-07 |</span><br><span class="line">| Jonathan      | 2           | 6        | 2020-08-01 |</span><br><span class="line">| Jonathan      | 2           | 2        | 2020-07-30 |</span><br><span class="line">| Marwan        | 4           | 4        | 2020-07-29 |</span><br><span class="line">| Winston       | 1           | 8        | 2020-08-03 |</span><br><span class="line">| Winston       | 1           | 1        | 2020-07-31 |</span><br><span class="line">| Winston       | 1           | 10       | 2020-07-15 |</span><br><span class="line">+---------------+-------------+----------+------------+</span><br><span class="line">Winston has 4 orders, we discard the order of &quot;2020-06-10&quot; because it is the oldest order.</span><br><span class="line">Annabelle has only 2 orders, we return them.</span><br><span class="line">Jonathan has exactly 3 orders.</span><br><span class="line">Marwan ordered only one time.</span><br><span class="line">We sort the result table by customer_name in ascending order, by customer_id in ascending order and by order_date in descending order in case of a tie.</span><br></pre></td></tr></table></figure>

<p><strong>Follow-up:</strong><br>Can you write a general solution for the most recent <code>n</code> orders?</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name customer_name ,customer_id,order_id,order_date</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span>  name ,o.customer_id,order_id,order_date ,<span class="built_in">rank</span>()<span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> o.customer_id <span class="keyword">order</span> <span class="keyword">by</span> order_date <span class="keyword">desc</span>) rk</span><br><span class="line"><span class="keyword">from</span> Orders o <span class="keyword">left</span> <span class="keyword">join</span> Customers c</span><br><span class="line"><span class="keyword">on</span> o.customer_id<span class="operator">=</span>c.customer_id</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> rk <span class="operator">&lt;=</span><span class="number">3</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> customer_name ,customer_id,order_date <span class="keyword">desc</span></span><br></pre></td></tr></table></figure>

<h4 id="1543-Fix-Product-Name-Format"><a href="#1543-Fix-Product-Name-Format" class="headerlink" title="1543. Fix Product Name Format"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/fix-product-name-format/">1543. Fix Product Name Format</a></h4><p>éš¾åº¦ç®€å•</p>
<p>SQLæ¶æ„</p>
<p>Table: <code>Sales</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| sale_id      | int     |</span><br><span class="line">| product_name | varchar |</span><br><span class="line">| sale_date    | date    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">sale_id is the primary key for this table.</span><br><span class="line">Each row of this table contains the product name and the date it was sold.</span><br></pre></td></tr></table></figure>

<p>Since table Sales was filled manually in the year 2000, <code>product_name</code> may contain leading and/or trailing white spaces, also they are case-insensitive.</p>
<p>Write an SQL query to report</p>
<ul>
<li><code>product_name</code> in lowercase without leading or trailing white spaces.</li>
<li><code>sale_date</code> in the format <code>(&#39;YYYY-MM&#39;)</code> </li>
<li><code>total</code> the number of times the product was sold in this month.</li>
</ul>
<p>Return the result table ordered by <code>product_name</code> in <strong>ascending order</strong>, in case of a tie order it by <code>sale_date</code> in <strong>ascending order</strong>.</p>
<p>The query result format is in the following example.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Sales</span><br><span class="line">+------------+------------------+--------------+</span><br><span class="line">| sale_id    | product_name     | sale_date    |</span><br><span class="line">+------------+------------------+--------------+</span><br><span class="line">| 1          |      LCPHONE     | 2000-01-16   |</span><br><span class="line">| 2          |    LCPhone       | 2000-01-17   |</span><br><span class="line">| 3          |     LcPhOnE      | 2000-02-18   |</span><br><span class="line">| 4          |      LCKeyCHAiN  | 2000-02-19   |</span><br><span class="line">| 5          |   LCKeyChain     | 2000-02-28   |</span><br><span class="line">| 6          | Matryoshka       | 2000-03-31   | </span><br><span class="line">+------------+------------------+--------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+--------------+--------------+----------+</span><br><span class="line">| product_name | sale_date    | total    |</span><br><span class="line">+--------------+--------------+----------+</span><br><span class="line">| lcphone      | 2000-01      | 2        |</span><br><span class="line">| lckeychain   | 2000-02      | 2        | </span><br><span class="line">| lcphone      | 2000-02      | 1        | </span><br><span class="line">| matryoshka   | 2000-03      | 1        | </span><br><span class="line">+--------------+--------------+----------+</span><br><span class="line"></span><br><span class="line">In January, 2 LcPhones were sold, please note that the product names are not case sensitive and may contain spaces.</span><br><span class="line">In Februery, 2 LCKeychains and 1 LCPhone were sold.</span><br><span class="line">In March, 1 matryoshka was sold.</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">trim</span>(<span class="built_in">lower</span>(product_name)) <span class="keyword">as</span> product_name, </span><br><span class="line">        date_format(sale_date,<span class="string">&#x27;%Y-%m&#x27;</span>) <span class="keyword">as</span> sale_date,</span><br><span class="line">        <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> total </span><br><span class="line"><span class="keyword">from</span> Sales </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="built_in">trim</span>(<span class="built_in">lower</span>(product_name)), date_format(sale_date,<span class="string">&#x27;%Y-%m&#x27;</span>) </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> product_name <span class="keyword">asc</span>, sale_date <span class="keyword">asc</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„å¤§å°å†™ã€ç©ºæ ¼ </p>
</blockquote>
<h4 id="1549-The-Most-Recent-Orders-for-Each-Product"><a href="#1549-The-Most-Recent-Orders-for-Each-Product" class="headerlink" title="1549. The Most Recent Orders for Each Product"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/the-most-recent-orders-for-each-product/">1549. The Most Recent Orders for Each Product</a></h4><p>éš¾åº¦ä¸­ç­‰</p>
<p>SQLæ¶æ„</p>
<p>Table: <code>Customers</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">customer_id is the primary key for this table.</span><br><span class="line">This table contains information about the customers.</span><br></pre></td></tr></table></figure>

<p>Table: <code>Orders</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| order_id      | int     |</span><br><span class="line">| order_date    | date    |</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| product_id    | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">order_id is the primary key for this table.</span><br><span class="line">This table contains information about the orders made by customer_id.</span><br><span class="line">There will be no product ordered by the same user more than once in one day.</span><br></pre></td></tr></table></figure>

<p>Table: <code>Products</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| product_name  | varchar |</span><br><span class="line">| price         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">product_id is the primary key for this table.</span><br><span class="line">This table contains information about the Products.</span><br></pre></td></tr></table></figure>

<p>Write an SQL query to find the most recent order(s) of each product.</p>
<p>Return the result table sorted by <code>product_name</code> in <strong>ascending</strong> order and in case of a tie by the <code>product_id</code> in <strong>ascending</strong> order. If there still a tie, order them by the <code>order_id</code> in <strong>ascending</strong> order.</p>
<p>The query result format is in the following example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">Customers</span><br><span class="line">+-------------+-----------+</span><br><span class="line">| customer_id | name      |</span><br><span class="line">+-------------+-----------+</span><br><span class="line">| 1           | Winston   |</span><br><span class="line">| 2           | Jonathan  |</span><br><span class="line">| 3           | Annabelle |</span><br><span class="line">| 4           | Marwan    |</span><br><span class="line">| 5           | Khaled    |</span><br><span class="line">+-------------+-----------+</span><br><span class="line"></span><br><span class="line">Orders</span><br><span class="line">+----------+------------+-------------+------------+</span><br><span class="line">| order_id | order_date | customer_id | product_id |</span><br><span class="line">+----------+------------+-------------+------------+</span><br><span class="line">| 1        | 2020-07-31 | 1           | 1          |</span><br><span class="line">| 2        | 2020-07-30 | 2           | 2          |</span><br><span class="line">| 3        | 2020-08-29 | 3           | 3          |</span><br><span class="line">| 4        | 2020-07-29 | 4           | 1          |</span><br><span class="line">| 5        | 2020-06-10 | 1           | 2          |</span><br><span class="line">| 6        | 2020-08-01 | 2           | 1          |</span><br><span class="line">| 7        | 2020-08-01 | 3           | 1          |</span><br><span class="line">| 8        | 2020-08-03 | 1           | 2          |</span><br><span class="line">| 9        | 2020-08-07 | 2           | 3          |</span><br><span class="line">| 10       | 2020-07-15 | 1           | 2          |</span><br><span class="line">+----------+------------+-------------+------------+</span><br><span class="line"></span><br><span class="line">Products</span><br><span class="line">+------------+--------------+-------+</span><br><span class="line">| product_id | product_name | price |</span><br><span class="line">+------------+--------------+-------+</span><br><span class="line">| 1          | keyboard     | 120   |</span><br><span class="line">| 2          | mouse        | 80    |</span><br><span class="line">| 3          | screen       | 600   |</span><br><span class="line">| 4          | hard disk    | 450   |</span><br><span class="line">+------------+--------------+-------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+--------------+------------+----------+------------+</span><br><span class="line">| product_name | product_id | order_id | order_date |</span><br><span class="line">+--------------+------------+----------+------------+</span><br><span class="line">| keyboard     | 1          | 6        | 2020-08-01 |</span><br><span class="line">| keyboard     | 1          | 7        | 2020-08-01 |</span><br><span class="line">| mouse        | 2          | 8        | 2020-08-03 |</span><br><span class="line">| screen       | 3          | 3        | 2020-08-29 |</span><br><span class="line">+--------------+------------+----------+------------+</span><br><span class="line">keyboard&#x27;s most recent order is in 2020-08-01, it was ordered two times this day.</span><br><span class="line">mouse&#x27;s most recent order is in 2020-08-03, it was ordered only once this day.</span><br><span class="line">screen&#x27;s most recent order is in 2020-08-29, it was ordered only once this day.</span><br><span class="line">The hard disk was never ordered and we don&#x27;t include it in the result table.</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> product_name,product_id,order_id,order_date</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> product_name ,o.product_id ,order_id,order_date ,</span><br><span class="line">    <span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> o.product_id <span class="keyword">order</span> <span class="keyword">by</span> order_date <span class="keyword">desc</span>) rk</span><br><span class="line"><span class="keyword">from</span> Orders o <span class="keyword">left</span> <span class="keyword">join</span> Products p</span><br><span class="line"><span class="keyword">on</span> o.product_id <span class="operator">=</span>p.product_id </span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> rk <span class="operator">=</span><span class="number">1</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> product_name,product_id,order_id</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:qjzxzxd@gmail.com">MiChong</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://www.buildworld.cn/2021/02/09/LeetCode%E6%95%B0%E6%8D%AE%E5%BA%93%E9%A2%98%E7%9B%AE%E9%9B%86%E5%90%88/">https://www.buildworld.cn/2021/02/09/LeetCode%E6%95%B0%E6%8D%AE%E5%BA%93%E9%A2%98%E7%9B%AE%E9%9B%86%E5%90%88/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://www.buildworld.cn" target="_blank">MiChongçš„ğŸ¡</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/LeetCode/">LeetCode</a><a class="post-meta__tags" href="/tags/%E7%AC%94%E8%AF%95%E9%A2%98/">ç¬”è¯•é¢˜</a></div><div class="post_share"><div class="social-share" data-image="https://file.buildworld.cn/img/20210209161641.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/07/09/14%E7%A7%8D%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AE%97%E6%B3%95%E6%A8%A1%E5%BC%8F/"><img class="prev-cover" src="https://file.buildworld.cn/img/20210709115216.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">14ç§å¸¸è§çš„ç®—æ³•æ¨¡å¼</div></div></a></div><div class="next-post pull-right"><a href="/2021/01/07/BigData-%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E5%AD%A6%E4%B9%A0/"><img class="next-cover" src="https://file.buildworld.cn/img/20210107194133.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">BigData-æ•°æ®ä»“åº“å­¦ä¹ </div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/header.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">MiChong</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">78</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">74</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">21</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/MiChongGET"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="/qjzxzxd@gmail.com" target="_blank" title=""><i class="fa fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>å…¬å‘Š</span></div><div class="announcement_content">æ¬¢è¿æ¥åˆ°ç±³è™«çš„å°ç«™ï¼Œä¸€èµ·åŠ æ²¹ğŸ¤</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#175-%E7%BB%84%E5%90%88%E4%B8%A4%E4%B8%AA%E8%A1%A8"><span class="toc-number">1.</span> <span class="toc-text">175. ç»„åˆä¸¤ä¸ªè¡¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#176-%E7%AC%AC%E4%BA%8C%E9%AB%98%E7%9A%84%E8%96%AA%E6%B0%B4"><span class="toc-number">2.</span> <span class="toc-text">176. ç¬¬äºŒé«˜çš„è–ªæ°´</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#177-%E7%AC%ACN%E9%AB%98%E7%9A%84%E8%96%AA%E6%B0%B4"><span class="toc-number">3.</span> <span class="toc-text">177. ç¬¬Né«˜çš„è–ªæ°´</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#178-%E5%88%86%E6%95%B0%E6%8E%92%E5%90%8D"><span class="toc-number">4.</span> <span class="toc-text">178. åˆ†æ•°æ’å</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#180-%E8%BF%9E%E7%BB%AD%E5%87%BA%E7%8E%B0%E7%9A%84%E6%95%B0%E5%AD%97"><span class="toc-number">5.</span> <span class="toc-text">180. è¿ç»­å‡ºç°çš„æ•°å­—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#181-%E8%B6%85%E8%BF%87%E7%BB%8F%E7%90%86%E6%94%B6%E5%85%A5%E7%9A%84%E5%91%98%E5%B7%A5"><span class="toc-number">6.</span> <span class="toc-text">181. è¶…è¿‡ç»ç†æ”¶å…¥çš„å‘˜å·¥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#182-%E6%9F%A5%E6%89%BE%E9%87%8D%E5%A4%8D%E7%9A%84%E7%94%B5%E5%AD%90%E9%82%AE%E7%AE%B1"><span class="toc-number">7.</span> <span class="toc-text">182. æŸ¥æ‰¾é‡å¤çš„ç”µå­é‚®ç®±</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#183-%E4%BB%8E%E4%B8%8D%E8%AE%A2%E8%B4%AD%E7%9A%84%E5%AE%A2%E6%88%B7"><span class="toc-number">8.</span> <span class="toc-text">183. ä»ä¸è®¢è´­çš„å®¢æˆ·</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#184-%E9%83%A8%E9%97%A8%E5%B7%A5%E8%B5%84%E6%9C%80%E9%AB%98%E7%9A%84%E5%91%98%E5%B7%A5"><span class="toc-number">9.</span> <span class="toc-text">184. éƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#185-%E9%83%A8%E9%97%A8%E5%B7%A5%E8%B5%84%E5%89%8D%E4%B8%89%E9%AB%98%E7%9A%84%E6%89%80%E6%9C%89%E5%91%98%E5%B7%A5"><span class="toc-number">10.</span> <span class="toc-text">185. éƒ¨é—¨å·¥èµ„å‰ä¸‰é«˜çš„æ‰€æœ‰å‘˜å·¥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#196-%E5%88%A0%E9%99%A4%E9%87%8D%E5%A4%8D%E7%9A%84%E7%94%B5%E5%AD%90%E9%82%AE%E7%AE%B1"><span class="toc-number">11.</span> <span class="toc-text">196. åˆ é™¤é‡å¤çš„ç”µå­é‚®ç®±</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#197-%E4%B8%8A%E5%8D%87%E7%9A%84%E6%B8%A9%E5%BA%A6"><span class="toc-number">12.</span> <span class="toc-text">197. ä¸Šå‡çš„æ¸©åº¦</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#262-%E8%A1%8C%E7%A8%8B%E5%92%8C%E7%94%A8%E6%88%B7"><span class="toc-number">13.</span> <span class="toc-text">262. è¡Œç¨‹å’Œç”¨æˆ·</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#511-%E6%B8%B8%E6%88%8F%E7%8E%A9%E6%B3%95%E5%88%86%E6%9E%90-I"><span class="toc-number">14.</span> <span class="toc-text">511. æ¸¸æˆç©æ³•åˆ†æ I</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#512-%E6%B8%B8%E6%88%8F%E7%8E%A9%E6%B3%95%E5%88%86%E6%9E%90-II"><span class="toc-number">15.</span> <span class="toc-text">512. æ¸¸æˆç©æ³•åˆ†æ II</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#534-%E6%B8%B8%E6%88%8F%E7%8E%A9%E6%B3%95%E5%88%86%E6%9E%90-III"><span class="toc-number">16.</span> <span class="toc-text">534. æ¸¸æˆç©æ³•åˆ†æ III</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#550-%E6%B8%B8%E6%88%8F%E7%8E%A9%E6%B3%95%E5%88%86%E6%9E%90-IV"><span class="toc-number">17.</span> <span class="toc-text">550. æ¸¸æˆç©æ³•åˆ†æ IV</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#569-%E5%91%98%E5%B7%A5%E8%96%AA%E6%B0%B4%E4%B8%AD%E4%BD%8D%E6%95%B0"><span class="toc-number">18.</span> <span class="toc-text">569. å‘˜å·¥è–ªæ°´ä¸­ä½æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#570-%E8%87%B3%E5%B0%91%E6%9C%895%E5%90%8D%E7%9B%B4%E6%8E%A5%E4%B8%8B%E5%B1%9E%E7%9A%84%E7%BB%8F%E7%90%86"><span class="toc-number">19.</span> <span class="toc-text">570. è‡³å°‘æœ‰5åç›´æ¥ä¸‹å±çš„ç»ç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#571-%E7%BB%99%E5%AE%9A%E6%95%B0%E5%AD%97%E7%9A%84%E9%A2%91%E7%8E%87%E6%9F%A5%E8%AF%A2%E4%B8%AD%E4%BD%8D%E6%95%B0"><span class="toc-number">20.</span> <span class="toc-text">571. ç»™å®šæ•°å­—çš„é¢‘ç‡æŸ¥è¯¢ä¸­ä½æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#574-%E5%BD%93%E9%80%89%E8%80%85"><span class="toc-number">21.</span> <span class="toc-text">574. å½“é€‰è€…</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#577-%E5%91%98%E5%B7%A5%E5%A5%96%E9%87%91"><span class="toc-number">22.</span> <span class="toc-text">577. å‘˜å·¥å¥–é‡‘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#578-%E6%9F%A5%E8%AF%A2%E5%9B%9E%E7%AD%94%E7%8E%87%E6%9C%80%E9%AB%98%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">23.</span> <span class="toc-text">578. æŸ¥è¯¢å›ç­”ç‡æœ€é«˜çš„é—®é¢˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#579-%E6%9F%A5%E8%AF%A2%E5%91%98%E5%B7%A5%E7%9A%84%E7%B4%AF%E8%AE%A1%E8%96%AA%E6%B0%B4"><span class="toc-number">24.</span> <span class="toc-text">579. æŸ¥è¯¢å‘˜å·¥çš„ç´¯è®¡è–ªæ°´</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#580-%E7%BB%9F%E8%AE%A1%E5%90%84%E4%B8%93%E4%B8%9A%E5%AD%A6%E7%94%9F%E4%BA%BA%E6%95%B0"><span class="toc-number">25.</span> <span class="toc-text">580. ç»Ÿè®¡å„ä¸“ä¸šå­¦ç”Ÿäººæ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#584-%E5%AF%BB%E6%89%BE%E7%94%A8%E6%88%B7%E6%8E%A8%E8%8D%90%E4%BA%BA"><span class="toc-number">26.</span> <span class="toc-text">584. å¯»æ‰¾ç”¨æˆ·æ¨èäºº</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#585-2016%E5%B9%B4%E7%9A%84%E6%8A%95%E8%B5%84"><span class="toc-number">27.</span> <span class="toc-text">585. 2016å¹´çš„æŠ•èµ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#586-%E8%AE%A2%E5%8D%95%E6%9C%80%E5%A4%9A%E7%9A%84%E5%AE%A2%E6%88%B7"><span class="toc-number">28.</span> <span class="toc-text">586. è®¢å•æœ€å¤šçš„å®¢æˆ·</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#595-%E5%A4%A7%E7%9A%84%E5%9B%BD%E5%AE%B6"><span class="toc-number">29.</span> <span class="toc-text">595. å¤§çš„å›½å®¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#596-%E8%B6%85%E8%BF%875%E5%90%8D%E5%AD%A6%E7%94%9F%E7%9A%84%E8%AF%BE"><span class="toc-number">30.</span> <span class="toc-text">596. è¶…è¿‡5åå­¦ç”Ÿçš„è¯¾</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#597-%E5%A5%BD%E5%8F%8B%E7%94%B3%E8%AF%B7-I-%EF%BC%9A%E6%80%BB%E4%BD%93%E9%80%9A%E8%BF%87%E7%8E%87"><span class="toc-number">31.</span> <span class="toc-text">597. å¥½å‹ç”³è¯· I ï¼šæ€»ä½“é€šè¿‡ç‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#601-%E4%BD%93%E8%82%B2%E9%A6%86%E7%9A%84%E4%BA%BA%E6%B5%81%E9%87%8F"><span class="toc-number">32.</span> <span class="toc-text">601. ä½“è‚²é¦†çš„äººæµé‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#602-%E5%A5%BD%E5%8F%8B%E7%94%B3%E8%AF%B7-II-%EF%BC%9A%E8%B0%81%E6%9C%89%E6%9C%80%E5%A4%9A%E7%9A%84%E5%A5%BD%E5%8F%8B"><span class="toc-number">33.</span> <span class="toc-text">602. å¥½å‹ç”³è¯· II ï¼šè°æœ‰æœ€å¤šçš„å¥½å‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#603-%E8%BF%9E%E7%BB%AD%E7%A9%BA%E4%BD%99%E5%BA%A7%E4%BD%8D"><span class="toc-number">34.</span> <span class="toc-text">603. è¿ç»­ç©ºä½™åº§ä½</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#607-%E9%94%80%E5%94%AE%E5%91%98"><span class="toc-number">35.</span> <span class="toc-text">607. é”€å”®å‘˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#608-%E6%A0%91%E8%8A%82%E7%82%B9"><span class="toc-number">36.</span> <span class="toc-text">608. æ ‘èŠ‚ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#610-%E5%88%A4%E6%96%AD%E4%B8%89%E8%A7%92%E5%BD%A2"><span class="toc-number">37.</span> <span class="toc-text">610. åˆ¤æ–­ä¸‰è§’å½¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#612-%E5%B9%B3%E9%9D%A2%E4%B8%8A%E7%9A%84%E6%9C%80%E8%BF%91%E8%B7%9D%E7%A6%BB"><span class="toc-number">38.</span> <span class="toc-text">612. å¹³é¢ä¸Šçš„æœ€è¿‘è·ç¦»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#613-%E7%9B%B4%E7%BA%BF%E4%B8%8A%E7%9A%84%E6%9C%80%E8%BF%91%E8%B7%9D%E7%A6%BB"><span class="toc-number">39.</span> <span class="toc-text">613. ç›´çº¿ä¸Šçš„æœ€è¿‘è·ç¦»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#614-%E4%BA%8C%E7%BA%A7%E5%85%B3%E6%B3%A8%E8%80%85"><span class="toc-number">40.</span> <span class="toc-text">614. äºŒçº§å…³æ³¨è€…</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#615-%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84%EF%BC%9A%E9%83%A8%E9%97%A8%E4%B8%8E%E5%85%AC%E5%8F%B8%E6%AF%94%E8%BE%83"><span class="toc-number">41.</span> <span class="toc-text">615. å¹³å‡å·¥èµ„ï¼šéƒ¨é—¨ä¸å…¬å¸æ¯”è¾ƒ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#618-%E5%AD%A6%E7%94%9F%E5%9C%B0%E7%90%86%E4%BF%A1%E6%81%AF%E6%8A%A5%E5%91%8A"><span class="toc-number">42.</span> <span class="toc-text">618. å­¦ç”Ÿåœ°ç†ä¿¡æ¯æŠ¥å‘Š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#619-%E5%8F%AA%E5%87%BA%E7%8E%B0%E4%B8%80%E6%AC%A1%E7%9A%84%E6%9C%80%E5%A4%A7%E6%95%B0%E5%AD%97"><span class="toc-number">43.</span> <span class="toc-text">619. åªå‡ºç°ä¸€æ¬¡çš„æœ€å¤§æ•°å­—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#620-%E6%9C%89%E8%B6%A3%E7%9A%84%E7%94%B5%E5%BD%B1"><span class="toc-number">44.</span> <span class="toc-text">620. æœ‰è¶£çš„ç”µå½±</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#626-%E6%8D%A2%E5%BA%A7%E4%BD%8D"><span class="toc-number">45.</span> <span class="toc-text">626. æ¢åº§ä½</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#627-%E4%BA%A4%E6%8D%A2%E5%B7%A5%E8%B5%84"><span class="toc-number">46.</span> <span class="toc-text">627. äº¤æ¢å·¥èµ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1045-%E4%B9%B0%E4%B8%8B%E6%89%80%E6%9C%89%E4%BA%A7%E5%93%81%E7%9A%84%E5%AE%A2%E6%88%B7"><span class="toc-number">47.</span> <span class="toc-text">1045. ä¹°ä¸‹æ‰€æœ‰äº§å“çš„å®¢æˆ·</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1050-%E5%90%88%E4%BD%9C%E8%BF%87%E8%87%B3%E5%B0%91%E4%B8%89%E6%AC%A1%E7%9A%84%E6%BC%94%E5%91%98%E5%92%8C%E5%AF%BC%E6%BC%94"><span class="toc-number">48.</span> <span class="toc-text">1050. åˆä½œè¿‡è‡³å°‘ä¸‰æ¬¡çš„æ¼”å‘˜å’Œå¯¼æ¼”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1068-%E4%BA%A7%E5%93%81%E9%94%80%E5%94%AE%E5%88%86%E6%9E%90-I"><span class="toc-number">49.</span> <span class="toc-text">1068. äº§å“é”€å”®åˆ†æ I</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1069-%E4%BA%A7%E5%93%81%E9%94%80%E5%94%AE%E5%88%86%E6%9E%90-II"><span class="toc-number">50.</span> <span class="toc-text">1069. äº§å“é”€å”®åˆ†æ II</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1070-%E4%BA%A7%E5%93%81%E9%94%80%E5%94%AE%E5%88%86%E6%9E%90-III"><span class="toc-number">51.</span> <span class="toc-text">1070. äº§å“é”€å”®åˆ†æ III</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1075-%E9%A1%B9%E7%9B%AE%E5%91%98%E5%B7%A5-I"><span class="toc-number">52.</span> <span class="toc-text">1075. é¡¹ç›®å‘˜å·¥ I</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1076-%E9%A1%B9%E7%9B%AE%E5%91%98%E5%B7%A5II"><span class="toc-number">53.</span> <span class="toc-text">1076. é¡¹ç›®å‘˜å·¥II</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1077-%E9%A1%B9%E7%9B%AE%E5%91%98%E5%B7%A5-III"><span class="toc-number">54.</span> <span class="toc-text">1077. é¡¹ç›®å‘˜å·¥ III</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1082-%E9%94%80%E5%94%AE%E5%88%86%E6%9E%90-I"><span class="toc-number">55.</span> <span class="toc-text">1082. é”€å”®åˆ†æ I </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1083-%E9%94%80%E5%94%AE%E5%88%86%E6%9E%90-II"><span class="toc-number">56.</span> <span class="toc-text">1083. é”€å”®åˆ†æ II</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1084-%E9%94%80%E5%94%AE%E5%88%86%E6%9E%90III"><span class="toc-number">57.</span> <span class="toc-text">1084. é”€å”®åˆ†æIII</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1097-%E6%B8%B8%E6%88%8F%E7%8E%A9%E6%B3%95%E5%88%86%E6%9E%90-V"><span class="toc-number">58.</span> <span class="toc-text">1097. æ¸¸æˆç©æ³•åˆ†æ V</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1098-%E5%B0%8F%E4%BC%97%E4%B9%A6%E7%B1%8D"><span class="toc-number">59.</span> <span class="toc-text">1098. å°ä¼—ä¹¦ç±</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1107-%E6%AF%8F%E6%97%A5%E6%96%B0%E7%94%A8%E6%88%B7%E7%BB%9F%E8%AE%A1"><span class="toc-number">60.</span> <span class="toc-text">1107. æ¯æ—¥æ–°ç”¨æˆ·ç»Ÿè®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1112-%E6%AF%8F%E4%BD%8D%E5%AD%A6%E7%94%9F%E7%9A%84%E6%9C%80%E9%AB%98%E6%88%90%E7%BB%A9"><span class="toc-number">61.</span> <span class="toc-text">1112. æ¯ä½å­¦ç”Ÿçš„æœ€é«˜æˆç»©</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1113-%E6%8A%A5%E5%91%8A%E7%9A%84%E8%AE%B0%E5%BD%95"><span class="toc-number">62.</span> <span class="toc-text">1113. æŠ¥å‘Šçš„è®°å½•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1132-%E6%8A%A5%E5%91%8A%E7%9A%84%E8%AE%B0%E5%BD%95-II"><span class="toc-number">63.</span> <span class="toc-text">1132. æŠ¥å‘Šçš„è®°å½• II</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1126-%E6%9F%A5%E8%AF%A2%E6%B4%BB%E8%B7%83%E4%B8%9A%E5%8A%A1"><span class="toc-number">64.</span> <span class="toc-text">1126. æŸ¥è¯¢æ´»è·ƒä¸šåŠ¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1127-%E7%94%A8%E6%88%B7%E8%B4%AD%E4%B9%B0%E5%B9%B3%E5%8F%B0"><span class="toc-number">65.</span> <span class="toc-text">1127. ç”¨æˆ·è´­ä¹°å¹³å°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1141-%E6%9F%A5%E8%AF%A2%E8%BF%9130%E5%A4%A9%E6%B4%BB%E8%B7%83%E7%94%A8%E6%88%B7%E6%95%B0"><span class="toc-number">66.</span> <span class="toc-text">1141. æŸ¥è¯¢è¿‘30å¤©æ´»è·ƒç”¨æˆ·æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1142-%E8%BF%87%E5%8E%BB30%E5%A4%A9%E7%9A%84%E7%94%A8%E6%88%B7%E6%B4%BB%E5%8A%A8-II"><span class="toc-number">67.</span> <span class="toc-text">1142. è¿‡å»30å¤©çš„ç”¨æˆ·æ´»åŠ¨ II</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1148-%E6%96%87%E7%AB%A0%E6%B5%8F%E8%A7%88-I"><span class="toc-number">68.</span> <span class="toc-text">1148. æ–‡ç« æµè§ˆ I</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1149-%E6%96%87%E7%AB%A0%E6%B5%8F%E8%A7%88-II"><span class="toc-number">69.</span> <span class="toc-text">1149. æ–‡ç« æµè§ˆ II</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1158-%E5%B8%82%E5%9C%BA%E5%88%86%E6%9E%90-I"><span class="toc-number">70.</span> <span class="toc-text">1158. å¸‚åœºåˆ†æ I</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1159-%E5%B8%82%E5%9C%BA%E5%88%86%E6%9E%90-II"><span class="toc-number">71.</span> <span class="toc-text">1159. å¸‚åœºåˆ†æ II</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1164-%E6%8C%87%E5%AE%9A%E6%97%A5%E6%9C%9F%E7%9A%84%E4%BA%A7%E5%93%81%E4%BB%B7%E6%A0%BC"><span class="toc-number">72.</span> <span class="toc-text">1164. æŒ‡å®šæ—¥æœŸçš„äº§å“ä»·æ ¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1173-%E5%8D%B3%E6%97%B6%E9%A3%9F%E7%89%A9%E9%85%8D%E9%80%81-I"><span class="toc-number">73.</span> <span class="toc-text">1173. å³æ—¶é£Ÿç‰©é…é€ I</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1174-%E5%8D%B3%E6%97%B6%E9%A3%9F%E7%89%A9%E9%85%8D%E9%80%81-II"><span class="toc-number">74.</span> <span class="toc-text">1174. å³æ—¶é£Ÿç‰©é…é€ II</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1179-%E9%87%8D%E6%96%B0%E6%A0%BC%E5%BC%8F%E5%8C%96%E9%83%A8%E9%97%A8%E8%A1%A8"><span class="toc-number">75.</span> <span class="toc-text">1179. é‡æ–°æ ¼å¼åŒ–éƒ¨é—¨è¡¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1193-%E6%AF%8F%E6%9C%88%E4%BA%A4%E6%98%93-I"><span class="toc-number">76.</span> <span class="toc-text">1193. æ¯æœˆäº¤æ˜“ I</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1205-%E6%AF%8F%E6%9C%88%E4%BA%A4%E6%98%93II"><span class="toc-number">77.</span> <span class="toc-text">1205. æ¯æœˆäº¤æ˜“II</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1194-%E9%94%A6%E6%A0%87%E8%B5%9B%E4%BC%98%E8%83%9C%E8%80%85"><span class="toc-number">78.</span> <span class="toc-text">1194. é”¦æ ‡èµ›ä¼˜èƒœè€…</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1204-%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E8%83%BD%E8%BF%9B%E5%85%A5%E7%94%B5%E6%A2%AF%E7%9A%84%E4%BA%BA"><span class="toc-number">79.</span> <span class="toc-text">1204. æœ€åä¸€ä¸ªèƒ½è¿›å…¥ç”µæ¢¯çš„äºº</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1211-%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E7%9A%84%E8%B4%A8%E9%87%8F%E5%92%8C%E5%8D%A0%E6%AF%94"><span class="toc-number">80.</span> <span class="toc-text">1211. æŸ¥è¯¢ç»“æœçš„è´¨é‡å’Œå æ¯”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1212-%E6%9F%A5%E8%AF%A2%E7%90%83%E9%98%9F%E7%A7%AF%E5%88%86"><span class="toc-number">81.</span> <span class="toc-text">1212. æŸ¥è¯¢çƒé˜Ÿç§¯åˆ†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1225-%E6%8A%A5%E5%91%8A%E7%B3%BB%E7%BB%9F%E7%8A%B6%E6%80%81%E7%9A%84%E8%BF%9E%E7%BB%AD%E6%97%A5%E6%9C%9F"><span class="toc-number">82.</span> <span class="toc-text">1225. æŠ¥å‘Šç³»ç»ŸçŠ¶æ€çš„è¿ç»­æ—¥æœŸ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1241-%E6%AF%8F%E4%B8%AA%E5%B8%96%E5%AD%90%E7%9A%84%E8%AF%84%E8%AE%BA%E6%95%B0"><span class="toc-number">83.</span> <span class="toc-text">1241. æ¯ä¸ªå¸–å­çš„è¯„è®ºæ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1251-%E5%B9%B3%E5%9D%87%E5%94%AE%E4%BB%B7"><span class="toc-number">84.</span> <span class="toc-text">1251. å¹³å‡å”®ä»·</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1264-%E9%A1%B5%E9%9D%A2%E6%8E%A8%E8%8D%90"><span class="toc-number">85.</span> <span class="toc-text">1264. é¡µé¢æ¨è</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1270-%E5%90%91%E5%85%AC%E5%8F%B8CEO%E6%B1%87%E6%8A%A5%E5%B7%A5%E4%BD%9C%E7%9A%84%E6%89%80%E6%9C%89%E4%BA%BA"><span class="toc-number">86.</span> <span class="toc-text">1270. å‘å…¬å¸CEOæ±‡æŠ¥å·¥ä½œçš„æ‰€æœ‰äºº</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1280-%E5%AD%A6%E7%94%9F%E4%BB%AC%E5%8F%82%E5%8A%A0%E5%90%84%E7%A7%91%E6%B5%8B%E8%AF%95%E7%9A%84%E6%AC%A1%E6%95%B0"><span class="toc-number">87.</span> <span class="toc-text">1280. å­¦ç”Ÿä»¬å‚åŠ å„ç§‘æµ‹è¯•çš„æ¬¡æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1285-%E6%89%BE%E5%88%B0%E8%BF%9E%E7%BB%AD%E5%8C%BA%E9%97%B4%E7%9A%84%E5%BC%80%E5%A7%8B%E5%92%8C%E7%BB%93%E6%9D%9F%E6%95%B0%E5%AD%97"><span class="toc-number">88.</span> <span class="toc-text">1285. æ‰¾åˆ°è¿ç»­åŒºé—´çš„å¼€å§‹å’Œç»“æŸæ•°å­—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1294-%E4%B8%8D%E5%90%8C%E5%9B%BD%E5%AE%B6%E7%9A%84%E5%A4%A9%E6%B0%94%E7%B1%BB%E5%9E%8B"><span class="toc-number">89.</span> <span class="toc-text">1294. ä¸åŒå›½å®¶çš„å¤©æ°”ç±»å‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1303-%E6%B1%82%E5%9B%A2%E9%98%9F%E4%BA%BA%E6%95%B0"><span class="toc-number">90.</span> <span class="toc-text">1303. æ±‚å›¢é˜Ÿäººæ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1308-%E4%B8%8D%E5%90%8C%E6%80%A7%E5%88%AB%E6%AF%8F%E6%97%A5%E5%88%86%E6%95%B0%E6%80%BB%E8%AE%A1"><span class="toc-number">91.</span> <span class="toc-text">1308. ä¸åŒæ€§åˆ«æ¯æ—¥åˆ†æ•°æ€»è®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1321-%E9%A4%90%E9%A6%86%E8%90%A5%E4%B8%9A%E9%A2%9D%E5%8F%98%E5%8C%96%E5%A2%9E%E9%95%BF"><span class="toc-number">92.</span> <span class="toc-text">1321. é¤é¦†è¥ä¸šé¢å˜åŒ–å¢é•¿</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1322-%E5%B9%BF%E5%91%8A%E6%95%88%E6%9E%9C"><span class="toc-number">93.</span> <span class="toc-text">1322. å¹¿å‘Šæ•ˆæœ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1327-%E5%88%97%E5%87%BA%E6%8C%87%E5%AE%9A%E6%97%B6%E9%97%B4%E6%AE%B5%E5%86%85%E6%89%80%E6%9C%89%E7%9A%84%E4%B8%8B%E5%8D%95%E4%BA%A7%E5%93%81"><span class="toc-number">94.</span> <span class="toc-text">1327. åˆ—å‡ºæŒ‡å®šæ—¶é—´æ®µå†…æ‰€æœ‰çš„ä¸‹å•äº§å“</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1336-%E6%AF%8F%E6%AC%A1%E8%AE%BF%E9%97%AE%E7%9A%84%E4%BA%A4%E6%98%93%E6%AC%A1%E6%95%B0"><span class="toc-number">95.</span> <span class="toc-text">1336. æ¯æ¬¡è®¿é—®çš„äº¤æ˜“æ¬¡æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1341-%E7%94%B5%E5%BD%B1%E8%AF%84%E5%88%86"><span class="toc-number">96.</span> <span class="toc-text">1341. ç”µå½±è¯„åˆ†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1350-%E9%99%A2%E7%B3%BB%E6%97%A0%E6%95%88%E7%9A%84%E5%AD%A6%E7%94%9F"><span class="toc-number">97.</span> <span class="toc-text">1350. é™¢ç³»æ— æ•ˆçš„å­¦ç”Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1355-%E6%B4%BB%E5%8A%A8%E5%8F%82%E4%B8%8E%E8%80%85"><span class="toc-number">98.</span> <span class="toc-text">1355. æ´»åŠ¨å‚ä¸è€…</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1364-%E9%A1%BE%E5%AE%A2%E7%9A%84%E5%8F%AF%E4%BF%A1%E8%81%94%E7%B3%BB%E4%BA%BA%E6%95%B0%E9%87%8F"><span class="toc-number">99.</span> <span class="toc-text">1364. é¡¾å®¢çš„å¯ä¿¡è”ç³»äººæ•°é‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1369-%E8%8E%B7%E5%8F%96%E6%9C%80%E8%BF%91%E7%AC%AC%E4%BA%8C%E6%AC%A1%E7%9A%84%E6%B4%BB%E5%8A%A8"><span class="toc-number">100.</span> <span class="toc-text">1369. è·å–æœ€è¿‘ç¬¬äºŒæ¬¡çš„æ´»åŠ¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1378-%E4%BD%BF%E7%94%A8%E5%94%AF%E4%B8%80%E6%A0%87%E8%AF%86%E7%A0%81%E6%9B%BF%E6%8D%A2%E5%91%98%E5%B7%A5ID"><span class="toc-number">101.</span> <span class="toc-text">1378. ä½¿ç”¨å”¯ä¸€æ ‡è¯†ç æ›¿æ¢å‘˜å·¥ID</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1384-%E6%8C%89%E5%B9%B4%E5%BA%A6%E5%88%97%E5%87%BA%E9%94%80%E5%94%AE%E6%80%BB%E9%A2%9D"><span class="toc-number">102.</span> <span class="toc-text">1384. æŒ‰å¹´åº¦åˆ—å‡ºé”€å”®æ€»é¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1393-%E8%82%A1%E7%A5%A8%E7%9A%84%E8%B5%84%E6%9C%AC%E6%8D%9F%E7%9B%8A"><span class="toc-number">103.</span> <span class="toc-text">1393. è‚¡ç¥¨çš„èµ„æœ¬æŸç›Š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1398-%E8%B4%AD%E4%B9%B0%E4%BA%86%E4%BA%A7%E5%93%81A%E5%92%8C%E4%BA%A7%E5%93%81B%E5%8D%B4%E6%B2%A1%E6%9C%89%E8%B4%AD%E4%B9%B0%E4%BA%A7%E5%93%81C%E7%9A%84%E9%A1%BE%E5%AE%A2"><span class="toc-number">104.</span> <span class="toc-text">1398. è´­ä¹°äº†äº§å“Aå’Œäº§å“Bå´æ²¡æœ‰è´­ä¹°äº§å“Cçš„é¡¾å®¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1407-%E6%8E%92%E5%90%8D%E9%9D%A0%E5%89%8D%E7%9A%84%E6%97%85%E8%A1%8C%E8%80%85"><span class="toc-number">105.</span> <span class="toc-text">1407. æ’åé å‰çš„æ—…è¡Œè€…</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1412-%E6%9F%A5%E6%89%BE%E6%88%90%E7%BB%A9%E5%A4%84%E4%BA%8E%E4%B8%AD%E6%B8%B8%E7%9A%84%E5%AD%A6%E7%94%9F"><span class="toc-number">106.</span> <span class="toc-text">1412. æŸ¥æ‰¾æˆç»©å¤„äºä¸­æ¸¸çš„å­¦ç”Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1421-%E5%87%80%E7%8E%B0%E5%80%BC%E6%9F%A5%E8%AF%A2"><span class="toc-number">107.</span> <span class="toc-text">1421. å‡€ç°å€¼æŸ¥è¯¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1435-%E5%88%B6%E4%BD%9C%E4%BC%9A%E8%AF%9D%E6%9F%B1%E7%8A%B6%E5%9B%BE"><span class="toc-number">108.</span> <span class="toc-text">1435. åˆ¶ä½œä¼šè¯æŸ±çŠ¶å›¾</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1440-%E8%AE%A1%E7%AE%97%E5%B8%83%E5%B0%94%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%80%BC"><span class="toc-number">109.</span> <span class="toc-text">1440. è®¡ç®—å¸ƒå°”è¡¨è¾¾å¼çš„å€¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1445-%E8%8B%B9%E6%9E%9C%E5%92%8C%E6%A1%94%E5%AD%90"><span class="toc-number">110.</span> <span class="toc-text">1445. è‹¹æœå’Œæ¡”å­</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1454-%E6%B4%BB%E8%B7%83%E7%94%A8%E6%88%B7"><span class="toc-number">111.</span> <span class="toc-text">1454.  æ´»è·ƒç”¨æˆ·</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1459-%E7%9F%A9%E5%BD%A2%E9%9D%A2%E7%A7%AF"><span class="toc-number">112.</span> <span class="toc-text">1459. çŸ©å½¢é¢ç§¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1468-%E8%AE%A1%E7%AE%97%E7%A8%8E%E5%90%8E%E5%B7%A5%E8%B5%84"><span class="toc-number">113.</span> <span class="toc-text">1468. è®¡ç®—ç¨åå·¥èµ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1479-%E5%91%A8%E5%86%85%E6%AF%8F%E5%A4%A9%E7%9A%84%E9%94%80%E5%94%AE%E6%83%85%E5%86%B5"><span class="toc-number">114.</span> <span class="toc-text">1479. å‘¨å†…æ¯å¤©çš„é”€å”®æƒ…å†µ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1485-%E6%8C%89%E6%97%A5%E6%9C%9F%E5%88%86%E7%BB%84%E9%94%80%E5%94%AE%E4%BA%A7%E5%93%81"><span class="toc-number">115.</span> <span class="toc-text">1485. æŒ‰æ—¥æœŸåˆ†ç»„é”€å”®äº§å“</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1495-%E4%B8%8A%E6%9C%88%E6%92%AD%E6%94%BE%E7%9A%84%E5%84%BF%E7%AB%A5%E9%80%82%E5%AE%9C%E7%94%B5%E5%BD%B1"><span class="toc-number">116.</span> <span class="toc-text">1495. ä¸Šæœˆæ’­æ”¾çš„å„¿ç«¥é€‚å®œç”µå½±</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1501-%E5%8F%AF%E4%BB%A5%E6%94%BE%E5%BF%83%E6%8A%95%E8%B5%84%E7%9A%84%E5%9B%BD%E5%AE%B6"><span class="toc-number">117.</span> <span class="toc-text">1501. å¯ä»¥æ”¾å¿ƒæŠ•èµ„çš„å›½å®¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1511-%E6%B6%88%E8%B4%B9%E8%80%85%E4%B8%8B%E5%8D%95%E9%A2%91%E7%8E%87"><span class="toc-number">118.</span> <span class="toc-text">1511. æ¶ˆè´¹è€…ä¸‹å•é¢‘ç‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1517-Find-Users-With-Valid-E-Mails"><span class="toc-number">119.</span> <span class="toc-text">1517. Find Users With Valid E-Mails</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1527-Patients-With-a-Condition"><span class="toc-number">120.</span> <span class="toc-text">1527. Patients With a Condition</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1532-The-Most-Recent-Three-Orders"><span class="toc-number">121.</span> <span class="toc-text">1532. The Most Recent Three Orders</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1543-Fix-Product-Name-Format"><span class="toc-number">122.</span> <span class="toc-text">1543. Fix Product Name Format</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1549-The-Most-Recent-Orders-for-Each-Product"><span class="toc-number">123.</span> <span class="toc-text">1549. The Most Recent Orders for Each Product</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/05/11/SpringBoot-%E5%86%85%E7%BD%AE%E5%B7%A5%E5%85%B7%E7%B1%BB/" title="SpringBoot å†…ç½®å·¥å…·ç±»"><img src="https://file.buildworld.cn/img/20220511115613.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringBoot å†…ç½®å·¥å…·ç±»"/></a><div class="content"><a class="title" href="/2022/05/11/SpringBoot-%E5%86%85%E7%BD%AE%E5%B7%A5%E5%85%B7%E7%B1%BB/" title="SpringBoot å†…ç½®å·¥å…·ç±»">SpringBoot å†…ç½®å·¥å…·ç±»</a><time datetime="2022-05-11T01:18:48.000Z" title="å‘è¡¨äº 2022-05-11 09:18:48">2022-05-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/11/04/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0/" title="é¢†åŸŸé©±åŠ¨è®¾è®¡å­¦ä¹ "><img src="https://file.buildworld.cn/img/20211104233820.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="é¢†åŸŸé©±åŠ¨è®¾è®¡å­¦ä¹ "/></a><div class="content"><a class="title" href="/2021/11/04/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0/" title="é¢†åŸŸé©±åŠ¨è®¾è®¡å­¦ä¹ ">é¢†åŸŸé©±åŠ¨è®¾è®¡å­¦ä¹ </a><time datetime="2021-11-04T15:27:21.000Z" title="å‘è¡¨äº 2021-11-04 23:27:21">2021-11-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/09/22/%E5%9B%BE%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88%E4%B8%80%EF%BC%89-Neo4j%E7%9A%84%E4%BB%8B%E7%BB%8D/" title="å›¾æ•°æ®åº“--Neo4jçš„ä»‹ç»"><img src="https://file.buildworld.cn/img/20210922220613.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="å›¾æ•°æ®åº“--Neo4jçš„ä»‹ç»"/></a><div class="content"><a class="title" href="/2021/09/22/%E5%9B%BE%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88%E4%B8%80%EF%BC%89-Neo4j%E7%9A%84%E4%BB%8B%E7%BB%8D/" title="å›¾æ•°æ®åº“--Neo4jçš„ä»‹ç»">å›¾æ•°æ®åº“--Neo4jçš„ä»‹ç»</a><time datetime="2021-09-22T14:01:45.000Z" title="å‘è¡¨äº 2021-09-22 22:01:45">2021-09-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/09/10/%E5%9B%BE%E4%B8%8E%E5%9B%BE%E5%AD%A6%E4%B9%A0/" title="å›¾ä¸å›¾å­¦ä¹ "><img src="https://file.buildworld.cn/img/20210907184428.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="å›¾ä¸å›¾å­¦ä¹ "/></a><div class="content"><a class="title" href="/2021/09/10/%E5%9B%BE%E4%B8%8E%E5%9B%BE%E5%AD%A6%E4%B9%A0/" title="å›¾ä¸å›¾å­¦ä¹ ">å›¾ä¸å›¾å­¦ä¹ </a><time datetime="2021-09-10T06:35:46.000Z" title="å‘è¡¨äº 2021-09-10 14:35:46">2021-09-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/09/07/%E6%89%8B%E5%86%99netty%E7%9A%84springboot-starter%E7%BB%84%E4%BB%B6/" title="æ‰‹å†™nettyçš„springboot-starterç»„ä»¶"><img src="https://file.buildworld.cn/img/20210907092140.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="æ‰‹å†™nettyçš„springboot-starterç»„ä»¶"/></a><div class="content"><a class="title" href="/2021/09/07/%E6%89%8B%E5%86%99netty%E7%9A%84springboot-starter%E7%BB%84%E4%BB%B6/" title="æ‰‹å†™nettyçš„springboot-starterç»„ä»¶">æ‰‹å†™nettyçš„springboot-starterç»„ä»¶</a><time datetime="2021-09-07T00:57:28.000Z" title="å‘è¡¨äº 2021-09-07 08:57:28">2021-09-07</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2017 - 2023 By MiChong</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><img src="https://haiyong.site/img/icp.png"><a href="https://beian.miit.gov.cn/" target="_blank">çš–ICPå¤‡20006548å·-1</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">æœ¬åœ°æœç´¢</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script>window.$crisp = [];
window.CRISP_WEBSITE_ID = "7d002c40-fe0a-44eb-977b-a992eaed1e7c";
(function () {
  d = document;
  s = d.createElement("script");
  s.src = "https://client.crisp.chat/l.js";
  s.async = 1;
  d.getElementsByTagName("head")[0].appendChild(s);
})();
$crisp.push(["safe", true])

if (true) {
  $crisp.push(["do", "chat:hide"])
  $crisp.push(["on", "chat:closed", function() {
    $crisp.push(["do", "chat:hide"])
  }])
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      $crisp.push(["do", "chat:show"])
      $crisp.push(["do", "chat:open"])

    });
  }
  chatBtnFn()
} else {
  if (true) {
    function chatBtnHide () {
      $crisp.push(["do", "chat:hide"])
    }
    function chatBtnShow () {
      $crisp.push(["do", "chat:show"])
    }
  }
}</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>