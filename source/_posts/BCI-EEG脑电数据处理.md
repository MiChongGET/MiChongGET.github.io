---
title: BCI-EEG脑电数据处理
date: 2020-07-07 19:42:56
top: True
tags:
- BCI
- EEG
- ICA
categories:
- 脑机交互
description: 脑电波（Electroencephalogram,EEG）是一种使用电生理指标记录大脑活动的方法，大脑在活动时，大量神经元同步发生的突触后电位经总和后形成的。它记录大脑活动时的电波变化，是脑神经细胞的电生理活动在大脑皮层或头皮表面的总体反映。脑机接口（BCI），是一种通过检测中枢神经系统活动并将其转化为人工输出，来替代、修复、增强、补充或者改善中枢神经系统的正常输出，从而改变中枢神经系统与内外环境之间的交互作用的技术。
top_img: https://yanxuan.nosdn.127.net/de018a7a4c00b68406c31fee5029ac6b.png
cover: https://yanxuan.nosdn.127.net/de018a7a4c00b68406c31fee5029ac6b.png
---

##  EEG脑电数据处理

>脑电波（Electroencephalogram,EEG）是一种使用电生理指标记录大脑活动的方法，大脑在活动时，大量神经元同步发生的突触后电位经总和后形成的。它记录大脑活动时的电波变化，是脑神经细胞的电生理活动在大脑皮层或头皮表面的总体反映。脑机接
口（BCI），是一种通过检测中枢神经系统活动并将其转化为人工输出，来替代、修复、增强、补充或者改善中枢神经系统的正常输出，从而改变中枢神经系统与内外环境之间的交互作用的技术。

> 来自**[脑机接口社区]**公众号

### 一、十大基本步骤

#### 1、 定位通道位置

> 将EEG数据加载进eeglab之后，`eeglab`能够读取到的仅仅是每一个通道的名称和数值，但是它并不知道这个通道是位于头皮上的什么地方，因此我们需要加载进一个跟记录数据时相匹配的通道位置信息

> eeglab中默认的文件是 **standard-10-5-cap385([国际10-5系统](https://mp.weixin.qq.com/s?__biz=MzU5NjU4OTc4MA==&mid=2247484433&idx=1&sn=1d4bba3c10192920d8255d899a6d8f28&chksm=fe6129aac916a0bc648142cb3a53c0679cd1c03a21c20553bba0b4858c613cd6dd0e73e8b727&scene=21#wechat_redirect))**

#### 2、删除无用通道

> 在**EEGLAB**中预处理数据的时候，使用`ICA`方式去除眼电成分，这种方式可以不用眼电通道数据的参与就可以进行。

#### 3、滤波

> 滤波分为`高通滤波`，`低通滤波`，`带通滤波`和`凹陷滤波`。

- **高通滤波**是指，高于某个频率的信号可以通过，而低于这个频率的信号会被衰减过滤掉。而**低通滤波**则相反，指的是低于某个频率的信号可以通过，而高于这个频率的信号则相反。所以，在输入数值的时候，高通滤波要输入的是一个较小的数字，而低通滤波则是输入一个较大的数字。这可能跟我们的第一反应有点相悖。因此，也可以用它们的英文叫法来辨别，高通`high-pass`，低通`low-pass`，英文看起来就更为直观了。
- **带通滤波**，指的是在某个频率段范围内的信号可以通过，而这个频率段范围以外的信号会被衰减过滤掉，就相当于同时做了高通滤波和低通滤波。
- **凹陷滤波**，指的是在某个频率范围内的信号会被衰减过滤掉，而这个频率范围以外的信号会被保留下来。这个操作通常是用来去除50Hz市电的干扰。我国的50Hz，因此在收集到的信号中，会有一个非常强烈的50Hz频段的信号存在，这就可以用凹陷滤波来去掉。

#### 4、分段

> 数据打上**mark**，将数据切分为一段一段，在这些范围以外的的数据，直接去除。
>
> 一般的ERP分段在事件前200毫秒到事件后1000毫秒这个时间段就足够了，因为几乎所有的ERP成分，都是在1秒以内产生的。但是如果后期还要做时频分析的话，则需要将分段时间拉长，扩大到事件前1秒到事件后2秒这个时间段内，因为时频分析的算法，要求数据要有一定的长度。

#### 5、基线校正

> 被试被认为是处于一个相对平静的状态，此时的脑电活动代表了一个平静状态下的脑电活动，将这段时间内的脑电活动当做成一个基线。
>
> 一般来说，都是以分段中，事件之前这段时间来作为基线的，比如分段为-200毫秒到1000毫秒，那就将所有的数据，减去前200毫米以内数据的均值。
>
> 基线校正的第二个作用是**防止数据漂移带来的影响**。有时候因为某些原因，我们采集到的数据，会呈现一个逐渐缓慢向上漂移的趋势，而在分完段之后，由于向上飘的影响，每一段数据的起点将不在同一个地方，也会使得这段数据的绝对波幅变高。而基线校正就可以校正这种漂移带来的影响，让每一段数据都拥有一个差不多的起点。

#### 6、重参考

> - 首先要解释的是参考的定义。我们看到采集之后的数据是一个个的数值，但这个数值是什么意思呢，就是电极所在位置跟参考电极之间的电位差。
> - 一般在脑电记录的时候会采用的参考电极有鼻尖参考，cz或头顶中央参考，还有单侧乳突参考，乳突就是耳朵后面一小块突起的区域。我们所看到的每个通道的数值，其实就是指这个通道跟参考通道之间的电位差。
> - 在分析数据的时候，有时候我们会想要转换参考点的位置。因为不同位置的参考，会对数据造成一定的影响。比如记录时采用的是cz或头顶中央参考，那么自然地，距离cz点较近的电极点，记录到的电位差会非常小，而离得远的电极记录到的电位差就自然会大一点，这种大与小的差异，并不是由认知活动产生的，而是由记录方式产生的。又比如，单侧乳突参考，那脑袋左边的电极点跟右边的电极点，也会存在着记录方式不同产生的电位差不同。
> - 常用的一些参考位置有双侧乳突平均参考，指将两个乳突数据的平均值作为参考数据，或者是全脑平均参考，指的是将全脑所有数据的均值作为参考数据的方法，不过使用全脑平均参考的时候要注意，眼电数据不要纳入其中，因为眼电数据的波动起伏非常大，很容易对数据造成比较大的干扰。

#### 7、降低采样率

> - 采样率的单位是Hz，指的是一秒内要记录多少个数据点的意思，比如原始数据的采样率是1000Hz的话，就是代表一秒内有1000个数据点。
> - 在后期分析的时候，我们有时候会想要降低采样率，比如降到500Hz或者250Hz。这样做最大的好处其实就是减小数据量，以提高计算速度，没有其他的作用了。所以这一步并不是必须的。
> - 但降低采样率需要注意两点，**一是降低采样率要在滤波之后**。因为降低采样率会使我们丢失高频信息，使高频信息变得扭曲，所以最好在保留了我们感兴趣波段之后再去降低采样率，这样可以保证信号最大程度不会失真。**二是有一个采样定理，**理论上来说，我们的采样率必须是我们想要分析的波段的两倍，比如我们想要分析60Hz的波，那数据采样率为120Hz就足够了。实际上，建议采样率最好在分析波段的三到四倍。

#### 8、插值坏导

> - 在做完上述这些处理之后，可以保存一下数据。因为在这之前的操作，是每个被试都需要做的基础操作，后期我们可以通过代码来实现批处理。而在这之后的操作，是需要根据每个被试的具体情况具体分析去处理的，因此只能一个个做，不能进行批处理。
> - 从这一步开始可以说是真正的去除伪迹的过程了。去伪迹大体分为两种，`横向操作`和`纵向操作`，**横向即对通道进行校正操作，对数据不好的导联进行插值处理，纵向是指挑出数据不好的trials，删除掉。**建议是先横向处理后再纵向剔除，尽量保留下更多的trials数。
> - EEGLAB中插值坏导有两种方式，**一种是以某通道周围几个通道的数据的平均值，来替代这个通道的数据，这种直接通过代码实现即可。** **另外一种是EEGLAB里内置的一种算法实现**，具体换算是什么过程我也不太清楚，但是我问过贾会宾老师，他是推荐使用第二种方法。原因在于，我们记录的是头皮脑电，头是一个球体，因此直接用周围数据的均值来代替这种方法有点粗糙，而EEGLAB内置的方法则会考虑到容积传导效应，以及近的点和远的点贡献的权重不同来进行插值，因此会更加有效。

#### 9、独立主成分分析

**[如何识别ICA成分](https://mp.weixin.qq.com/s?__biz=MzU5NjU4OTc4MA==&mid=2247486858&idx=1&sn=abb9ba31da1264ca1f2d5a690ee04b4d&chksm=fe612031c916a927a710161d50ac9e5c8969b02141c5952c739e4689d61f59bbdf8e391f7186&scene=21#wechat_redirect)**

> 这是一个很有用但也很难的方法，我并不是十分清楚它的原理，只能大概理解，也只能大概描述一下。前面说过，我们记录到的是头皮脑电，脑电帽上划出了一个个的点来表示位置，但是我们在`FPz`点记录到的数据，就真的是`FPz`点这个位置头皮下方的区域所产生的电活动？不一定。做过实验的都知道，眨眼会产生影响，左右看会产生影响，帽子戴得太紧导致肌肉紧张也会产生影响，还有左右的`FP1，FP2`处产生的电活动也会影响到`FPz`，甚至在离它最远的Oz点下方产生的电活动，也有可能对前方`FPz`点产生微弱的影响。因为真正的电活动产生于头皮下方颅骨内部，它经过了这么一层又一层的传播之后，不同源的电活动肯定会相互影响，从而导致某个记录点记录到的数据，混合了很多不同成分的电活动。而独立主成分分析，就是要对记录点的数据做一个逆运算，把每个记录点的数据， 分解成一个又一个的成分组成。然后我们再从中剔除掉伪迹成分，比如眨眼的成分，肌肉紧张的成分等，从而得到一个相对干净的数据。

#### 10、剔除坏段

> - 预处理到了这一步，已经接近于完成了。最后一个步骤就是要剔除掉波幅超过100微幅的trial(要求严格一点也可以定位80)，因为波幅起伏这么大的活动，已经不是由认知活动引起的了，肯定是由于其他的动作引起的，所以可以直接剔除掉。
> - 这一步操作一定要在插值坏导和ICA去除眼电成分之后再做，因为有可能被试眨眼比较频繁，那这么操作下来，有可能就需要删掉接近一半的trials数了，删掉的trials数太多，这个数据也就废了。所以要将它留到最后一步才做，同时，这个操作也能用来检查我们前两步操作是否足够有效。



### 二、ICA(独立成分分析)

**ICA是一种分离线性混合源的技术。例如，我们可以尝试混合然后分开两个源。**

[ICA判断网站](https://labeling.ucsd.edu/tutorial/labels)

[结合matlab代码案例解释ICA独立成分分析原理](https://mp.weixin.qq.com/s?__biz=MzU5NjU4OTc4MA==&mid=2247485932&idx=1&sn=8749bfe4967f60de387fe7f9ba38be62&chksm=fe612457c916ad41df8ec9f2890458d86ca4ac7df44c360a4e77234e6a26115e40c957cf979a&scene=21#wechat_redirect)

#### 1、ICA假设

> 基于ICA的伪影校正可以通过线性分解从EEG数据中分离并去除多种伪影。ICA方法基于以下假设：
>
> - 1）在头皮上记录的时间序列是时间上独立的大脑和伪迹活动的空间稳定混合物，
> - 2）并且大脑，头皮和身体不同部位产生的电势之和为在电极上呈线性关系，
> - 3）从源到电极的传播延迟可以忽略不计

#### 2、ICA特性

> - ICA只能分离线性混合的源。
> - 由于ICA处理的是点云，因此改变点的绘制顺序(EEG中的时间点顺序)对算法的结果几乎没有影响。
> - 改变通道顺序(例如在EEG中交换电极位置)也不会影响算法的结果。对于脑电信号来说，该算法对电极位置没有先验知识，ICA分量在大多数情况下可以被解析为一个等效偶极子，这证明了ICA能够分离出皮层同步化的致密区域。
> -  由于独立分量分析通过最大化源的非高斯性来分离源，所以完美的高斯源是不能被分离的。
> -  即使信息源不是独立的，独立分量分析也能找到一个最大独立空间。



### 三、共空间模式(Common Spatial Pattern, CSP)

[详细介绍地址](https://mp.weixin.qq.com/s?__biz=MzU5NjU4OTc4MA==&mid=2247486495&idx=1&sn=3bb4aa2415bf9c48947f700db3a1a69e&chksm=fe6121a4c916a8b2a585a5e3d10aa38d6e578726e77403efabfb05c14d5855a6916ad7b9e93e&scene=21#wechat_redirect)

> `共空间模式（Common Spatial Pattern, CSP）`是一种对两分类任务下的空域滤波特征提取算法，能够从多通道的脑机接口数据里面提取出每一类的空间分布成分。公共空间模式算法的基本原理是利用矩阵的对角化，找到一组最优空间滤波器进行投影，使得两类信号的方差值差异最大化，从而得到具有较高区分度的特征向量。

#### 1、CSP发展史

![共空间模式（CSP）的研究概况](https://file.buildworld.cn/img/37d37a272098ac16bee4514f24235efe_640_wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1.png)



> 由于不同特征的信息包含在信号的不同频段中，因此考虑EEG信号，可以将其分离到不同的特定频段进行分析。在当前研究的特征提取和特征分类算法中，`CSP`是性能最好和应用最广泛的特征提取方法。`CSP`将当前数据转换到另一个新的空间，使得类间数据的方差最大化，类内的方差最小化。

> 通常，在运动想象EEG信号分类中，`CSP`算法往往选择宽频段（4-40HZ）来进行信号处理。研究表明，这个宽频段包含了大多数的运动想象相关的信息，同时，也包含着其他冗余信息，所以不少研究工作重点考虑这个宽频段的选择最佳问题，以此来改善CSP的分类性能。在提出的`共空间频谱模式（CSSP）`中，`有限脉冲响应（FIR）滤波器`在`CSP滤波器`的基础上进行了优化，通过插入时间延迟τ来实现，该时间延迟τ允许单独调谐频率滤波器，评估若干样本点的时间延迟τ值，并且使用10倍交叉验证来选择最佳值。使用带通滤波器对信号进行滤波，然后进行空间滤波和特征提取。实验结果显示CSSP改进了性能。提出的`共稀疏频谱空间模式（CSSSP）`进一步改进了CSSP方法，其找到所有信道共用的频谱模式，而非CSSP为每个信道找到不同的频谱模式。

> 已经提出的`子带公空间模式（SBCSP）`，其中在多个子带处对运动图像EEG信号进行滤波，并且从每个子带提取CSP特征。为了减小子带的维数，`线性判别分析（LDA）`分别应用于每个子带的特征，并融合在一起以进行分类。 SBCSP实现了比CSP，CSSP和CSSSP更高的分类精度。然而，SBCSP忽略了从不同子带获得的CSP特征的可能关联，因此提出了`滤波器组CSP（FBCSP）`来解决该问题。 FBCSP计算来自多个子带的CSP特征的互信息，以便选择最具辨识性的特征，所选特征使用支持向量机（SVM）分类器进行分类。 FBCSP的表现优于SBCSP，然而，它仍然使用了若干子带，这些子带依然会带来不少的计算成本的增加。所以提出`DFBCSP`来解决这个问题，DFBCSP利用单信道（C3，C4或Cz）频带功率的Fisher比（FR）来从多个重叠子频带中选择最具判别性的子频带。然后为每个子带提取CSP特征，并使用SVM分类器进行分类。与SBCSP和FBCSP相比，**DFBCSP实现了更高的分类准确度和更低的计算成本。**

#### DFBCSP框架

![DFBCSP框架](https://ae01.alicdn.com/kf/H58e7c284aefa4a848a01cb4fbdd941b4x.jpg)





> 考虑`DFBCSP`的优劣，因此提出了一种改进的`DFBCSP`方法来解决这些问题。首先，使用从使用所有通道数据生成的特征计算的互信息，而不是像在`DFBCSP-FR`中那样使用单通道频带功率的FR，来选择能够产生最佳结果的频带。而不使用仅使用单个信道频带功率和FR作为选择子频带（`DFBCSP-FR`）的方法。这是因为EEG信号主要受噪声污染。因此，如果用于计算FR的单个信道被噪声破坏，则选择出来的频段将会影响分类器的分类精度。这导致选择的子带往往不是最有效的子带，因为可能选择了具有冗余信息的子带。因此，文章建议利用所有可用信道数据通过利用互信息来选择最具判别性的子带，以便获得最佳结果。与使用用于频带选择的单信道信息相比，使用所有信道数据进行频带选择减少了选择具有冗余信息的子频带的机会。
>
> 其次，文章不再像在DFBCSP-FR中那样仅使用来自重叠子带的CSP特征，而是结合利用宽带CSP和CSSP的特征信息，文章引入了7-30Hz的单个宽带以及在4-30Hz范围内的12个重叠子带，带宽为4Hz并且重叠2Hz。



**改进DFBCSP算法的详细流程框图**

![改进DFBCSP算法的详细流程框图](https://ae01.alicdn.com/kf/H92ab031f28d84b58be411ac06481b026d.jpg)





### 四、EEG信号特征提取算法(MI方向)

**EEG信号特征提取就是以脑电信号作为源信号，确定各种参数并以此为向量组成表征信号特征的特征向量。**

> 特征參数主要包括`时域信号(如幅值)`和`频域信号(如频率)`两大类，相应的特征提取方法也分为`时域法`、`频域法` 和`时-频域`方法。

#### 1、频域分析

> 频域分析方法主要是**基于EEG信号各频段功率、相干**等。

> 这类方法是建立在假设EEG信号具有平稳特性的基础上，同时只是考虑信号的频域信息，忽略信号在时间上的分辨率。在EEG信号研究中，常用的频域分析方法包括`功率谱估计`(`直接法和间接法`)。
>
> **运动想象EEG信号**的`ERD`和`ERS`现象只出现在特定频率范围，比如`8-12Hz 的Mu波`和`18-26Hz 的Beta 波`。因此，通过功率谱等谱分析方法，也可以有效地从EEG提取中特征。其中比较出名的方法有自回归功率谱分析、双谱分析法等。

#### 2、时域分析

> 时域分析方法则主要分析EEG，如`幅度`、`均值`、`方差`、`偏歪度`、`峭度`等。

> 这类方法主要是利用EEG波形的性质，如波幅、均值、方差、偏歪度和峭度等对临床EEG记录进行观察分析。在EEG信号研究中，常用的时域分析方法有：`过零点分析`、`直方图分析`、`方差分析`、`相关分析`、`峰值检测`、`波形参数分析`和`波形识别`等。

#### 3、空域方法：

> 这是近年运动想象领域比较通用的特征提取方法，主要通过设计空域滤波器对EEG 的多通道空间分布进行处理，提取可分的特征。包括：`共空域模式法（Common spatialpattern，CSP）`，以及基于CSP改进的方法。

**基于CSP改进的方法包括：**

- 1.时空滤波的共空谱模式（Common spatio-spectralpattern, CSSP）；

- 2.共稀疏谱空模式（Common sparse spectral spatial pattern，CSSSP）；

- 3.正则化公用空间模式（Regularized Common Spatial Pattern, RCSP)等。

  

#### 4、小波模糊熵的特征提取方法

> 鉴于脑电信号的非线性特性和运动想象时的节律特性，提出了小波模糊熵的特征提取方法，利用小波变换将EEG信号进行小波分解，得到对应运动想象EEG信号的alpha和beta节律，然后采用模糊熵方法提取特征。



#### 5、常使用的特征提取方法：

- 自回归(auto regressive, AR)
- 傅里叶变换(Fourier transform,FT)
- 表面拉普拉斯(surface-Laplacian)变换
- 小波变换(Wavelet transform,WT)



**快速傅里叶变换(Fast Fourier transform, FFT)**

> 经典的FFT在分析确定信号和平稳信号时很有效，但在分析突变信号的频谱时具有一定的局限性。对于alpha波、beta波等脑电基本节律，功率谱分析或FFT等方法可以从频域中直接提取出特征。



**稀疏傅里叶变换(Sparse Fourier transform, SFT)**

>SFT是时间窗内信号特征的平均，时间窗里信号越短，获得的时间分辨率就越高。该方法在一定程度上克服了FFT不具有的局部分析能力的缺陷，在某些信号处理中有一定的作用。



**自适应自回归(Adaptive Auto Regressive ,AAR)**

> AAR模型参数方法随每一样本点的输入而改变，能够很好地反映大脑的状态。不过，该方法更适合分析平稳的脑电信号，对包含高度非平稳信号的运动想象EEG，该模型是有局限性的。



**小波变换(Wavelettransform, WT)**

> 小波变换在低频时的时间分辨率较低，而频率分辨率较高；在高频时的时间分辨率较高，而频率分辨率较低，正符合低频信号变化緩慢而高频信号变化较快的特点。因此小波分析比傅里叶变换和短时傅里叶变换更适合分析非平稳的脑电信号。
