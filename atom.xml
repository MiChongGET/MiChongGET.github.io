<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>MiChongçš„ğŸ¡</title>
  <icon>https://www.gravatar.com/avatar/4ad4fe3a4357a29a236338cca3ee2045</icon>
  
  <link href="https://www.buildworld.cn/atom.xml" rel="self"/>
  
  <link href="https://www.buildworld.cn/"/>
  <updated>2021-07-06T05:12:56.084Z</updated>
  <id>https://www.buildworld.cn/</id>
  
  <author>
    <name>MiChong</name>
    <email>qjzxzxd@gmail.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Hello World</title>
    <link href="https://www.buildworld.cn/2021/07/06/hello-world/"/>
    <id>https://www.buildworld.cn/2021/07/06/hello-world/</id>
    <published>2021-07-06T05:12:56.084Z</published>
    <updated>2021-07-06T05:12:56.084Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>LeetCodeæ•°æ®åº“é¢˜ç›®é›†åˆ</title>
    <link href="https://www.buildworld.cn/2021/02/09/LeetCode%E6%95%B0%E6%8D%AE%E5%BA%93%E9%A2%98%E7%9B%AE%E9%9B%86%E5%90%88/"/>
    <id>https://www.buildworld.cn/2021/02/09/LeetCode%E6%95%B0%E6%8D%AE%E5%BA%93%E9%A2%98%E7%9B%AE%E9%9B%86%E5%90%88/</id>
    <published>2021-02-09T08:13:56.000Z</published>
    <updated>2021-04-09T02:11:41.451Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><blockquote><p><a href="https://leetcode-cn.com/problemset/database/">https://leetcode-cn.com/problemset/database/</a></p><p>é¢˜ç›®éƒ½æ˜¯leetcode ä¸Šäº†å¯ä»¥ç‚¹å‡»é¢˜ç›®ä¼šæœ‰ç›¸åº”çš„é“¾æ¥</p><p>ç”±äºä¸ªäººæ¯”è¾ƒå–œæ¬¢ç”¨å¼€çª—å‡½æ•°ï¼Œæ‰€ä»¥éƒ½ä¼˜å…ˆç”¨äº†å¼€çª— ï¼Œå½“ç„¶è¿™äº›å¹¶ä¸ä¸€å®šéƒ½æ˜¯æœ€ä¼˜è§£ï¼Œç­”æ¡ˆä»…ä¾›å‚è€ƒ</p><p>æ¯é“é¢˜åé¢éƒ½åº”ç›¸åº”çš„éš¾åº¦ç­‰çº§ï¼Œå¦‚æœæ²¡æ—¶é—´åšçš„è¯ å¯ä»¥åœ¨leetcode æŒ‰å‡ºé¢˜é¢‘ç‡åˆ·é¢˜</p><p>æˆ‘æ˜¯å®‰é¡ºåºåˆ·çš„é¢˜ï¼Œåç»­è¿˜ä¼šç»§ç»­æ›´æ–°</p><p>ç¥å¤§å®¶é¢è¯•å–å¾—å¥½çš„æˆç»©</p></blockquote><h4 id="175-ç»„åˆä¸¤ä¸ªè¡¨"><a href="#175-ç»„åˆä¸¤ä¸ªè¡¨" class="headerlink" title="175. ç»„åˆä¸¤ä¸ªè¡¨"></a><a href="https://leetcode-cn.com/problems/combine-two-tables/">175. ç»„åˆä¸¤ä¸ªè¡¨</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>è¡¨1: <code>Person</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| åˆ—å         | ç±»å‹     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| PersonId    | int     |</span><br><span class="line">| FirstName   | varchar |</span><br><span class="line">| LastName    | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">PersonId æ˜¯ä¸Šè¡¨ä¸»é”®</span><br></pre></td></tr></table></figure><p>è¡¨2: <code>Address</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| åˆ—å         | ç±»å‹    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| AddressId   | int     |</span><br><span class="line">| PersonId    | int     |</span><br><span class="line">| City        | varchar |</span><br><span class="line">| State       | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">AddressId æ˜¯ä¸Šè¡¨ä¸»é”®</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ»¡è¶³æ¡ä»¶ï¼šæ— è®º person æ˜¯å¦æœ‰åœ°å€ä¿¡æ¯ï¼Œéƒ½éœ€è¦åŸºäºä¸Šè¿°ä¸¤è¡¨æä¾› person çš„ä»¥ä¸‹ä¿¡æ¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FirstName, LastName, City, State</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> FirstName,LastName,City,State</span><br><span class="line"><span class="keyword">from</span> Person  p</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span>  Address a </span><br><span class="line"><span class="keyword">on</span> a.PersonId <span class="operator">=</span> p.PersonId</span><br></pre></td></tr></table></figure><h4 id="176-ç¬¬äºŒé«˜çš„è–ªæ°´"><a href="#176-ç¬¬äºŒé«˜çš„è–ªæ°´" class="headerlink" title="176. ç¬¬äºŒé«˜çš„è–ªæ°´"></a><a href="https://leetcode-cn.com/problems/second-highest-salary/">176. ç¬¬äºŒé«˜çš„è–ªæ°´</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œè·å– <code>Employee</code> è¡¨ä¸­ç¬¬äºŒé«˜çš„è–ªæ°´ï¼ˆSalaryï¼‰ ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+----+--------+</span><br><span class="line">| Id | Salary |</span><br><span class="line">+----+--------+</span><br><span class="line">| 1  | 100    |</span><br><span class="line">| 2  | 200    |</span><br><span class="line">| 3  | 300    |</span><br><span class="line">+----+--------+</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ä¸Šè¿° <code>Employee</code> è¡¨ï¼ŒSQLæŸ¥è¯¢åº”è¯¥è¿”å› <code>200</code> ä½œä¸ºç¬¬äºŒé«˜çš„è–ªæ°´ã€‚å¦‚æœä¸å­˜åœ¨ç¬¬äºŒé«˜çš„è–ªæ°´ï¼Œé‚£ä¹ˆæŸ¥è¯¢åº”è¿”å› <code>null</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+---------------------+</span><br><span class="line">| SecondHighestSalary |</span><br><span class="line">+---------------------+</span><br><span class="line">| 200                 |</span><br><span class="line">+---------------------+</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    IFNULL(</span><br><span class="line">      (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> Salary</span><br><span class="line">       <span class="keyword">FROM</span> Employee</span><br><span class="line">       <span class="keyword">ORDER</span> <span class="keyword">BY</span> Salary <span class="keyword">DESC</span></span><br><span class="line">        LIMIT <span class="number">1</span> <span class="keyword">OFFSET</span> <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">NULL</span>) <span class="keyword">AS</span> SecondHighestSalary</span><br></pre></td></tr></table></figure><h4 id="177-ç¬¬Né«˜çš„è–ªæ°´"><a href="#177-ç¬¬Né«˜çš„è–ªæ°´" class="headerlink" title="177. ç¬¬Né«˜çš„è–ªæ°´"></a><a href="https://leetcode-cn.com/problems/nth-highest-salary/">177. ç¬¬Né«˜çš„è–ªæ°´</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œè·å– <code>Employee</code> è¡¨ä¸­ç¬¬ <em>n</em> é«˜çš„è–ªæ°´ï¼ˆSalaryï¼‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+----+--------+</span><br><span class="line">| Id | Salary |</span><br><span class="line">+----+--------+</span><br><span class="line">| 1  | 100    |</span><br><span class="line">| 2  | 200    |</span><br><span class="line">| 3  | 300    |</span><br><span class="line">+----+--------+</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ä¸Šè¿° <code>Employee</code> è¡¨ï¼Œ<em>n = 2</em> æ—¶ï¼Œåº”è¿”å›ç¬¬äºŒé«˜çš„è–ªæ°´ <code>200</code>ã€‚å¦‚æœä¸å­˜åœ¨ç¬¬ <em>n</em> é«˜çš„è–ªæ°´ï¼Œé‚£ä¹ˆæŸ¥è¯¢åº”è¿”å› <code>null</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+------------------------+</span><br><span class="line">| getNthHighestSalary(2) |</span><br><span class="line">+------------------------+</span><br><span class="line">| 200                    |</span><br><span class="line">+------------------------+</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> getNthHighestSalary(N <span class="type">INT</span>) <span class="keyword">RETURNS</span> <span class="type">INT</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">SET</span> N <span class="operator">=</span> N<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">RETURN</span> (</span><br><span class="line">        <span class="keyword">select</span> ifnull((</span><br><span class="line">                          <span class="keyword">select</span> <span class="keyword">distinct</span> Salary</span><br><span class="line">                          <span class="keyword">from</span> Employee <span class="keyword">order</span> <span class="keyword">by</span> Salary <span class="keyword">desc</span> limit N,<span class="number">1</span>),</span><br><span class="line">                      <span class="keyword">NULL</span>)</span><br><span class="line">    );</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure><h4 id="178-åˆ†æ•°æ’å"><a href="#178-åˆ†æ•°æ’å" class="headerlink" title="178. åˆ†æ•°æ’å"></a><a href="https://leetcode-cn.com/problems/rank-scores/">178. åˆ†æ•°æ’å</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢æ¥å®ç°åˆ†æ•°æ’åã€‚</p><p>å¦‚æœä¸¤ä¸ªåˆ†æ•°ç›¸åŒï¼Œåˆ™ä¸¤ä¸ªåˆ†æ•°æ’åï¼ˆRankï¼‰ç›¸åŒã€‚è¯·æ³¨æ„ï¼Œå¹³åˆ†åçš„ä¸‹ä¸€ä¸ªåæ¬¡åº”è¯¥æ˜¯ä¸‹ä¸€ä¸ªè¿ç»­çš„æ•´æ•°å€¼ã€‚æ¢å¥è¯è¯´ï¼Œåæ¬¡ä¹‹é—´ä¸åº”è¯¥æœ‰â€œé—´éš”â€ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+----+-------+</span><br><span class="line">| Id | Score |</span><br><span class="line">+----+-------+</span><br><span class="line">| 1  | 3.50  |</span><br><span class="line">| 2  | 3.65  |</span><br><span class="line">| 3  | 4.00  |</span><br><span class="line">| 4  | 3.85  |</span><br><span class="line">| 5  | 4.00  |</span><br><span class="line">| 6  | 3.65  |</span><br><span class="line">+----+-------+</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œæ ¹æ®ä¸Šè¿°ç»™å®šçš„ <code>Scores</code> è¡¨ï¼Œä½ çš„æŸ¥è¯¢åº”è¯¥è¿”å›ï¼ˆæŒ‰åˆ†æ•°ä»é«˜åˆ°ä½æ’åˆ—ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+-------+------+</span><br><span class="line">| Score | Rank |</span><br><span class="line">+-------+------+</span><br><span class="line">| 4.00  | 1    |</span><br><span class="line">| 4.00  | 1    |</span><br><span class="line">| 3.85  | 2    |</span><br><span class="line">| 3.65  | 3    |</span><br><span class="line">| 3.65  | 3    |</span><br><span class="line">| 3.50  | 4    |</span><br><span class="line">+-------+------+</span><br></pre></td></tr></table></figure><p><strong>é‡è¦æç¤ºï¼š</strong>å¯¹äº MySQL è§£å†³æ–¹æ¡ˆï¼Œå¦‚æœè¦è½¬ä¹‰ç”¨ä½œåˆ—åçš„ä¿ç•™å­—ï¼Œå¯ä»¥åœ¨å…³é”®å­—ä¹‹å‰å’Œä¹‹åä½¿ç”¨æ’‡å·ã€‚ä¾‹å¦‚ <strong><code>Rank</code></strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> Score,</span><br><span class="line"><span class="built_in">dense_rank</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> Score <span class="keyword">desc</span>) `rank`</span><br><span class="line"><span class="keyword">from</span> Scores</span><br></pre></td></tr></table></figure><h4 id="180-è¿ç»­å‡ºç°çš„æ•°å­—"><a href="#180-è¿ç»­å‡ºç°çš„æ•°å­—" class="headerlink" title="180. è¿ç»­å‡ºç°çš„æ•°å­—"></a><a href="https://leetcode-cn.com/problems/consecutive-numbers/">180. è¿ç»­å‡ºç°çš„æ•°å­—</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒæŸ¥æ‰¾æ‰€æœ‰è‡³å°‘è¿ç»­å‡ºç°ä¸‰æ¬¡çš„æ•°å­—ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+----+-----+</span><br><span class="line">| Id | Num |</span><br><span class="line">+----+-----+</span><br><span class="line">| 1  |  1  |</span><br><span class="line">| 2  |  1  |</span><br><span class="line">| 3  |  1  |</span><br><span class="line">| 4  |  2  |</span><br><span class="line">| 5  |  1  |</span><br><span class="line">| 6  |  2  |</span><br><span class="line">| 7  |  2  |</span><br><span class="line">+----+-----+</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œç»™å®šä¸Šé¢çš„ <code>Logs</code> è¡¨ï¼Œ <code>1</code> æ˜¯å”¯ä¸€è¿ç»­å‡ºç°è‡³å°‘ä¸‰æ¬¡çš„æ•°å­—ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">-----------------+</span></span><br><span class="line"><span class="operator">|</span> ConsecutiveNums <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>               <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> Num ConsecutiveNums</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">Num,</span><br><span class="line"><span class="built_in">lead</span>(Num,<span class="number">1</span>,<span class="keyword">null</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> id) n2,</span><br><span class="line"><span class="built_in">lead</span>(Num,<span class="number">2</span>,<span class="keyword">null</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> id) n3</span><br><span class="line"><span class="keyword">from</span> Logs</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> Num <span class="operator">=</span> n2 <span class="keyword">and</span> Num <span class="operator">=</span> n3</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> l1.num <span class="keyword">as</span> ConsecutiveNums</span><br><span class="line"><span class="keyword">from</span> logs l1</span><br><span class="line">         <span class="keyword">join</span> logs l2 <span class="keyword">on</span> l1.num <span class="operator">=</span> l2.num</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> l1.Id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">sum</span>(l1.Id <span class="operator">-</span> l2.Id <span class="keyword">between</span> <span class="number">0</span> <span class="keyword">and</span> <span class="number">2</span>) <span class="operator">&gt;</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure><h4 id="181-è¶…è¿‡ç»ç†æ”¶å…¥çš„å‘˜å·¥"><a href="#181-è¶…è¿‡ç»ç†æ”¶å…¥çš„å‘˜å·¥" class="headerlink" title="181. è¶…è¿‡ç»ç†æ”¶å…¥çš„å‘˜å·¥"></a><a href="https://leetcode-cn.com/problems/employees-earning-more-than-their-managers/">181. è¶…è¿‡ç»ç†æ”¶å…¥çš„å‘˜å·¥</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p><code>Employee</code> è¡¨åŒ…å«æ‰€æœ‰å‘˜å·¥ï¼Œä»–ä»¬çš„ç»ç†ä¹Ÿå±äºå‘˜å·¥ã€‚æ¯ä¸ªå‘˜å·¥éƒ½æœ‰ä¸€ä¸ª Idï¼Œæ­¤å¤–è¿˜æœ‰ä¸€åˆ—å¯¹åº”å‘˜å·¥çš„ç»ç†çš„ Idã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----+-------+--------+-----------+</span><br><span class="line">| Id | Name  | Salary | ManagerId |</span><br><span class="line">+----+-------+--------+-----------+</span><br><span class="line">| 1  | Joe   | 70000  | 3         |</span><br><span class="line">| 2  | Henry | 80000  | 4         |</span><br><span class="line">| 3  | Sam   | 60000  | NULL      |</span><br><span class="line">| 4  | Max   | 90000  | NULL      |</span><br><span class="line">+----+-------+--------+-----------+</span><br></pre></td></tr></table></figure><p>ç»™å®š <code>Employee</code> è¡¨ï¼Œç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œè¯¥æŸ¥è¯¢å¯ä»¥è·å–æ”¶å…¥è¶…è¿‡ä»–ä»¬ç»ç†çš„å‘˜å·¥çš„å§“åã€‚åœ¨ä¸Šé¢çš„è¡¨æ ¼ä¸­ï¼ŒJoe æ˜¯å”¯ä¸€ä¸€ä¸ªæ”¶å…¥è¶…è¿‡ä»–çš„ç»ç†çš„å‘˜å·¥ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">----------+</span></span><br><span class="line"><span class="operator">|</span> Employee <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+</span></span><br><span class="line"><span class="operator">|</span> Joe      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.Name  Employee </span><br><span class="line"><span class="keyword">from</span> Employee a </span><br><span class="line"><span class="keyword">join</span> Employee b</span><br><span class="line"><span class="keyword">on</span> a.ManagerId <span class="operator">=</span> b.id</span><br><span class="line"><span class="keyword">where</span> a.Salary<span class="operator">&gt;</span>b.Salary</span><br></pre></td></tr></table></figure><h4 id="182-æŸ¥æ‰¾é‡å¤çš„ç”µå­é‚®ç®±"><a href="#182-æŸ¥æ‰¾é‡å¤çš„ç”µå­é‚®ç®±" class="headerlink" title="182. æŸ¥æ‰¾é‡å¤çš„ç”µå­é‚®ç®±"></a><a href="https://leetcode-cn.com/problems/duplicate-emails/">182. æŸ¥æ‰¾é‡å¤çš„ç”µå­é‚®ç®±</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒæŸ¥æ‰¾ <code>Person</code> è¡¨ä¸­æ‰€æœ‰é‡å¤çš„ç”µå­é‚®ç®±ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+----+---------+</span><br><span class="line">| Id | Email   |</span><br><span class="line">+----+---------+</span><br><span class="line">| 1  | a@b.com |</span><br><span class="line">| 2  | c@d.com |</span><br><span class="line">| 3  | a@b.com |</span><br><span class="line">+----+---------+</span><br></pre></td></tr></table></figure><p>æ ¹æ®ä»¥ä¸Šè¾“å…¥ï¼Œä½ çš„æŸ¥è¯¢åº”è¿”å›ä»¥ä¸‹ç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+---------+</span><br><span class="line">| Email   |</span><br><span class="line">+---------+</span><br><span class="line">| a@b.com |</span><br><span class="line">+---------+</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜ï¼š</strong>æ‰€æœ‰ç”µå­é‚®ç®±éƒ½æ˜¯å°å†™å­—æ¯ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> Email</span><br><span class="line"><span class="keyword">from</span> Person</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> Email</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">&gt;</span><span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="183-ä»ä¸è®¢è´­çš„å®¢æˆ·"><a href="#183-ä»ä¸è®¢è´­çš„å®¢æˆ·" class="headerlink" title="183. ä»ä¸è®¢è´­çš„å®¢æˆ·"></a><a href="https://leetcode-cn.com/problems/customers-who-never-order/">183. ä»ä¸è®¢è´­çš„å®¢æˆ·</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>æŸç½‘ç«™åŒ…å«ä¸¤ä¸ªè¡¨ï¼Œ<code>Customers</code> è¡¨å’Œ <code>Orders</code> è¡¨ã€‚ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ‰¾å‡ºæ‰€æœ‰ä»ä¸è®¢è´­ä»»ä½•ä¸œè¥¿çš„å®¢æˆ·ã€‚</p><p><code>Customers</code> è¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----+-------+</span><br><span class="line">| Id | Name  |</span><br><span class="line">+----+-------+</span><br><span class="line">| 1  | Joe   |</span><br><span class="line">| 2  | Henry |</span><br><span class="line">| 3  | Sam   |</span><br><span class="line">| 4  | Max   |</span><br><span class="line">+----+-------+</span><br></pre></td></tr></table></figure><p><code>Orders</code> è¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+----+------------+</span><br><span class="line">| Id | CustomerId |</span><br><span class="line">+----+------------+</span><br><span class="line">| 1  | 3          |</span><br><span class="line">| 2  | 1          |</span><br><span class="line">+----+------------+</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ç»™å®šä¸Šè¿°è¡¨æ ¼ï¼Œä½ çš„æŸ¥è¯¢åº”è¿”å›ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">-----------+</span></span><br><span class="line"><span class="operator">|</span> Customers <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+</span></span><br><span class="line"><span class="operator">|</span> Henry     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Max       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  c.Name Customers</span><br><span class="line"><span class="keyword">from</span> Customers  c <span class="keyword">left</span> <span class="keyword">join</span> Orders  o</span><br><span class="line"><span class="keyword">on</span> c.id <span class="operator">=</span> o.CustomerId</span><br><span class="line"><span class="keyword">where</span> o.id <span class="keyword">is</span> <span class="keyword">null</span></span><br></pre></td></tr></table></figure><h4 id="184-éƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥"><a href="#184-éƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥" class="headerlink" title="184. éƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥"></a><a href="https://leetcode-cn.com/problems/department-highest-salary/">184. éƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p><code>Employee</code> è¡¨åŒ…å«æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ï¼Œæ¯ä¸ªå‘˜å·¥æœ‰å…¶å¯¹åº”çš„ Id, salary å’Œ department Idã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----+-------+--------+--------------+</span><br><span class="line">| Id | Name  | Salary | DepartmentId |</span><br><span class="line">+----+-------+--------+--------------+</span><br><span class="line">| 1  | Joe   | 70000  | 1            |</span><br><span class="line">| 2  | Henry | 80000  | 2            |</span><br><span class="line">| 3  | Sam   | 60000  | 2            |</span><br><span class="line">| 4  | Max   | 90000  | 1            |</span><br><span class="line">+----+-------+--------+--------------+</span><br></pre></td></tr></table></figure><p><code>Department</code> è¡¨åŒ…å«å…¬å¸æ‰€æœ‰éƒ¨é—¨çš„ä¿¡æ¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+----+----------+</span><br><span class="line">| Id | Name     |</span><br><span class="line">+----+----------+</span><br><span class="line">| 1  | IT       |</span><br><span class="line">| 2  | Sales    |</span><br><span class="line">+----+----------+</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ‰¾å‡ºæ¯ä¸ªéƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥ã€‚ä¾‹å¦‚ï¼Œæ ¹æ®ä¸Šè¿°ç»™å®šçš„è¡¨æ ¼ï¼ŒMax åœ¨ IT éƒ¨é—¨æœ‰æœ€é«˜å·¥èµ„ï¼ŒHenry åœ¨ Sales éƒ¨é—¨æœ‰æœ€é«˜å·¥èµ„ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">------------+----------+--------+</span></span><br><span class="line"><span class="operator">|</span> Department <span class="operator">|</span> Employee <span class="operator">|</span> Salary <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+----------+--------+</span></span><br><span class="line"><span class="operator">|</span> IT         <span class="operator">|</span> Max      <span class="operator">|</span> <span class="number">90000</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Sales      <span class="operator">|</span> Henry    <span class="operator">|</span> <span class="number">80000</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+----------+--------+</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> Department,Employee,Salary</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span> d.Name  Department,e.Name Employee, e.Salary,</span><br><span class="line"><span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> d.id <span class="keyword">order</span> <span class="keyword">by</span> Salary <span class="keyword">desc</span>) rk</span><br><span class="line"><span class="keyword">from</span> Employee e <span class="keyword">join</span> Department d</span><br><span class="line"><span class="keyword">on</span> e.DepartmentId<span class="operator">=</span>d.id</span><br><span class="line">)tmp</span><br><span class="line"><span class="keyword">where</span> rk <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="185-éƒ¨é—¨å·¥èµ„å‰ä¸‰é«˜çš„æ‰€æœ‰å‘˜å·¥"><a href="#185-éƒ¨é—¨å·¥èµ„å‰ä¸‰é«˜çš„æ‰€æœ‰å‘˜å·¥" class="headerlink" title="185. éƒ¨é—¨å·¥èµ„å‰ä¸‰é«˜çš„æ‰€æœ‰å‘˜å·¥"></a><a href="https://leetcode-cn.com/problems/department-top-three-salaries/">185. éƒ¨é—¨å·¥èµ„å‰ä¸‰é«˜çš„æ‰€æœ‰å‘˜å·¥</a></h4><p>éš¾åº¦å›°éš¾</p><p>SQLæ¶æ„</p><p><code>Employee</code> è¡¨åŒ…å«æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ï¼Œæ¯ä¸ªå‘˜å·¥æœ‰å…¶å¯¹åº”çš„å·¥å· <code>Id</code>ï¼Œå§“å <code>Name</code>ï¼Œå·¥èµ„ <code>Salary</code> å’Œéƒ¨é—¨ç¼–å· <code>DepartmentId</code> ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+----+-------+--------+--------------+</span><br><span class="line">| Id | Name  | Salary | DepartmentId |</span><br><span class="line">+----+-------+--------+--------------+</span><br><span class="line">| 1  | Joe   | 85000  | 1            |</span><br><span class="line">| 2  | Henry | 80000  | 2            |</span><br><span class="line">| 3  | Sam   | 60000  | 2            |</span><br><span class="line">| 4  | Max   | 90000  | 1            |</span><br><span class="line">| 5  | Janet | 69000  | 1            |</span><br><span class="line">| 6  | Randy | 85000  | 1            |</span><br><span class="line">| 7  | Will  | 70000  | 1            |</span><br><span class="line">+----+-------+--------+--------------+</span><br></pre></td></tr></table></figure><p><code>Department</code> è¡¨åŒ…å«å…¬å¸æ‰€æœ‰éƒ¨é—¨çš„ä¿¡æ¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+----+----------+</span><br><span class="line">| Id | Name     |</span><br><span class="line">+----+----------+</span><br><span class="line">| 1  | IT       |</span><br><span class="line">| 2  | Sales    |</span><br><span class="line">+----+----------+</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ‰¾å‡ºæ¯ä¸ªéƒ¨é—¨è·å¾—å‰ä¸‰é«˜å·¥èµ„çš„æ‰€æœ‰å‘˜å·¥ã€‚ä¾‹å¦‚ï¼Œæ ¹æ®ä¸Šè¿°ç»™å®šçš„è¡¨ï¼ŒæŸ¥è¯¢ç»“æœåº”è¿”å›ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+------------+----------+--------+</span><br><span class="line">| Department | Employee | Salary |</span><br><span class="line">+------------+----------+--------+</span><br><span class="line">| IT         | Max      | 90000  |</span><br><span class="line">| IT         | Randy    | 85000  |</span><br><span class="line">| IT         | Joe      | 85000  |</span><br><span class="line">| IT         | Will     | 70000  |</span><br><span class="line">| Sales      | Henry    | 80000  |</span><br><span class="line">| Sales      | Sam      | 60000  |</span><br><span class="line">+------------+----------+--------+</span><br></pre></td></tr></table></figure><p><strong>è§£é‡Šï¼š</strong></p><p>IT éƒ¨é—¨ä¸­ï¼ŒMax è·å¾—äº†æœ€é«˜çš„å·¥èµ„ï¼ŒRandy å’Œ Joe éƒ½æ‹¿åˆ°äº†ç¬¬äºŒé«˜çš„å·¥èµ„ï¼ŒWill çš„å·¥èµ„æ’ç¬¬ä¸‰ã€‚é”€å”®éƒ¨é—¨ï¼ˆSalesï¼‰åªæœ‰ä¸¤åå‘˜å·¥ï¼ŒHenry çš„å·¥èµ„æœ€é«˜ï¼ŒSam çš„å·¥èµ„æ’ç¬¬äºŒã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> Department,Employee,Salary</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span> d.Name  Department,e.Name Employee, e.Salary,</span><br><span class="line"><span class="built_in">dense_rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> d.id <span class="keyword">order</span> <span class="keyword">by</span> Salary <span class="keyword">desc</span>) rk</span><br><span class="line"><span class="keyword">from</span> Employee e <span class="keyword">join</span> Department d</span><br><span class="line"><span class="keyword">on</span> e.DepartmentId<span class="operator">=</span>d.id</span><br><span class="line">)tmp</span><br><span class="line"><span class="keyword">where</span> rk <span class="operator">&lt;=</span><span class="number">3</span></span><br></pre></td></tr></table></figure><h4 id="196-åˆ é™¤é‡å¤çš„ç”µå­é‚®ç®±"><a href="#196-åˆ é™¤é‡å¤çš„ç”µå­é‚®ç®±" class="headerlink" title="196. åˆ é™¤é‡å¤çš„ç”µå­é‚®ç®±"></a><a href="https://leetcode-cn.com/problems/delete-duplicate-emails/">196. åˆ é™¤é‡å¤çš„ç”µå­é‚®ç®±</a></h4><p>éš¾åº¦ç®€å•</p><p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ¥åˆ é™¤ <code>Person</code> è¡¨ä¸­æ‰€æœ‰é‡å¤çš„ç”µå­é‚®ç®±ï¼Œé‡å¤çš„é‚®ç®±é‡Œåªä¿ç•™ <strong>Id</strong> <em>æœ€å°</em> çš„é‚£ä¸ªã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----+------------------+</span><br><span class="line">| Id | Email            |</span><br><span class="line">+----+------------------+</span><br><span class="line">| 1  | john@example.com |</span><br><span class="line">| 2  | bob@example.com  |</span><br><span class="line">| 3  | john@example.com |</span><br><span class="line">+----+------------------+</span><br><span class="line">Id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œåœ¨è¿è¡Œä½ çš„æŸ¥è¯¢è¯­å¥ä¹‹åï¼Œä¸Šé¢çš„ <code>Person</code> è¡¨åº”è¿”å›ä»¥ä¸‹å‡ è¡Œ:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+----+------------------+</span><br><span class="line">| Id | Email            |</span><br><span class="line">+----+------------------+</span><br><span class="line">| 1  | john@example.com |</span><br><span class="line">| 2  | bob@example.com  |</span><br><span class="line">+----+------------------+</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><p>æ‰§è¡Œ SQL ä¹‹åï¼Œè¾“å‡ºæ˜¯æ•´ä¸ª <code>Person</code> è¡¨ã€‚</p></li><li><p>ä½¿ç”¨ <code>delete</code> è¯­å¥ã€‚</p></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> p1 <span class="keyword">FROM</span> Person p1,</span><br><span class="line">    Person p2</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    p1.Email <span class="operator">=</span> p2.Email <span class="keyword">AND</span> p1.Id <span class="operator">&gt;</span> p2.Id</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„æ˜¯åˆ é™¤ ï¼Œä¸æ˜¯æŸ¥è¯¢</p></blockquote><h4 id="197-ä¸Šå‡çš„æ¸©åº¦"><a href="#197-ä¸Šå‡çš„æ¸©åº¦" class="headerlink" title="197. ä¸Šå‡çš„æ¸©åº¦"></a><a href="https://leetcode-cn.com/problems/rising-temperature/">197. ä¸Šå‡çš„æ¸©åº¦</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>ç»™å®šä¸€ä¸ª <code>Weather</code> è¡¨ï¼Œç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ¥æŸ¥æ‰¾ä¸ä¹‹å‰ï¼ˆæ˜¨å¤©çš„ï¼‰æ—¥æœŸç›¸æ¯”æ¸©åº¦æ›´é«˜çš„æ‰€æœ‰æ—¥æœŸçš„ Idã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------+------------------+------------------+</span><br><span class="line">| Id(INT) | RecordDate(DATE) | Temperature(INT) |</span><br><span class="line">+---------+------------------+------------------+</span><br><span class="line">|       1 |       2015-01-01 |               10 |</span><br><span class="line">|       2 |       2015-01-02 |               25 |</span><br><span class="line">|       3 |       2015-01-03 |               20 |</span><br><span class="line">|       4 |       2015-01-04 |               30 |</span><br><span class="line">+---------+------------------+------------------+</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œæ ¹æ®ä¸Šè¿°ç»™å®šçš„ <code>Weather</code> è¡¨æ ¼ï¼Œè¿”å›å¦‚ä¸‹ Id:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">----+</span></span><br><span class="line"><span class="operator">|</span> Id <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">Id</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> Id,RecordDate,Temperature,</span><br><span class="line"><span class="built_in">lag</span>(RecordDate,<span class="number">1</span>,<span class="number">9999</span><span class="number">-99</span><span class="number">-99</span>) <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> RecordDate) yd,</span><br><span class="line"><span class="built_in">lag</span>(Temperature,<span class="number">1</span>,<span class="number">999</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> RecordDate ) yt</span><br><span class="line"><span class="keyword">from</span> Weather </span><br><span class="line">)tmp</span><br><span class="line"><span class="keyword">where</span> Temperature <span class="operator">&gt;</span>yt</span><br><span class="line"><span class="keyword">and</span> datediff(RecordDate,yd)<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.Id <span class="keyword">from</span> Weather a ,Weather b </span><br><span class="line">    <span class="keyword">where</span> a.Temperature <span class="operator">&gt;</span> b.Temperature </span><br><span class="line">    <span class="keyword">and</span> datediff(a.RecordDate,b.RecordDate) <span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure><h4 id="262-è¡Œç¨‹å’Œç”¨æˆ·"><a href="#262-è¡Œç¨‹å’Œç”¨æˆ·" class="headerlink" title="262. è¡Œç¨‹å’Œç”¨æˆ·"></a><a href="https://leetcode-cn.com/problems/trips-and-users/">262. è¡Œç¨‹å’Œç”¨æˆ·</a></h4><p>éš¾åº¦å›°éš¾</p><p>SQLæ¶æ„</p><p><code>Trips</code> è¡¨ä¸­å­˜æ‰€æœ‰å‡ºç§Ÿè½¦çš„è¡Œç¨‹ä¿¡æ¯ã€‚æ¯æ®µè¡Œç¨‹æœ‰å”¯ä¸€é”® Idï¼ŒClient_Id å’Œ Driver_Id æ˜¯ <code>Users</code> è¡¨ä¸­ Users_Id çš„å¤–é”®ã€‚Status æ˜¯æšä¸¾ç±»å‹ï¼Œæšä¸¾æˆå‘˜ä¸º (â€˜completedâ€™, â€˜cancelled_by_driverâ€™, â€˜cancelled_by_clientâ€™)ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">+----+-----------+-----------+---------+--------------------+----------+</span><br><span class="line">| Id | Client_Id | Driver_Id | City_Id |        Status      |Request_at|</span><br><span class="line">+----+-----------+-----------+---------+--------------------+----------+</span><br><span class="line">| 1  |     1     |    10     |    1    |     completed      |2013-10-01|</span><br><span class="line">| 2  |     2     |    11     |    1    | cancelled_by_driver|2013-10-01|</span><br><span class="line">| 3  |     3     |    12     |    6    |     completed      |2013-10-01|</span><br><span class="line">| 4  |     4     |    13     |    6    | cancelled_by_client|2013-10-01|</span><br><span class="line">| 5  |     1     |    10     |    1    |     completed      |2013-10-02|</span><br><span class="line">| 6  |     2     |    11     |    6    |     completed      |2013-10-02|</span><br><span class="line">| 7  |     3     |    12     |    6    |     completed      |2013-10-02|</span><br><span class="line">| 8  |     2     |    12     |    12   |     completed      |2013-10-03|</span><br><span class="line">| 9  |     3     |    10     |    12   |     completed      |2013-10-03| </span><br><span class="line">| 10 |     4     |    13     |    12   | cancelled_by_driver|2013-10-03|</span><br><span class="line">+----+-----------+-----------+---------+--------------------+----------+</span><br></pre></td></tr></table></figure><p><code>Users</code> è¡¨å­˜æ‰€æœ‰ç”¨æˆ·ã€‚æ¯ä¸ªç”¨æˆ·æœ‰å”¯ä¸€é”® Users_Idã€‚Banned è¡¨ç¤ºè¿™ä¸ªç”¨æˆ·æ˜¯å¦è¢«ç¦æ­¢ï¼ŒRole åˆ™æ˜¯ä¸€ä¸ªè¡¨ç¤ºï¼ˆâ€˜clientâ€™, â€˜driverâ€™, â€˜partnerâ€™ï¼‰çš„æšä¸¾ç±»å‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+----------+--------+--------+</span><br><span class="line">| Users_Id | Banned |  Role  |</span><br><span class="line">+----------+--------+--------+</span><br><span class="line">|    1     |   No   | client |</span><br><span class="line">|    2     |   Yes  | client |</span><br><span class="line">|    3     |   No   | client |</span><br><span class="line">|    4     |   No   | client |</span><br><span class="line">|    10    |   No   | driver |</span><br><span class="line">|    11    |   No   | driver |</span><br><span class="line">|    12    |   No   | driver |</span><br><span class="line">|    13    |   No   | driver |</span><br><span class="line">+----------+--------+--------+</span><br></pre></td></tr></table></figure><p>å†™ä¸€æ®µ SQL è¯­å¥æŸ¥å‡º <strong>2013å¹´10æœˆ1æ—¥</strong> è‡³ <strong>2013å¹´10æœˆ3æ—¥</strong> æœŸé—´éç¦æ­¢ç”¨æˆ·çš„å–æ¶ˆç‡ã€‚åŸºäºä¸Šè¡¨ï¼Œä½ çš„ SQL è¯­å¥åº”è¿”å›å¦‚ä¸‹ç»“æœï¼Œå–æ¶ˆç‡ï¼ˆCancellation Rateï¼‰ä¿ç•™ä¸¤ä½å°æ•°ã€‚</p><p>å–æ¶ˆç‡çš„è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š(è¢«å¸æœºæˆ–ä¹˜å®¢å–æ¶ˆçš„éç¦æ­¢ç”¨æˆ·ç”Ÿæˆçš„è®¢å•æ•°é‡) / (éç¦æ­¢ç”¨æˆ·ç”Ÿæˆçš„è®¢å•æ€»æ•°)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">------------+-------------------+</span></span><br><span class="line"><span class="operator">|</span>     <span class="keyword">Day</span>    <span class="operator">|</span> Cancellation Rate <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2013</span><span class="number">-10</span><span class="number">-01</span> <span class="operator">|</span>       <span class="number">0.33</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2013</span><span class="number">-10</span><span class="number">-02</span> <span class="operator">|</span>       <span class="number">0.00</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2013</span><span class="number">-10</span><span class="number">-03</span> <span class="operator">|</span>       <span class="number">0.50</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-------------------+</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> T.request_at <span class="keyword">AS</span> `<span class="keyword">Day</span>`, </span><br><span class="line">ROUND(</span><br><span class="line"><span class="built_in">SUM</span>(</span><br><span class="line">IF(T.STATUS <span class="operator">=</span> <span class="string">&#x27;completed&#x27;</span>,<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">)</span><br><span class="line"><span class="operator">/</span> </span><br><span class="line"><span class="built_in">COUNT</span>(T.STATUS),</span><br><span class="line"><span class="number">2</span></span><br><span class="line">) <span class="keyword">AS</span> `Cancellation Rate`</span><br><span class="line"><span class="keyword">FROM</span> trips <span class="keyword">AS</span> T</span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line">T.Client_Id <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line"><span class="keyword">SELECT</span> users_id</span><br><span class="line"><span class="keyword">FROM</span> users</span><br><span class="line"><span class="keyword">WHERE</span> banned <span class="operator">=</span> <span class="string">&#x27;Yes&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">AND</span></span><br><span class="line">T.Driver_Id <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line"><span class="keyword">SELECT</span> users_id</span><br><span class="line"><span class="keyword">FROM</span> users</span><br><span class="line"><span class="keyword">WHERE</span> banned <span class="operator">=</span> <span class="string">&#x27;Yes&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">AND</span> T.request_at <span class="keyword">BETWEEN</span> <span class="string">&#x27;2013-10-01&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2013-10-03&#x27;</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> T.request_at</span><br></pre></td></tr></table></figure><h4 id="511-æ¸¸æˆç©æ³•åˆ†æ-I"><a href="#511-æ¸¸æˆç©æ³•åˆ†æ-I" class="headerlink" title="511. æ¸¸æˆç©æ³•åˆ†æ I"></a><a href="https://leetcode-cn.com/problems/game-play-analysis-i/">511. æ¸¸æˆç©æ³•åˆ†æ I</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>æ´»åŠ¨è¡¨ <code>Activity</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| player_id    | int     |</span><br><span class="line">| device_id    | int     |</span><br><span class="line">| event_date   | date    |</span><br><span class="line">| games_played | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">è¡¨çš„ä¸»é”®æ˜¯ (player_id, event_date)ã€‚</span><br><span class="line">è¿™å¼ è¡¨å±•ç¤ºäº†ä¸€äº›æ¸¸æˆç©å®¶åœ¨æ¸¸æˆå¹³å°ä¸Šçš„è¡Œä¸ºæ´»åŠ¨ã€‚</span><br><span class="line">æ¯è¡Œæ•°æ®è®°å½•äº†ä¸€åç©å®¶åœ¨é€€å‡ºå¹³å°ä¹‹å‰ï¼Œå½“å¤©ä½¿ç”¨åŒä¸€å°è®¾å¤‡ç™»å½•å¹³å°åæ‰“å¼€çš„æ¸¸æˆçš„æ•°ç›®ï¼ˆå¯èƒ½æ˜¯ 0 ä¸ªï¼‰ã€‚</span><br></pre></td></tr></table></figure><p>å†™ä¸€æ¡ SQL æŸ¥è¯¢è¯­å¥è·å–æ¯ä½ç©å®¶ <strong>ç¬¬ä¸€æ¬¡ç™»é™†å¹³å°çš„æ—¥æœŸ</strong>ã€‚</p><p>æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Activity è¡¨ï¼š</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| player_id | device_id | event_date | games_played |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| 1         | 2         | 2016-03-01 | 5            |</span><br><span class="line">| 1         | 2         | 2016-05-02 | 6            |</span><br><span class="line">| 2         | 3         | 2017-06-25 | 1            |</span><br><span class="line">| 3         | 1         | 2016-03-02 | 0            |</span><br><span class="line">| 3         | 4         | 2018-07-03 | 5            |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+-----------+-------------+</span><br><span class="line">| player_id | first_login |</span><br><span class="line">+-----------+-------------+</span><br><span class="line">| 1         | 2016-03-01  |</span><br><span class="line">| 2         | 2017-06-25  |</span><br><span class="line">| 3         | 2016-03-02  |</span><br><span class="line">+-----------+-------------+</span><br></pre></td></tr></table></figure><p>1.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> player_id ,event_date first_login</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span> player_id ,event_date,</span><br><span class="line"><span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> player_id <span class="keyword">order</span> <span class="keyword">by</span> event_date) rk</span><br><span class="line"><span class="keyword">from</span> Activity</span><br><span class="line">) tmp</span><br><span class="line"><span class="keyword">where</span> rk <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>2.æœ€ä¼˜ ï¼ˆé€‰æœ€å°æ—¥æœŸï¼‰</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> player_id ,<span class="built_in">min</span>(event_date) first_login</span><br><span class="line"><span class="keyword">from</span> Activity</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> player_id </span><br></pre></td></tr></table></figure><h4 id="512-æ¸¸æˆç©æ³•åˆ†æ-II"><a href="#512-æ¸¸æˆç©æ³•åˆ†æ-II" class="headerlink" title="512. æ¸¸æˆç©æ³•åˆ†æ II"></a><a href="https://leetcode-cn.com/problems/game-play-analysis-ii/">512. æ¸¸æˆç©æ³•åˆ†æ II</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>Table: <code>Activity</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| player_id    | int     |</span><br><span class="line">| device_id    | int     |</span><br><span class="line">| event_date   | date    |</span><br><span class="line">| games_played | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">(player_id, event_date) æ˜¯è¿™ä¸ªè¡¨çš„ä¸¤ä¸ªä¸»é”®</span><br><span class="line">è¿™ä¸ªè¡¨æ˜¾ç¤ºçš„æ˜¯æŸäº›æ¸¸æˆç©å®¶çš„æ¸¸æˆæ´»åŠ¨æƒ…å†µ</span><br><span class="line">æ¯ä¸€è¡Œæ˜¯åœ¨æŸå¤©ä½¿ç”¨æŸä¸ªè®¾å¤‡ç™»å‡ºä¹‹å‰ç™»å½•å¹¶ç©å¤šä¸ªæ¸¸æˆï¼ˆå¯èƒ½ä¸º0ï¼‰çš„ç©å®¶çš„è®°å½•</span><br></pre></td></tr></table></figure><p>è¯·ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæè¿°æ¯ä¸€ä¸ªç©å®¶é¦–æ¬¡ç™»é™†çš„è®¾å¤‡åç§°</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Activity table:</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| player_id | device_id | event_date | games_played |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| 1         | 2         | 2016-03-01 | 5            |</span><br><span class="line">| 1         | 2         | 2016-05-02 | 6            |</span><br><span class="line">| 2         | 3         | 2017-06-25 | 1            |</span><br><span class="line">| 3         | 1         | 2016-03-02 | 0            |</span><br><span class="line">| 3         | 4         | 2018-07-03 | 5            |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-----------+-----------+</span><br><span class="line">| player_id | device_id |</span><br><span class="line">+-----------+-----------+</span><br><span class="line">| 1         | 2         |</span><br><span class="line">| 2         | 3         |</span><br><span class="line">| 3         | 1         |</span><br><span class="line">+-----------+-----------+</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> player_id ,device_id</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span> player_id ,event_date,device_id,</span><br><span class="line"><span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> player_id <span class="keyword">order</span> <span class="keyword">by</span> event_date) rk</span><br><span class="line"><span class="keyword">from</span> Activity</span><br><span class="line">) tmp</span><br><span class="line"><span class="keyword">where</span> rk <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="534-æ¸¸æˆç©æ³•åˆ†æ-III"><a href="#534-æ¸¸æˆç©æ³•åˆ†æ-III" class="headerlink" title="534. æ¸¸æˆç©æ³•åˆ†æ III"></a><a href="https://leetcode-cn.com/problems/game-play-analysis-iii/">534. æ¸¸æˆç©æ³•åˆ†æ III</a></h4><p>éš¾åº¦ä¸­ç­‰20æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡å…³æ³¨åé¦ˆ</p><p>SQLæ¶æ„</p><p>Table: <code>Activity</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| player_id    | int     |</span><br><span class="line">| device_id    | int     |</span><br><span class="line">| event_date   | date    |</span><br><span class="line">| games_played | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">ï¼ˆplayer_idï¼Œevent_dateï¼‰æ˜¯æ­¤è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¿™å¼ è¡¨æ˜¾ç¤ºäº†æŸäº›æ¸¸æˆçš„ç©å®¶çš„æ´»åŠ¨æƒ…å†µã€‚</span><br><span class="line">æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªç©å®¶çš„è®°å½•ï¼Œä»–åœ¨æŸä¸€å¤©ä½¿ç”¨æŸä¸ªè®¾å¤‡æ³¨é”€ä¹‹å‰ç™»å½•å¹¶ç©äº†å¾ˆå¤šæ¸¸æˆï¼ˆå¯èƒ½æ˜¯ 0 ï¼‰ã€‚</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒåŒæ—¶æŠ¥å‘Šæ¯ç»„ç©å®¶å’Œæ—¥æœŸï¼Œä»¥åŠç©å®¶åˆ°ç›®å‰ä¸ºæ­¢ç©äº†å¤šå°‘æ¸¸æˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ­¤æ—¥æœŸä¹‹å‰ç©å®¶æ‰€ç©çš„æ¸¸æˆæ€»æ•°ã€‚è¯¦ç»†æƒ…å†µè¯·æŸ¥çœ‹ç¤ºä¾‹ã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Activity table:</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| player_id | device_id | event_date | games_played |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| 1         | 2         | 2016-03-01 | 5            |</span><br><span class="line">| 1         | 2         | 2016-05-02 | 6            |</span><br><span class="line">| 1         | 3         | 2017-06-25 | 1            |</span><br><span class="line">| 3         | 1         | 2016-03-02 | 0            |</span><br><span class="line">| 3         | 4         | 2018-07-03 | 5            |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-----------+------------+---------------------+</span><br><span class="line">| player_id | event_date | games_played_so_far |</span><br><span class="line">+-----------+------------+---------------------+</span><br><span class="line">| 1         | 2016-03-01 | 5                   |</span><br><span class="line">| 1         | 2016-05-02 | 11                  |</span><br><span class="line">| 1         | 2017-06-25 | 12                  |</span><br><span class="line">| 3         | 2016-03-02 | 0                   |</span><br><span class="line">| 3         | 2018-07-03 | 5                   |</span><br><span class="line">+-----------+------------+---------------------+</span><br><span class="line">å¯¹äº ID ä¸º 1 çš„ç©å®¶ï¼Œ2016-05-02 å…±ç©äº† 5+6=11 ä¸ªæ¸¸æˆï¼Œ2017-06-25 å…±ç©äº† 5+6+1=12 ä¸ªæ¸¸æˆã€‚</span><br><span class="line">å¯¹äº ID ä¸º 3 çš„ç©å®¶ï¼Œ2018-07-03 å…±ç©äº† 0+5=5 ä¸ªæ¸¸æˆã€‚</span><br><span class="line">è¯·æ³¨æ„ï¼Œå¯¹äºæ¯ä¸ªç©å®¶ï¼Œæˆ‘ä»¬åªå…³å¿ƒç©å®¶çš„ç™»å½•æ—¥æœŸã€‚</span><br></pre></td></tr></table></figure><p>å¼€çª—</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> player_id,event_date ,</span><br><span class="line"><span class="built_in">sum</span>(games_played) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> player_id <span class="keyword">order</span> <span class="keyword">by</span>  event_date )games_played_so_far</span><br><span class="line"><span class="keyword">from</span> Activity</span><br></pre></td></tr></table></figure><p>è‡ªè¿æ¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    a1.player_id,</span><br><span class="line">    a1.event_date,</span><br><span class="line">    <span class="built_in">sum</span>(a2.games_played) games_played_so_far</span><br><span class="line"><span class="keyword">from</span> Activity a1,Activity a2</span><br><span class="line"><span class="keyword">where</span> a1.player_id<span class="operator">=</span>a2.player_id <span class="keyword">and</span> </span><br><span class="line">      a1.event_date<span class="operator">&gt;=</span>a2.event_date</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="number">1</span>,<span class="number">2</span>;</span><br></pre></td></tr></table></figure><h4 id="550-æ¸¸æˆç©æ³•åˆ†æ-IV"><a href="#550-æ¸¸æˆç©æ³•åˆ†æ-IV" class="headerlink" title="550. æ¸¸æˆç©æ³•åˆ†æ IV"></a><a href="https://leetcode-cn.com/problems/game-play-analysis-iv/">550. æ¸¸æˆç©æ³•åˆ†æ IV</a></h4><p>éš¾åº¦ä¸­ç­‰17æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡å…³æ³¨åé¦ˆ</p><p>SQLæ¶æ„</p><p>Table: <code>Activity</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| player_id    | int     |</span><br><span class="line">| device_id    | int     |</span><br><span class="line">| event_date   | date    |</span><br><span class="line">| games_played | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">ï¼ˆplayer_idï¼Œevent_dateï¼‰æ˜¯æ­¤è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¿™å¼ è¡¨æ˜¾ç¤ºäº†æŸäº›æ¸¸æˆçš„ç©å®¶çš„æ´»åŠ¨æƒ…å†µã€‚</span><br><span class="line">æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªç©å®¶çš„è®°å½•ï¼Œä»–åœ¨æŸä¸€å¤©ä½¿ç”¨æŸä¸ªè®¾å¤‡æ³¨é”€ä¹‹å‰ç™»å½•å¹¶ç©äº†å¾ˆå¤šæ¸¸æˆï¼ˆå¯èƒ½æ˜¯ 0ï¼‰ã€‚</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒæŠ¥å‘Šåœ¨é¦–æ¬¡ç™»å½•çš„ç¬¬äºŒå¤©å†æ¬¡ç™»å½•çš„ç©å®¶çš„åˆ†æ•°ï¼Œå››èˆäº”å…¥åˆ°å°æ•°ç‚¹åä¸¤ä½ã€‚æ¢å¥è¯è¯´ï¼Œæ‚¨éœ€è¦è®¡ç®—ä»é¦–æ¬¡ç™»å½•æ—¥æœŸå¼€å§‹è‡³å°‘è¿ç»­ä¸¤å¤©ç™»å½•çš„ç©å®¶çš„æ•°é‡ï¼Œç„¶åé™¤ä»¥ç©å®¶æ€»æ•°ã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Activity table:</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| player_id | device_id | event_date | games_played |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| 1         | 2         | 2016-03-01 | 5            |</span><br><span class="line">| 1         | 2         | 2016-03-02 | 6            |</span><br><span class="line">| 2         | 3         | 2017-06-25 | 1            |</span><br><span class="line">| 3         | 1         | 2016-03-02 | 0            |</span><br><span class="line">| 3         | 4         | 2018-07-03 | 5            |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-----------+</span><br><span class="line">| fraction  |</span><br><span class="line">+-----------+</span><br><span class="line">| 0.33      |</span><br><span class="line">+-----------+</span><br><span class="line">åªæœ‰ ID ä¸º 1 çš„ç©å®¶åœ¨ç¬¬ä¸€å¤©ç™»å½•åæ‰é‡æ–°ç™»å½•ï¼Œæ‰€ä»¥ç­”æ¡ˆæ˜¯ 1/3 = 0.33</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> round(<span class="built_in">avg</span>(a.event_date <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>), <span class="number">2</span>) fraction</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">    (<span class="keyword">select</span> player_id, <span class="built_in">min</span>(event_date) <span class="keyword">as</span> login</span><br><span class="line">    <span class="keyword">from</span> activity</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> player_id) p </span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> activity a </span><br><span class="line"><span class="keyword">on</span> p.player_id<span class="operator">=</span>a.player_id <span class="keyword">and</span> datediff(a.event_date, p.login)<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure><blockquote><p>è¿™ä¸ªavgç”¨çš„å¦™</p><p>is not nullåˆ¤æ–­åï¼Œæœ‰eventdateå€¼çš„è¿”å›1ï¼Œnullçš„è¿”å›0ï¼Œavgç›¸å½“äºæ±‚å’Œå(å³ç¬¦åˆæ¡ä»¶çš„idä¸ªæ•°)é™¤ä»¥æ€»idæ•°å³æ‰€æ±‚æ¯”ä¾‹</p></blockquote><h4 id="569-å‘˜å·¥è–ªæ°´ä¸­ä½æ•°"><a href="#569-å‘˜å·¥è–ªæ°´ä¸­ä½æ•°" class="headerlink" title="569. å‘˜å·¥è–ªæ°´ä¸­ä½æ•°"></a><a href="https://leetcode-cn.com/problems/median-employee-salary/">569. å‘˜å·¥è–ªæ°´ä¸­ä½æ•°</a></h4><p>éš¾åº¦å›°éš¾</p><p>SQLæ¶æ„</p><p><code>Employee</code> è¡¨åŒ…å«æ‰€æœ‰å‘˜å·¥ã€‚<code>Employee</code> è¡¨æœ‰ä¸‰åˆ—ï¼šå‘˜å·¥Idï¼Œå…¬å¸åå’Œè–ªæ°´ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">+-----+------------+--------+</span><br><span class="line">|Id   | Company    | Salary |</span><br><span class="line">+-----+------------+--------+</span><br><span class="line">|1    | A          | 2341   |</span><br><span class="line">|2    | A          | 341    |</span><br><span class="line">|3    | A          | 15     |</span><br><span class="line">|4    | A          | 15314  |</span><br><span class="line">|5    | A          | 451    |</span><br><span class="line">|6    | A          | 513    |</span><br><span class="line">|7    | B          | 15     |</span><br><span class="line">|8    | B          | 13     |</span><br><span class="line">|9    | B          | 1154   |</span><br><span class="line">|10   | B          | 1345   |</span><br><span class="line">|11   | B          | 1221   |</span><br><span class="line">|12   | B          | 234    |</span><br><span class="line">|13   | C          | 2345   |</span><br><span class="line">|14   | C          | 2645   |</span><br><span class="line">|15   | C          | 2645   |</span><br><span class="line">|16   | C          | 2652   |</span><br><span class="line">|17   | C          | 65     |</span><br><span class="line">+-----+------------+--------+</span><br></pre></td></tr></table></figure><p>è¯·ç¼–å†™SQLæŸ¥è¯¢æ¥æŸ¥æ‰¾æ¯ä¸ªå…¬å¸çš„è–ªæ°´ä¸­ä½æ•°ã€‚æŒ‘æˆ˜ç‚¹ï¼šä½ æ˜¯å¦å¯ä»¥åœ¨ä¸ä½¿ç”¨ä»»ä½•å†…ç½®çš„SQLå‡½æ•°çš„æƒ…å†µä¸‹è§£å†³æ­¤é—®é¢˜ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-----+------------+--------+</span><br><span class="line">|Id   | Company    | Salary |</span><br><span class="line">+-----+------------+--------+</span><br><span class="line">|5    | A          | 451    |</span><br><span class="line">|6    | A          | 513    |</span><br><span class="line">|12   | B          | 234    |</span><br><span class="line">|9    | B          | 1154   |</span><br><span class="line">|14   | C          | 2645   |</span><br><span class="line">+-----+------------+--------+</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> Id,Company,Salary</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span> Id,Company,Salary,</span><br><span class="line"><span class="built_in">ROW_NUMBER</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> Company <span class="keyword">order</span> <span class="keyword">by</span> Salary) rk,</span><br><span class="line"><span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> Company) cnt</span><br><span class="line"><span class="keyword">from</span> Employee</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> rk <span class="keyword">IN</span> (<span class="built_in">FLOOR</span>((cnt <span class="operator">+</span> <span class="number">1</span>)<span class="operator">/</span><span class="number">2</span>), <span class="built_in">FLOOR</span>((cnt <span class="operator">+</span> <span class="number">2</span>)<span class="operator">/</span><span class="number">2</span>))</span><br></pre></td></tr></table></figure><blockquote><p>ä¸­ä½æ•°ï¼š</p><p>+1å‘ä¸‹å–æ•´ +2 å‘ä¸‹å–æ•´æ•°</p></blockquote><h4 id="570-è‡³å°‘æœ‰5åç›´æ¥ä¸‹å±çš„ç»ç†"><a href="#570-è‡³å°‘æœ‰5åç›´æ¥ä¸‹å±çš„ç»ç†" class="headerlink" title="570. è‡³å°‘æœ‰5åç›´æ¥ä¸‹å±çš„ç»ç†"></a><a href="https://leetcode-cn.com/problems/managers-with-at-least-5-direct-reports/">570. è‡³å°‘æœ‰5åç›´æ¥ä¸‹å±çš„ç»ç†</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p><code>Employee</code> è¡¨åŒ…å«æ‰€æœ‰å‘˜å·¥å’Œä»–ä»¬çš„ç»ç†ã€‚æ¯ä¸ªå‘˜å·¥éƒ½æœ‰ä¸€ä¸ª Idï¼Œå¹¶ä¸”è¿˜æœ‰ä¸€åˆ—æ˜¯ç»ç†çš„ Idã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+------+----------+-----------+----------+</span><br><span class="line">|Id    |Name   |Department |ManagerId |</span><br><span class="line">+------+----------+-----------+----------+</span><br><span class="line">|101   |John   |A       |null      |</span><br><span class="line">|102   |Dan   |A       |101       |</span><br><span class="line">|103   |James   |A       |101       |</span><br><span class="line">|104   |Amy   |A       |101       |</span><br><span class="line">|105   |Anne   |A       |101       |</span><br><span class="line">|106   |Ron   |B       |101       |</span><br><span class="line">+------+----------+-----------+----------+</span><br></pre></td></tr></table></figure><p>ç»™å®š <code>Employee</code> è¡¨ï¼Œè¯·ç¼–å†™ä¸€ä¸ªSQLæŸ¥è¯¢æ¥æŸ¥æ‰¾è‡³å°‘æœ‰5åç›´æ¥ä¸‹å±çš„ç»ç†ã€‚å¯¹äºä¸Šè¡¨ï¼Œæ‚¨çš„SQLæŸ¥è¯¢åº”è¯¥è¿”å›ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+-------+</span><br><span class="line">| Name  |</span><br><span class="line">+-------+</span><br><span class="line">| John  |</span><br><span class="line">+-------+</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„:</strong><br>æ²¡æœ‰äººæ˜¯è‡ªå·±çš„ä¸‹å±ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> Name</span><br><span class="line"><span class="keyword">from</span> Employee</span><br><span class="line"><span class="keyword">where</span> Id <span class="keyword">in</span> (</span><br><span class="line"><span class="keyword">select</span> ManagerId</span><br><span class="line"><span class="keyword">from</span> Employee</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> ManagerId</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">&gt;=</span><span class="number">5</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="571-ç»™å®šæ•°å­—çš„é¢‘ç‡æŸ¥è¯¢ä¸­ä½æ•°"><a href="#571-ç»™å®šæ•°å­—çš„é¢‘ç‡æŸ¥è¯¢ä¸­ä½æ•°" class="headerlink" title="571. ç»™å®šæ•°å­—çš„é¢‘ç‡æŸ¥è¯¢ä¸­ä½æ•°"></a><a href="https://leetcode-cn.com/problems/find-median-given-frequency-of-numbers/">571. ç»™å®šæ•°å­—çš„é¢‘ç‡æŸ¥è¯¢ä¸­ä½æ•°</a></h4><p>éš¾åº¦å›°éš¾</p><p>SQLæ¶æ„</p><p><code>Numbers</code> è¡¨ä¿å­˜æ•°å­—çš„å€¼åŠå…¶é¢‘ç‡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----------+-------------+</span><br><span class="line">|  Number  |  Frequency  |</span><br><span class="line">+----------+-------------|</span><br><span class="line">|  0       |  7          |</span><br><span class="line">|  1       |  1          |</span><br><span class="line">|  2       |  3          |</span><br><span class="line">|  3       |  1          |</span><br><span class="line">+----------+-------------+</span><br></pre></td></tr></table></figure><p>åœ¨æ­¤è¡¨ä¸­ï¼Œæ•°å­—ä¸º <code>0, 0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 3</code>ï¼Œæ‰€ä»¥ä¸­ä½æ•°æ˜¯ <code>(0 + 0) / 2 = 0</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+--------+</span><br><span class="line">| median |</span><br><span class="line">+--------|</span><br><span class="line">| 0.0000 |</span><br><span class="line">+--------+</span><br></pre></td></tr></table></figure><p>è¯·ç¼–å†™ä¸€ä¸ªæŸ¥è¯¢æ¥æŸ¥æ‰¾æ‰€æœ‰æ•°å­—çš„ä¸­ä½æ•°å¹¶å°†ç»“æœå‘½åä¸º <code>median</code> ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    <span class="built_in">avg</span>(<span class="built_in">cast</span>(number <span class="keyword">as</span> <span class="type">float</span>)) median</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> </span><br><span class="line">            Number,</span><br><span class="line">            Frequency,</span><br><span class="line">            <span class="built_in">sum</span>(Frequency) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> Number) <span class="operator">-</span> Frequency prev_sum,</span><br><span class="line">            <span class="built_in">sum</span>(Frequency) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> Number) curr_sum</span><br><span class="line">        <span class="keyword">from</span> Numbers</span><br><span class="line">    ) t1,</span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> </span><br><span class="line">            <span class="built_in">sum</span>(Frequency) total_sum</span><br><span class="line">        <span class="keyword">from</span> Numbers</span><br><span class="line">    ) t2</span><br><span class="line"><span class="keyword">where</span> </span><br><span class="line">    t1.prev_sum <span class="operator">&lt;=</span> (<span class="built_in">cast</span>(t2.total_sum <span class="keyword">as</span> <span class="type">float</span>) <span class="operator">/</span> <span class="number">2</span>) <span class="keyword">and</span> </span><br><span class="line">    t1.curr_sum <span class="operator">&gt;=</span> (<span class="built_in">cast</span>(t2.total_sum <span class="keyword">as</span> <span class="type">float</span>) <span class="operator">/</span> <span class="number">2</span>)</span><br></pre></td></tr></table></figure><p>å¦‚æœ n1.Number ä¸ºä¸­ä½æ•°ï¼Œn1.Numberï¼ˆåŒ…å«æœ¬èº«ï¼‰å‰ç´¯è®¡çš„æ•°å­—åº”å¤§äºç­‰äºæ€»æ•°/2 åŒæ—¶n1.Numberï¼ˆä¸åŒ…å«æœ¬èº«ï¼‰å‰ç´¯è®¡æ•°å­—åº”å°äºç­‰äºæ€»æ•°/2</p><p>ä¾‹å¦‚ï¼š0, 0, 0, 0, 0, 0, 0, 1, 2, 2, 2, 3 å…±12ä¸ªæ•°</p><p> ä¸­ä½æ•°0ï¼ˆåŒ…å«æœ¬èº«ï¼‰å‰ç´¯è®¡çš„æ•°å­— 7 &gt;=6  0ï¼ˆä¸åŒ…å«æœ¬èº«ï¼‰å‰ç´¯è®¡æ•°å­— 0 &lt;=6<br>ä¾‹å¦‚ï¼š0ï¼Œ0ï¼Œ0ï¼Œ3ï¼Œ3ï¼Œ3 å…±6ä¸ªæ•°</p><p> ä¸­ä½æ•°0ï¼ˆåŒ…å«æœ¬èº«ï¼‰å‰ç´¯è®¡çš„æ•°å­— 3 &gt;=3  0ï¼ˆä¸åŒ…å«æœ¬èº«ï¼‰å‰ç´¯è®¡æ•°å­— 0 &lt;=3</p><p> ä¸­ä½æ•°3ï¼ˆåŒ…å«æœ¬èº«ï¼‰å‰ç´¯è®¡çš„æ•°å­— 6 &gt;=3  3ï¼ˆä¸åŒ…å«æœ¬èº«ï¼‰å‰ç´¯è®¡æ•°å­— 3 &lt;=3</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"><span class="built_in">AVG</span>(Number)median </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">(<span class="keyword">SELECT</span> n1.Number <span class="keyword">FROM</span> Numbers n1 <span class="keyword">JOIN</span> Numbers n2 <span class="keyword">ON</span> n1.Number<span class="operator">&gt;=</span>n2.Number </span><br><span class="line"> <span class="keyword">GROUP</span> <span class="keyword">BY</span> </span><br><span class="line"> n1.Number </span><br><span class="line"> <span class="keyword">HAVING</span> </span><br><span class="line"> <span class="built_in">SUM</span>(n2.Frequency)<span class="operator">&gt;=</span>(<span class="keyword">SELECT</span> <span class="built_in">SUM</span>(Frequency) <span class="keyword">FROM</span> Numbers)<span class="operator">/</span><span class="number">2</span> </span><br><span class="line"> <span class="keyword">AND</span> </span><br><span class="line"> <span class="built_in">SUM</span>(n2.Frequency)<span class="operator">-</span><span class="built_in">AVG</span>(n1.Frequency)<span class="operator">&lt;=</span>(<span class="keyword">SELECT</span> <span class="built_in">SUM</span>(Frequency) <span class="keyword">FROM</span> Numbers)<span class="operator">/</span><span class="number">2</span></span><br><span class="line">)s</span><br></pre></td></tr></table></figure><h4 id="574-å½“é€‰è€…"><a href="#574-å½“é€‰è€…" class="headerlink" title="574. å½“é€‰è€…"></a><a href="https://leetcode-cn.com/problems/winning-candidate/">574. å½“é€‰è€…</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>è¡¨: <code>Candidate</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-----+---------+</span><br><span class="line">| id  | Name    |</span><br><span class="line">+-----+---------+</span><br><span class="line">| 1   | A       |</span><br><span class="line">| 2   | B       |</span><br><span class="line">| 3   | C       |</span><br><span class="line">| 4   | D       |</span><br><span class="line">| 5   | E       |</span><br><span class="line">+-----+---------+  </span><br></pre></td></tr></table></figure><p>è¡¨: <code>Vote</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+-----+--------------+</span><br><span class="line">| id  | CandidateId  |</span><br><span class="line">+-----+--------------+</span><br><span class="line">| 1   |     2        |</span><br><span class="line">| 2   |     4        |</span><br><span class="line">| 3   |     3        |</span><br><span class="line">| 4   |     2        |</span><br><span class="line">| 5   |     5        |</span><br><span class="line">+-----+--------------+</span><br><span class="line">id æ˜¯è‡ªåŠ¨é€’å¢çš„ä¸»é”®ï¼Œ</span><br><span class="line">CandidateId æ˜¯ Candidate è¡¨ä¸­çš„ id.</span><br></pre></td></tr></table></figure><p>è¯·ç¼–å†™ sql è¯­å¥æ¥æ‰¾åˆ°å½“é€‰è€…çš„åå­—ï¼Œä¸Šé¢çš„ä¾‹å­å°†è¿”å›å½“é€‰è€… <code>B</code>.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+------+</span><br><span class="line">| Name |</span><br><span class="line">+------+</span><br><span class="line">| B    |</span><br><span class="line">+------+</span><br></pre></td></tr></table></figure><p>ç”¨äº†order by å…¨å±€æ’åº ä¸å¤Ÿå¥½</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    Name</span><br><span class="line"><span class="keyword">from</span> Candidate c</span><br><span class="line">    <span class="keyword">left</span> <span class="keyword">join</span> Vote v</span><br><span class="line">    <span class="keyword">on</span> c.id <span class="operator">=</span> v.CandidateId</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> Name</span><br><span class="line">    <span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">desc</span></span><br><span class="line">    limit <span class="number">1</span>   </span><br></pre></td></tr></table></figure><p>å…ˆè¿‡æ»¤å†  æ•ˆç‡é«˜å¾ˆå¤š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> Name</span><br><span class="line"><span class="keyword">from</span> Candidate</span><br><span class="line"><span class="keyword">where</span> id <span class="operator">=</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> CandidateId</span><br><span class="line">    <span class="keyword">from</span>    </span><br><span class="line">        (</span><br><span class="line">        <span class="keyword">select</span> CandidateId, </span><br><span class="line">        <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> CandidateId ) cnt</span><br><span class="line">        <span class="keyword">from</span> Vote</span><br><span class="line">        <span class="keyword">order</span> <span class="keyword">by</span> cnt <span class="keyword">desc</span> </span><br><span class="line">        limit <span class="number">1</span></span><br><span class="line">        )t1</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="577-å‘˜å·¥å¥–é‡‘"><a href="#577-å‘˜å·¥å¥–é‡‘" class="headerlink" title="577. å‘˜å·¥å¥–é‡‘"></a><a href="https://leetcode-cn.com/problems/employee-bonus/">577. å‘˜å·¥å¥–é‡‘</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>é€‰å‡ºæ‰€æœ‰ bonus &lt; 1000 çš„å‘˜å·¥çš„ name åŠå…¶ bonusã€‚</p><p><code>Employee</code> è¡¨å•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-------+--------+-----------+--------+</span><br><span class="line">| empId |  name  | supervisor| salary |</span><br><span class="line">+-------+--------+-----------+--------+</span><br><span class="line">|   1   | John   |  3        | 1000   |</span><br><span class="line">|   2   | Dan    |  3        | 2000   |</span><br><span class="line">|   3   | Brad   |  null     | 4000   |</span><br><span class="line">|   4   | Thomas |  3        | 4000   |</span><br><span class="line">+-------+--------+-----------+--------+</span><br><span class="line">empId æ˜¯è¿™å¼ è¡¨å•çš„ä¸»å…³é”®å­—</span><br></pre></td></tr></table></figure><p><code>Bonus</code> è¡¨å•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+-------+-------+</span><br><span class="line">| empId | bonus |</span><br><span class="line">+-------+-------+</span><br><span class="line">| 2     | 500   |</span><br><span class="line">| 4     | 2000  |</span><br><span class="line">+-------+-------+</span><br><span class="line">empId æ˜¯è¿™å¼ è¡¨å•çš„ä¸»å…³é”®å­—</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+-------+-------+</span><br><span class="line">| name  | bonus |</span><br><span class="line">+-------+-------+</span><br><span class="line">| John  | null  |</span><br><span class="line">| Dan   | 500   |</span><br><span class="line">| Brad  | null  |</span><br><span class="line">+-------+-------+</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name,bonus</span><br><span class="line"><span class="keyword">from</span> Employee e</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Bonus b <span class="keyword">on</span>  e.empId<span class="operator">=</span>b.empId</span><br><span class="line"><span class="keyword">where</span> bonus<span class="operator">&lt;</span><span class="number">1000</span> <span class="keyword">or</span> bonus <span class="keyword">is</span> <span class="keyword">null</span></span><br></pre></td></tr></table></figure><h4 id="578-æŸ¥è¯¢å›ç­”ç‡æœ€é«˜çš„é—®é¢˜"><a href="#578-æŸ¥è¯¢å›ç­”ç‡æœ€é«˜çš„é—®é¢˜" class="headerlink" title="578. æŸ¥è¯¢å›ç­”ç‡æœ€é«˜çš„é—®é¢˜"></a><a href="https://leetcode-cn.com/problems/get-highest-answer-rate-question/">578. æŸ¥è¯¢å›ç­”ç‡æœ€é«˜çš„é—®é¢˜</a></h4><p>éš¾åº¦ä¸­ç­‰3æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡å…³æ³¨åé¦ˆ</p><p>SQLæ¶æ„</p><p>ä» <code>survey_log</code> è¡¨ä¸­è·å¾—å›ç­”ç‡æœ€é«˜çš„é—®é¢˜ï¼Œ<code>survey_log</code> è¡¨åŒ…å«è¿™äº›åˆ—<strong>ï¼šid</strong>, <strong>action</strong>, <strong>question_id</strong>, <strong>answer_id</strong>, <strong>q_num</strong>, <strong>timestamp</strong>ã€‚</p><p>id è¡¨ç¤ºç”¨æˆ· idï¼›action æœ‰ä»¥ä¸‹å‡ ç§å€¼ï¼šâ€showâ€ï¼Œâ€answerâ€ï¼Œâ€skipâ€ï¼›å½“ action å€¼ä¸º â€œanswerâ€ æ—¶ answer_id éç©ºï¼Œè€Œ action å€¼ä¸º â€œshowâ€ æˆ–è€… â€œskipâ€ æ—¶ answer_id ä¸ºç©ºï¼›q_num è¡¨ç¤ºå½“å‰ä¼šè¯ä¸­é—®é¢˜çš„ç¼–å·ã€‚</p><p>è¯·ç¼–å†™ SQL æŸ¥è¯¢æ¥æ‰¾åˆ°å…·æœ‰æœ€é«˜å›ç­”ç‡çš„é—®é¢˜ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š</span><br><span class="line">+------+-----------+--------------+------------+-----------+------------+</span><br><span class="line">| id   | action    | question_id  | answer_id  | q_num     | timestamp  |</span><br><span class="line">+------+-----------+--------------+------------+-----------+------------+</span><br><span class="line">| 5    | show      | 285          | null       | 1         | 123        |</span><br><span class="line">| 5    | answer    | 285          | 124124     | 1         | 124        |</span><br><span class="line">| 5    | show      | 369          | null       | 2         | 125        |</span><br><span class="line">| 5    | skip      | 369          | null       | 2         | 126        |</span><br><span class="line">+------+-----------+--------------+------------+-----------+------------+</span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">+-------------+</span><br><span class="line">| survey_log  |</span><br><span class="line">+-------------+</span><br><span class="line">|    285      |</span><br><span class="line">+-------------+</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">é—®é¢˜ 285 çš„å›ç­”ç‡ä¸º 1/1ï¼Œè€Œé—®é¢˜ 369 å›ç­”ç‡ä¸º 0/1ï¼Œå› æ­¤è¾“å‡º 285 ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> question_id  survey_log</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">  <span class="keyword">select</span></span><br><span class="line">      question_id,</span><br><span class="line">      <span class="built_in">sum</span>(if(action <span class="operator">=</span> <span class="string">&#x27;answer&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) <span class="keyword">as</span> AnswerCnt,</span><br><span class="line">      <span class="built_in">sum</span>(if(action <span class="operator">=</span> <span class="string">&#x27;show&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) <span class="keyword">as</span> ShowCnt</span><br><span class="line">  <span class="keyword">from</span></span><br><span class="line">      survey_log</span><br><span class="line">  <span class="keyword">group</span> <span class="keyword">by</span> question_id</span><br><span class="line">) <span class="keyword">as</span> tbl</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> (AnswerCnt <span class="operator">/</span> ShowCnt) <span class="keyword">desc</span></span><br><span class="line">limit <span class="number">1</span></span><br></pre></td></tr></table></figure><p>ç›´æ¥ä¸åµŒå¥—</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> question_id  survey_log</span><br><span class="line"><span class="keyword">from</span> survey_log</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> question_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">sum</span>(if(action <span class="operator">=</span> <span class="string">&#x27;answer&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) <span class="operator">/</span> <span class="built_in">sum</span>(if(action <span class="operator">=</span> <span class="string">&#x27;show&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>)) <span class="keyword">desc</span></span><br><span class="line">limit <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="579-æŸ¥è¯¢å‘˜å·¥çš„ç´¯è®¡è–ªæ°´"><a href="#579-æŸ¥è¯¢å‘˜å·¥çš„ç´¯è®¡è–ªæ°´" class="headerlink" title="579. æŸ¥è¯¢å‘˜å·¥çš„ç´¯è®¡è–ªæ°´"></a><a href="https://leetcode-cn.com/problems/find-cumulative-salary-of-an-employee/">579. æŸ¥è¯¢å‘˜å·¥çš„ç´¯è®¡è–ªæ°´</a></h4><p>éš¾åº¦å›°éš¾</p><p>SQLæ¶æ„</p><p><strong>Employee</strong> è¡¨ä¿å­˜äº†ä¸€å¹´å†…çš„è–ªæ°´ä¿¡æ¯ã€‚</p><p>è¯·ä½ ç¼–å†™ SQL è¯­å¥ï¼Œå¯¹äºæ¯ä¸ªå‘˜å·¥ï¼ŒæŸ¥è¯¢ä»–é™¤æœ€è¿‘ä¸€ä¸ªæœˆï¼ˆå³æœ€å¤§æœˆï¼‰ä¹‹å¤–ï¼Œå‰©ä¸‹æ¯ä¸ªæœˆçš„è¿‘ä¸‰ä¸ªæœˆçš„ç´¯è®¡è–ªæ°´ï¼ˆä¸è¶³ä¸‰ä¸ªæœˆä¹Ÿè¦è®¡ç®—ï¼‰ã€‚</p><p>ç»“æœè¯·æŒ‰ <code>Id</code> å‡åºï¼Œç„¶åæŒ‰ <code>Month</code> é™åºæ˜¾ç¤ºã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong><br><strong>è¾“å…¥ï¼š</strong></p><table><thead><tr><th>Id</th><th>Month</th><th>Salary</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>20</td></tr><tr><td>2</td><td>1</td><td>20</td></tr><tr><td>1</td><td>2</td><td>30</td></tr><tr><td>2</td><td>2</td><td>30</td></tr><tr><td>3</td><td>2</td><td>40</td></tr><tr><td>1</td><td>3</td><td>40</td></tr><tr><td>3</td><td>3</td><td>60</td></tr><tr><td>1</td><td>4</td><td>60</td></tr><tr><td>3</td><td>4</td><td>70</td></tr></tbody></table><p><strong>è¾“å‡ºï¼š</strong></p><table><thead><tr><th>Id</th><th>Month</th><th>Salary</th></tr></thead><tbody><tr><td>1</td><td>3</td><td>90</td></tr><tr><td>1</td><td>2</td><td>50</td></tr><tr><td>1</td><td>1</td><td>20</td></tr><tr><td>2</td><td>1</td><td>20</td></tr><tr><td>3</td><td>3</td><td>100</td></tr><tr><td>3</td><td>2</td><td>40</td></tr></tbody></table><p><strong>è§£é‡Šï¼š</strong></p><p>å‘˜å·¥ â€˜1â€™ é™¤å»æœ€è¿‘ä¸€ä¸ªæœˆï¼ˆæœˆä»½ â€˜4â€™ï¼‰ï¼Œæœ‰ä¸‰ä¸ªæœˆçš„è–ªæ°´è®°å½•ï¼šæœˆä»½ â€˜3â€™ è–ªæ°´ä¸º 40ï¼Œæœˆä»½ â€˜2â€™ è–ªæ°´ä¸º 30ï¼Œæœˆä»½ â€˜1â€™ è–ªæ°´ä¸º 20ã€‚</p><p>æ‰€ä»¥è¿‘ 3 ä¸ªæœˆçš„è–ªæ°´ç´¯è®¡åˆ†åˆ«ä¸º (40 + 30 + 20) = 90ï¼Œ(30 + 20) = 50 å’Œ 20ã€‚</p><table><thead><tr><th>Id</th><th>Month</th><th>Salary</th></tr></thead><tbody><tr><td>1</td><td>3</td><td>90</td></tr><tr><td>1</td><td>2</td><td>50</td></tr><tr><td>1</td><td>1</td><td>20</td></tr></tbody></table><p>å‘˜å·¥ â€˜2â€™ é™¤å»æœ€è¿‘çš„ä¸€ä¸ªæœˆï¼ˆæœˆä»½ â€˜2â€™ï¼‰çš„è¯ï¼Œåªæœ‰æœˆä»½ â€˜1â€™ è¿™ä¸€ä¸ªæœˆçš„è–ªæ°´è®°å½•ã€‚</p><table><thead><tr><th>Id</th><th>Month</th><th>Salary</th></tr></thead><tbody><tr><td>2</td><td>1</td><td>20</td></tr></tbody></table><p>å‘˜å·¥ â€˜3â€™ é™¤å»æœ€è¿‘ä¸€ä¸ªæœˆï¼ˆæœˆä»½ â€˜4â€™ï¼‰åæœ‰ä¸¤ä¸ªæœˆï¼Œåˆ†åˆ«ä¸ºï¼šæœˆä»½ â€˜4â€™ è–ªæ°´ä¸º 60 å’Œ æœˆä»½ â€˜2â€™ è–ªæ°´ä¸º 40ã€‚æ‰€ä»¥å„æœˆçš„ç´¯è®¡æƒ…å†µå¦‚ä¸‹ï¼š</p><table><thead><tr><th>Id</th><th>Month</th><th>Salary</th></tr></thead><tbody><tr><td>3</td><td>3</td><td>100</td></tr><tr><td>3</td><td>2</td><td>40</td></tr></tbody></table><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> Id,<span class="keyword">Month</span>,</span><br><span class="line"><span class="built_in">sum</span>(Salary) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> Id <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">Month</span> <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="number">2</span> PRECEDING <span class="keyword">AND</span> <span class="keyword">CURRENT</span> <span class="type">ROW</span>) Salary</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> Id,<span class="keyword">Month</span>,Salary,</span><br><span class="line">    <span class="built_in">lead</span>(<span class="keyword">Month</span>,<span class="number">1</span>,<span class="number">0</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> Id <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">Month</span>) lm</span><br><span class="line">    <span class="keyword">from</span> Employee </span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> lm <span class="operator">!=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span>  Id,<span class="keyword">Month</span> <span class="keyword">desc</span></span><br></pre></td></tr></table></figure><h4 id="580-ç»Ÿè®¡å„ä¸“ä¸šå­¦ç”Ÿäººæ•°"><a href="#580-ç»Ÿè®¡å„ä¸“ä¸šå­¦ç”Ÿäººæ•°" class="headerlink" title="580. ç»Ÿè®¡å„ä¸“ä¸šå­¦ç”Ÿäººæ•°"></a><a href="https://leetcode-cn.com/problems/count-student-number-in-departments/">580. ç»Ÿè®¡å„ä¸“ä¸šå­¦ç”Ÿäººæ•°</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>ä¸€æ‰€å¤§å­¦æœ‰ 2 ä¸ªæ•°æ®è¡¨ï¼Œåˆ†åˆ«æ˜¯ <em><strong>student</strong></em> å’Œ <em><strong>department</strong></em> ï¼Œè¿™ä¸¤ä¸ªè¡¨ä¿å­˜ç€æ¯ä¸ªä¸“ä¸šçš„å­¦ç”Ÿæ•°æ®å’Œé™¢ç³»æ•°æ®ã€‚</p><p>å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼ŒæŸ¥è¯¢ <em><strong>department</strong></em> è¡¨ä¸­æ¯ä¸ªä¸“ä¸šçš„å­¦ç”Ÿäººæ•° ï¼ˆå³ä½¿æ²¡æœ‰å­¦ç”Ÿçš„ä¸“ä¸šä¹Ÿéœ€åˆ—å‡ºï¼‰ã€‚</p><p>å°†ä½ çš„æŸ¥è¯¢ç»“æœæŒ‰ç…§å­¦ç”Ÿäººæ•°é™åºæ’åˆ—ã€‚ å¦‚æœæœ‰ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šä¸“ä¸šæœ‰ç›¸åŒçš„å­¦ç”Ÿæ•°ç›®ï¼Œå°†è¿™äº›éƒ¨é—¨æŒ‰ç…§éƒ¨é—¨åå­—çš„å­—å…¸åºä»å°åˆ°å¤§æ’åˆ—ã€‚</p><p>*<strong>student*</strong> è¡¨æ ¼å¦‚ä¸‹ï¼š</p><table><thead><tr><th>Column Name</th><th>Type</th></tr></thead><tbody><tr><td>student_id</td><td>Integer</td></tr><tr><td>student_name</td><td>String</td></tr><tr><td>gender</td><td>Character</td></tr><tr><td>dept_id</td><td>Integer</td></tr></tbody></table><p>å…¶ä¸­ï¼Œ student_id æ˜¯å­¦ç”Ÿçš„å­¦å·ï¼Œ student_name æ˜¯å­¦ç”Ÿçš„å§“åï¼Œ gender æ˜¯å­¦ç”Ÿçš„æ€§åˆ«ï¼Œ dept_id æ˜¯å­¦ç”Ÿæ‰€å±ä¸“ä¸šçš„ä¸“ä¸šç¼–å·ã€‚</p><p>*<strong>department*</strong> è¡¨æ ¼å¦‚ä¸‹ï¼š</p><table><thead><tr><th>Column Name</th><th>Type</th></tr></thead><tbody><tr><td>dept_id</td><td>Integer</td></tr><tr><td>dept_name</td><td>String</td></tr></tbody></table><p>dept_id æ˜¯ä¸“ä¸šç¼–å·ï¼Œ dept_name æ˜¯ä¸“ä¸šåå­—ã€‚</p><p>è¿™é‡Œæ˜¯ä¸€ä¸ªç¤ºä¾‹è¾“å…¥ï¼š<br>*<strong>student*</strong> è¡¨æ ¼ï¼š</p><table><thead><tr><th>student_id</th><th>student_name</th><th>gender</th><th>dept_id</th></tr></thead><tbody><tr><td>1</td><td>Jack</td><td>M</td><td>1</td></tr><tr><td>2</td><td>Jane</td><td>F</td><td>1</td></tr><tr><td>3</td><td>Mark</td><td>M</td><td>2</td></tr></tbody></table><p>*<strong>department*</strong> è¡¨æ ¼ï¼š</p><table><thead><tr><th>dept_id</th><th>dept_name</th></tr></thead><tbody><tr><td>1</td><td>Engineering</td></tr><tr><td>2</td><td>Science</td></tr><tr><td>3</td><td>Law</td></tr></tbody></table><p>ç¤ºä¾‹è¾“å‡ºä¸ºï¼š</p><table><thead><tr><th>dept_name</th><th>student_number</th></tr></thead><tbody><tr><td>Engineering</td><td>2</td></tr><tr><td>Science</td><td>1</td></tr><tr><td>Law</td><td>0</td></tr></tbody></table><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  dept_name ,<span class="built_in">count</span>(student_id) student_number</span><br><span class="line"><span class="keyword">from</span> department d <span class="keyword">left</span> <span class="keyword">join</span> student s</span><br><span class="line"><span class="keyword">on</span> d.dept_id<span class="operator">=</span>s.dept_id </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> dept_name</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> student_number <span class="keyword">desc</span></span><br></pre></td></tr></table></figure><h4 id="584-å¯»æ‰¾ç”¨æˆ·æ¨èäºº"><a href="#584-å¯»æ‰¾ç”¨æˆ·æ¨èäºº" class="headerlink" title="584. å¯»æ‰¾ç”¨æˆ·æ¨èäºº"></a><a href="https://leetcode-cn.com/problems/find-customer-referee/">584. å¯»æ‰¾ç”¨æˆ·æ¨èäºº</a></h4><p>éš¾åº¦ç®€å•9æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡å…³æ³¨åé¦ˆ</p><p>SQLæ¶æ„</p><p>ç»™å®šè¡¨ <code>customer</code> ï¼Œé‡Œé¢ä¿å­˜äº†æ‰€æœ‰å®¢æˆ·ä¿¡æ¯å’Œä»–ä»¬çš„æ¨èäººã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+------+------+-----------+</span><br><span class="line">| id   | name | referee_id|</span><br><span class="line">+------+------+-----------+</span><br><span class="line">|    1 | Will |      NULL |</span><br><span class="line">|    2 | Jane |      NULL |</span><br><span class="line">|    3 | Alex |         2 |</span><br><span class="line">|    4 | Bill |      NULL |</span><br><span class="line">|    5 | Zack |         1 |</span><br><span class="line">|    6 | Mark |         2 |</span><br><span class="line">+------+------+-----------+</span><br></pre></td></tr></table></figure><p>å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œè¿”å›ä¸€ä¸ªç¼–å·åˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­ç¼–å·çš„æ¨èäººçš„ç¼–å·éƒ½ <strong>ä¸æ˜¯</strong> 2ã€‚</p><p>å¯¹äºä¸Šé¢çš„ç¤ºä¾‹æ•°æ®ï¼Œç»“æœä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+------+</span><br><span class="line">| name |</span><br><span class="line">+------+</span><br><span class="line">| Will |</span><br><span class="line">| Jane |</span><br><span class="line">| Bill |</span><br><span class="line">| Zack |</span><br><span class="line">+------+</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> customer <span class="keyword">WHERE</span> referee_id <span class="operator">!=</span> <span class="number">2</span> <span class="keyword">OR</span> referee_id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure><blockquote><p>MySQL ä½¿ç”¨ä¸‰å€¼é€»è¾‘ â€”â€” TRUE, FALSE å’Œ UNKNOWNã€‚ä»»ä½•ä¸ NULL å€¼è¿›è¡Œçš„æ¯”è¾ƒéƒ½ä¼šä¸ç¬¬ä¸‰ç§å€¼ UNKNOWN åšæ¯”è¾ƒã€‚è¿™ä¸ªâ€œä»»ä½•å€¼â€åŒ…æ‹¬ NULL æœ¬èº«ï¼è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ MySQL æä¾› IS NULL å’Œ IS NOT NULL ä¸¤ç§æ“ä½œæ¥å¯¹ NULL ç‰¹æ®Šåˆ¤æ–­ã€‚</p><p>å› æ­¤ï¼Œåœ¨ WHERE è¯­å¥ä¸­æˆ‘ä»¬éœ€è¦åšä¸€ä¸ªé¢å¤–çš„æ¡ä»¶åˆ¤æ–­ `referee_id IS NULLâ€™ã€‚</p></blockquote><h4 id="585-2016å¹´çš„æŠ•èµ„"><a href="#585-2016å¹´çš„æŠ•èµ„" class="headerlink" title="585. 2016å¹´çš„æŠ•èµ„"></a><a href="https://leetcode-cn.com/problems/investments-in-2016/">585. 2016å¹´çš„æŠ•èµ„</a></h4><p>éš¾åº¦ä¸­ç­‰14æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡å…³æ³¨åé¦ˆ</p><p>SQLæ¶æ„</p><p>å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œå°† 2016 å¹´ (<strong>TIV_2016</strong>) æ‰€æœ‰æˆåŠŸæŠ•èµ„çš„é‡‘é¢åŠ èµ·æ¥ï¼Œä¿ç•™ 2 ä½å°æ•°ã€‚</p><p>å¯¹äºä¸€ä¸ªæŠ•ä¿äººï¼Œä»–åœ¨ 2016 å¹´æˆåŠŸæŠ•èµ„çš„æ¡ä»¶æ˜¯ï¼š</p><ol><li>ä»–åœ¨ 2015 å¹´çš„æŠ•ä¿é¢ (<strong>TIV_2015</strong>) è‡³å°‘è·Ÿä¸€ä¸ªå…¶ä»–æŠ•ä¿äººåœ¨ 2015 å¹´çš„æŠ•ä¿é¢ç›¸åŒã€‚</li><li>ä»–æ‰€åœ¨çš„åŸå¸‚å¿…é¡»ä¸å…¶ä»–æŠ•ä¿äººéƒ½ä¸åŒï¼ˆä¹Ÿå°±æ˜¯è¯´ç»´åº¦å’Œç»åº¦ä¸èƒ½è·Ÿå…¶ä»–ä»»ä½•ä¸€ä¸ªæŠ•ä¿äººå®Œå…¨ç›¸åŒï¼‰ã€‚</li></ol><p><strong>è¾“å…¥æ ¼å¼:</strong><br>è¡¨ *<strong>insurance*</strong> æ ¼å¼å¦‚ä¸‹ï¼š</p><table><thead><tr><th>Column Name</th><th>Type</th></tr></thead><tbody><tr><td>PID</td><td>INTEGER(11)</td></tr><tr><td>TIV_2015</td><td>NUMERIC(15,2)</td></tr><tr><td>TIV_2016</td><td>NUMERIC(15,2)</td></tr><tr><td>LAT</td><td>NUMERIC(5,2)</td></tr><tr><td>LON</td><td>NUMERIC(5,2)</td></tr></tbody></table><p><strong>PID</strong> å­—æ®µæ˜¯æŠ•ä¿äººçš„æŠ•ä¿ç¼–å·ï¼Œ <strong>TIV_2015</strong> æ˜¯è¯¥æŠ•ä¿äººåœ¨2015å¹´çš„æ€»æŠ•ä¿é‡‘é¢ï¼Œ <strong>TIV_2016</strong> æ˜¯è¯¥æŠ•ä¿äººåœ¨2016å¹´çš„æŠ•ä¿é‡‘é¢ï¼Œ <strong>LAT</strong> æ˜¯æŠ•ä¿äººæ‰€åœ¨åŸå¸‚çš„ç»´åº¦ï¼Œ <strong>LON</strong> æ˜¯æŠ•ä¿äººæ‰€åœ¨åŸå¸‚çš„ç»åº¦ã€‚</p><p><strong>æ ·ä¾‹è¾“å…¥</strong></p><table><thead><tr><th>PID</th><th>TIV_2015</th><th>TIV_2016</th><th>LAT</th><th>LON</th></tr></thead><tbody><tr><td>1</td><td>10</td><td>5</td><td>10</td><td>10</td></tr><tr><td>2</td><td>20</td><td>20</td><td>20</td><td>20</td></tr><tr><td>3</td><td>10</td><td>30</td><td>20</td><td>20</td></tr><tr><td>4</td><td>10</td><td>40</td><td>40</td><td>40</td></tr></tbody></table><p><strong>æ ·ä¾‹è¾“å‡º</strong></p><table><thead><tr><th>TIV_2016</th></tr></thead><tbody><tr><td>45.00</td></tr></tbody></table><p><strong>è§£é‡Š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">å°±å¦‚æœ€åä¸€ä¸ªæŠ•ä¿äººï¼Œç¬¬ä¸€ä¸ªæŠ•ä¿äººåŒæ—¶æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</span><br><span class="line">1. ä»–åœ¨ 2015 å¹´çš„æŠ•ä¿é‡‘é¢ TIV_2015 ä¸º &#x27;10&#x27; ï¼Œä¸ç¬¬ä¸‰ä¸ªå’Œç¬¬å››ä¸ªæŠ•ä¿äººåœ¨ 2015 å¹´çš„æŠ•ä¿é‡‘é¢ç›¸åŒã€‚</span><br><span class="line">2. ä»–æ‰€åœ¨åŸå¸‚çš„ç»çº¬åº¦æ˜¯ç‹¬ä¸€æ— äºŒçš„ã€‚</span><br><span class="line"></span><br><span class="line">ç¬¬äºŒä¸ªæŠ•ä¿äººä¸¤ä¸ªæ¡ä»¶éƒ½ä¸æ»¡è¶³ã€‚ä»–åœ¨ 2015 å¹´çš„æŠ•èµ„ TIV_2015 ä¸å…¶ä»–ä»»ä½•æŠ•ä¿äººéƒ½ä¸ç›¸åŒã€‚</span><br><span class="line">ä¸”ä»–æ‰€åœ¨åŸå¸‚çš„ç»çº¬åº¦ä¸ç¬¬ä¸‰ä¸ªæŠ•ä¿äººç›¸åŒã€‚åŸºäºåŒæ ·çš„åŸå› ï¼Œç¬¬ä¸‰ä¸ªæŠ•ä¿äººæŠ•èµ„å¤±è´¥ã€‚</span><br><span class="line"></span><br><span class="line">æ‰€ä»¥è¿”å›çš„ç»“æœæ˜¯ç¬¬ä¸€ä¸ªæŠ•ä¿äººå’Œæœ€åä¸€ä¸ªæŠ•ä¿äººçš„ TIV_2016 ä¹‹å’Œï¼Œç»“æœæ˜¯ 45 ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(TIV_2016) TIV_2016</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> PID,TIV_2016,cnt,</span><br><span class="line">    <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> loc ) lcnt</span><br><span class="line">    <span class="keyword">from</span> (</span><br><span class="line">        <span class="keyword">select</span> PID,TIV_2016,</span><br><span class="line">        <span class="built_in">count</span>(TIV_2015) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> TIV_2015 ) cnt,</span><br><span class="line">        concat_ws(&quot;,&quot;,LAT,LON) loc</span><br><span class="line">        <span class="keyword">from</span> insurance </span><br><span class="line">    )t1</span><br><span class="line">)t2</span><br><span class="line"><span class="keyword">where</span> lcnt<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> cnt<span class="operator">!=</span><span class="number">1</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„å»é‡é¡ºåº ä¸è¦å…ˆå¯¹TIV_2015å»é‡  ä¸ç„¶ localå»é‡æ—¶ä¼šä¸¢å¤±æ•°æ®</p></blockquote><p>ä¼˜åŒ– çª—å£</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    ROUND(<span class="built_in">SUM</span>(TIV_2016), <span class="number">2</span>) <span class="keyword">as</span> TIV_2016</span><br><span class="line"><span class="keyword">FROM</span>(</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">        <span class="operator">*</span>,</span><br><span class="line">        <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> TIV_2015) <span class="keyword">as</span> cnt_1,</span><br><span class="line">        <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> LAT, LON) <span class="keyword">as</span> cnt_2</span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">        insurance</span><br><span class="line">) a </span><br><span class="line"><span class="keyword">WHERE</span> a.cnt_1 <span class="operator">&gt;</span> <span class="number">1</span> <span class="keyword">AND</span> a.cnt_2 <span class="operator">&lt;</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><h4 id="586-è®¢å•æœ€å¤šçš„å®¢æˆ·"><a href="#586-è®¢å•æœ€å¤šçš„å®¢æˆ·" class="headerlink" title="586. è®¢å•æœ€å¤šçš„å®¢æˆ·"></a><a href="https://leetcode-cn.com/problems/customer-placing-the-largest-number-of-orders/">586. è®¢å•æœ€å¤šçš„å®¢æˆ·</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>åœ¨è¡¨ <strong>orders</strong> ä¸­æ‰¾åˆ°è®¢å•æ•°æœ€å¤šå®¢æˆ·å¯¹åº”çš„ <strong>customer_number</strong> ã€‚</p><p>æ•°æ®ä¿è¯è®¢å•æ•°æœ€å¤šçš„é¡¾å®¢æ°å¥½åªæœ‰ä¸€ä½ã€‚</p><p>è¡¨ *<strong>orders*</strong> å®šä¹‰å¦‚ä¸‹ï¼š</p><table><thead><tr><th>Column</th><th>Type</th></tr></thead><tbody><tr><td>order_number (PK)</td><td>int</td></tr><tr><td>customer_number</td><td>int</td></tr><tr><td>order_date</td><td>date</td></tr><tr><td>required_date</td><td>date</td></tr><tr><td>shipped_date</td><td>date</td></tr><tr><td>status</td><td>char(15)</td></tr><tr><td>comment</td><td>char(200)</td></tr></tbody></table><p><strong>æ ·ä¾‹è¾“å…¥</strong></p><table><thead><tr><th>order_number</th><th>customer_number</th><th>order_date</th><th>required_date</th><th>shipped_date</th><th>status</th><th>comment</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>2017-04-09</td><td>2017-04-13</td><td>2017-04-12</td><td>Closed</td><td></td></tr><tr><td>2</td><td>2</td><td>2017-04-15</td><td>2017-04-20</td><td>2017-04-18</td><td>Closed</td><td></td></tr><tr><td>3</td><td>3</td><td>2017-04-16</td><td>2017-04-25</td><td>2017-04-20</td><td>Closed</td><td></td></tr><tr><td>4</td><td>3</td><td>2017-04-18</td><td>2017-04-28</td><td>2017-04-25</td><td>Closed</td><td></td></tr></tbody></table><p><strong>æ ·ä¾‹è¾“å‡º</strong></p><table><thead><tr><th>customer_number</th></tr></thead><tbody><tr><td>3</td></tr></tbody></table><p><strong>è§£é‡Š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">customer_number ä¸º &#x27;3&#x27; çš„é¡¾å®¢æœ‰ä¸¤ä¸ªè®¢å•ï¼Œæ¯”é¡¾å®¢ &#x27;1&#x27; æˆ–è€… &#x27;2&#x27; éƒ½è¦å¤šï¼Œå› ä¸ºä»–ä»¬åªæœ‰ä¸€ä¸ªè®¢å•</span><br><span class="line">æ‰€ä»¥ç»“æœæ˜¯è¯¥é¡¾å®¢çš„ customer_number ï¼Œä¹Ÿå°±æ˜¯ 3 ã€‚</span><br></pre></td></tr></table></figure><p><strong>è¿›é˜¶ï¼š</strong> å¦‚æœæœ‰å¤šä½é¡¾å®¢è®¢å•æ•°å¹¶åˆ—æœ€å¤šï¼Œä½ èƒ½æ‰¾åˆ°ä»–ä»¬æ‰€æœ‰çš„ customer_number å—ï¼Ÿ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> customer_number</span><br><span class="line"><span class="keyword">from</span> orders</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> customer_number </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">count</span>(<span class="operator">*</span>)  <span class="keyword">desc</span></span><br><span class="line">limit <span class="number">1</span></span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœ æ•°æ®é‡å¾ˆå¤§ order by ä¸å¤ªå¥½</p></blockquote><h4 id="595-å¤§çš„å›½å®¶"><a href="#595-å¤§çš„å›½å®¶" class="headerlink" title="595. å¤§çš„å›½å®¶"></a><a href="https://leetcode-cn.com/problems/big-countries/">595. å¤§çš„å›½å®¶</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>è¿™é‡Œæœ‰å¼  <code>World</code> è¡¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-----------------+------------+------------+--------------+---------------+</span><br><span class="line">| name            | continent  | area       | population   | gdp           |</span><br><span class="line">+-----------------+------------+------------+--------------+---------------+</span><br><span class="line">| Afghanistan     | Asia       | 652230     | 25500100     | 20343000      |</span><br><span class="line">| Albania         | Europe     | 28748      | 2831741      | 12960000      |</span><br><span class="line">| Algeria         | Africa     | 2381741    | 37100000     | 188681000     |</span><br><span class="line">| Andorra         | Europe     | 468        | 78115        | 3712000       |</span><br><span class="line">| Angola          | Africa     | 1246700    | 20609294     | 100990000     |</span><br><span class="line">+-----------------+------------+------------+--------------+---------------+</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸€ä¸ªå›½å®¶çš„é¢ç§¯è¶…è¿‡300ä¸‡å¹³æ–¹å…¬é‡Œï¼Œæˆ–è€…äººå£è¶…è¿‡2500ä¸‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå›½å®¶å°±æ˜¯å¤§å›½å®¶ã€‚</p><p>ç¼–å†™ä¸€ä¸ªSQLæŸ¥è¯¢ï¼Œè¾“å‡ºè¡¨ä¸­æ‰€æœ‰å¤§å›½å®¶çš„åç§°ã€äººå£å’Œé¢ç§¯ã€‚</p><p>ä¾‹å¦‚ï¼Œæ ¹æ®ä¸Šè¡¨ï¼Œæˆ‘ä»¬åº”è¯¥è¾“å‡º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+--------------+-------------+--------------+</span><br><span class="line">| name         | population  | area         |</span><br><span class="line">+--------------+-------------+--------------+</span><br><span class="line">| Afghanistan  | 25500100    | 652230       |</span><br><span class="line">| Algeria      | 37100000    | 2381741      |</span><br><span class="line">+--------------+-------------+--------------+</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  name ,population,area  </span><br><span class="line"><span class="keyword">from</span> World</span><br><span class="line"><span class="keyword">where</span> area  <span class="operator">&gt;</span><span class="number">3000000</span> <span class="keyword">or</span> population <span class="operator">&gt;</span><span class="number">25000000</span></span><br></pre></td></tr></table></figure><h4 id="596-è¶…è¿‡5åå­¦ç”Ÿçš„è¯¾"><a href="#596-è¶…è¿‡5åå­¦ç”Ÿçš„è¯¾" class="headerlink" title="596. è¶…è¿‡5åå­¦ç”Ÿçš„è¯¾"></a><a href="https://leetcode-cn.com/problems/classes-more-than-5-students/">596. è¶…è¿‡5åå­¦ç”Ÿçš„è¯¾</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>æœ‰ä¸€ä¸ª<code>courses</code> è¡¨ ï¼Œæœ‰: <strong>student (å­¦ç”Ÿ)</strong> å’Œ **class (è¯¾ç¨‹)**ã€‚</p><p>è¯·åˆ—å‡ºæ‰€æœ‰è¶…è¿‡æˆ–ç­‰äº5åå­¦ç”Ÿçš„è¯¾ã€‚</p><p>ä¾‹å¦‚,è¡¨:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+---------+------------+</span><br><span class="line">| student | class      |</span><br><span class="line">+---------+------------+</span><br><span class="line">| A       | Math       |</span><br><span class="line">| B       | English    |</span><br><span class="line">| C       | Math       |</span><br><span class="line">| D       | Biology    |</span><br><span class="line">| E       | Math       |</span><br><span class="line">| F       | Computer   |</span><br><span class="line">| G       | Math       |</span><br><span class="line">| H       | Math       |</span><br><span class="line">| I       | Math       |</span><br><span class="line">+---------+------------+</span><br></pre></td></tr></table></figure><p>åº”è¯¥è¾“å‡º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+---------+</span><br><span class="line">| class   |</span><br><span class="line">+---------+</span><br><span class="line">| Math    |</span><br><span class="line">+---------+</span><br></pre></td></tr></table></figure><p><strong>Note:</strong><br>å­¦ç”Ÿåœ¨æ¯ä¸ªè¯¾ä¸­ä¸åº”è¢«é‡å¤è®¡ç®—ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  class </span><br><span class="line"><span class="keyword">from</span> courses</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> class </span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> student)<span class="operator">&gt;=</span><span class="number">5</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¸€ä¸ªå­¦ç”Ÿå¯èƒ½å¤šæ¬¡é€‰è¯¾ã€‚ã€‚è®°å¾—distinct</p></blockquote><h4 id="597-å¥½å‹ç”³è¯·-I-ï¼šæ€»ä½“é€šè¿‡ç‡"><a href="#597-å¥½å‹ç”³è¯·-I-ï¼šæ€»ä½“é€šè¿‡ç‡" class="headerlink" title="597. å¥½å‹ç”³è¯· I ï¼šæ€»ä½“é€šè¿‡ç‡"></a><a href="https://leetcode-cn.com/problems/friend-requests-i-overall-acceptance-rate/">597. å¥½å‹ç”³è¯· I ï¼šæ€»ä½“é€šè¿‡ç‡</a></h4><p>éš¾åº¦ç®€å•21æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡å…³æ³¨åé¦ˆ</p><p>SQLæ¶æ„</p><p>åœ¨ Facebook æˆ–è€… Twitter è¿™æ ·çš„ç¤¾äº¤åº”ç”¨ä¸­ï¼Œäººä»¬ç»å¸¸ä¼šå‘å¥½å‹ç”³è¯·ä¹Ÿä¼šæ”¶åˆ°å…¶ä»–äººçš„å¥½å‹ç”³è¯·ã€‚ç°åœ¨ç»™å¦‚ä¸‹ä¸¤ä¸ªè¡¨ï¼š</p><p>è¡¨ï¼š friend_request</p><table><thead><tr><th>sender_id</th><th>send_to_id</th><th>request_date</th></tr></thead><tbody><tr><td>1</td><td>2</td><td>2016_06-01</td></tr><tr><td>1</td><td>3</td><td>2016_06-01</td></tr><tr><td>1</td><td>4</td><td>2016_06-01</td></tr><tr><td>2</td><td>3</td><td>2016_06-02</td></tr><tr><td>3</td><td>4</td><td>2016-06-09</td></tr></tbody></table><p>è¡¨ï¼š request_accepted</p><table><thead><tr><th>requester_id</th><th>accepter_id</th><th>accept_date</th></tr></thead><tbody><tr><td>1</td><td>2</td><td>2016_06-03</td></tr><tr><td>1</td><td>3</td><td>2016-06-08</td></tr><tr><td>2</td><td>3</td><td>2016-06-08</td></tr><tr><td>3</td><td>4</td><td>2016-06-09</td></tr><tr><td>3</td><td>4</td><td>2016-06-10</td></tr></tbody></table><p>å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œæ±‚å‡ºå¥½å‹ç”³è¯·çš„é€šè¿‡ç‡ï¼Œç”¨ 2 ä½å°æ•°è¡¨ç¤ºã€‚é€šè¿‡ç‡ç”±æ¥å—å¥½å‹ç”³è¯·çš„æ•°ç›®é™¤ä»¥ç”³è¯·æ€»æ•°ã€‚</p><p>å¯¹äºä¸Šé¢çš„æ ·ä¾‹æ•°æ®ï¼Œä½ çš„æŸ¥è¯¢è¯­å¥åº”è¯¥è¿”å›å¦‚ä¸‹ç»“æœã€‚</p><table><thead><tr><th>accept_rate</th></tr></thead><tbody><tr><td>0.80</td></tr></tbody></table><p>æ³¨æ„:</p><p>é€šè¿‡çš„å¥½å‹ç”³è¯·ä¸ä¸€å®šéƒ½åœ¨è¡¨ friend_request ä¸­ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ åªéœ€è¦ç»Ÿè®¡æ€»çš„è¢«é€šè¿‡çš„ç”³è¯·æ•°ï¼ˆä¸ç®¡å®ƒä»¬åœ¨ä¸åœ¨åŸæ¥çš„ç”³è¯·ä¸­ï¼‰ï¼Œå¹¶å°†å®ƒé™¤ä»¥ç”³è¯·æ€»æ•°ï¼Œå¾—åˆ°é€šè¿‡ç‡<br>ä¸€ä¸ªå¥½å‹ç”³è¯·å‘é€è€…æœ‰å¯èƒ½ä¼šç»™æ¥å—è€…å‘å‡ æ¡å¥½å‹ç”³è¯·ï¼Œä¹Ÿæœ‰å¯èƒ½ä¸€ä¸ªå¥½å‹ç”³è¯·ä¼šè¢«é€šè¿‡å¥½å‡ æ¬¡ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œé‡å¤çš„å¥½å‹ç”³è¯·åªç»Ÿè®¡ä¸€æ¬¡ã€‚<br>å¦‚æœä¸€ä¸ªå¥½å‹ç”³è¯·éƒ½æ²¡æœ‰ï¼Œé€šè¿‡ç‡ä¸º 0.00 ã€‚</p><p>è§£é‡Šï¼š æ€»å…±æœ‰ 5 ä¸ªç”³è¯·ï¼Œå…¶ä¸­ 4 ä¸ªæ˜¯ä¸é‡å¤ä¸”è¢«é€šè¿‡çš„å¥½å‹ç”³è¯·ï¼Œæ‰€ä»¥æˆåŠŸç‡æ˜¯ 0.80 ã€‚</p><p>è¿›é˜¶:</p><p>ä½ èƒ½å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥å¾—åˆ°æ¯ä¸ªæœˆçš„é€šè¿‡ç‡å—ï¼Ÿ<br>ä½ èƒ½æ±‚å‡ºæ¯ä¸€å¤©çš„ç´¯è®¡é€šè¿‡ç‡å—ï¼Ÿ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">round(</span><br><span class="line">    ifnull(</span><br><span class="line">    (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">distinct</span> requester_id, accepter_id <span class="keyword">from</span> request_accepted) <span class="keyword">as</span> A)</span><br><span class="line">    <span class="operator">/</span></span><br><span class="line">    (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">distinct</span> sender_id, send_to_id <span class="keyword">from</span> friend_request) <span class="keyword">as</span> B),</span><br><span class="line">    <span class="number">0</span>)</span><br><span class="line">, <span class="number">2</span>) <span class="keyword">as</span> accept_rate;</span><br></pre></td></tr></table></figure><h4 id="601-ä½“è‚²é¦†çš„äººæµé‡"><a href="#601-ä½“è‚²é¦†çš„äººæµé‡" class="headerlink" title="601. ä½“è‚²é¦†çš„äººæµé‡"></a><a href="https://leetcode-cn.com/problems/human-traffic-of-stadium/">601. ä½“è‚²é¦†çš„äººæµé‡</a></h4><p>éš¾åº¦å›°éš¾113æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡å…³æ³¨åé¦ˆ</p><p>SQLæ¶æ„</p><p>X å¸‚å»ºäº†ä¸€ä¸ªæ–°çš„ä½“è‚²é¦†ï¼Œæ¯æ—¥äººæµé‡ä¿¡æ¯è¢«è®°å½•åœ¨è¿™ä¸‰åˆ—ä¿¡æ¯ä¸­ï¼š<strong>åºå·</strong> (id)ã€<strong>æ—¥æœŸ</strong> (visit_date)ã€ <strong>äººæµé‡</strong> (people)ã€‚</p><p>è¯·ç¼–å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œæ‰¾å‡ºäººæµé‡çš„é«˜å³°æœŸã€‚é«˜å³°æœŸæ—¶ï¼Œè‡³å°‘è¿ç»­ä¸‰è¡Œè®°å½•ä¸­çš„äººæµé‡ä¸å°‘äº100ã€‚</p><p>ä¾‹å¦‚ï¼Œè¡¨ <code>stadium</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+------+------------+-----------+</span><br><span class="line">| id   | visit_date | people    |</span><br><span class="line">+------+------------+-----------+</span><br><span class="line">| 1    | 2017-01-01 | 10        |</span><br><span class="line">| 2    | 2017-01-02 | 109       |</span><br><span class="line">| 3    | 2017-01-03 | 150       |</span><br><span class="line">| 4    | 2017-01-04 | 99        |</span><br><span class="line">| 5    | 2017-01-05 | 145       |</span><br><span class="line">| 6    | 2017-01-06 | 1455      |</span><br><span class="line">| 7    | 2017-01-07 | 199       |</span><br><span class="line">| 8    | 2017-01-08 | 188       |</span><br><span class="line">+------+------------+-----------+</span><br></pre></td></tr></table></figure><p>å¯¹äºä¸Šé¢çš„ç¤ºä¾‹æ•°æ®ï¼Œè¾“å‡ºä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+------+------------+-----------+</span><br><span class="line">| id   | visit_date | people    |</span><br><span class="line">+------+------------+-----------+</span><br><span class="line">| 5    | 2017-01-05 | 145       |</span><br><span class="line">| 6    | 2017-01-06 | 1455      |</span><br><span class="line">| 7    | 2017-01-07 | 199       |</span><br><span class="line">| 8    | 2017-01-08 | 188       |</span><br><span class="line">+------+------------+-----------+ </span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong><br>æ¯å¤©åªæœ‰ä¸€è¡Œè®°å½•ï¼Œæ—¥æœŸéšç€ id çš„å¢åŠ è€Œå¢åŠ ã€‚</p><p>3è¡¨ç›¸è¿(244 ms)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> t1.<span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> stadium t1, stadium t2, stadium t3</span><br><span class="line"><span class="keyword">where</span> t1.people <span class="operator">&gt;=</span> <span class="number">100</span> <span class="keyword">and</span> t2.people <span class="operator">&gt;=</span> <span class="number">100</span> <span class="keyword">and</span> t3.people <span class="operator">&gt;=</span> <span class="number">100</span></span><br><span class="line"><span class="keyword">and</span></span><br><span class="line">(</span><br><span class="line">(t1.id <span class="operator">-</span> t2.id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">and</span> t1.id <span class="operator">-</span> t3.id <span class="operator">=</span> <span class="number">2</span> <span class="keyword">and</span> t2.id <span class="operator">-</span> t3.id <span class="operator">=</span><span class="number">1</span>)  <span class="comment">-- t1, t2, t3</span></span><br><span class="line">    <span class="keyword">or</span></span><br><span class="line">    (t2.id <span class="operator">-</span> t1.id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">and</span> t2.id <span class="operator">-</span> t3.id <span class="operator">=</span> <span class="number">2</span> <span class="keyword">and</span> t1.id <span class="operator">-</span> t3.id <span class="operator">=</span><span class="number">1</span>) <span class="comment">-- t2, t1, t3</span></span><br><span class="line">    <span class="keyword">or</span></span><br><span class="line">    (t3.id <span class="operator">-</span> t2.id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">and</span> t2.id <span class="operator">-</span> t1.id <span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> t3.id <span class="operator">-</span> t1.id <span class="operator">=</span> <span class="number">2</span>) <span class="comment">-- t3, t2, t1</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> t1.id</span><br></pre></td></tr></table></figure><p>çª—å£å‡½æ•°(272 ms)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,visit_date,people <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> id</span><br><span class="line">    ,<span class="built_in">lead</span>(people,<span class="number">1</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> id) ld</span><br><span class="line">    ,<span class="built_in">lead</span>(people,<span class="number">2</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> id) ld2</span><br><span class="line">    ,visit_date</span><br><span class="line">    ,<span class="built_in">lag</span>(people,<span class="number">1</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> id) lg</span><br><span class="line">    ,<span class="built_in">lag</span>(people,<span class="number">2</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> id) lg2</span><br><span class="line">    ,people</span><br><span class="line">    <span class="keyword">from</span> stadium</span><br><span class="line">    ) a</span><br><span class="line"><span class="keyword">where</span> (a.ld<span class="operator">&gt;=</span><span class="number">100</span> <span class="keyword">and</span> a.lg<span class="operator">&gt;=</span><span class="number">100</span> <span class="keyword">and</span> a.people<span class="operator">&gt;=</span><span class="number">100</span>)</span><br><span class="line"><span class="keyword">or</span> (a.ld<span class="operator">&gt;=</span><span class="number">100</span> <span class="keyword">and</span> a.ld2<span class="operator">&gt;=</span><span class="number">100</span> <span class="keyword">and</span> a.people<span class="operator">&gt;=</span><span class="number">100</span>)</span><br><span class="line"><span class="keyword">or</span> (a.lg<span class="operator">&gt;=</span><span class="number">100</span> <span class="keyword">and</span> a.lg2<span class="operator">&gt;=</span><span class="number">100</span> <span class="keyword">and</span> a.people<span class="operator">&gt;=</span><span class="number">100</span>)</span><br></pre></td></tr></table></figure><h4 id="602-å¥½å‹ç”³è¯·-II-ï¼šè°æœ‰æœ€å¤šçš„å¥½å‹"><a href="#602-å¥½å‹ç”³è¯·-II-ï¼šè°æœ‰æœ€å¤šçš„å¥½å‹" class="headerlink" title="602. å¥½å‹ç”³è¯· II ï¼šè°æœ‰æœ€å¤šçš„å¥½å‹"></a><a href="https://leetcode-cn.com/problems/friend-requests-ii-who-has-the-most-friends/">602. å¥½å‹ç”³è¯· II ï¼šè°æœ‰æœ€å¤šçš„å¥½å‹</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>åœ¨ Facebook æˆ–è€… Twitter è¿™æ ·çš„ç¤¾äº¤åº”ç”¨ä¸­ï¼Œäººä»¬ç»å¸¸ä¼šå‘å¥½å‹ç”³è¯·ä¹Ÿä¼šæ”¶åˆ°å…¶ä»–äººçš„å¥½å‹ç”³è¯·ã€‚</p><p>è¡¨ <code>request_accepted</code> å­˜å‚¨äº†æ‰€æœ‰å¥½å‹ç”³è¯·é€šè¿‡çš„æ•°æ®è®°å½•ï¼Œå…¶ä¸­ï¼Œ <strong>requester_id</strong> å’Œ <strong>accepter_id</strong> éƒ½æ˜¯ç”¨æˆ·çš„ç¼–å·ã€‚</p><table><thead><tr><th>requester_id</th><th>accepter_id</th><th>accept_date</th></tr></thead><tbody><tr><td>1</td><td>2</td><td>2016_06-03</td></tr><tr><td>1</td><td>3</td><td>2016-06-08</td></tr><tr><td>2</td><td>3</td><td>2016-06-08</td></tr><tr><td>3</td><td>4</td><td>2016-06-09</td></tr></tbody></table><p>å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œæ±‚å‡ºè°æ‹¥æœ‰æœ€å¤šçš„å¥½å‹å’Œä»–æ‹¥æœ‰çš„å¥½å‹æ•°ç›®ã€‚å¯¹äºä¸Šé¢çš„æ ·ä¾‹æ•°æ®ï¼Œç»“æœä¸ºï¼š</p><table><thead><tr><th>id</th><th>num</th></tr></thead><tbody><tr><td>3</td><td>3</td></tr></tbody></table><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>ä¿è¯æ‹¥æœ‰æœ€å¤šå¥½å‹æ•°ç›®çš„åªæœ‰ 1 ä¸ªäººã€‚</li><li>å¥½å‹ç”³è¯·åªä¼šè¢«æ¥å—ä¸€æ¬¡ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰ <strong>requester_id</strong> å’Œ <strong>accepter_id</strong> å€¼éƒ½ç›¸åŒçš„é‡å¤è®°å½•ã€‚</li></ul><p><strong>è§£é‡Šï¼š</strong></p><p>ç¼–å·ä¸º â€˜3â€™ çš„äººæ˜¯ç¼–å·ä¸º â€˜1â€™ï¼Œâ€™2â€™ å’Œ â€˜4â€™ çš„å¥½å‹ï¼Œæ‰€ä»¥ä»–æ€»å…±æœ‰ 3 ä¸ªå¥½å‹ï¼Œæ¯”å…¶ä»–äººéƒ½å¤šã€‚</p><p><strong>è¿›é˜¶ï¼š</strong></p><p>åœ¨çœŸå®ä¸–ç•Œé‡Œï¼Œå¯èƒ½ä¼šæœ‰å¤šä¸ªäººæ‹¥æœ‰å¥½å‹æ•°ç›¸åŒä¸”æœ€å¤šï¼Œä½ èƒ½æ‰¾åˆ°æ‰€æœ‰è¿™äº›äººå—ï¼Ÿ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> rid <span class="keyword">as</span> `id`,<span class="built_in">count</span>(aid) <span class="keyword">as</span> `num`</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> R1.requester_id <span class="keyword">as</span> rid,R1.accepter_id <span class="keyword">as</span> aid</span><br><span class="line">    <span class="keyword">from</span> request_accepted <span class="keyword">as</span> R1</span><br><span class="line">    <span class="keyword">UNION</span> <span class="keyword">all</span></span><br><span class="line">    <span class="keyword">select</span> R2.accepter_id <span class="keyword">as</span> rid,R2.requester_id <span class="keyword">as</span> aid</span><br><span class="line">    <span class="keyword">from</span> request_accepted <span class="keyword">as</span> R2</span><br><span class="line">) <span class="keyword">as</span> A</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> rid</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> num <span class="keyword">desc</span></span><br><span class="line">limit <span class="number">0</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="603-è¿ç»­ç©ºä½™åº§ä½"><a href="#603-è¿ç»­ç©ºä½™åº§ä½" class="headerlink" title="603. è¿ç»­ç©ºä½™åº§ä½"></a><a href="https://leetcode-cn.com/problems/consecutive-available-seats/">603. è¿ç»­ç©ºä½™åº§ä½</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>å‡ ä¸ªæœ‹å‹æ¥åˆ°ç”µå½±é™¢çš„å”®ç¥¨å¤„ï¼Œå‡†å¤‡é¢„çº¦è¿ç»­ç©ºä½™åº§ä½ã€‚</p><p>ä½ èƒ½åˆ©ç”¨è¡¨ <code>cinema</code> ï¼Œå¸®ä»–ä»¬å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œè·å–æ‰€æœ‰ç©ºä½™åº§ä½ï¼Œå¹¶å°†å®ƒä»¬æŒ‰ç…§ seat_id æ’åºåè¿”å›å—ï¼Ÿ</p><table><thead><tr><th>seat_id</th><th>free</th></tr></thead><tbody><tr><td>1</td><td>1</td></tr><tr><td>2</td><td>0</td></tr><tr><td>3</td><td>1</td></tr><tr><td>4</td><td>1</td></tr><tr><td>5</td><td>1</td></tr></tbody></table><p>å¯¹äºå¦‚ä¸Šæ ·ä¾‹ï¼Œä½ çš„æŸ¥è¯¢è¯­å¥åº”è¯¥è¿”å›å¦‚ä¸‹ç»“æœã€‚</p><table><thead><tr><th>seat_id</th></tr></thead><tbody><tr><td>3</td></tr><tr><td>4</td></tr><tr><td>5</td></tr></tbody></table><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>seat_id å­—æ®µæ˜¯ä¸€ä¸ªè‡ªå¢çš„æ•´æ•°ï¼Œfree å­—æ®µæ˜¯å¸ƒå°”ç±»å‹ï¼ˆâ€™1â€™ è¡¨ç¤ºç©ºä½™ï¼Œ â€˜0â€™ è¡¨ç¤ºå·²è¢«å æ®ï¼‰ã€‚</li><li>è¿ç»­ç©ºä½™åº§ä½çš„å®šä¹‰æ˜¯å¤§äºç­‰äº 2 ä¸ªè¿ç»­ç©ºä½™çš„åº§ä½ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> seat_id</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span> seat_id,</span><br><span class="line"><span class="built_in">lag</span>(seat_id,<span class="number">1</span>,<span class="number">-99</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> seat_id) ls,</span><br><span class="line"><span class="built_in">lead</span>(seat_id,<span class="number">1</span>,<span class="number">-99</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> seat_id) rs</span><br><span class="line"><span class="keyword">from</span> cinema</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">free</span><span class="operator">=</span><span class="number">1</span></span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span>  seat_id<span class="operator">-</span>ls <span class="operator">=</span> <span class="number">1</span> <span class="keyword">or</span> rs<span class="operator">-</span>seat_id <span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="607-é”€å”®å‘˜"><a href="#607-é”€å”®å‘˜" class="headerlink" title="607. é”€å”®å‘˜"></a><a href="https://leetcode-cn.com/problems/sales-person/">607. é”€å”®å‘˜</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p><strong>æè¿°</strong></p><p>ç»™å®š 3 ä¸ªè¡¨ï¼š <code>salesperson</code>ï¼Œ <code>company</code>ï¼Œ <code>orders</code>ã€‚<br>è¾“å‡ºæ‰€æœ‰è¡¨ <code>salesperson</code> ä¸­ï¼Œæ²¡æœ‰å‘å…¬å¸ â€˜REDâ€™ é”€å”®ä»»ä½•ä¸œè¥¿çš„é”€å”®å‘˜ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong><br><strong>è¾“å…¥</strong></p><p>è¡¨ï¼š <code>salesperson</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+----------+------+--------+-----------------+-----------+</span><br><span class="line">| sales_id | name | salary | commission_rate | hire_date |</span><br><span class="line">+----------+------+--------+-----------------+-----------+</span><br><span class="line">|   1      | John | 100000 |     6           | 4/1/2006  |</span><br><span class="line">|   2      | Amy  | 120000 |     5           | 5/1/2010  |</span><br><span class="line">|   3      | Mark | 65000  |     12          | 12/25/2008|</span><br><span class="line">|   4      | Pam  | 25000  |     25          | 1/1/2005  |</span><br><span class="line">|   5      | Alex | 50000  |     10          | 2/3/2007  |</span><br><span class="line">+----------+------+--------+-----------------+-----------+</span><br></pre></td></tr></table></figure><p>è¡¨ <code>salesperson</code> å­˜å‚¨äº†æ‰€æœ‰é”€å”®å‘˜çš„ä¿¡æ¯ã€‚æ¯ä¸ªé”€å”®å‘˜éƒ½æœ‰ä¸€ä¸ªé”€å”®å‘˜ç¼–å· <strong>sales_id</strong> å’Œä»–çš„åå­— <strong>name</strong> ã€‚</p><p>è¡¨ï¼š <code>company</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------+--------+------------+</span><br><span class="line">| com_id  |  name  |    city    |</span><br><span class="line">+---------+--------+------------+</span><br><span class="line">|   1     |  RED   |   Boston   |</span><br><span class="line">|   2     | ORANGE |   New York |</span><br><span class="line">|   3     | YELLOW |   Boston   |</span><br><span class="line">|   4     | GREEN  |   Austin   |</span><br><span class="line">+---------+--------+------------+</span><br></pre></td></tr></table></figure><p>è¡¨ <code>company</code> å­˜å‚¨äº†æ‰€æœ‰å…¬å¸çš„ä¿¡æ¯ã€‚æ¯ä¸ªå…¬å¸éƒ½æœ‰ä¸€ä¸ªå…¬å¸ç¼–å· <strong>com_id</strong> å’Œå®ƒçš„åå­— <strong>name</strong> ã€‚</p><p>è¡¨ï¼š <code>orders</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----------+------------+---------+----------+--------+</span><br><span class="line">| order_id | order_date | com_id  | sales_id | amount |</span><br><span class="line">+----------+------------+---------+----------+--------+</span><br><span class="line">| 1        |   1/1/2014 |    3    |    4     | 100000 |</span><br><span class="line">| 2        |   2/1/2014 |    4    |    5     | 5000   |</span><br><span class="line">| 3        |   3/1/2014 |    1    |    1     | 50000  |</span><br><span class="line">| 4        |   4/1/2014 |    1    |    4     | 25000  |</span><br><span class="line">+----------+----------+---------+----------+--------+</span><br></pre></td></tr></table></figure><p>è¡¨ <code>orders</code> å­˜å‚¨äº†æ‰€æœ‰çš„é”€å”®æ•°æ®ï¼ŒåŒ…æ‹¬é”€å”®å‘˜ç¼–å· <strong>sales_id</strong> å’Œå…¬å¸ç¼–å· <strong>com_id</strong> ã€‚</p><p><strong>è¾“å‡º</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+------+</span><br><span class="line">| name | </span><br><span class="line">+------+</span><br><span class="line">| Amy  | </span><br><span class="line">| Mark | </span><br><span class="line">| Alex |</span><br><span class="line">+------+</span><br></pre></td></tr></table></figure><p><strong>è§£é‡Š</strong></p><p>æ ¹æ®è¡¨ <code>orders</code> ä¸­çš„è®¢å• â€˜3â€™ å’Œ â€˜4â€™ ï¼Œå®¹æ˜“çœ‹å‡ºåªæœ‰ â€˜Johnâ€™ å’Œ â€˜Pamâ€™ ä¸¤ä¸ªé”€å”®å‘˜æ›¾ç»å‘å…¬å¸ â€˜REDâ€™ é”€å”®è¿‡ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦è¾“å‡ºè¡¨ <code>salesperson</code> ä¸­æ‰€æœ‰å…¶ä»–äººçš„åå­—ã€‚\</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name</span><br><span class="line"><span class="keyword">from</span> salesperson</span><br><span class="line"><span class="keyword">where</span> sales_id <span class="keyword">not</span> <span class="keyword">in</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> sales_id</span><br><span class="line">    <span class="keyword">from</span> orders</span><br><span class="line">    <span class="keyword">where</span> com_id <span class="operator">=</span></span><br><span class="line">            (</span><br><span class="line">            <span class="keyword">select</span> com_id </span><br><span class="line">            <span class="keyword">from</span> company</span><br><span class="line">            <span class="keyword">where</span> name <span class="operator">=</span><span class="string">&#x27;RED&#x27;</span></span><br><span class="line">            )</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="608-æ ‘èŠ‚ç‚¹"><a href="#608-æ ‘èŠ‚ç‚¹" class="headerlink" title="608. æ ‘èŠ‚ç‚¹"></a><a href="https://leetcode-cn.com/problems/tree-node/">608. æ ‘èŠ‚ç‚¹</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>ç»™å®šä¸€ä¸ªè¡¨ <code>tree</code>ï¼Œ<strong>id</strong> æ˜¯æ ‘èŠ‚ç‚¹çš„ç¼–å·ï¼Œ <strong>p_id</strong> æ˜¯å®ƒçˆ¶èŠ‚ç‚¹çš„ <strong>id ã€‚</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+----+------+</span><br><span class="line">| id | p_id |</span><br><span class="line">+----+------+</span><br><span class="line">| 1  | null |</span><br><span class="line">| 2  | 1    |</span><br><span class="line">| 3  | 1    |</span><br><span class="line">| 4  | 2    |</span><br><span class="line">| 5  | 2    |</span><br><span class="line">+----+------+</span><br></pre></td></tr></table></figure><p>æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹å±äºä»¥ä¸‹ä¸‰ç§ç±»å‹ä¹‹ä¸€ï¼š</p><ul><li>å¶å­ï¼šå¦‚æœè¿™ä¸ªèŠ‚ç‚¹æ²¡æœ‰ä»»ä½•å­©å­èŠ‚ç‚¹ã€‚</li><li>æ ¹ï¼šå¦‚æœè¿™ä¸ªèŠ‚ç‚¹æ˜¯æ•´æ£µæ ‘çš„æ ¹ï¼Œå³æ²¡æœ‰çˆ¶èŠ‚ç‚¹ã€‚</li><li>å†…éƒ¨èŠ‚ç‚¹ï¼šå¦‚æœè¿™ä¸ªèŠ‚ç‚¹æ—¢ä¸æ˜¯å¶å­èŠ‚ç‚¹ä¹Ÿä¸æ˜¯æ ¹èŠ‚ç‚¹ã€‚</li></ul><p>å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œè¾“å‡ºæ‰€æœ‰èŠ‚ç‚¹çš„ç¼–å·å’ŒèŠ‚ç‚¹çš„ç±»å‹ï¼Œå¹¶å°†ç»“æœæŒ‰ç…§èŠ‚ç‚¹ç¼–å·æ’åºã€‚ä¸Šé¢æ ·ä¾‹çš„ç»“æœä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+----+------+</span><br><span class="line">| id | Type |</span><br><span class="line">+----+------+</span><br><span class="line">| 1  | Root |</span><br><span class="line">| 2  | Inner|</span><br><span class="line">| 3  | Leaf |</span><br><span class="line">| 4  | Leaf |</span><br><span class="line">| 5  | Leaf |</span><br><span class="line">+----+------+</span><br></pre></td></tr></table></figure><p><strong>è§£é‡Š</strong></p><ul><li><p>èŠ‚ç‚¹ â€˜1â€™ æ˜¯æ ¹èŠ‚ç‚¹ï¼Œå› ä¸ºå®ƒçš„çˆ¶èŠ‚ç‚¹æ˜¯ NULL ï¼ŒåŒæ—¶å®ƒæœ‰å­©å­èŠ‚ç‚¹ â€˜2â€™ å’Œ â€˜3â€™ ã€‚</p></li><li><p>èŠ‚ç‚¹ â€˜2â€™ æ˜¯å†…éƒ¨èŠ‚ç‚¹ï¼Œå› ä¸ºå®ƒæœ‰çˆ¶èŠ‚ç‚¹ â€˜1â€™ ï¼Œä¹Ÿæœ‰å­©å­èŠ‚ç‚¹ â€˜4â€™ å’Œ â€˜5â€™ ã€‚</p></li><li><p>èŠ‚ç‚¹ â€˜3â€™, â€˜4â€™ å’Œ â€˜5â€™ éƒ½æ˜¯å¶å­èŠ‚ç‚¹ï¼Œå› ä¸ºå®ƒä»¬éƒ½æœ‰çˆ¶èŠ‚ç‚¹åŒæ—¶æ²¡æœ‰å­©å­èŠ‚ç‚¹ã€‚</p></li><li><p>æ ·ä¾‹ä¸­æ ‘çš„å½¢æ€å¦‚ä¸‹ï¼š </p><p>â€‹              1<br>â€‹            /   <br>â€‹          2       3<br>â€‹        /   <br>â€‹     4       5</p></li></ul><p><strong>æ³¨æ„</strong></p><p>å¦‚æœæ ‘ä¸­åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä½ åªéœ€è¦è¾“å‡ºå®ƒçš„æ ¹å±æ€§ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,</span><br><span class="line">    (<span class="keyword">case</span> <span class="keyword">when</span> p_id <span class="keyword">is</span> <span class="keyword">null</span> <span class="keyword">then</span> &quot;Root&quot;</span><br><span class="line">    <span class="keyword">when</span> id <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> ifnull(p_id,<span class="number">0</span>) <span class="keyword">from</span> tree) <span class="keyword">then</span> &quot;Leaf&quot;</span><br><span class="line">    <span class="keyword">else</span> &quot;Inner&quot; <span class="keyword">end</span>)  Type</span><br><span class="line"><span class="keyword">from</span> tree</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="610-åˆ¤æ–­ä¸‰è§’å½¢"><a href="#610-åˆ¤æ–­ä¸‰è§’å½¢" class="headerlink" title="610. åˆ¤æ–­ä¸‰è§’å½¢"></a><a href="https://leetcode-cn.com/problems/triangle-judgement/">610. åˆ¤æ–­ä¸‰è§’å½¢</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>ä¸€ä¸ªå°å­¦ç”Ÿ Tim çš„ä½œä¸šæ˜¯åˆ¤æ–­ä¸‰æ¡çº¿æ®µæ˜¯å¦èƒ½å½¢æˆä¸€ä¸ªä¸‰è§’å½¢ã€‚</p><p>ç„¶è€Œï¼Œè¿™ä¸ªä½œä¸šéå¸¸ç¹é‡ï¼Œå› ä¸ºæœ‰å‡ ç™¾ç»„çº¿æ®µéœ€è¦åˆ¤æ–­ã€‚</p><p>å‡è®¾è¡¨ <code>triangle</code> ä¿å­˜äº†æ‰€æœ‰ä¸‰æ¡çº¿æ®µçš„ä¸‰å…ƒç»„ x, y, z ï¼Œä½ èƒ½å¸® Tim å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œæ¥åˆ¤æ–­æ¯ä¸ªä¸‰å…ƒç»„æ˜¯å¦å¯ä»¥ç»„æˆä¸€ä¸ªä¸‰è§’å½¢å—ï¼Ÿ</p><table><thead><tr><th>x</th><th>y</th><th>z</th></tr></thead><tbody><tr><td>13</td><td>15</td><td>30</td></tr><tr><td>10</td><td>20</td><td>15</td></tr></tbody></table><p>å¯¹äºå¦‚ä¸Šæ ·ä¾‹æ•°æ®ï¼Œä½ çš„æŸ¥è¯¢è¯­å¥åº”è¯¥è¿”å›å¦‚ä¸‹ç»“æœï¼š</p><table><thead><tr><th>x</th><th>y</th><th>z</th><th>triangle</th></tr></thead><tbody><tr><td>13</td><td>15</td><td>30</td><td>No</td></tr><tr><td>10</td><td>20</td><td>15</td><td>Yes</td></tr></tbody></table><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> x,y,z, </span><br><span class="line">if(x<span class="operator">+</span>y<span class="operator">&gt;</span>z <span class="operator">&amp;&amp;</span> x<span class="operator">+</span>z<span class="operator">&gt;</span>y <span class="operator">&amp;&amp;</span> y<span class="operator">+</span>z<span class="operator">&gt;</span>x,<span class="string">&#x27;Yes&#x27;</span>,<span class="string">&#x27;No&#x27;</span>) triangle</span><br><span class="line"><span class="keyword">from</span> triangle</span><br></pre></td></tr></table></figure><h4 id="612-å¹³é¢ä¸Šçš„æœ€è¿‘è·ç¦»"><a href="#612-å¹³é¢ä¸Šçš„æœ€è¿‘è·ç¦»" class="headerlink" title="612. å¹³é¢ä¸Šçš„æœ€è¿‘è·ç¦»"></a><a href="https://leetcode-cn.com/problems/shortest-distance-in-a-plane/">612. å¹³é¢ä¸Šçš„æœ€è¿‘è·ç¦»</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>è¡¨ <code>point_2d</code> ä¿å­˜äº†æ‰€æœ‰ç‚¹ï¼ˆå¤šäº 2 ä¸ªç‚¹ï¼‰çš„åæ ‡ (x,y) ï¼Œè¿™äº›ç‚¹åœ¨å¹³é¢ä¸Šä¸¤ä¸¤ä¸é‡åˆã€‚</p><p>å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥æ‰¾åˆ°ä¸¤ç‚¹ä¹‹é—´çš„æœ€è¿‘è·ç¦»ï¼Œä¿ç•™ 2 ä½å°æ•°ã€‚</p><table><thead><tr><th>x</th><th>y</th></tr></thead><tbody><tr><td>-1</td><td>-1</td></tr><tr><td>0</td><td>0</td></tr><tr><td>-1</td><td>-2</td></tr></tbody></table><p>æœ€è¿‘è·ç¦»åœ¨ç‚¹ (-1,-1) å’Œ(-1,2) ä¹‹é—´ï¼Œè·ç¦»ä¸º 1.00 ã€‚æ‰€ä»¥è¾“å‡ºåº”è¯¥ä¸ºï¼š </p><table><thead><tr><th>shortest</th></tr></thead><tbody><tr><td>1.00</td></tr></tbody></table><p><strong>æ³¨æ„ï¼š</strong>ä»»æ„ç‚¹ä¹‹é—´çš„æœ€è¿œè·ç¦»å°äº 10000 ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    ROUND(<span class="built_in">SQRT</span>(<span class="built_in">MIN</span>((POW(p1.x <span class="operator">-</span> p2.x, <span class="number">2</span>) <span class="operator">+</span> POW(p1.y <span class="operator">-</span> p2.y, <span class="number">2</span>)))), <span class="number">2</span>) <span class="keyword">AS</span> shortest</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    point_2d p1</span><br><span class="line">        <span class="keyword">JOIN</span></span><br><span class="line">    point_2d p2 <span class="keyword">ON</span> p1.x <span class="operator">!=</span> p2.x <span class="keyword">OR</span> p1.y <span class="operator">!=</span> p2.y</span><br></pre></td></tr></table></figure><p>ä¼˜åŒ– ï¼šå‡å°‘é‡å¤è®¡ç®—</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    ROUND(<span class="built_in">SQRT</span>(<span class="built_in">MIN</span>((POW(p1.x <span class="operator">-</span> p2.x, <span class="number">2</span>) <span class="operator">+</span> POW(p1.y <span class="operator">-</span> p2.y, <span class="number">2</span>)))),<span class="number">2</span>) <span class="keyword">AS</span> shortest</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    point_2d p1</span><br><span class="line">        <span class="keyword">JOIN</span></span><br><span class="line">    point_2d p2 <span class="keyword">ON</span> (p1.x <span class="operator">&lt;=</span> p2.x <span class="keyword">AND</span> p1.y <span class="operator">&lt;</span> p2.y)</span><br><span class="line">        <span class="keyword">OR</span> (p1.x <span class="operator">&lt;=</span> p2.x <span class="keyword">AND</span> p1.y <span class="operator">&gt;</span> p2.y)</span><br><span class="line">        <span class="keyword">OR</span> (p1.x <span class="operator">&lt;</span> p2.x <span class="keyword">AND</span> p1.y <span class="operator">=</span> p2.y)</span><br></pre></td></tr></table></figure><h4 id="613-ç›´çº¿ä¸Šçš„æœ€è¿‘è·ç¦»"><a href="#613-ç›´çº¿ä¸Šçš„æœ€è¿‘è·ç¦»" class="headerlink" title="613. ç›´çº¿ä¸Šçš„æœ€è¿‘è·ç¦»"></a><a href="https://leetcode-cn.com/problems/shortest-distance-in-a-line/">613. ç›´çº¿ä¸Šçš„æœ€è¿‘è·ç¦»</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>è¡¨ <code>point</code> ä¿å­˜äº†ä¸€äº›ç‚¹åœ¨ x è½´ä¸Šçš„åæ ‡ï¼Œè¿™äº›åæ ‡éƒ½æ˜¯æ•´æ•°ã€‚</p><p>å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œæ‰¾åˆ°è¿™äº›ç‚¹ä¸­æœ€è¿‘ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»ã€‚</p><table><thead><tr><th>x</th></tr></thead><tbody><tr><td>-1</td></tr><tr><td>0</td></tr><tr><td>2</td></tr></tbody></table><p>æœ€è¿‘è·ç¦»æ˜¾ç„¶æ˜¯ â€˜1â€™ ï¼Œæ˜¯ç‚¹ â€˜-1â€™ å’Œ â€˜0â€™ ä¹‹é—´çš„è·ç¦»ã€‚æ‰€ä»¥è¾“å‡ºåº”è¯¥å¦‚ä¸‹ï¼š</p><table><thead><tr><th>shortest</th></tr></thead><tbody><tr><td>1</td></tr></tbody></table><p><strong>æ³¨æ„ï¼š</strong>æ¯ä¸ªç‚¹éƒ½ä¸å…¶ä»–ç‚¹åæ ‡ä¸åŒï¼Œè¡¨ <code>table</code> ä¸ä¼šæœ‰é‡å¤åæ ‡å‡ºç°ã€‚</p><p><strong>è¿›é˜¶ï¼š</strong>å¦‚æœè¿™äº›ç‚¹åœ¨ x è½´ä¸Šä»å·¦åˆ°å³éƒ½æœ‰ä¸€ä¸ªç¼–å·ï¼Œè¾“å‡ºç»“æœæ—¶éœ€è¦è¾“å‡ºæœ€è¿‘ç‚¹å¯¹çš„ç¼–å·å‘¢ï¼Ÿ</p><p> å¼€çª—æ–¹æ³• 178m</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">min</span>(l<span class="operator">-</span>x) shortest</span><br><span class="line"><span class="keyword">from</span>( </span><br><span class="line"><span class="keyword">select</span> x,<span class="built_in">lead</span>(x,<span class="number">1</span>,<span class="keyword">null</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> x) l</span><br><span class="line"><span class="keyword">from</span> point</span><br><span class="line">)t1</span><br></pre></td></tr></table></figure><p>joinæ–¹æ³• 268m</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="built_in">MIN</span>(<span class="built_in">ABS</span>(p1.x <span class="operator">-</span> p2.x)) <span class="keyword">AS</span> shortest</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    point p1</span><br><span class="line">        <span class="keyword">JOIN</span></span><br><span class="line">    point p2 <span class="keyword">ON</span> p1.x <span class="operator">!=</span> p2.x</span><br><span class="line">;</span><br></pre></td></tr></table></figure><h4 id="614-äºŒçº§å…³æ³¨è€…"><a href="#614-äºŒçº§å…³æ³¨è€…" class="headerlink" title="614. äºŒçº§å…³æ³¨è€…"></a><a href="https://leetcode-cn.com/problems/second-degree-follower/">614. äºŒçº§å…³æ³¨è€…</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>åœ¨ facebook ä¸­ï¼Œè¡¨ <code>follow</code> ä¼šæœ‰ 2 ä¸ªå­—æ®µï¼š <strong>followee</strong>, <strong>follower</strong> ï¼Œåˆ†åˆ«è¡¨ç¤ºè¢«å…³æ³¨è€…å’Œå…³æ³¨è€…ã€‚</p><p>è¯·å†™ä¸€ä¸ª sql æŸ¥è¯¢è¯­å¥ï¼Œå¯¹æ¯ä¸€ä¸ªå…³æ³¨è€…ï¼ŒæŸ¥è¯¢å…³æ³¨ä»–çš„å…³æ³¨è€…çš„æ•°ç›®ã€‚</p><p>æ¯”æ–¹è¯´ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+------------+</span><br><span class="line">| followee    | follower   |</span><br><span class="line">+-------------+------------+</span><br><span class="line">|     A       |     B      |</span><br><span class="line">|     B       |     C      |</span><br><span class="line">|     B       |     D      |</span><br><span class="line">|     D       |     E      |</span><br><span class="line">+-------------+------------+</span><br></pre></td></tr></table></figure><p>åº”è¯¥è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+-------------+------------+</span><br><span class="line">| follower    | num        |</span><br><span class="line">+-------------+------------+</span><br><span class="line">|     B       |  2         |</span><br><span class="line">|     D       |  1         |</span><br><span class="line">+-------------+------------+</span><br></pre></td></tr></table></figure><p><strong>è§£é‡Šï¼š</strong></p><p>B å’Œ D éƒ½åœ¨åœ¨ <strong>follower</strong> å­—æ®µä¸­å‡ºç°ï¼Œä½œä¸ºè¢«å…³æ³¨è€…ï¼ŒB è¢« C å’Œ D å…³æ³¨ï¼ŒD è¢« E å…³æ³¨ã€‚A ä¸åœ¨ <strong>follower</strong> å­—æ®µå†…ï¼Œæ‰€ä»¥Aä¸åœ¨è¾“å‡ºåˆ—è¡¨ä¸­ã€‚</p><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>è¢«å…³æ³¨è€…æ°¸è¿œä¸ä¼šè¢«ä»– / å¥¹è‡ªå·±å…³æ³¨ã€‚</li><li>å°†ç»“æœæŒ‰ç…§å­—å…¸åºè¿”å›ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> followee follower,<span class="built_in">count</span>(<span class="keyword">distinct</span> follower) num</span><br><span class="line"><span class="keyword">from</span> follow</span><br><span class="line"><span class="keyword">where</span> followee  <span class="keyword">in</span> (</span><br><span class="line">    <span class="keyword">select</span> follower</span><br><span class="line">    <span class="keyword">from</span> follow</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> follower</span><br><span class="line">)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> followee</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> follower </span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œå‡ºç°äº†é‡å¤å…³æ³¨ ï¼Œéœ€è¦å»é‡</p></blockquote><h4 id="615-å¹³å‡å·¥èµ„ï¼šéƒ¨é—¨ä¸å…¬å¸æ¯”è¾ƒ"><a href="#615-å¹³å‡å·¥èµ„ï¼šéƒ¨é—¨ä¸å…¬å¸æ¯”è¾ƒ" class="headerlink" title="615. å¹³å‡å·¥èµ„ï¼šéƒ¨é—¨ä¸å…¬å¸æ¯”è¾ƒ"></a><a href="https://leetcode-cn.com/problems/average-salary-departments-vs-company/">615. å¹³å‡å·¥èµ„ï¼šéƒ¨é—¨ä¸å…¬å¸æ¯”è¾ƒ</a></h4><p>éš¾åº¦å›°éš¾</p><p>SQLæ¶æ„</p><p>ç»™å¦‚ä¸‹ä¸¤ä¸ªè¡¨ï¼Œå†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œæ±‚å‡ºåœ¨æ¯ä¸€ä¸ªå·¥èµ„å‘æ”¾æ—¥ï¼Œæ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„ä¸å…¬å¸çš„å¹³å‡å·¥èµ„çš„æ¯”è¾ƒç»“æœ ï¼ˆé«˜ / ä½ / ç›¸åŒï¼‰ã€‚</p><p>è¡¨ï¼š <code>salary</code></p><table><thead><tr><th>id</th><th>employee_id</th><th>amount</th><th>pay_date</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>9000</td><td>2017-03-31</td></tr><tr><td>2</td><td>2</td><td>6000</td><td>2017-03-31</td></tr><tr><td>3</td><td>3</td><td>10000</td><td>2017-03-31</td></tr><tr><td>4</td><td>1</td><td>7000</td><td>2017-02-28</td></tr><tr><td>5</td><td>2</td><td>6000</td><td>2017-02-28</td></tr><tr><td>6</td><td>3</td><td>8000</td><td>2017-02-28</td></tr></tbody></table><p><strong>employee_id</strong> å­—æ®µæ˜¯è¡¨ <code>employee</code> ä¸­ <strong>employee_id</strong> å­—æ®µçš„å¤–é”®ã€‚</p><table><thead><tr><th>employee_id</th><th>department_id</th></tr></thead><tbody><tr><td>1</td><td>1</td></tr><tr><td>2</td><td>2</td></tr><tr><td>3</td><td>2</td></tr></tbody></table><p>å¯¹äºå¦‚ä¸Šæ ·ä¾‹æ•°æ®ï¼Œç»“æœä¸ºï¼š</p><table><thead><tr><th>pay_month</th><th>department_id</th><th>comparison</th></tr></thead><tbody><tr><td>2017-03</td><td>1</td><td>higher</td></tr><tr><td>2017-03</td><td>2</td><td>lower</td></tr><tr><td>2017-02</td><td>1</td><td>same</td></tr><tr><td>2017-02</td><td>2</td><td>same</td></tr></tbody></table><p><strong>è§£é‡Š</strong></p><p>åœ¨ä¸‰æœˆï¼Œå…¬å¸çš„å¹³å‡å·¥èµ„æ˜¯ (9000+6000+10000)/3 = 8333.33â€¦</p><p>ç”±äºéƒ¨é—¨ â€˜1â€™ é‡Œåªæœ‰ä¸€ä¸ª <strong>employee_id</strong> ä¸º â€˜1â€™ çš„å‘˜å·¥ï¼Œæ‰€ä»¥éƒ¨é—¨ â€˜1â€™ çš„å¹³å‡å·¥èµ„å°±æ˜¯æ­¤äººçš„å·¥èµ„ 9000 ã€‚å› ä¸º 9000 &gt; 8333.33 ï¼Œæ‰€ä»¥æ¯”è¾ƒç»“æœæ˜¯ â€˜higherâ€™ã€‚</p><p>ç¬¬äºŒä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„ä¸º <strong>employee_id</strong> ä¸º â€˜2â€™ å’Œ â€˜3â€™ ä¸¤ä¸ªäººçš„å¹³å‡å·¥èµ„ï¼Œä¸º (6000+10000)/2=8000 ã€‚å› ä¸º 8000 &lt; 8333.33 ï¼Œæ‰€ä»¥æ¯”è¾ƒç»“æœæ˜¯ â€˜lowerâ€™ ã€‚</p><p>åœ¨äºŒæœˆç”¨åŒæ ·çš„å…¬å¼æ±‚å¹³å‡å·¥èµ„å¹¶æ¯”è¾ƒï¼Œæ¯”è¾ƒç»“æœä¸º â€˜sameâ€™ ï¼Œå› ä¸ºéƒ¨é—¨ â€˜1â€™ å’Œéƒ¨é—¨ â€˜2â€™ çš„å¹³å‡å·¥èµ„ä¸å…¬å¸çš„å¹³å‡å·¥èµ„ç›¸åŒï¼Œéƒ½æ˜¯ 7000 ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    pay_month,</span><br><span class="line">    department_id,</span><br><span class="line">     (<span class="keyword">case</span> <span class="keyword">when</span> avgs<span class="operator">&gt;</span>ts <span class="keyword">then</span> <span class="string">&#x27;higher&#x27;</span></span><br><span class="line">            <span class="keyword">when</span> avgs<span class="operator">&lt;</span>ts <span class="keyword">then</span> <span class="string">&#x27;lower&#x27;</span></span><br><span class="line">            <span class="keyword">else</span> <span class="string">&#x27;same&#x27;</span> <span class="keyword">end</span>) <span class="keyword">as</span> comparison</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> </span><br><span class="line">        date_format(pay_date,<span class="string">&#x27;%Y-%m&#x27;</span>)pay_month,</span><br><span class="line">        department_id,</span><br><span class="line">        <span class="built_in">avg</span>(amount) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> date_format(pay_date,<span class="string">&#x27;%Y-%m&#x27;</span>) )ts,</span><br><span class="line">        <span class="built_in">avg</span>(amount) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> date_format(pay_date,<span class="string">&#x27;%Y-%m&#x27;</span>),department_id) avgs</span><br><span class="line">    <span class="keyword">from</span> salary s</span><br><span class="line">    <span class="keyword">left</span> <span class="keyword">join</span> employee e</span><br><span class="line">    <span class="keyword">on</span> s.employee_id <span class="operator">=</span> e.employee_id</span><br><span class="line">   </span><br><span class="line">)t1</span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> pay_month, department_id</span><br></pre></td></tr></table></figure><blockquote><p>ä¹Ÿå¯ä»¥ç”¨if</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IF(avgs<span class="operator">&gt;</span>ts,<span class="string">&#x27;higher&#x27;</span>,IF(avgs<span class="operator">=</span>ts,<span class="string">&#x27;same&#x27;</span>,<span class="string">&#x27;lower&#x27;</span>)) <span class="keyword">AS</span> comparison</span><br></pre></td></tr></table></figure><h4 id="618-å­¦ç”Ÿåœ°ç†ä¿¡æ¯æŠ¥å‘Š"><a href="#618-å­¦ç”Ÿåœ°ç†ä¿¡æ¯æŠ¥å‘Š" class="headerlink" title="618. å­¦ç”Ÿåœ°ç†ä¿¡æ¯æŠ¥å‘Š"></a><a href="https://leetcode-cn.com/problems/students-report-by-geography/">618. å­¦ç”Ÿåœ°ç†ä¿¡æ¯æŠ¥å‘Š</a></h4><p>éš¾åº¦å›°éš¾</p><p>SQLæ¶æ„</p><p>ä¸€æ‰€ç¾å›½å¤§å­¦æœ‰æ¥è‡ªäºšæ´²ã€æ¬§æ´²å’Œç¾æ´²çš„å­¦ç”Ÿï¼Œä»–ä»¬çš„åœ°ç†ä¿¡æ¯å­˜æ”¾åœ¨å¦‚ä¸‹ <code>student</code> è¡¨ä¸­ã€‚</p><table><thead><tr><th>name</th><th>continent</th></tr></thead><tbody><tr><td>Jack</td><td>America</td></tr><tr><td>Pascal</td><td>Europe</td></tr><tr><td>Xi</td><td>Asia</td></tr><tr><td>Jane</td><td>America</td></tr></tbody></table><p>å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥å®ç°å¯¹å¤§æ´²ï¼ˆcontinentï¼‰åˆ—çš„ <a href="https://zh.wikipedia.org/wiki/%E9%80%8F%E8%A7%86%E8%A1%A8">é€è§†è¡¨</a> æ“ä½œï¼Œä½¿å¾—æ¯ä¸ªå­¦ç”ŸæŒ‰ç…§å§“åçš„å­—æ¯é¡ºåºä¾æ¬¡æ’åˆ—åœ¨å¯¹åº”çš„å¤§æ´²ä¸‹é¢ã€‚è¾“å‡ºçš„æ ‡é¢˜åº”ä¾æ¬¡ä¸ºç¾æ´²ï¼ˆAmericaï¼‰ã€äºšæ´²ï¼ˆAsiaï¼‰å’Œæ¬§æ´²ï¼ˆEuropeï¼‰ã€‚æ•°æ®ä¿è¯æ¥è‡ªç¾æ´²çš„å­¦ç”Ÿä¸å°‘äºæ¥è‡ªäºšæ´²æˆ–è€…æ¬§æ´²çš„å­¦ç”Ÿã€‚</p><p>å¯¹äºæ ·ä¾‹è¾“å…¥ï¼Œå®ƒçš„å¯¹åº”è¾“å‡ºæ˜¯ï¼š</p><table><thead><tr><th>America</th><th>Asia</th><th>Europe</th></tr></thead><tbody><tr><td>Jack</td><td>Xi</td><td>Pascal</td></tr><tr><td>Jane</td><td></td><td></td></tr></tbody></table><p><strong>è¿›é˜¶ï¼š</strong>å¦‚æœä¸èƒ½ç¡®å®šå“ªä¸ªå¤§æ´²çš„å­¦ç”Ÿæ•°æœ€å¤šï¼Œä½ å¯ä»¥å†™å‡ºä¸€ä¸ªæŸ¥è¯¢å»ç”Ÿæˆä¸Šè¿°å­¦ç”ŸæŠ¥å‘Šå—ï¼Ÿ</p><p>å¼€çª—</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line"><span class="built_in">max</span>(if(continent<span class="operator">=</span><span class="string">&#x27;America&#x27;</span>,name,<span class="keyword">null</span>)) America,</span><br><span class="line"><span class="built_in">max</span>(if(continent<span class="operator">=</span><span class="string">&#x27;Asia&#x27;</span>,name,<span class="keyword">null</span>)) Asia,</span><br><span class="line"><span class="built_in">max</span>(if(continent<span class="operator">=</span><span class="string">&#x27;Europe&#x27;</span>,name,<span class="keyword">null</span>)) Europe</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">    (<span class="keyword">select</span> <span class="operator">*</span>, <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> continent <span class="keyword">order</span> <span class="keyword">by</span> name) rk</span><br><span class="line">    <span class="keyword">from</span> student) t</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> rk</span><br></pre></td></tr></table></figure><p>å˜é‡</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    America, Asia, Europe</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="variable">@as</span>:<span class="operator">=</span><span class="number">0</span>, <span class="variable">@am</span>:<span class="operator">=</span><span class="number">0</span>, <span class="variable">@eu</span>:<span class="operator">=</span><span class="number">0</span>) t,</span><br><span class="line">    (<span class="keyword">SELECT</span> </span><br><span class="line">        <span class="variable">@as</span>:<span class="operator">=</span><span class="variable">@as</span> <span class="operator">+</span> <span class="number">1</span> <span class="keyword">AS</span> asid, name <span class="keyword">AS</span> Asia</span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">        student</span><br><span class="line">    <span class="keyword">WHERE</span></span><br><span class="line">        continent <span class="operator">=</span> <span class="string">&#x27;Asia&#x27;</span></span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> Asia) <span class="keyword">AS</span> t1</span><br><span class="line">        <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span></span><br><span class="line">    (<span class="keyword">SELECT</span> </span><br><span class="line">        <span class="variable">@am</span>:<span class="operator">=</span><span class="variable">@am</span> <span class="operator">+</span> <span class="number">1</span> <span class="keyword">AS</span> amid, name <span class="keyword">AS</span> America</span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">        student</span><br><span class="line">    <span class="keyword">WHERE</span></span><br><span class="line">        continent <span class="operator">=</span> <span class="string">&#x27;America&#x27;</span></span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> America) <span class="keyword">AS</span> t2 <span class="keyword">ON</span> asid <span class="operator">=</span> amid</span><br><span class="line">        <span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">    (<span class="keyword">SELECT</span> </span><br><span class="line">        <span class="variable">@eu</span>:<span class="operator">=</span><span class="variable">@eu</span> <span class="operator">+</span> <span class="number">1</span> <span class="keyword">AS</span> euid, name <span class="keyword">AS</span> Europe</span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">        student</span><br><span class="line">    <span class="keyword">WHERE</span></span><br><span class="line">        continent <span class="operator">=</span> <span class="string">&#x27;Europe&#x27;</span></span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> Europe) <span class="keyword">AS</span> t3 <span class="keyword">ON</span> amid <span class="operator">=</span> euid</span><br></pre></td></tr></table></figure><blockquote><p>å®˜æ–¹ç»™å‡ºçš„ã€‚ã€‚åŒä¸‹æ–¹å¼€çª—</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> America,Asia,Europe </span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> name) <span class="keyword">as</span> rn,name <span class="keyword">as</span> America <span class="keyword">from</span> student</span><br><span class="line">    <span class="keyword">where</span> continent<span class="operator">=</span><span class="string">&#x27;America&#x27;</span></span><br><span class="line">) a</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span>(</span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> name) <span class="keyword">as</span> rn,name <span class="keyword">as</span> Asia <span class="keyword">from</span> student</span><br><span class="line">    <span class="keyword">where</span> continent<span class="operator">=</span><span class="string">&#x27;Asia&#x27;</span></span><br><span class="line">) b <span class="keyword">on</span> a.rn<span class="operator">=</span>b.rn</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span>(</span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> name) <span class="keyword">as</span> rn,name <span class="keyword">as</span> Europe <span class="keyword">from</span> student</span><br><span class="line">    <span class="keyword">where</span> continent<span class="operator">=</span><span class="string">&#x27;Europe&#x27;</span></span><br><span class="line">) c <span class="keyword">on</span> a.rn<span class="operator">=</span>c.rn</span><br></pre></td></tr></table></figure><h4 id="619-åªå‡ºç°ä¸€æ¬¡çš„æœ€å¤§æ•°å­—"><a href="#619-åªå‡ºç°ä¸€æ¬¡çš„æœ€å¤§æ•°å­—" class="headerlink" title="619. åªå‡ºç°ä¸€æ¬¡çš„æœ€å¤§æ•°å­—"></a><a href="https://leetcode-cn.com/problems/biggest-single-number/">619. åªå‡ºç°ä¸€æ¬¡çš„æœ€å¤§æ•°å­—</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>è¡¨ <code>my_numbers</code> çš„ <strong>num</strong> å­—æ®µåŒ…å«å¾ˆå¤šæ•°å­—ï¼Œå…¶ä¸­åŒ…æ‹¬å¾ˆå¤šé‡å¤çš„æ•°å­—ã€‚</p><p>ä½ èƒ½å†™ä¸€ä¸ª SQL æŸ¥è¯¢è¯­å¥ï¼Œæ‰¾åˆ°åªå‡ºç°è¿‡ä¸€æ¬¡çš„æ•°å­—ä¸­ï¼Œæœ€å¤§çš„ä¸€ä¸ªæ•°å­—å—ï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---+</span><br><span class="line">|num|</span><br><span class="line">+---+</span><br><span class="line">| 8 |</span><br><span class="line">| 8 |</span><br><span class="line">| 3 |</span><br><span class="line">| 3 |</span><br><span class="line">| 1 |</span><br><span class="line">| 4 |</span><br><span class="line">| 5 |</span><br><span class="line">| 6 | </span><br></pre></td></tr></table></figure><p>å¯¹äºä¸Šé¢ç»™å‡ºçš„æ ·ä¾‹æ•°æ®ï¼Œä½ çš„æŸ¥è¯¢è¯­å¥åº”è¯¥è¿”å›å¦‚ä¸‹ç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+---+</span><br><span class="line">|num|</span><br><span class="line">+---+</span><br><span class="line">| 6 |</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong></p><p>å¦‚æœæ²¡æœ‰åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—ï¼Œè¾“å‡º <strong>null</strong> ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="built_in">MAX</span>(num) <span class="keyword">AS</span> num</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    (<span class="keyword">SELECT</span></span><br><span class="line">        num</span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">        my_numbers</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> num</span><br><span class="line">    <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(num) <span class="operator">=</span> <span class="number">1</span>) t1</span><br></pre></td></tr></table></figure><h4 id="620-æœ‰è¶£çš„ç”µå½±"><a href="#620-æœ‰è¶£çš„ç”µå½±" class="headerlink" title="620. æœ‰è¶£çš„ç”µå½±"></a><a href="https://leetcode-cn.com/problems/not-boring-movies/">620. æœ‰è¶£çš„ç”µå½±</a></h4><p>éš¾åº¦ç®€å•86æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡å…³æ³¨åé¦ˆ</p><p>SQLæ¶æ„</p><p>æŸåŸå¸‚å¼€äº†ä¸€å®¶æ–°çš„ç”µå½±é™¢ï¼Œå¸å¼•äº†å¾ˆå¤šäººè¿‡æ¥çœ‹ç”µå½±ã€‚è¯¥ç”µå½±é™¢ç‰¹åˆ«æ³¨æ„ç”¨æˆ·ä½“éªŒï¼Œä¸“é—¨æœ‰ä¸ª LEDæ˜¾ç¤ºæ¿åšç”µå½±æ¨èï¼Œä¸Šé¢å…¬å¸ƒç€å½±è¯„å’Œç›¸å…³ç”µå½±æè¿°ã€‚</p><p>ä½œä¸ºè¯¥ç”µå½±é™¢çš„ä¿¡æ¯éƒ¨ä¸»ç®¡ï¼Œæ‚¨éœ€è¦ç¼–å†™ä¸€ä¸ª SQLæŸ¥è¯¢ï¼Œæ‰¾å‡ºæ‰€æœ‰å½±ç‰‡æè¿°ä¸º<strong>é</strong> <code>boring</code> (ä¸æ— èŠ) çš„å¹¶ä¸” <strong>id ä¸ºå¥‡æ•°</strong> çš„å½±ç‰‡ï¼Œç»“æœè¯·æŒ‰ç­‰çº§ <code>rating</code> æ’åˆ—ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸‹è¡¨ <code>cinema</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------+-----------+--------------+-----------+</span><br><span class="line">|   id    | movie     |  description |  rating   |</span><br><span class="line">+---------+-----------+--------------+-----------+</span><br><span class="line">|   1     | War       |   great 3D   |   8.9     |</span><br><span class="line">|   2     | Science   |   fiction    |   8.5     |</span><br><span class="line">|   3     | irish     |   boring     |   6.2     |</span><br><span class="line">|   4     | Ice song  |   Fantacy    |   8.6     |</span><br><span class="line">|   5     | House card|   Interesting|   9.1     |</span><br><span class="line">+---------+-----------+--------------+-----------+</span><br></pre></td></tr></table></figure><p>å¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œåˆ™æ­£ç¡®çš„è¾“å‡ºæ˜¯ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+---------+-----------+--------------+-----------+</span><br><span class="line">|   id    | movie     |  description |  rating   |</span><br><span class="line">+---------+-----------+--------------+-----------+</span><br><span class="line">|   5     | House card|   Interesting|   9.1     |</span><br><span class="line">|   1     | War       |   great 3D   |   8.9     |</span><br><span class="line">+---------+-----------+--------------+-----------+</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  id,movie,description,rating </span><br><span class="line"><span class="keyword">from</span> cinema</span><br><span class="line"><span class="keyword">where</span> id<span class="operator">%</span><span class="number">2</span><span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> description <span class="operator">!=</span><span class="string">&#x27;boring&#x27;</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> rating <span class="keyword">desc</span>,id,movie,description</span><br></pre></td></tr></table></figure><h4 id="626-æ¢åº§ä½"><a href="#626-æ¢åº§ä½" class="headerlink" title="626. æ¢åº§ä½"></a><a href="https://leetcode-cn.com/problems/exchange-seats/">626. æ¢åº§ä½</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>å°ç¾æ˜¯ä¸€æ‰€ä¸­å­¦çš„ä¿¡æ¯ç§‘æŠ€è€å¸ˆï¼Œå¥¹æœ‰ä¸€å¼  <code>seat</code> åº§ä½è¡¨ï¼Œå¹³æ—¶ç”¨æ¥å‚¨å­˜å­¦ç”Ÿåå­—å’Œä¸ä»–ä»¬ç›¸å¯¹åº”çš„åº§ä½ idã€‚</p><p>å…¶ä¸­çºµåˆ—çš„ <strong>id</strong> æ˜¯è¿ç»­é€’å¢çš„</p><p>å°ç¾æƒ³æ”¹å˜ç›¸é‚»ä¿©å­¦ç”Ÿçš„åº§ä½ã€‚</p><p>ä½ èƒ½ä¸èƒ½å¸®å¥¹å†™ä¸€ä¸ª SQL query æ¥è¾“å‡ºå°ç¾æƒ³è¦çš„ç»“æœå‘¢ï¼Ÿ </p><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------+---------+</span><br><span class="line">|    id   | student |</span><br><span class="line">+---------+---------+</span><br><span class="line">|    1    | Abbot   |</span><br><span class="line">|    2    | Doris   |</span><br><span class="line">|    3    | Emerson |</span><br><span class="line">|    4    | Green   |</span><br><span class="line">|    5    | Jeames  |</span><br><span class="line">+---------+---------+</span><br></pre></td></tr></table></figure><p>å‡å¦‚æ•°æ®è¾“å…¥çš„æ˜¯ä¸Šè¡¨ï¼Œåˆ™è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------+---------+</span><br><span class="line">|    id   | student |</span><br><span class="line">+---------+---------+</span><br><span class="line">|    1    | Doris   |</span><br><span class="line">|    2    | Abbot   |</span><br><span class="line">|    3    | Green   |</span><br><span class="line">|    4    | Emerson |</span><br><span class="line">|    5    | Jeames  |</span><br><span class="line">+---------+---------+</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong></p><p>å¦‚æœå­¦ç”Ÿäººæ•°æ˜¯å¥‡æ•°ï¼Œåˆ™ä¸éœ€è¦æ”¹å˜æœ€åä¸€ä¸ªåŒå­¦çš„åº§ä½ã€‚</p><p>å¼€çª—</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,</span><br><span class="line">(<span class="keyword">case</span> <span class="keyword">when</span> id<span class="operator">%</span><span class="number">2</span><span class="operator">=</span><span class="number">0</span> <span class="keyword">then</span> f</span><br><span class="line">      <span class="keyword">when</span> id<span class="operator">%</span><span class="number">2</span><span class="operator">=</span><span class="number">1</span> <span class="operator">&amp;&amp;</span> b <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">then</span> b</span><br><span class="line">      <span class="keyword">else</span> student <span class="keyword">end</span>) student</span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line">    <span class="keyword">select</span> id,student,</span><br><span class="line">    <span class="built_in">lag</span>(student,<span class="number">1</span>,<span class="keyword">null</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> id) f,</span><br><span class="line">    <span class="built_in">lead</span>(student,<span class="number">1</span>,<span class="keyword">null</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> id) b</span><br><span class="line">    <span class="keyword">from</span> seat</span><br><span class="line">)t1</span><br></pre></td></tr></table></figure><p>éåµŒå¥—</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    if(id<span class="operator">%</span><span class="number">2</span><span class="operator">=</span><span class="number">0</span>,</span><br><span class="line">        id<span class="number">-1</span>,</span><br><span class="line">        if(id<span class="operator">=</span>(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> id) <span class="keyword">from</span> seat),</span><br><span class="line">            id,</span><br><span class="line">            id<span class="operator">+</span><span class="number">1</span>)) </span><br><span class="line">    <span class="keyword">as</span> id,student </span><br><span class="line"><span class="keyword">from</span> seat </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> id;</span><br></pre></td></tr></table></figure><p>ç”¨å¼‚æˆ–</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> b.id,a.student <span class="keyword">from</span> </span><br><span class="line">seat <span class="keyword">as</span> a,seat <span class="keyword">as</span> b,(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> cnt <span class="keyword">from</span> seat) <span class="keyword">as</span> c </span><br><span class="line"><span class="keyword">where</span> b.id<span class="operator">=</span><span class="number">1</span><span class="operator">^</span>(a.id<span class="number">-1</span>)<span class="operator">+</span><span class="number">1</span></span><br><span class="line"><span class="comment">-- where a.id=1^(b.id-1)+1; ä¹Ÿå¯ä»¥è¿™æ ·å†™ï¼Œæ›´å®¹æ˜“ç†è§£</span></span><br><span class="line"> <span class="operator">||</span> (c.cnt<span class="operator">%</span><span class="number">2</span> <span class="operator">&amp;&amp;</span> b.id<span class="operator">=</span>c.cnt <span class="operator">&amp;&amp;</span> a.id<span class="operator">=</span>c.cnt);</span><br></pre></td></tr></table></figure><h4 id="627-äº¤æ¢å·¥èµ„"><a href="#627-äº¤æ¢å·¥èµ„" class="headerlink" title="627. äº¤æ¢å·¥èµ„"></a><a href="https://leetcode-cn.com/problems/swap-salary/">627. äº¤æ¢å·¥èµ„</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>ç»™å®šä¸€ä¸ª <code>salary</code> è¡¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œæœ‰ m = ç”·æ€§ å’Œ f = å¥³æ€§ çš„å€¼ã€‚äº¤æ¢æ‰€æœ‰çš„ f å’Œ m å€¼ï¼ˆä¾‹å¦‚ï¼Œå°†æ‰€æœ‰ f å€¼æ›´æ”¹ä¸º mï¼Œåä¹‹äº¦ç„¶ï¼‰ã€‚è¦æ±‚åªä½¿ç”¨ä¸€ä¸ªæ›´æ–°ï¼ˆUpdateï¼‰è¯­å¥ï¼Œå¹¶ä¸”æ²¡æœ‰ä¸­é—´çš„ä¸´æ—¶è¡¨ã€‚</p><p>æ³¨æ„ï¼Œæ‚¨å¿…åªèƒ½å†™ä¸€ä¸ª Update è¯­å¥ï¼Œè¯·ä¸è¦ç¼–å†™ä»»ä½• Select è¯­å¥ã€‚</p><p><strong>ä¾‹å¦‚ï¼š</strong></p><table><thead><tr><th>id</th><th>name</th><th>sex</th><th>salary</th></tr></thead><tbody><tr><td>1</td><td>A</td><td>m</td><td>2500</td></tr><tr><td>2</td><td>B</td><td>f</td><td>1500</td></tr><tr><td>3</td><td>C</td><td>m</td><td>5500</td></tr><tr><td>4</td><td>D</td><td>f</td><td>500</td></tr></tbody></table><p>è¿è¡Œä½ æ‰€ç¼–å†™çš„æ›´æ–°è¯­å¥ä¹‹åï¼Œå°†ä¼šå¾—åˆ°ä»¥ä¸‹è¡¨:</p><table><thead><tr><th>id</th><th>name</th><th>sex</th><th>salary</th></tr></thead><tbody><tr><td>1</td><td>A</td><td>f</td><td>2500</td></tr><tr><td>2</td><td>B</td><td>m</td><td>1500</td></tr><tr><td>3</td><td>C</td><td>f</td><td>5500</td></tr><tr><td>4</td><td>D</td><td>m</td><td>500</td></tr></tbody></table><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">UPDATE salary</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">    sex <span class="operator">=</span> <span class="keyword">CASE</span> sex</span><br><span class="line">        <span class="keyword">WHEN</span> <span class="string">&#x27;m&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;f&#x27;</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="string">&#x27;m&#x27;</span></span><br><span class="line">    <span class="keyword">END</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>Update å’Œsetçš„ä½¿ç”¨</p></blockquote><h4 id="1045-ä¹°ä¸‹æ‰€æœ‰äº§å“çš„å®¢æˆ·"><a href="#1045-ä¹°ä¸‹æ‰€æœ‰äº§å“çš„å®¢æˆ·" class="headerlink" title="1045. ä¹°ä¸‹æ‰€æœ‰äº§å“çš„å®¢æˆ·"></a><a href="https://leetcode-cn.com/problems/customers-who-bought-all-products/">1045. ä¹°ä¸‹æ‰€æœ‰äº§å“çš„å®¢æˆ·</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p><code>Customer</code> è¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| customer_id | int     |</span><br><span class="line">| product_key | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">product_key æ˜¯ Customer è¡¨çš„å¤–é”®ã€‚</span><br></pre></td></tr></table></figure><p><code>Product</code> è¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| product_key | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">product_key æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚</span><br></pre></td></tr></table></figure><p>å†™ä¸€æ¡ SQL æŸ¥è¯¢è¯­å¥ï¼Œä» <code>Customer</code> è¡¨ä¸­æŸ¥è¯¢è´­ä¹°äº† <code>Product</code> è¡¨ä¸­æ‰€æœ‰äº§å“çš„å®¢æˆ·çš„ idã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Customer è¡¨ï¼š</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| customer_id | product_key |</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| 1           | 5           |</span><br><span class="line">| 2           | 6           |</span><br><span class="line">| 3           | 5           |</span><br><span class="line">| 3           | 6           |</span><br><span class="line">| 1           | 6           |</span><br><span class="line">+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Product è¡¨ï¼š</span><br><span class="line">+-------------+</span><br><span class="line">| product_key |</span><br><span class="line">+-------------+</span><br><span class="line">| 5           |</span><br><span class="line">| 6           |</span><br><span class="line">+-------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+-------------+</span><br><span class="line">| customer_id |</span><br><span class="line">+-------------+</span><br><span class="line">| 1           |</span><br><span class="line">| 3           |</span><br><span class="line">+-------------+</span><br><span class="line">è´­ä¹°äº†æ‰€æœ‰äº§å“ï¼ˆ5 å’Œ 6ï¼‰çš„å®¢æˆ·çš„ id æ˜¯ 1 å’Œ 3 ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> customer_id</span><br><span class="line"><span class="keyword">from</span> Customer</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> customer_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> product_key)<span class="operator">=</span>(</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) cnt</span><br><span class="line"><span class="keyword">from</span> Product)</span><br></pre></td></tr></table></figure><h4 id="1050-åˆä½œè¿‡è‡³å°‘ä¸‰æ¬¡çš„æ¼”å‘˜å’Œå¯¼æ¼”"><a href="#1050-åˆä½œè¿‡è‡³å°‘ä¸‰æ¬¡çš„æ¼”å‘˜å’Œå¯¼æ¼”" class="headerlink" title="1050. åˆä½œè¿‡è‡³å°‘ä¸‰æ¬¡çš„æ¼”å‘˜å’Œå¯¼æ¼”"></a><a href="https://leetcode-cn.com/problems/actors-and-directors-who-cooperated-at-least-three-times/">1050. åˆä½œè¿‡è‡³å°‘ä¸‰æ¬¡çš„æ¼”å‘˜å’Œå¯¼æ¼”</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p><code>ActorDirector</code> è¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| actor_id    | int     |</span><br><span class="line">| director_id | int     |</span><br><span class="line">| timestamp   | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">timestamp æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®.</span><br></pre></td></tr></table></figure><p>å†™ä¸€æ¡SQLæŸ¥è¯¢è¯­å¥è·å–åˆä½œè¿‡è‡³å°‘ä¸‰æ¬¡çš„æ¼”å‘˜å’Œå¯¼æ¼”çš„ id å¯¹ <code>(actor_id, director_id)</code></p><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ActorDirector è¡¨ï¼š</span><br><span class="line">+-------------+-------------+-------------+</span><br><span class="line">| actor_id    | director_id | timestamp   |</span><br><span class="line">+-------------+-------------+-------------+</span><br><span class="line">| 1           | 1           | 0           |</span><br><span class="line">| 1           | 1           | 1           |</span><br><span class="line">| 1           | 1           | 2           |</span><br><span class="line">| 1           | 2           | 3           |</span><br><span class="line">| 1           | 2           | 4           |</span><br><span class="line">| 2           | 1           | 5           |</span><br><span class="line">| 2           | 1           | 6           |</span><br><span class="line">+-------------+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| actor_id    | director_id |</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| 1           | 1           |</span><br><span class="line">+-------------+-------------+</span><br><span class="line">å”¯ä¸€çš„ id å¯¹æ˜¯ (1, 1)ï¼Œä»–ä»¬æ°å¥½åˆä½œäº† 3 æ¬¡ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> actor_id,director_id</span><br><span class="line"><span class="keyword">from</span> ActorDirector</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> actor_id,director_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">&gt;=</span><span class="number">3</span></span><br></pre></td></tr></table></figure><h4 id="1068-äº§å“é”€å”®åˆ†æ-I"><a href="#1068-äº§å“é”€å”®åˆ†æ-I" class="headerlink" title="1068. äº§å“é”€å”®åˆ†æ I"></a><a href="https://leetcode-cn.com/problems/product-sales-analysis-i/">1068. äº§å“é”€å”®åˆ†æ I</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>é”€å”®è¡¨ <code>Sales</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+-------------+-------+</span><br><span class="line">| Column Name | Type  |</span><br><span class="line">+-------------+-------+</span><br><span class="line">| sale_id     | int   |</span><br><span class="line">| product_id  | int   |</span><br><span class="line">| year        | int   |</span><br><span class="line">| quantity    | int   |</span><br><span class="line">| price       | int   |</span><br><span class="line">+-------------+-------+</span><br><span class="line">(sale_id, year) æ˜¯é”€å”®è¡¨ Sales çš„ä¸»é”®.</span><br><span class="line">product_id æ˜¯äº§å“è¡¨ Product çš„å¤–é”®.</span><br><span class="line">æ³¨æ„: price è¡¨ç¤ºæ¯å•ä½ä»·æ ¼</span><br></pre></td></tr></table></figure><p>äº§å“è¡¨ <code>Product</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| product_id   | int     |</span><br><span class="line">| product_name | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">product_id æ˜¯è¡¨çš„ä¸»é”®.</span><br></pre></td></tr></table></figure><p>å†™ä¸€æ¡SQL æŸ¥è¯¢è¯­å¥è·å–äº§å“è¡¨ <code>Product</code> ä¸­æ‰€æœ‰çš„ <strong>äº§å“åç§° product name</strong> ä»¥åŠ è¯¥äº§å“åœ¨ <code>Sales</code> è¡¨ä¸­ç›¸å¯¹åº”çš„ <strong>ä¸Šå¸‚å¹´ä»½ year</strong> å’Œ <strong>ä»·æ ¼ price</strong>ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Sales è¡¨ï¼š</span><br><span class="line">+---------+------------+------+----------+-------+</span><br><span class="line">| sale_id | product_id | year | quantity | price |</span><br><span class="line">+---------+------------+------+----------+-------+ </span><br><span class="line">| 1       | 100        | 2008 | 10       | 5000  |</span><br><span class="line">| 2       | 100        | 2009 | 12       | 5000  |</span><br><span class="line">| 7       | 200        | 2011 | 15       | 9000  |</span><br><span class="line">+---------+------------+------+----------+-------+</span><br><span class="line"></span><br><span class="line">Product è¡¨ï¼š</span><br><span class="line">+------------+--------------+</span><br><span class="line">| product_id | product_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| 100        | Nokia        |</span><br><span class="line">| 200        | Apple        |</span><br><span class="line">| 300        | Samsung      |</span><br><span class="line">+------------+--------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+--------------+-------+-------+</span><br><span class="line">| product_name | year  | price |</span><br><span class="line">+--------------+-------+-------+</span><br><span class="line">| Nokia        | 2008  | 5000  |</span><br><span class="line">| Nokia        | 2009  | 5000  |</span><br><span class="line">| Apple        | 2011  | 9000  |</span><br><span class="line">+--------------+-------+-------+</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> product_name,<span class="keyword">year</span>,price</span><br><span class="line"><span class="keyword">from</span> Sales s <span class="keyword">left</span> <span class="keyword">join</span> Product p</span><br><span class="line"><span class="keyword">on</span> s.product_id  <span class="operator">=</span> p.product_id </span><br></pre></td></tr></table></figure><h4 id="1069-äº§å“é”€å”®åˆ†æ-II"><a href="#1069-äº§å“é”€å”®åˆ†æ-II" class="headerlink" title="1069. äº§å“é”€å”®åˆ†æ II"></a><a href="https://leetcode-cn.com/problems/product-sales-analysis-ii/">1069. äº§å“é”€å”®åˆ†æ II</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>é”€å”®è¡¨ï¼š<code>Sales</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+-------------+-------+</span><br><span class="line">| Column Name | Type  |</span><br><span class="line">+-------------+-------+</span><br><span class="line">| sale_id     | int   |</span><br><span class="line">| product_id  | int   |</span><br><span class="line">| year        | int   |</span><br><span class="line">| quantity    | int   |</span><br><span class="line">| price       | int   |</span><br><span class="line">+-------------+-------+</span><br><span class="line">sale_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">product_id æ˜¯ Product è¡¨çš„å¤–é”®ã€‚</span><br><span class="line">è¯·æ³¨æ„ä»·æ ¼æ˜¯æ¯å•ä½çš„ã€‚</span><br></pre></td></tr></table></figure><p>äº§å“è¡¨ï¼š<code>Product</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| product_id   | int     |</span><br><span class="line">| product_name | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">product_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒæŒ‰äº§å“ id <code>product_id</code> æ¥ç»Ÿè®¡æ¯ä¸ªäº§å“çš„é”€å”®æ€»é‡ã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹é¢ä¾‹å­æ‰€ç¤º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Sales è¡¨ï¼š</span><br><span class="line">+---------+------------+------+----------+-------+</span><br><span class="line">| sale_id | product_id | year | quantity | price |</span><br><span class="line">+---------+------------+------+----------+-------+ </span><br><span class="line">| 1       | 100        | 2008 | 10       | 5000  |</span><br><span class="line">| 2       | 100        | 2009 | 12       | 5000  |</span><br><span class="line">| 7       | 200        | 2011 | 15       | 9000  |</span><br><span class="line">+---------+------------+------+----------+-------+</span><br><span class="line"></span><br><span class="line">Product è¡¨ï¼š</span><br><span class="line">+------------+--------------+</span><br><span class="line">| product_id | product_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| 100        | Nokia        |</span><br><span class="line">| 200        | Apple        |</span><br><span class="line">| 300        | Samsung      |</span><br><span class="line">+------------+--------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+--------------+----------------+</span><br><span class="line">| product_id   | total_quantity |</span><br><span class="line">+--------------+----------------+</span><br><span class="line">| 100          | 22             |</span><br><span class="line">| 200          | 15             |</span><br><span class="line">+--------------+----------------+</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s.product_id,<span class="built_in">sum</span>(quantity) total_quantity</span><br><span class="line"><span class="keyword">from</span> Sales s <span class="keyword">left</span> <span class="keyword">join</span> Product p</span><br><span class="line"><span class="keyword">on</span> s.product_id  <span class="operator">=</span> p.product_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> s.product_id</span><br></pre></td></tr></table></figure><h4 id="1070-äº§å“é”€å”®åˆ†æ-III"><a href="#1070-äº§å“é”€å”®åˆ†æ-III" class="headerlink" title="1070. äº§å“é”€å”®åˆ†æ III"></a><a href="https://leetcode-cn.com/problems/product-sales-analysis-iii/">1070. äº§å“é”€å”®åˆ†æ III</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>é”€å”®è¡¨ <code>Sales</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+-------------+-------+</span><br><span class="line">| Column Name | Type  |</span><br><span class="line">+-------------+-------+</span><br><span class="line">| sale_id     | int   |</span><br><span class="line">| product_id  | int   |</span><br><span class="line">| year        | int   |</span><br><span class="line">| quantity    | int   |</span><br><span class="line">| price       | int   |</span><br><span class="line">+-------------+-------+</span><br><span class="line">sale_id æ˜¯æ­¤è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">product_id æ˜¯äº§å“è¡¨çš„å¤–é”®ã€‚</span><br><span class="line">è¯·æ³¨æ„ï¼Œä»·æ ¼æ˜¯æŒ‰æ¯å•ä½è®¡çš„ã€‚</span><br></pre></td></tr></table></figure><p>äº§å“è¡¨ <code>Product</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| product_id   | int     |</span><br><span class="line">| product_name | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">product_id æ˜¯æ­¤è¡¨çš„ä¸»é”®ã€‚</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œé€‰å‡ºæ¯ä¸ªé”€å”®äº§å“çš„ <strong>ç¬¬ä¸€å¹´</strong> çš„ <strong>äº§å“ id</strong>ã€<strong>å¹´ä»½</strong>ã€<strong>æ•°é‡</strong> å’Œ <strong>ä»·æ ¼</strong>ã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Sales table:</span><br><span class="line">+---------+------------+------+----------+-------+</span><br><span class="line">| sale_id | product_id | year | quantity | price |</span><br><span class="line">+---------+------------+------+----------+-------+ </span><br><span class="line">| 1       | 100        | 2008 | 10       | 5000  |</span><br><span class="line">| 2       | 100        | 2009 | 12       | 5000  |</span><br><span class="line">| 7       | 200        | 2011 | 15       | 9000  |</span><br><span class="line">+---------+------------+------+----------+-------+</span><br><span class="line"></span><br><span class="line">Product table:</span><br><span class="line">+------------+--------------+</span><br><span class="line">| product_id | product_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| 100        | Nokia        |</span><br><span class="line">| 200        | Apple        |</span><br><span class="line">| 300        | Samsung      |</span><br><span class="line">+------------+--------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+------------+----------+-------+</span><br><span class="line">| product_id | first_year | quantity | price |</span><br><span class="line">+------------+------------+----------+-------+ </span><br><span class="line">| 100        | 2008       | 10       | 5000  |</span><br><span class="line">| 200        | 2011       | 15       | 9000  |</span><br><span class="line">+------------+------------+----------+-------+</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> product_id,<span class="keyword">year</span> first_year,quantity,price</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span> s.product_id,<span class="keyword">year</span>,quantity,price,</span><br><span class="line"><span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> product_id <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">year</span>) rk</span><br><span class="line"><span class="keyword">from</span> Sales s <span class="keyword">left</span> <span class="keyword">join</span> Product p</span><br><span class="line"><span class="keyword">on</span> s.product_id  <span class="operator">=</span> p.product_id</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> rk <span class="operator">=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="1075-é¡¹ç›®å‘˜å·¥-I"><a href="#1075-é¡¹ç›®å‘˜å·¥-I" class="headerlink" title="1075. é¡¹ç›®å‘˜å·¥ I"></a><a href="https://leetcode-cn.com/problems/project-employees-i/">1075. é¡¹ç›®å‘˜å·¥ I</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>é¡¹ç›®è¡¨ <code>Project</code>ï¼š </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| project_id  | int     |</span><br><span class="line">| employee_id | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">ä¸»é”®ä¸º (project_id, employee_id)ã€‚</span><br><span class="line">employee_id æ˜¯å‘˜å·¥è¡¨ Employee è¡¨çš„å¤–é”®ã€‚</span><br></pre></td></tr></table></figure><p>å‘˜å·¥è¡¨ <code>Employee</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+------------------+---------+</span><br><span class="line">| Column Name      | Type    |</span><br><span class="line">+------------------+---------+</span><br><span class="line">| employee_id      | int     |</span><br><span class="line">| name             | varchar |</span><br><span class="line">| experience_years | int     |</span><br><span class="line">+------------------+---------+</span><br><span class="line">ä¸»é”®æ˜¯ employee_idã€‚</span><br></pre></td></tr></table></figure><p>è¯·å†™ä¸€ä¸ª SQL è¯­å¥ï¼ŒæŸ¥è¯¢æ¯ä¸€ä¸ªé¡¹ç›®ä¸­å‘˜å·¥çš„ <strong>å¹³å‡</strong> å·¥ä½œå¹´é™ï¼Œ<strong>ç²¾ç¡®åˆ°å°æ•°ç‚¹åä¸¤ä½</strong>ã€‚</p><p>æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Project è¡¨ï¼š</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| project_id  | employee_id |</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| 1           | 1           |</span><br><span class="line">| 1           | 2           |</span><br><span class="line">| 1           | 3           |</span><br><span class="line">| 2           | 1           |</span><br><span class="line">| 2           | 4           |</span><br><span class="line">+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Employee è¡¨ï¼š</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line">| employee_id | name   | experience_years |</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line">| 1           | Khaled | 3                |</span><br><span class="line">| 2           | Ali    | 2                |</span><br><span class="line">| 3           | John   | 1                |</span><br><span class="line">| 4           | Doe    | 2                |</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| project_id  | average_years |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 1           | 2.00          |</span><br><span class="line">| 2           | 2.50          |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">ç¬¬ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œå‘˜å·¥çš„å¹³å‡å·¥ä½œå¹´é™æ˜¯ (3 + 2 + 1) / 3 = 2.00ï¼›ç¬¬äºŒä¸ªé¡¹ç›®ä¸­ï¼Œå‘˜å·¥çš„å¹³å‡å·¥ä½œå¹´é™æ˜¯ (3 + 2) / 2 = 2.50</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> project_id,round(<span class="built_in">avg</span>(experience_years),<span class="number">2</span>) average_years</span><br><span class="line"><span class="keyword">from</span> Project p <span class="keyword">join</span> Employee e</span><br><span class="line"><span class="keyword">on</span> p.employee_id<span class="operator">=</span>e.employee_id </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> project_id</span><br></pre></td></tr></table></figure><h4 id="1076-é¡¹ç›®å‘˜å·¥II"><a href="#1076-é¡¹ç›®å‘˜å·¥II" class="headerlink" title="1076. é¡¹ç›®å‘˜å·¥II"></a><a href="https://leetcode-cn.com/problems/project-employees-ii/">1076. é¡¹ç›®å‘˜å·¥II</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>Table: <code>Project</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| project_id  | int     |</span><br><span class="line">| employee_id | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">ä¸»é”®ä¸º (project_id, employee_id)ã€‚</span><br><span class="line">employee_id æ˜¯å‘˜å·¥è¡¨ Employee è¡¨çš„å¤–é”®ã€‚</span><br></pre></td></tr></table></figure><p>Table: <code>Employee</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+------------------+---------+</span><br><span class="line">| Column Name      | Type    |</span><br><span class="line">+------------------+---------+</span><br><span class="line">| employee_id      | int     |</span><br><span class="line">| name             | varchar |</span><br><span class="line">| experience_years | int     |</span><br><span class="line">+------------------+---------+</span><br><span class="line">ä¸»é”®æ˜¯ employee_idã€‚</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€ä¸ªSQLæŸ¥è¯¢ï¼ŒæŠ¥å‘Šæ‰€æœ‰é›‡å‘˜æœ€å¤šçš„é¡¹ç›®ã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Project table:</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| project_id  | employee_id |</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| 1           | 1           |</span><br><span class="line">| 1           | 2           |</span><br><span class="line">| 1           | 3           |</span><br><span class="line">| 2           | 1           |</span><br><span class="line">| 2           | 4           |</span><br><span class="line">+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Employee table:</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line">| employee_id | name   | experience_years |</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line">| 1           | Khaled | 3                |</span><br><span class="line">| 2           | Ali    | 2                |</span><br><span class="line">| 3           | John   | 1                |</span><br><span class="line">| 4           | Doe    | 2                |</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-------------+</span><br><span class="line">| project_id  |</span><br><span class="line">+-------------+</span><br><span class="line">| 1           |</span><br><span class="line">+-------------+</span><br><span class="line">ç¬¬ä¸€ä¸ªé¡¹ç›®æœ‰3åå‘˜å·¥ï¼Œç¬¬äºŒä¸ªé¡¹ç›®æœ‰2åå‘˜å·¥ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> project_id </span><br><span class="line"><span class="keyword">from</span> Project </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> project_id </span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="operator">=</span> </span><br><span class="line">(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) `num` <span class="keyword">from</span> Project <span class="keyword">group</span> <span class="keyword">by</span> project_id <span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">desc</span> limit <span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>å¼€çª—</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> project_id <span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> project_id,<span class="built_in">rank</span>()<span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">count</span>(employee_id) <span class="keyword">desc</span>) ranking <span class="keyword">from</span> Project <span class="keyword">group</span> <span class="keyword">by</span> project_id) temp <span class="keyword">where</span> ranking<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="1077-é¡¹ç›®å‘˜å·¥-III"><a href="#1077-é¡¹ç›®å‘˜å·¥-III" class="headerlink" title="1077. é¡¹ç›®å‘˜å·¥ III"></a><a href="https://leetcode-cn.com/problems/project-employees-iii/">1077. é¡¹ç›®å‘˜å·¥ III</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>é¡¹ç›®è¡¨ <code>Project</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| project_id  | int     |</span><br><span class="line">| employee_id | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">(project_id, employee_id) æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®</span><br><span class="line">employee_id æ˜¯å‘˜å·¥è¡¨ Employee çš„å¤–é”®</span><br></pre></td></tr></table></figure><p>å‘˜å·¥è¡¨ <code>Employee</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+------------------+---------+</span><br><span class="line">| Column Name      | Type    |</span><br><span class="line">+------------------+---------+</span><br><span class="line">| employee_id      | int     |</span><br><span class="line">| name             | varchar |</span><br><span class="line">| experience_years | int     |</span><br><span class="line">+------------------+---------+</span><br><span class="line">employee_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®</span><br></pre></td></tr></table></figure><p>å†™ ä¸€ä¸ª SQL æŸ¥è¯¢è¯­å¥ï¼ŒæŠ¥å‘Šåœ¨æ¯ä¸€ä¸ªé¡¹ç›®ä¸­ç»éªŒæœ€ä¸°å¯Œçš„é›‡å‘˜æ˜¯è°ã€‚å¦‚æœå‡ºç°ç»éªŒå¹´æ•°ç›¸åŒçš„æƒ…å†µï¼Œè¯·æŠ¥å‘Šæ‰€æœ‰å…·æœ‰æœ€å¤§ç»éªŒå¹´æ•°çš„å‘˜å·¥ã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Project è¡¨ï¼š</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| project_id  | employee_id |</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| 1           | 1           |</span><br><span class="line">| 1           | 2           |</span><br><span class="line">| 1           | 3           |</span><br><span class="line">| 2           | 1           |</span><br><span class="line">| 2           | 4           |</span><br><span class="line">+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Employee è¡¨ï¼š</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line">| employee_id | name   | experience_years |</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line">| 1           | Khaled | 3                |</span><br><span class="line">| 2           | Ali    | 2                |</span><br><span class="line">| 3           | John   | 3                |</span><br><span class="line">| 4           | Doe    | 2                |</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| project_id  | employee_id   |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 1           | 1             |</span><br><span class="line">| 1           | 3             |</span><br><span class="line">| 2           | 1             |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">employee_id ä¸º 1 å’Œ 3 çš„å‘˜å·¥åœ¨ project_id ä¸º 1 çš„é¡¹ç›®ä¸­æ‹¥æœ‰æœ€ä¸°å¯Œçš„ç»éªŒã€‚åœ¨ project_id ä¸º 2 çš„é¡¹ç›®ä¸­ï¼Œemployee_id ä¸º 1 çš„å‘˜å·¥æ‹¥æœ‰æœ€ä¸°å¯Œçš„ç»éªŒã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> project_id ,employee_id</span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line"><span class="keyword">select</span> project_id,e.employee_id,</span><br><span class="line"><span class="built_in">rank</span>()<span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> project_id <span class="keyword">order</span> <span class="keyword">by</span> experience_years <span class="keyword">desc</span>) rk</span><br><span class="line"><span class="keyword">from</span> Project p <span class="keyword">join</span> Employee e</span><br><span class="line"><span class="keyword">on</span> p.employee_id<span class="operator">=</span>e.employee_id </span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> rk<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="1082-é”€å”®åˆ†æ-I"><a href="#1082-é”€å”®åˆ†æ-I" class="headerlink" title="1082. é”€å”®åˆ†æ I "></a><a href="https://leetcode-cn.com/problems/sales-analysis-i/">1082. é”€å”®åˆ†æ I </a></h4><p>éš¾åº¦ç®€å•22</p><p>SQLæ¶æ„</p><p>äº§å“è¡¨ï¼š<code>Product</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| product_id   | int     |</span><br><span class="line">| product_name | varchar |</span><br><span class="line">| unit_price   | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">product_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®.</span><br></pre></td></tr></table></figure><p>é”€å”®è¡¨ï¼š<code>Sales</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| seller_id   | int     |</span><br><span class="line">| product_id  | int     |</span><br><span class="line">| buyer_id    | int     |</span><br><span class="line">| sale_date   | date    |</span><br><span class="line">| quantity    | int     |</span><br><span class="line">| price       | int     |</span><br><span class="line">+------ ------+---------+</span><br><span class="line">è¿™ä¸ªè¡¨æ²¡æœ‰ä¸»é”®ï¼Œå®ƒå¯ä»¥æœ‰é‡å¤çš„è¡Œ.</span><br><span class="line">product_id æ˜¯ Product è¡¨çš„å¤–é”®.</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒæŸ¥è¯¢æ€»é”€å”®é¢æœ€é«˜çš„é”€å”®è€…ï¼Œå¦‚æœæœ‰å¹¶åˆ—çš„ï¼Œå°±éƒ½å±•ç¤ºå‡ºæ¥ã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Product è¡¨ï¼š</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line">| product_id | product_name | unit_price |</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line">| 1          | S8           | 1000       |</span><br><span class="line">| 2          | G4           | 800        |</span><br><span class="line">| 3          | iPhone       | 1400       |</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line"></span><br><span class="line">Sales è¡¨ï¼š</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line">| seller_id | product_id | buyer_id | sale_date  | quantity | price |</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line">| 1         | 1          | 1        | 2019-01-21 | 2        | 2000  |</span><br><span class="line">| 1         | 2          | 2        | 2019-02-17 | 1        | 800   |</span><br><span class="line">| 2         | 2          | 3        | 2019-06-02 | 1        | 800   |</span><br><span class="line">| 3         | 3          | 4        | 2019-05-13 | 2        | 2800  |</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+-------------+</span><br><span class="line">| seller_id   |</span><br><span class="line">+-------------+</span><br><span class="line">| 1           |</span><br><span class="line">| 3           |</span><br><span class="line">+-------------+</span><br><span class="line">Id ä¸º 1 å’Œ 3 çš„é”€å”®è€…ï¼Œé”€å”®æ€»é‡‘é¢éƒ½ä¸ºæœ€é«˜çš„ 2800ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> seller_id</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span> seller_id ,<span class="built_in">sum</span>(price) tp,<span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">sum</span>(price) <span class="keyword">desc</span>) rk</span><br><span class="line"><span class="keyword">from</span> Sales</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> seller_id</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> rk <span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="1083-é”€å”®åˆ†æ-II"><a href="#1083-é”€å”®åˆ†æ-II" class="headerlink" title="1083. é”€å”®åˆ†æ II"></a><a href="https://leetcode-cn.com/problems/sales-analysis-ii/">1083. é”€å”®åˆ†æ II</a></h4><p>éš¾åº¦ç®€å•13</p><p>SQLæ¶æ„</p><p>Table: <code>Product</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| product_id   | int     |</span><br><span class="line">| product_name | varchar |</span><br><span class="line">| unit_price   | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">product_id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®</span><br></pre></td></tr></table></figure><p>Table: <code>Sales</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| seller_id   | int     |</span><br><span class="line">| product_id  | int     |</span><br><span class="line">| buyer_id    | int     |</span><br><span class="line">| sale_date   | date    |</span><br><span class="line">| quantity    | int     |</span><br><span class="line">| price       | int     |</span><br><span class="line">+------ ------+---------+</span><br><span class="line">è¿™ä¸ªè¡¨æ²¡æœ‰ä¸»é”®ï¼Œå®ƒå¯ä»¥æœ‰é‡å¤çš„è¡Œ.</span><br><span class="line">product_id æ˜¯ Product è¡¨çš„å¤–é”®.</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒæŸ¥è¯¢è´­ä¹°äº† S8 æ‰‹æœºå´æ²¡æœ‰è´­ä¹° iPhone çš„ä¹°å®¶ã€‚æ³¨æ„è¿™é‡Œ S8 å’Œ iPhone æ˜¯ Product è¡¨ä¸­çš„äº§å“ã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹å›¾è¡¨ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Product table:</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line">| product_id | product_name | unit_price |</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line">| 1          | S8           | 1000       |</span><br><span class="line">| 2          | G4           | 800        |</span><br><span class="line">| 3          | iPhone       | 1400       |</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line"></span><br><span class="line">Sales table:</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line">| seller_id | product_id | buyer_id | sale_date  | quantity | price |</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line">| 1         | 1          | 1        | 2019-01-21 | 2        | 2000  |</span><br><span class="line">| 1         | 2          | 2        | 2019-02-17 | 1        | 800   |</span><br><span class="line">| 2         | 1          | 3        | 2019-06-02 | 1        | 800   |</span><br><span class="line">| 3         | 3          | 3        | 2019-05-13 | 2        | 2800  |</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-------------+</span><br><span class="line">| buyer_id    |</span><br><span class="line">+-------------+</span><br><span class="line">| 1           |</span><br><span class="line">+-------------+</span><br><span class="line">id ä¸º 1 çš„ä¹°å®¶è´­ä¹°äº†ä¸€éƒ¨ S8ï¼Œä½†æ˜¯å´æ²¡æœ‰è´­ä¹° iPhoneï¼Œè€Œ id ä¸º 3 çš„ä¹°å®¶å´åŒæ—¶è´­ä¹°äº†è¿™ 2 éƒ¨æ‰‹æœºã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> t.buyer_id <span class="keyword">from</span>(</span><br><span class="line"><span class="keyword">select</span> s.buyer_id, p.product_name</span><br><span class="line"><span class="keyword">from</span> sales s</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span></span><br><span class="line">product p</span><br><span class="line"><span class="keyword">on</span> s.product_id<span class="operator">=</span>p.product_id <span class="keyword">and</span> (p.product_name<span class="operator">=</span><span class="string">&#x27;S8&#x27;</span> <span class="keyword">or</span> p.product_name<span class="operator">=</span><span class="string">&#x27;iPhone&#x27;</span>)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> s.buyer_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> p.product_name) <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">) t</span><br><span class="line"><span class="keyword">where</span> t.product_name<span class="operator">=</span><span class="string">&#x27;S8&#x27;</span></span><br></pre></td></tr></table></figure><p>æ•ˆç‡ä½</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s.buyer_id </span><br><span class="line"><span class="keyword">from</span> sales <span class="keyword">as</span> s <span class="keyword">left</span> <span class="keyword">join</span> product <span class="keyword">as</span> p </span><br><span class="line"><span class="keyword">on</span> s.product_id<span class="operator">=</span>p.product_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> buyer_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">sum</span>(p.product_name<span class="operator">=</span><span class="string">&#x27;S8&#x27;</span>)<span class="operator">&gt;</span><span class="number">0</span> <span class="keyword">and</span> <span class="built_in">sum</span>(p.product_name<span class="operator">=</span><span class="string">&#x27;iPhone&#x27;</span>)<span class="operator">=</span><span class="number">0</span></span><br></pre></td></tr></table></figure><h4 id="1084-é”€å”®åˆ†æIII"><a href="#1084-é”€å”®åˆ†æIII" class="headerlink" title="1084. é”€å”®åˆ†æIII"></a><a href="https://leetcode-cn.com/problems/sales-analysis-iii/">1084. é”€å”®åˆ†æIII</a></h4><p>éš¾åº¦ç®€å•13</p><p>SQLæ¶æ„</p><p>Table: <code>Product</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| product_id   | int     |</span><br><span class="line">| product_name | varchar |</span><br><span class="line">| unit_price   | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">product_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®</span><br></pre></td></tr></table></figure><p>Table: <code>Sales</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| seller_id   | int     |</span><br><span class="line">| product_id  | int     |</span><br><span class="line">| buyer_id    | int     |</span><br><span class="line">| sale_date   | date    |</span><br><span class="line">| quantity    | int     |</span><br><span class="line">| price       | int     |</span><br><span class="line">+------ ------+---------+</span><br><span class="line">è¿™ä¸ªè¡¨æ²¡æœ‰ä¸»é”®ï¼Œå®ƒå¯ä»¥æœ‰é‡å¤çš„è¡Œ.</span><br><span class="line">product_id æ˜¯ Product è¡¨çš„å¤–é”®.</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€ä¸ªSQLæŸ¥è¯¢ï¼ŒæŠ¥å‘Š2019å¹´æ˜¥å­£æ‰å”®å‡ºçš„äº§å“ã€‚å³<strong>ä»…</strong>åœ¨<strong>2019-01-01</strong>è‡³<strong>2019-03-31</strong>ï¼ˆå«ï¼‰ä¹‹é—´å‡ºå”®çš„å•†å“ã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Product table:</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line">| product_id | product_name | unit_price |</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line">| 1          | S8           | 1000       |</span><br><span class="line">| 2          | G4           | 800        |</span><br><span class="line">| 3          | iPhone       | 1400       |</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line"></span><br><span class="line">Sales table:</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line">| seller_id | product_id | buyer_id | sale_date  | quantity | price |</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line">| 1         | 1          | 1        | 2019-01-21 | 2        | 2000  |</span><br><span class="line">| 1         | 2          | 2        | 2019-02-17 | 1        | 800   |</span><br><span class="line">| 2         | 2          | 3        | 2019-06-02 | 1        | 800   |</span><br><span class="line">| 3         | 3          | 4        | 2019-05-13 | 2        | 2800  |</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| product_id  | product_name |</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| 1           | S8           |</span><br><span class="line">+-------------+--------------+</span><br><span class="line">idä¸º1çš„äº§å“ä»…åœ¨2019å¹´æ˜¥å­£é”€å”®ï¼Œå…¶ä»–ä¸¤ä¸ªäº§å“åœ¨ä¹‹åé”€å”®ã€‚</span><br></pre></td></tr></table></figure><p>876ms</p><p>æ­£å¸¸è§£æ³•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> product_id, product_name  </span><br><span class="line"><span class="keyword">from</span> product </span><br><span class="line"><span class="keyword">where</span> product_id <span class="keyword">not</span> <span class="keyword">in</span> (</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> product_id <span class="keyword">from</span> sales </span><br><span class="line"><span class="keyword">where</span> sale_date <span class="operator">&gt;</span> <span class="string">&#x27;2019-03-31&#x27;</span> <span class="keyword">or</span> sale_date <span class="operator">&lt;</span> <span class="string">&#x27;2019-01-01&#x27;</span>)</span><br></pre></td></tr></table></figure><p>867ms</p><p>sum = count</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> product_id, product_name</span><br><span class="line"><span class="keyword">from</span> Sales <span class="keyword">join</span> Product</span><br><span class="line"><span class="keyword">using</span>(product_id)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> product_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">sum</span>(sale_date <span class="keyword">between</span> &quot;2019-01-01&quot; <span class="keyword">and</span> &quot;2019-03-31&quot;) <span class="operator">=</span> <span class="built_in">count</span>(sale_date)</span><br></pre></td></tr></table></figure><p>987ms</p><p>sum ä¸º0 ç±»ä¼¼äºç¬¬ä¸€ç§è§£æ³•ï¼Œè®¡ç®—äº†sumæ•ˆç‡å°±ä½äº†</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> p.product_id, p.product_name</span><br><span class="line"><span class="keyword">from</span> sales s, product p</span><br><span class="line"><span class="keyword">where</span> s.product_id <span class="operator">=</span> p.product_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> s.product_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">sum</span>(s.sale_date<span class="operator">&gt;</span> <span class="string">&#x27;2019-03-31&#x27;</span>)<span class="operator">=</span><span class="number">0</span> <span class="keyword">and</span> <span class="built_in">sum</span>(s.sale_date <span class="operator">&lt;</span> <span class="string">&#x27;2019-01-01&#x27;</span>) <span class="operator">=</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><p>ä¸Šä¸€è§£æ³•sumæ¢æˆmax</p><p>859ms</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> p.product_id, p.product_name</span><br><span class="line"><span class="keyword">from</span> sales s, product p</span><br><span class="line"><span class="keyword">where</span> s.product_id <span class="operator">=</span> p.product_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> s.product_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">min</span>(s.sale_date)<span class="operator">&gt;=</span><span class="string">&#x27;2019-01-01&#x27;</span> <span class="keyword">and</span> <span class="built_in">max</span>(s.sale_date) <span class="operator">&lt;=</span> <span class="string">&#x27;2019-03-31&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="1097-æ¸¸æˆç©æ³•åˆ†æ-V"><a href="#1097-æ¸¸æˆç©æ³•åˆ†æ-V" class="headerlink" title="1097. æ¸¸æˆç©æ³•åˆ†æ V"></a><a href="https://leetcode-cn.com/problems/game-play-analysis-v/">1097. æ¸¸æˆç©æ³•åˆ†æ V</a></h4><p>éš¾åº¦å›°éš¾</p><p>SQLæ¶æ„</p><p><code>Activity</code> æ´»åŠ¨è®°å½•è¡¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| player_id    | int     |</span><br><span class="line">| device_id    | int     |</span><br><span class="line">| event_date   | date    |</span><br><span class="line">| games_played | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">ï¼ˆplayer_idï¼Œevent_dateï¼‰æ˜¯æ­¤è¡¨çš„ä¸»é”®</span><br><span class="line">è¿™å¼ è¡¨æ˜¾ç¤ºäº†æŸäº›æ¸¸æˆçš„ç©å®¶çš„æ´»åŠ¨æƒ…å†µ</span><br><span class="line">æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªç©å®¶çš„è®°å½•ï¼Œä»–åœ¨æŸä¸€å¤©ä½¿ç”¨æŸä¸ªè®¾å¤‡æ³¨é”€ä¹‹å‰ç™»å½•å¹¶ç©äº†å¾ˆå¤šæ¸¸æˆï¼ˆå¯èƒ½æ˜¯ 0ï¼‰</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†ç©å®¶çš„å®‰è£…æ—¥æœŸå®šä¹‰ä¸ºè¯¥ç©å®¶çš„ç¬¬ä¸€ä¸ªç™»å½•æ—¥ã€‚</p><p>æˆ‘ä»¬è¿˜å°†æŸä¸ªæ—¥æœŸ <code>X</code> çš„ç¬¬ 1 å¤©ç•™å­˜æ—¶é—´å®šä¹‰ä¸ºå®‰è£…æ—¥æœŸä¸º <code>X</code> çš„ç©å®¶çš„æ•°é‡ï¼Œä»–ä»¬åœ¨ <code>X</code> ä¹‹åçš„ä¸€å¤©é‡æ–°ç™»å½•ï¼Œé™¤ä»¥å®‰è£…æ—¥æœŸä¸º <code>X</code> çš„ç©å®¶çš„æ•°é‡ï¼Œå››èˆäº”å…¥åˆ°å°æ•°ç‚¹åä¸¤ä½ã€‚</p><p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒæŠ¥å‘Šæ¯ä¸ªå®‰è£…æ—¥æœŸã€å½“å¤©å®‰è£…æ¸¸æˆçš„ç©å®¶æ•°é‡å’Œç¬¬ä¸€å¤©çš„ç•™å­˜æ—¶é—´ã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Activity è¡¨ï¼š</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| player_id | device_id | event_date | games_played |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| 1         | 2         | 2016-03-01 | 5            |</span><br><span class="line">| 1         | 2         | 2016-03-02 | 6            |</span><br><span class="line">| 2         | 3         | 2017-06-25 | 1            |</span><br><span class="line">| 3         | 1         | 2016-03-01 | 0            |</span><br><span class="line">| 3         | 4         | 2016-07-03 | 5            |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+------------+----------+----------------+</span><br><span class="line">| install_dt | installs | Day1_retention |</span><br><span class="line">+------------+----------+----------------+</span><br><span class="line">| 2016-03-01 | 2        | 0.50           |</span><br><span class="line">| 2017-06-25 | 1        | 0.00           |</span><br><span class="line">+------------+----------+----------------+</span><br><span class="line">ç©å®¶ 1 å’Œ 3 åœ¨ 2016-03-01 å®‰è£…äº†æ¸¸æˆï¼Œä½†åªæœ‰ç©å®¶ 1 åœ¨ 2016-03-02 é‡æ–°ç™»å½•ï¼Œæ‰€ä»¥ 2016-03-01 çš„ç¬¬ä¸€å¤©ç•™å­˜æ—¶é—´æ˜¯ 1/2=0.50</span><br><span class="line">ç©å®¶ 2 åœ¨ 2017-06-25 å®‰è£…äº†æ¸¸æˆï¼Œä½†åœ¨ 2017-06-26 æ²¡æœ‰é‡æ–°ç™»å½•ï¼Œå› æ­¤ 2017-06-25 çš„ç¬¬ä¸€å¤©ç•™å­˜æ—¶é—´ä¸º 0/1=0.00</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> install_dt,<span class="built_in">count</span>(<span class="keyword">distinct</span> player_id)installs,</span><br><span class="line">       round(<span class="built_in">sum</span>(if(datediff(event_date,install_dt)<span class="operator">=</span><span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>))<span class="operator">/</span><span class="built_in">count</span>(<span class="keyword">distinct</span> player_id),<span class="number">2</span>) Day1_retention </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> <span class="operator">*</span>,<span class="built_in">min</span>(event_date) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> player_id) install_dt</span><br><span class="line">    <span class="keyword">from</span> Activity</span><br><span class="line">)t1   </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> install_dt</span><br></pre></td></tr></table></figure><h4 id="1098-å°ä¼—ä¹¦ç±"><a href="#1098-å°ä¼—ä¹¦ç±" class="headerlink" title="1098. å°ä¼—ä¹¦ç±"></a><a href="https://leetcode-cn.com/problems/unpopular-books/">1098. å°ä¼—ä¹¦ç±</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>ä¹¦ç±è¡¨ <code>Books</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| book_id        | int     |</span><br><span class="line">| name           | varchar |</span><br><span class="line">| available_from | date    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">book_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚</span><br></pre></td></tr></table></figure><p>è®¢å•è¡¨ <code>Orders</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| order_id       | int     |</span><br><span class="line">| book_id        | int     |</span><br><span class="line">| quantity       | int     |</span><br><span class="line">| dispatch_date  | date    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">order_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">book_id  æ˜¯ Books è¡¨çš„å¤–é”®ã€‚</span><br></pre></td></tr></table></figure><p>ä½ éœ€è¦å†™ä¸€æ®µ SQL å‘½ä»¤ï¼Œç­›é€‰å‡ºè¿‡å»ä¸€å¹´ä¸­è®¢å•æ€»é‡ <strong>å°‘äº10æœ¬</strong> çš„ <strong>ä¹¦ç±</strong> ã€‚</p><p>æ³¨æ„ï¼š<strong>ä¸è€ƒè™‘</strong> ä¸Šæ¶ï¼ˆavailable fromï¼‰è·ä»Š <strong>ä¸æ»¡ä¸€ä¸ªæœˆ</strong> çš„ä¹¦ç±ã€‚å¹¶ä¸” <strong>å‡è®¾ä»Šå¤©æ˜¯</strong> <strong>2019-06-23</strong> ã€‚</p><p> Write an SQL query that reports the books that have sold less than 10 copies in the last year, excluding books that have been available for less than 1 month from today. Assume today is 2019-06-23.</p><p>ä¸‹é¢æ˜¯æ ·ä¾‹è¾“å‡ºç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Books è¡¨ï¼š</span><br><span class="line">+---------+--------------------+----------------+</span><br><span class="line">| book_id | name               | available_from |</span><br><span class="line">+---------+--------------------+----------------+</span><br><span class="line">| 1       | &quot;Kalila And Demna&quot; | 2010-01-01     |</span><br><span class="line">| 2       | &quot;28 Letters&quot;       | 2012-05-12     |</span><br><span class="line">| 3       | &quot;The Hobbit&quot;       | 2019-06-10     |</span><br><span class="line">| 4       | &quot;13 Reasons Why&quot;   | 2019-06-01     |</span><br><span class="line">| 5       | &quot;The Hunger Games&quot; | 2008-09-21     |</span><br><span class="line">+---------+--------------------+----------------+</span><br><span class="line"></span><br><span class="line">Orders è¡¨ï¼š</span><br><span class="line">+----------+---------+----------+---------------+</span><br><span class="line">| order_id | book_id | quantity | dispatch_date |</span><br><span class="line">+----------+---------+----------+---------------+</span><br><span class="line">| 1        | 1       | 2        | 2018-07-26    |</span><br><span class="line">| 2        | 1       | 1        | 2018-11-05    |</span><br><span class="line">| 3        | 3       | 8        | 2019-06-11    |</span><br><span class="line">| 4        | 4       | 6        | 2019-06-05    |</span><br><span class="line">| 5        | 4       | 5        | 2019-06-20    |</span><br><span class="line">| 6        | 5       | 9        | 2009-02-02    |</span><br><span class="line">| 7        | 5       | 8        | 2010-04-13    |</span><br><span class="line">+----------+---------+----------+---------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+-----------+--------------------+</span><br><span class="line">| book_id   | name               |</span><br><span class="line">+-----------+--------------------+</span><br><span class="line">| 1         | &quot;Kalila And Demna&quot; |</span><br><span class="line">| 2         | &quot;28 Letters&quot;       |</span><br><span class="line">| 5         | &quot;The Hunger Games&quot; |</span><br><span class="line">+-----------+--------------------+</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é¢˜ä¸­è‹±æ–‡ éƒ½æœ‰æ­§ä¹‰ï¼Œçœ‹ç»“æœè¿›è¡Œåˆ†æ</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> a.book_id, a.name </span><br><span class="line"><span class="keyword">FROM</span> books a <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> orders b <span class="keyword">ON</span> a.book_id<span class="operator">=</span>b.book_id </span><br><span class="line"><span class="keyword">AND</span> dispatch_date <span class="keyword">BETWEEN</span> DATE_ADD(<span class="string">&#x27;2019-06-23&#x27;</span>, <span class="type">INTERVAL</span> <span class="number">-1</span> <span class="keyword">YEAR</span>) <span class="keyword">AND</span> <span class="string">&#x27;2019-06-23&#x27;</span> </span><br><span class="line"><span class="keyword">WHERE</span> a.available_from <span class="operator">&lt;=</span> DATE_ADD(<span class="string">&#x27;2019-06-23&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">-1</span> <span class="keyword">MONTH</span>) </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> a.book_id, a.name </span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">SUM</span>(IFNULL(b.quantity,<span class="number">0</span>)) <span class="operator">&lt;</span> <span class="number">10</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> a.book_id;</span><br></pre></td></tr></table></figure><blockquote><p>æ­¤é¢˜æœ‰å‘ï¼Œé¦–å…ˆè®¢å•è¿‘ä¸€å¹´ï¼Œå†è€…quantityä¸ºnullï¼Œè¿˜æœ‰è¿‘ä¸€æœˆå‡ºç‰ˆï¼Œsumä¸æ˜¯è®¢å•æ˜¯æœ¬æ•°</p><p>è¿˜æœ‰å°±æ˜¯date_addè¿™ä¸ªå‡½æ•°åœ¨hiveé‡Œå’Œmysqlè¯­æ³•ä¸Šæœ‰ç‚¹å°åŒºåˆ«</p></blockquote><h4 id="1107-æ¯æ—¥æ–°ç”¨æˆ·ç»Ÿè®¡"><a href="#1107-æ¯æ—¥æ–°ç”¨æˆ·ç»Ÿè®¡" class="headerlink" title="1107. æ¯æ—¥æ–°ç”¨æˆ·ç»Ÿè®¡"></a><a href="https://leetcode-cn.com/problems/new-users-daily-count/">1107. æ¯æ—¥æ–°ç”¨æˆ·ç»Ÿè®¡</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p><code>Traffic</code> è¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| activity      | enum    |</span><br><span class="line">| activity_date | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">è¯¥è¡¨æ²¡æœ‰ä¸»é”®ï¼Œå®ƒå¯èƒ½æœ‰é‡å¤çš„è¡Œã€‚</span><br><span class="line">activity åˆ—æ˜¯ ENUM ç±»å‹ï¼Œå¯èƒ½å– (&#x27;login&#x27;, &#x27;logout&#x27;, &#x27;jobs&#x27;, &#x27;groups&#x27;, &#x27;homepage&#x27;) å‡ ä¸ªå€¼ä¹‹ä¸€ã€‚</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œä»¥æŸ¥è¯¢ä»ä»Šå¤©èµ·æœ€å¤š 90 å¤©å†…ï¼Œæ¯ä¸ªæ—¥æœŸè¯¥æ—¥æœŸé¦–æ¬¡ç™»å½•çš„ç”¨æˆ·æ•°ã€‚å‡è®¾ä»Šå¤©æ˜¯ <strong>2019-06-30</strong>.</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Traffic è¡¨ï¼š</span><br><span class="line">+---------+----------+---------------+</span><br><span class="line">| user_id | activity | activity_date |</span><br><span class="line">+---------+----------+---------------+</span><br><span class="line">| 1       | login    | 2019-05-01    |</span><br><span class="line">| 1       | homepage | 2019-05-01    |</span><br><span class="line">| 1       | logout   | 2019-05-01    |</span><br><span class="line">| 2       | login    | 2019-06-21    |</span><br><span class="line">| 2       | logout   | 2019-06-21    |</span><br><span class="line">| 3       | login    | 2019-01-01    |</span><br><span class="line">| 3       | jobs     | 2019-01-01    |</span><br><span class="line">| 3       | logout   | 2019-01-01    |</span><br><span class="line">| 4       | login    | 2019-06-21    |</span><br><span class="line">| 4       | groups   | 2019-06-21    |</span><br><span class="line">| 4       | logout   | 2019-06-21    |</span><br><span class="line">| 5       | login    | 2019-03-01    |</span><br><span class="line">| 5       | logout   | 2019-03-01    |</span><br><span class="line">| 5       | login    | 2019-06-21    |</span><br><span class="line">| 5       | logout   | 2019-06-21    |</span><br><span class="line">+---------+----------+---------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+------------+-------------+</span><br><span class="line">| login_date | user_count  |</span><br><span class="line">+------------+-------------+</span><br><span class="line">| 2019-05-01 | 1           |</span><br><span class="line">| 2019-06-21 | 2           |</span><br><span class="line">+------------+-------------+</span><br><span class="line">è¯·æ³¨æ„ï¼Œæˆ‘ä»¬åªå…³å¿ƒç”¨æˆ·æ•°éé›¶çš„æ—¥æœŸ.</span><br><span class="line">ID ä¸º 5 çš„ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»é™†äº 2019-03-01ï¼Œå› æ­¤ä»–ä¸ç®—åœ¨ 2019-06-21 çš„çš„ç»Ÿè®¡å†…ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> login_date,<span class="built_in">count</span>(<span class="operator">*</span>) user_count</span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line">    <span class="keyword">select</span> user_id,<span class="built_in">min</span>(activity_date) login_date</span><br><span class="line">    <span class="keyword">from</span> Traffic</span><br><span class="line">    <span class="keyword">where</span> activity <span class="operator">=</span> <span class="string">&#x27;login&#x27;</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> user_id</span><br><span class="line">    <span class="keyword">having</span> login_date<span class="operator">&gt;=</span> DATE_ADD(<span class="string">&#x27;2019-06-30&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">-90</span> <span class="keyword">DAY</span>) </span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> login_date</span><br></pre></td></tr></table></figure><h4 id="1112-æ¯ä½å­¦ç”Ÿçš„æœ€é«˜æˆç»©"><a href="#1112-æ¯ä½å­¦ç”Ÿçš„æœ€é«˜æˆç»©" class="headerlink" title="1112. æ¯ä½å­¦ç”Ÿçš„æœ€é«˜æˆç»©"></a><a href="https://leetcode-cn.com/problems/highest-grade-for-each-student/">1112. æ¯ä½å­¦ç”Ÿçš„æœ€é«˜æˆç»©</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>è¡¨ï¼š<code>Enrollments</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| student_id    | int     |</span><br><span class="line">| course_id     | int     |</span><br><span class="line">| grade         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(student_id, course_id) æ˜¯è¯¥è¡¨çš„ä¸»é”®ã€‚</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒæŸ¥è¯¢æ¯ä½å­¦ç”Ÿè·å¾—çš„æœ€é«˜æˆç»©å’Œå®ƒæ‰€å¯¹åº”çš„ç§‘ç›®ï¼Œè‹¥ç§‘ç›®æˆç»©å¹¶åˆ—ï¼Œå– <code>course_id</code> æœ€å°çš„ä¸€é—¨ã€‚æŸ¥è¯¢ç»“æœéœ€æŒ‰ <code>student_id</code> å¢åºè¿›è¡Œæ’åºã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Enrollments è¡¨ï¼š</span><br><span class="line">+------------+-------------------+</span><br><span class="line">| student_id | course_id | grade |</span><br><span class="line">+------------+-----------+-------+</span><br><span class="line">| 2          | 2         | 95    |</span><br><span class="line">| 2          | 3         | 95    |</span><br><span class="line">| 1          | 1         | 90    |</span><br><span class="line">| 1          | 2         | 99    |</span><br><span class="line">| 3          | 1         | 80    |</span><br><span class="line">| 3          | 2         | 75    |</span><br><span class="line">| 3          | 3         | 82    |</span><br><span class="line">+------------+-----------+-------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+------------+-------------------+</span><br><span class="line">| student_id | course_id | grade |</span><br><span class="line">+------------+-----------+-------+</span><br><span class="line">| 1          | 2         | 99    |</span><br><span class="line">| 2          | 2         | 95    |</span><br><span class="line">| 3          | 3         | 82    |</span><br><span class="line">+------------+-----------+-------+</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> student_id,course_id ,grade</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span> student_id,course_id ,grade,</span><br><span class="line"><span class="built_in">rank</span>()<span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> student_id <span class="keyword">order</span> <span class="keyword">by</span> grade <span class="keyword">desc</span>,course_id) rK</span><br><span class="line"><span class="keyword">from</span> Enrollments</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> rk <span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="1113-æŠ¥å‘Šçš„è®°å½•"><a href="#1113-æŠ¥å‘Šçš„è®°å½•" class="headerlink" title="1113. æŠ¥å‘Šçš„è®°å½•"></a><a href="https://leetcode-cn.com/problems/reported-posts/">1113. æŠ¥å‘Šçš„è®°å½•</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>åŠ¨ä½œè¡¨ï¼š<code>Actions</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| post_id       | int     |</span><br><span class="line">| action_date   | date    | </span><br><span class="line">| action        | enum    |</span><br><span class="line">| extra         | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">æ­¤è¡¨æ²¡æœ‰ä¸»é”®ï¼Œæ‰€ä»¥å¯èƒ½ä¼šæœ‰é‡å¤çš„è¡Œã€‚</span><br><span class="line">action å­—æ®µæ˜¯ ENUM ç±»å‹çš„ï¼ŒåŒ…å«:(&#x27;view&#x27;, &#x27;like&#x27;, &#x27;reaction&#x27;, &#x27;comment&#x27;, &#x27;report&#x27;, &#x27;share&#x27;)</span><br><span class="line">extra å­—æ®µæ˜¯å¯é€‰çš„ä¿¡æ¯ï¼ˆå¯èƒ½ä¸º nullï¼‰ï¼Œå…¶ä¸­çš„ä¿¡æ¯ä¾‹å¦‚æœ‰ï¼š1.æŠ¥å‘Šç†ç”±(a reason for report) 2.ååº”ç±»å‹(a type of reaction)</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€æ¡SQLï¼ŒæŸ¥è¯¢æ¯ç§ <em><strong>æŠ¥å‘Šç†ç”±</strong></em>ï¼ˆreport reasonï¼‰åœ¨æ˜¨å¤©çš„æŠ¥å‘Šæ•°é‡ã€‚å‡è®¾ä»Šå¤©æ˜¯ <strong>2019-07-05</strong>ã€‚</p><p>æŸ¥è¯¢åŠç»“æœçš„æ ¼å¼ç¤ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Actions table:</span><br><span class="line">+---------+---------+-------------+--------+--------+</span><br><span class="line">| user_id | post_id | action_date | action | extra  |</span><br><span class="line">+---------+---------+-------------+--------+--------+</span><br><span class="line">| 1       | 1       | 2019-07-01  | view   | null   |</span><br><span class="line">| 1       | 1       | 2019-07-01  | like   | null   |</span><br><span class="line">| 1       | 1       | 2019-07-01  | share  | null   |</span><br><span class="line">| 2       | 4       | 2019-07-04  | view   | null   |</span><br><span class="line">| 2       | 4       | 2019-07-04  | report | spam   |</span><br><span class="line">| 3       | 4       | 2019-07-04  | view   | null   |</span><br><span class="line">| 3       | 4       | 2019-07-04  | report | spam   |</span><br><span class="line">| 4       | 3       | 2019-07-02  | view   | null   |</span><br><span class="line">| 4       | 3       | 2019-07-02  | report | spam   |</span><br><span class="line">| 5       | 2       | 2019-07-04  | view   | null   |</span><br><span class="line">| 5       | 2       | 2019-07-04  | report | racism |</span><br><span class="line">| 5       | 5       | 2019-07-04  | view   | null   |</span><br><span class="line">| 5       | 5       | 2019-07-04  | report | racism |</span><br><span class="line">+---------+---------+-------------+--------+--------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+---------------+--------------+</span><br><span class="line">| report_reason | report_count |</span><br><span class="line">+---------------+--------------+</span><br><span class="line">| spam          | 1            |</span><br><span class="line">| racism        | 2            |</span><br><span class="line">+---------------+--------------+ </span><br><span class="line">æ³¨æ„ï¼Œæˆ‘ä»¬åªå…³å¿ƒæŠ¥å‘Šæ•°é‡éé›¶çš„ç»“æœã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">extra <span class="keyword">AS</span> report_reason,</span><br><span class="line"><span class="built_in">COUNT</span>(<span class="keyword">distinct</span> post_id) <span class="keyword">AS</span> report_count</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">Actions</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">`action` <span class="operator">=</span> <span class="string">&#x27;report&#x27;</span> <span class="keyword">AND</span> action_date <span class="operator">=</span> date_add(<span class="string">&#x27;2019-07-05&#x27;</span>,<span class="type">Interval</span> <span class="number">-1</span> <span class="keyword">day</span>)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">extra;</span><br></pre></td></tr></table></figure><h4 id="1132-æŠ¥å‘Šçš„è®°å½•-II"><a href="#1132-æŠ¥å‘Šçš„è®°å½•-II" class="headerlink" title="1132. æŠ¥å‘Šçš„è®°å½• II"></a><a href="https://leetcode-cn.com/problems/reported-posts-ii/">1132. æŠ¥å‘Šçš„è®°å½• II</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>åŠ¨ä½œè¡¨ï¼š <code>Actions</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| post_id       | int     |</span><br><span class="line">| action_date   | date    |</span><br><span class="line">| action        | enum    |</span><br><span class="line">| extra         | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">è¿™å¼ è¡¨æ²¡æœ‰ä¸»é”®ï¼Œå¹¶æœ‰å¯èƒ½å­˜åœ¨é‡å¤çš„è¡Œã€‚</span><br><span class="line">action åˆ—çš„ç±»å‹æ˜¯ ENUMï¼Œå¯èƒ½çš„å€¼ä¸º (&#x27;view&#x27;, &#x27;like&#x27;, &#x27;reaction&#x27;, &#x27;comment&#x27;, &#x27;report&#x27;, &#x27;share&#x27;)ã€‚</span><br><span class="line">extra åˆ—æ‹¥æœ‰ä¸€äº›å¯é€‰ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šæŠ¥å‘Šç†ç”±ï¼ˆa reason for reportï¼‰æˆ–ååº”ç±»å‹ï¼ˆa type of reactionï¼‰ç­‰ã€‚</span><br></pre></td></tr></table></figure><p>ç§»é™¤è¡¨ï¼š <code>Removals</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| post_id       | int     |</span><br><span class="line">| remove_date   | date    | </span><br><span class="line">+---------------+---------+</span><br><span class="line">è¿™å¼ è¡¨çš„ä¸»é”®æ˜¯ post_idã€‚</span><br><span class="line">è¿™å¼ è¡¨çš„æ¯ä¸€è¡Œè¡¨ç¤ºä¸€ä¸ªè¢«ç§»é™¤çš„å¸–å­ï¼ŒåŸå› å¯èƒ½æ˜¯ç”±äºè¢«ä¸¾æŠ¥æˆ–è¢«ç®¡ç†å‘˜å®¡æŸ¥ã€‚</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€æ®µ SQL æ¥æŸ¥æ‰¾ï¼šåœ¨è¢«æŠ¥å‘Šä¸ºåƒåœ¾å¹¿å‘Šçš„å¸–å­ä¸­ï¼Œè¢«ç§»é™¤çš„å¸–å­çš„æ¯æ—¥å¹³å‡å æ¯”ï¼Œ<strong>å››èˆäº”å…¥åˆ°å°æ•°ç‚¹å 2 ä½</strong>ã€‚</p><p>æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Actions table:</span><br><span class="line">+---------+---------+-------------+--------+--------+</span><br><span class="line">| user_id | post_id | action_date | action | extra  |</span><br><span class="line">+---------+---------+-------------+--------+--------+</span><br><span class="line">| 1       | 1       | 2019-07-01  | view   | null   |</span><br><span class="line">| 1       | 1       | 2019-07-01  | like   | null   |</span><br><span class="line">| 1       | 1       | 2019-07-01  | share  | null   |</span><br><span class="line">| 2       | 2       | 2019-07-04  | view   | null   |</span><br><span class="line">| 2       | 2       | 2019-07-04  | report | spam   |</span><br><span class="line">| 3       | 4       | 2019-07-04  | view   | null   |</span><br><span class="line">| 3       | 4       | 2019-07-04  | report | spam   |</span><br><span class="line">| 4       | 3       | 2019-07-02  | view   | null   |</span><br><span class="line">| 4       | 3       | 2019-07-02  | report | spam   |</span><br><span class="line">| 5       | 2       | 2019-07-03  | view   | null   |</span><br><span class="line">| 5       | 2       | 2019-07-03  | report | racism |</span><br><span class="line">| 5       | 5       | 2019-07-03  | view   | null   |</span><br><span class="line">| 5       | 5       | 2019-07-03  | report | racism |</span><br><span class="line">+---------+---------+-------------+--------+--------+</span><br><span class="line"></span><br><span class="line">Removals table:</span><br><span class="line">+---------+-------------+</span><br><span class="line">| post_id | remove_date |</span><br><span class="line">+---------+-------------+</span><br><span class="line">| 2       | 2019-07-20  |</span><br><span class="line">| 3       | 2019-07-18  |</span><br><span class="line">+---------+-------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-----------------------+</span><br><span class="line">| average_daily_percent |</span><br><span class="line">+-----------------------+</span><br><span class="line">| 75.00                 |</span><br><span class="line">+-----------------------+</span><br><span class="line">2019-07-04 çš„åƒåœ¾å¹¿å‘Šç§»é™¤ç‡æ˜¯ 50%ï¼Œå› ä¸ºæœ‰ä¸¤å¼ å¸–å­è¢«æŠ¥å‘Šä¸ºåƒåœ¾å¹¿å‘Šï¼Œä½†åªæœ‰ä¸€ä¸ªå¾—åˆ°ç§»é™¤ã€‚</span><br><span class="line">2019-07-02 çš„åƒåœ¾å¹¿å‘Šç§»é™¤ç‡æ˜¯ 100%ï¼Œå› ä¸ºæœ‰ä¸€å¼ å¸–å­è¢«ä¸¾æŠ¥ä¸ºåƒåœ¾å¹¿å‘Šå¹¶å¾—åˆ°ç§»é™¤ã€‚</span><br><span class="line">å…¶ä½™å‡ å¤©æ²¡æœ‰æ”¶åˆ°åƒåœ¾å¹¿å‘Šçš„ä¸¾æŠ¥ï¼Œå› æ­¤å¹³å‡å€¼ä¸ºï¼š(50 + 100) / 2 = 75%</span><br><span class="line">æ³¨æ„ï¼Œè¾“å‡ºä»…éœ€è¦ä¸€ä¸ªå¹³å‡å€¼å³å¯ï¼Œæˆ‘ä»¬å¹¶ä¸å…³æ³¨ç§»é™¤æ“ä½œçš„æ—¥æœŸã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="built_in">AVG</span>(proportion) <span class="operator">*</span> <span class="number">100</span>, <span class="number">2</span>) <span class="keyword">AS</span> average_daily_percent  </span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> actions.action_date, <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> removals.post_id)<span class="operator">/</span><span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> actions.post_id) <span class="keyword">AS</span> proportion</span><br><span class="line">    <span class="keyword">FROM</span> actions</span><br><span class="line">    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> removals</span><br><span class="line">    <span class="keyword">ON</span> actions.post_id <span class="operator">=</span> removals.post_id</span><br><span class="line">    <span class="keyword">WHERE</span> extra <span class="operator">=</span> <span class="string">&#x27;spam&#x27;</span> </span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> actions.action_date</span><br><span class="line">) a</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>è¦ç†è§£spamçš„å«ä¹‰</p></blockquote><h4 id="1126-æŸ¥è¯¢æ´»è·ƒä¸šåŠ¡"><a href="#1126-æŸ¥è¯¢æ´»è·ƒä¸šåŠ¡" class="headerlink" title="1126. æŸ¥è¯¢æ´»è·ƒä¸šåŠ¡"></a><a href="https://leetcode-cn.com/problems/active-businesses/">1126. æŸ¥è¯¢æ´»è·ƒä¸šåŠ¡</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>äº‹ä»¶è¡¨ï¼š<code>Events</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| business_id   | int     |</span><br><span class="line">| event_type    | varchar |</span><br><span class="line">| occurences    | int     | </span><br><span class="line">+---------------+---------+</span><br><span class="line">æ­¤è¡¨çš„ä¸»é”®æ˜¯ (business_id, event_type)ã€‚</span><br><span class="line">è¡¨ä¸­çš„æ¯ä¸€è¡Œè®°å½•äº†æŸç§ç±»å‹çš„äº‹ä»¶åœ¨æŸäº›ä¸šåŠ¡ä¸­å¤šæ¬¡å‘ç”Ÿçš„ä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure><p>å†™ä¸€æ®µ SQL æ¥æŸ¥è¯¢æ‰€æœ‰æ´»è·ƒçš„ä¸šåŠ¡ã€‚</p><p>å¦‚æœä¸€ä¸ªä¸šåŠ¡çš„æŸä¸ªäº‹ä»¶ç±»å‹çš„å‘ç”Ÿæ¬¡æ•°å¤§äºæ­¤äº‹ä»¶ç±»å‹åœ¨æ‰€æœ‰ä¸šåŠ¡ä¸­çš„å¹³å‡å‘ç”Ÿæ¬¡æ•°ï¼Œå¹¶ä¸”è¯¥ä¸šåŠ¡è‡³å°‘æœ‰ä¸¤ä¸ªè¿™æ ·çš„äº‹ä»¶ç±»å‹ï¼Œé‚£ä¹ˆè¯¥ä¸šåŠ¡å°±å¯è¢«çœ‹åšæ˜¯æ´»è·ƒä¸šåŠ¡ã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Events table:</span><br><span class="line">+-------------+------------+------------+</span><br><span class="line">| business_id | event_type | occurences |</span><br><span class="line">+-------------+------------+------------+</span><br><span class="line">| 1           | reviews    | 7          |</span><br><span class="line">| 3           | reviews    | 3          |</span><br><span class="line">| 1           | ads        | 11         |</span><br><span class="line">| 2           | ads        | 7          |</span><br><span class="line">| 3           | ads        | 6          |</span><br><span class="line">| 1           | page views | 3          |</span><br><span class="line">| 2           | page views | 12         |</span><br><span class="line">+-------------+------------+------------+</span><br><span class="line"></span><br><span class="line">ç»“æœè¡¨</span><br><span class="line">+-------------+</span><br><span class="line">| business_id |</span><br><span class="line">+-------------+</span><br><span class="line">| 1           |</span><br><span class="line">+-------------+ </span><br><span class="line">&#x27;reviews&#x27;ã€ &#x27;ads&#x27; å’Œ &#x27;page views&#x27; çš„æ€»å¹³å‡å‘ç”Ÿæ¬¡æ•°åˆ†åˆ«æ˜¯ (7+3)/2=5, (11+7+6)/3=8, (3+12)/2=7.5ã€‚</span><br><span class="line">id ä¸º 1 çš„ä¸šåŠ¡æœ‰ 7 ä¸ª &#x27;reviews&#x27; äº‹ä»¶ï¼ˆå¤§äº 5ï¼‰å’Œ 11 ä¸ª &#x27;ads&#x27; äº‹ä»¶ï¼ˆå¤§äº 8ï¼‰ï¼Œæ‰€ä»¥å®ƒæ˜¯æ´»è·ƒä¸šåŠ¡ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> business_id</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> business_id,occurences,</span><br><span class="line">    <span class="built_in">avg</span>(occurences) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> event_type) avo</span><br><span class="line">    <span class="keyword">from</span> Events</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span>  occurences <span class="operator">&gt;</span> avo</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> business_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">&gt;=</span><span class="number">2</span></span><br></pre></td></tr></table></figure><h4 id="1127-ç”¨æˆ·è´­ä¹°å¹³å°"><a href="#1127-ç”¨æˆ·è´­ä¹°å¹³å°" class="headerlink" title="1127. ç”¨æˆ·è´­ä¹°å¹³å°"></a><a href="https://leetcode-cn.com/problems/user-purchase-platform/">1127. ç”¨æˆ·è´­ä¹°å¹³å°</a></h4><p>éš¾åº¦å›°éš¾</p><p>SQLæ¶æ„</p><p>æ”¯å‡ºè¡¨: <code>Spending</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| user_id     | int     |</span><br><span class="line">| spend_date  | date    |</span><br><span class="line">| platform    | enum    | </span><br><span class="line">| amount      | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">è¿™å¼ è¡¨è®°å½•äº†ç”¨æˆ·åœ¨ä¸€ä¸ªåœ¨çº¿è´­ç‰©ç½‘ç«™çš„æ”¯å‡ºå†å²ï¼Œè¯¥åœ¨çº¿è´­ç‰©å¹³å°åŒæ—¶æ‹¥æœ‰æ¡Œé¢ç«¯ï¼ˆ&#x27;desktop&#x27;ï¼‰å’Œæ‰‹æœºç«¯ï¼ˆ&#x27;mobile&#x27;ï¼‰çš„åº”ç”¨ç¨‹åºã€‚</span><br><span class="line">è¿™å¼ è¡¨çš„ä¸»é”®æ˜¯ (user_id, spend_date, platform)ã€‚</span><br><span class="line">å¹³å°åˆ— platform æ˜¯ä¸€ç§ ENUM ï¼Œç±»å‹ä¸ºï¼ˆ&#x27;desktop&#x27;, &#x27;mobile&#x27;ï¼‰ã€‚</span><br></pre></td></tr></table></figure><p>å†™ä¸€æ®µ SQL æ¥æŸ¥æ‰¾æ¯å¤© <strong>ä»…</strong> ä½¿ç”¨æ‰‹æœºç«¯ç”¨æˆ·ã€<strong>ä»…</strong> ä½¿ç”¨æ¡Œé¢ç«¯ç”¨æˆ·å’Œ <strong>åŒæ—¶</strong> ä½¿ç”¨æ¡Œé¢ç«¯å’Œæ‰‹æœºç«¯çš„ç”¨æˆ·äººæ•°å’Œæ€»æ”¯å‡ºé‡‘é¢ã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Spending table:</span><br><span class="line">+---------+------------+----------+--------+</span><br><span class="line">| user_id | spend_date | platform | amount |</span><br><span class="line">+---------+------------+----------+--------+</span><br><span class="line">| 1       | 2019-07-01 | mobile   | 100    |</span><br><span class="line">| 1       | 2019-07-01 | desktop  | 100    |</span><br><span class="line">| 2       | 2019-07-01 | mobile   | 100    |</span><br><span class="line">| 2       | 2019-07-02 | mobile   | 100    |</span><br><span class="line">| 3       | 2019-07-01 | desktop  | 100    |</span><br><span class="line">| 3       | 2019-07-02 | desktop  | 100    |</span><br><span class="line">+---------+------------+----------+--------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+----------+--------------+-------------+</span><br><span class="line">| spend_date | platform | total_amount | total_users |</span><br><span class="line">+------------+----------+--------------+-------------+</span><br><span class="line">| 2019-07-01 | desktop  | 100          | 1           |</span><br><span class="line">| 2019-07-01 | mobile   | 100          | 1           |</span><br><span class="line">| 2019-07-01 | both     | 200          | 1           |</span><br><span class="line">| 2019-07-02 | desktop  | 100          | 1           |</span><br><span class="line">| 2019-07-02 | mobile   | 100          | 1           |</span><br><span class="line">| 2019-07-02 | both     | 0            | 0           |</span><br><span class="line">+------------+----------+--------------+-------------+ </span><br><span class="line">åœ¨ 2019-07-01, ç”¨æˆ·1 åŒæ—¶ ä½¿ç”¨æ¡Œé¢ç«¯å’Œæ‰‹æœºç«¯è´­ä¹°, ç”¨æˆ·2 ä»… ä½¿ç”¨äº†æ‰‹æœºç«¯è´­ä¹°ï¼Œè€Œç”¨æˆ·3 ä»… ä½¿ç”¨äº†æ¡Œé¢ç«¯è´­ä¹°ã€‚</span><br><span class="line">åœ¨ 2019-07-02, ç”¨æˆ·2 ä»… ä½¿ç”¨äº†æ‰‹æœºç«¯è´­ä¹°, ç”¨æˆ·3 ä»… ä½¿ç”¨äº†æ¡Œé¢ç«¯è´­ä¹°ï¼Œä¸”æ²¡æœ‰ç”¨æˆ· åŒæ—¶ ä½¿ç”¨æ¡Œé¢ç«¯å’Œæ‰‹æœºç«¯è´­ä¹°ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">    spend_date, platform,</span><br><span class="line">    ifnull(<span class="built_in">sum</span>(total_am),<span class="number">0</span>) total_amount,</span><br><span class="line">    ifnull(<span class="built_in">sum</span>(total_u),<span class="number">0</span>) total_users</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> p.spend_date, p.platform, t.total_am, t.total_u</span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">distinct</span> spend_date, &quot;desktop&quot; platform <span class="keyword">from</span> Spending</span><br><span class="line">        <span class="keyword">union</span></span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">distinct</span> spend_date, &quot;mobile&quot; platform <span class="keyword">from</span> Spending</span><br><span class="line">        <span class="keyword">union</span></span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">distinct</span> spend_date, &quot;both&quot; platform <span class="keyword">from</span> Spending</span><br><span class="line">    ) p</span><br><span class="line">    <span class="keyword">left</span> <span class="keyword">join</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> spend_date, </span><br><span class="line">            if(<span class="built_in">count</span>(<span class="keyword">distinct</span> platform)<span class="operator">=</span><span class="number">1</span>, platform, <span class="string">&#x27;both&#x27;</span>) plat,</span><br><span class="line">            <span class="built_in">sum</span>(amount) total_am,</span><br><span class="line">            <span class="built_in">count</span>(<span class="keyword">distinct</span> user_id) total_u</span><br><span class="line">        <span class="keyword">from</span> Spending</span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> spend_date, user_id</span><br><span class="line">    ) t</span><br><span class="line">    <span class="keyword">on</span> p.platform <span class="operator">=</span> t.plat <span class="keyword">and</span> p.spend_date <span class="operator">=</span> t.spend_date</span><br><span class="line">) temp</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> spend_date, platform</span><br></pre></td></tr></table></figure><blockquote><p>å¿…é¡»ä¿è¯ desktop mobile bothçš„é¡ºåº ï¼Œæ‰€ä»¥ å…ˆåˆ—å‡ºä¸‰ä¸ªå­—æ®µ</p></blockquote><h4 id="1141-æŸ¥è¯¢è¿‘30å¤©æ´»è·ƒç”¨æˆ·æ•°"><a href="#1141-æŸ¥è¯¢è¿‘30å¤©æ´»è·ƒç”¨æˆ·æ•°" class="headerlink" title="1141. æŸ¥è¯¢è¿‘30å¤©æ´»è·ƒç”¨æˆ·æ•°"></a><a href="https://leetcode-cn.com/problems/user-activity-for-the-past-30-days-i/">1141. æŸ¥è¯¢è¿‘30å¤©æ´»è·ƒç”¨æˆ·æ•°</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>æ´»åŠ¨è®°å½•è¡¨ï¼š<code>Activity</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| session_id    | int     |</span><br><span class="line">| activity_date | date    |</span><br><span class="line">| activity_type | enum    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">è¯¥è¡¨æ˜¯ç”¨æˆ·åœ¨ç¤¾äº¤ç½‘ç«™çš„æ´»åŠ¨è®°å½•ã€‚</span><br><span class="line">è¯¥è¡¨æ²¡æœ‰ä¸»é”®ï¼Œå¯èƒ½åŒ…å«é‡å¤æ•°æ®ã€‚</span><br><span class="line">activity_type å­—æ®µä¸ºä»¥ä¸‹å››ç§å€¼ (&#x27;open_session&#x27;, &#x27;end_session&#x27;, &#x27;scroll_down&#x27;, &#x27;send_message&#x27;)ã€‚</span><br><span class="line">æ¯ä¸ª session_id åªå±äºä¸€ä¸ªç”¨æˆ·ã€‚</span><br></pre></td></tr></table></figure><p>è¯·å†™SQLæŸ¥è¯¢å‡ºæˆªè‡³ <strong>2019-07-27</strong>ï¼ˆåŒ…å«2019-07-27ï¼‰<strong>ï¼Œè¿‘</strong> 30å¤©çš„æ¯æ—¥æ´»è·ƒç”¨æˆ·æ•°ï¼ˆå½“å¤©åªè¦æœ‰ä¸€æ¡æ´»åŠ¨è®°å½•ï¼Œå³ä¸ºæ´»è·ƒç”¨æˆ·ï¼‰ã€‚</p><p>æŸ¥è¯¢ç»“æœç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Activity table:</span><br><span class="line">+---------+------------+---------------+---------------+</span><br><span class="line">| user_id | session_id | activity_date | activity_type |</span><br><span class="line">+---------+------------+---------------+---------------+</span><br><span class="line">| 1       | 1          | 2019-07-20    | open_session  |</span><br><span class="line">| 1       | 1          | 2019-07-20    | scroll_down   |</span><br><span class="line">| 1       | 1          | 2019-07-20    | end_session   |</span><br><span class="line">| 2       | 4          | 2019-07-20    | open_session  |</span><br><span class="line">| 2       | 4          | 2019-07-21    | send_message  |</span><br><span class="line">| 2       | 4          | 2019-07-21    | end_session   |</span><br><span class="line">| 3       | 2          | 2019-07-21    | open_session  |</span><br><span class="line">| 3       | 2          | 2019-07-21    | send_message  |</span><br><span class="line">| 3       | 2          | 2019-07-21    | end_session   |</span><br><span class="line">| 4       | 3          | 2019-06-25    | open_session  |</span><br><span class="line">| 4       | 3          | 2019-06-25    | end_session   |</span><br><span class="line">+---------+------------+---------------+---------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+--------------+ </span><br><span class="line">| day        | active_users |</span><br><span class="line">+------------+--------------+ </span><br><span class="line">| 2019-07-20 | 2            |</span><br><span class="line">| 2019-07-21 | 2            |</span><br><span class="line">+------------+--------------+ </span><br><span class="line">éæ´»è·ƒç”¨æˆ·çš„è®°å½•ä¸éœ€è¦å±•ç¤ºã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> activity_date <span class="keyword">day</span>,<span class="built_in">count</span>(<span class="keyword">distinct</span> user_id) active_users</span><br><span class="line"><span class="keyword">from</span> Activity</span><br><span class="line"><span class="keyword">where</span> activity_date <span class="operator">&gt;</span> date_add(<span class="string">&#x27;2019-07-27&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">-1</span> <span class="keyword">MONTH</span>)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> activity_date</span><br></pre></td></tr></table></figure><h4 id="1142-è¿‡å»30å¤©çš„ç”¨æˆ·æ´»åŠ¨-II"><a href="#1142-è¿‡å»30å¤©çš„ç”¨æˆ·æ´»åŠ¨-II" class="headerlink" title="1142. è¿‡å»30å¤©çš„ç”¨æˆ·æ´»åŠ¨ II"></a><a href="https://leetcode-cn.com/problems/user-activity-for-the-past-30-days-ii/">1142. è¿‡å»30å¤©çš„ç”¨æˆ·æ´»åŠ¨ II</a></h4><p>éš¾åº¦ç®€å•7æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡å…³æ³¨åé¦ˆ</p><p>SQLæ¶æ„</p><p>Table: <code>Activity</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| session_id    | int     |</span><br><span class="line">| activity_date | date    |</span><br><span class="line">| activity_type | enum    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">è¯¥è¡¨æ²¡æœ‰ä¸»é”®ï¼Œå®ƒå¯èƒ½æœ‰é‡å¤çš„è¡Œã€‚</span><br><span class="line">activity_typeåˆ—æ˜¯ä¸€ç§ç±»å‹çš„ENUMï¼ˆâ€œ open_sessionâ€ï¼Œâ€œ end_sessionâ€ï¼Œâ€œ scroll_downâ€ï¼Œâ€œ send_messageâ€ï¼‰ã€‚</span><br><span class="line">è¯¥è¡¨æ˜¾ç¤ºäº†ç¤¾äº¤åª’ä½“ç½‘ç«™çš„ç”¨æˆ·æ´»åŠ¨ã€‚</span><br><span class="line">è¯·æ³¨æ„ï¼Œæ¯ä¸ªä¼šè¯å®Œå…¨å±äºä¸€ä¸ªç”¨æˆ·ã€‚</span><br></pre></td></tr></table></figure><p>ç¼–å†™SQLæŸ¥è¯¢ä»¥æŸ¥æ‰¾æˆªè‡³2019å¹´7æœˆ27æ—¥ï¼ˆå«ï¼‰çš„30å¤©å†…æ¯ä¸ªç”¨æˆ·çš„å¹³å‡ä¼šè¯æ•°ï¼Œå››èˆäº”å…¥åˆ°å°æ•°ç‚¹åä¸¤ä½ã€‚æˆ‘ä»¬åªç»Ÿè®¡é‚£äº›ä¼šè¯æœŸé—´ç”¨æˆ·è‡³å°‘è¿›è¡Œä¸€é¡¹æ´»åŠ¨çš„æœ‰æ•ˆä¼šè¯ã€‚ </p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Activity table:</span><br><span class="line">+---------+------------+---------------+---------------+</span><br><span class="line">| user_id | session_id | activity_date | activity_type |</span><br><span class="line">+---------+------------+---------------+---------------+</span><br><span class="line">| 1       | 1          | 2019-07-20    | open_session  |</span><br><span class="line">| 1       | 1          | 2019-07-20    | scroll_down   |</span><br><span class="line">| 1       | 1          | 2019-07-20    | end_session   |</span><br><span class="line">| 2       | 4          | 2019-07-20    | open_session  |</span><br><span class="line">| 2       | 4          | 2019-07-21    | send_message  |</span><br><span class="line">| 2       | 4          | 2019-07-21    | end_session   |</span><br><span class="line">| 3       | 2          | 2019-07-21    | open_session  |</span><br><span class="line">| 3       | 2          | 2019-07-21    | send_message  |</span><br><span class="line">| 3       | 2          | 2019-07-21    | end_session   |</span><br><span class="line">| 3       | 5          | 2019-07-21    | open_session  |</span><br><span class="line">| 3       | 5          | 2019-07-21    | scroll_down   |</span><br><span class="line">| 3       | 5          | 2019-07-21    | end_session   |</span><br><span class="line">| 4       | 3          | 2019-06-25    | open_session  |</span><br><span class="line">| 4       | 3          | 2019-06-25    | end_session   |</span><br><span class="line">+---------+------------+---------------+---------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+---------------------------+ </span><br><span class="line">| average_sessions_per_user |</span><br><span class="line">+---------------------------+ </span><br><span class="line">| 1.33                      |</span><br><span class="line">+---------------------------+ </span><br><span class="line">User 1 å’Œ 2 åœ¨è¿‡å»30å¤©å†…å„è‡ªè¿›è¡Œäº†1æ¬¡ä¼šè¯ï¼Œè€Œç”¨æˆ·3è¿›è¡Œäº†2æ¬¡ä¼šè¯ï¼Œå› æ­¤å¹³å‡å€¼ä¸ºï¼ˆ1 +1 + 2ï¼‰/ 3 = 1.33ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> IFNULL(ROUND(<span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> session_id) <span class="operator">/</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> user_id), <span class="number">2</span>), <span class="number">0</span>) <span class="keyword">AS</span> average_sessions_per_user</span><br><span class="line"><span class="keyword">from</span> Activity</span><br><span class="line"><span class="keyword">where</span> activity_date <span class="operator">&gt;</span> date_add(<span class="string">&#x27;2019-07-27&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">-1</span> <span class="keyword">MONTH</span>)</span><br></pre></td></tr></table></figure><blockquote><p>1ä¸ªsession id ä»£è¡¨ä¸€æ¬¡ä¼šè¯</p></blockquote><h4 id="1148-æ–‡ç« æµè§ˆ-I"><a href="#1148-æ–‡ç« æµè§ˆ-I" class="headerlink" title="1148. æ–‡ç« æµè§ˆ I"></a><a href="https://leetcode-cn.com/problems/article-views-i/">1148. æ–‡ç« æµè§ˆ I</a></h4><p>éš¾åº¦ç®€å•3æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡å…³æ³¨åé¦ˆ</p><p>SQLæ¶æ„</p><p><code>Views</code> è¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| article_id    | int     |</span><br><span class="line">| author_id     | int     |</span><br><span class="line">| viewer_id     | int     |</span><br><span class="line">| view_date     | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">æ­¤è¡¨æ— ä¸»é”®ï¼Œå› æ­¤å¯èƒ½ä¼šå­˜åœ¨é‡å¤è¡Œã€‚</span><br><span class="line">æ­¤è¡¨çš„æ¯ä¸€è¡Œéƒ½è¡¨ç¤ºæŸäººåœ¨æŸå¤©æµè§ˆäº†æŸä½ä½œè€…çš„æŸç¯‡æ–‡ç« ã€‚</span><br><span class="line">è¯·æ³¨æ„ï¼ŒåŒä¸€äººçš„ author_id å’Œ viewer_id æ˜¯ç›¸åŒçš„ã€‚</span><br></pre></td></tr></table></figure><p>è¯·ç¼–å†™ä¸€æ¡ SQL æŸ¥è¯¢ä»¥æ‰¾å‡ºæ‰€æœ‰æµè§ˆè¿‡è‡ªå·±æ–‡ç« çš„ä½œè€…ï¼Œç»“æœæŒ‰ç…§ id å‡åºæ’åˆ—ã€‚</p><p>æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Views è¡¨ï¼š</span><br><span class="line">+------------+-----------+-----------+------------+</span><br><span class="line">| article_id | author_id | viewer_id | view_date  |</span><br><span class="line">+------------+-----------+-----------+------------+</span><br><span class="line">| 1          | 3         | 5         | 2019-08-01 |</span><br><span class="line">| 1          | 3         | 6         | 2019-08-02 |</span><br><span class="line">| 2          | 7         | 7         | 2019-08-01 |</span><br><span class="line">| 2          | 7         | 6         | 2019-08-02 |</span><br><span class="line">| 4          | 7         | 1         | 2019-07-22 |</span><br><span class="line">| 3          | 4         | 4         | 2019-07-21 |</span><br><span class="line">| 3          | 4         | 4         | 2019-07-21 |</span><br><span class="line">+------------+-----------+-----------+------------+</span><br><span class="line"></span><br><span class="line">ç»“æœè¡¨ï¼š</span><br><span class="line">+------+</span><br><span class="line">| id   |</span><br><span class="line">+------+</span><br><span class="line">| 4    |</span><br><span class="line">| 7    |</span><br><span class="line">+------+</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> author_id id</span><br><span class="line"><span class="keyword">from</span> Views</span><br><span class="line"><span class="keyword">where</span> author_id<span class="operator">=</span>  viewer_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> id</span><br></pre></td></tr></table></figure><h4 id="1149-æ–‡ç« æµè§ˆ-II"><a href="#1149-æ–‡ç« æµè§ˆ-II" class="headerlink" title="1149. æ–‡ç« æµè§ˆ II"></a><a href="https://leetcode-cn.com/problems/article-views-ii/">1149. æ–‡ç« æµè§ˆ II</a></h4><p>éš¾åº¦ä¸­ç­‰4æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡å…³æ³¨åé¦ˆ</p><p>SQLæ¶æ„</p><p>Table: <code>Views</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| article_id    | int     |</span><br><span class="line">| author_id     | int     |</span><br><span class="line">| viewer_id     | int     |</span><br><span class="line">| view_date     | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">æ­¤è¡¨æ— ä¸»é”®ï¼Œå› æ­¤å¯èƒ½ä¼šå­˜åœ¨é‡å¤è¡Œã€‚æ­¤è¡¨çš„æ¯ä¸€è¡Œéƒ½è¡¨ç¤ºæŸäººåœ¨æŸå¤©æµè§ˆäº†æŸä½ä½œè€…çš„æŸç¯‡æ–‡ç« ã€‚ è¯·æ³¨æ„ï¼ŒåŒä¸€äººçš„ author_id å’Œ viewer_id æ˜¯ç›¸åŒçš„ã€‚</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€æ¡ SQL æŸ¥è¯¢æ¥æ‰¾å‡ºåœ¨åŒä¸€å¤©é˜…è¯»è‡³å°‘ä¸¤ç¯‡æ–‡ç« çš„äººï¼Œç»“æœæŒ‰ç…§ id å‡åºæ’åºã€‚</p><p>æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Views table:</span><br><span class="line">+------------+-----------+-----------+------------+</span><br><span class="line">| article_id | author_id | viewer_id | view_date  |</span><br><span class="line">+------------+-----------+-----------+------------+</span><br><span class="line">| 1          | 3         | 5         | 2019-08-01 |</span><br><span class="line">| 3          | 4         | 5         | 2019-08-01 |</span><br><span class="line">| 1          | 3         | 6         | 2019-08-02 |</span><br><span class="line">| 2          | 7         | 7         | 2019-08-01 |</span><br><span class="line">| 2          | 7         | 6         | 2019-08-02 |</span><br><span class="line">| 4          | 7         | 1         | 2019-07-22 |</span><br><span class="line">| 3          | 4         | 4         | 2019-07-21 |</span><br><span class="line">| 3          | 4         | 4         | 2019-07-21 |</span><br><span class="line">+------------+-----------+-----------+------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------+</span><br><span class="line">| id   |</span><br><span class="line">+------+</span><br><span class="line">| 5    |</span><br><span class="line">| 6    |</span><br><span class="line">+------+</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> viewer_id <span class="keyword">AS</span> id</span><br><span class="line"><span class="keyword">FROM</span> Views</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> view_date, viewer_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> article_id) <span class="operator">&gt;=</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> viewer_id</span><br></pre></td></tr></table></figure><h4 id="1158-å¸‚åœºåˆ†æ-I"><a href="#1158-å¸‚åœºåˆ†æ-I" class="headerlink" title="1158. å¸‚åœºåˆ†æ I"></a><a href="https://leetcode-cn.com/problems/market-analysis-i/">1158. å¸‚åœºåˆ†æ I</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>Table: <code>Users</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| user_id        | int     |</span><br><span class="line">| join_date      | date    |</span><br><span class="line">| favorite_brand | varchar |</span><br><span class="line">+----------------+---------+</span><br><span class="line">æ­¤è¡¨ä¸»é”®æ˜¯ user_idï¼Œè¡¨ä¸­æè¿°äº†è´­ç‰©ç½‘ç«™çš„ç”¨æˆ·ä¿¡æ¯ï¼Œç”¨æˆ·å¯ä»¥åœ¨æ­¤ç½‘ç«™ä¸Šè¿›è¡Œå•†å“ä¹°å–ã€‚</span><br></pre></td></tr></table></figure><p>Table: <code>Orders</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| order_id      | int     |</span><br><span class="line">| order_date    | date    |</span><br><span class="line">| item_id       | int     |</span><br><span class="line">| buyer_id      | int     |</span><br><span class="line">| seller_id     | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">æ­¤è¡¨ä¸»é”®æ˜¯ order_idï¼Œå¤–é”®æ˜¯ item_id å’Œï¼ˆbuyer_idï¼Œseller_idï¼‰ã€‚</span><br></pre></td></tr></table></figure><p>Table: <code>Item</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| item_id       | int     |</span><br><span class="line">| item_brand    | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">æ­¤è¡¨ä¸»é”®æ˜¯ item_idã€‚</span><br></pre></td></tr></table></figure><p>è¯·å†™å‡ºä¸€æ¡SQLè¯­å¥ä»¥æŸ¥è¯¢æ¯ä¸ªç”¨æˆ·çš„æ³¨å†Œæ—¥æœŸå’Œåœ¨ <strong>2019</strong> å¹´ä½œä¸ºä¹°å®¶çš„è®¢å•æ€»æ•°ã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">Users table:</span><br><span class="line">+---------+------------+----------------+</span><br><span class="line">| user_id | join_date  | favorite_brand |</span><br><span class="line">+---------+------------+----------------+</span><br><span class="line">| 1       | 2018-01-01 | Lenovo         |</span><br><span class="line">| 2       | 2018-02-09 | Samsung        |</span><br><span class="line">| 3       | 2018-01-19 | LG             |</span><br><span class="line">| 4       | 2018-05-21 | HP             |</span><br><span class="line">+---------+------------+----------------+</span><br><span class="line"></span><br><span class="line">Orders table:</span><br><span class="line">+----------+------------+---------+----------+-----------+</span><br><span class="line">| order_id | order_date | item_id | buyer_id | seller_id |</span><br><span class="line">+----------+------------+---------+----------+-----------+</span><br><span class="line">| 1        | 2019-08-01 | 4       | 1        | 2         |</span><br><span class="line">| 2        | 2018-08-02 | 2       | 1        | 3         |</span><br><span class="line">| 3        | 2019-08-03 | 3       | 2        | 3         |</span><br><span class="line">| 4        | 2018-08-04 | 1       | 4        | 2         |</span><br><span class="line">| 5        | 2018-08-04 | 1       | 3        | 4         |</span><br><span class="line">| 6        | 2019-08-05 | 2       | 2        | 4         |</span><br><span class="line">+----------+------------+---------+----------+-----------+</span><br><span class="line"></span><br><span class="line">Items table:</span><br><span class="line">+---------+------------+</span><br><span class="line">| item_id | item_brand |</span><br><span class="line">+---------+------------+</span><br><span class="line">| 1       | Samsung    |</span><br><span class="line">| 2       | Lenovo     |</span><br><span class="line">| 3       | LG         |</span><br><span class="line">| 4       | HP         |</span><br><span class="line">+---------+------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-----------+------------+----------------+</span><br><span class="line">| buyer_id  | join_date  | orders_in_2019 |</span><br><span class="line">+-----------+------------+----------------+</span><br><span class="line">| 1         | 2018-01-01 | 1              |</span><br><span class="line">| 2         | 2018-02-09 | 2              |</span><br><span class="line">| 3         | 2018-01-19 | 0              |</span><br><span class="line">| 4         | 2018-05-21 | 0              |</span><br><span class="line">+-----------+------------+----------------+</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> user_id buyer_id,join_date, ifnull(cnt,<span class="number">0</span>)orders_in_2019</span><br><span class="line"><span class="keyword">from</span> Users u <span class="keyword">left</span> <span class="keyword">join</span> </span><br><span class="line">(<span class="keyword">select</span> buyer_id,<span class="built_in">count</span>(<span class="operator">*</span>) cnt</span><br><span class="line"><span class="keyword">from</span> Orders</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">year</span>(order_date) <span class="operator">=</span> <span class="number">2019</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span>  buyer_id</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">on</span> u.user_id <span class="operator">=</span>t1.buyer_id</span><br></pre></td></tr></table></figure><h4 id="1159-å¸‚åœºåˆ†æ-II"><a href="#1159-å¸‚åœºåˆ†æ-II" class="headerlink" title="1159. å¸‚åœºåˆ†æ II"></a><a href="https://leetcode-cn.com/problems/market-analysis-ii/">1159. å¸‚åœºåˆ†æ II</a></h4><p>éš¾åº¦å›°éš¾</p><p>SQLæ¶æ„</p><p>è¡¨: <code>Users</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| user_id        | int     |</span><br><span class="line">| join_date      | date    |</span><br><span class="line">| favorite_brand | varchar |</span><br><span class="line">+----------------+---------+</span><br><span class="line">user_id æ˜¯è¯¥è¡¨çš„ä¸»é”®</span><br><span class="line">è¡¨ä¸­åŒ…å«ä¸€ä½åœ¨çº¿è´­ç‰©ç½‘ç«™ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ï¼Œç”¨æˆ·å¯ä»¥åœ¨è¯¥ç½‘ç«™å‡ºå”®å’Œè´­ä¹°å•†å“ã€‚</span><br></pre></td></tr></table></figure><p>è¡¨: <code>Orders</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| order_id      | int     |</span><br><span class="line">| order_date    | date    |</span><br><span class="line">| item_id       | int     |</span><br><span class="line">| buyer_id      | int     |</span><br><span class="line">| seller_id     | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">order_id æ˜¯è¯¥è¡¨çš„ä¸»é”®</span><br><span class="line">item_id æ˜¯ Items è¡¨çš„å¤–é”®</span><br><span class="line">buyer_id å’Œ seller_id æ˜¯ Users è¡¨çš„å¤–é”®</span><br></pre></td></tr></table></figure><p>è¡¨: <code>Items</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| item_id       | int     |</span><br><span class="line">| item_brand    | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">item_id æ˜¯è¯¥è¡¨çš„ä¸»é”®</span><br></pre></td></tr></table></figure><p>å†™ä¸€ä¸ª SQL æŸ¥è¯¢ç¡®å®šæ¯ä¸€ä¸ªç”¨æˆ·æŒ‰æ—¥æœŸé¡ºåºå–å‡ºçš„ç¬¬äºŒä»¶å•†å“çš„å“ç‰Œæ˜¯å¦æ˜¯ä»–ä»¬æœ€å–œçˆ±çš„å“ç‰Œã€‚å¦‚æœä¸€ä¸ªç”¨æˆ·å–å‡ºå°‘äºä¸¤ä»¶å•†å“ï¼ŒæŸ¥è¯¢çš„ç»“æœæ˜¯ <code>no</code> ã€‚</p><p>é¢˜ç›®ä¿è¯æ²¡æœ‰ä¸€ä¸ªç”¨æˆ·åœ¨ä¸€å¤©ä¸­å–å‡ºè¶…è¿‡ä¸€ä»¶å•†å“</p><p>ä¸‹é¢æ˜¯æŸ¥è¯¢ç»“æœæ ¼å¼çš„ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">Users table:</span><br><span class="line">+---------+------------+----------------+</span><br><span class="line">| user_id | join_date  | favorite_brand |</span><br><span class="line">+---------+------------+----------------+</span><br><span class="line">| 1       | 2019-01-01 | Lenovo         |</span><br><span class="line">| 2       | 2019-02-09 | Samsung        |</span><br><span class="line">| 3       | 2019-01-19 | LG             |</span><br><span class="line">| 4       | 2019-05-21 | HP             |</span><br><span class="line">+---------+------------+----------------+</span><br><span class="line"></span><br><span class="line">Orders table:</span><br><span class="line">+----------+------------+---------+----------+-----------+</span><br><span class="line">| order_id | order_date | item_id | buyer_id | seller_id |</span><br><span class="line">+----------+------------+---------+----------+-----------+</span><br><span class="line">| 1        | 2019-08-01 | 4       | 1        | 2         |</span><br><span class="line">| 2        | 2019-08-02 | 2       | 1        | 3         |</span><br><span class="line">| 3        | 2019-08-03 | 3       | 2        | 3         |</span><br><span class="line">| 4        | 2019-08-04 | 1       | 4        | 2         |</span><br><span class="line">| 5        | 2019-08-04 | 1       | 3        | 4         |</span><br><span class="line">| 6        | 2019-08-05 | 2       | 2        | 4         |</span><br><span class="line">+----------+------------+---------+----------+-----------+</span><br><span class="line"></span><br><span class="line">Items table:</span><br><span class="line">+---------+------------+</span><br><span class="line">| item_id | item_brand |</span><br><span class="line">+---------+------------+</span><br><span class="line">| 1       | Samsung    |</span><br><span class="line">| 2       | Lenovo     |</span><br><span class="line">| 3       | LG         |</span><br><span class="line">| 4       | HP         |</span><br><span class="line">+---------+------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-----------+--------------------+</span><br><span class="line">| seller_id | 2nd_item_fav_brand |</span><br><span class="line">+-----------+--------------------+</span><br><span class="line">| 1         | no                 |</span><br><span class="line">| 2         | yes                |</span><br><span class="line">| 3         | yes                |</span><br><span class="line">| 4         | no                 |</span><br><span class="line">+-----------+--------------------+</span><br><span class="line"></span><br><span class="line">id ä¸º 1 çš„ç”¨æˆ·çš„æŸ¥è¯¢ç»“æœæ˜¯ noï¼Œå› ä¸ºä»–ä»€ä¹ˆä¹Ÿæ²¡æœ‰å–å‡º</span><br><span class="line">idä¸º 2 å’Œ 3 çš„ç”¨æˆ·çš„æŸ¥è¯¢ç»“æœæ˜¯ yesï¼Œå› ä¸ºä»–ä»¬å–å‡ºçš„ç¬¬äºŒä»¶å•†å“çš„å“ç‰Œæ˜¯ä»–ä»¬è‡ªå·±æœ€å–œçˆ±çš„å“ç‰Œ</span><br><span class="line">idä¸º 4 çš„ç”¨æˆ·çš„æŸ¥è¯¢ç»“æœæ˜¯ noï¼Œå› ä¸ºä»–å–å‡ºçš„ç¬¬äºŒä»¶å•†å“çš„å“ç‰Œä¸æ˜¯ä»–æœ€å–œçˆ±çš„å“ç‰Œ</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> user_id seller_id, if(item_brand<span class="operator">=</span>favorite_brand,<span class="string">&#x27;yes&#x27;</span>,<span class="string">&#x27;no&#x27;</span>) <span class="number">2</span>nd_item_fav_brand </span><br><span class="line"><span class="keyword">from</span> Users u</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> i.item_id,seller_id,item_brand</span><br><span class="line">    <span class="keyword">from</span> Items i</span><br><span class="line">    <span class="keyword">join</span> </span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> seller_id,item_id,<span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> seller_id  <span class="keyword">order</span> <span class="keyword">by</span> order_date ) rk</span><br><span class="line">        <span class="keyword">from</span> Orders </span><br><span class="line">    )t1 </span><br><span class="line">    <span class="keyword">on</span> i.item_id <span class="operator">=</span> t1.item_id </span><br><span class="line">    <span class="keyword">where</span> rk  <span class="operator">=</span><span class="number">2</span></span><br><span class="line">)t2</span><br><span class="line"><span class="keyword">on</span> u.user_id <span class="operator">=</span> t2.seller_id</span><br></pre></td></tr></table></figure><h4 id="1164-æŒ‡å®šæ—¥æœŸçš„äº§å“ä»·æ ¼"><a href="#1164-æŒ‡å®šæ—¥æœŸçš„äº§å“ä»·æ ¼" class="headerlink" title="1164. æŒ‡å®šæ—¥æœŸçš„äº§å“ä»·æ ¼"></a><a href="https://leetcode-cn.com/problems/product-price-at-a-given-date/">1164. æŒ‡å®šæ—¥æœŸçš„äº§å“ä»·æ ¼</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>äº§å“æ•°æ®è¡¨: <code>Products</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| new_price     | int     |</span><br><span class="line">| change_date   | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">è¿™å¼ è¡¨çš„ä¸»é”®æ˜¯ (product_id, change_date)ã€‚</span><br><span class="line">è¿™å¼ è¡¨çš„æ¯ä¸€è¡Œåˆ†åˆ«è®°å½•äº† æŸäº§å“ åœ¨æŸä¸ªæ—¥æœŸ æ›´æ”¹å çš„æ–°ä»·æ ¼ã€‚</span><br></pre></td></tr></table></figure><p>å†™ä¸€æ®µ SQLæ¥æŸ¥æ‰¾åœ¨ <strong>2019-08-16</strong> æ—¶å…¨éƒ¨äº§å“çš„ä»·æ ¼ï¼Œå‡è®¾æ‰€æœ‰äº§å“åœ¨ä¿®æ”¹å‰çš„ä»·æ ¼éƒ½æ˜¯ <strong>10ã€‚</strong></p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Products table:</span><br><span class="line">+------------+-----------+-------------+</span><br><span class="line">| product_id | new_price | change_date |</span><br><span class="line">+------------+-----------+-------------+</span><br><span class="line">| 1          | 20        | 2019-08-14  |</span><br><span class="line">| 2          | 50        | 2019-08-14  |</span><br><span class="line">| 1          | 30        | 2019-08-15  |</span><br><span class="line">| 1          | 35        | 2019-08-16  |</span><br><span class="line">| 2          | 65        | 2019-08-17  |</span><br><span class="line">| 3          | 20        | 2019-08-18  |</span><br><span class="line">+------------+-----------+-------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+-------+</span><br><span class="line">| product_id | price |</span><br><span class="line">+------------+-------+</span><br><span class="line">| 2          | 50    |</span><br><span class="line">| 1          | 35    |</span><br><span class="line">| 3          | 10    |</span><br><span class="line">+------------+-------+</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> p.product_id,ifnull(t1.new_price,<span class="number">10</span>) price</span><br><span class="line"><span class="keyword">from</span> Products p</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> product_id,new_price</span><br><span class="line">    <span class="keyword">from</span> (</span><br><span class="line">        <span class="keyword">select</span> product_id,new_price,change_date,<span class="built_in">Max</span>(change_date) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> product_id  ) md</span><br><span class="line">        <span class="keyword">from</span>  Products</span><br><span class="line">        <span class="keyword">where</span> change_date<span class="operator">&lt;=</span><span class="string">&#x27;2019-08-16&#x27;</span></span><br><span class="line">    )tmp</span><br><span class="line">    <span class="keyword">where</span> change_date <span class="operator">=</span> md</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">on</span> p. product_id <span class="operator">=</span> t1.product_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> price <span class="keyword">desc</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1173-å³æ—¶é£Ÿç‰©é…é€-I"><a href="#1173-å³æ—¶é£Ÿç‰©é…é€-I" class="headerlink" title="1173. å³æ—¶é£Ÿç‰©é…é€ I"></a><a href="https://leetcode-cn.com/problems/immediate-food-delivery-i/">1173. å³æ—¶é£Ÿç‰©é…é€ I</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>é…é€è¡¨: <code>Delivery</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+-----------------------------+---------+</span><br><span class="line">| Column Name                 | Type    |</span><br><span class="line">+-----------------------------+---------+</span><br><span class="line">| delivery_id                 | int     |</span><br><span class="line">| customer_id                 | int     |</span><br><span class="line">| order_date                  | date    |</span><br><span class="line">| customer_pref_delivery_date | date    |</span><br><span class="line">+-----------------------------+---------+</span><br><span class="line">delivery_id æ˜¯è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¯¥è¡¨ä¿å­˜ç€é¡¾å®¢çš„é£Ÿç‰©é…é€ä¿¡æ¯ï¼Œé¡¾å®¢åœ¨æŸä¸ªæ—¥æœŸä¸‹äº†è®¢å•ï¼Œå¹¶æŒ‡å®šäº†ä¸€ä¸ªæœŸæœ›çš„é…é€æ—¥æœŸï¼ˆå’Œä¸‹å•æ—¥æœŸç›¸åŒæˆ–è€…åœ¨é‚£ä¹‹åï¼‰ã€‚</span><br></pre></td></tr></table></figure><p>å¦‚æœé¡¾å®¢æœŸæœ›çš„é…é€æ—¥æœŸå’Œä¸‹å•æ—¥æœŸç›¸åŒï¼Œåˆ™è¯¥è®¢å•ç§°ä¸º ã€Œå³æ—¶è®¢å•ã€ï¼Œå¦åˆ™ç§°ä¸ºã€Œè®¡åˆ’è®¢å•ã€ã€‚</p><p>å†™ä¸€æ¡ SQL æŸ¥è¯¢è¯­å¥è·å–å³æ—¶è®¢å•æ‰€å çš„ç™¾åˆ†æ¯”ï¼Œ <strong>ä¿ç•™ä¸¤ä½å°æ•°ã€‚</strong></p><p>æŸ¥è¯¢ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Delivery è¡¨:</span><br><span class="line">+-------------+-------------+------------+-----------------------------+</span><br><span class="line">| delivery_id | customer_id | order_date | customer_pref_delivery_date |</span><br><span class="line">+-------------+-------------+------------+-----------------------------+</span><br><span class="line">| 1           | 1           | 2019-08-01 | 2019-08-02                  |</span><br><span class="line">| 2           | 5           | 2019-08-02 | 2019-08-02                  |</span><br><span class="line">| 3           | 1           | 2019-08-11 | 2019-08-11                  |</span><br><span class="line">| 4           | 3           | 2019-08-24 | 2019-08-26                  |</span><br><span class="line">| 5           | 4           | 2019-08-21 | 2019-08-22                  |</span><br><span class="line">| 6           | 2           | 2019-08-11 | 2019-08-13                  |</span><br><span class="line">+-------------+-------------+------------+-----------------------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+----------------------+</span><br><span class="line">| immediate_percentage |</span><br><span class="line">+----------------------+</span><br><span class="line">| 33.33                |</span><br><span class="line">+----------------------+</span><br><span class="line">2 å’Œ 3 å·è®¢å•ä¸ºå³æ—¶è®¢å•ï¼Œå…¶ä»–çš„ä¸ºè®¡åˆ’è®¢å•ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> round(<span class="built_in">sum</span>(if(order_date<span class="operator">=</span>customer_pref_delivery_date,<span class="number">1</span>,<span class="number">0</span>))<span class="operator">/</span><span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">*</span><span class="number">100</span>,<span class="number">2</span>) immediate_percentage</span><br><span class="line"><span class="keyword">from</span> Delivery</span><br></pre></td></tr></table></figure><h4 id="1174-å³æ—¶é£Ÿç‰©é…é€-II"><a href="#1174-å³æ—¶é£Ÿç‰©é…é€-II" class="headerlink" title="1174. å³æ—¶é£Ÿç‰©é…é€ II"></a><a href="https://leetcode-cn.com/problems/immediate-food-delivery-ii/">1174. å³æ—¶é£Ÿç‰©é…é€ II</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>é…é€è¡¨: <code>Delivery</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+-----------------------------+---------+</span><br><span class="line">| Column Name                 | Type    |</span><br><span class="line">+-----------------------------+---------+</span><br><span class="line">| delivery_id                 | int     |</span><br><span class="line">| customer_id                 | int     |</span><br><span class="line">| order_date                  | date    |</span><br><span class="line">| customer_pref_delivery_date | date    |</span><br><span class="line">+-----------------------------+---------+</span><br><span class="line">delivery_id æ˜¯è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¯¥è¡¨ä¿å­˜ç€é¡¾å®¢çš„é£Ÿç‰©é…é€ä¿¡æ¯ï¼Œé¡¾å®¢åœ¨æŸä¸ªæ—¥æœŸä¸‹äº†è®¢å•ï¼Œå¹¶æŒ‡å®šäº†ä¸€ä¸ªæœŸæœ›çš„é…é€æ—¥æœŸï¼ˆå’Œä¸‹å•æ—¥æœŸç›¸åŒæˆ–è€…åœ¨é‚£ä¹‹åï¼‰ã€‚</span><br></pre></td></tr></table></figure><p>å¦‚æœé¡¾å®¢æœŸæœ›çš„é…é€æ—¥æœŸå’Œä¸‹å•æ—¥æœŸç›¸åŒï¼Œåˆ™è¯¥è®¢å•ç§°ä¸º ã€Œå³æ—¶è®¢å•ã€ï¼Œå¦åˆ™ç§°ä¸ºã€Œè®¡åˆ’è®¢å•ã€ã€‚</p><p>ã€Œé¦–æ¬¡è®¢å•ã€æ˜¯é¡¾å®¢æœ€æ—©åˆ›å»ºçš„è®¢å•ã€‚æˆ‘ä»¬ä¿è¯ä¸€ä¸ªé¡¾å®¢åªä¼šæœ‰ä¸€ä¸ªã€Œé¦–æ¬¡è®¢å•ã€ã€‚</p><p>å†™ä¸€æ¡ SQL æŸ¥è¯¢è¯­å¥è·å–å³æ—¶è®¢å•åœ¨æ‰€æœ‰ç”¨æˆ·çš„é¦–æ¬¡è®¢å•ä¸­çš„æ¯”ä¾‹ã€‚<strong>ä¿ç•™ä¸¤ä½å°æ•°ã€‚</strong></p><p>æŸ¥è¯¢ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Delivery è¡¨ï¼š</span><br><span class="line">+-------------+-------------+------------+-----------------------------+</span><br><span class="line">| delivery_id | customer_id | order_date | customer_pref_delivery_date |</span><br><span class="line">+-------------+-------------+------------+-----------------------------+</span><br><span class="line">| 1           | 1           | 2019-08-01 | 2019-08-02                  |</span><br><span class="line">| 2           | 2           | 2019-08-02 | 2019-08-02                  |</span><br><span class="line">| 3           | 1           | 2019-08-11 | 2019-08-12                  |</span><br><span class="line">| 4           | 3           | 2019-08-24 | 2019-08-24                  |</span><br><span class="line">| 5           | 3           | 2019-08-21 | 2019-08-22                  |</span><br><span class="line">| 6           | 2           | 2019-08-11 | 2019-08-13                  |</span><br><span class="line">| 7           | 4           | 2019-08-09 | 2019-08-09                  |</span><br><span class="line">+-------------+-------------+------------+-----------------------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+----------------------+</span><br><span class="line">| immediate_percentage |</span><br><span class="line">+----------------------+</span><br><span class="line">| 50.00                |</span><br><span class="line">+----------------------+</span><br><span class="line">1 å·é¡¾å®¢çš„ 1 å·è®¢å•æ˜¯é¦–æ¬¡è®¢å•ï¼Œå¹¶ä¸”æ˜¯è®¡åˆ’è®¢å•ã€‚</span><br><span class="line">2 å·é¡¾å®¢çš„ 2 å·è®¢å•æ˜¯é¦–æ¬¡è®¢å•ï¼Œå¹¶ä¸”æ˜¯å³æ—¶è®¢å•ã€‚</span><br><span class="line">3 å·é¡¾å®¢çš„ 5 å·è®¢å•æ˜¯é¦–æ¬¡è®¢å•ï¼Œå¹¶ä¸”æ˜¯è®¡åˆ’è®¢å•ã€‚</span><br><span class="line">4 å·é¡¾å®¢çš„ 7 å·è®¢å•æ˜¯é¦–æ¬¡è®¢å•ï¼Œå¹¶ä¸”æ˜¯å³æ—¶è®¢å•ã€‚</span><br><span class="line">å› æ­¤ï¼Œä¸€åŠé¡¾å®¢çš„é¦–æ¬¡è®¢å•æ˜¯å³æ—¶çš„ã€‚</span><br></pre></td></tr></table></figure><p>å¼€çª—</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> round(<span class="built_in">sum</span>(if(order_date <span class="operator">=</span> fo <span class="operator">&amp;&amp;</span> fo<span class="operator">=</span>d,<span class="number">1</span>,<span class="number">0</span>))<span class="operator">/</span><span class="built_in">count</span>(<span class="keyword">distinct</span> customer_id)<span class="operator">*</span><span class="number">100</span>,<span class="number">2</span>) immediate_percentage </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> customer_id,order_date,<span class="built_in">min</span>(order_date)<span class="keyword">over</span> ( <span class="keyword">partition</span> <span class="keyword">by</span> customer_id) fo,</span><br><span class="line">    if(order_date<span class="operator">=</span>customer_pref_delivery_date,order_date ,<span class="keyword">null</span>) d</span><br><span class="line"><span class="keyword">from</span> Delivery</span><br><span class="line">)t1</span><br></pre></td></tr></table></figure><p>å¦ä¸€ç§æ€è·¯</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> round (</span><br><span class="line">    <span class="built_in">sum</span>(order_date <span class="operator">=</span> customer_pref_delivery_date) <span class="operator">*</span> <span class="number">100</span> <span class="operator">/</span></span><br><span class="line">    <span class="built_in">count</span>(<span class="operator">*</span>),</span><br><span class="line">    <span class="number">2</span></span><br><span class="line">) <span class="keyword">as</span> immediate_percentage</span><br><span class="line"><span class="keyword">from</span> Delivery</span><br><span class="line"><span class="keyword">where</span> (customer_id, order_date) <span class="keyword">in</span> (</span><br><span class="line">    <span class="keyword">select</span> customer_id, <span class="built_in">min</span>(order_date)</span><br><span class="line">    <span class="keyword">from</span> delivery</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> customer_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="1179-é‡æ–°æ ¼å¼åŒ–éƒ¨é—¨è¡¨"><a href="#1179-é‡æ–°æ ¼å¼åŒ–éƒ¨é—¨è¡¨" class="headerlink" title="1179. é‡æ–°æ ¼å¼åŒ–éƒ¨é—¨è¡¨"></a><a href="https://leetcode-cn.com/problems/reformat-department-table/">1179. é‡æ–°æ ¼å¼åŒ–éƒ¨é—¨è¡¨</a></h4><p>éš¾åº¦</p><p>SQLæ¶æ„</p><p>éƒ¨é—¨è¡¨ <code>Department</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| revenue       | int     |</span><br><span class="line">| month         | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(id, month) æ˜¯è¡¨çš„è”åˆä¸»é”®ã€‚</span><br><span class="line">è¿™ä¸ªè¡¨æ ¼æœ‰å…³äºæ¯ä¸ªéƒ¨é—¨æ¯æœˆæ”¶å…¥çš„ä¿¡æ¯ã€‚</span><br><span class="line">æœˆä»½ï¼ˆmonthï¼‰å¯ä»¥å–ä¸‹åˆ—å€¼ [&quot;Jan&quot;,&quot;Feb&quot;,&quot;Mar&quot;,&quot;Apr&quot;,&quot;May&quot;,&quot;Jun&quot;,&quot;Jul&quot;,&quot;Aug&quot;,&quot;Sep&quot;,&quot;Oct&quot;,&quot;Nov&quot;,&quot;Dec&quot;]ã€‚</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢æ¥é‡æ–°æ ¼å¼åŒ–è¡¨ï¼Œä½¿å¾—æ–°çš„è¡¨ä¸­æœ‰ä¸€ä¸ªéƒ¨é—¨ id åˆ—å’Œä¸€äº›å¯¹åº” <strong>æ¯ä¸ªæœˆ</strong> çš„æ”¶å…¥ï¼ˆrevenueï¼‰åˆ—ã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Department è¡¨ï¼š</span><br><span class="line">+------+---------+-------+</span><br><span class="line">| id   | revenue | month |</span><br><span class="line">+------+---------+-------+</span><br><span class="line">| 1    | 8000    | Jan   |</span><br><span class="line">| 2    | 9000    | Jan   |</span><br><span class="line">| 3    | 10000   | Feb   |</span><br><span class="line">| 1    | 7000    | Feb   |</span><br><span class="line">| 1    | 6000    | Mar   |</span><br><span class="line">+------+---------+-------+</span><br><span class="line"></span><br><span class="line">æŸ¥è¯¢å¾—åˆ°çš„ç»“æœè¡¨ï¼š</span><br><span class="line">+------+-------------+-------------+-------------+-----+-------------+</span><br><span class="line">| id   | Jan_Revenue | Feb_Revenue | Mar_Revenue | ... | Dec_Revenue |</span><br><span class="line">+------+-------------+-------------+-------------+-----+-------------+</span><br><span class="line">| 1    | 8000        | 7000        | 6000        | ... | null        |</span><br><span class="line">| 2    | 9000        | null        | null        | ... | null        |</span><br><span class="line">| 3    | null        | 10000       | null        | ... | null        |</span><br><span class="line">+------+-------------+-------------+-------------+-----+-------------+</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼Œç»“æœè¡¨æœ‰ 13 åˆ— (1ä¸ªéƒ¨é—¨ id åˆ— + 12ä¸ªæœˆä»½çš„æ”¶å…¥åˆ—)ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,</span><br><span class="line"><span class="built_in">SUM</span>(<span class="keyword">CASE</span> `<span class="keyword">month</span>` <span class="keyword">WHEN</span> <span class="string">&#x27;Jan&#x27;</span> <span class="keyword">THEN</span> revenue <span class="keyword">END</span>) Jan_Revenue,</span><br><span class="line"><span class="built_in">SUM</span>(<span class="keyword">CASE</span> `<span class="keyword">month</span>` <span class="keyword">WHEN</span> <span class="string">&#x27;Feb&#x27;</span> <span class="keyword">THEN</span> revenue <span class="keyword">END</span>) Feb_Revenue,</span><br><span class="line"><span class="built_in">SUM</span>(<span class="keyword">CASE</span> `<span class="keyword">month</span>` <span class="keyword">WHEN</span> <span class="string">&#x27;Mar&#x27;</span> <span class="keyword">THEN</span> revenue <span class="keyword">END</span>) Mar_Revenue,</span><br><span class="line"><span class="built_in">SUM</span>(<span class="keyword">CASE</span> `<span class="keyword">month</span>` <span class="keyword">WHEN</span> <span class="string">&#x27;Apr&#x27;</span> <span class="keyword">THEN</span> revenue <span class="keyword">END</span>) Apr_Revenue,</span><br><span class="line"><span class="built_in">SUM</span>(<span class="keyword">CASE</span> `<span class="keyword">month</span>` <span class="keyword">WHEN</span> <span class="string">&#x27;May&#x27;</span> <span class="keyword">THEN</span> revenue <span class="keyword">END</span>) May_Revenue,</span><br><span class="line"><span class="built_in">SUM</span>(<span class="keyword">CASE</span> `<span class="keyword">month</span>` <span class="keyword">WHEN</span> <span class="string">&#x27;Jun&#x27;</span> <span class="keyword">THEN</span> revenue <span class="keyword">END</span>) Jun_Revenue,</span><br><span class="line"><span class="built_in">SUM</span>(<span class="keyword">CASE</span> `<span class="keyword">month</span>` <span class="keyword">WHEN</span> <span class="string">&#x27;Jul&#x27;</span> <span class="keyword">THEN</span> revenue <span class="keyword">END</span>) Jul_Revenue,</span><br><span class="line"><span class="built_in">SUM</span>(<span class="keyword">CASE</span> `<span class="keyword">month</span>` <span class="keyword">WHEN</span> <span class="string">&#x27;Aug&#x27;</span> <span class="keyword">THEN</span> revenue <span class="keyword">END</span>) Aug_Revenue,</span><br><span class="line"><span class="built_in">SUM</span>(<span class="keyword">CASE</span> `<span class="keyword">month</span>` <span class="keyword">WHEN</span> <span class="string">&#x27;Sep&#x27;</span> <span class="keyword">THEN</span> revenue <span class="keyword">END</span>) Sep_Revenue,</span><br><span class="line"><span class="built_in">SUM</span>(<span class="keyword">CASE</span> `<span class="keyword">month</span>` <span class="keyword">WHEN</span> <span class="string">&#x27;Oct&#x27;</span> <span class="keyword">THEN</span> revenue <span class="keyword">END</span>) Oct_Revenue,</span><br><span class="line"><span class="built_in">SUM</span>(<span class="keyword">CASE</span> `<span class="keyword">month</span>` <span class="keyword">WHEN</span> <span class="string">&#x27;Nov&#x27;</span> <span class="keyword">THEN</span> revenue <span class="keyword">END</span>) Nov_Revenue,</span><br><span class="line"><span class="built_in">SUM</span>(<span class="keyword">CASE</span> `<span class="keyword">month</span>` <span class="keyword">WHEN</span> <span class="string">&#x27;Dec&#x27;</span> <span class="keyword">THEN</span> revenue <span class="keyword">END</span>) Dec_Revenue</span><br><span class="line"><span class="keyword">FROM</span> Department</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> id;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1193.</span> æ¯æœˆäº¤æ˜“ I</span><br><span class="line"><span class="keyword">SQL</span>æ¶æ„</span><br><span class="line"><span class="keyword">Table</span>: Transactions</span><br><span class="line"></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name   <span class="operator">|</span> Type    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line"><span class="operator">|</span> id            <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> country       <span class="operator">|</span> <span class="type">varchar</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> state         <span class="operator">|</span> enum    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> amount        <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> trans_date    <span class="operator">|</span> <span class="type">date</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line">id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¯¥è¡¨åŒ…å«æœ‰å…³ä¼ å…¥äº‹åŠ¡çš„ä¿¡æ¯ã€‚</span><br><span class="line">state åˆ—ç±»å‹ä¸º â€œ[â€æ‰¹å‡†â€œï¼Œâ€æ‹’ç»â€œ] ä¹‹ä¸€ã€‚</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">ç¼–å†™ä¸€ä¸ª <span class="keyword">sql</span> æŸ¥è¯¢æ¥æŸ¥æ‰¾æ¯ä¸ªæœˆå’Œæ¯ä¸ªå›½å®¶<span class="operator">/</span>åœ°åŒºçš„äº‹åŠ¡æ•°åŠå…¶æ€»é‡‘é¢ã€å·²æ‰¹å‡†çš„äº‹åŠ¡æ•°åŠå…¶æ€»é‡‘é¢ã€‚</span><br><span class="line"></span><br><span class="line">æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</span><br><span class="line"></span><br><span class="line">Transactions <span class="keyword">table</span>:</span><br><span class="line"><span class="operator">+</span><span class="comment">------+---------+----------+--------+------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> country <span class="operator">|</span> state    <span class="operator">|</span> amount <span class="operator">|</span> trans_date <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+---------+----------+--------+------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">121</span>  <span class="operator">|</span> US      <span class="operator">|</span> approved <span class="operator">|</span> <span class="number">1000</span>   <span class="operator">|</span> <span class="number">2018</span><span class="number">-12</span><span class="number">-18</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">122</span>  <span class="operator">|</span> US      <span class="operator">|</span> declined <span class="operator">|</span> <span class="number">2000</span>   <span class="operator">|</span> <span class="number">2018</span><span class="number">-12</span><span class="number">-19</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">123</span>  <span class="operator">|</span> US      <span class="operator">|</span> approved <span class="operator">|</span> <span class="number">2000</span>   <span class="operator">|</span> <span class="number">2019</span><span class="number">-01</span><span class="number">-01</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">124</span>  <span class="operator">|</span> DE      <span class="operator">|</span> approved <span class="operator">|</span> <span class="number">2000</span>   <span class="operator">|</span> <span class="number">2019</span><span class="number">-01</span><span class="number">-07</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+---------+----------+--------+------------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Result</span> <span class="keyword">table</span>:</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+---------+-------------+----------------+--------------------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">month</span>    <span class="operator">|</span> country <span class="operator">|</span> trans_count <span class="operator">|</span> approved_count <span class="operator">|</span> trans_total_amount <span class="operator">|</span> approved_total_amount <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+---------+-------------+----------------+--------------------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2018</span><span class="number">-12</span>  <span class="operator">|</span> US      <span class="operator">|</span> <span class="number">2</span>           <span class="operator">|</span> <span class="number">1</span>              <span class="operator">|</span> <span class="number">3000</span>               <span class="operator">|</span> <span class="number">1000</span>                  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2019</span><span class="number">-01</span>  <span class="operator">|</span> US      <span class="operator">|</span> <span class="number">1</span>           <span class="operator">|</span> <span class="number">1</span>              <span class="operator">|</span> <span class="number">2000</span>               <span class="operator">|</span> <span class="number">2000</span>                  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2019</span><span class="number">-01</span>  <span class="operator">|</span> DE      <span class="operator">|</span> <span class="number">1</span>           <span class="operator">|</span> <span class="number">1</span>              <span class="operator">|</span> <span class="number">2000</span>               <span class="operator">|</span> <span class="number">2000</span>                  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+---------+-------------+----------------+--------------------+-----------------------+</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DATE_FORMAT(trans_date, <span class="string">&#x27;%Y-%m&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">month</span>,</span><br><span class="line">    country,</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> trans_count,</span><br><span class="line">    <span class="built_in">COUNT</span>(IF(state <span class="operator">=</span> <span class="string">&#x27;approved&#x27;</span>, <span class="number">1</span>, <span class="keyword">NULL</span>)) <span class="keyword">AS</span> approved_count,</span><br><span class="line">    <span class="built_in">SUM</span>(amount) <span class="keyword">AS</span> trans_total_amount,</span><br><span class="line">    <span class="built_in">SUM</span>(IF(state <span class="operator">=</span> <span class="string">&#x27;approved&#x27;</span>, amount, <span class="number">0</span>)) <span class="keyword">AS</span> approved_total_amount</span><br><span class="line"><span class="keyword">FROM</span> Transactions</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span>, country</span><br></pre></td></tr></table></figure><h4 id="1193-æ¯æœˆäº¤æ˜“-I"><a href="#1193-æ¯æœˆäº¤æ˜“-I" class="headerlink" title="1193. æ¯æœˆäº¤æ˜“ I"></a><a href="https://leetcode-cn.com/problems/monthly-transactions-i/">1193. æ¯æœˆäº¤æ˜“ I</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>Table: <code>Transactions</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| country       | varchar |</span><br><span class="line">| state         | enum    |</span><br><span class="line">| amount        | int     |</span><br><span class="line">| trans_date    | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¯¥è¡¨åŒ…å«æœ‰å…³ä¼ å…¥äº‹åŠ¡çš„ä¿¡æ¯ã€‚</span><br><span class="line">state åˆ—ç±»å‹ä¸º â€œ[â€æ‰¹å‡†â€œï¼Œâ€æ‹’ç»â€œ] ä¹‹ä¸€ã€‚</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€ä¸ª sql æŸ¥è¯¢æ¥æŸ¥æ‰¾æ¯ä¸ªæœˆå’Œæ¯ä¸ªå›½å®¶/åœ°åŒºçš„äº‹åŠ¡æ•°åŠå…¶æ€»é‡‘é¢ã€å·²æ‰¹å‡†çš„äº‹åŠ¡æ•°åŠå…¶æ€»é‡‘é¢ã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Transactions table:</span><br><span class="line">+------+---------+----------+--------+------------+</span><br><span class="line">| id   | country | state    | amount | trans_date |</span><br><span class="line">+------+---------+----------+--------+------------+</span><br><span class="line">| 121  | US      | approved | 1000   | 2018-12-18 |</span><br><span class="line">| 122  | US      | declined | 2000   | 2018-12-19 |</span><br><span class="line">| 123  | US      | approved | 2000   | 2019-01-01 |</span><br><span class="line">| 124  | DE      | approved | 2000   | 2019-01-07 |</span><br><span class="line">+------+---------+----------+--------+------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+----------+---------+-------------+----------------+--------------------+-----------------------+</span><br><span class="line">| month    | country | trans_count | approved_count | trans_total_amount | approved_total_amount |</span><br><span class="line">+----------+---------+-------------+----------------+--------------------+-----------------------+</span><br><span class="line">| 2018-12  | US      | 2           | 1              | 3000               | 1000                  |</span><br><span class="line">| 2019-01  | US      | 1           | 1              | 2000               | 2000                  |</span><br><span class="line">| 2019-01  | DE      | 1           | 1              | 2000               | 2000                  |</span><br><span class="line">+----------+---------+-------------+----------------+--------------------+-----------------------+</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DATE_FORMAT(trans_date, <span class="string">&#x27;%Y-%m&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">month</span>,</span><br><span class="line">    country,</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> trans_count,</span><br><span class="line">    <span class="built_in">COUNT</span>(IF(state <span class="operator">=</span> <span class="string">&#x27;approved&#x27;</span>, <span class="number">1</span>, <span class="keyword">NULL</span>)) <span class="keyword">AS</span> approved_count,</span><br><span class="line">    <span class="built_in">SUM</span>(amount) <span class="keyword">AS</span> trans_total_amount,</span><br><span class="line">    <span class="built_in">SUM</span>(IF(state <span class="operator">=</span> <span class="string">&#x27;approved&#x27;</span>, amount, <span class="number">0</span>)) <span class="keyword">AS</span> approved_total_amount</span><br><span class="line"><span class="keyword">FROM</span> Transactions</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span>, country</span><br></pre></td></tr></table></figure><h4 id="1205-æ¯æœˆäº¤æ˜“II"><a href="#1205-æ¯æœˆäº¤æ˜“II" class="headerlink" title="1205. æ¯æœˆäº¤æ˜“II"></a><a href="https://leetcode-cn.com/problems/monthly-transactions-ii/">1205. æ¯æœˆäº¤æ˜“II</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p><code>Transactions</code> è®°å½•è¡¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| id             | int     |</span><br><span class="line">| country        | varchar |</span><br><span class="line">| state          | enum    |</span><br><span class="line">| amount         | int     |</span><br><span class="line">| trans_date     | date    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¯¥è¡¨åŒ…å«æœ‰å…³ä¼ å…¥äº‹åŠ¡çš„ä¿¡æ¯ã€‚</span><br><span class="line">çŠ¶æ€åˆ—æ˜¯ç±»å‹ä¸º [approvedï¼ˆå·²æ‰¹å‡†ï¼‰ã€declinedï¼ˆå·²æ‹’ç»ï¼‰] çš„æšä¸¾ã€‚</span><br></pre></td></tr></table></figure><p><code>Chargebacks</code> è¡¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| trans_id       | int     |</span><br><span class="line">| charge_date    | date    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">é€€å•åŒ…å«æœ‰å…³æ”¾ç½®åœ¨äº‹åŠ¡è¡¨ä¸­çš„æŸäº›äº‹åŠ¡çš„ä¼ å…¥é€€å•çš„åŸºæœ¬ä¿¡æ¯ã€‚</span><br><span class="line">trans_id æ˜¯ transactions è¡¨çš„ id åˆ—çš„å¤–é”®ã€‚</span><br><span class="line">æ¯é¡¹é€€å•éƒ½å¯¹åº”äºä¹‹å‰è¿›è¡Œçš„äº¤æ˜“ï¼Œå³ä½¿æœªç»æ‰¹å‡†ã€‚</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œä»¥æŸ¥æ‰¾æ¯ä¸ªæœˆå’Œæ¯ä¸ªå›½å®¶/åœ°åŒºçš„å·²æ‰¹å‡†äº¤æ˜“çš„æ•°é‡åŠå…¶æ€»é‡‘é¢ã€é€€å•çš„æ•°é‡åŠå…¶æ€»é‡‘é¢ã€‚</p><p>æ³¨æ„ï¼šåœ¨æ‚¨çš„æŸ¥è¯¢ä¸­ï¼Œç»™å®šæœˆä»½å’Œå›½å®¶ï¼Œå¿½ç•¥æ‰€æœ‰ä¸ºé›¶çš„è¡Œã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Transactions è¡¨ï¼š</span><br><span class="line">+------+---------+----------+--------+------------+</span><br><span class="line">| id   | country | state    | amount | trans_date |</span><br><span class="line">+------+---------+----------+--------+------------+</span><br><span class="line">| 101  | US      | approved | 1000   | 2019-05-18 |</span><br><span class="line">| 102  | US      | declined | 2000   | 2019-05-19 |</span><br><span class="line">| 103  | US      | approved | 3000   | 2019-06-10 |</span><br><span class="line">| 104  | US      | declined | 4000   | 2019-06-13 |</span><br><span class="line">| 105  | US      | approved | 5000   | 2019-06-15 |</span><br><span class="line">+------+---------+----------+--------+------------+</span><br><span class="line"></span><br><span class="line">Chargebacks è¡¨ï¼š</span><br><span class="line">+------------+------------+</span><br><span class="line">| trans_id   | trans_date |</span><br><span class="line">+------------+------------+</span><br><span class="line">| 102        | 2019-05-29 |</span><br><span class="line">| 101        | 2019-06-30 |</span><br><span class="line">| 105        | 2019-09-18 |</span><br><span class="line">+------------+------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+----------+---------+----------------+-----------------+-------------------+--------------------+</span><br><span class="line">| month    | country | approved_count | approved_amount | chargeback_count  | chargeback_amount  |</span><br><span class="line">+----------+---------+----------------+-----------------+-------------------+--------------------+</span><br><span class="line">| 2019-05  | US      | 1              | 1000            | 1                 | 2000               |</span><br><span class="line">| 2019-06  | US      | 2              | 8000            | 1                 | 1000               |</span><br><span class="line">| 2019-09  | US      | 0              | 0               | 1                 | 5000               |</span><br><span class="line">+----------+---------+----------------+-----------------+-------------------+--------------------+</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    date_format(trans_date, <span class="string">&#x27;%Y-%m&#x27;</span>) <span class="keyword">month</span>, </span><br><span class="line">    country,</span><br><span class="line">    <span class="built_in">sum</span>(state <span class="operator">=</span> <span class="string">&#x27;approved&#x27;</span>) approved_count,</span><br><span class="line">    <span class="built_in">sum</span>(if(state <span class="operator">=</span> <span class="string">&#x27;approved&#x27;</span>, amount, <span class="number">0</span>)) approved_amount,</span><br><span class="line">    <span class="built_in">sum</span>(state <span class="operator">=</span> <span class="string">&#x27;chargeback&#x27;</span>) chargeback_count,</span><br><span class="line">    <span class="built_in">sum</span>(if(state <span class="operator">=</span> <span class="string">&#x27;chargeback&#x27;</span>, amount, <span class="number">0</span>)) chargeback_amount</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> transactions</span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">    <span class="keyword">select</span> id, country, <span class="string">&#x27;chargeback&#x27;</span> state, amount, c.trans_date</span><br><span class="line">    <span class="keyword">from</span> chargebacks c <span class="keyword">left</span> <span class="keyword">join</span> transactions t </span><br><span class="line">    <span class="keyword">on</span> c.trans_id <span class="operator">=</span> t.id</span><br><span class="line">) tmp </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">month</span>, country</span><br><span class="line"><span class="keyword">having</span> approved_amount <span class="keyword">or</span> chargeback_amount</span><br></pre></td></tr></table></figure><h4 id="1194-é”¦æ ‡èµ›ä¼˜èƒœè€…"><a href="#1194-é”¦æ ‡èµ›ä¼˜èƒœè€…" class="headerlink" title="1194. é”¦æ ‡èµ›ä¼˜èƒœè€…"></a><a href="https://leetcode-cn.com/problems/tournament-winners/">1194. é”¦æ ‡èµ›ä¼˜èƒœè€…</a></h4><p>éš¾åº¦å›°éš¾</p><p>SQLæ¶æ„</p><p><code>Players</code> ç©å®¶è¡¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+-------+</span><br><span class="line">| Column Name | Type  |</span><br><span class="line">+-------------+-------+</span><br><span class="line">| player_id   | int   |</span><br><span class="line">| group_id    | int   |</span><br><span class="line">+-------------+-------+</span><br><span class="line">ç©å®¶ ID æ˜¯æ­¤è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">æ­¤è¡¨çš„æ¯ä¸€è¡Œè¡¨ç¤ºæ¯ä¸ªç©å®¶çš„ç»„ã€‚</span><br></pre></td></tr></table></figure><p><code>Matches</code> èµ›äº‹è¡¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| match_id      | int     |</span><br><span class="line">| first_player  | int     |</span><br><span class="line">| second_player | int     | </span><br><span class="line">| first_score   | int     |</span><br><span class="line">| second_score  | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">match_id æ˜¯æ­¤è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">æ¯ä¸€è¡Œæ˜¯ä¸€åœºæ¯”èµ›çš„è®°å½•ï¼Œç¬¬ä¸€åå’Œç¬¬äºŒåçƒå‘˜åŒ…å«æ¯åœºæ¯”èµ›çš„çƒå‘˜ IDã€‚</span><br><span class="line">ç¬¬ä¸€ä¸ªç©å®¶å’Œç¬¬äºŒä¸ªç©å®¶çš„åˆ†æ•°åˆ†åˆ«åŒ…å«ç¬¬ä¸€ä¸ªç©å®¶å’Œç¬¬äºŒä¸ªç©å®¶çš„åˆ†æ•°ã€‚</span><br><span class="line">ä½ å¯ä»¥å‡è®¾ï¼Œåœ¨æ¯ä¸€åœºæ¯”èµ›ä¸­ï¼Œçƒå‘˜éƒ½å±äºåŒä¸€ç»„ã€‚</span><br></pre></td></tr></table></figure><p>æ¯ç»„çš„è·èƒœè€…æ˜¯åœ¨ç»„å†…å¾—åˆ†æœ€é«˜çš„é€‰æ‰‹ã€‚å¦‚æœå¹³å±€ï¼Œplayer_id <strong>æœ€å°</strong> çš„é€‰æ‰‹è·èƒœã€‚</p><p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢æ¥æŸ¥æ‰¾æ¯ç»„ä¸­çš„è·èƒœè€…ã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Players è¡¨:</span><br><span class="line">+-----------+------------+</span><br><span class="line">| player_id | group_id   |</span><br><span class="line">+-----------+------------+</span><br><span class="line">| 15        | 1          |</span><br><span class="line">| 25        | 1          |</span><br><span class="line">| 30        | 1          |</span><br><span class="line">| 45        | 1          |</span><br><span class="line">| 10        | 2          |</span><br><span class="line">| 35        | 2          |</span><br><span class="line">| 50        | 2          |</span><br><span class="line">| 20        | 3          |</span><br><span class="line">| 40        | 3          |</span><br><span class="line">+-----------+------------+</span><br><span class="line"></span><br><span class="line">Matches è¡¨:</span><br><span class="line">+------------+--------------+---------------+-------------+--------------+</span><br><span class="line">| match_id   | first_player | second_player | first_score | second_score |</span><br><span class="line">+------------+--------------+---------------+-------------+--------------+</span><br><span class="line">| 1          | 15           | 45            | 3           | 0            |</span><br><span class="line">| 2          | 30           | 25            | 1           | 2            |</span><br><span class="line">| 3          | 30           | 15            | 2           | 0            |</span><br><span class="line">| 4          | 40           | 20            | 5           | 2            |</span><br><span class="line">| 5          | 35           | 50            | 1           | 1            |</span><br><span class="line">+------------+--------------+---------------+-------------+--------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+-----------+------------+</span><br><span class="line">| group_id  | player_id  |</span><br><span class="line">+-----------+------------+ </span><br><span class="line">| 1         | 15         |</span><br><span class="line">| 2         | 35         |</span><br><span class="line">| 3         | 40         |</span><br><span class="line">+-----------+------------+</span><br></pre></td></tr></table></figure><p>union all</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> group_id, player_id</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> group_id, player_id, <span class="built_in">SUM</span>(score) <span class="keyword">AS</span> score</span><br><span class="line">    <span class="keyword">FROM</span> (</span><br><span class="line">        <span class="comment">-- æ¯ä¸ªç”¨æˆ·æ€»çš„ first_score</span></span><br><span class="line">        <span class="keyword">SELECT</span> Players.group_id, Players.player_id, <span class="built_in">SUM</span>(Matches.first_score) <span class="keyword">AS</span> score</span><br><span class="line">        <span class="keyword">FROM</span> Players <span class="keyword">JOIN</span> <span class="keyword">Matches</span> <span class="keyword">ON</span> Players.player_id <span class="operator">=</span> Matches.first_player</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> Players.player_id</span><br><span class="line"></span><br><span class="line">        <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">-- æ¯ä¸ªç”¨æˆ·æ€»çš„ second_score</span></span><br><span class="line">        <span class="keyword">SELECT</span> Players.group_id, Players.player_id, <span class="built_in">SUM</span>(Matches.second_score) <span class="keyword">AS</span> score</span><br><span class="line">        <span class="keyword">FROM</span> Players <span class="keyword">JOIN</span> <span class="keyword">Matches</span> <span class="keyword">ON</span> Players.player_id <span class="operator">=</span> Matches.second_player</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> Players.player_id</span><br><span class="line">    ) s</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> player_id</span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> score <span class="keyword">DESC</span>, player_id</span><br><span class="line">) <span class="keyword">result</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> group_id</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> group_id, player_id</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> players.<span class="operator">*</span>, <span class="built_in">sum</span>(if(player_id <span class="operator">=</span> first_player, first_score, second_score)) score</span><br><span class="line">    <span class="keyword">from</span> players <span class="keyword">join</span> <span class="keyword">matches</span></span><br><span class="line">    <span class="keyword">on</span> player_id <span class="operator">=</span> first_player <span class="keyword">or</span> player_id <span class="operator">=</span> second_player</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> player_id</span><br><span class="line">    <span class="keyword">order</span> <span class="keyword">by</span> score <span class="keyword">desc</span>, player_id</span><br><span class="line">) tmp</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> group_id</span><br></pre></td></tr></table></figure><h4 id="1204-æœ€åä¸€ä¸ªèƒ½è¿›å…¥ç”µæ¢¯çš„äºº"><a href="#1204-æœ€åä¸€ä¸ªèƒ½è¿›å…¥ç”µæ¢¯çš„äºº" class="headerlink" title="1204. æœ€åä¸€ä¸ªèƒ½è¿›å…¥ç”µæ¢¯çš„äºº"></a><a href="https://leetcode-cn.com/problems/last-person-to-fit-in-the-elevator/">1204. æœ€åä¸€ä¸ªèƒ½è¿›å…¥ç”µæ¢¯çš„äºº</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>è¡¨: <code>Queue</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| person_id   | int     |</span><br><span class="line">| person_name | varchar |</span><br><span class="line">| weight      | int     |</span><br><span class="line">| turn        | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">person_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¯¥è¡¨å±•ç¤ºäº†æ‰€æœ‰ç­‰å¾…ç”µæ¢¯çš„äººçš„ä¿¡æ¯ã€‚</span><br><span class="line">è¡¨ä¸­ person_id å’Œ turn åˆ—å°†åŒ…å«ä» 1 åˆ° n çš„æ‰€æœ‰æ•°å­—ï¼Œå…¶ä¸­ n æ˜¯è¡¨ä¸­çš„è¡Œæ•°ã€‚</span><br></pre></td></tr></table></figure><p>ç”µæ¢¯æœ€å¤§è½½é‡é‡ä¸º <strong>1000</strong>ã€‚</p><p>å†™ä¸€æ¡ SQL æŸ¥è¯¢è¯­å¥æŸ¥æ‰¾æœ€åä¸€ä¸ªèƒ½è¿›å…¥ç”µæ¢¯ä¸”ä¸è¶…è¿‡é‡é‡é™åˆ¶çš„ <code>person_name</code> ã€‚é¢˜ç›®ç¡®ä¿é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä½çš„äººå¯ä»¥è¿›å…¥ç”µæ¢¯ ã€‚</p><p>æŸ¥è¯¢ç»“æœå¦‚ä¸‹æ‰€ç¤º :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Queue è¡¨</span><br><span class="line">+-----------+-------------------+--------+------+</span><br><span class="line">| person_id | person_name       | weight | turn |</span><br><span class="line">+-----------+-------------------+--------+------+</span><br><span class="line">| 5         | George Washington | 250    | 1    |</span><br><span class="line">| 3         | John Adams        | 350    | 2    |</span><br><span class="line">| 6         | Thomas Jefferson  | 400    | 3    |</span><br><span class="line">| 2         | Will Johnliams    | 200    | 4    |</span><br><span class="line">| 4         | Thomas Jefferson  | 175    | 5    |</span><br><span class="line">| 1         | James Elephant    | 500    | 6    |</span><br><span class="line">+-----------+-------------------+--------+------+</span><br><span class="line"></span><br><span class="line">Result è¡¨</span><br><span class="line">+-------------------+</span><br><span class="line">| person_name       |</span><br><span class="line">+-------------------+</span><br><span class="line">| Thomas Jefferson  |</span><br><span class="line">+-------------------+</span><br><span class="line"></span><br><span class="line">ä¸ºäº†ç®€åŒ–ï¼ŒQueue è¡¨æŒ‰ turn åˆ—ç”±å°åˆ°å¤§æ’åºã€‚</span><br><span class="line">ä¸Šä¾‹ä¸­ George Washington(id 5), John Adams(id 3) å’Œ Thomas Jefferson(id 6) å°†å¯ä»¥è¿›å…¥ç”µæ¢¯,å› ä¸ºä»–ä»¬çš„ä½“é‡å’Œä¸º 250 + 350 + 400 = 1000ã€‚</span><br><span class="line">Thomas Jefferson(id 6) æ˜¯æœ€åä¸€ä¸ªä½“é‡åˆé€‚å¹¶è¿›å…¥ç”µæ¢¯çš„äººã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> person_name</span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line">    <span class="keyword">select</span> person_name  ,<span class="built_in">sum</span>(weight) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> turn) t</span><br><span class="line">    <span class="keyword">from</span> Queue</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> t<span class="operator">&lt;=</span><span class="number">1000</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> t <span class="keyword">desc</span> </span><br><span class="line">limit <span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="1211-æŸ¥è¯¢ç»“æœçš„è´¨é‡å’Œå æ¯”"><a href="#1211-æŸ¥è¯¢ç»“æœçš„è´¨é‡å’Œå æ¯”" class="headerlink" title="1211. æŸ¥è¯¢ç»“æœçš„è´¨é‡å’Œå æ¯”"></a><a href="https://leetcode-cn.com/problems/queries-quality-and-percentage/">1211. æŸ¥è¯¢ç»“æœçš„è´¨é‡å’Œå æ¯”</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>æŸ¥è¯¢è¡¨ <code>Queries</code>ï¼š </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| query_name  | varchar |</span><br><span class="line">| result      | varchar |</span><br><span class="line">| position    | int     |</span><br><span class="line">| rating      | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">æ­¤è¡¨æ²¡æœ‰ä¸»é”®ï¼Œå¹¶å¯èƒ½æœ‰é‡å¤çš„è¡Œã€‚</span><br><span class="line">æ­¤è¡¨åŒ…å«äº†ä¸€äº›ä»æ•°æ®åº“ä¸­æ”¶é›†çš„æŸ¥è¯¢ä¿¡æ¯ã€‚</span><br><span class="line">â€œä½ç½®â€ï¼ˆpositionï¼‰åˆ—çš„å€¼ä¸º 1 åˆ° 500 ã€‚</span><br><span class="line">â€œè¯„åˆ†â€ï¼ˆratingï¼‰åˆ—çš„å€¼ä¸º 1 åˆ° 5 ã€‚è¯„åˆ†å°äº 3 çš„æŸ¥è¯¢è¢«å®šä¹‰ä¸ºè´¨é‡å¾ˆå·®çš„æŸ¥è¯¢ã€‚</span><br></pre></td></tr></table></figure><p>å°†æŸ¥è¯¢ç»“æœçš„è´¨é‡ <code>quality</code> å®šä¹‰ä¸ºï¼š</p><blockquote><p>å„æŸ¥è¯¢ç»“æœçš„è¯„åˆ†ä¸å…¶ä½ç½®ä¹‹é—´æ¯”ç‡çš„å¹³å‡å€¼ã€‚</p></blockquote><p>å°†åŠ£è´¨æŸ¥è¯¢ç™¾åˆ†æ¯” <code>poor_query_percentage</code> ä¸ºï¼š</p><blockquote><p>è¯„åˆ†å°äº 3 çš„æŸ¥è¯¢ç»“æœå å…¨éƒ¨æŸ¥è¯¢ç»“æœçš„ç™¾åˆ†æ¯”ã€‚</p></blockquote><p>ç¼–å†™ä¸€ç»„ SQL æ¥æŸ¥æ‰¾æ¯æ¬¡æŸ¥è¯¢çš„<code>åç§°</code>(<code>query_name</code>)ã€<code>è´¨é‡</code>(<code>quality</code>) å’Œ <code>åŠ£è´¨æŸ¥è¯¢ç™¾åˆ†æ¯”</code>(<code>poor_query_percentage</code>)ã€‚</p><p><code>è´¨é‡</code>(<code>quality</code>) å’Œ<code>åŠ£è´¨æŸ¥è¯¢ç™¾åˆ†æ¯”</code>(<code>poor_query_percentage</code>) éƒ½åº”å››èˆäº”å…¥åˆ°å°æ•°ç‚¹åä¸¤ä½ã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Queries table:</span><br><span class="line">+------------+-------------------+----------+--------+</span><br><span class="line">| query_name | result            | position | rating |</span><br><span class="line">+------------+-------------------+----------+--------+</span><br><span class="line">| Dog        | Golden Retriever  | 1        | 5      |</span><br><span class="line">| Dog        | German Shepherd   | 2        | 5      |</span><br><span class="line">| Dog        | Mule              | 200      | 1      |</span><br><span class="line">| Cat        | Shirazi           | 5        | 2      |</span><br><span class="line">| Cat        | Siamese           | 3        | 3      |</span><br><span class="line">| Cat        | Sphynx            | 7        | 4      |</span><br><span class="line">+------------+-------------------+----------+--------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+---------+-----------------------+</span><br><span class="line">| query_name | quality | poor_query_percentage |</span><br><span class="line">+------------+---------+-----------------------+</span><br><span class="line">| Dog        | 2.50    | 33.33                 |</span><br><span class="line">| Cat        | 0.66    | 33.33                 |</span><br><span class="line">+------------+---------+-----------------------+</span><br><span class="line"></span><br><span class="line">Dog æŸ¥è¯¢ç»“æœçš„è´¨é‡ä¸º ((5 / 1) + (5 / 2) + (1 / 200)) / 3 = 2.50</span><br><span class="line">Dog æŸ¥è¯¢ç»“æœçš„åŠ£è´¨æŸ¥è¯¢ç™¾åˆ†æ¯”ä¸º (1 / 3) * 100 = 33.33</span><br><span class="line"></span><br><span class="line">Cat æŸ¥è¯¢ç»“æœçš„è´¨é‡ä¸º ((2 / 5) + (3 / 3) + (4 / 7)) / 3 = 0.66</span><br><span class="line">Cat æŸ¥è¯¢ç»“æœçš„åŠ£è´¨æŸ¥è¯¢ç™¾åˆ†æ¯”ä¸º (1 / 3) * 100 = 33.33</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> query_name,</span><br><span class="line">    round(<span class="built_in">avg</span>(rating<span class="operator">/</span>position),<span class="number">2</span>) quality,</span><br><span class="line">    round(<span class="built_in">sum</span>(if(rating<span class="operator">&lt;</span><span class="number">3</span>,<span class="number">1</span>,<span class="number">0</span>))<span class="operator">/</span><span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">*</span><span class="number">100</span>,<span class="number">2</span>) poor_query_percentage</span><br><span class="line"><span class="keyword">from</span> Queries</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> query_name</span><br></pre></td></tr></table></figure><h4 id="1212-æŸ¥è¯¢çƒé˜Ÿç§¯åˆ†"><a href="#1212-æŸ¥è¯¢çƒé˜Ÿç§¯åˆ†" class="headerlink" title="1212. æŸ¥è¯¢çƒé˜Ÿç§¯åˆ†"></a><a href="https://leetcode-cn.com/problems/team-scores-in-football-tournament/">1212. æŸ¥è¯¢çƒé˜Ÿç§¯åˆ†</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>Table: <code>Teams</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+---------------+----------+</span><br><span class="line">| Column Name   | Type     |</span><br><span class="line">+---------------+----------+</span><br><span class="line">| team_id       | int      |</span><br><span class="line">| team_name     | varchar  |</span><br><span class="line">+---------------+----------+</span><br><span class="line">æ­¤è¡¨çš„ä¸»é”®æ˜¯ team_idï¼Œè¡¨ä¸­çš„æ¯ä¸€è¡Œéƒ½ä»£è¡¨ä¸€æ”¯ç‹¬ç«‹è¶³çƒé˜Ÿã€‚</span><br></pre></td></tr></table></figure><p>Table: <code>Matches</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| match_id      | int     |</span><br><span class="line">| host_team     | int     |</span><br><span class="line">| guest_team    | int     | </span><br><span class="line">| host_goals    | int     |</span><br><span class="line">| guest_goals   | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">æ­¤è¡¨çš„ä¸»é”®æ˜¯ match_idï¼Œè¡¨ä¸­çš„æ¯ä¸€è¡Œéƒ½ä»£è¡¨ä¸€åœºå·²ç»“æŸçš„æ¯”èµ›ï¼Œæ¯”èµ›çš„ä¸»å®¢é˜Ÿåˆ†åˆ«ç”±å®ƒä»¬è‡ªå·±çš„ id è¡¨ç¤ºï¼Œä»–ä»¬çš„è¿›çƒç”± host_goals å’Œ guest_goals åˆ†åˆ«è¡¨ç¤ºã€‚</span><br></pre></td></tr></table></figure><p>ç§¯åˆ†è§„åˆ™å¦‚ä¸‹ï¼š</p><ul><li>èµ¢ä¸€åœºå¾—ä¸‰åˆ†ï¼›</li><li>å¹³ä¸€åœºå¾—ä¸€åˆ†ï¼›</li><li>è¾“ä¸€åœºä¸å¾—åˆ†ã€‚</li></ul><p>å†™å‡ºä¸€æ¡SQLè¯­å¥ä»¥æŸ¥è¯¢æ¯ä¸ªé˜Ÿçš„ <strong>team_id</strong>ï¼Œ<strong>team_name</strong> å’Œ <strong>num_points</strong>ã€‚ç»“æœæ ¹æ® num_points <strong>é™åºæ’åº</strong>ï¼Œå¦‚æœæœ‰ä¸¤é˜Ÿç§¯åˆ†ç›¸åŒï¼Œé‚£ä¹ˆè¿™ä¸¤é˜ŸæŒ‰ team_id <strong>å‡åºæ’åº</strong>ã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Teams table:</span><br><span class="line">+-----------+--------------+</span><br><span class="line">| team_id   | team_name    |</span><br><span class="line">+-----------+--------------+</span><br><span class="line">| 10        | Leetcode FC  |</span><br><span class="line">| 20        | NewYork FC   |</span><br><span class="line">| 30        | Atlanta FC   |</span><br><span class="line">| 40        | Chicago FC   |</span><br><span class="line">| 50        | Toronto FC   |</span><br><span class="line">+-----------+--------------+</span><br><span class="line"></span><br><span class="line">Matches table:</span><br><span class="line">+------------+--------------+---------------+-------------+--------------+</span><br><span class="line">| match_id   | host_team    | guest_team    | host_goals  | guest_goals  |</span><br><span class="line">+------------+--------------+---------------+-------------+--------------+</span><br><span class="line">| 1          | 10           | 20            | 3           | 0            |</span><br><span class="line">| 2          | 30           | 10            | 2           | 2            |</span><br><span class="line">| 3          | 10           | 50            | 5           | 1            |</span><br><span class="line">| 4          | 20           | 30            | 1           | 0            |</span><br><span class="line">| 5          | 50           | 30            | 1           | 0            |</span><br><span class="line">+------------+--------------+---------------+-------------+--------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+--------------+---------------+</span><br><span class="line">| team_id    | team_name    | num_points    |</span><br><span class="line">+------------+--------------+---------------+</span><br><span class="line">| 10         | Leetcode FC  | 7             |</span><br><span class="line">| 20         | NewYork FC   | 3             |</span><br><span class="line">| 50         | Toronto FC   | 3             |</span><br><span class="line">| 30         | Atlanta FC   | 1             |</span><br><span class="line">| 40         | Chicago FC   | 0             |</span><br><span class="line">+------------+--------------+---------------+</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> team_id , team_name ,<span class="built_in">sum</span>(</span><br><span class="line">if(team_id <span class="operator">=</span> host_team <span class="operator">&amp;&amp;</span> host_goals<span class="operator">&gt;</span>guest_goals ,<span class="number">3</span>,<span class="number">0</span>)<span class="operator">+</span></span><br><span class="line">if(team_id <span class="operator">=</span> host_team <span class="operator">&amp;&amp;</span> host_goals<span class="operator">=</span>guest_goals,<span class="number">1</span>,<span class="number">0</span>)<span class="operator">+</span></span><br><span class="line">if(team_id <span class="operator">=</span> guest_team <span class="operator">&amp;&amp;</span> host_goals<span class="operator">=</span>guest_goals,<span class="number">1</span>,<span class="number">0</span>)<span class="operator">+</span></span><br><span class="line">if(team_id <span class="operator">=</span> guest_team <span class="operator">&amp;&amp;</span> host_goals<span class="operator">&lt;</span>guest_goals ,<span class="number">3</span>,<span class="number">0</span>)</span><br><span class="line">)num_points</span><br><span class="line"><span class="keyword">from</span> Teams t <span class="keyword">left</span> <span class="keyword">join</span> <span class="keyword">Matches</span> m</span><br><span class="line"><span class="keyword">on</span> t.team_id <span class="operator">=</span>m.host_team  <span class="keyword">or</span> t.team_id <span class="operator">=</span>m.guest_team  </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> team_id ,team_name</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> num_points <span class="keyword">desc</span>,team_id</span><br></pre></td></tr></table></figure><h4 id="1225-æŠ¥å‘Šç³»ç»ŸçŠ¶æ€çš„è¿ç»­æ—¥æœŸ"><a href="#1225-æŠ¥å‘Šç³»ç»ŸçŠ¶æ€çš„è¿ç»­æ—¥æœŸ" class="headerlink" title="1225. æŠ¥å‘Šç³»ç»ŸçŠ¶æ€çš„è¿ç»­æ—¥æœŸ"></a><a href="https://leetcode-cn.com/problems/report-contiguous-dates/">1225. æŠ¥å‘Šç³»ç»ŸçŠ¶æ€çš„è¿ç»­æ—¥æœŸ</a></h4><p>éš¾åº¦å›°éš¾</p><p>SQLæ¶æ„</p><p>Table: <code>Failed</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| fail_date    | date    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">è¯¥è¡¨ä¸»é”®ä¸º fail_dateã€‚</span><br><span class="line">è¯¥è¡¨åŒ…å«å¤±è´¥ä»»åŠ¡çš„å¤©æ•°.</span><br></pre></td></tr></table></figure><p>Table: <code>Succeeded</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| success_date | date    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">è¯¥è¡¨ä¸»é”®ä¸º success_dateã€‚</span><br><span class="line">è¯¥è¡¨åŒ…å«æˆåŠŸä»»åŠ¡çš„å¤©æ•°.</span><br></pre></td></tr></table></figure><p>ç³»ç»Ÿ <strong>æ¯å¤©</strong> è¿è¡Œä¸€ä¸ªä»»åŠ¡ã€‚æ¯ä¸ªä»»åŠ¡éƒ½ç‹¬ç«‹äºå…ˆå‰çš„ä»»åŠ¡ã€‚ä»»åŠ¡çš„çŠ¶æ€å¯ä»¥æ˜¯å¤±è´¥æˆ–æ˜¯æˆåŠŸã€‚</p><p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ <strong>2019-01-01</strong> åˆ° <strong>2019-12-31</strong> æœŸé—´ä»»åŠ¡è¿ç»­åŒçŠ¶æ€ <code>period_state</code> çš„èµ·æ­¢æ—¥æœŸï¼ˆ<code>start_date</code> å’Œ <code>end_date</code>ï¼‰ã€‚å³å¦‚æœä»»åŠ¡å¤±è´¥äº†ï¼Œå°±æ˜¯å¤±è´¥çŠ¶æ€çš„èµ·æ­¢æ—¥æœŸï¼Œå¦‚æœä»»åŠ¡æˆåŠŸäº†ï¼Œå°±æ˜¯æˆåŠŸçŠ¶æ€çš„èµ·æ­¢æ—¥æœŸã€‚</p><p>æœ€åç»“æœæŒ‰ç…§èµ·å§‹æ—¥æœŸ <code>start_date</code> æ’åº</p><p>æŸ¥è¯¢ç»“æœæ ·ä¾‹å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">Failed table:</span><br><span class="line">+-------------------+</span><br><span class="line">| fail_date         |</span><br><span class="line">+-------------------+</span><br><span class="line">| 2018-12-28        |</span><br><span class="line">| 2018-12-29        |</span><br><span class="line">| 2019-01-04        |</span><br><span class="line">| 2019-01-05        |</span><br><span class="line">+-------------------+</span><br><span class="line"></span><br><span class="line">Succeeded table:</span><br><span class="line">+-------------------+</span><br><span class="line">| success_date      |</span><br><span class="line">+-------------------+</span><br><span class="line">| 2018-12-30        |</span><br><span class="line">| 2018-12-31        |</span><br><span class="line">| 2019-01-01        |</span><br><span class="line">| 2019-01-02        |</span><br><span class="line">| 2019-01-03        |</span><br><span class="line">| 2019-01-06        |</span><br><span class="line">+-------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+--------------+--------------+--------------+</span><br><span class="line">| period_state | start_date   | end_date     |</span><br><span class="line">+--------------+--------------+--------------+</span><br><span class="line">| succeeded    | 2019-01-01   | 2019-01-03   |</span><br><span class="line">| failed       | 2019-01-04   | 2019-01-05   |</span><br><span class="line">| succeeded    | 2019-01-06   | 2019-01-06   |</span><br><span class="line">+--------------+--------------+--------------+</span><br><span class="line"></span><br><span class="line">ç»“æœå¿½ç•¥äº† 2018 å¹´çš„è®°å½•ï¼Œå› ä¸ºæˆ‘ä»¬åªå…³å¿ƒä» 2019-01-01 åˆ° 2019-12-31 çš„è®°å½•</span><br><span class="line">ä» 2019-01-01 åˆ° 2019-01-03 æ‰€æœ‰ä»»åŠ¡æˆåŠŸï¼Œç³»ç»ŸçŠ¶æ€ä¸º &quot;succeeded&quot;ã€‚</span><br><span class="line">ä» 2019-01-04 åˆ° 2019-01-05 æ‰€æœ‰ä»»åŠ¡å¤±è´¥ï¼Œç³»ç»ŸçŠ¶æ€ä¸º &quot;failed&quot;ã€‚</span><br><span class="line">ä» 2019-01-06 åˆ° 2019-01-06 æ‰€æœ‰ä»»åŠ¡æˆåŠŸï¼Œç³»ç»ŸçŠ¶æ€ä¸º &quot;succeeded&quot;ã€‚</span><br></pre></td></tr></table></figure><p>å¼€çª—å‡½æ•°</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> type  period_state, <span class="built_in">min</span>(<span class="type">date</span>) start_date, <span class="built_in">max</span>(<span class="type">date</span>) <span class="keyword">as</span> end_date</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> type, <span class="type">date</span>, subdate(<span class="type">date</span>,<span class="built_in">row_number</span>()<span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> type <span class="keyword">order</span> <span class="keyword">by</span> <span class="type">date</span>)) <span class="keyword">as</span> diff</span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> <span class="string">&#x27;failed&#x27;</span> <span class="keyword">as</span> type, fail_date <span class="keyword">as</span> <span class="type">date</span> <span class="keyword">from</span> Failed</span><br><span class="line">        <span class="keyword">where</span> fail_date <span class="keyword">between</span> <span class="string">&#x27;2019-01-01&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;2019-12-31&#x27;</span></span><br><span class="line">        <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">        <span class="keyword">select</span> <span class="string">&#x27;succeeded&#x27;</span> <span class="keyword">as</span> type, success_date <span class="keyword">as</span> <span class="type">date</span> <span class="keyword">from</span> Succeeded</span><br><span class="line">        <span class="keyword">where</span> success_date <span class="keyword">between</span> <span class="string">&#x27;2019-01-01&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;2019-12-31&#x27;</span></span><br><span class="line">    ) a</span><br><span class="line">)b</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> type,diff</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> start_date</span><br></pre></td></tr></table></figure><h4 id="1241-æ¯ä¸ªå¸–å­çš„è¯„è®ºæ•°"><a href="#1241-æ¯ä¸ªå¸–å­çš„è¯„è®ºæ•°" class="headerlink" title="1241. æ¯ä¸ªå¸–å­çš„è¯„è®ºæ•°"></a><a href="https://leetcode-cn.com/problems/number-of-comments-per-post/">1241. æ¯ä¸ªå¸–å­çš„è¯„è®ºæ•°</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>è¡¨ <code>Submissions</code> ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+----------+</span><br><span class="line">| åˆ—å           | ç±»å‹     |</span><br><span class="line">+---------------+----------+</span><br><span class="line">| sub_id        | int      |</span><br><span class="line">| parent_id     | int      |</span><br><span class="line">+---------------+----------+</span><br><span class="line">ä¸Šè¡¨æ²¡æœ‰ä¸»é”®, æ‰€ä»¥å¯èƒ½ä¼šå‡ºç°é‡å¤çš„è¡Œã€‚</span><br><span class="line">æ¯è¡Œå¯ä»¥æ˜¯ä¸€ä¸ªå¸–å­æˆ–å¯¹è¯¥å¸–å­çš„è¯„è®ºã€‚</span><br><span class="line">å¦‚æœæ˜¯å¸–å­çš„è¯ï¼Œparent_id å°±æ˜¯ nullã€‚</span><br><span class="line">å¯¹äºè¯„è®ºæ¥è¯´ï¼Œparent_id å°±æ˜¯è¡¨ä¸­å¯¹åº”å¸–å­çš„ sub_idã€‚</span><br></pre></td></tr></table></figure><p>ç¼–å†™ SQL è¯­å¥ä»¥æŸ¥æ‰¾æ¯ä¸ªå¸–å­çš„è¯„è®ºæ•°ã€‚</p><p>ç»“æœè¡¨åº”åŒ…å«å¸–å­çš„ <code>post_id</code> å’Œå¯¹åº”çš„è¯„è®ºæ•° <code>number_of_comments</code> å¹¶ä¸”æŒ‰ <code>post_id</code> å‡åºæ’åˆ—ã€‚</p><p><code>Submissions</code> å¯èƒ½åŒ…å«é‡å¤çš„è¯„è®ºã€‚æ‚¨åº”è¯¥è®¡ç®—æ¯ä¸ªå¸–å­çš„å”¯ä¸€è¯„è®ºæ•°ã€‚</p><p><code>Submissions</code> å¯èƒ½åŒ…å«é‡å¤çš„å¸–å­ã€‚æ‚¨åº”è¯¥å°†å®ƒä»¬è§†ä¸ºä¸€ä¸ªå¸–å­ã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Submissions table:</span><br><span class="line">+---------+------------+</span><br><span class="line">| sub_id  | parent_id  |</span><br><span class="line">+---------+------------+</span><br><span class="line">| 1       | Null       |</span><br><span class="line">| 2       | Null       |</span><br><span class="line">| 1       | Null       |</span><br><span class="line">| 12      | Null       |</span><br><span class="line">| 3       | 1          |</span><br><span class="line">| 5       | 2          |</span><br><span class="line">| 3       | 1          |</span><br><span class="line">| 4       | 1          |</span><br><span class="line">| 9       | 1          |</span><br><span class="line">| 10      | 2          |</span><br><span class="line">| 6       | 7          |</span><br><span class="line">+---------+------------+</span><br><span class="line"></span><br><span class="line">ç»“æœè¡¨ï¼š</span><br><span class="line">+---------+--------------------+</span><br><span class="line">| post_id | number_of_comments |</span><br><span class="line">+---------+--------------------+</span><br><span class="line">| 1       | 3                  |</span><br><span class="line">| 2       | 2                  |</span><br><span class="line">| 12      | 0                  |</span><br><span class="line">+---------+--------------------+</span><br><span class="line"></span><br><span class="line">è¡¨ä¸­ ID ä¸º 1 çš„å¸–å­æœ‰ ID ä¸º 3ã€4 å’Œ 9 çš„ä¸‰ä¸ªè¯„è®ºã€‚è¡¨ä¸­ ID ä¸º 3 çš„è¯„è®ºé‡å¤å‡ºç°äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªå¯¹å®ƒè¿›è¡Œäº†ä¸€æ¬¡è®¡æ•°ã€‚</span><br><span class="line">è¡¨ä¸­ ID ä¸º 2 çš„å¸–å­æœ‰ ID ä¸º 5 å’Œ 10 çš„ä¸¤ä¸ªè¯„è®ºã€‚</span><br><span class="line">ID ä¸º 12 çš„å¸–å­åœ¨è¡¨ä¸­æ²¡æœ‰è¯„è®ºã€‚</span><br><span class="line">è¡¨ä¸­ ID ä¸º 6 çš„è¯„è®ºæ˜¯å¯¹ ID ä¸º 7 çš„å·²åˆ é™¤å¸–å­çš„è¯„è®ºï¼Œå› æ­¤æˆ‘ä»¬å°†å…¶å¿½ç•¥ã€‚</span><br></pre></td></tr></table></figure><p>åjoin</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s.sub_id post_id,ifnull(number_of_comments,<span class="number">0</span>) number_of_comments</span><br><span class="line"><span class="keyword">from</span> Submissions s</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> (</span><br><span class="line">  <span class="keyword">select</span> parent_id ,<span class="built_in">count</span>(<span class="keyword">distinct</span> sub_id) number_of_comments</span><br><span class="line">  <span class="keyword">from</span> Submissions </span><br><span class="line">  <span class="keyword">group</span> <span class="keyword">by</span> parent_id</span><br><span class="line">) t1</span><br><span class="line"><span class="keyword">on</span> s.sub_id <span class="operator">=</span> t1.parent_id</span><br><span class="line"><span class="keyword">where</span> s.parent_id  <span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> post_id,number_of_comments</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> sub_id</span><br></pre></td></tr></table></figure><p>å…ˆjoin</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> post_id, <span class="built_in">COUNT</span>(sub_id) <span class="keyword">AS</span> number_of_comments</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> post.sub_id <span class="keyword">AS</span> post_id, sub.sub_id <span class="keyword">AS</span> sub_id</span><br><span class="line">    <span class="keyword">FROM</span> Submissions post</span><br><span class="line">    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Submissions sub</span><br><span class="line">    <span class="keyword">ON</span> post.sub_id <span class="operator">=</span> sub.parent_id</span><br><span class="line">    <span class="keyword">WHERE</span> post.parent_id <span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line">) T</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> post_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> post_id <span class="keyword">ASC</span></span><br></pre></td></tr></table></figure><h4 id="1251-å¹³å‡å”®ä»·"><a href="#1251-å¹³å‡å”®ä»·" class="headerlink" title="1251. å¹³å‡å”®ä»·"></a><a href="https://leetcode-cn.com/problems/average-selling-price/">1251. å¹³å‡å”®ä»·</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>Table: <code>Prices</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| start_date    | date    |</span><br><span class="line">| end_date      | date    |</span><br><span class="line">| price         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(product_idï¼Œstart_dateï¼Œend_date) æ˜¯ Prices è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">Prices è¡¨çš„æ¯ä¸€è¡Œè¡¨ç¤ºçš„æ˜¯æŸä¸ªäº§å“åœ¨ä¸€æ®µæ—¶æœŸå†…çš„ä»·æ ¼ã€‚</span><br><span class="line">æ¯ä¸ªäº§å“çš„å¯¹åº”æ—¶é—´æ®µæ˜¯ä¸ä¼šé‡å çš„ï¼Œè¿™ä¹Ÿæ„å‘³ç€åŒä¸€ä¸ªäº§å“çš„ä»·æ ¼æ—¶æ®µä¸ä¼šå‡ºç°äº¤å‰ã€‚</span><br></pre></td></tr></table></figure><p>Table: <code>UnitsSold</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| purchase_date | date    |</span><br><span class="line">| units         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">UnitsSold è¡¨æ²¡æœ‰ä¸»é”®ï¼Œå®ƒå¯èƒ½åŒ…å«é‡å¤é¡¹ã€‚</span><br><span class="line">UnitsSold è¡¨çš„æ¯ä¸€è¡Œè¡¨ç¤ºçš„æ˜¯æ¯ç§äº§å“çš„å‡ºå”®æ—¥æœŸï¼Œå•ä½å’Œäº§å“ idã€‚</span><br></pre></td></tr></table></figure><p>ç¼–å†™SQLæŸ¥è¯¢ä»¥æŸ¥æ‰¾æ¯ç§äº§å“çš„å¹³å‡å”®ä»·ã€‚<br><code>average_price</code> åº”è¯¥å››èˆäº”å…¥åˆ°å°æ•°ç‚¹åä¸¤ä½ã€‚<br>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Prices table:</span><br><span class="line">+------------+------------+------------+--------+</span><br><span class="line">| product_id | start_date | end_date   | price  |</span><br><span class="line">+------------+------------+------------+--------+</span><br><span class="line">| 1          | 2019-02-17 | 2019-02-28 | 5      |</span><br><span class="line">| 1          | 2019-03-01 | 2019-03-22 | 20     |</span><br><span class="line">| 2          | 2019-02-01 | 2019-02-20 | 15     |</span><br><span class="line">| 2          | 2019-02-21 | 2019-03-31 | 30     |</span><br><span class="line">+------------+------------+------------+--------+</span><br><span class="line"> </span><br><span class="line">UnitsSold table:</span><br><span class="line">+------------+---------------+-------+</span><br><span class="line">| product_id | purchase_date | units |</span><br><span class="line">+------------+---------------+-------+</span><br><span class="line">| 1          | 2019-02-25    | 100   |</span><br><span class="line">| 1          | 2019-03-01    | 15    |</span><br><span class="line">| 2          | 2019-02-10    | 200   |</span><br><span class="line">| 2          | 2019-03-22    | 30    |</span><br><span class="line">+------------+---------------+-------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+---------------+</span><br><span class="line">| product_id | average_price |</span><br><span class="line">+------------+---------------+</span><br><span class="line">| 1          | 6.96          |</span><br><span class="line">| 2          | 16.96         |</span><br><span class="line">+------------+---------------+</span><br><span class="line">å¹³å‡å”®ä»· = äº§å“æ€»ä»· / é”€å”®çš„äº§å“æ•°é‡ã€‚</span><br><span class="line">äº§å“ 1 çš„å¹³å‡å”®ä»· = ((100 * 5)+(15 * 20) )/ 115 = 6.96</span><br><span class="line">äº§å“ 2 çš„å¹³å‡å”®ä»· = ((200 * 15)+(30 * 30) )/ 230 = 16.96</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    product_id,</span><br><span class="line">    Round(<span class="built_in">SUM</span>(sales) <span class="operator">/</span> <span class="built_in">SUM</span>(units), <span class="number">2</span>) <span class="keyword">AS</span> average_price</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">        Prices.product_id <span class="keyword">AS</span> product_id,</span><br><span class="line">        Prices.price <span class="operator">*</span> UnitsSold.units <span class="keyword">AS</span> sales,</span><br><span class="line">        UnitsSold.units <span class="keyword">AS</span> units</span><br><span class="line">    <span class="keyword">FROM</span> Prices </span><br><span class="line">    <span class="keyword">JOIN</span> UnitsSold <span class="keyword">ON</span> Prices.product_id <span class="operator">=</span> UnitsSold.product_id</span><br><span class="line">    <span class="keyword">WHERE</span> UnitsSold.purchase_date <span class="keyword">BETWEEN</span> Prices.start_date <span class="keyword">AND</span> Prices.end_date</span><br><span class="line">) T</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> product_id</span><br></pre></td></tr></table></figure><blockquote><p>2è¡¨å…³è”çš„æ—¶å€™ç›´æ¥æŠŠæ—¥æœŸåšè¿‡æ»¤</p></blockquote><h4 id="1264-é¡µé¢æ¨è"><a href="#1264-é¡µé¢æ¨è" class="headerlink" title="1264. é¡µé¢æ¨è"></a><a href="https://leetcode-cn.com/problems/page-recommendations/">1264. é¡µé¢æ¨è</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>æœ‹å‹å…³ç³»åˆ—è¡¨ï¼š <code>Friendship</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user1_id      | int     |</span><br><span class="line">| user2_id      | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">è¿™å¼ è¡¨çš„ä¸»é”®æ˜¯ (user1_id, user2_id)ã€‚</span><br><span class="line">è¿™å¼ è¡¨çš„æ¯ä¸€è¡Œä»£è¡¨ç€ user1_id å’Œ user2_id ä¹‹é—´å­˜åœ¨ç€æœ‹å‹å…³ç³»ã€‚</span><br></pre></td></tr></table></figure><p>å–œæ¬¢åˆ—è¡¨ï¼š <code>Likes</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| user_id     | int     |</span><br><span class="line">| page_id     | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">è¿™å¼ è¡¨çš„ä¸»é”®æ˜¯ (user_id, page_id)ã€‚</span><br><span class="line">è¿™å¼ è¡¨çš„æ¯ä¸€è¡Œä»£è¡¨ç€ user_id å–œæ¬¢ page_idã€‚</span><br></pre></td></tr></table></figure><p>å†™ä¸€æ®µ SQL  å‘<code>user_id</code> = 1 çš„ç”¨æˆ·ï¼Œæ¨èå…¶æœ‹å‹ä»¬å–œæ¬¢çš„é¡µé¢ã€‚ä¸è¦æ¨èè¯¥ç”¨æˆ·å·²ç»å–œæ¬¢çš„é¡µé¢ã€‚</p><p>ä½ è¿”å›çš„ç»“æœä¸­ä¸åº”å½“åŒ…å«é‡å¤é¡¹ã€‚</p><p>è¿”å›ç»“æœçš„æ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">Friendship table:</span><br><span class="line">+----------+----------+</span><br><span class="line">| user1_id | user2_id |</span><br><span class="line">+----------+----------+</span><br><span class="line">| 1        | 2        |</span><br><span class="line">| 1        | 3        |</span><br><span class="line">| 1        | 4        |</span><br><span class="line">| 2        | 3        |</span><br><span class="line">| 2        | 4        |</span><br><span class="line">| 2        | 5        |</span><br><span class="line">| 6        | 1        |</span><br><span class="line">+----------+----------+</span><br><span class="line"> </span><br><span class="line">Likes table:</span><br><span class="line">+---------+---------+</span><br><span class="line">| user_id | page_id |</span><br><span class="line">+---------+---------+</span><br><span class="line">| 1       | 88      |</span><br><span class="line">| 2       | 23      |</span><br><span class="line">| 3       | 24      |</span><br><span class="line">| 4       | 56      |</span><br><span class="line">| 5       | 11      |</span><br><span class="line">| 6       | 33      |</span><br><span class="line">| 2       | 77      |</span><br><span class="line">| 3       | 77      |</span><br><span class="line">| 6       | 88      |</span><br><span class="line">+---------+---------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------------+</span><br><span class="line">| recommended_page |</span><br><span class="line">+------------------+</span><br><span class="line">| 23               |</span><br><span class="line">| 24               |</span><br><span class="line">| 56               |</span><br><span class="line">| 33               |</span><br><span class="line">| 77               |</span><br><span class="line">+------------------+</span><br><span class="line">ç”¨æˆ·1 åŒ ç”¨æˆ·2, 3, 4, 6 æ˜¯æœ‹å‹å…³ç³»ã€‚</span><br><span class="line">æ¨èé¡µé¢ä¸ºï¼š é¡µé¢23 æ¥è‡ªäº ç”¨æˆ·2, é¡µé¢24 æ¥è‡ªäº ç”¨æˆ·3, é¡µé¢56 æ¥è‡ªäº ç”¨æˆ·3 ä»¥åŠ é¡µé¢33 æ¥è‡ªäº ç”¨æˆ·6ã€‚</span><br><span class="line">é¡µé¢77 åŒæ—¶è¢« ç”¨æˆ·2 å’Œ ç”¨æˆ·3 æ¨èã€‚</span><br><span class="line">é¡µé¢88 æ²¡æœ‰è¢«æ¨èï¼Œå› ä¸º ç”¨æˆ·1 å·²ç»å–œæ¬¢äº†å®ƒã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> page_id  recommended_page</span><br><span class="line"><span class="keyword">from</span> Likes</span><br><span class="line"><span class="keyword">where</span> user_id <span class="keyword">in</span>(</span><br><span class="line"><span class="keyword">select</span> if(user1_id<span class="operator">=</span><span class="number">1</span>,user2_id,user1_id) user_id</span><br><span class="line"><span class="keyword">from</span>  Friendship</span><br><span class="line"><span class="keyword">where</span>  user1_id <span class="operator">=</span><span class="number">1</span> <span class="keyword">or</span> user2_id <span class="operator">=</span><span class="number">1</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">and</span> page_id <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> page_id <span class="keyword">from</span> Likes <span class="keyword">where</span> user_id<span class="operator">=</span><span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1270-å‘å…¬å¸CEOæ±‡æŠ¥å·¥ä½œçš„æ‰€æœ‰äºº"><a href="#1270-å‘å…¬å¸CEOæ±‡æŠ¥å·¥ä½œçš„æ‰€æœ‰äºº" class="headerlink" title="1270. å‘å…¬å¸CEOæ±‡æŠ¥å·¥ä½œçš„æ‰€æœ‰äºº"></a><a href="https://leetcode-cn.com/problems/all-people-report-to-the-given-manager/">1270. å‘å…¬å¸CEOæ±‡æŠ¥å·¥ä½œçš„æ‰€æœ‰äºº</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>å‘˜å·¥è¡¨ï¼š<code>Employees</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| employee_id   | int     |</span><br><span class="line">| employee_name | varchar |</span><br><span class="line">| manager_id    | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">employee_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¿™ä¸ªè¡¨ä¸­æ¯ä¸€è¡Œä¸­ï¼Œemployee_id è¡¨ç¤ºèŒå·¥çš„ IDï¼Œemployee_name è¡¨ç¤ºèŒå·¥çš„åå­—ï¼Œmanager_id è¡¨ç¤ºè¯¥èŒå·¥æ±‡æŠ¥å·¥ä½œçš„ç›´çº¿ç»ç†ã€‚</span><br><span class="line">è¿™ä¸ªå…¬å¸ CEO æ˜¯ employee_id = 1 çš„äººã€‚</span><br></pre></td></tr></table></figure><p>ç”¨ SQL æŸ¥è¯¢å‡ºæ‰€æœ‰ç›´æ¥æˆ–é—´æ¥å‘å…¬å¸ CEO æ±‡æŠ¥å·¥ä½œçš„èŒå·¥çš„ employee_id ã€‚</p><p>ç”±äºå…¬å¸è§„æ¨¡è¾ƒå°ï¼Œç»ç†ä¹‹é—´çš„é—´æ¥å…³ç³»ä¸è¶…è¿‡ 3 ä¸ªç»ç†ã€‚</p><p>å¯ä»¥ä»¥ä»»ä½•é¡ºåºè¿”å›çš„ç»“æœï¼Œä¸éœ€è¦å»é‡ã€‚</p><p>æŸ¥è¯¢ç»“æœç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Employees table:</span><br><span class="line">+-------------+---------------+------------+</span><br><span class="line">| employee_id | employee_name | manager_id |</span><br><span class="line">+-------------+---------------+------------+</span><br><span class="line">| 1           | Boss          | 1          |</span><br><span class="line">| 3           | Alice         | 3          |</span><br><span class="line">| 2           | Bob           | 1          |</span><br><span class="line">| 4           | Daniel        | 2          |</span><br><span class="line">| 7           | Luis          | 4          |</span><br><span class="line">| 8           | Jhon          | 3          |</span><br><span class="line">| 9           | Angela        | 8          |</span><br><span class="line">| 77          | Robert        | 1          |</span><br><span class="line">+-------------+---------------+------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-------------+</span><br><span class="line">| employee_id |</span><br><span class="line">+-------------+</span><br><span class="line">| 2           |</span><br><span class="line">| 77          |</span><br><span class="line">| 4           |</span><br><span class="line">| 7           |</span><br><span class="line">+-------------+</span><br><span class="line"></span><br><span class="line">å…¬å¸ CEO çš„ employee_id æ˜¯ 1.</span><br><span class="line">employee_id æ˜¯ 2 å’Œ 77 çš„èŒå‘˜ç›´æ¥æ±‡æŠ¥ç»™å…¬å¸ CEOã€‚</span><br><span class="line">employee_id æ˜¯ 4 çš„èŒå‘˜é—´æ¥æ±‡æŠ¥ç»™å…¬å¸ CEO 4 --&gt; 2 --&gt; 1 ã€‚</span><br><span class="line">employee_id æ˜¯ 7 çš„èŒå‘˜é—´æ¥æ±‡æŠ¥ç»™å…¬å¸ CEO 7 --&gt; 4 --&gt; 2 --&gt; 1 ã€‚</span><br><span class="line">employee_id æ˜¯ 3, 8 ï¼Œ9 çš„èŒå‘˜ä¸ä¼šç›´æ¥æˆ–é—´æ¥çš„æ±‡æŠ¥ç»™å…¬å¸ CEOã€‚ </span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> employee_id</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> a.employee_id</span><br><span class="line"><span class="keyword">from</span> Employees a </span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Employees b <span class="keyword">on</span> a.manager_id <span class="operator">=</span> b.employee_id</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Employees c <span class="keyword">on</span> b.manager_id <span class="operator">=</span> c.employee_id</span><br><span class="line"><span class="keyword">where</span> a.manager_id<span class="operator">=</span><span class="number">1</span> <span class="keyword">or</span> b.manager_id<span class="operator">=</span><span class="number">1</span>  <span class="keyword">or</span> c.manager_id<span class="operator">=</span><span class="number">1</span></span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> employee_id<span class="operator">!=</span><span class="number">1</span></span><br></pre></td></tr></table></figure><h4 id="1280-å­¦ç”Ÿä»¬å‚åŠ å„ç§‘æµ‹è¯•çš„æ¬¡æ•°"><a href="#1280-å­¦ç”Ÿä»¬å‚åŠ å„ç§‘æµ‹è¯•çš„æ¬¡æ•°" class="headerlink" title="1280. å­¦ç”Ÿä»¬å‚åŠ å„ç§‘æµ‹è¯•çš„æ¬¡æ•°"></a><a href="https://leetcode-cn.com/problems/students-and-examinations/">1280. å­¦ç”Ÿä»¬å‚åŠ å„ç§‘æµ‹è¯•çš„æ¬¡æ•°</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>å­¦ç”Ÿè¡¨: <code>Students</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| student_id    | int     |</span><br><span class="line">| student_name  | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">ä¸»é”®ä¸º student_idï¼ˆå­¦ç”ŸIDï¼‰ï¼Œè¯¥è¡¨å†…çš„æ¯ä¸€è¡Œéƒ½è®°å½•æœ‰å­¦æ ¡ä¸€åå­¦ç”Ÿçš„ä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure><p>ç§‘ç›®è¡¨: <code>Subjects</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| subject_name | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">ä¸»é”®ä¸º subject_nameï¼ˆç§‘ç›®åç§°ï¼‰ï¼Œæ¯ä¸€è¡Œè®°å½•å­¦æ ¡çš„ä¸€é—¨ç§‘ç›®åç§°ã€‚</span><br></pre></td></tr></table></figure><p>è€ƒè¯•è¡¨: <code>Examinations</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| student_id   | int     |</span><br><span class="line">| subject_name | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">è¿™å¼ è¡¨å‹æ ¹æ²¡æœ‰ä¸»é”®ï¼Œå¯èƒ½ä¼šæœ‰é‡å¤è¡Œã€‚</span><br><span class="line">å­¦ç”Ÿè¡¨é‡Œçš„ä¸€ä¸ªå­¦ç”Ÿä¿®è¯»ç§‘ç›®è¡¨é‡Œçš„æ¯ä¸€é—¨ç§‘ç›®ï¼Œè€Œè¿™å¼ è€ƒè¯•è¡¨çš„æ¯ä¸€è¡Œè®°å½•å°±è¡¨ç¤ºå­¦ç”Ÿè¡¨é‡Œçš„æŸä¸ªå­¦ç”Ÿå‚åŠ äº†ä¸€æ¬¡ç§‘ç›®è¡¨é‡ŒæŸé—¨ç§‘ç›®çš„æµ‹è¯•ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> a.student_id, a.student_name, b.subject_name, <span class="built_in">COUNT</span>(e.subject_name) <span class="keyword">AS</span> attended_exams</span><br><span class="line"><span class="keyword">FROM</span> Students a <span class="keyword">CROSS</span> <span class="keyword">JOIN</span> Subjects b</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Examinations e <span class="keyword">ON</span> a.student_id <span class="operator">=</span> e.student_id <span class="keyword">AND</span> b.subject_name <span class="operator">=</span> e.subject_name</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> a.student_id, b.subject_name</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> a.student_id, b.subject_name</span><br></pre></td></tr></table></figure><blockquote><p> CROSS JOIN Mysqlä¸­æ²¡æœ‰full outer join     hiveä¸­å¯ä»¥ç”¨</p></blockquote><h4 id="1285-æ‰¾åˆ°è¿ç»­åŒºé—´çš„å¼€å§‹å’Œç»“æŸæ•°å­—"><a href="#1285-æ‰¾åˆ°è¿ç»­åŒºé—´çš„å¼€å§‹å’Œç»“æŸæ•°å­—" class="headerlink" title="1285. æ‰¾åˆ°è¿ç»­åŒºé—´çš„å¼€å§‹å’Œç»“æŸæ•°å­—"></a><a href="https://leetcode-cn.com/problems/find-the-start-and-end-number-of-continuous-ranges/">1285. æ‰¾åˆ°è¿ç»­åŒºé—´çš„å¼€å§‹å’Œç»“æŸæ•°å­—</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>è¡¨ï¼š<code>Logs</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| log_id        | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id æ˜¯ä¸Šè¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">ä¸Šè¡¨çš„æ¯ä¸€è¡ŒåŒ…å«æ—¥å¿—è¡¨ä¸­çš„ä¸€ä¸ª IDã€‚</span><br></pre></td></tr></table></figure><p>åæ¥ä¸€äº› ID ä» <code>Logs</code> è¡¨ä¸­åˆ é™¤ã€‚ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢å¾—åˆ° <code>Logs</code> è¡¨ä¸­çš„è¿ç»­åŒºé—´çš„å¼€å§‹æ•°å­—å’Œç»“æŸæ•°å­—ã€‚</p><p>å°†æŸ¥è¯¢è¡¨æŒ‰ç…§ <code>start_id</code> æ’åºã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Logs è¡¨ï¼š</span><br><span class="line">+------------+</span><br><span class="line">| log_id     |</span><br><span class="line">+------------+</span><br><span class="line">| 1          |</span><br><span class="line">| 2          |</span><br><span class="line">| 3          |</span><br><span class="line">| 7          |</span><br><span class="line">| 8          |</span><br><span class="line">| 10         |</span><br><span class="line">+------------+</span><br><span class="line"></span><br><span class="line">ç»“æœè¡¨ï¼š</span><br><span class="line">+------------+--------------+</span><br><span class="line">| start_id   | end_id       |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| 1          | 3            |</span><br><span class="line">| 7          | 8            |</span><br><span class="line">| 10         | 10           |</span><br><span class="line">+------------+--------------+</span><br><span class="line">ç»“æœè¡¨åº”åŒ…å« Logs è¡¨ä¸­çš„æ‰€æœ‰åŒºé—´ã€‚</span><br><span class="line">ä» 1 åˆ° 3 åœ¨è¡¨ä¸­ã€‚</span><br><span class="line">ä» 4 åˆ° 6 ä¸åœ¨è¡¨ä¸­ã€‚</span><br><span class="line">ä» 7 åˆ° 8 åœ¨è¡¨ä¸­ã€‚</span><br><span class="line">9 ä¸åœ¨è¡¨ä¸­ã€‚</span><br><span class="line">10 åœ¨è¡¨ä¸­ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="built_in">MIN</span>(log_id) start_id,</span><br><span class="line">    <span class="built_in">MAX</span>(log_id) end_id</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    (<span class="keyword">SELECT</span></span><br><span class="line">        log_id, </span><br><span class="line">        log_id <span class="operator">-</span> <span class="built_in">row_number</span>() <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> log_id) <span class="keyword">as</span> diff</span><br><span class="line">    <span class="keyword">FROM</span> Logs) t</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> diff</span><br></pre></td></tr></table></figure><blockquote><p>ç›¸ä¼¼1225é¢˜</p></blockquote><h4 id="1294-ä¸åŒå›½å®¶çš„å¤©æ°”ç±»å‹"><a href="#1294-ä¸åŒå›½å®¶çš„å¤©æ°”ç±»å‹" class="headerlink" title="1294. ä¸åŒå›½å®¶çš„å¤©æ°”ç±»å‹"></a><a href="https://leetcode-cn.com/problems/weather-type-in-each-country/">1294. ä¸åŒå›½å®¶çš„å¤©æ°”ç±»å‹</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>å›½å®¶è¡¨ï¼š<code>Countries</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| country_id    | int     |</span><br><span class="line">| country_name  | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">country_id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¯¥è¡¨çš„æ¯è¡Œæœ‰ country_id å’Œ country_name ä¸¤åˆ—ã€‚</span><br></pre></td></tr></table></figure><p>å¤©æ°”è¡¨ï¼š<code>Weather</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| country_id    | int     |</span><br><span class="line">| weather_state | varchar |</span><br><span class="line">| day           | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(country_id, day) æ˜¯è¯¥è¡¨çš„å¤åˆä¸»é”®ã€‚</span><br><span class="line">è¯¥è¡¨çš„æ¯ä¸€è¡Œè®°å½•äº†æŸä¸ªå›½å®¶æŸä¸€å¤©çš„å¤©æ°”æƒ…å†µã€‚</span><br></pre></td></tr></table></figure><p>å†™ä¸€æ®µ SQL æ¥æ‰¾åˆ°è¡¨ä¸­æ¯ä¸ªå›½å®¶åœ¨ 2019 å¹´ 11 æœˆçš„å¤©æ°”ç±»å‹ã€‚</p><p>å¤©æ°”ç±»å‹çš„å®šä¹‰å¦‚ä¸‹ï¼šå½“ weather_state çš„å¹³å‡å€¼å°äºæˆ–ç­‰äº15è¿”å› <strong>Cold</strong>ï¼Œå½“ weather_state çš„å¹³å‡å€¼å¤§äºæˆ–ç­‰äº 25 è¿”å› <strong>Hot</strong>ï¼Œå¦åˆ™è¿”å› <strong>Warm</strong>ã€‚</p><p>ä½ å¯ä»¥ä»¥ä»»æ„é¡ºåºè¿”å›ä½ çš„æŸ¥è¯¢ç»“æœã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">Countries table:</span><br><span class="line">+------------+--------------+</span><br><span class="line">| country_id | country_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| 2          | USA          |</span><br><span class="line">| 3          | Australia    |</span><br><span class="line">| 7          | Peru         |</span><br><span class="line">| 5          | China        |</span><br><span class="line">| 8          | Morocco      |</span><br><span class="line">| 9          | Spain        |</span><br><span class="line">+------------+--------------+</span><br><span class="line">Weather table:</span><br><span class="line">+------------+---------------+------------+</span><br><span class="line">| country_id | weather_state | day        |</span><br><span class="line">+------------+---------------+------------+</span><br><span class="line">| 2          | 15            | 2019-11-01 |</span><br><span class="line">| 2          | 12            | 2019-10-28 |</span><br><span class="line">| 2          | 12            | 2019-10-27 |</span><br><span class="line">| 3          | -2            | 2019-11-10 |</span><br><span class="line">| 3          | 0             | 2019-11-11 |</span><br><span class="line">| 3          | 3             | 2019-11-12 |</span><br><span class="line">| 5          | 16            | 2019-11-07 |</span><br><span class="line">| 5          | 18            | 2019-11-09 |</span><br><span class="line">| 5          | 21            | 2019-11-23 |</span><br><span class="line">| 7          | 25            | 2019-11-28 |</span><br><span class="line">| 7          | 22            | 2019-12-01 |</span><br><span class="line">| 7          | 20            | 2019-12-02 |</span><br><span class="line">| 8          | 25            | 2019-11-05 |</span><br><span class="line">| 8          | 27            | 2019-11-15 |</span><br><span class="line">| 8          | 31            | 2019-11-25 |</span><br><span class="line">| 9          | 7             | 2019-10-23 |</span><br><span class="line">| 9          | 3             | 2019-12-23 |</span><br><span class="line">+------------+---------------+------------+</span><br><span class="line">Result table:</span><br><span class="line">+--------------+--------------+</span><br><span class="line">| country_name | weather_type |</span><br><span class="line">+--------------+--------------+</span><br><span class="line">| USA          | Cold         |</span><br><span class="line">| Austraila    | Cold         |</span><br><span class="line">| Peru         | Hot          |</span><br><span class="line">| China        | Warm         |</span><br><span class="line">| Morocco      | Hot          |</span><br><span class="line">+--------------+--------------+</span><br><span class="line">USA 11 æœˆçš„å¹³å‡ weather_state ä¸º (15) / 1 = 15 æ‰€ä»¥å¤©æ°”ç±»å‹ä¸º Coldã€‚</span><br><span class="line">Australia 11 æœˆçš„å¹³å‡ weather_state ä¸º (-2 + 0 + 3) / 3 = 0.333 æ‰€ä»¥å¤©æ°”ç±»å‹ä¸º Coldã€‚</span><br><span class="line">Peru 11 æœˆçš„å¹³å‡ weather_state ä¸º (25) / 1 = 25 æ‰€ä»¥å¤©æ°”ç±»å‹ä¸º Hotã€‚</span><br><span class="line">China 11 æœˆçš„å¹³å‡ weather_state ä¸º (16 + 18 + 21) / 3 = 18.333 æ‰€ä»¥å¤©æ°”ç±»å‹ä¸º Warmã€‚</span><br><span class="line">Morocco 11 æœˆçš„å¹³å‡ weather_state ä¸º (25 + 27 + 31) / 3 = 27.667 æ‰€ä»¥å¤©æ°”ç±»å‹ä¸º Hotã€‚</span><br><span class="line">æˆ‘ä»¬å¹¶ä¸çŸ¥é“ Spain åœ¨ 11 æœˆçš„ weather_state æƒ…å†µæ‰€ä»¥æ— éœ€å°†ä»–åŒ…å«åœ¨ç»“æœä¸­ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> country_name,( <span class="keyword">case</span> <span class="keyword">when</span> <span class="built_in">avg</span>(weather_state)<span class="operator">&lt;=</span><span class="number">15</span> <span class="keyword">then</span> <span class="string">&#x27;Cold&#x27;</span></span><br><span class="line">                        <span class="keyword">when</span> <span class="built_in">avg</span>(weather_state)<span class="operator">&gt;=</span><span class="number">25</span> <span class="keyword">then</span> <span class="string">&#x27;Hot&#x27;</span></span><br><span class="line">                        <span class="keyword">else</span> <span class="string">&#x27;Warm&#x27;</span> <span class="keyword">end</span> ) weather_type</span><br><span class="line"><span class="keyword">from</span> Countries c <span class="keyword">join</span> Weather w <span class="keyword">on</span> c.country_id <span class="operator">=</span> w.country_id</span><br><span class="line"><span class="keyword">where</span> date_format(<span class="keyword">day</span>,&quot;%Y-%m&quot;)<span class="operator">=</span><span class="string">&#x27;2019-11&#x27;</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> country_name</span><br></pre></td></tr></table></figure><h4 id="1303-æ±‚å›¢é˜Ÿäººæ•°"><a href="#1303-æ±‚å›¢é˜Ÿäººæ•°" class="headerlink" title="1303. æ±‚å›¢é˜Ÿäººæ•°"></a><a href="https://leetcode-cn.com/problems/find-the-team-size/">1303. æ±‚å›¢é˜Ÿäººæ•°</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>å‘˜å·¥è¡¨ï¼š<code>Employee</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| employee_id   | int     |</span><br><span class="line">| team_id       | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">employee_id å­—æ®µæ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ï¼Œè¡¨ä¸­çš„æ¯ä¸€è¡Œéƒ½åŒ…å«æ¯ä¸ªå‘˜å·¥çš„ ID å’Œä»–ä»¬æ‰€å±çš„å›¢é˜Ÿã€‚</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œä»¥æ±‚å¾—æ¯ä¸ªå‘˜å·¥æ‰€åœ¨å›¢é˜Ÿçš„æ€»äººæ•°ã€‚</p><p>æŸ¥è¯¢ç»“æœä¸­çš„é¡ºåºæ— ç‰¹å®šè¦æ±‚ã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Employee Table:</span><br><span class="line">+-------------+------------+</span><br><span class="line">| employee_id | team_id    |</span><br><span class="line">+-------------+------------+</span><br><span class="line">|     1       |     8      |</span><br><span class="line">|     2       |     8      |</span><br><span class="line">|     3       |     8      |</span><br><span class="line">|     4       |     7      |</span><br><span class="line">|     5       |     9      |</span><br><span class="line">|     6       |     9      |</span><br><span class="line">+-------------+------------+</span><br><span class="line">Result table:</span><br><span class="line">+-------------+------------+</span><br><span class="line">| employee_id | team_size  |</span><br><span class="line">+-------------+------------+</span><br><span class="line">|     1       |     3      |</span><br><span class="line">|     2       |     3      |</span><br><span class="line">|     3       |     3      |</span><br><span class="line">|     4       |     1      |</span><br><span class="line">|     5       |     2      |</span><br><span class="line">|     6       |     2      |</span><br><span class="line">+-------------+------------+</span><br><span class="line">ID ä¸º 1ã€2ã€3 çš„å‘˜å·¥æ˜¯ team_id ä¸º 8 çš„å›¢é˜Ÿçš„æˆå‘˜ï¼Œ</span><br><span class="line">ID ä¸º 4 çš„å‘˜å·¥æ˜¯ team_id ä¸º 7 çš„å›¢é˜Ÿçš„æˆå‘˜ï¼Œ</span><br><span class="line">ID ä¸º 5ã€6 çš„å‘˜å·¥æ˜¯ team_id ä¸º 9 çš„å›¢é˜Ÿçš„æˆå‘˜ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> employee_id,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> team_id) team_size </span><br><span class="line"><span class="keyword">from</span> Employee</span><br></pre></td></tr></table></figure><h4 id="1308-ä¸åŒæ€§åˆ«æ¯æ—¥åˆ†æ•°æ€»è®¡"><a href="#1308-ä¸åŒæ€§åˆ«æ¯æ—¥åˆ†æ•°æ€»è®¡" class="headerlink" title="1308. ä¸åŒæ€§åˆ«æ¯æ—¥åˆ†æ•°æ€»è®¡"></a><a href="https://leetcode-cn.com/problems/running-total-for-different-genders/">1308. ä¸åŒæ€§åˆ«æ¯æ—¥åˆ†æ•°æ€»è®¡</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>è¡¨: <code>Scores</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| player_name   | varchar |</span><br><span class="line">| gender        | varchar |</span><br><span class="line">| day           | date    |</span><br><span class="line">| score_points  | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(gender, day)æ˜¯è¯¥è¡¨çš„ä¸»é”®</span><br><span class="line">ä¸€åœºæ¯”èµ›æ˜¯åœ¨å¥³é˜Ÿå’Œç”·é˜Ÿä¹‹é—´ä¸¾è¡Œçš„</span><br><span class="line">è¯¥è¡¨çš„æ¯ä¸€è¡Œè¡¨ç¤ºä¸€ä¸ªåå« (player_name) æ€§åˆ«ä¸º (gender) çš„å‚èµ›è€…åœ¨æŸä¸€å¤©è·å¾—äº† (score_points) çš„åˆ†æ•°</span><br><span class="line">å¦‚æœå‚èµ›è€…æ˜¯å¥³æ€§ï¼Œé‚£ä¹ˆ gender åˆ—ä¸º &#x27;F&#x27;ï¼Œå¦‚æœå‚èµ›è€…æ˜¯ç”·æ€§ï¼Œé‚£ä¹ˆ gender åˆ—ä¸º &#x27;M&#x27;</span><br></pre></td></tr></table></figure><p>å†™ä¸€æ¡SQLè¯­å¥æŸ¥è¯¢æ¯ç§æ€§åˆ«åœ¨æ¯ä¸€å¤©çš„æ€»åˆ†ï¼Œå¹¶æŒ‰æ€§åˆ«å’Œæ—¥æœŸå¯¹æŸ¥è¯¢ç»“æœæ’åº</p><p>ä¸‹é¢æ˜¯æŸ¥è¯¢ç»“æœæ ¼å¼çš„ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Scoresè¡¨:</span><br><span class="line">+-------------+--------+------------+--------------+</span><br><span class="line">| player_name | gender | day        | score_points |</span><br><span class="line">+-------------+--------+------------+--------------+</span><br><span class="line">| Aron        | F      | 2020-01-01 | 17           |</span><br><span class="line">| Alice       | F      | 2020-01-07 | 23           |</span><br><span class="line">| Bajrang     | M      | 2020-01-07 | 7            |</span><br><span class="line">| Khali       | M      | 2019-12-25 | 11           |</span><br><span class="line">| Slaman      | M      | 2019-12-30 | 13           |</span><br><span class="line">| Joe         | M      | 2019-12-31 | 3            |</span><br><span class="line">| Jose        | M      | 2019-12-18 | 2            |</span><br><span class="line">| Priya       | F      | 2019-12-31 | 23           |</span><br><span class="line">| Priyanka    | F      | 2019-12-30 | 17           |</span><br><span class="line">+-------------+--------+------------+--------------+</span><br><span class="line">ç»“æœè¡¨:</span><br><span class="line">+--------+------------+-------+</span><br><span class="line">| gender | day        | total |</span><br><span class="line">+--------+------------+-------+</span><br><span class="line">| F      | 2019-12-30 | 17    |</span><br><span class="line">| F      | 2019-12-31 | 40    |</span><br><span class="line">| F      | 2020-01-01 | 57    |</span><br><span class="line">| F      | 2020-01-07 | 80    |</span><br><span class="line">| M      | 2019-12-18 | 2     |</span><br><span class="line">| M      | 2019-12-25 | 13    |</span><br><span class="line">| M      | 2019-12-30 | 26    |</span><br><span class="line">| M      | 2019-12-31 | 29    |</span><br><span class="line">| M      | 2020-01-07 | 36    |</span><br><span class="line">+--------+------------+-------+</span><br><span class="line">å¥³æ€§é˜Ÿä¼:</span><br><span class="line">ç¬¬ä¸€å¤©æ˜¯ 2019-12-30ï¼ŒPriyanka è·å¾— 17 åˆ†ï¼Œé˜Ÿä¼çš„æ€»åˆ†æ˜¯ 17 åˆ†</span><br><span class="line">ç¬¬äºŒå¤©æ˜¯ 2019-12-31, Priya è·å¾— 23 åˆ†ï¼Œé˜Ÿä¼çš„æ€»åˆ†æ˜¯ 40 åˆ†</span><br><span class="line">ç¬¬ä¸‰å¤©æ˜¯ 2020-01-01, Aron è·å¾— 17 åˆ†ï¼Œé˜Ÿä¼çš„æ€»åˆ†æ˜¯ 57 åˆ†</span><br><span class="line">ç¬¬å››å¤©æ˜¯ 2020-01-07, Alice è·å¾— 23 åˆ†ï¼Œé˜Ÿä¼çš„æ€»åˆ†æ˜¯ 80 åˆ†</span><br><span class="line">ç”·æ€§é˜Ÿä¼ï¼š</span><br><span class="line">ç¬¬ä¸€å¤©æ˜¯ 2019-12-18, Jose è·å¾— 2 åˆ†ï¼Œé˜Ÿä¼çš„æ€»åˆ†æ˜¯ 2 åˆ†</span><br><span class="line">ç¬¬äºŒå¤©æ˜¯ 2019-12-25, Khali è·å¾— 11 åˆ†ï¼Œé˜Ÿä¼çš„æ€»åˆ†æ˜¯ 13 åˆ†</span><br><span class="line">ç¬¬ä¸‰å¤©æ˜¯ 2019-12-30, Slaman è·å¾— 13 åˆ†ï¼Œé˜Ÿä¼çš„æ€»åˆ†æ˜¯ 26 åˆ†</span><br><span class="line">ç¬¬å››å¤©æ˜¯ 2019-12-31, Joe è·å¾— 3 åˆ†ï¼Œé˜Ÿä¼çš„æ€»åˆ†æ˜¯ 29 åˆ†</span><br><span class="line">ç¬¬äº”å¤©æ˜¯ 2020-01-07, Bajrang è·å¾— 7 åˆ†ï¼Œé˜Ÿä¼çš„æ€»åˆ†æ˜¯ 36 åˆ†</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> gender , <span class="keyword">day</span>  ,<span class="built_in">sum</span>( score_points) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> gender <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">day</span>)  total</span><br><span class="line"><span class="keyword">from</span> Scores </span><br></pre></td></tr></table></figure><h4 id="1321-é¤é¦†è¥ä¸šé¢å˜åŒ–å¢é•¿"><a href="#1321-é¤é¦†è¥ä¸šé¢å˜åŒ–å¢é•¿" class="headerlink" title="1321. é¤é¦†è¥ä¸šé¢å˜åŒ–å¢é•¿"></a><a href="https://leetcode-cn.com/problems/restaurant-growth/">1321. é¤é¦†è¥ä¸šé¢å˜åŒ–å¢é•¿</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>è¡¨: <code>Customer</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">| visited_on    | date    |</span><br><span class="line">| amount        | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(customer_id, visited_on) æ˜¯è¯¥è¡¨çš„ä¸»é”®</span><br><span class="line">è¯¥è¡¨åŒ…å«ä¸€å®¶é¤é¦†çš„é¡¾å®¢äº¤æ˜“æ•°æ®</span><br><span class="line">visited_on è¡¨ç¤º (customer_id) çš„é¡¾å®¢åœ¨ visited_on é‚£å¤©è®¿é—®äº†é¤é¦†</span><br><span class="line">amount æ˜¯ä¸€ä¸ªé¡¾å®¢æŸä¸€å¤©çš„æ¶ˆè´¹æ€»é¢</span><br></pre></td></tr></table></figure><p>ä½ æ˜¯é¤é¦†çš„è€æ¿ï¼Œç°åœ¨ä½ æƒ³åˆ†æä¸€ä¸‹å¯èƒ½çš„è¥ä¸šé¢å˜åŒ–å¢é•¿ï¼ˆæ¯å¤©è‡³å°‘æœ‰ä¸€ä½é¡¾å®¢ï¼‰</p><p>å†™ä¸€æ¡ SQL æŸ¥è¯¢è®¡ç®—ä»¥ 7 å¤©ï¼ˆæŸæ—¥æœŸ + è¯¥æ—¥æœŸå‰çš„ 6 å¤©ï¼‰ä¸ºä¸€ä¸ªæ—¶é—´æ®µçš„é¡¾å®¢æ¶ˆè´¹å¹³å‡å€¼</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼çš„ä¾‹å­å¦‚ä¸‹ï¼š</p><ul><li>æŸ¥è¯¢ç»“æœæŒ‰ <code>visited_on</code> æ’åº</li><li><code>average_amount</code> è¦ <strong>ä¿ç•™ä¸¤ä½å°æ•°</strong>ï¼Œæ—¥æœŸæ•°æ®çš„æ ¼å¼ä¸º (â€˜YYYY-MM-DDâ€™)</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Customer è¡¨:</span><br><span class="line">+-------------+--------------+--------------+-------------+</span><br><span class="line">| customer_id | name         | visited_on   | amount      |</span><br><span class="line">+-------------+--------------+--------------+-------------+</span><br><span class="line">| 1           | Jhon         | 2019-01-01   | 100         |</span><br><span class="line">| 2           | Daniel       | 2019-01-02   | 110         |</span><br><span class="line">| 3           | Jade         | 2019-01-03   | 120         |</span><br><span class="line">| 4           | Khaled       | 2019-01-04   | 130         |</span><br><span class="line">| 5           | Winston      | 2019-01-05   | 110         | </span><br><span class="line">| 6           | Elvis        | 2019-01-06   | 140         | </span><br><span class="line">| 7           | Anna         | 2019-01-07   | 150         |</span><br><span class="line">| 8           | Maria        | 2019-01-08   | 80          |</span><br><span class="line">| 9           | Jaze         | 2019-01-09   | 110         | </span><br><span class="line">| 1           | Jhon         | 2019-01-10   | 130         | </span><br><span class="line">| 3           | Jade         | 2019-01-10   | 150         | </span><br><span class="line">+-------------+--------------+--------------+-------------+</span><br><span class="line"></span><br><span class="line">ç»“æœè¡¨:</span><br><span class="line">+--------------+--------------+----------------+</span><br><span class="line">| visited_on   | amount       | average_amount |</span><br><span class="line">+--------------+--------------+----------------+</span><br><span class="line">| 2019-01-07   | 860          | 122.86         |</span><br><span class="line">| 2019-01-08   | 840          | 120            |</span><br><span class="line">| 2019-01-09   | 840          | 120            |</span><br><span class="line">| 2019-01-10   | 1000         | 142.86         |</span><br><span class="line">+--------------+--------------+----------------+</span><br><span class="line"></span><br><span class="line">ç¬¬ä¸€ä¸ªä¸ƒå¤©æ¶ˆè´¹å¹³å‡å€¼ä» 2019-01-01 åˆ° 2019-01-07 æ˜¯ (100 + 110 + 120 + 130 + 110 + 140 + 150)/7 = 122.86</span><br><span class="line">ç¬¬äºŒä¸ªä¸ƒå¤©æ¶ˆè´¹å¹³å‡å€¼ä» 2019-01-02 åˆ° 2019-01-08 æ˜¯ (110 + 120 + 130 + 110 + 140 + 150 + 80)/7 = 120</span><br><span class="line">ç¬¬ä¸‰ä¸ªä¸ƒå¤©æ¶ˆè´¹å¹³å‡å€¼ä» 2019-01-03 åˆ° 2019-01-09 æ˜¯ (120 + 130 + 110 + 140 + 150 + 80 + 110)/7 = 120</span><br><span class="line">ç¬¬å››ä¸ªä¸ƒå¤©æ¶ˆè´¹å¹³å‡å€¼ä» 2019-01-04 åˆ° 2019-01-10 æ˜¯ (130 + 110 + 140 + 150 + 80 + 110 + 130 + 150)/7 = 142.86</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  visited_on,amount,round(amount<span class="operator">/</span><span class="number">7</span>,<span class="number">2</span>) average_amount</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> visited_on,ant,<span class="built_in">lag</span>(visited_on,<span class="number">6</span>,<span class="keyword">null</span>) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> visited_on) lg,</span><br><span class="line">            <span class="built_in">sum</span>(ant) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> visited_on <span class="keyword">rows</span> <span class="keyword">between</span> <span class="number">6</span> PRECEDING <span class="keyword">and</span> <span class="keyword">current</span> <span class="type">row</span>) amount</span><br><span class="line">    <span class="keyword">from</span>(</span><br><span class="line">        <span class="keyword">select</span>  visited_on  ,<span class="built_in">sum</span>(amount) ant</span><br><span class="line">        <span class="keyword">from</span> Customer</span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> visited_on</span><br><span class="line">    )t1</span><br><span class="line">)t2</span><br><span class="line"><span class="keyword">where</span> lg <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br></pre></td></tr></table></figure><h4 id="1322-å¹¿å‘Šæ•ˆæœ"><a href="#1322-å¹¿å‘Šæ•ˆæœ" class="headerlink" title="1322. å¹¿å‘Šæ•ˆæœ"></a><a href="https://leetcode-cn.com/problems/ads-performance/">1322. å¹¿å‘Šæ•ˆæœ</a></h4><p>éš¾åº¦ç®€å•8æ”¶è—åˆ†äº«åˆ‡æ¢ä¸ºè‹±æ–‡å…³æ³¨åé¦ˆ</p><p>SQLæ¶æ„</p><p>è¡¨: <code>Ads</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| ad_id         | int     |</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| action        | enum    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(ad_id, user_id) æ˜¯è¯¥è¡¨çš„ä¸»é”®</span><br><span class="line">è¯¥è¡¨çš„æ¯ä¸€è¡ŒåŒ…å«ä¸€æ¡å¹¿å‘Šçš„ ID(ad_id)ï¼Œç”¨æˆ·çš„ ID(user_id) å’Œç”¨æˆ·å¯¹å¹¿å‘Šé‡‡å–çš„è¡Œä¸º (action)</span><br><span class="line">action åˆ—æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ (&#x27;Clicked&#x27;, &#x27;Viewed&#x27;, &#x27;Ignored&#x27;) ã€‚</span><br></pre></td></tr></table></figure><p>ä¸€å®¶å…¬å¸æ­£åœ¨è¿è¥è¿™äº›å¹¿å‘Šå¹¶æƒ³è®¡ç®—æ¯æ¡å¹¿å‘Šçš„æ•ˆæœã€‚</p><p>å¹¿å‘Šæ•ˆæœç”¨ç‚¹å‡»é€šè¿‡ç‡ï¼ˆClick-Through Rateï¼šCTRï¼‰æ¥è¡¡é‡ï¼Œå…¬å¼å¦‚ä¸‹:</p><p><img src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/03/06/sql1.png" alt="img"></p><p>å†™ä¸€æ¡SQLè¯­å¥æ¥æŸ¥è¯¢æ¯ä¸€æ¡å¹¿å‘Šçš„ <code>ctr</code> ï¼Œ</p><p> <code>ctr</code> è¦ä¿ç•™ä¸¤ä½å°æ•°ã€‚ç»“æœéœ€è¦æŒ‰ <code>ctr</code> <strong>é™åº</strong>ã€æŒ‰ <code>ad_id</code> <strong>å‡åº</strong> è¿›è¡Œæ’åºã€‚</p><p>æŸ¥è¯¢ç»“æœç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Ads è¡¨:</span><br><span class="line">+-------+---------+---------+</span><br><span class="line">| ad_id | user_id | action  |</span><br><span class="line">+-------+---------+---------+</span><br><span class="line">| 1     | 1       | Clicked |</span><br><span class="line">| 2     | 2       | Clicked |</span><br><span class="line">| 3     | 3       | Viewed  |</span><br><span class="line">| 5     | 5       | Ignored |</span><br><span class="line">| 1     | 7       | Ignored |</span><br><span class="line">| 2     | 7       | Viewed  |</span><br><span class="line">| 3     | 5       | Clicked |</span><br><span class="line">| 1     | 4       | Viewed  |</span><br><span class="line">| 2     | 11      | Viewed  |</span><br><span class="line">| 1     | 2       | Clicked |</span><br><span class="line">+-------+---------+---------+</span><br><span class="line">ç»“æœè¡¨:</span><br><span class="line">+-------+-------+</span><br><span class="line">| ad_id | ctr   |</span><br><span class="line">+-------+-------+</span><br><span class="line">| 1     | 66.67 |</span><br><span class="line">| 3     | 50.00 |</span><br><span class="line">| 2     | 33.33 |</span><br><span class="line">| 5     | 0.00  |</span><br><span class="line">+-------+-------+</span><br><span class="line">å¯¹äº ad_id = 1, ctr = (2/(2+1)) * 100 = 66.67</span><br><span class="line">å¯¹äº ad_id = 2, ctr = (1/(1+2)) * 100 = 33.33</span><br><span class="line">å¯¹äº ad_id = 3, ctr = (1/(1+1)) * 100 = 50.00</span><br><span class="line">å¯¹äº ad_id = 5, ctr = 0.00, æ³¨æ„ ad_id = 5 æ²¡æœ‰è¢«ç‚¹å‡» (Clicked) æˆ–æŸ¥çœ‹ (Viewed) è¿‡</span><br><span class="line">æ³¨æ„æˆ‘ä»¬ä¸å…³å¿ƒ action ä¸º Ingnored çš„å¹¿å‘Š</span><br><span class="line">ç»“æœæŒ‰ ctrï¼ˆé™åºï¼‰ï¼Œad_idï¼ˆå‡åºï¼‰æ’åº</span><br></pre></td></tr></table></figure><p>ç²¾ç®€</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ad_id,</span><br><span class="line">    ROUND(IFNULL(<span class="built_in">SUM</span>(action <span class="operator">=</span> <span class="string">&#x27;Clicked&#x27;</span>) <span class="operator">/</span></span><br><span class="line">        (<span class="built_in">SUM</span>(action <span class="operator">=</span> <span class="string">&#x27;Clicked&#x27;</span>) <span class="operator">+</span> <span class="built_in">SUM</span>(action <span class="operator">=</span> <span class="string">&#x27;Viewed&#x27;</span>)) <span class="operator">*</span> <span class="number">100</span>, <span class="number">0</span>), <span class="number">2</span>) <span class="keyword">AS</span> ctr</span><br><span class="line"><span class="keyword">FROM</span> Ads</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> ad_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> ctr <span class="keyword">DESC</span>, ad_id <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure><p>ç¬¨æ–¹æ³•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.ad_id,ifnull(ctr,<span class="number">0</span>) ctr</span><br><span class="line"><span class="keyword">from</span> Ads a</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> (</span><br><span class="line">    <span class="keyword">select</span> ad_id,round(<span class="built_in">sum</span>(if(action<span class="operator">=</span><span class="string">&#x27;Clicked&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>))<span class="operator">/</span><span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">*</span><span class="number">100</span>,<span class="number">2</span>) ctr </span><br><span class="line">    <span class="keyword">from</span> Ads </span><br><span class="line">    <span class="keyword">where</span> action <span class="operator">!=</span><span class="string">&#x27;Ignored&#x27;</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> ad_id</span><br><span class="line">)t1 </span><br><span class="line"><span class="keyword">on</span> a.ad_id<span class="operator">=</span> t1.ad_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> ad_id,ctr</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> ctr <span class="keyword">desc</span>,ad_id</span><br></pre></td></tr></table></figure><h4 id="1327-åˆ—å‡ºæŒ‡å®šæ—¶é—´æ®µå†…æ‰€æœ‰çš„ä¸‹å•äº§å“"><a href="#1327-åˆ—å‡ºæŒ‡å®šæ—¶é—´æ®µå†…æ‰€æœ‰çš„ä¸‹å•äº§å“" class="headerlink" title="1327. åˆ—å‡ºæŒ‡å®šæ—¶é—´æ®µå†…æ‰€æœ‰çš„ä¸‹å•äº§å“"></a><a href="https://leetcode-cn.com/problems/list-the-products-ordered-in-a-period/">1327. åˆ—å‡ºæŒ‡å®šæ—¶é—´æ®µå†…æ‰€æœ‰çš„ä¸‹å•äº§å“</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>è¡¨: <code>Products</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+------------------+---------+</span><br><span class="line">| Column Name      | Type    |</span><br><span class="line">+------------------+---------+</span><br><span class="line">| product_id       | int     |</span><br><span class="line">| product_name     | varchar |</span><br><span class="line">| product_category | varchar |</span><br><span class="line">+------------------+---------+</span><br><span class="line">product_id æ˜¯è¯¥è¡¨ä¸»é”®ã€‚</span><br><span class="line">è¯¥è¡¨åŒ…å«è¯¥å…¬å¸äº§å“çš„æ•°æ®ã€‚</span><br></pre></td></tr></table></figure><p>è¡¨: <code>Orders</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| order_date    | date    |</span><br><span class="line">| unit          | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">è¯¥è¡¨æ— ä¸»é”®ï¼Œå¯èƒ½åŒ…å«é‡å¤è¡Œã€‚</span><br><span class="line">product_id æ˜¯è¡¨å• Products çš„å¤–é”®ã€‚</span><br><span class="line">unit æ˜¯åœ¨æ—¥æœŸ order_date å†…ä¸‹å•äº§å“çš„æ•°ç›®ã€‚</span><br></pre></td></tr></table></figure><p>å†™ä¸€ä¸ª SQL è¯­å¥ï¼Œè¦æ±‚è·å–åœ¨ 2020 å¹´ 2 æœˆä»½ä¸‹å•çš„æ•°é‡ä¸å°‘äº 100 çš„äº§å“çš„åå­—å’Œæ•°ç›®ã€‚</p><p>è¿”å›ç»“æœè¡¨å•çš„é¡ºåºæ— è¦æ±‚ã€‚</p><p>æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">Products è¡¨:</span><br><span class="line">+-------------+-----------------------+------------------+</span><br><span class="line">| product_id  | product_name          | product_category |</span><br><span class="line">+-------------+-----------------------+------------------+</span><br><span class="line">| 1           | Leetcode Solutions    | Book             |</span><br><span class="line">| 2           | Jewels of Stringology | Book             |</span><br><span class="line">| 3           | HP                    | Laptop           |</span><br><span class="line">| 4           | Lenovo                | Laptop           |</span><br><span class="line">| 5           | Leetcode Kit          | T-shirt          |</span><br><span class="line">+-------------+-----------------------+------------------+</span><br><span class="line"></span><br><span class="line">Orders è¡¨:</span><br><span class="line">+--------------+--------------+----------+</span><br><span class="line">| product_id   | order_date   | unit     |</span><br><span class="line">+--------------+--------------+----------+</span><br><span class="line">| 1            | 2020-02-05   | 60       |</span><br><span class="line">| 1            | 2020-02-10   | 70       |</span><br><span class="line">| 2            | 2020-01-18   | 30       |</span><br><span class="line">| 2            | 2020-02-11   | 80       |</span><br><span class="line">| 3            | 2020-02-17   | 2        |</span><br><span class="line">| 3            | 2020-02-24   | 3        |</span><br><span class="line">| 4            | 2020-03-01   | 20       |</span><br><span class="line">| 4            | 2020-03-04   | 30       |</span><br><span class="line">| 4            | 2020-03-04   | 60       |</span><br><span class="line">| 5            | 2020-02-25   | 50       |</span><br><span class="line">| 5            | 2020-02-27   | 50       |</span><br><span class="line">| 5            | 2020-03-01   | 50       |</span><br><span class="line">+--------------+--------------+----------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+--------------------+---------+</span><br><span class="line">| product_name       | unit    |</span><br><span class="line">+--------------------+---------+</span><br><span class="line">| Leetcode Solutions | 130     |</span><br><span class="line">| Leetcode Kit       | 100     |</span><br><span class="line">+--------------------+---------+</span><br><span class="line"></span><br><span class="line">2020 å¹´ 2 æœˆä»½ä¸‹å• product_id = 1 çš„äº§å“çš„æ•°ç›®æ€»å’Œä¸º (60 + 70) = 130 ã€‚</span><br><span class="line">2020 å¹´ 2 æœˆä»½ä¸‹å• product_id = 2 çš„äº§å“çš„æ•°ç›®æ€»å’Œä¸º 80 ã€‚</span><br><span class="line">2020 å¹´ 2 æœˆä»½ä¸‹å• product_id = 3 çš„äº§å“çš„æ•°ç›®æ€»å’Œä¸º (2 + 3) = 5 ã€‚</span><br><span class="line">2020 å¹´ 2 æœˆä»½ product_id = 4 çš„äº§å“å¹¶æ²¡æœ‰ä¸‹å•ã€‚</span><br><span class="line">2020 å¹´ 2 æœˆä»½ä¸‹å• product_id = 5 çš„äº§å“çš„æ•°ç›®æ€»å’Œä¸º (50 + 50) = 100 ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> product_name,<span class="built_in">sum</span>(unit) unit </span><br><span class="line"><span class="keyword">from</span> Orders o <span class="keyword">left</span> <span class="keyword">join</span> Products p</span><br><span class="line"><span class="keyword">on</span> o.product_id<span class="operator">=</span>p.product_id</span><br><span class="line"><span class="keyword">where</span> date_format(order_date,<span class="string">&#x27;%Y-%m&#x27;</span>)<span class="operator">=</span><span class="string">&#x27;2020-02&#x27;</span> </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> product_name</span><br><span class="line"><span class="keyword">having</span> unit<span class="operator">&gt;=</span><span class="number">100</span></span><br></pre></td></tr></table></figure><h4 id="1336-æ¯æ¬¡è®¿é—®çš„äº¤æ˜“æ¬¡æ•°"><a href="#1336-æ¯æ¬¡è®¿é—®çš„äº¤æ˜“æ¬¡æ•°" class="headerlink" title="1336. æ¯æ¬¡è®¿é—®çš„äº¤æ˜“æ¬¡æ•°"></a><a href="https://leetcode-cn.com/problems/number-of-transactions-per-visit/">1336. æ¯æ¬¡è®¿é—®çš„äº¤æ˜“æ¬¡æ•°</a></h4><p>éš¾åº¦å›°éš¾</p><p>SQLæ¶æ„</p><p>è¡¨: <code>Visits</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| visit_date    | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(user_id, visit_date) æ˜¯è¯¥è¡¨çš„ä¸»é”®</span><br><span class="line">è¯¥è¡¨çš„æ¯è¡Œè¡¨ç¤º user_id åœ¨ visit_date è®¿é—®äº†é“¶è¡Œ</span><br></pre></td></tr></table></figure><p>è¡¨: <code>Transactions</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+------------------+---------+</span><br><span class="line">| Column Name      | Type    |</span><br><span class="line">+------------------+---------+</span><br><span class="line">| user_id          | int     |</span><br><span class="line">| transaction_date | date    |</span><br><span class="line">| amount           | int     |</span><br><span class="line">+------------------+---------+</span><br><span class="line">è¯¥è¡¨æ²¡æœ‰ä¸»é”®ï¼Œæ‰€ä»¥å¯èƒ½æœ‰é‡å¤è¡Œ</span><br><span class="line">è¯¥è¡¨çš„æ¯ä¸€è¡Œè¡¨ç¤º user_id åœ¨ transaction_date å®Œæˆäº†ä¸€ç¬” amount æ•°é¢çš„äº¤æ˜“</span><br><span class="line">å¯ä»¥ä¿è¯ç”¨æˆ· (user) åœ¨ transaction_date è®¿é—®äº†é“¶è¡Œ (ä¹Ÿå°±æ˜¯è¯´ Visits è¡¨åŒ…å« (user_id, transaction_date) è¡Œ)</span><br></pre></td></tr></table></figure><p>é“¶è¡Œæƒ³è¦å¾—åˆ°é“¶è¡Œå®¢æˆ·åœ¨ä¸€æ¬¡è®¿é—®æ—¶çš„äº¤æ˜“æ¬¡æ•°å’Œç›¸åº”çš„åœ¨ä¸€æ¬¡è®¿é—®æ—¶è¯¥äº¤æ˜“æ¬¡æ•°çš„å®¢æˆ·æ•°é‡çš„å›¾è¡¨</p><p>å†™ä¸€æ¡ SQL æŸ¥è¯¢å¤šå°‘å®¢æˆ·è®¿é—®äº†é“¶è¡Œä½†æ²¡æœ‰è¿›è¡Œä»»ä½•äº¤æ˜“ï¼Œå¤šå°‘å®¢æˆ·è®¿é—®äº†é“¶è¡Œè¿›è¡Œäº†ä¸€æ¬¡äº¤æ˜“ç­‰ç­‰</p><p>ç»“æœåŒ…å«ä¸¤åˆ—ï¼š</p><ul><li><code>transactions_countï¼š</code> å®¢æˆ·åœ¨ä¸€æ¬¡è®¿é—®ä¸­çš„äº¤æ˜“æ¬¡æ•°</li><li><code>visits_countï¼š</code> åœ¨ <code>transactions_count</code> äº¤æ˜“æ¬¡æ•°ä¸‹ç›¸åº”çš„ä¸€æ¬¡è®¿é—®æ—¶çš„å®¢æˆ·æ•°é‡</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transactions_count` çš„å€¼ä» `0` åˆ°æ‰€æœ‰ç”¨æˆ·ä¸€æ¬¡è®¿é—®ä¸­çš„ `max(transactions_count)</span><br></pre></td></tr></table></figure><p>æŒ‰ <code>transactions_count</code> æ’åº</p><p>ä¸‹é¢æ˜¯æŸ¥è¯¢ç»“æœæ ¼å¼çš„ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">Visits è¡¨:</span><br><span class="line">+---------+------------+</span><br><span class="line">| user_id | visit_date |</span><br><span class="line">+---------+------------+</span><br><span class="line">| 1       | 2020-01-01 |</span><br><span class="line">| 2       | 2020-01-02 |</span><br><span class="line">| 12      | 2020-01-01 |</span><br><span class="line">| 19      | 2020-01-03 |</span><br><span class="line">| 1       | 2020-01-02 |</span><br><span class="line">| 2       | 2020-01-03 |</span><br><span class="line">| 1       | 2020-01-04 |</span><br><span class="line">| 7       | 2020-01-11 |</span><br><span class="line">| 9       | 2020-01-25 |</span><br><span class="line">| 8       | 2020-01-28 |</span><br><span class="line">+---------+------------+</span><br><span class="line">Transactions è¡¨:</span><br><span class="line">+---------+------------------+--------+</span><br><span class="line">| user_id | transaction_date | amount |</span><br><span class="line">+---------+------------------+--------+</span><br><span class="line">| 1       | 2020-01-02       | 120    |</span><br><span class="line">| 2       | 2020-01-03       | 22     |</span><br><span class="line">| 7       | 2020-01-11       | 232    |</span><br><span class="line">| 1       | 2020-01-04       | 7      |</span><br><span class="line">| 9       | 2020-01-25       | 33     |</span><br><span class="line">| 9       | 2020-01-25       | 66     |</span><br><span class="line">| 8       | 2020-01-28       | 1      |</span><br><span class="line">| 9       | 2020-01-25       | 99     |</span><br><span class="line">+---------+------------------+--------+</span><br><span class="line">ç»“æœè¡¨:</span><br><span class="line">+--------------------+--------------+</span><br><span class="line">| transactions_count | visits_count |</span><br><span class="line">+--------------------+--------------+</span><br><span class="line">| 0                  | 4            |</span><br><span class="line">| 1                  | 5            |</span><br><span class="line">| 2                  | 0            |</span><br><span class="line">| 3                  | 1            |</span><br><span class="line">+--------------------+--------------+</span><br><span class="line">* å¯¹äº transactions_count = 0, visits ä¸­ (1, &quot;2020-01-01&quot;), (2, &quot;2020-01-02&quot;), (12, &quot;2020-01-01&quot;) å’Œ (19, &quot;2020-01-03&quot;) æ²¡æœ‰è¿›è¡Œäº¤æ˜“ï¼Œæ‰€ä»¥ visits_count = 4 ã€‚</span><br><span class="line">* å¯¹äº transactions_count = 1, visits ä¸­ (2, &quot;2020-01-03&quot;), (7, &quot;2020-01-11&quot;), (8, &quot;2020-01-28&quot;), (1, &quot;2020-01-02&quot;) å’Œ (1, &quot;2020-01-04&quot;) è¿›è¡Œäº†ä¸€æ¬¡äº¤æ˜“ï¼Œæ‰€ä»¥ visits_count = 5 ã€‚</span><br><span class="line">* å¯¹äº transactions_count = 2, æ²¡æœ‰å®¢æˆ·è®¿é—®é“¶è¡Œè¿›è¡Œäº†ä¸¤æ¬¡äº¤æ˜“ï¼Œæ‰€ä»¥ visits_count = 0 ã€‚</span><br><span class="line">* å¯¹äº transactions_count = 3, visits ä¸­ (9, &quot;2020-01-25&quot;) è¿›è¡Œäº†ä¸‰æ¬¡äº¤æ˜“ï¼Œæ‰€ä»¥ visits_count = 1 ã€‚</span><br><span class="line">* å¯¹äº transactions_count &gt;= 4, æ²¡æœ‰å®¢æˆ·è®¿é—®é“¶è¡Œè¿›è¡Œäº†è¶…è¿‡3æ¬¡äº¤æ˜“ï¼Œæ‰€ä»¥æˆ‘ä»¬åœæ­¢åœ¨ transactions_count = 3 ã€‚</span><br><span class="line"></span><br><span class="line">å¦‚ä¸‹æ˜¯è¿™ä¸ªä¾‹å­çš„å›¾è¡¨ï¼š</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">SELECT</span> t5.rnb <span class="keyword">AS</span> transactions_count, IFNULL(visits_count, <span class="number">0</span>) <span class="keyword">AS</span> visits_count</span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="number">0</span> <span class="keyword">AS</span> rnb</span><br><span class="line">        <span class="keyword">UNION</span></span><br><span class="line">        <span class="keyword">SELECT</span> <span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span> () <span class="keyword">AS</span> rnb</span><br><span class="line">        <span class="keyword">FROM</span> Transactions</span><br><span class="line">    ) t5</span><br><span class="line">    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">SELECT</span></span><br><span class="line">            cnt <span class="keyword">AS</span> transactions_count</span><br><span class="line">            ,<span class="built_in">COUNT</span>(user_id) <span class="keyword">AS</span> visits_count</span><br><span class="line">        <span class="keyword">FROM</span></span><br><span class="line">        (</span><br><span class="line">            <span class="keyword">SELECT</span> t1.user_id, <span class="built_in">COUNT</span>(t2.amount) <span class="keyword">AS</span> cnt</span><br><span class="line">            <span class="keyword">FROM</span> Visits t1</span><br><span class="line">            <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Transactions t2</span><br><span class="line">            <span class="keyword">ON</span> t1.user_id <span class="operator">=</span> t2.user_id <span class="keyword">AND</span> t1.visit_date <span class="operator">=</span> t2.transaction_date</span><br><span class="line">            <span class="keyword">GROUP</span> <span class="keyword">BY</span> user_id, visit_date</span><br><span class="line">        ) t3</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> cnt</span><br><span class="line">    ) t4</span><br><span class="line">    <span class="keyword">ON</span> t5.rnb <span class="operator">=</span> t4.transactions_count</span><br><span class="line">) t6</span><br><span class="line"><span class="keyword">WHERE</span> transactions_count <span class="operator">&lt;=</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(t2.amount) <span class="keyword">AS</span> cnt</span><br><span class="line">    <span class="keyword">FROM</span> Visits t1</span><br><span class="line">    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Transactions t2</span><br><span class="line">    <span class="keyword">ON</span> t1.user_id <span class="operator">=</span> t2.user_id <span class="keyword">AND</span> t1.visit_date <span class="operator">=</span> t2.transaction_date</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> t1.user_id, visit_date</span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> cnt <span class="keyword">DESC</span></span><br><span class="line">    LIMIT <span class="number">1</span>)</span><br></pre></td></tr></table></figure><blockquote><p>éš¾ç‚¹ ä»0è‡ªå¢åºåˆ—ï¼Œ2äº¤æ˜“çš„äººæ•°ä¸º0</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> pcnt transactions_count,<span class="built_in">count</span>(<span class="operator">*</span>) visits_count</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span> visit_date,</span><br><span class="line">        <span class="built_in">sum</span>(if(amount <span class="keyword">is</span>  <span class="keyword">null</span>,<span class="number">0</span>,<span class="number">1</span>)) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> transaction_date ) pcnt,</span><br><span class="line">        <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span>  visit_date ) tcnt</span><br><span class="line"><span class="keyword">from</span> Visits v <span class="keyword">left</span> <span class="keyword">join</span> Transactions t</span><br><span class="line"><span class="keyword">on</span> v.user_id<span class="operator">=</span> t.user_id <span class="keyword">and</span> v.visit_date<span class="operator">=</span>t.transaction_date</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> pcnt</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå¾—å‡ºç»“æœæ˜¯[0, 4], [1, 5], [3, 3] å°‘äº†[2,0] è¿˜æ²¡æƒ³åˆ°ä»€ä¹ˆå¥½åŠæ³•èƒ½æŠŠ[2ï¼Œ0]åŠ è¿›å»ã€‚ã€‚ã€‚</p><h4 id="1341-ç”µå½±è¯„åˆ†"><a href="#1341-ç”µå½±è¯„åˆ†" class="headerlink" title="1341. ç”µå½±è¯„åˆ†"></a><a href="https://leetcode-cn.com/problems/movie-rating/">1341. ç”µå½±è¯„åˆ†</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>è¡¨ï¼š<code>Movies</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| movie_id      | int     |</span><br><span class="line">| title         | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">movie_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">title æ˜¯ç”µå½±çš„åå­—ã€‚</span><br></pre></td></tr></table></figure><p>è¡¨ï¼š<code>Users</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">user_id æ˜¯è¡¨çš„ä¸»é”®ã€‚</span><br></pre></td></tr></table></figure><p>è¡¨ï¼š<code>Movie_Rating</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| movie_id      | int     |</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| rating        | int     |</span><br><span class="line">| created_at    | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(movie_id, user_id) æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¿™ä¸ªè¡¨åŒ…å«ç”¨æˆ·åœ¨å…¶è¯„è®ºä¸­å¯¹ç”µå½±çš„è¯„åˆ† rating ã€‚</span><br><span class="line">created_at æ˜¯ç”¨æˆ·çš„ç‚¹è¯„æ—¥æœŸã€‚ </span><br></pre></td></tr></table></figure><p>è¯·ä½ ç¼–å†™ä¸€ç»„ SQL æŸ¥è¯¢ï¼š</p><ul><li><p>æŸ¥æ‰¾è¯„è®ºç”µå½±æ•°é‡æœ€å¤šçš„ç”¨æˆ·åã€‚</p><p>å¦‚æœå‡ºç°å¹³å±€ï¼Œè¿”å›å­—å…¸åºè¾ƒå°çš„ç”¨æˆ·åã€‚</p></li><li><p>æŸ¥æ‰¾åœ¨</p><p>2020 å¹´ 2 æœˆ å¹³å‡è¯„åˆ†æœ€é«˜</p><p>çš„ç”µå½±åç§°ã€‚</p><p>å¦‚æœå‡ºç°å¹³å±€ï¼Œè¿”å›å­—å…¸åºè¾ƒå°çš„ç”µå½±åç§°ã€‚</p></li></ul><p>æŸ¥è¯¢åˆ†ä¸¤è¡Œè¿”å›ï¼ŒæŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">Movies è¡¨ï¼š</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| movie_id    |  title       |</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| 1           | Avengers     |</span><br><span class="line">| 2           | Frozen 2     |</span><br><span class="line">| 3           | Joker        |</span><br><span class="line">+-------------+--------------+</span><br><span class="line"></span><br><span class="line">Users è¡¨ï¼š</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| user_id     |  name        |</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| 1           | Daniel       |</span><br><span class="line">| 2           | Monica       |</span><br><span class="line">| 3           | Maria        |</span><br><span class="line">| 4           | James        |</span><br><span class="line">+-------------+--------------+</span><br><span class="line"></span><br><span class="line">Movie_Rating è¡¨ï¼š</span><br><span class="line">+-------------+--------------+--------------+-------------+</span><br><span class="line">| movie_id    | user_id      | rating       | created_at  |</span><br><span class="line">+-------------+--------------+--------------+-------------+</span><br><span class="line">| 1           | 1            | 3            | 2020-01-12  |</span><br><span class="line">| 1           | 2            | 4            | 2020-02-11  |</span><br><span class="line">| 1           | 3            | 2            | 2020-02-12  |</span><br><span class="line">| 1           | 4            | 1            | 2020-01-01  |</span><br><span class="line">| 2           | 1            | 5            | 2020-02-17  | </span><br><span class="line">| 2           | 2            | 2            | 2020-02-01  | </span><br><span class="line">| 2           | 3            | 2            | 2020-03-01  |</span><br><span class="line">| 3           | 1            | 3            | 2020-02-22  | </span><br><span class="line">| 3           | 2            | 4            | 2020-02-25  | </span><br><span class="line">+-------------+--------------+--------------+-------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+--------------+</span><br><span class="line">| results      |</span><br><span class="line">+--------------+</span><br><span class="line">| Daniel       |</span><br><span class="line">| Frozen 2     |</span><br><span class="line">+--------------+</span><br><span class="line"></span><br><span class="line">Daniel å’Œ Monica éƒ½ç‚¹è¯„äº† 3 éƒ¨ç”µå½±ï¼ˆ&quot;Avengers&quot;, &quot;Frozen 2&quot; å’Œ &quot;Joker&quot;ï¼‰ ä½†æ˜¯ Daniel å­—å…¸åºæ¯”è¾ƒå°ã€‚</span><br><span class="line">Frozen 2 å’Œ Joker åœ¨ 2 æœˆçš„è¯„åˆ†éƒ½æ˜¯ 3.5ï¼Œä½†æ˜¯ Frozen 2 çš„å­—å…¸åºæ¯”è¾ƒå°ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name results </span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> m.user_id ,u.name </span><br><span class="line">    <span class="keyword">from</span> Movie_Rating m <span class="keyword">left</span> <span class="keyword">join</span> Users u </span><br><span class="line">    <span class="keyword">on</span> m.user_id <span class="operator">=</span> u.user_id</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> user_id</span><br><span class="line">    <span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">desc</span>,name</span><br><span class="line">    limit <span class="number">1</span></span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">union</span> </span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> title results</span><br><span class="line"><span class="keyword">from</span> Movie_Rating r <span class="keyword">left</span> <span class="keyword">join</span> Movies m</span><br><span class="line"><span class="keyword">on</span> r.movie_id <span class="operator">=</span>m.movie_id </span><br><span class="line"><span class="keyword">where</span> date_format(created_at,<span class="string">&#x27;%Y-%m&#x27;</span>)<span class="operator">=</span><span class="string">&#x27;2020-02&#x27;</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> r.movie_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">avg</span>(rating) <span class="keyword">desc</span>,title </span><br><span class="line">limit <span class="number">1</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="1350-é™¢ç³»æ— æ•ˆçš„å­¦ç”Ÿ"><a href="#1350-é™¢ç³»æ— æ•ˆçš„å­¦ç”Ÿ" class="headerlink" title="1350. é™¢ç³»æ— æ•ˆçš„å­¦ç”Ÿ"></a><a href="https://leetcode-cn.com/problems/students-with-invalid-departments/">1350. é™¢ç³»æ— æ•ˆçš„å­¦ç”Ÿ</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>é™¢ç³»è¡¨: <code>Departments</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id æ˜¯è¯¥è¡¨çš„ä¸»é”®</span><br><span class="line">è¯¥è¡¨åŒ…å«ä¸€æ‰€å¤§å­¦æ¯ä¸ªé™¢ç³»çš„ id ä¿¡æ¯</span><br></pre></td></tr></table></figure><p>å­¦ç”Ÿè¡¨: <code>Students</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">| department_id | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id æ˜¯è¯¥è¡¨çš„ä¸»é”®</span><br><span class="line">è¯¥è¡¨åŒ…å«ä¸€æ‰€å¤§å­¦æ¯ä¸ªå­¦ç”Ÿçš„ id å’Œä»–/å¥¹å°±è¯»çš„é™¢ç³»ä¿¡æ¯</span><br></pre></td></tr></table></figure><p>å†™ä¸€æ¡ SQL è¯­å¥ä»¥æŸ¥è¯¢é‚£äº›æ‰€åœ¨é™¢ç³»ä¸å­˜åœ¨çš„å­¦ç”Ÿçš„ id å’Œå§“å</p><p>å¯ä»¥ä»¥ä»»ä½•é¡ºåºè¿”å›ç»“æœ</p><p>ä¸‹é¢æ˜¯è¿”å›ç»“æœæ ¼å¼çš„ä¾‹å­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">Departments è¡¨:</span><br><span class="line">+------+--------------------------+</span><br><span class="line">| id   | name                     |</span><br><span class="line">+------+--------------------------+</span><br><span class="line">| 1    | Electrical Engineering   |</span><br><span class="line">| 7    | Computer Engineering     |</span><br><span class="line">| 13   | Bussiness Administration |</span><br><span class="line">+------+--------------------------+</span><br><span class="line"></span><br><span class="line">Students è¡¨:</span><br><span class="line">+------+----------+---------------+</span><br><span class="line">| id   | name     | department_id |</span><br><span class="line">+------+----------+---------------+</span><br><span class="line">| 23   | Alice    | 1             |</span><br><span class="line">| 1    | Bob      | 7             |</span><br><span class="line">| 5    | Jennifer | 13            |</span><br><span class="line">| 2    | John     | 14            |</span><br><span class="line">| 4    | Jasmine  | 77            |</span><br><span class="line">| 3    | Steve    | 74            |</span><br><span class="line">| 6    | Luis     | 1             |</span><br><span class="line">| 8    | Jonathan | 7             |</span><br><span class="line">| 7    | Daiana   | 33            |</span><br><span class="line">| 11   | Madelynn | 1             |</span><br><span class="line">+------+----------+---------------+</span><br><span class="line"></span><br><span class="line">ç»“æœè¡¨:</span><br><span class="line">+------+----------+</span><br><span class="line">| id   | name     |</span><br><span class="line">+------+----------+</span><br><span class="line">| 2    | John     |</span><br><span class="line">| 7    | Daiana   |</span><br><span class="line">| 4    | Jasmine  |</span><br><span class="line">| 3    | Steve    |</span><br><span class="line">+------+----------+</span><br><span class="line"></span><br><span class="line">John, Daiana, Steve å’Œ Jasmine æ‰€åœ¨çš„é™¢ç³»åˆ†åˆ«æ˜¯ 14, 33, 74 å’Œ 77ï¼Œ å…¶ä¸­ 14, 33, 74 å’Œ 77 å¹¶ä¸å­˜åœ¨äºé™¢ç³»è¡¨</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,name  </span><br><span class="line"><span class="keyword">from</span> Students </span><br><span class="line"><span class="keyword">where</span> department_id <span class="keyword">not</span> <span class="keyword">in</span> </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> id </span><br><span class="line">    <span class="keyword">from</span> Departments</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="1355-æ´»åŠ¨å‚ä¸è€…"><a href="#1355-æ´»åŠ¨å‚ä¸è€…" class="headerlink" title="1355. æ´»åŠ¨å‚ä¸è€…"></a><a href="https://leetcode-cn.com/problems/activity-participants/">1355. æ´»åŠ¨å‚ä¸è€…</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>è¡¨: <code>Friends</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">| activity      | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id æ˜¯æœ‹å‹çš„ id å’Œè¯¥è¡¨çš„ä¸»é”®</span><br><span class="line">name æ˜¯æœ‹å‹çš„åå­—</span><br><span class="line">activity æ˜¯æœ‹å‹å‚åŠ çš„æ´»åŠ¨çš„åå­—</span><br></pre></td></tr></table></figure><p>è¡¨: <code>Activities</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id æ˜¯è¯¥è¡¨çš„ä¸»é”®</span><br><span class="line">name æ˜¯æ´»åŠ¨çš„åå­—</span><br></pre></td></tr></table></figure><p>å†™ä¸€æ¡ SQL æŸ¥è¯¢é‚£äº›æ—¢æ²¡æœ‰æœ€å¤šï¼Œä¹Ÿæ²¡æœ‰æœ€å°‘å‚ä¸è€…çš„æ´»åŠ¨çš„åå­—</p><p>å¯ä»¥ä»¥ä»»ä½•é¡ºåºè¿”å›ç»“æœï¼ŒActivities è¡¨çš„æ¯é¡¹æ´»åŠ¨çš„å‚ä¸è€…éƒ½æ¥è‡ª Friends è¡¨</p><p>ä¸‹é¢æ˜¯æŸ¥è¯¢ç»“æœæ ¼å¼çš„ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Friends è¡¨:</span><br><span class="line">+------+--------------+---------------+</span><br><span class="line">| id   | name         | activity      |</span><br><span class="line">+------+--------------+---------------+</span><br><span class="line">| 1    | Jonathan D.  | Eating        |</span><br><span class="line">| 2    | Jade W.      | Singing       |</span><br><span class="line">| 3    | Victor J.    | Singing       |</span><br><span class="line">| 4    | Elvis Q.     | Eating        |</span><br><span class="line">| 5    | Daniel A.    | Eating        |</span><br><span class="line">| 6    | Bob B.       | Horse Riding  |</span><br><span class="line">+------+--------------+---------------+</span><br><span class="line"></span><br><span class="line">Activities è¡¨:</span><br><span class="line">+------+--------------+</span><br><span class="line">| id   | name         |</span><br><span class="line">+------+--------------+</span><br><span class="line">| 1    | Eating       |</span><br><span class="line">| 2    | Singing      |</span><br><span class="line">| 3    | Horse Riding |</span><br><span class="line">+------+--------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+--------------+</span><br><span class="line">| activity     |</span><br><span class="line">+--------------+</span><br><span class="line">| Singing      |</span><br><span class="line">+--------------+</span><br><span class="line"></span><br><span class="line">Eating æ´»åŠ¨æœ‰ä¸‰ä¸ªäººå‚åŠ , æ˜¯æœ€å¤šäººå‚åŠ çš„æ´»åŠ¨ (Jonathan D. , Elvis Q. and Daniel A.)</span><br><span class="line">Horse Riding æ´»åŠ¨æœ‰ä¸€ä¸ªäººå‚åŠ , æ˜¯æœ€å°‘äººå‚åŠ çš„æ´»åŠ¨ (Bob B.)</span><br><span class="line">Singing æ´»åŠ¨æœ‰ä¸¤ä¸ªäººå‚åŠ  (Victor J. and Jade W.)</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> activity</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> activity,</span><br><span class="line">    <span class="built_in">rank</span>()<span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> cnt) rk1,</span><br><span class="line">    <span class="built_in">rank</span>()<span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> cnt <span class="keyword">desc</span>) rk2</span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span>  activity  ,<span class="built_in">count</span>(<span class="operator">*</span>) cnt</span><br><span class="line">        <span class="keyword">from</span>  Friends</span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span>  activity </span><br><span class="line">    )t1</span><br><span class="line">)t2</span><br><span class="line"><span class="keyword">where</span> rk1 <span class="operator">!=</span><span class="number">1</span> <span class="keyword">and</span> rk2 <span class="operator">!=</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¸éœ€è¦å…³è” Activitiesè¡¨ï¼Œå› ä¸º è‡³å°‘æœ‰ä¸€äººå‚åŠ </p></blockquote><h4 id="1364-é¡¾å®¢çš„å¯ä¿¡è”ç³»äººæ•°é‡"><a href="#1364-é¡¾å®¢çš„å¯ä¿¡è”ç³»äººæ•°é‡" class="headerlink" title="1364. é¡¾å®¢çš„å¯ä¿¡è”ç³»äººæ•°é‡"></a><a href="https://leetcode-cn.com/problems/number-of-trusted-contacts-of-a-customer/">1364. é¡¾å®¢çš„å¯ä¿¡è”ç³»äººæ•°é‡</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>é¡¾å®¢è¡¨ï¼š<code>Customers</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| customer_name | varchar |</span><br><span class="line">| email         | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">customer_id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">æ­¤è¡¨çš„æ¯ä¸€è¡ŒåŒ…å«äº†æŸåœ¨çº¿å•†åº—é¡¾å®¢çš„å§“åå’Œç”µå­é‚®ä»¶ã€‚</span><br></pre></td></tr></table></figure><p>è”ç³»æ–¹å¼è¡¨ï¼š<code>Contacts</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | id      |</span><br><span class="line">| contact_name  | varchar |</span><br><span class="line">| contact_email | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(user_id, contact_email) æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">æ­¤è¡¨çš„æ¯ä¸€è¡Œè¡¨ç¤ºç¼–å·ä¸º user_id çš„é¡¾å®¢çš„æŸä½è”ç³»äººçš„å§“åå’Œç”µå­é‚®ä»¶ã€‚</span><br><span class="line">æ­¤è¡¨åŒ…å«æ¯ä½é¡¾å®¢çš„è”ç³»äººä¿¡æ¯ï¼Œä½†é¡¾å®¢çš„è”ç³»äººä¸ä¸€å®šå­˜åœ¨äºé¡¾å®¢è¡¨ä¸­ã€‚</span><br></pre></td></tr></table></figure><p>å‘ç¥¨è¡¨ï¼š<code>Invoices</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| invoice_id   | int     |</span><br><span class="line">| price        | int     |</span><br><span class="line">| user_id      | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">invoice_id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">æ­¤è¡¨çš„æ¯ä¸€è¡Œåˆ†åˆ«è¡¨ç¤ºç¼–å·ä¸º user_id çš„é¡¾å®¢æ‹¥æœ‰æœ‰ä¸€å¼ ç¼–å·ä¸º invoice_idã€ä»·æ ¼ä¸º price çš„å‘ç¥¨ã€‚</span><br></pre></td></tr></table></figure><p>ä¸ºæ¯å¼ å‘ç¥¨ <code>invoice_id</code> ç¼–å†™ä¸€ä¸ªSQLæŸ¥è¯¢ä»¥æŸ¥æ‰¾ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li><code>customer_name</code>ï¼šä¸å‘ç¥¨ç›¸å…³çš„é¡¾å®¢åç§°ã€‚</li><li><code>price</code>ï¼šå‘ç¥¨çš„ä»·æ ¼ã€‚</li><li><code>contacts_cnt</code>ï¼šè¯¥é¡¾å®¢çš„è”ç³»äººæ•°é‡ã€‚</li><li><code>trusted_contacts_cnt</code>ï¼šå¯ä¿¡è”ç³»äººçš„æ•°é‡ï¼šæ—¢æ˜¯è¯¥é¡¾å®¢çš„è”ç³»äººåˆæ˜¯å•†åº—é¡¾å®¢çš„è”ç³»äººæ•°é‡ï¼ˆå³ï¼šå¯ä¿¡è”ç³»äººçš„ç”µå­é‚®ä»¶å­˜åœ¨äºå®¢æˆ·è¡¨ä¸­ï¼‰ã€‚</li></ul><p>å°†æŸ¥è¯¢çš„ç»“æœæŒ‰ç…§ <code>invoice_id</code> æ’åºã€‚</p><p>æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">Customers table:</span><br><span class="line">+-------------+---------------+--------------------+</span><br><span class="line">| customer_id | customer_name | email              |</span><br><span class="line">+-------------+---------------+--------------------+</span><br><span class="line">| 1           | Alice         | alice@leetcode.com |</span><br><span class="line">| 2           | Bob           | bob@leetcode.com   |</span><br><span class="line">| 13          | John          | john@leetcode.com  |</span><br><span class="line">| 6           | Alex          | alex@leetcode.com  |</span><br><span class="line">+-------------+---------------+--------------------+</span><br><span class="line">Contacts table:</span><br><span class="line">+-------------+--------------+--------------------+</span><br><span class="line">| user_id     | contact_name | contact_email      |</span><br><span class="line">+-------------+--------------+--------------------+</span><br><span class="line">| 1           | Bob          | bob@leetcode.com   |</span><br><span class="line">| 1           | John         | john@leetcode.com  |</span><br><span class="line">| 1           | Jal          | jal@leetcode.com   |</span><br><span class="line">| 2           | Omar         | omar@leetcode.com  |</span><br><span class="line">| 2           | Meir         | meir@leetcode.com  |</span><br><span class="line">| 6           | Alice        | alice@leetcode.com |</span><br><span class="line">+-------------+--------------+--------------------+</span><br><span class="line">Invoices table:</span><br><span class="line">+------------+-------+---------+</span><br><span class="line">| invoice_id | price | user_id |</span><br><span class="line">+------------+-------+---------+</span><br><span class="line">| 77         | 100   | 1       |</span><br><span class="line">| 88         | 200   | 1       |</span><br><span class="line">| 99         | 300   | 2       |</span><br><span class="line">| 66         | 400   | 2       |</span><br><span class="line">| 55         | 500   | 13      |</span><br><span class="line">| 44         | 60    | 6       |</span><br><span class="line">+------------+-------+---------+</span><br><span class="line">Result table:</span><br><span class="line">+------------+---------------+-------+--------------+----------------------+</span><br><span class="line">| invoice_id | customer_name | price | contacts_cnt | trusted_contacts_cnt |</span><br><span class="line">+------------+---------------+-------+--------------+----------------------+</span><br><span class="line">| 44         | Alex          | 60    | 1            | 1                    |</span><br><span class="line">| 55         | John          | 500   | 0            | 0                    |</span><br><span class="line">| 66         | Bob           | 400   | 2            | 0                    |</span><br><span class="line">| 77         | Alice         | 100   | 3            | 2                    |</span><br><span class="line">| 88         | Alice         | 200   | 3            | 2                    |</span><br><span class="line">| 99         | Bob           | 300   | 2            | 0                    |</span><br><span class="line">+------------+---------------+-------+--------------+----------------------+</span><br><span class="line">Alice æœ‰ä¸‰ä½è”ç³»äººï¼Œå…¶ä¸­ä¸¤ä½(Bob å’Œ John)æ˜¯å¯ä¿¡è”ç³»äººã€‚</span><br><span class="line">Bob æœ‰ä¸¤ä½è”ç³»äºº, ä»–ä»¬ä¸­çš„ä»»ä½•ä¸€ä½éƒ½ä¸æ˜¯å¯ä¿¡è”ç³»äººã€‚</span><br><span class="line">Alex åªæœ‰ä¸€ä½è”ç³»äºº(Alice)ï¼Œå¹¶æ˜¯ä¸€ä½å¯ä¿¡è”ç³»äººã€‚</span><br><span class="line">John æ²¡æœ‰ä»»ä½•è”ç³»äººã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> invoice_id ,customer_name,price,ifnull(cnt,<span class="number">0</span>) contacts_cnt,ifnull(bc,<span class="number">0</span>) trusted_contacts_cnt </span><br><span class="line"><span class="keyword">from</span> Invoices i</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> (</span><br><span class="line"><span class="keyword">select</span> user_id ,<span class="built_in">count</span>(<span class="operator">*</span>) cnt</span><br><span class="line"><span class="keyword">from</span> Contacts</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> user_id</span><br><span class="line">) t1</span><br><span class="line"><span class="keyword">on</span> i.user_id<span class="operator">=</span>t1.user_id</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> (</span><br><span class="line"><span class="keyword">select</span>  user_id ,<span class="built_in">count</span>(<span class="operator">*</span>) bc</span><br><span class="line"><span class="keyword">from</span> Contacts</span><br><span class="line">    <span class="keyword">where</span> contact_name <span class="keyword">in</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> customer_name</span><br><span class="line">        <span class="keyword">from</span> Customers</span><br><span class="line">    )</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> user_id </span><br><span class="line">)t2</span><br><span class="line"><span class="keyword">on</span> i.user_id <span class="operator">=</span> t2.user_id</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Customers c</span><br><span class="line"><span class="keyword">on</span> i.user_id<span class="operator">=</span> c.customer_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> invoice_id</span><br></pre></td></tr></table></figure><blockquote><p>å°±æ˜¯éº»çƒ¦ç‚¹ å„ç§join</p></blockquote><h4 id="1369-è·å–æœ€è¿‘ç¬¬äºŒæ¬¡çš„æ´»åŠ¨"><a href="#1369-è·å–æœ€è¿‘ç¬¬äºŒæ¬¡çš„æ´»åŠ¨" class="headerlink" title="1369. è·å–æœ€è¿‘ç¬¬äºŒæ¬¡çš„æ´»åŠ¨"></a><a href="https://leetcode-cn.com/problems/get-the-second-most-recent-activity/">1369. è·å–æœ€è¿‘ç¬¬äºŒæ¬¡çš„æ´»åŠ¨</a></h4><p>éš¾åº¦å›°éš¾</p><p>SQLæ¶æ„</p><p>è¡¨: <code>UserActivity</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| username      | varchar |</span><br><span class="line">| activity      | varchar |</span><br><span class="line">| startDate     | Date    |</span><br><span class="line">| endDate       | Date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">è¯¥è¡¨ä¸åŒ…å«ä¸»é”®</span><br><span class="line">è¯¥è¡¨åŒ…å«æ¯ä¸ªç”¨æˆ·åœ¨ä¸€æ®µæ—¶é—´å†…è¿›è¡Œçš„æ´»åŠ¨çš„ä¿¡æ¯</span><br><span class="line">åä¸º username çš„ç”¨æˆ·åœ¨ startDate åˆ° endDate æ—¥å†…æœ‰ä¸€æ¬¡æ´»åŠ¨</span><br></pre></td></tr></table></figure><p>å†™ä¸€æ¡SQLæŸ¥è¯¢å±•ç¤ºæ¯ä¸€ä½ç”¨æˆ· <strong>æœ€è¿‘ç¬¬äºŒæ¬¡</strong> çš„æ´»åŠ¨</p><p>å¦‚æœç”¨æˆ·ä»…æœ‰ä¸€æ¬¡æ´»åŠ¨ï¼Œè¿”å›è¯¥æ´»åŠ¨</p><p>ä¸€ä¸ªç”¨æˆ·ä¸èƒ½åŒæ—¶è¿›è¡Œè¶…è¿‡ä¸€é¡¹æ´»åŠ¨ï¼Œä»¥ <strong>ä»»æ„</strong> é¡ºåºè¿”å›ç»“æœ</p><p>ä¸‹é¢æ˜¯æŸ¥è¯¢ç»“æœæ ¼å¼çš„ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">UserActivity è¡¨:</span><br><span class="line">+------------+--------------+-------------+-------------+</span><br><span class="line">| username   | activity     | startDate   | endDate     |</span><br><span class="line">+------------+--------------+-------------+-------------+</span><br><span class="line">| Alice      | Travel       | 2020-02-12  | 2020-02-20  |</span><br><span class="line">| Alice      | Dancing      | 2020-02-21  | 2020-02-23  |</span><br><span class="line">| Alice      | Travel       | 2020-02-24  | 2020-02-28  |</span><br><span class="line">| Bob        | Travel       | 2020-02-11  | 2020-02-18  |</span><br><span class="line">+------------+--------------+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+------------+--------------+-------------+-------------+</span><br><span class="line">| username   | activity     | startDate   | endDate     |</span><br><span class="line">+------------+--------------+-------------+-------------+</span><br><span class="line">| Alice      | Dancing      | 2020-02-21  | 2020-02-23  |</span><br><span class="line">| Bob        | Travel       | 2020-02-11  | 2020-02-18  |</span><br><span class="line">+------------+--------------+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Alice æœ€è¿‘ç¬¬äºŒæ¬¡çš„æ´»åŠ¨æ˜¯ä» 2020-02-24 åˆ° 2020-02-28 çš„æ—…è¡Œ, åœ¨æ­¤ä¹‹å‰çš„ 2020-02-21 åˆ° 2020-02-23 å¥¹è¿›è¡Œäº†èˆè¹ˆ</span><br><span class="line">Bob åªæœ‰ä¸€æ¡è®°å½•ï¼Œæˆ‘ä»¬å°±å–è¿™æ¡è®°å½•</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> username, activity ,startDate,endDate </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> username, activity ,startDate,endDate ,</span><br><span class="line">    <span class="built_in">rank</span>()<span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> username <span class="keyword">order</span> <span class="keyword">by</span> startDate <span class="keyword">desc</span>) rk,</span><br><span class="line">    <span class="built_in">lag</span>( startDate ,<span class="number">1</span>,<span class="keyword">null</span>)<span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> username <span class="keyword">order</span> <span class="keyword">by</span> startDate ) lg</span><br><span class="line"><span class="keyword">from</span> UserActivity</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> rk<span class="operator">=</span><span class="number">2</span> <span class="keyword">or</span>  (rk <span class="operator">=</span> <span class="number">1</span> <span class="operator">&amp;&amp;</span>  lg <span class="keyword">is</span> <span class="keyword">null</span>)</span><br></pre></td></tr></table></figure><h4 id="1378-ä½¿ç”¨å”¯ä¸€æ ‡è¯†ç æ›¿æ¢å‘˜å·¥ID"><a href="#1378-ä½¿ç”¨å”¯ä¸€æ ‡è¯†ç æ›¿æ¢å‘˜å·¥ID" class="headerlink" title="1378. ä½¿ç”¨å”¯ä¸€æ ‡è¯†ç æ›¿æ¢å‘˜å·¥ID"></a><a href="https://leetcode-cn.com/problems/replace-employee-id-with-the-unique-identifier/">1378. ä½¿ç”¨å”¯ä¸€æ ‡è¯†ç æ›¿æ¢å‘˜å·¥ID</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p><code>Employees</code> è¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¿™å¼ è¡¨çš„æ¯ä¸€è¡Œåˆ†åˆ«ä»£è¡¨äº†æŸå…¬å¸å…¶ä¸­ä¸€ä½å‘˜å·¥çš„åå­—å’Œ ID ã€‚</span><br></pre></td></tr></table></figure><p><code>EmployeeUNI</code> è¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| unique_id     | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(id, unique_id) æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">è¿™å¼ è¡¨çš„æ¯ä¸€è¡ŒåŒ…å«äº†è¯¥å…¬å¸æŸä½å‘˜å·¥çš„ ID å’Œä»–çš„å”¯ä¸€æ ‡è¯†ç ï¼ˆunique IDï¼‰ã€‚</span><br></pre></td></tr></table></figure><p>å†™ä¸€æ®µSQLæŸ¥è¯¢æ¥å±•ç¤ºæ¯ä½ç”¨æˆ·çš„ <strong>å”¯ä¸€æ ‡è¯†ç ï¼ˆunique ID ï¼‰</strong>ï¼›å¦‚æœæŸä½å‘˜å·¥æ²¡æœ‰å”¯ä¸€æ ‡è¯†ç ï¼Œä½¿ç”¨ null å¡«å……å³å¯ã€‚</p><p>ä½ å¯ä»¥ä»¥ <strong>ä»»æ„</strong> é¡ºåºè¿”å›ç»“æœè¡¨ã€‚</p><p>æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Employees table:</span><br><span class="line">+----+----------+</span><br><span class="line">| id | name     |</span><br><span class="line">+----+----------+</span><br><span class="line">| 1  | Alice    |</span><br><span class="line">| 7  | Bob      |</span><br><span class="line">| 11 | Meir     |</span><br><span class="line">| 90 | Winston  |</span><br><span class="line">| 3  | Jonathan |</span><br><span class="line">+----+----------+</span><br><span class="line"></span><br><span class="line">EmployeeUNI table:</span><br><span class="line">+----+-----------+</span><br><span class="line">| id | unique_id |</span><br><span class="line">+----+-----------+</span><br><span class="line">| 3  | 1         |</span><br><span class="line">| 11 | 2         |</span><br><span class="line">| 90 | 3         |</span><br><span class="line">+----+-----------+</span><br><span class="line"></span><br><span class="line">EmployeeUNI table:</span><br><span class="line">+-----------+----------+</span><br><span class="line">| unique_id | name     |</span><br><span class="line">+-----------+----------+</span><br><span class="line">| null      | Alice    |</span><br><span class="line">| null      | Bob      |</span><br><span class="line">| 2         | Meir     |</span><br><span class="line">| 3         | Winston  |</span><br><span class="line">| 1         | Jonathan |</span><br><span class="line">+-----------+----------+</span><br><span class="line"></span><br><span class="line">Alice and Bob æ²¡æœ‰å”¯ä¸€æ ‡è¯†ç , å› æ­¤æˆ‘ä»¬ä½¿ç”¨ null æ›¿ä»£ã€‚</span><br><span class="line">Meir çš„å”¯ä¸€æ ‡è¯†ç æ˜¯ 2 ã€‚</span><br><span class="line">Winston çš„å”¯ä¸€æ ‡è¯†ç æ˜¯ 3 ã€‚</span><br><span class="line">Jonathan å”¯ä¸€æ ‡è¯†ç æ˜¯ 1 ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> unique_id,e.name</span><br><span class="line"><span class="keyword">from</span> Employees  e <span class="keyword">left</span> <span class="keyword">join</span> EmployeeUNI u</span><br><span class="line"><span class="keyword">on</span> e.id <span class="operator">=</span> u.id</span><br></pre></td></tr></table></figure><h4 id="1384-æŒ‰å¹´åº¦åˆ—å‡ºé”€å”®æ€»é¢"><a href="#1384-æŒ‰å¹´åº¦åˆ—å‡ºé”€å”®æ€»é¢" class="headerlink" title="1384. æŒ‰å¹´åº¦åˆ—å‡ºé”€å”®æ€»é¢"></a><a href="https://leetcode-cn.com/problems/total-sales-amount-by-year/">1384. æŒ‰å¹´åº¦åˆ—å‡ºé”€å”®æ€»é¢</a></h4><p>éš¾åº¦å›°éš¾</p><p>SQLæ¶æ„</p><p> <code>Product</code> è¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| product_name  | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">product_id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">product_name æ˜¯äº§å“çš„åç§°ã€‚</span><br></pre></td></tr></table></figure><p><code>Sales</code> è¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------------+---------+</span><br><span class="line">| Column Name         | Type    |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">| product_id          | int     |</span><br><span class="line">| period_start        | varchar |</span><br><span class="line">| period_end          | date    |</span><br><span class="line">| average_daily_sales | int     |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">product_id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">period_start å’Œ period_end æ˜¯è¯¥äº§å“é”€å”®æœŸçš„èµ·å§‹æ—¥æœŸå’Œç»“æŸæ—¥æœŸï¼Œä¸”è¿™ä¸¤ä¸ªæ—¥æœŸåŒ…å«åœ¨é”€å”®æœŸå†…ã€‚</span><br><span class="line">average_daily_sales åˆ—å­˜å‚¨é”€å”®æœŸå†…è¯¥äº§å“çš„æ—¥å¹³å‡é”€å”®é¢ã€‚</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€æ®µSQLæŸ¥è¯¢æ¯ä¸ªäº§å“æ¯å¹´çš„æ€»é”€å”®é¢ï¼Œå¹¶åŒ…å« product_id, product_name ä»¥åŠ report_year ç­‰ä¿¡æ¯ã€‚</p><p>é”€å”®å¹´ä»½çš„æ—¥æœŸä»‹äº 2018 å¹´åˆ° 2020 å¹´ä¹‹é—´ã€‚ä½ è¿”å›çš„ç»“æœéœ€è¦æŒ‰ product_id å’Œ report_year <strong>æ’åº</strong>ã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Product table:</span><br><span class="line">+------------+--------------+</span><br><span class="line">| product_id | product_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| 1          | LC Phone     |</span><br><span class="line">| 2          | LC T-Shirt   |</span><br><span class="line">| 3          | LC Keychain  |</span><br><span class="line">+------------+--------------+</span><br><span class="line"></span><br><span class="line">Sales table:</span><br><span class="line">+------------+--------------+-------------+---------------------+</span><br><span class="line">| product_id | period_start | period_end  | average_daily_sales |</span><br><span class="line">+------------+--------------+-------------+---------------------+</span><br><span class="line">| 1          | 2019-01-25   | 2019-02-28  | 100                 |</span><br><span class="line">| 2          | 2018-12-01   | 2020-01-01  | 10                  |</span><br><span class="line">| 3          | 2019-12-01   | 2020-01-31  | 1                   |</span><br><span class="line">+------------+--------------+-------------+---------------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+--------------+-------------+--------------+</span><br><span class="line">| product_id | product_name | report_year | total_amount |</span><br><span class="line">+------------+--------------+-------------+--------------+</span><br><span class="line">| 1          | LC Phone     |    2019     | 3500         |</span><br><span class="line">| 2          | LC T-Shirt   |    2018     | 310          |</span><br><span class="line">| 2          | LC T-Shirt   |    2019     | 3650         |</span><br><span class="line">| 2          | LC T-Shirt   |    2020     | 10           |</span><br><span class="line">| 3          | LC Keychain  |    2019     | 31           |</span><br><span class="line">| 3          | LC Keychain  |    2020     | 31           |</span><br><span class="line">+------------+--------------+-------------+--------------+</span><br><span class="line">LC Phone åœ¨ 2019-01-25 è‡³ 2019-02-28 æœŸé—´é”€å”®ï¼Œè¯¥äº§å“é”€å”®æ—¶é—´æ€»è®¡35å¤©ã€‚é”€å”®æ€»é¢ 35*100 = 3500ã€‚</span><br><span class="line">LC T-shirt åœ¨ 2018-12-01 è‡³ 2020-01-01 æœŸé—´é”€å”®ï¼Œè¯¥äº§å“åœ¨2018å¹´ã€2019å¹´ã€2020å¹´çš„é”€å”®æ—¶é—´åˆ†åˆ«æ˜¯31å¤©ã€365å¤©ã€1å¤©ï¼Œ2018å¹´ã€2019å¹´ã€2020å¹´çš„é”€å”®æ€»é¢åˆ†åˆ«æ˜¯31*10=310ã€365*10=3650ã€1*10=10ã€‚</span><br><span class="line">LC Keychain åœ¨ 2019-12-01 è‡³ 2020-01-31 æœŸé—´é”€å”®ï¼Œè¯¥äº§å“åœ¨2019å¹´ã€2020å¹´çš„é”€å”®æ—¶é—´åˆ†åˆ«æ˜¯ï¼š31å¤©ã€31å¤©ï¼Œ2019å¹´ã€2020å¹´çš„é”€å”®æ€»é¢åˆ†åˆ«æ˜¯31*1=31ã€31*1=31ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(</span><br><span class="line"> <span class="keyword">select</span> Sales.product_id, product_name, <span class="string">&#x27;2018&#x27;</span> <span class="keyword">as</span> <span class="string">&#x27;report_year&#x27;</span>, if(period_start<span class="operator">&lt;</span><span class="string">&#x27;2019-01-01&#x27;</span>, (datediff(if(period_end<span class="operator">&lt;</span><span class="string">&#x27;2019-01-01&#x27;</span>, period_end, <span class="type">date</span>(<span class="string">&#x27;2018-12-31&#x27;</span>)), if(period_start<span class="operator">&gt;=</span><span class="string">&#x27;2018-01-01&#x27;</span>, period_start, <span class="type">date</span>(<span class="string">&#x27;2018-01-01&#x27;</span>)))<span class="operator">+</span><span class="number">1</span>)<span class="operator">*</span>average_daily_sales, <span class="number">0</span>) <span class="keyword">as</span> total_amount</span><br><span class="line"><span class="keyword">from</span> Sales  </span><br><span class="line"><span class="keyword">join</span> Product <span class="keyword">on</span> Sales.product_id <span class="operator">=</span> Product.product_id </span><br><span class="line"><span class="keyword">having</span>  total_amount<span class="operator">&gt;</span><span class="number">0</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">union</span>(</span><br><span class="line"><span class="keyword">select</span> Sales.product_id, product_name, <span class="string">&#x27;2019&#x27;</span> <span class="keyword">as</span> <span class="string">&#x27;report_year&#x27;</span>, if( period_start<span class="operator">&lt;</span><span class="string">&#x27;2020-01-01&#x27;</span>, (datediff(if(period_end<span class="operator">&lt;</span><span class="string">&#x27;2020-01-01&#x27;</span>, period_end, <span class="type">date</span>(<span class="string">&#x27;2019-12-31&#x27;</span>)), if(period_start<span class="operator">&gt;=</span><span class="string">&#x27;2019-01-01&#x27;</span>, period_start, <span class="type">date</span>(<span class="string">&#x27;2019-01-01&#x27;</span>)))<span class="operator">+</span><span class="number">1</span>)<span class="operator">*</span>average_daily_sales , <span class="number">0</span>) <span class="keyword">as</span> total_amount</span><br><span class="line"><span class="keyword">from</span> Sales  </span><br><span class="line"><span class="keyword">join</span> Product <span class="keyword">on</span> (Sales.product_id <span class="operator">=</span> Product.product_id )</span><br><span class="line"><span class="keyword">having</span>  total_amount<span class="operator">&gt;</span><span class="number">0</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">union</span>(</span><br><span class="line"><span class="keyword">select</span> Sales.product_id, product_name, <span class="string">&#x27;2020&#x27;</span> <span class="keyword">as</span> <span class="string">&#x27;report_year&#x27;</span>, (datediff(if(period_end<span class="operator">&lt;</span><span class="string">&#x27;2021-01-01&#x27;</span>, period_end, <span class="type">date</span>(<span class="string">&#x27;2020-12-31&#x27;</span>)), if(period_start<span class="operator">&gt;=</span><span class="string">&#x27;2020-01-01&#x27;</span>, period_start, <span class="type">date</span>(<span class="string">&#x27;2020-01-01&#x27;</span>)))<span class="operator">+</span><span class="number">1</span>)<span class="operator">*</span>average_daily_sales <span class="keyword">as</span> total_amount</span><br><span class="line"><span class="keyword">from</span> Sales  </span><br><span class="line"><span class="keyword">join</span> Product  <span class="keyword">on</span> (Sales.product_id <span class="operator">=</span> Product.product_id)</span><br><span class="line"><span class="keyword">having</span> total_amount<span class="operator">&gt;</span><span class="number">0</span></span><br><span class="line">) </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> product_id, report_year</span><br></pre></td></tr></table></figure><blockquote><p>å„ä¸ªå¹´ä»½è¿›è¡Œunion,å°±æ˜¯å¹´ä»½åˆ¤æ–­çš„æ—¶å€™éº»çƒ¦äº›</p></blockquote><h4 id="1393-è‚¡ç¥¨çš„èµ„æœ¬æŸç›Š"><a href="#1393-è‚¡ç¥¨çš„èµ„æœ¬æŸç›Š" class="headerlink" title="1393. è‚¡ç¥¨çš„èµ„æœ¬æŸç›Š"></a><a href="https://leetcode-cn.com/problems/capital-gainloss/">1393. è‚¡ç¥¨çš„èµ„æœ¬æŸç›Š</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p><code>Stocks</code> è¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| stock_name    | varchar |</span><br><span class="line">| operation     | enum    |</span><br><span class="line">| operation_day | int     |</span><br><span class="line">| price         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(stock_name, day) æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®</span><br><span class="line">operation åˆ—ä½¿ç”¨çš„æ˜¯ä¸€ç§æšä¸¾ç±»å‹ï¼ŒåŒ…æ‹¬ï¼š(&#x27;Sell&#x27;,&#x27;Buy&#x27;)</span><br><span class="line">æ­¤è¡¨çš„æ¯ä¸€è¡Œä»£è¡¨äº†åä¸º stock_name çš„æŸæ”¯è‚¡ç¥¨åœ¨ operation_day è¿™ä¸€å¤©çš„æ“ä½œä»·æ ¼ã€‚</span><br><span class="line">ä¿è¯è‚¡ç¥¨çš„æ¯æ¬¡&#x27;Sell&#x27;æ“ä½œå‰ï¼Œéƒ½æœ‰ç›¸åº”çš„&#x27;Buy&#x27;æ“ä½œã€‚</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€ä¸ªSQLæŸ¥è¯¢æ¥æŠ¥å‘Šæ¯æ”¯è‚¡ç¥¨çš„èµ„æœ¬æŸç›Šã€‚</p><p>è‚¡ç¥¨çš„èµ„æœ¬æŸç›Šæ˜¯ä¸€æ¬¡æˆ–å¤šæ¬¡ä¹°å–è‚¡ç¥¨åçš„å…¨éƒ¨æ”¶ç›Šæˆ–æŸå¤±ã€‚</p><p>ä»¥ä»»æ„é¡ºåºè¿”å›ç»“æœå³å¯ã€‚</p><p>SQLæŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Stocks è¡¨:</span><br><span class="line">+---------------+-----------+---------------+--------+</span><br><span class="line">| stock_name    | operation | operation_day | price  |</span><br><span class="line">+---------------+-----------+---------------+--------+</span><br><span class="line">| Leetcode      | Buy       | 1             | 1000   |</span><br><span class="line">| Corona Masks  | Buy       | 2             | 10     |</span><br><span class="line">| Leetcode      | Sell      | 5             | 9000   |</span><br><span class="line">| Handbags      | Buy       | 17            | 30000  |</span><br><span class="line">| Corona Masks  | Sell      | 3             | 1010   |</span><br><span class="line">| Corona Masks  | Buy       | 4             | 1000   |</span><br><span class="line">| Corona Masks  | Sell      | 5             | 500    |</span><br><span class="line">| Corona Masks  | Buy       | 6             | 1000   |</span><br><span class="line">| Handbags      | Sell      | 29            | 7000   |</span><br><span class="line">| Corona Masks  | Sell      | 10            | 10000  |</span><br><span class="line">+---------------+-----------+---------------+--------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+---------------+-------------------+</span><br><span class="line">| stock_name    | capital_gain_loss |</span><br><span class="line">+---------------+-------------------+</span><br><span class="line">| Corona Masks  | 9500              |</span><br><span class="line">| Leetcode      | 8000              |</span><br><span class="line">| Handbags      | -23000            |</span><br><span class="line">+---------------+-------------------+</span><br><span class="line">Leetcode è‚¡ç¥¨åœ¨ç¬¬ä¸€å¤©ä»¥1000ç¾å…ƒçš„ä»·æ ¼ä¹°å…¥ï¼Œåœ¨ç¬¬äº”å¤©ä»¥9000ç¾å…ƒçš„ä»·æ ¼å–å‡ºã€‚èµ„æœ¬æ”¶ç›Š=9000-1000=8000ç¾å…ƒã€‚</span><br><span class="line">Handbags è‚¡ç¥¨åœ¨ç¬¬17å¤©ä»¥30000ç¾å…ƒçš„ä»·æ ¼ä¹°å…¥ï¼Œåœ¨ç¬¬29å¤©ä»¥7000ç¾å…ƒçš„ä»·æ ¼å–å‡ºã€‚èµ„æœ¬æŸå¤±=7000-30000=-23000ç¾å…ƒã€‚</span><br><span class="line">Corona Masks è‚¡ç¥¨åœ¨ç¬¬1å¤©ä»¥10ç¾å…ƒçš„ä»·æ ¼ä¹°å…¥ï¼Œåœ¨ç¬¬3å¤©ä»¥1010ç¾å…ƒçš„ä»·æ ¼å–å‡ºã€‚åœ¨ç¬¬4å¤©ä»¥1000ç¾å…ƒçš„ä»·æ ¼å†æ¬¡è´­ä¹°ï¼Œåœ¨ç¬¬5å¤©ä»¥500ç¾å…ƒçš„ä»·æ ¼å‡ºå”®ã€‚æœ€åï¼Œå®ƒåœ¨ç¬¬6å¤©ä»¥1000ç¾å…ƒçš„ä»·æ ¼è¢«ä¹°èµ°ï¼Œåœ¨ç¬¬10å¤©ä»¥10000ç¾å…ƒçš„ä»·æ ¼è¢«å–æ‰ã€‚èµ„æœ¬æŸç›Šæ˜¯æ¯æ¬¡ï¼ˆâ€™Buy&#x27;-&gt;&#x27;Sell&#x27;ï¼‰æ“ä½œèµ„æœ¬æ”¶ç›Šæˆ–æŸå¤±çš„å’Œ=ï¼ˆ1010-10ï¼‰+ï¼ˆ500-1000ï¼‰+ï¼ˆ10000-1000ï¼‰=1000-500+9000=9500ç¾å…ƒã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> stock_name,sell<span class="operator">-</span>buy capital_gain_loss</span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line"><span class="keyword">select</span> stock_name ,</span><br><span class="line">       <span class="built_in">sum</span>(if(operation<span class="operator">=</span><span class="string">&#x27;Buy&#x27;</span>, price,<span class="number">0</span>))<span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> stock_name ) buy,</span><br><span class="line">       <span class="built_in">sum</span>(if(operation<span class="operator">=</span><span class="string">&#x27;Sell&#x27;</span>,price,<span class="number">0</span>))<span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> stock_name) sell</span><br><span class="line"><span class="keyword">from</span> Stocks s</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> stock_name,buy,sell</span><br></pre></td></tr></table></figure><h4 id="1398-è´­ä¹°äº†äº§å“Aå’Œäº§å“Bå´æ²¡æœ‰è´­ä¹°äº§å“Cçš„é¡¾å®¢"><a href="#1398-è´­ä¹°äº†äº§å“Aå’Œäº§å“Bå´æ²¡æœ‰è´­ä¹°äº§å“Cçš„é¡¾å®¢" class="headerlink" title="1398. è´­ä¹°äº†äº§å“Aå’Œäº§å“Bå´æ²¡æœ‰è´­ä¹°äº§å“Cçš„é¡¾å®¢"></a><a href="https://leetcode-cn.com/problems/customers-who-bought-products-a-and-b-but-not-c/">1398. è´­ä¹°äº†äº§å“Aå’Œäº§å“Bå´æ²¡æœ‰è´­ä¹°äº§å“Cçš„é¡¾å®¢</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p> <code>Customers</code> è¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------------+---------+</span><br><span class="line">| Column Name         | Type    |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">| customer_id         | int     |</span><br><span class="line">| customer_name       | varchar |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">customer_id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">customer_name æ˜¯é¡¾å®¢çš„åç§°ã€‚</span><br></pre></td></tr></table></figure><p><code>Orders</code> è¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| order_id      | int     |</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| product_name  | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">order_id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚</span><br><span class="line">customer_id æ˜¯è´­ä¹°äº†åä¸º &quot;product_name&quot; äº§å“é¡¾å®¢çš„idã€‚</span><br></pre></td></tr></table></figure><p>è¯·ä½ è®¾è®¡ SQL æŸ¥è¯¢æ¥æŠ¥å‘Šè´­ä¹°äº†äº§å“ A å’Œäº§å“ B å´æ²¡æœ‰è´­ä¹°äº§å“ C çš„é¡¾å®¢çš„ ID å’Œå§“åï¼ˆ <code>customer_id</code> å’Œ <code>customer_name</code> ï¼‰ï¼Œæˆ‘ä»¬å°†åŸºäºæ­¤ç»“æœä¸ºä»–ä»¬æ¨èäº§å“ C ã€‚<br>æ‚¨è¿”å›çš„æŸ¥è¯¢ç»“æœéœ€è¦æŒ‰ç…§ <code>customer_id</code> <strong>æ’åº</strong>ã€‚</p><p>æŸ¥è¯¢ç»“æœå¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Customers table:</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| customer_id | customer_name |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 1           | Daniel        |</span><br><span class="line">| 2           | Diana         |</span><br><span class="line">| 3           | Elizabeth     |</span><br><span class="line">| 4           | Jhon          |</span><br><span class="line">+-------------+---------------+</span><br><span class="line"></span><br><span class="line">Orders table:</span><br><span class="line">+------------+--------------+---------------+</span><br><span class="line">| order_id   | customer_id  | product_name  |</span><br><span class="line">+------------+--------------+---------------+</span><br><span class="line">| 10         |     1        |     A         |</span><br><span class="line">| 20         |     1        |     B         |</span><br><span class="line">| 30         |     1        |     D         |</span><br><span class="line">| 40         |     1        |     C         |</span><br><span class="line">| 50         |     2        |     A         |</span><br><span class="line">| 60         |     3        |     A         |</span><br><span class="line">| 70         |     3        |     B         |</span><br><span class="line">| 80         |     3        |     D         |</span><br><span class="line">| 90         |     4        |     C         |</span><br><span class="line">+------------+--------------+---------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| customer_id | customer_name |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 3           | Elizabeth     |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">åªæœ‰ customer_id ä¸º 3 çš„é¡¾å®¢è´­ä¹°äº†äº§å“ A å’Œäº§å“ B ï¼Œå´æ²¡æœ‰è´­ä¹°äº§å“ C ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  o.customer_id, customer_name </span><br><span class="line"><span class="keyword">from</span> Orders o <span class="keyword">left</span> <span class="keyword">join</span>  Customers c</span><br><span class="line"><span class="keyword">on</span> o.customer_id<span class="operator">=</span>c.customer_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> customer_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">sum</span>(product_name <span class="operator">=</span><span class="string">&#x27;A&#x27;</span>)<span class="operator">&gt;=</span><span class="number">1</span> <span class="keyword">and</span> <span class="built_in">sum</span>(product_name<span class="operator">=</span><span class="string">&#x27;B&#x27;</span>)<span class="operator">&gt;=</span><span class="number">1</span> <span class="keyword">and</span> <span class="built_in">sum</span>(product_name<span class="operator">=</span><span class="string">&#x27;C&#x27;</span>)<span class="operator">=</span><span class="number">0</span></span><br></pre></td></tr></table></figure><h4 id="1407-æ’åé å‰çš„æ—…è¡Œè€…"><a href="#1407-æ’åé å‰çš„æ—…è¡Œè€…" class="headerlink" title="1407. æ’åé å‰çš„æ—…è¡Œè€…"></a><a href="https://leetcode-cn.com/problems/top-travellers/">1407. æ’åé å‰çš„æ—…è¡Œè€…</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>è¡¨å•: <code>Users</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id æ˜¯è¯¥è¡¨å•ä¸»é”®.</span><br><span class="line">name æ˜¯ç”¨æˆ·åå­—.</span><br></pre></td></tr></table></figure><p>è¡¨å•: <code>Rides</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| distance      | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id æ˜¯è¯¥è¡¨å•ä¸»é”®.</span><br><span class="line">user_id æ˜¯æœ¬æ¬¡è¡Œç¨‹çš„ç”¨æˆ·çš„ id, è€Œè¯¥ç”¨æˆ·æ­¤æ¬¡è¡Œç¨‹è·ç¦»ä¸º distance.</span><br></pre></td></tr></table></figure><p>å†™ä¸€æ®µ SQL , æŠ¥å‘Šæ¯ä¸ªç”¨æˆ·çš„æ—…è¡Œè·ç¦».</p><p>è¿”å›çš„ç»“æœè¡¨å•, ä»¥ <code>travelled_distance</code> é™åºæ’åˆ—, å¦‚æœæœ‰ä¸¤ä¸ªæˆ–è€…æ›´å¤šçš„ç”¨æˆ·æ—…è¡Œäº†ç›¸åŒçš„è·ç¦», é‚£ä¹ˆå†ä»¥ <code>name</code> å‡åºæ’åˆ—.</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼, å¦‚ä¸‹ä¾‹æ‰€ç¤º.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Users è¡¨å•:</span><br><span class="line">+------+-----------+</span><br><span class="line">| id   | name      |</span><br><span class="line">+------+-----------+</span><br><span class="line">| 1    | Alice     |</span><br><span class="line">| 2    | Bob       |</span><br><span class="line">| 3    | Alex      |</span><br><span class="line">| 4    | Donald    |</span><br><span class="line">| 7    | Lee       |</span><br><span class="line">| 13   | Jonathan  |</span><br><span class="line">| 19   | Elvis     |</span><br><span class="line">+------+-----------+</span><br><span class="line"></span><br><span class="line">Rides è¡¨å•:</span><br><span class="line">+------+----------+----------+</span><br><span class="line">| id   | user_id  | distance |</span><br><span class="line">+------+----------+----------+</span><br><span class="line">| 1    | 1        | 120      |</span><br><span class="line">| 2    | 2        | 317      |</span><br><span class="line">| 3    | 3        | 222      |</span><br><span class="line">| 4    | 7        | 100      |</span><br><span class="line">| 5    | 13       | 312      |</span><br><span class="line">| 6    | 19       | 50       |</span><br><span class="line">| 7    | 7        | 120      |</span><br><span class="line">| 8    | 19       | 400      |</span><br><span class="line">| 9    | 7        | 230      |</span><br><span class="line">+------+----------+----------+</span><br><span class="line"></span><br><span class="line">Result è¡¨å•:</span><br><span class="line">+----------+--------------------+</span><br><span class="line">| name     | travelled_distance |</span><br><span class="line">+----------+--------------------+</span><br><span class="line">| Elvis    | 450                |</span><br><span class="line">| Lee      | 450                |</span><br><span class="line">| Bob      | 317                |</span><br><span class="line">| Jonathan | 312                |</span><br><span class="line">| Alex     | 222                |</span><br><span class="line">| Alice    | 120                |</span><br><span class="line">| Donald   | 0                  |</span><br><span class="line">+----------+--------------------+</span><br><span class="line">Elvis å’Œ Lee æ—…è¡Œäº† 450 è‹±é‡Œ, Elvis æ˜¯æ’åé å‰çš„æ—…è¡Œè€…, å› ä¸ºä»–çš„åå­—åœ¨å­—æ¯è¡¨ä¸Šçš„æ’åºæ¯” Lee æ›´å°.</span><br><span class="line">Bob, Jonathan, Alex å’Œ Alice åªæœ‰ä¸€æ¬¡è¡Œç¨‹, æˆ‘ä»¬åªæŒ‰æ­¤æ¬¡è¡Œç¨‹çš„å…¨éƒ¨è·ç¦»å¯¹ä»–ä»¬æ’åº.</span><br><span class="line">Donald æ²¡æœ‰ä»»ä½•è¡Œç¨‹, ä»–çš„æ—…è¡Œè·ç¦»ä¸º 0.</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name,<span class="built_in">sum</span>(ifnull(distance,<span class="number">0</span>)) travelled_distance </span><br><span class="line"><span class="keyword">from</span> Users u <span class="keyword">left</span> <span class="keyword">join</span> Rides r</span><br><span class="line"><span class="keyword">on</span> u.id <span class="operator">=</span> r.user_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> name</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> travelled_distance  <span class="keyword">desc</span>, name </span><br></pre></td></tr></table></figure><h4 id="1412-æŸ¥æ‰¾æˆç»©å¤„äºä¸­æ¸¸çš„å­¦ç”Ÿ"><a href="#1412-æŸ¥æ‰¾æˆç»©å¤„äºä¸­æ¸¸çš„å­¦ç”Ÿ" class="headerlink" title="1412. æŸ¥æ‰¾æˆç»©å¤„äºä¸­æ¸¸çš„å­¦ç”Ÿ"></a><a href="https://leetcode-cn.com/problems/find-the-quiet-students-in-all-exams/">1412. æŸ¥æ‰¾æˆç»©å¤„äºä¸­æ¸¸çš„å­¦ç”Ÿ</a></h4><p>éš¾åº¦å›°éš¾</p><p>SQLæ¶æ„</p><p>è¡¨: <code>Student</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------------+---------+</span><br><span class="line">| Column Name         | Type    |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">| student_id          | int     |</span><br><span class="line">| student_name        | varchar |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">student_id æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">student_name å­¦ç”Ÿåå­—.</span><br></pre></td></tr></table></figure><p>è¡¨: <code>Exam</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| exam_id       | int     |</span><br><span class="line">| student_id    | int     |</span><br><span class="line">| score         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(exam_id, student_id) æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">å­¦ç”Ÿ student_id åœ¨æµ‹éªŒ exam_id ä¸­å¾—åˆ†ä¸º score.</span><br></pre></td></tr></table></figure><p>æˆç»©å¤„äºä¸­æ¸¸çš„å­¦ç”Ÿæ˜¯æŒ‡è‡³å°‘å‚åŠ äº†ä¸€æ¬¡æµ‹éªŒ, ä¸”å¾—åˆ†æ—¢ä¸æ˜¯æœ€é«˜åˆ†ä¹Ÿä¸æ˜¯æœ€ä½åˆ†çš„å­¦ç”Ÿã€‚</p><p>å†™ä¸€ä¸ª SQL è¯­å¥ï¼Œæ‰¾å‡ºåœ¨æ‰€æœ‰æµ‹éªŒä¸­éƒ½å¤„äºä¸­æ¸¸çš„å­¦ç”Ÿ <code>(student_id, student_name)</code>ã€‚</p><p>ä¸è¦è¿”å›ä»æ¥æ²¡æœ‰å‚åŠ è¿‡æµ‹éªŒçš„å­¦ç”Ÿã€‚è¿”å›ç»“æœè¡¨æŒ‰ç…§ <code>student_id</code> æ’åºã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">Student è¡¨ï¼š</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| student_id  | student_name  |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 1           | Daniel        |</span><br><span class="line">| 2           | Jade          |</span><br><span class="line">| 3           | Stella        |</span><br><span class="line">| 4           | Jonathan      |</span><br><span class="line">| 5           | Will          |</span><br><span class="line">+-------------+---------------+</span><br><span class="line"></span><br><span class="line">Exam è¡¨ï¼š</span><br><span class="line">+------------+--------------+-----------+</span><br><span class="line">| exam_id    | student_id   | score     |</span><br><span class="line">+------------+--------------+-----------+</span><br><span class="line">| 10         |     1        |    70     |</span><br><span class="line">| 10         |     2        |    80     |</span><br><span class="line">| 10         |     3        |    90     |</span><br><span class="line">| 20         |     1        |    80     |</span><br><span class="line">| 30         |     1        |    70     |</span><br><span class="line">| 30         |     3        |    80     |</span><br><span class="line">| 30         |     4        |    90     |</span><br><span class="line">| 40         |     1        |    60     |</span><br><span class="line">| 40         |     2        |    70     |</span><br><span class="line">| 40         |     4        |    80     |</span><br><span class="line">+------------+--------------+-----------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| student_id  | student_name  |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 2           | Jade          |</span><br><span class="line">+-------------+---------------+</span><br><span class="line"></span><br><span class="line">å¯¹äºæµ‹éªŒ 1: å­¦ç”Ÿ 1 å’Œ 3 åˆ†åˆ«è·å¾—äº†æœ€ä½åˆ†å’Œæœ€é«˜åˆ†ã€‚</span><br><span class="line">å¯¹äºæµ‹éªŒ 2: å­¦ç”Ÿ 1 æ—¢è·å¾—äº†æœ€é«˜åˆ†, ä¹Ÿè·å¾—äº†æœ€ä½åˆ†ã€‚</span><br><span class="line">å¯¹äºæµ‹éªŒ 3 å’Œ 4: å­¦ç”Ÿ 1 å’Œ 4 åˆ†åˆ«è·å¾—äº†æœ€ä½åˆ†å’Œæœ€é«˜åˆ†ã€‚</span><br><span class="line">å­¦ç”Ÿ 2 å’Œ 5 æ²¡æœ‰åœ¨ä»»ä¸€åœºæµ‹éªŒä¸­è·å¾—äº†æœ€é«˜åˆ†æˆ–è€…æœ€ä½åˆ†ã€‚</span><br><span class="line">å› ä¸ºå­¦ç”Ÿ 5 ä»æ¥æ²¡æœ‰å‚åŠ è¿‡ä»»ä½•æµ‹éªŒ, æ‰€ä»¥ä»–è¢«æ’é™¤äºç»“æœè¡¨ã€‚</span><br><span class="line">ç”±æ­¤, æˆ‘ä»¬ä»…ä»…è¿”å›å­¦ç”Ÿ 2 çš„ä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.student_id,student_name</span><br><span class="line"><span class="keyword">from</span> Exam e <span class="keyword">left</span> <span class="keyword">join</span> Student s</span><br><span class="line"><span class="keyword">on</span> e.student_id<span class="operator">=</span>s.student_id</span><br><span class="line"><span class="keyword">where</span> e.student_id <span class="keyword">not</span> <span class="keyword">in</span>(</span><br><span class="line">    <span class="keyword">select</span> student_id</span><br><span class="line">    <span class="keyword">from</span>(</span><br><span class="line">        <span class="keyword">select</span> student_id,<span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> exam_id <span class="keyword">order</span> <span class="keyword">by</span> score <span class="keyword">desc</span>) rkmax, <span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> exam_id <span class="keyword">order</span> <span class="keyword">by</span> score ) rkmin</span><br><span class="line">        <span class="keyword">from</span> Exam </span><br><span class="line">    )t1</span><br><span class="line">    <span class="keyword">where</span> rkmax <span class="operator">=</span> <span class="number">1</span> <span class="keyword">or</span> rkmin <span class="operator">=</span><span class="number">1</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> e.student_id,student_name</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> e.student_id </span><br></pre></td></tr></table></figure><h4 id="1421-å‡€ç°å€¼æŸ¥è¯¢"><a href="#1421-å‡€ç°å€¼æŸ¥è¯¢" class="headerlink" title="1421. å‡€ç°å€¼æŸ¥è¯¢"></a><a href="https://leetcode-cn.com/problems/npv-queries/">1421. å‡€ç°å€¼æŸ¥è¯¢</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>è¡¨: <code>NPV</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| year          | int     |</span><br><span class="line">| npv           | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(id, year) æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">è¯¥è¡¨æœ‰æ¯ä¸€ç¬”å­˜è´§çš„å¹´ä»½, id å’Œå¯¹åº”å‡€ç°å€¼çš„ä¿¡æ¯.</span><br></pre></td></tr></table></figure><p>è¡¨: <code>Queries</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| year          | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(id, year) æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">è¯¥è¡¨æœ‰æ¯ä¸€æ¬¡æŸ¥è¯¢æ‰€å¯¹åº”å­˜è´§çš„ id å’Œå¹´ä»½çš„ä¿¡æ¯.</span><br></pre></td></tr></table></figure><p>å†™ä¸€ä¸ª SQL, æ‰¾åˆ° Queries è¡¨ä¸­æ¯ä¸€æ¬¡æŸ¥è¯¢çš„å‡€ç°å€¼.</p><p>ç»“æœè¡¨æ²¡æœ‰é¡ºåºè¦æ±‚.</p><p>æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">NPV è¡¨:</span><br><span class="line">+------+--------+--------+</span><br><span class="line">| id   | year   | npv    |</span><br><span class="line">+------+--------+--------+</span><br><span class="line">| 1    | 2018   | 100    |</span><br><span class="line">| 7    | 2020   | 30     |</span><br><span class="line">| 13   | 2019   | 40     |</span><br><span class="line">| 1    | 2019   | 113    |</span><br><span class="line">| 2    | 2008   | 121    |</span><br><span class="line">| 3    | 2009   | 12     |</span><br><span class="line">| 11   | 2020   | 99     |</span><br><span class="line">| 7    | 2019   | 0      |</span><br><span class="line">+------+--------+--------+</span><br><span class="line"></span><br><span class="line">Queries è¡¨:</span><br><span class="line">+------+--------+</span><br><span class="line">| id   | year   |</span><br><span class="line">+------+--------+</span><br><span class="line">| 1    | 2019   |</span><br><span class="line">| 2    | 2008   |</span><br><span class="line">| 3    | 2009   |</span><br><span class="line">| 7    | 2018   |</span><br><span class="line">| 7    | 2019   |</span><br><span class="line">| 7    | 2020   |</span><br><span class="line">| 13   | 2019   |</span><br><span class="line">+------+--------+</span><br><span class="line"></span><br><span class="line">ç»“æœè¡¨:</span><br><span class="line">+------+--------+--------+</span><br><span class="line">| id   | year   | npv    |</span><br><span class="line">+------+--------+--------+</span><br><span class="line">| 1    | 2019   | 113    |</span><br><span class="line">| 2    | 2008   | 121    |</span><br><span class="line">| 3    | 2009   | 12     |</span><br><span class="line">| 7    | 2018   | 0      |</span><br><span class="line">| 7    | 2019   | 0      |</span><br><span class="line">| 7    | 2020   | 30     |</span><br><span class="line">| 13   | 2019   | 40     |</span><br><span class="line">+------+--------+--------+</span><br><span class="line"></span><br><span class="line">(7, 2018)çš„å‡€ç°å€¼ä¸åœ¨ NPV è¡¨ä¸­, æˆ‘ä»¬æŠŠå®ƒçœ‹ä½œæ˜¯ 0.</span><br><span class="line">æ‰€æœ‰å…¶å®ƒæŸ¥è¯¢çš„å‡€ç°å€¼éƒ½èƒ½åœ¨ NPV è¡¨ä¸­æ‰¾åˆ°.</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> q.id,q.year,ifnull(npv,<span class="number">0</span>) npv</span><br><span class="line"><span class="keyword">from</span> Queries q <span class="keyword">left</span> <span class="keyword">join</span> NPV n</span><br><span class="line"><span class="keyword">on</span> q.id <span class="operator">=</span> n.id <span class="keyword">and</span> q.year <span class="operator">=</span> n.year</span><br></pre></td></tr></table></figure><blockquote><p>npv å‡€ç°å€¼æ¦‚å¿µ äº†è§£ä¸‹</p></blockquote><h4 id="1435-åˆ¶ä½œä¼šè¯æŸ±çŠ¶å›¾"><a href="#1435-åˆ¶ä½œä¼šè¯æŸ±çŠ¶å›¾" class="headerlink" title="1435. åˆ¶ä½œä¼šè¯æŸ±çŠ¶å›¾"></a><a href="https://leetcode-cn.com/problems/create-a-session-bar-chart/">1435. åˆ¶ä½œä¼šè¯æŸ±çŠ¶å›¾</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>è¡¨ï¼š<code>Sessions</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------------+---------+</span><br><span class="line">| Column Name         | Type    |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">| session_id          | int     |</span><br><span class="line">| duration            | int     |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">session_id æ˜¯è¯¥è¡¨ä¸»é”®</span><br><span class="line">duration æ˜¯ç”¨æˆ·è®¿é—®åº”ç”¨çš„æ—¶é—´, ä»¥ç§’ä¸ºå•ä½</span><br></pre></td></tr></table></figure><p>ä½ æƒ³çŸ¥é“ç”¨æˆ·åœ¨ä½ çš„ app ä¸Šçš„è®¿é—®æ—¶é•¿æƒ…å†µã€‚å› æ­¤å†³å®šç»Ÿè®¡è®¿é—®æ—¶é•¿åŒºé—´åˆ†åˆ«ä¸º â€œ[0-5&gt;â€, â€œ[5-10&gt;â€, â€œ[10-15&gt;â€ å’Œ â€œ15 or moreâ€ ï¼ˆå•ä½ï¼šåˆ†é’Ÿï¼‰çš„ä¼šè¯æ•°é‡ï¼Œå¹¶ä»¥æ­¤ç»˜åˆ¶æŸ±çŠ¶å›¾ã€‚</p><p>å†™ä¸€ä¸ªSQLæŸ¥è¯¢æ¥æŠ¥å‘Šï¼ˆè®¿é—®æ—¶é•¿åŒºé—´ï¼Œä¼šè¯æ€»æ•°ï¼‰ã€‚ç»“æœå¯ç”¨ä»»ä½•é¡ºåºå‘ˆç°ã€‚</p><p><strong>ä¸‹æ–¹ä¸ºæŸ¥è¯¢çš„è¾“å‡ºæ ¼å¼ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Sessions è¡¨ï¼š</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| session_id  | duration      |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 1           | 30            |</span><br><span class="line">| 2           | 199           |</span><br><span class="line">| 3           | 299           |</span><br><span class="line">| 4           | 580           |</span><br><span class="line">| 5           | 1000          |</span><br><span class="line">+-------------+---------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+--------------+--------------+</span><br><span class="line">| bin          | total        |</span><br><span class="line">+--------------+--------------+</span><br><span class="line">| [0-5&gt;        | 3            |</span><br><span class="line">| [5-10&gt;       | 1            |</span><br><span class="line">| [10-15&gt;      | 0            |</span><br><span class="line">| 15 or more   | 1            |</span><br><span class="line">+--------------+--------------+</span><br><span class="line"></span><br><span class="line">å¯¹äº session_id 1ï¼Œ2 å’Œ 3 ï¼Œå®ƒä»¬çš„è®¿é—®æ—¶é—´å¤§äºç­‰äº 0 åˆ†é’Ÿä¸”å°äº 5 åˆ†é’Ÿã€‚</span><br><span class="line">å¯¹äº session_id 4ï¼Œå®ƒçš„è®¿é—®æ—¶é—´å¤§äºç­‰äº 5 åˆ†é’Ÿä¸”å°äº 10 åˆ†é’Ÿã€‚</span><br><span class="line">æ²¡æœ‰ä¼šè¯çš„è®¿é—®æ—¶é—´å¤§äºç­‰äº 10 åˆ†é’Ÿä¸”å°äº 15 åˆ†é’Ÿã€‚</span><br><span class="line">å¯¹äº session_id 5, å®ƒçš„è®¿é—®æ—¶é—´å¤§äºç­‰äº 15 åˆ†é’Ÿã€‚</span><br></pre></td></tr></table></figure><p>Union</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;[0-5&gt;&#x27;</span> <span class="keyword">as</span> bin, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> total <span class="keyword">from</span> Sessions <span class="keyword">where</span> duration<span class="operator">/</span><span class="number">60</span><span class="operator">&gt;=</span><span class="number">0</span> <span class="keyword">and</span> duration<span class="operator">/</span><span class="number">60</span><span class="operator">&lt;</span><span class="number">5</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;[5-10&gt;&#x27;</span> <span class="keyword">as</span> bin, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> total <span class="keyword">from</span> Sessions <span class="keyword">where</span> duration<span class="operator">/</span><span class="number">60</span><span class="operator">&gt;=</span><span class="number">5</span> <span class="keyword">and</span> duration<span class="operator">/</span><span class="number">60</span><span class="operator">&lt;</span><span class="number">10</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;[10-15&gt;&#x27;</span> <span class="keyword">as</span> bin, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> total <span class="keyword">from</span> Sessions <span class="keyword">where</span> duration<span class="operator">/</span><span class="number">60</span><span class="operator">&gt;=</span><span class="number">10</span> <span class="keyword">and</span> duration<span class="operator">/</span><span class="number">60</span><span class="operator">&lt;</span><span class="number">15</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;15 or more&#x27;</span><span class="keyword">as</span> bin, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> total <span class="keyword">from</span> Sessions <span class="keyword">where</span> duration<span class="operator">/</span><span class="number">60</span><span class="operator">&gt;=</span><span class="number">15</span></span><br></pre></td></tr></table></figure><p>è¿˜æœ‰å¾ˆå¤šå…¶ä»–è§£æ³•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.bin, <span class="built_in">count</span>(b.bin) <span class="keyword">as</span> total</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> <span class="string">&#x27;[0-5&gt;&#x27;</span> <span class="keyword">as</span> bin <span class="keyword">union</span> <span class="keyword">select</span> <span class="string">&#x27;[5-10&gt;&#x27;</span> <span class="keyword">as</span> bin <span class="keyword">union</span> <span class="keyword">select</span> <span class="string">&#x27;[10-15&gt;&#x27;</span> <span class="keyword">as</span> bin <span class="keyword">union</span> <span class="keyword">select</span> <span class="string">&#x27;15 or more&#x27;</span> <span class="keyword">as</span> bin </span><br><span class="line">)a</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">case</span></span><br><span class="line">        <span class="keyword">when</span> duration <span class="operator">&lt;</span> <span class="number">300</span> <span class="keyword">then</span> <span class="string">&#x27;[0-5&gt;&#x27;</span></span><br><span class="line">        <span class="keyword">when</span> duration <span class="operator">&gt;=</span> <span class="number">300</span> <span class="keyword">and</span> duration <span class="operator">&lt;</span> <span class="number">600</span> <span class="keyword">then</span> <span class="string">&#x27;[5-10&gt;&#x27;</span></span><br><span class="line">        <span class="keyword">when</span> duration <span class="operator">&gt;=</span> <span class="number">600</span> <span class="keyword">and</span> duration <span class="operator">&lt;</span> <span class="number">900</span> <span class="keyword">then</span> <span class="string">&#x27;[10-15&gt;&#x27;</span></span><br><span class="line">        <span class="keyword">else</span> <span class="string">&#x27;15 or more&#x27;</span></span><br><span class="line">        <span class="keyword">end</span> bin</span><br><span class="line">    <span class="keyword">from</span> Sessions </span><br><span class="line">)b</span><br><span class="line"><span class="keyword">on</span> a.bin <span class="operator">=</span> b.bin</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> a.bin</span><br></pre></td></tr></table></figure><h4 id="1440-è®¡ç®—å¸ƒå°”è¡¨è¾¾å¼çš„å€¼"><a href="#1440-è®¡ç®—å¸ƒå°”è¡¨è¾¾å¼çš„å€¼" class="headerlink" title="1440. è®¡ç®—å¸ƒå°”è¡¨è¾¾å¼çš„å€¼"></a><a href="https://leetcode-cn.com/problems/evaluate-boolean-expression/">1440. è®¡ç®—å¸ƒå°”è¡¨è¾¾å¼çš„å€¼</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>è¡¨ <code>Variables</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| name          | varchar |</span><br><span class="line">| value         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">name æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">è¯¥è¡¨åŒ…å«äº†å­˜å‚¨çš„å˜é‡åŠå…¶å¯¹åº”çš„å€¼.</span><br></pre></td></tr></table></figure><p>è¡¨ <code>Expressions</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| left_operand  | varchar |</span><br><span class="line">| operator      | enum    |</span><br><span class="line">| right_operand | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(left_operand, operator, right_operand) æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">è¯¥è¡¨åŒ…å«äº†éœ€è¦è®¡ç®—çš„å¸ƒå°”è¡¨è¾¾å¼.</span><br><span class="line">operator æ˜¯æšä¸¾ç±»å‹, å–å€¼äº(&#x27;&lt;&#x27;, &#x27;&gt;&#x27;, &#x27;=&#x27;)</span><br><span class="line">left_operand å’Œ right_operand çš„å€¼ä¿è¯å­˜åœ¨äº Variables è¡¨å•ä¸­.</span><br></pre></td></tr></table></figure><p>å†™ä¸€ä¸ª SQL æŸ¥è¯¢, ä»¥è®¡ç®—è¡¨ <code>Expressions</code> ä¸­çš„å¸ƒå°”è¡¨è¾¾å¼.</p><p>è¿”å›çš„ç»“æœè¡¨æ²¡æœ‰é¡ºåºè¦æ±‚.</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤º.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Variables è¡¨:</span><br><span class="line">+------+-------+</span><br><span class="line">| name | value |</span><br><span class="line">+------+-------+</span><br><span class="line">| x    | 66    |</span><br><span class="line">| y    | 77    |</span><br><span class="line">+------+-------+</span><br><span class="line"></span><br><span class="line">Expressions è¡¨:</span><br><span class="line">+--------------+----------+---------------+</span><br><span class="line">| left_operand | operator | right_operand |</span><br><span class="line">+--------------+----------+---------------+</span><br><span class="line">| x            | &gt;        | y             |</span><br><span class="line">| x            | &lt;        | y             |</span><br><span class="line">| x            | =        | y             |</span><br><span class="line">| y            | &gt;        | x             |</span><br><span class="line">| y            | &lt;        | x             |</span><br><span class="line">| x            | =        | x             |</span><br><span class="line">+--------------+----------+---------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+--------------+----------+---------------+-------+</span><br><span class="line">| left_operand | operator | right_operand | value |</span><br><span class="line">+--------------+----------+---------------+-------+</span><br><span class="line">| x            | &gt;        | y             | false |</span><br><span class="line">| x            | &lt;        | y             | true  |</span><br><span class="line">| x            | =        | y             | false |</span><br><span class="line">| y            | &gt;        | x             | true  |</span><br><span class="line">| y            | &lt;        | x             | false |</span><br><span class="line">| x            | =        | x             | true  |</span><br><span class="line">+--------------+----------+---------------+-------+</span><br><span class="line">å¦‚ä¸Šæ‰€ç¤º, ä½ éœ€è¦é€šè¿‡ä½¿ç”¨ Variables è¡¨æ¥æ‰¾åˆ° Expressions è¡¨ä¸­çš„æ¯ä¸€ä¸ªå¸ƒå°”è¡¨è¾¾å¼çš„å€¼.</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.left_operand,e.operator,e.right_operand,</span><br><span class="line"><span class="keyword">case</span> e.operator</span><br><span class="line">    <span class="keyword">when</span> <span class="string">&#x27;&gt;&#x27;</span> <span class="keyword">then</span> if(v1.value<span class="operator">&gt;</span>v2.value,<span class="string">&#x27;true&#x27;</span>,<span class="string">&#x27;false&#x27;</span>)</span><br><span class="line">    <span class="keyword">when</span> <span class="string">&#x27;&lt;&#x27;</span> <span class="keyword">then</span> if(v1.value<span class="operator">&lt;</span>v2.value,<span class="string">&#x27;true&#x27;</span>,<span class="string">&#x27;false&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>  if(v1.value<span class="operator">=</span>v2.value,<span class="string">&#x27;true&#x27;</span>,<span class="string">&#x27;false&#x27;</span>)</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">value</span></span><br><span class="line"><span class="keyword">from</span> Expressions e</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Variables v1 <span class="keyword">on</span> v1.name <span class="operator">=</span> e.left_operand </span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Variables v2 <span class="keyword">on</span> v2.name <span class="operator">=</span> e.right_operand</span><br></pre></td></tr></table></figure><h4 id="1445-è‹¹æœå’Œæ¡”å­"><a href="#1445-è‹¹æœå’Œæ¡”å­" class="headerlink" title="1445. è‹¹æœå’Œæ¡”å­"></a><a href="https://leetcode-cn.com/problems/apples-oranges/">1445. è‹¹æœå’Œæ¡”å­</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>è¡¨: <code>Sales</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| sale_date     | date    |</span><br><span class="line">| fruit         | enum    | </span><br><span class="line">| sold_num      | int     | </span><br><span class="line">+---------------+---------+</span><br><span class="line">(sale_date,fruit) æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">è¯¥è¡¨åŒ…å«äº†æ¯ä¸€å¤©ä¸­&quot;è‹¹æœ&quot; å’Œ &quot;æ¡”å­&quot;çš„é”€å”®æƒ…å†µ.</span><br></pre></td></tr></table></figure><p>å†™ä¸€ä¸ª SQL æŸ¥è¯¢, æŠ¥å‘Šæ¯ä¸€å¤© <strong>è‹¹æœ</strong> å’Œ <strong>æ¡”å­</strong> é”€å”®çš„æ•°ç›®çš„å·®å¼‚.</p><p>è¿”å›çš„ç»“æœè¡¨, æŒ‰ç…§æ ¼å¼ä¸º (â€˜YYYY-MM-DDâ€™) çš„ <code>sale_date</code> æ’åº.</p><p>æŸ¥è¯¢ç»“æœè¡¨å¦‚ä¸‹ä¾‹æ‰€ç¤º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Sales è¡¨:</span><br><span class="line">+------------+------------+-------------+</span><br><span class="line">| sale_date  | fruit      | sold_num    |</span><br><span class="line">+------------+------------+-------------+</span><br><span class="line">| 2020-05-01 | apples     | 10          |</span><br><span class="line">| 2020-05-01 | oranges    | 8           |</span><br><span class="line">| 2020-05-02 | apples     | 15          |</span><br><span class="line">| 2020-05-02 | oranges    | 15          |</span><br><span class="line">| 2020-05-03 | apples     | 20          |</span><br><span class="line">| 2020-05-03 | oranges    | 0           |</span><br><span class="line">| 2020-05-04 | apples     | 15          |</span><br><span class="line">| 2020-05-04 | oranges    | 16          |</span><br><span class="line">+------------+------------+-------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+------------+--------------+</span><br><span class="line">| sale_date  | diff         |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| 2020-05-01 | 2            |</span><br><span class="line">| 2020-05-02 | 0            |</span><br><span class="line">| 2020-05-03 | 20           |</span><br><span class="line">| 2020-05-04 | -1           |</span><br><span class="line">+------------+--------------+</span><br><span class="line"></span><br><span class="line">åœ¨ 2020-05-01, å–äº† 10 ä¸ªè‹¹æœ å’Œ 8 ä¸ªæ¡”å­ (å·®å¼‚ä¸º 10 - 8 = 2).</span><br><span class="line">åœ¨ 2020-05-02, å–äº† 15 ä¸ªè‹¹æœ å’Œ 15 ä¸ªæ¡”å­ (å·®å¼‚ä¸º 15 - 15 = 0).</span><br><span class="line">åœ¨ 2020-05-03, å–äº† 20 ä¸ªè‹¹æœ å’Œ 0 ä¸ªæ¡”å­ (å·®å¼‚ä¸º 20 - 0 = 20).</span><br><span class="line">åœ¨ 2020-05-04, å–äº† 15 ä¸ªè‹¹æœ å’Œ 16 ä¸ªæ¡”å­ (å·®å¼‚ä¸º 15 - 16 = -1).</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  sale_date,sold_num<span class="operator">-</span>ld diff</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> sale_date,sold_num , fruit ,<span class="built_in">lead</span>(sold_num ,<span class="number">1</span>,<span class="keyword">null</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span>  sale_date ) ld</span><br><span class="line"><span class="keyword">from</span> Sales</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> fruit<span class="operator">=</span><span class="string">&#x27;apples&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="1454-æ´»è·ƒç”¨æˆ·"><a href="#1454-æ´»è·ƒç”¨æˆ·" class="headerlink" title="1454.  æ´»è·ƒç”¨æˆ·"></a><a href="https://leetcode-cn.com/problems/active-users/">1454.  æ´»è·ƒç”¨æˆ·</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>è¡¨ <code>Accounts</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">è¯¥è¡¨åŒ…å«è´¦æˆ· id å’Œè´¦æˆ·çš„ç”¨æˆ·å.</span><br></pre></td></tr></table></figure><p>è¡¨ <code>Logins</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| login_date    | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">è¯¥è¡¨æ— ä¸»é”®, å¯èƒ½åŒ…å«é‡å¤é¡¹.</span><br><span class="line">è¯¥è¡¨åŒ…å«ç™»å½•ç”¨æˆ·çš„è´¦æˆ· id å’Œç™»å½•æ—¥æœŸ. ç”¨æˆ·ä¹Ÿè®¸ä¸€å¤©å†…ç™»å½•å¤šæ¬¡.</span><br></pre></td></tr></table></figure><p>å†™ä¸€ä¸ª SQL æŸ¥è¯¢, æ‰¾åˆ°æ´»è·ƒç”¨æˆ·çš„ id å’Œ name.</p><p>æ´»è·ƒç”¨æˆ·æ˜¯æŒ‡é‚£äº›è‡³å°‘è¿ç»­ 5 å¤©ç™»å½•è´¦æˆ·çš„ç”¨æˆ·.</p><p>è¿”å›çš„ç»“æœè¡¨æŒ‰ç…§ id æ’åº.</p><p>ç»“æœè¡¨æ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Accounts è¡¨:</span><br><span class="line">+----+----------+</span><br><span class="line">| id | name     |</span><br><span class="line">+----+----------+</span><br><span class="line">| 1  | Winston  |</span><br><span class="line">| 7  | Jonathan |</span><br><span class="line">+----+----------+</span><br><span class="line"></span><br><span class="line">Logins è¡¨:</span><br><span class="line">+----+------------+</span><br><span class="line">| id | login_date |</span><br><span class="line">+----+------------+</span><br><span class="line">| 7  | 2020-05-30 |</span><br><span class="line">| 1  | 2020-05-30 |</span><br><span class="line">| 7  | 2020-05-31 |</span><br><span class="line">| 7  | 2020-06-01 |</span><br><span class="line">| 7  | 2020-06-02 |</span><br><span class="line">| 7  | 2020-06-02 |</span><br><span class="line">| 7  | 2020-06-03 |</span><br><span class="line">| 1  | 2020-06-07 |</span><br><span class="line">| 7  | 2020-06-10 |</span><br><span class="line">+----+------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+----+----------+</span><br><span class="line">| id | name     |</span><br><span class="line">+----+----------+</span><br><span class="line">| 7  | Jonathan |</span><br><span class="line">+----+----------+</span><br><span class="line">id = 1 çš„ç”¨æˆ· Winston ä»…ä»…åœ¨ä¸åŒçš„ 2 å¤©å†…ç™»å½•äº† 2 æ¬¡, æ‰€ä»¥, Winston ä¸æ˜¯æ´»è·ƒç”¨æˆ·.</span><br><span class="line">id = 7 çš„ç”¨æˆ· Jonathon åœ¨ä¸åŒçš„ 6 å¤©å†…ç™»å½•äº† 7 æ¬¡, , 6 å¤©ä¸­æœ‰ 5 å¤©æ˜¯è¿ç»­çš„, æ‰€ä»¥, Jonathan æ˜¯æ´»è·ƒç”¨æˆ·.</span><br></pre></td></tr></table></figure><p><strong>åç»­é—®é¢˜:</strong><br>å¦‚æœæ´»è·ƒç”¨æˆ·æ˜¯é‚£äº›è‡³å°‘è¿ç»­ <code>n</code> å¤©ç™»å½•è´¦æˆ·çš„ç”¨æˆ·, ä½ èƒ½å¦å†™å‡ºé€šç”¨çš„è§£å†³æ–¹æ¡ˆ?</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> t3.id,name</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">distinct</span> id</span><br><span class="line">    <span class="keyword">from</span> </span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> id,login_date,<span class="built_in">lead</span>(login_date,<span class="number">4</span>,<span class="keyword">null</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> id <span class="keyword">order</span> <span class="keyword">by</span> login_date) ld</span><br><span class="line">        <span class="keyword">from</span> </span><br><span class="line">        (</span><br><span class="line">            <span class="keyword">select</span> id,login_date </span><br><span class="line">            <span class="keyword">from</span> Logins</span><br><span class="line">            <span class="keyword">group</span> <span class="keyword">by</span> id,login_date</span><br><span class="line">        )t1</span><br><span class="line">    )t2</span><br><span class="line">    <span class="keyword">where</span> datediff(ld,login_date)<span class="operator">=</span><span class="number">4</span></span><br><span class="line">)t3</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Accounts a</span><br><span class="line"><span class="keyword">on</span> t3.id <span class="operator">=</span> a.id</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ç”¨æˆ·å½“å¤©é‡å¤ç™»å…¥</p></blockquote><h4 id="1459-çŸ©å½¢é¢ç§¯"><a href="#1459-çŸ©å½¢é¢ç§¯" class="headerlink" title="1459. çŸ©å½¢é¢ç§¯"></a><a href="https://leetcode-cn.com/problems/rectangles-area/">1459. çŸ©å½¢é¢ç§¯</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>è¡¨: <code>Points</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| x_value       | int     |</span><br><span class="line">| y_value       | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">æ¯ä¸ªç‚¹éƒ½è¡¨ç¤ºä¸ºäºŒç»´ç©ºé—´ (x_value, y_value).</span><br></pre></td></tr></table></figure><p>å†™ä¸€ä¸ª SQL è¯­å¥, æŠ¥å‘Šç”±è¡¨ä¸­ä»»æ„ä¸¤ç‚¹å¯ä»¥å½¢æˆçš„æ‰€æœ‰å¯èƒ½çš„çŸ©å½¢. </p><p>ç»“æœè¡¨ä¸­çš„æ¯ä¸€è¡ŒåŒ…å«ä¸‰åˆ— (p1, p2, area) å¦‚ä¸‹:</p><ul><li><strong>p1</strong> å’Œ <strong>p2</strong> æ˜¯çŸ©å½¢ä¸¤ä¸ªå¯¹è§’çš„ id ä¸” p1 &lt; p2.</li><li>çŸ©å½¢çš„é¢ç§¯ç”±åˆ— <strong>area</strong> è¡¨ç¤º. </li></ul><p>è¯·æŒ‰ç…§é¢ç§¯å¤§å°é™åºæ’åˆ—ï¼Œå¦‚æœé¢ç§¯ç›¸åŒçš„è¯, åˆ™æŒ‰ç…§ p1 å’Œ p2 å‡åºå¯¹ç»“æœè¡¨æ’åº</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Points è¡¨:</span><br><span class="line">+----------+-------------+-------------+</span><br><span class="line">| id       | x_value     | y_value     |</span><br><span class="line">+----------+-------------+-------------+</span><br><span class="line">| 1        | 2           | 8           |</span><br><span class="line">| 2        | 4           | 7           |</span><br><span class="line">| 3        | 2           | 10          |</span><br><span class="line">+----------+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+----------+-------------+-------------+</span><br><span class="line">| p1       | p2          | area        |</span><br><span class="line">+----------+-------------+-------------+</span><br><span class="line">| 2        | 3           | 6           |</span><br><span class="line">| 1        | 2           | 2           |</span><br><span class="line">+----------+-------------+-------------+</span><br><span class="line"></span><br><span class="line">p1 åº”è¯¥å°äº p2 å¹¶ä¸”é¢ç§¯å¤§äº 0.</span><br><span class="line">p1 = 1 ä¸” p2 = 2 æ—¶, é¢ç§¯ç­‰äº |2-4| * |8-7| = 2.</span><br><span class="line">p1 = 2 ä¸” p2 = 3 æ—¶, é¢ç§¯ç­‰äº |4-2| * |7-10| = 6.</span><br><span class="line">p1 = 1 ä¸” p2 = 3 æ—¶, æ˜¯ä¸å¯èƒ½ä¸ºçŸ©å½¢çš„, å› ä¸ºé¢ç§¯ç­‰äº 0.</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.id P1,b.id P2,<span class="built_in">abs</span>(a.x_value<span class="operator">-</span>b.x_value)<span class="operator">*</span><span class="built_in">abs</span>(a.y_value<span class="operator">-</span>b.y_value) <span class="keyword">as</span> area</span><br><span class="line"><span class="keyword">from</span> Points a,Points b</span><br><span class="line"><span class="keyword">where</span> a.id<span class="operator">&lt;</span>b.id <span class="keyword">and</span> a.x_value <span class="operator">!=</span> b.x_value <span class="keyword">and</span> a.y_value <span class="operator">!=</span> b.y_value</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> area <span class="keyword">desc</span>,P1 ,P2 </span><br></pre></td></tr></table></figure><h4 id="1468-è®¡ç®—ç¨åå·¥èµ„"><a href="#1468-è®¡ç®—ç¨åå·¥èµ„" class="headerlink" title="1468. è®¡ç®—ç¨åå·¥èµ„"></a><a href="https://leetcode-cn.com/problems/calculate-salaries/">1468. è®¡ç®—ç¨åå·¥èµ„</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p><code>Salaries</code> è¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| company_id    | int     |</span><br><span class="line">| employee_id   | int     |</span><br><span class="line">| employee_name | varchar |</span><br><span class="line">| salary        | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(company_id, employee_id) æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®</span><br><span class="line">è¿™ä¸ªè¡¨åŒ…æ‹¬å‘˜å·¥çš„company id, id, name å’Œ salary </span><br></pre></td></tr></table></figure><p>å†™ä¸€æ¡æŸ¥è¯¢ SQL æ¥æŸ¥æ‰¾æ¯ä¸ªå‘˜å·¥çš„ç¨åå·¥èµ„</p><p>æ¯ä¸ªå…¬å¸çš„ç¨ç‡è®¡ç®—ä¾ç…§ä»¥ä¸‹è§„åˆ™</p><ul><li>å¦‚æœè¿™ä¸ªå…¬å¸å‘˜å·¥æœ€é«˜å·¥èµ„ä¸åˆ° 1000 ï¼Œç¨ç‡ä¸º 0%</li><li>å¦‚æœè¿™ä¸ªå…¬å¸å‘˜å·¥æœ€é«˜å·¥èµ„åœ¨ 1000 åˆ° 10000 ä¹‹é—´ï¼Œç¨ç‡ä¸º 24%</li><li>å¦‚æœè¿™ä¸ªå…¬å¸å‘˜å·¥æœ€é«˜å·¥èµ„å¤§äº 10000 ï¼Œç¨ç‡ä¸º 49%</li></ul><p>æŒ‰ä»»æ„é¡ºåºè¿”å›ç»“æœï¼Œç¨åå·¥èµ„ç»“æœå–æ•´</p><p>ç»“æœè¡¨æ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">Salaries è¡¨ï¼š</span><br><span class="line">+------------+-------------+---------------+--------+</span><br><span class="line">| company_id | employee_id | employee_name | salary |</span><br><span class="line">+------------+-------------+---------------+--------+</span><br><span class="line">| 1          | 1           | Tony          | 2000   |</span><br><span class="line">| 1          | 2           | Pronub        | 21300  |</span><br><span class="line">| 1          | 3           | Tyrrox        | 10800  |</span><br><span class="line">| 2          | 1           | Pam           | 300    |</span><br><span class="line">| 2          | 7           | Bassem        | 450    |</span><br><span class="line">| 2          | 9           | Hermione      | 700    |</span><br><span class="line">| 3          | 7           | Bocaben       | 100    |</span><br><span class="line">| 3          | 2           | Ognjen        | 2200   |</span><br><span class="line">| 3          | 13          | Nyancat       | 3300   |</span><br><span class="line">| 3          | 15          | Morninngcat   | 1866   |</span><br><span class="line">+------------+-------------+---------------+--------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+------------+-------------+---------------+--------+</span><br><span class="line">| company_id | employee_id | employee_name | salary |</span><br><span class="line">+------------+-------------+---------------+--------+</span><br><span class="line">| 1          | 1           | Tony          | 1020   |</span><br><span class="line">| 1          | 2           | Pronub        | 10863  |</span><br><span class="line">| 1          | 3           | Tyrrox        | 5508   |</span><br><span class="line">| 2          | 1           | Pam           | 300    |</span><br><span class="line">| 2          | 7           | Bassem        | 450    |</span><br><span class="line">| 2          | 9           | Hermione      | 700    |</span><br><span class="line">| 3          | 7           | Bocaben       | 76     |</span><br><span class="line">| 3          | 2           | Ognjen        | 1672   |</span><br><span class="line">| 3          | 13          | Nyancat       | 2508   |</span><br><span class="line">| 3          | 15          | Morninngcat   | 5911   |</span><br><span class="line">+------------+-------------+---------------+--------+</span><br><span class="line">å¯¹äºå…¬å¸ 1 ï¼Œæœ€é«˜å·¥èµ„æ˜¯ 21300 ï¼Œå…¶æ¯ä¸ªå‘˜å·¥çš„ç¨ç‡ä¸º 49%</span><br><span class="line">å¯¹äºå…¬å¸ 2 ï¼Œæœ€é«˜å·¥èµ„æ˜¯ 700 ï¼Œå…¶æ¯ä¸ªå‘˜å·¥ç¨ç‡ä¸º 0%</span><br><span class="line">å¯¹äºå…¬å¸ 3 ï¼Œæœ€é«˜å·¥èµ„æ˜¯ 7777 ï¼Œå…¶æ¯ä¸ªå‘˜å·¥ç¨ç‡æ˜¯ 24%</span><br><span class="line">ç¨åå·¥èµ„è®¡ç®— = å·¥èµ„ - ( ç¨ç‡ / 100ï¼‰*å·¥èµ„</span><br><span class="line">å¯¹äºä¸Šè¿°æ¡ˆä¾‹ï¼ŒMorninngcat çš„ç¨åå·¥èµ„ = 7777 - 7777 * ( 24 / 100) = 7777 - 1866.48 = 5910.52 ï¼Œå–æ•´ä¸º 5911</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> company_id,employee_id , employee_name,</span><br><span class="line">round(<span class="keyword">case</span> <span class="keyword">when</span> maxsalary<span class="operator">&lt;</span><span class="number">1000</span> <span class="keyword">then</span> salary</span><br><span class="line">       <span class="keyword">when</span> maxsalary<span class="operator">&lt;</span><span class="number">10000</span> <span class="keyword">then</span> salary<span class="operator">*</span>(<span class="number">1</span><span class="number">-0.24</span>)</span><br><span class="line">       <span class="keyword">else</span> salary<span class="operator">*</span>(<span class="number">1</span><span class="number">-0.49</span>) <span class="keyword">end</span> ,<span class="number">0</span>)salary</span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line">    <span class="keyword">select</span> <span class="operator">*</span>,<span class="built_in">max</span>(salary) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> company_id ) maxsalary</span><br><span class="line">    <span class="keyword">from</span> Salaries </span><br><span class="line">)t1</span><br></pre></td></tr></table></figure><h4 id="1479-å‘¨å†…æ¯å¤©çš„é”€å”®æƒ…å†µ"><a href="#1479-å‘¨å†…æ¯å¤©çš„é”€å”®æƒ…å†µ" class="headerlink" title="1479. å‘¨å†…æ¯å¤©çš„é”€å”®æƒ…å†µ"></a><a href="https://leetcode-cn.com/problems/sales-by-day-of-the-week/">1479. å‘¨å†…æ¯å¤©çš„é”€å”®æƒ…å†µ</a></h4><p>éš¾åº¦å›°éš¾</p><p>SQLæ¶æ„</p><p>è¡¨ï¼š<code>Orders</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| order_id      | int     |</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| order_date    | date    | </span><br><span class="line">| item_id       | varchar |</span><br><span class="line">| quantity      | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(order_id, item_id) æ˜¯è¯¥è¡¨ä¸»é”®</span><br><span class="line">è¯¥è¡¨åŒ…å«äº†è®¢å•ä¿¡æ¯</span><br><span class="line">order_date æ˜¯idä¸º item_id çš„å•†å“è¢«idä¸º customer_id çš„æ¶ˆè´¹è€…è®¢è´­çš„æ—¥æœŸ.</span><br></pre></td></tr></table></figure><p>è¡¨ï¼š<code>Items</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------------+---------+</span><br><span class="line">| Column Name         | Type    |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">| item_id             | varchar |</span><br><span class="line">| item_name           | varchar |</span><br><span class="line">| item_category       | varchar |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">item_id æ˜¯è¯¥è¡¨ä¸»é”®</span><br><span class="line">item_name æ˜¯å•†å“çš„åå­—</span><br><span class="line">item_category æ˜¯å•†å“çš„ç±»åˆ«</span><br></pre></td></tr></table></figure><p>ä½ æ˜¯ä¼ä¸šä¸»ï¼Œæƒ³è¦è·å¾—åˆ†ç±»å•†å“å’Œå‘¨å†…æ¯å¤©çš„é”€å”®æŠ¥å‘Šã€‚</p><p>å†™ä¸€ä¸ªSQLè¯­å¥ï¼ŒæŠ¥å‘Š <strong>å‘¨å†…æ¯å¤©</strong> æ¯ä¸ªå•†å“ç±»åˆ«ä¸‹è®¢è´­äº†å¤šå°‘å•ä½ã€‚</p><p>è¿”å›ç»“æœè¡¨å• <strong>æŒ‰å•†å“ç±»åˆ«æ’åº</strong> ã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">Orders è¡¨ï¼š</span><br><span class="line">+------------+--------------+-------------+--------------+-------------+</span><br><span class="line">| order_id   | customer_id  | order_date  | item_id      | quantity    |</span><br><span class="line">+------------+--------------+-------------+--------------+-------------+</span><br><span class="line">| 1          | 1            | 2020-06-01  | 1            | 10          |</span><br><span class="line">| 2          | 1            | 2020-06-08  | 2            | 10          |</span><br><span class="line">| 3          | 2            | 2020-06-02  | 1            | 5           |</span><br><span class="line">| 4          | 3            | 2020-06-03  | 3            | 5           |</span><br><span class="line">| 5          | 4            | 2020-06-04  | 4            | 1           |</span><br><span class="line">| 6          | 4            | 2020-06-05  | 5            | 5           |</span><br><span class="line">| 7          | 5            | 2020-06-05  | 1            | 10          |</span><br><span class="line">| 8          | 5            | 2020-06-14  | 4            | 5           |</span><br><span class="line">| 9          | 5            | 2020-06-21  | 3            | 5           |</span><br><span class="line">+------------+--------------+-------------+--------------+-------------+</span><br><span class="line"></span><br><span class="line">Items è¡¨ï¼š</span><br><span class="line">+------------+----------------+---------------+</span><br><span class="line">| item_id    | item_name      | item_category |</span><br><span class="line">+------------+----------------+---------------+</span><br><span class="line">| 1          | LC Alg. Book   | Book          |</span><br><span class="line">| 2          | LC DB. Book    | Book          |</span><br><span class="line">| 3          | LC SmarthPhone | Phone         |</span><br><span class="line">| 4          | LC Phone 2020  | Phone         |</span><br><span class="line">| 5          | LC SmartGlass  | Glasses       |</span><br><span class="line">| 6          | LC T-Shirt XL  | T-Shirt       |</span><br><span class="line">+------------+----------------+---------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+------------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+</span><br><span class="line">| Category   | Monday    | Tuesday   | Wednesday | Thursday  | Friday    | Saturday  | Sunday    |</span><br><span class="line">+------------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+</span><br><span class="line">| Book       | 20        | 5         | 0         | 0         | 10        | 0         | 0         |</span><br><span class="line">| Glasses    | 0         | 0         | 0         | 0         | 5         | 0         | 0         |</span><br><span class="line">| Phone      | 0         | 0         | 5         | 1         | 0         | 0         | 10        |</span><br><span class="line">| T-Shirt    | 0         | 0         | 0         | 0         | 0         | 0         | 0         |</span><br><span class="line">+------------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+</span><br><span class="line">åœ¨å‘¨ä¸€(2020-06-01, 2020-06-08)ï¼ŒBookåˆ†ç±»(ids: 1, 2)ä¸‹ï¼Œæ€»å…±é”€å”®äº†20ä¸ªå•ä½(10 + 10)</span><br><span class="line">åœ¨å‘¨äºŒ(2020-06-02)ï¼ŒBookåˆ†ç±»(ids: 1, 2)ä¸‹ï¼Œæ€»å…±é”€å”®äº†5ä¸ªå•ä½</span><br><span class="line">åœ¨å‘¨ä¸‰(2020-06-03)ï¼ŒPhoneåˆ†ç±»(ids: 3, 4)ä¸‹ï¼Œæ€»å…±é”€å”®äº†5ä¸ªå•ä½</span><br><span class="line">åœ¨å‘¨å››(2020-06-04)ï¼ŒPhoneåˆ†ç±»(ids: 3, 4)ä¸‹ï¼Œæ€»å…±é”€å”®äº†1ä¸ªå•ä½</span><br><span class="line">åœ¨å‘¨äº”(2020-06-05)ï¼ŒBookåˆ†ç±»(ids: 1, 2)ä¸‹ï¼Œæ€»å…±é”€å”®äº†10ä¸ªå•ä½ï¼ŒGlassesåˆ†ç±»(ids: 5)ä¸‹ï¼Œæ€»å…±é”€å”®äº†5ä¸ªå•ä½</span><br><span class="line">åœ¨å‘¨å…­, æ²¡æœ‰å•†å“é”€å”®</span><br><span class="line">åœ¨å‘¨å¤©(2020-06-14, 2020-06-21)ï¼ŒPhoneåˆ†ç±»(ids: 3, 4)ä¸‹ï¼Œæ€»å…±é”€å”®äº†10ä¸ªå•ä½(5 + 5)</span><br><span class="line">æ²¡æœ‰é”€å”® T-Shirt ç±»åˆ«çš„å•†å“</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> item_category <span class="keyword">as</span> category, </span><br><span class="line"><span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> num <span class="operator">=</span> <span class="number">2</span> <span class="keyword">then</span> quantity <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> Monday,</span><br><span class="line"><span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> num <span class="operator">=</span> <span class="number">3</span> <span class="keyword">then</span> quantity <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> Tuesday,</span><br><span class="line"><span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> num <span class="operator">=</span> <span class="number">4</span> <span class="keyword">then</span> quantity <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> Wednesday,</span><br><span class="line"><span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> num <span class="operator">=</span> <span class="number">5</span> <span class="keyword">then</span> quantity <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> Thursday,</span><br><span class="line"><span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> num <span class="operator">=</span> <span class="number">6</span> <span class="keyword">then</span> quantity <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> Friday,</span><br><span class="line"><span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> num <span class="operator">=</span> <span class="number">7</span> <span class="keyword">then</span> quantity <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> Saturday,</span><br><span class="line"><span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> num <span class="operator">=</span> <span class="number">1</span> <span class="keyword">then</span> quantity <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> Sunday</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> item_category, quantity,dayofweek(order_date) <span class="keyword">as</span> num <span class="keyword">from</span> </span><br><span class="line">items i <span class="keyword">left</span> <span class="keyword">join</span> orders o </span><br><span class="line"><span class="keyword">on</span> i.item_id<span class="operator">=</span>o.item_id) t</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> item_category</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> item_category</span><br></pre></td></tr></table></figure><h4 id="1485-æŒ‰æ—¥æœŸåˆ†ç»„é”€å”®äº§å“"><a href="#1485-æŒ‰æ—¥æœŸåˆ†ç»„é”€å”®äº§å“" class="headerlink" title="1485. æŒ‰æ—¥æœŸåˆ†ç»„é”€å”®äº§å“"></a><a href="https://leetcode-cn.com/problems/group-sold-products-by-the-date/">1485. æŒ‰æ—¥æœŸåˆ†ç»„é”€å”®äº§å“</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>è¡¨ <code>Activities</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| åˆ—å         | ç±»å‹    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| sell_date   | date    |</span><br><span class="line">| product     | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">æ­¤è¡¨æ²¡æœ‰ä¸»é”®ï¼Œå®ƒå¯èƒ½åŒ…å«é‡å¤é¡¹ã€‚</span><br><span class="line">æ­¤è¡¨çš„æ¯ä¸€è¡Œéƒ½åŒ…å«äº§å“åç§°å’Œåœ¨å¸‚åœºä¸Šé”€å”®çš„æ—¥æœŸã€‚</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢æ¥æŸ¥æ‰¾æ¯ä¸ªæ—¥æœŸã€é”€å”®çš„ä¸åŒäº§å“çš„æ•°é‡åŠå…¶åç§°ã€‚<br>æ¯ä¸ªæ—¥æœŸçš„é”€å”®äº§å“åç§°åº”æŒ‰è¯å…¸åºæ’åˆ—ã€‚<br>è¿”å›æŒ‰ <code>sell_date</code> æ’åºçš„ç»“æœè¡¨ã€‚</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Activities è¡¨ï¼š</span><br><span class="line">+------------+-------------+</span><br><span class="line">| sell_date  | product     |</span><br><span class="line">+------------+-------------+</span><br><span class="line">| 2020-05-30 | Headphone   |</span><br><span class="line">| 2020-06-01 | Pencil      |</span><br><span class="line">| 2020-06-02 | Mask        |</span><br><span class="line">| 2020-05-30 | Basketball  |</span><br><span class="line">| 2020-06-01 | Bible       |</span><br><span class="line">| 2020-06-02 | Mask        |</span><br><span class="line">| 2020-05-30 | T-Shirt     |</span><br><span class="line">+------------+-------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨ï¼š</span><br><span class="line">+------------+----------+------------------------------+</span><br><span class="line">| sell_date  | num_sold | products                     |</span><br><span class="line">+------------+----------+------------------------------+</span><br><span class="line">| 2020-05-30 | 3        | Basketball,Headphone,T-shirt |</span><br><span class="line">| 2020-06-01 | 2        | Bible,Pencil                 |</span><br><span class="line">| 2020-06-02 | 1        | Mask                         |</span><br><span class="line">+------------+----------+------------------------------+</span><br><span class="line">å¯¹äº2020-05-30ï¼Œå‡ºå”®çš„ç‰©å“æ˜¯ (Headphone, Basketball, T-shirt)ï¼ŒæŒ‰è¯å…¸åºæ’åˆ—ï¼Œå¹¶ç”¨é€—å· &#x27;,&#x27; åˆ†éš”ã€‚</span><br><span class="line">å¯¹äº2020-06-01ï¼Œå‡ºå”®çš„ç‰©å“æ˜¯ (Pencil, Bible)ï¼ŒæŒ‰è¯å…¸åºæ’åˆ—ï¼Œå¹¶ç”¨é€—å·åˆ†éš”ã€‚</span><br><span class="line">å¯¹äº2020-06-02ï¼Œå‡ºå”®çš„ç‰©å“æ˜¯ (Mask)ï¼Œåªéœ€è¿”å›è¯¥ç‰©å“åã€‚</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> sell_date, <span class="built_in">count</span>(<span class="keyword">distinct</span> product) num_sold, </span><br><span class="line">    group_concat(<span class="keyword">distinct</span> product <span class="keyword">order</span> <span class="keyword">by</span> product) products</span><br><span class="line"><span class="keyword">from</span> Activities</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> sell_date</span><br></pre></td></tr></table></figure><blockquote><p>è¡Œè½¬åˆ—</p></blockquote><h4 id="1495-ä¸Šæœˆæ’­æ”¾çš„å„¿ç«¥é€‚å®œç”µå½±"><a href="#1495-ä¸Šæœˆæ’­æ”¾çš„å„¿ç«¥é€‚å®œç”µå½±" class="headerlink" title="1495. ä¸Šæœˆæ’­æ”¾çš„å„¿ç«¥é€‚å®œç”µå½±"></a><a href="https://leetcode-cn.com/problems/friendly-movies-streamed-last-month/">1495. ä¸Šæœˆæ’­æ”¾çš„å„¿ç«¥é€‚å®œç”µå½±</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>è¡¨: <code>TVProgram</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| program_date  | date    |</span><br><span class="line">| content_id    | int     |</span><br><span class="line">| channel       | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(program_date, content_id) æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">è¯¥è¡¨åŒ…å«ç”µè§†ä¸Šçš„èŠ‚ç›®ä¿¡æ¯.</span><br><span class="line">content_id æ˜¯ç”µè§†ä¸€äº›é¢‘é“ä¸Šçš„èŠ‚ç›®çš„ id.</span><br></pre></td></tr></table></figure><p>è¡¨: <code>Content</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+------------------+---------+</span><br><span class="line">| Column Name      | Type    |</span><br><span class="line">+------------------+---------+</span><br><span class="line">| content_id       | varchar |</span><br><span class="line">| title            | varchar |</span><br><span class="line">| Kids_content     | enum    |</span><br><span class="line">| content_type     | varchar |</span><br><span class="line">+------------------+---------+</span><br><span class="line">content_id æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">Kids_content æ˜¯æšä¸¾ç±»å‹, å–å€¼ä¸º(&#x27;Y&#x27;, &#x27;N&#x27;), å…¶ä¸­: </span><br><span class="line">&#x27;Y&#x27; è¡¨ç¤ºå„¿ç«¥é€‚å®œå†…å®¹, è€Œ&#x27;N&#x27;è¡¨ç¤ºå„¿ç«¥ä¸å®œå†…å®¹.</span><br><span class="line">content_type è¡¨ç¤ºå†…å®¹çš„ç±»å‹, æ¯”å¦‚ç”µå½±, ç”µè§†å‰§ç­‰.</span><br></pre></td></tr></table></figure><p>å†™ä¸€ä¸ª SQL è¯­å¥, æŠ¥å‘Šåœ¨ 2020 å¹´ 6 æœˆä»½æ’­æ”¾çš„å„¿ç«¥é€‚å®œç”µå½±çš„å»é‡ç”µå½±å.</p><p>è¿”å›çš„ç»“æœè¡¨å•æ²¡æœ‰é¡ºåºè¦æ±‚.</p><p>æŸ¥è¯¢ç»“æœçš„æ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤º.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">TVProgram è¡¨:</span><br><span class="line">+--------------------+--------------+-------------+</span><br><span class="line">| program_date       | content_id   | channel     |</span><br><span class="line">+--------------------+--------------+-------------+</span><br><span class="line">| 2020-06-10 08:00   | 1            | LC-Channel  |</span><br><span class="line">| 2020-05-11 12:00   | 2            | LC-Channel  |</span><br><span class="line">| 2020-05-12 12:00   | 3            | LC-Channel  |</span><br><span class="line">| 2020-05-13 14:00   | 4            | Disney Ch   |</span><br><span class="line">| 2020-06-18 14:00   | 4            | Disney Ch   |</span><br><span class="line">| 2020-07-15 16:00   | 5            | Disney Ch   |</span><br><span class="line">+--------------------+--------------+-------------+</span><br><span class="line"></span><br><span class="line">Content è¡¨:</span><br><span class="line">+------------+----------------+---------------+---------------+</span><br><span class="line">| content_id | title          | Kids_content  | content_type  |</span><br><span class="line">+------------+----------------+---------------+---------------+</span><br><span class="line">| 1          | Leetcode Movie | N             | Movies        |</span><br><span class="line">| 2          | Alg. for Kids  | Y             | Series        |</span><br><span class="line">| 3          | Database Sols  | N             | Series        |</span><br><span class="line">| 4          | Aladdin        | Y             | Movies        |</span><br><span class="line">| 5          | Cinderella     | Y             | Movies        |</span><br><span class="line">+------------+----------------+---------------+---------------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+--------------+</span><br><span class="line">| title        |</span><br><span class="line">+--------------+</span><br><span class="line">| Aladdin      |</span><br><span class="line">+--------------+</span><br><span class="line">&quot;Leetcode Movie&quot; æ˜¯å„¿ç«¥ä¸å®œçš„ç”µå½±.</span><br><span class="line">&quot;Alg. for Kids&quot; ä¸æ˜¯ç”µå½±.</span><br><span class="line">&quot;Database Sols&quot; ä¸æ˜¯ç”µå½±</span><br><span class="line">&quot;Alladin&quot; æ˜¯ç”µå½±, å„¿ç«¥é€‚å®œ, å¹¶ä¸”åœ¨ 2020 å¹´ 6 æœˆä»½æ’­æ”¾.</span><br><span class="line">&quot;Cinderella&quot; ä¸åœ¨ 2020 å¹´ 6 æœˆä»½æ’­æ”¾.</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> title   </span><br><span class="line"><span class="keyword">from</span> TVProgram t <span class="keyword">left</span> <span class="keyword">join</span> Content c</span><br><span class="line"><span class="keyword">on</span> t.content_id  <span class="operator">=</span> c.content_id </span><br><span class="line"><span class="keyword">where</span>  Kids_content <span class="operator">=</span><span class="string">&#x27;Y&#x27;</span> </span><br><span class="line"><span class="keyword">and</span> date_format(program_date ,<span class="string">&#x27;%Y-%m&#x27;</span>)<span class="operator">=</span><span class="string">&#x27;2020-06&#x27;</span></span><br><span class="line"><span class="keyword">and</span> content_type<span class="operator">=</span><span class="string">&#x27;Movies&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>LEFT()å‡½æ•°å‚è§ï¼š<a href="https://www.begtut.com/sql/func-mysql-left.html">https://www.begtut.com/sql/func-mysql-left.html</a><br>REGEXPè¯­æ³•å‚è§ï¼š<br><a href="https://www.cnblogs.com/timssd/p/5882742.html">https://www.cnblogs.com/timssd/p/5882742.html</a><br><a href="https://www.cnblogs.com/zhaopanpan/p/10133224.html">https://www.cnblogs.com/zhaopanpan/p/10133224.html</a><br>DATE_FORMAT()å‡½æ•°å‚è§ï¼š<a href="https://www.w3school.com.cn/sql/func_date_format.asp">https://www.w3school.com.cn/sql/func_date_format.asp</a><br>EXTRACT()å‡½æ•°å‚è§ï¼š<a href="https://www.runoob.com/sql/func-extract.html">https://www.runoob.com/sql/func-extract.html</a><br>DATEDIFF()å‡½æ•°å‚è§ï¼š<a href="https://www.runoob.com/sql/func-datediff-mysql.html">https://www.runoob.com/sql/func-datediff-mysql.html</a><br>YEAR()å‡½æ•°å‚è§ï¼š<a href="https://blog.csdn.net/moakun/article/details/82528829">https://blog.csdn.net/moakun/article/details/82528829</a><br>MONTH()å‡½æ•°å‚è§ï¼š<a href="https://www.yiibai.com/mysql/month.html">https://www.yiibai.com/mysql/month.html</a></p></blockquote><h4 id="1501-å¯ä»¥æ”¾å¿ƒæŠ•èµ„çš„å›½å®¶"><a href="#1501-å¯ä»¥æ”¾å¿ƒæŠ•èµ„çš„å›½å®¶" class="headerlink" title="1501. å¯ä»¥æ”¾å¿ƒæŠ•èµ„çš„å›½å®¶"></a><a href="https://leetcode-cn.com/problems/countries-you-can-safely-invest-in/">1501. å¯ä»¥æ”¾å¿ƒæŠ•èµ„çš„å›½å®¶</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>è¡¨ <code>Person</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| id             | int     |</span><br><span class="line">| name           | varchar |</span><br><span class="line">| phone_number   | varchar |</span><br><span class="line">+----------------+---------+</span><br><span class="line">id æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">è¯¥è¡¨æ¯ä¸€è¡ŒåŒ…å«ä¸€ä¸ªäººçš„åå­—å’Œç”µè¯å·ç .</span><br><span class="line">ç”µè¯å·ç çš„æ ¼å¼æ˜¯:&#x27;xxx-yyyyyyy&#x27;, å…¶ä¸­xxxæ˜¯å›½å®¶ç (3ä¸ªå­—ç¬¦), yyyyyyyæ˜¯ç”µè¯å·ç (7ä¸ªå­—ç¬¦), xå’Œyéƒ½è¡¨ç¤ºæ•°å­—. åŒæ—¶, å›½å®¶ç å’Œç”µè¯å·ç éƒ½å¯ä»¥åŒ…å«å‰å¯¼0.</span><br></pre></td></tr></table></figure><p>è¡¨ <code>Country</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| name           | varchar |</span><br><span class="line">| country_code   | varchar |</span><br><span class="line">+----------------+---------+</span><br><span class="line">country_codeæ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">è¯¥è¡¨æ¯ä¸€è¡ŒåŒ…å«å›½å®¶åå’Œå›½å®¶ç . country_codeçš„æ ¼å¼æ˜¯&#x27;xxx&#x27;, xæ˜¯æ•°å­—.</span><br></pre></td></tr></table></figure><p>è¡¨ <code>Calls</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-------------+------+</span><br><span class="line">| Column Name | Type |</span><br><span class="line">+-------------+------+</span><br><span class="line">| caller_id   | int  |</span><br><span class="line">| callee_id   | int  |</span><br><span class="line">| duration    | int  |</span><br><span class="line">+-------------+------+</span><br><span class="line">è¯¥è¡¨æ— ä¸»é”®, å¯èƒ½åŒ…å«é‡å¤è¡Œ.</span><br><span class="line">æ¯ä¸€è¡ŒåŒ…å«å‘¼å«æ–¹id, è¢«å‘¼å«æ–¹idå’Œä»¥åˆ†é’Ÿä¸ºå•ä½çš„é€šè¯æ—¶é•¿. caller_id != callee_id</span><br></pre></td></tr></table></figure><p>ä¸€å®¶ç”µä¿¡å…¬å¸æƒ³è¦æŠ•èµ„æ–°çš„å›½å®¶. è¯¥å…¬å¸æƒ³è¦æŠ•èµ„çš„å›½å®¶æ˜¯: è¯¥å›½çš„å¹³å‡é€šè¯æ—¶é•¿è¦ä¸¥æ ¼åœ°å¤§äºå…¨çƒå¹³å‡é€šè¯æ—¶é•¿.</p><p>å†™ä¸€æ®µ SQL, æ‰¾åˆ°æ‰€æœ‰è¯¥å…¬å¸å¯ä»¥æŠ•èµ„çš„å›½å®¶.</p><p>è¿”å›çš„ç»“æœè¡¨æ²¡æœ‰é¡ºåºè¦æ±‚.</p><p>æŸ¥è¯¢çš„ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤º.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">Person è¡¨:</span><br><span class="line">+----+----------+--------------+</span><br><span class="line">| id | name     | phone_number |</span><br><span class="line">+----+----------+--------------+</span><br><span class="line">| 3  | Jonathan | 051-1234567  |</span><br><span class="line">| 12 | Elvis    | 051-7654321  |</span><br><span class="line">| 1  | Moncef   | 212-1234567  |</span><br><span class="line">| 2  | Maroua   | 212-6523651  |</span><br><span class="line">| 7  | Meir     | 972-1234567  |</span><br><span class="line">| 9  | Rachel   | 972-0011100  |</span><br><span class="line">+----+----------+--------------+</span><br><span class="line"></span><br><span class="line">Country è¡¨:</span><br><span class="line">+----------+--------------+</span><br><span class="line">| name     | country_code |</span><br><span class="line">+----------+--------------+</span><br><span class="line">| Peru     | 051          |</span><br><span class="line">| Israel   | 972          |</span><br><span class="line">| Morocco  | 212          |</span><br><span class="line">| Germany  | 049          |</span><br><span class="line">| Ethiopia | 251          |</span><br><span class="line">+----------+--------------+</span><br><span class="line"></span><br><span class="line">Calls è¡¨:</span><br><span class="line">+-----------+-----------+----------+</span><br><span class="line">| caller_id | callee_id | duration |</span><br><span class="line">+-----------+-----------+----------+</span><br><span class="line">| 1         | 9         | 33       |</span><br><span class="line">| 2         | 9         | 4        |</span><br><span class="line">| 1         | 2         | 59       |</span><br><span class="line">| 3         | 12        | 102      |</span><br><span class="line">| 3         | 12        | 330      |</span><br><span class="line">| 12        | 3         | 5        |</span><br><span class="line">| 7         | 9         | 13       |</span><br><span class="line">| 7         | 1         | 3        |</span><br><span class="line">| 9         | 7         | 1        |</span><br><span class="line">| 1         | 7         | 7        |</span><br><span class="line">+-----------+-----------+----------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+----------+</span><br><span class="line">| country  |</span><br><span class="line">+----------+</span><br><span class="line">| Peru     |</span><br><span class="line">+----------+</span><br><span class="line">å›½å®¶Peruçš„å¹³å‡é€šè¯æ—¶é•¿æ˜¯ (102 + 102 + 330 + 330 + 5 + 5) / 6 = 145.666667</span><br><span class="line">å›½å®¶Israelçš„å¹³å‡é€šè¯æ—¶é•¿æ˜¯ (33 + 4 + 13 + 13 + 3 + 1 + 1 + 7) / 8 = 9.37500</span><br><span class="line">å›½å®¶Moroccoçš„å¹³å‡é€šè¯æ—¶é•¿æ˜¯ (33 + 4 + 59 + 59 + 3 + 7) / 6 = 27.5000 </span><br><span class="line">å…¨çƒå¹³å‡é€šè¯æ—¶é•¿ = (2 * (33 + 3 + 59 + 102 + 330 + 5 + 13 + 3 + 1 + 7)) / 20 = 55.70000</span><br><span class="line">æ‰€ä»¥, Peruæ˜¯å”¯ä¸€çš„å¹³å‡é€šè¯æ—¶é•¿å¤§äºå…¨çƒå¹³å‡é€šè¯æ—¶é•¿çš„å›½å®¶, ä¹Ÿæ˜¯å”¯ä¸€çš„æ¨èæŠ•èµ„çš„å›½å®¶.</span><br></pre></td></tr></table></figure><p>ç¬›å¡å°”ç§¯</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> c2.name <span class="keyword">as</span> country </span><br><span class="line"><span class="keyword">from</span> Calls c1,Person p,Country c2</span><br><span class="line"><span class="keyword">where</span> (p.id<span class="operator">=</span>c1.caller_id <span class="keyword">or</span> p.id<span class="operator">=</span>c1.callee_id) <span class="keyword">and</span> c2.country_code<span class="operator">=</span><span class="keyword">left</span>(p.phone_number,<span class="number">3</span>)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> c2.name </span><br><span class="line"><span class="keyword">having</span> <span class="built_in">avg</span>(duration)<span class="operator">&gt;</span>(<span class="keyword">select</span> <span class="built_in">avg</span>(duration) <span class="keyword">from</span> Calls)</span><br></pre></td></tr></table></figure><p>æ€è·¯æ›´æ¸…æ™°</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> people_country <span class="keyword">as</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> id, c.name country</span><br><span class="line">    <span class="keyword">from</span> Person p <span class="keyword">left</span> <span class="keyword">join</span> Country c</span><br><span class="line">    <span class="keyword">on</span> <span class="keyword">left</span>(p.phone_number,<span class="number">3</span>) <span class="operator">=</span> c.country_code</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> country</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> country, <span class="built_in">avg</span>(duration) avgtime</span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> caller_id id, duration</span><br><span class="line">        <span class="keyword">from</span> Calls</span><br><span class="line">        <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">        <span class="keyword">select</span> callee_id, duration</span><br><span class="line">        <span class="keyword">from</span> Calls</span><br><span class="line">    ) t <span class="keyword">left</span> <span class="keyword">join</span> people_country</span><br><span class="line">    <span class="keyword">using</span>(id)</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> country</span><br><span class="line">) temp</span><br><span class="line"><span class="keyword">where</span> avgtime <span class="operator">&gt;</span> </span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> <span class="built_in">avg</span>(duration) avgtime</span><br><span class="line">        <span class="keyword">from</span></span><br><span class="line">        (</span><br><span class="line">            <span class="keyword">select</span> caller_id, duration</span><br><span class="line">            <span class="keyword">from</span> Calls</span><br><span class="line">            <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">            <span class="keyword">select</span> callee_id, duration</span><br><span class="line">            <span class="keyword">from</span> Calls</span><br><span class="line">        ) t</span><br><span class="line">    )</span><br></pre></td></tr></table></figure><h4 id="1511-æ¶ˆè´¹è€…ä¸‹å•é¢‘ç‡"><a href="#1511-æ¶ˆè´¹è€…ä¸‹å•é¢‘ç‡" class="headerlink" title="1511. æ¶ˆè´¹è€…ä¸‹å•é¢‘ç‡"></a><a href="https://leetcode-cn.com/problems/customer-order-frequency/">1511. æ¶ˆè´¹è€…ä¸‹å•é¢‘ç‡</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>è¡¨: <code>Customers</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">| country       | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">customer_id æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">è¯¥è¡¨åŒ…å«å…¬å¸æ¶ˆè´¹è€…çš„ä¿¡æ¯.</span><br></pre></td></tr></table></figure><p>è¡¨: <code>Product</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| description   | varchar |</span><br><span class="line">| price         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">product_id æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">è¯¥è¡¨åŒ…å«å…¬å¸äº§å“çš„ä¿¡æ¯.</span><br><span class="line">price æ˜¯æœ¬äº§å“çš„èŠ±é”€.</span><br></pre></td></tr></table></figure><p>è¡¨: <code>Orders</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| order_id      | int     |</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| order_date    | date    |</span><br><span class="line">| quantity      | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">order_id æ˜¯è¯¥è¡¨ä¸»é”®.</span><br><span class="line">è¯¥è¡¨åŒ…å«æ¶ˆè´¹è€…ä¸‹å•çš„ä¿¡æ¯.</span><br><span class="line">customer_id æ˜¯ä¹°äº†æ•°é‡ä¸º&quot;quantity&quot;, idä¸º&quot;product_id&quot;äº§å“çš„æ¶ˆè´¹è€…çš„ id.</span><br><span class="line">Order_date æ˜¯è®¢å•å‘è´§çš„æ—¥æœŸ, æ ¼å¼ä¸º(&#x27;YYYY-MM-DD&#x27;).</span><br></pre></td></tr></table></figure><p>å†™ä¸€ä¸ª SQL è¯­å¥, æŠ¥å‘Šæ¶ˆè´¹è€…çš„ id å’Œåå­—, å…¶ä¸­æ¶ˆè´¹è€…åœ¨ 2020 å¹´ 6 æœˆå’Œ 7 æœˆ, æ¯æœˆè‡³å°‘èŠ±è´¹äº†$100.</p><p>ç»“æœè¡¨æ— é¡ºåºè¦æ±‚.</p><p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤º.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">Customers</span><br><span class="line">+--------------+-----------+-------------+</span><br><span class="line">| customer_id  | name      | country     |</span><br><span class="line">+--------------+-----------+-------------+</span><br><span class="line">| 1            | Winston   | USA         |</span><br><span class="line">| 2            | Jonathan  | Peru        |</span><br><span class="line">| 3            | Moustafa  | Egypt       |</span><br><span class="line">+--------------+-----------+-------------+</span><br><span class="line"></span><br><span class="line">Product</span><br><span class="line">+--------------+-------------+-------------+</span><br><span class="line">| product_id   | description | price       |</span><br><span class="line">+--------------+-------------+-------------+</span><br><span class="line">| 10           | LC Phone    | 300         |</span><br><span class="line">| 20           | LC T-Shirt  | 10          |</span><br><span class="line">| 30           | LC Book     | 45          |</span><br><span class="line">| 40           | LC Keychain | 2           |</span><br><span class="line">+--------------+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Orders</span><br><span class="line">+--------------+-------------+-------------+-------------+-----------+</span><br><span class="line">| order_id     | customer_id | product_id  | order_date  | quantity  |</span><br><span class="line">+--------------+-------------+-------------+-------------+-----------+</span><br><span class="line">| 1            | 1           | 10          | 2020-06-10  | 1         |</span><br><span class="line">| 2            | 1           | 20          | 2020-07-01  | 1         |</span><br><span class="line">| 3            | 1           | 30          | 2020-07-08  | 2         |</span><br><span class="line">| 4            | 2           | 10          | 2020-06-15  | 2         |</span><br><span class="line">| 5            | 2           | 40          | 2020-07-01  | 10        |</span><br><span class="line">| 6            | 3           | 20          | 2020-06-24  | 2         |</span><br><span class="line">| 7            | 3           | 30          | 2020-06-25  | 2         |</span><br><span class="line">| 9            | 3           | 30          | 2020-05-08  | 3         |</span><br><span class="line">+--------------+-------------+-------------+-------------+-----------+</span><br><span class="line"></span><br><span class="line">Result è¡¨:</span><br><span class="line">+--------------+------------+</span><br><span class="line">| customer_id  | name       |  </span><br><span class="line">+--------------+------------+</span><br><span class="line">| 1            | Winston    |</span><br><span class="line">+--------------+------------+ </span><br><span class="line">Winston åœ¨2020å¹´6æœˆèŠ±è´¹äº†$300(300 * 1), åœ¨7æœˆèŠ±è´¹äº†$100(10 * 1 + 45 * 2).</span><br><span class="line">Jonathan åœ¨2020å¹´6æœˆèŠ±è´¹äº†$600(300 * 2), åœ¨7æœˆèŠ±è´¹äº†$20(2 * 10).</span><br><span class="line">Moustafa åœ¨2020å¹´6æœˆèŠ±è´¹äº†$110 (10 * 2 + 45 * 2), åœ¨7æœˆèŠ±è´¹äº†$0.</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> customer_id,name</span><br><span class="line"><span class="keyword">from</span> Customers</span><br><span class="line"><span class="keyword">where</span> customer_id <span class="keyword">in</span></span><br><span class="line">(<span class="keyword">select</span> customer_id</span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">        (<span class="keyword">select</span> customer_id, <span class="keyword">month</span>(order_date) <span class="keyword">as</span> <span class="keyword">month</span> , <span class="built_in">sum</span>(quantity<span class="operator">*</span>price) <span class="keyword">as</span> total</span><br><span class="line">        <span class="keyword">from</span> Orders o <span class="keyword">left</span> <span class="keyword">join</span> Product p <span class="keyword">on</span> o.product_id <span class="operator">=</span> p.product_id</span><br><span class="line">        <span class="keyword">where</span> <span class="keyword">month</span>(order_date) <span class="operator">=</span> <span class="number">6</span> <span class="keyword">or</span> <span class="keyword">month</span>(order_date)<span class="operator">=</span><span class="number">7</span></span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> customer_id,<span class="keyword">month</span>(order_date)</span><br><span class="line">        ) <span class="keyword">as</span> t1</span><br><span class="line">    <span class="keyword">where</span> total <span class="operator">&gt;=</span><span class="number">100</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> customer_id</span><br><span class="line">    <span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">&gt;=</span><span class="number">2</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="1517-Find-Users-With-Valid-E-Mails"><a href="#1517-Find-Users-With-Valid-E-Mails" class="headerlink" title="1517. Find Users With Valid E-Mails"></a><a href="https://leetcode-cn.com/problems/find-users-with-valid-e-mails/">1517. Find Users With Valid E-Mails</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>Table: <code>Users</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">| mail          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">user_id is the primary key for this table.</span><br><span class="line">This table contains information of the users signed up in a website. Some e-mails are invalid.</span><br></pre></td></tr></table></figure><p>Write an SQL query to find the users who have <strong>valid emails</strong>.</p><p>A valid e-mail has a prefix name and a domain where: </p><ul><li><strong>The prefix name</strong> is a string that may contain letters (upper or lower case), digits, underscore <code>&#39;_&#39;</code>, period <code>&#39;.&#39;</code> and/or dash <code>&#39;-&#39;</code>. The prefix name <strong>must</strong> start with a letter.</li><li><strong>The domain</strong> is <code>&#39;@leetcode.com&#39;</code>.</li></ul><p>Return the result table in any order.</p><p>The query result format is in the following example.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Users</span><br><span class="line">+---------+-----------+-------------------------+</span><br><span class="line">| user_id | name      | mail                    |</span><br><span class="line">+---------+-----------+-------------------------+</span><br><span class="line">| 1       | Winston   | winston@leetcode.com    |</span><br><span class="line">| 2       | Jonathan  | jonathanisgreat         |</span><br><span class="line">| 3       | Annabelle | bella-@leetcode.com     |</span><br><span class="line">| 4       | Sally     | sally.come@leetcode.com |</span><br><span class="line">| 5       | Marwan    | quarz#2020@leetcode.com |</span><br><span class="line">| 6       | David     | david69@gmail.com       |</span><br><span class="line">| 7       | Shapiro   | .shapo@leetcode.com     |</span><br><span class="line">+---------+-----------+-------------------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+---------+-----------+-------------------------+</span><br><span class="line">| user_id | name      | mail                    |</span><br><span class="line">+---------+-----------+-------------------------+</span><br><span class="line">| 1       | Winston   | winston@leetcode.com    |</span><br><span class="line">| 3       | Annabelle | bella-@leetcode.com     |</span><br><span class="line">| 4       | Sally     | sally.come@leetcode.com |</span><br><span class="line">+---------+-----------+-------------------------+</span><br><span class="line">The mail of user 2 doesn&#x27;t have a domain.</span><br><span class="line">The mail of user 5 has # sign which is not allowed.</span><br><span class="line">The mail of user 6 doesn&#x27;t have leetcode domain.</span><br><span class="line">The mail of user 7 starts with a period.</span><br></pre></td></tr></table></figure><p>è€ƒå¯Ÿæ­£åˆ™è¡¨è¾¾å¼çš„ä½¿ç”¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> Users</span><br><span class="line"><span class="keyword">WHERE</span> mail REGEXP <span class="string">&#x27;^[a-zA-Z]+[\\w_\\.\\-]*@leetcode.com$&#x27;</span>   </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> user_id;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Users</span><br><span class="line"><span class="keyword">where</span> mail regexp <span class="string">&#x27;^[a-zA-Z]+[a-zA-Z0-9_\\./\\-]&#123;0,&#125;@leetcode.com$&#x27;</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> user_id</span><br></pre></td></tr></table></figure><blockquote><p>å‘ç‚¹ï¼š<br>1ã€å‰ç¼€å¯èƒ½æ˜¯ä¸€ä¸ªå­—æ¯ï¼Œæ¯”å¦‚â€œ<a href="mailto:&#x4a;&#64;&#108;&#x65;&#101;&#x74;&#99;&#x6f;&#100;&#101;&#x2e;&#99;&#x6f;&#x6d;">&#x4a;&#64;&#108;&#x65;&#101;&#x74;&#99;&#x6f;&#100;&#101;&#x2e;&#99;&#x6f;&#x6d;</a>â€ï¼Œæ‰€ä»¥åŒ¹é…éé¦–å­—æ¯å¤–çš„å‰ç¼€å­—ç¬¦æ•°é‡è¦ç”¨{0,}æˆ–*ï¼Œä¸èƒ½ç”¨+ã€‚<br>2ã€é¢˜æ„è¦æ±‚ï¼šunderscore â€˜â€™, period â€˜.â€™ and/or dash â€˜-â€˜ï¼Œ/æ²¡åŠ å•å¼•å·ï¼Œä¸ç•™ç¥å¯èƒ½å†™æ¼/ã€‚<br>3ã€åç¼€å¯èƒ½æ˜¯â€œ@leetcodeecomâ€ï¼Œæ‰€ä»¥è¦å¯¹â€œ.â€åŠ è½¬ä¹‰ç¬¦å·ã€‚<br>4ã€åç¼€å¯èƒ½æ˜¯â€œ@LEETCODE.COMâ€ï¼Œé»˜è®¤æ˜¯ä¸åŒºåˆ†å¤§å°å†™åŒ¹é…ï¼Œæ‰€ä»¥è¦åŠ ä¸Šâ€œBINARYâ€åŒºåˆ†å¤§å°å†™ã€‚<br>è¯­æ³•ï¼š<br>1ã€<a href="https://www.cnblogs.com/timssd/p/5882742.html">https://www.cnblogs.com/timssd/p/5882742.html</a><br>2ã€<a href="https://www.cnblogs.com/zhaopanpan/p/10133224.html">https://www.cnblogs.com/zhaopanpan/p/10133224.html</a><br>3ã€â€åŒåæ–œæ +wâ€è¡¨ç¤ºå­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ï¼Œç›¸å¯¹â€a-zA-Z0-9â€çš„å†™æ³•æ›´ç®€æ´ã€‚</p></blockquote><h4 id="1527-Patients-With-a-Condition"><a href="#1527-Patients-With-a-Condition" class="headerlink" title="1527. Patients With a Condition"></a><a href="https://leetcode-cn.com/problems/patients-with-a-condition/">1527. Patients With a Condition</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>Table: <code>Patients</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| patient_id   | int     |</span><br><span class="line">| patient_name | varchar |</span><br><span class="line">| conditions   | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">patient_id is the primary key for this table.</span><br><span class="line">&#x27;conditions&#x27; contains 0 or more code separated by spaces. </span><br><span class="line">This table contains information of the patients in the hospital.</span><br></pre></td></tr></table></figure><p>Write an SQL query to report the patient_id, patient_name all conditions of patients who have Type I Diabetes. Type I Diabetes always starts with <code>DIAB1</code> prefix</p><p>Return the result table in any order.</p><p>The query result format is in the following example.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Patients</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">| patient_id | patient_name | conditions   |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">| 1          | Daniel       | YFEV COUGH   |</span><br><span class="line">| 2          | Alice        |              |</span><br><span class="line">| 3          | Bob          | DIAB100 MYOP |</span><br><span class="line">| 4          | George       | ACNE DIAB100 |</span><br><span class="line">| 5          | Alain        | DIAB201      |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">| patient_id | patient_name | conditions   |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">| 3          | Bob          | DIAB100 MYOP |</span><br><span class="line">| 4          | George       | ACNE DIAB100 | </span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">Bob and George both have a condition that starts with DIAB1.</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  patient_id , patient_name ,conditions </span><br><span class="line"><span class="keyword">from</span> Patients</span><br><span class="line"><span class="keyword">where</span> conditions <span class="keyword">like</span> <span class="string">&#x27;%DIAB1%&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="1532-The-Most-Recent-Three-Orders"><a href="#1532-The-Most-Recent-Three-Orders" class="headerlink" title="1532. The Most Recent Three Orders"></a><a href="https://leetcode-cn.com/problems/the-most-recent-three-orders/">1532. The Most Recent Three Orders</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>Table: <code>Customers</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">customer_id is the primary key for this table.</span><br><span class="line">This table contains information about customers.</span><br></pre></td></tr></table></figure><p>Table: <code>Orders</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| order_id      | int     |</span><br><span class="line">| order_date    | date    |</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| cost          | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">order_id is the primary key for this table.</span><br><span class="line">This table contains information about the orders made by customer_id.</span><br><span class="line">Each customer has one order per day.</span><br></pre></td></tr></table></figure><p>Write an SQL query to find the most recent 3 orders of each user. If a user ordered less than 3 orders return all of their orders.</p><p>Return the result table sorted by <code>customer_name</code> in <strong>ascending</strong> order and in case of a tie by the <code>customer_id</code> in <strong>ascending</strong> order. If there still a tie, order them by the <code>order_date</code> in <strong>descending</strong> order.</p><p>The query result format is in the following example:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">Customers</span><br><span class="line">+-------------+-----------+</span><br><span class="line">| customer_id | name      |</span><br><span class="line">+-------------+-----------+</span><br><span class="line">| 1           | Winston   |</span><br><span class="line">| 2           | Jonathan  |</span><br><span class="line">| 3           | Annabelle |</span><br><span class="line">| 4           | Marwan    |</span><br><span class="line">| 5           | Khaled    |</span><br><span class="line">+-------------+-----------+</span><br><span class="line"></span><br><span class="line">Orders</span><br><span class="line">+----------+------------+-------------+------+</span><br><span class="line">| order_id | order_date | customer_id | cost |</span><br><span class="line">+----------+------------+-------------+------+</span><br><span class="line">| 1        | 2020-07-31 | 1           | 30   |</span><br><span class="line">| 2        | 2020-07-30 | 2           | 40   |</span><br><span class="line">| 3        | 2020-07-31 | 3           | 70   |</span><br><span class="line">| 4        | 2020-07-29 | 4           | 100  |</span><br><span class="line">| 5        | 2020-06-10 | 1           | 1010 |</span><br><span class="line">| 6        | 2020-08-01 | 2           | 102  |</span><br><span class="line">| 7        | 2020-08-01 | 3           | 111  |</span><br><span class="line">| 8        | 2020-08-03 | 1           | 99   |</span><br><span class="line">| 9        | 2020-08-07 | 2           | 32   |</span><br><span class="line">| 10       | 2020-07-15 | 1           | 2    |</span><br><span class="line">+----------+------------+-------------+------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+---------------+-------------+----------+------------+</span><br><span class="line">| customer_name | customer_id | order_id | order_date |</span><br><span class="line">+---------------+-------------+----------+------------+</span><br><span class="line">| Annabelle     | 3           | 7        | 2020-08-01 |</span><br><span class="line">| Annabelle     | 3           | 3        | 2020-07-31 |</span><br><span class="line">| Jonathan      | 2           | 9        | 2020-08-07 |</span><br><span class="line">| Jonathan      | 2           | 6        | 2020-08-01 |</span><br><span class="line">| Jonathan      | 2           | 2        | 2020-07-30 |</span><br><span class="line">| Marwan        | 4           | 4        | 2020-07-29 |</span><br><span class="line">| Winston       | 1           | 8        | 2020-08-03 |</span><br><span class="line">| Winston       | 1           | 1        | 2020-07-31 |</span><br><span class="line">| Winston       | 1           | 10       | 2020-07-15 |</span><br><span class="line">+---------------+-------------+----------+------------+</span><br><span class="line">Winston has 4 orders, we discard the order of &quot;2020-06-10&quot; because it is the oldest order.</span><br><span class="line">Annabelle has only 2 orders, we return them.</span><br><span class="line">Jonathan has exactly 3 orders.</span><br><span class="line">Marwan ordered only one time.</span><br><span class="line">We sort the result table by customer_name in ascending order, by customer_id in ascending order and by order_date in descending order in case of a tie.</span><br></pre></td></tr></table></figure><p><strong>Follow-up:</strong><br>Can you write a general solution for the most recent <code>n</code> orders?</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name customer_name ,customer_id,order_id,order_date</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span>  name ,o.customer_id,order_id,order_date ,<span class="built_in">rank</span>()<span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> o.customer_id <span class="keyword">order</span> <span class="keyword">by</span> order_date <span class="keyword">desc</span>) rk</span><br><span class="line"><span class="keyword">from</span> Orders o <span class="keyword">left</span> <span class="keyword">join</span> Customers c</span><br><span class="line"><span class="keyword">on</span> o.customer_id<span class="operator">=</span>c.customer_id</span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> rk <span class="operator">&lt;=</span><span class="number">3</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> customer_name ,customer_id,order_date <span class="keyword">desc</span></span><br></pre></td></tr></table></figure><h4 id="1543-Fix-Product-Name-Format"><a href="#1543-Fix-Product-Name-Format" class="headerlink" title="1543. Fix Product Name Format"></a><a href="https://leetcode-cn.com/problems/fix-product-name-format/">1543. Fix Product Name Format</a></h4><p>éš¾åº¦ç®€å•</p><p>SQLæ¶æ„</p><p>Table: <code>Sales</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| sale_id      | int     |</span><br><span class="line">| product_name | varchar |</span><br><span class="line">| sale_date    | date    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">sale_id is the primary key for this table.</span><br><span class="line">Each row of this table contains the product name and the date it was sold.</span><br></pre></td></tr></table></figure><p>Since table Sales was filled manually in the year 2000, <code>product_name</code> may contain leading and/or trailing white spaces, also they are case-insensitive.</p><p>Write an SQL query to report</p><ul><li><code>product_name</code> in lowercase without leading or trailing white spaces.</li><li><code>sale_date</code> in the format <code>(&#39;YYYY-MM&#39;)</code> </li><li><code>total</code> the number of times the product was sold in this month.</li></ul><p>Return the result table ordered by <code>product_name</code> in <strong>ascending order</strong>, in case of a tie order it by <code>sale_date</code> in <strong>ascending order</strong>.</p><p>The query result format is in the following example.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Sales</span><br><span class="line">+------------+------------------+--------------+</span><br><span class="line">| sale_id    | product_name     | sale_date    |</span><br><span class="line">+------------+------------------+--------------+</span><br><span class="line">| 1          |      LCPHONE     | 2000-01-16   |</span><br><span class="line">| 2          |    LCPhone       | 2000-01-17   |</span><br><span class="line">| 3          |     LcPhOnE      | 2000-02-18   |</span><br><span class="line">| 4          |      LCKeyCHAiN  | 2000-02-19   |</span><br><span class="line">| 5          |   LCKeyChain     | 2000-02-28   |</span><br><span class="line">| 6          | Matryoshka       | 2000-03-31   | </span><br><span class="line">+------------+------------------+--------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+--------------+--------------+----------+</span><br><span class="line">| product_name | sale_date    | total    |</span><br><span class="line">+--------------+--------------+----------+</span><br><span class="line">| lcphone      | 2000-01      | 2        |</span><br><span class="line">| lckeychain   | 2000-02      | 2        | </span><br><span class="line">| lcphone      | 2000-02      | 1        | </span><br><span class="line">| matryoshka   | 2000-03      | 1        | </span><br><span class="line">+--------------+--------------+----------+</span><br><span class="line"></span><br><span class="line">In January, 2 LcPhones were sold, please note that the product names are not case sensitive and may contain spaces.</span><br><span class="line">In Februery, 2 LCKeychains and 1 LCPhone were sold.</span><br><span class="line">In March, 1 matryoshka was sold.</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">trim</span>(<span class="built_in">lower</span>(product_name)) <span class="keyword">as</span> product_name, </span><br><span class="line">        date_format(sale_date,<span class="string">&#x27;%Y-%m&#x27;</span>) <span class="keyword">as</span> sale_date,</span><br><span class="line">        <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> total </span><br><span class="line"><span class="keyword">from</span> Sales </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="built_in">trim</span>(<span class="built_in">lower</span>(product_name)), date_format(sale_date,<span class="string">&#x27;%Y-%m&#x27;</span>) </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> product_name <span class="keyword">asc</span>, sale_date <span class="keyword">asc</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„å¤§å°å†™ã€ç©ºæ ¼ </p></blockquote><h4 id="1549-The-Most-Recent-Orders-for-Each-Product"><a href="#1549-The-Most-Recent-Orders-for-Each-Product" class="headerlink" title="1549. The Most Recent Orders for Each Product"></a><a href="https://leetcode-cn.com/problems/the-most-recent-orders-for-each-product/">1549. The Most Recent Orders for Each Product</a></h4><p>éš¾åº¦ä¸­ç­‰</p><p>SQLæ¶æ„</p><p>Table: <code>Customers</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">customer_id is the primary key for this table.</span><br><span class="line">This table contains information about the customers.</span><br></pre></td></tr></table></figure><p>Table: <code>Orders</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| order_id      | int     |</span><br><span class="line">| order_date    | date    |</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| product_id    | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">order_id is the primary key for this table.</span><br><span class="line">This table contains information about the orders made by customer_id.</span><br><span class="line">There will be no product ordered by the same user more than once in one day.</span><br></pre></td></tr></table></figure><p>Table: <code>Products</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| product_name  | varchar |</span><br><span class="line">| price         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">product_id is the primary key for this table.</span><br><span class="line">This table contains information about the Products.</span><br></pre></td></tr></table></figure><p>Write an SQL query to find the most recent order(s) of each product.</p><p>Return the result table sorted by <code>product_name</code> in <strong>ascending</strong> order and in case of a tie by the <code>product_id</code> in <strong>ascending</strong> order. If there still a tie, order them by the <code>order_id</code> in <strong>ascending</strong> order.</p><p>The query result format is in the following example:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">Customers</span><br><span class="line">+-------------+-----------+</span><br><span class="line">| customer_id | name      |</span><br><span class="line">+-------------+-----------+</span><br><span class="line">| 1           | Winston   |</span><br><span class="line">| 2           | Jonathan  |</span><br><span class="line">| 3           | Annabelle |</span><br><span class="line">| 4           | Marwan    |</span><br><span class="line">| 5           | Khaled    |</span><br><span class="line">+-------------+-----------+</span><br><span class="line"></span><br><span class="line">Orders</span><br><span class="line">+----------+------------+-------------+------------+</span><br><span class="line">| order_id | order_date | customer_id | product_id |</span><br><span class="line">+----------+------------+-------------+------------+</span><br><span class="line">| 1        | 2020-07-31 | 1           | 1          |</span><br><span class="line">| 2        | 2020-07-30 | 2           | 2          |</span><br><span class="line">| 3        | 2020-08-29 | 3           | 3          |</span><br><span class="line">| 4        | 2020-07-29 | 4           | 1          |</span><br><span class="line">| 5        | 2020-06-10 | 1           | 2          |</span><br><span class="line">| 6        | 2020-08-01 | 2           | 1          |</span><br><span class="line">| 7        | 2020-08-01 | 3           | 1          |</span><br><span class="line">| 8        | 2020-08-03 | 1           | 2          |</span><br><span class="line">| 9        | 2020-08-07 | 2           | 3          |</span><br><span class="line">| 10       | 2020-07-15 | 1           | 2          |</span><br><span class="line">+----------+------------+-------------+------------+</span><br><span class="line"></span><br><span class="line">Products</span><br><span class="line">+------------+--------------+-------+</span><br><span class="line">| product_id | product_name | price |</span><br><span class="line">+------------+--------------+-------+</span><br><span class="line">| 1          | keyboard     | 120   |</span><br><span class="line">| 2          | mouse        | 80    |</span><br><span class="line">| 3          | screen       | 600   |</span><br><span class="line">| 4          | hard disk    | 450   |</span><br><span class="line">+------------+--------------+-------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+--------------+------------+----------+------------+</span><br><span class="line">| product_name | product_id | order_id | order_date |</span><br><span class="line">+--------------+------------+----------+------------+</span><br><span class="line">| keyboard     | 1          | 6        | 2020-08-01 |</span><br><span class="line">| keyboard     | 1          | 7        | 2020-08-01 |</span><br><span class="line">| mouse        | 2          | 8        | 2020-08-03 |</span><br><span class="line">| screen       | 3          | 3        | 2020-08-29 |</span><br><span class="line">+--------------+------------+----------+------------+</span><br><span class="line">keyboard&#x27;s most recent order is in 2020-08-01, it was ordered two times this day.</span><br><span class="line">mouse&#x27;s most recent order is in 2020-08-03, it was ordered only once this day.</span><br><span class="line">screen&#x27;s most recent order is in 2020-08-29, it was ordered only once this day.</span><br><span class="line">The hard disk was never ordered and we don&#x27;t include it in the result table.</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> product_name,product_id,order_id,order_date</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> product_name ,o.product_id ,order_id,order_date ,</span><br><span class="line">    <span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> o.product_id <span class="keyword">order</span> <span class="keyword">by</span> order_date <span class="keyword">desc</span>) rk</span><br><span class="line"><span class="keyword">from</span> Orders o <span class="keyword">left</span> <span class="keyword">join</span> Products p</span><br><span class="line"><span class="keyword">on</span> o.product_id <span class="operator">=</span>p.product_id </span><br><span class="line">)t1</span><br><span class="line"><span class="keyword">where</span> rk <span class="operator">=</span><span class="number">1</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> product_name,product_id,order_id</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">LeetCodeæ•°æ®åº“é¢˜ç›®é›†åˆ--123é¢˜</summary>
    
    
    
    <category term="SQL" scheme="https://www.buildworld.cn/categories/SQL/"/>
    
    
    <category term="LeetCode" scheme="https://www.buildworld.cn/tags/LeetCode/"/>
    
    <category term="ç¬”è¯•é¢˜" scheme="https://www.buildworld.cn/tags/%E7%AC%94%E8%AF%95%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>BigData-æ•°æ®ä»“åº“å­¦ä¹ </title>
    <link href="https://www.buildworld.cn/2021/01/07/BigData-%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E5%AD%A6%E4%B9%A0/"/>
    <id>https://www.buildworld.cn/2021/01/07/BigData-%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E5%AD%A6%E4%B9%A0/</id>
    <published>2021-01-07T11:35:36.000Z</published>
    <updated>2021-04-09T02:14:48.855Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="ä¸€ã€ç›¸å…³æŠ€æœ¯"><a href="#ä¸€ã€ç›¸å…³æŠ€æœ¯" class="headerlink" title="ä¸€ã€ç›¸å…³æŠ€æœ¯"></a>ä¸€ã€ç›¸å…³æŠ€æœ¯</h3><h4 id="1ã€æŠ€æœ¯é€‰å‹"><a href="#1ã€æŠ€æœ¯é€‰å‹" class="headerlink" title="1ã€æŠ€æœ¯é€‰å‹"></a>1ã€æŠ€æœ¯é€‰å‹</h4><p><img src="https://file.buildworld.cn/img/20201224104550.png"></p><h4 id="2ã€ç³»ç»Ÿæ•°æ®æµç¨‹è®¾è®¡"><a href="#2ã€ç³»ç»Ÿæ•°æ®æµç¨‹è®¾è®¡" class="headerlink" title="2ã€ç³»ç»Ÿæ•°æ®æµç¨‹è®¾è®¡"></a>2ã€ç³»ç»Ÿæ•°æ®æµç¨‹è®¾è®¡</h4><p><img src="https://file.buildworld.cn/img/20201224142101.png"></p><h3 id="äºŒã€æ•°ä»“åˆ†å±‚"><a href="#äºŒã€æ•°ä»“åˆ†å±‚" class="headerlink" title="äºŒã€æ•°ä»“åˆ†å±‚"></a>äºŒã€æ•°ä»“åˆ†å±‚</h3><h4 id="1ã€æ•°æ®ä»“åº“åˆ†å±‚"><a href="#1ã€æ•°æ®ä»“åº“åˆ†å±‚" class="headerlink" title="1ã€æ•°æ®ä»“åº“åˆ†å±‚"></a>1ã€æ•°æ®ä»“åº“åˆ†å±‚</h4><p><img src="https://file.buildworld.cn/img/20210107104843.png"></p><h4 id="2ã€èŒƒå¼ç†è®º"><a href="#2ã€èŒƒå¼ç†è®º" class="headerlink" title="2ã€èŒƒå¼ç†è®º"></a>2ã€èŒƒå¼ç†è®º</h4><blockquote><ul><li>ç¬¬ä¸€èŒƒå¼ï¼šå±æ€§ä¸å¯åˆ†å‰²æ€§ã€‚</li><li>ç¬¬äºŒèŒƒå¼ï¼šä¸èƒ½å­˜åœ¨â€œéƒ¨åˆ†å‡½æ•°ä¾èµ–â€</li><li>ç¬¬ä¸‰èŒƒå¼ï¼šä¸èƒ½å­˜åœ¨ä¼ é€’å‡½æ•°ä¾èµ–ã€‚</li></ul></blockquote><h4 id="3ã€å…³ç³»å»ºæ¨¡å’Œç»´åº¦å»ºæ¨¡"><a href="#3ã€å…³ç³»å»ºæ¨¡å’Œç»´åº¦å»ºæ¨¡" class="headerlink" title="3ã€å…³ç³»å»ºæ¨¡å’Œç»´åº¦å»ºæ¨¡"></a>3ã€å…³ç³»å»ºæ¨¡å’Œç»´åº¦å»ºæ¨¡</h4><blockquote><ul><li><p><strong>è”æœºäº‹åŠ¡å¤„ç†OLTPï¼ˆon-line transaction processingï¼‰</strong></p><p>OLTPæ˜¯ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“çš„ä¸»è¦åº”ç”¨ï¼Œä¸»è¦æ˜¯åŸºæœ¬çš„ã€æ—¥å¸¸çš„äº‹åŠ¡å¤„ç†ï¼Œä¾‹å¦‚é“¶è¡Œäº¤æ˜“ã€‚</p></li><li><p><strong>è”æœºåˆ†æå¤„ç†OLAPï¼ˆOn-Line Analytical Processingï¼‰</strong></p><p>OLAPæ˜¯æ•°æ®ä»“åº“ç³»ç»Ÿçš„ä¸»è¦åº”ç”¨ï¼Œæ”¯æŒå¤æ‚çš„åˆ†ææ“ä½œï¼Œä¾§é‡å†³ç­–æ”¯æŒï¼Œå¹¶ä¸”æä¾›ç›´è§‚æ˜“æ‡‚çš„æŸ¥è¯¢ç»“æœã€‚</p><p>äºŒè€…å¯¹æ¯”</p><table><thead><tr><th align="center">å¯¹æ¯”å±æ€§</th><th>OLTP</th><th>OLAP</th></tr></thead><tbody><tr><td align="center">è¯»ç‰¹æ€§</td><td>æ¯æ¬¡æŸ¥è¯¢åªè¿”å›å°‘é‡è®°å½•</td><td>å¯¹å¤§é‡è®°å½•è¿›è¡Œæ±‡æ€»</td></tr><tr><td align="center">å†™ç‰¹æ€§</td><td>éšæœºã€ä½å»¶æ—¶å†™å…¥ç”¨æˆ·çš„è¾“å…¥</td><td>æ‰¹é‡å¯¼å…¥</td></tr><tr><td align="center">ä½¿ç”¨åœºæ™¯</td><td>ç”¨æˆ·ï¼ŒJava EEé¡¹ç›®</td><td>å†…éƒ¨åˆ†æå¸ˆï¼Œä¸ºå†³ç­–æä¾›æ”¯æŒ</td></tr><tr><td align="center">æ•°æ®è¡¨å¾</td><td>æœ€æ–°æ•°æ®çŠ¶æ€</td><td>éšæ—¶é—´å˜åŒ–çš„å†å²çŠ¶æ€</td></tr><tr><td align="center">æ•°æ®è§„æ¨¡</td><td>GB</td><td>TBåˆ°PB</td></tr></tbody></table></li></ul></blockquote><h5 id="3-1-å…³ç³»å»ºæ¨¡"><a href="#3-1-å…³ç³»å»ºæ¨¡" class="headerlink" title="3.1 å…³ç³»å»ºæ¨¡"></a>3.1 å…³ç³»å»ºæ¨¡</h5><blockquote><p><strong>å…³ç³»æ¨¡å‹</strong>å¦‚å›¾æ‰€ç¤ºï¼Œä¸¥æ ¼éµå¾ªç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰ï¼Œä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¾ƒä¸ºæ¾æ•£ã€é›¶ç¢ï¼Œç‰©ç†è¡¨æ•°é‡å¤šï¼Œè€Œæ•°æ®å†—ä½™ç¨‹åº¦ä½ã€‚ç”±äºæ•°æ®åˆ†å¸ƒäºä¼—å¤šçš„è¡¨ä¸­ï¼Œè¿™äº›æ•°æ®å¯ä»¥æ›´ä¸ºçµæ´»åœ°è¢«åº”ç”¨ï¼ŒåŠŸèƒ½æ€§è¾ƒå¼ºã€‚å…³ç³»æ¨¡å‹ä¸»è¦åº”ç”¨ä¸OLTPç³»ç»Ÿä¸­ï¼Œä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ä»¥åŠé¿å…å†—ä½™ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†ä¸šåŠ¡ç³»ç»Ÿçš„è¡¨éƒ½æ˜¯éµå¾ªç¬¬ä¸‰èŒƒå¼çš„ã€‚</p><p><img src="https://file.buildworld.cn/img/20210107161933.png"></p></blockquote><h5 id="3-2ç»´åº¦å»ºæ¨¡"><a href="#3-2ç»´åº¦å»ºæ¨¡" class="headerlink" title="3.2ç»´åº¦å»ºæ¨¡"></a>3.2ç»´åº¦å»ºæ¨¡</h5><blockquote><p><strong>ç»´åº¦æ¨¡å‹</strong>å¦‚å›¾æ‰€ç¤ºï¼Œä¸»è¦åº”ç”¨äºOLAPç³»ç»Ÿä¸­ï¼Œé€šå¸¸ä»¥æŸä¸€ä¸ªäº‹å®è¡¨ä¸ºä¸­å¿ƒè¿›è¡Œè¡¨çš„ç»„ç»‡ï¼Œä¸»è¦é¢å‘ä¸šåŠ¡ï¼Œç‰¹å¾æ˜¯å¯èƒ½å­˜åœ¨æ•°æ®çš„å†—ä½™ï¼Œä½†æ˜¯èƒ½æ–¹ä¾¿çš„å¾—åˆ°æ•°æ®ã€‚</p><p><img src="https://file.buildworld.cn/img/20210107162057.png"></p></blockquote><p><strong>å…³ç³»æ¨¡å‹è™½ç„¶å†—ä½™å°‘ï¼Œä½†æ˜¯åœ¨å¤§è§„æ¨¡æ•°æ®ï¼Œè·¨è¡¨åˆ†æç»Ÿè®¡æŸ¥è¯¢è¿‡ç¨‹ä¸­ï¼Œä¼šé€ æˆå¤šè¡¨å…³è”ï¼Œè¿™ä¼šå¤§å¤§é™ä½æ‰§è¡Œæ•ˆç‡ã€‚æ‰€ä»¥é€šå¸¸æˆ‘ä»¬é‡‡ç”¨ç»´åº¦æ¨¡å‹å»ºæ¨¡ï¼ŒæŠŠç›¸å…³å„ç§è¡¨æ•´ç†æˆä¸¤ç§ï¼šäº‹å®è¡¨å’Œç»´åº¦è¡¨ä¸¤ç§ã€‚</strong></p><h4 id="4ã€ç»´åº¦è¡¨å’Œäº‹å®è¡¨"><a href="#4ã€ç»´åº¦è¡¨å’Œäº‹å®è¡¨" class="headerlink" title="4ã€ç»´åº¦è¡¨å’Œäº‹å®è¡¨"></a>4ã€ç»´åº¦è¡¨å’Œäº‹å®è¡¨</h4><h5 id="4-1ç»´åº¦è¡¨"><a href="#4-1ç»´åº¦è¡¨" class="headerlink" title="4.1ç»´åº¦è¡¨"></a>4.1ç»´åº¦è¡¨</h5><blockquote><p><strong>ç»´åº¦è¡¨</strong>ï¼šä¸€èˆ¬æ˜¯å¯¹äº‹å®çš„æè¿°ä¿¡æ¯ã€‚æ¯ä¸€å¼ ç»´è¡¨å¯¹åº”ç°å®ä¸–ç•Œä¸­çš„ä¸€ä¸ªå¯¹è±¡æˆ–è€…æ¦‚å¿µã€‚   ä¾‹å¦‚ï¼šç”¨æˆ·ã€å•†å“ã€æ—¥æœŸã€åœ°åŒºç­‰ã€‚</p><ul><li> ç»´è¡¨çš„èŒƒå›´å¾ˆå®½ï¼ˆå…·æœ‰å¤šä¸ªå±æ€§ã€åˆ—æ¯”è¾ƒå¤šï¼‰</li><li> è·Ÿäº‹å®è¡¨ç›¸æ¯”ï¼Œè¡Œæ•°ç›¸å¯¹è¾ƒå°ï¼šé€šå¸¸&lt; 10ä¸‡æ¡</li><li> å†…å®¹ç›¸å¯¹å›ºå®šï¼šç¼–ç è¡¨</li></ul></blockquote><h5 id="4-2äº‹å®è¡¨"><a href="#4-2äº‹å®è¡¨" class="headerlink" title="4.2äº‹å®è¡¨"></a>4.2äº‹å®è¡¨</h5><blockquote><p><strong>äº‹å®è¡¨ä¸­</strong>æ¯è¡Œæ•°æ®ä»£è¡¨ä¸€ä¸ªä¸šåŠ¡äº‹ä»¶ï¼ˆä¸‹å•ã€æ”¯ä»˜ã€é€€æ¬¾ã€è¯„ä»·ç­‰ï¼‰ã€‚â€œäº‹å®â€è¿™ä¸ªæœ¯è¯­è¡¨ç¤ºçš„æ˜¯ä¸šåŠ¡äº‹ä»¶çš„<strong>åº¦é‡å€¼ï¼ˆå¯ç»Ÿè®¡æ¬¡æ•°ã€ä¸ªæ•°ã€é‡‘é¢ç­‰ï¼‰</strong>ï¼Œ</p><ul><li> éå¸¸çš„å¤§</li><li> å†…å®¹ç›¸å¯¹çš„çª„ï¼šåˆ—æ•°è¾ƒå°‘ï¼ˆä¸»è¦æ˜¯å¤–é”®idå’Œåº¦é‡å€¼ï¼‰</li><li> ç»å¸¸å‘ç”Ÿå˜åŒ–ï¼Œæ¯å¤©ä¼šæ–°å¢åŠ å¾ˆå¤šã€‚</li></ul></blockquote><blockquote><p><strong>1ï¼‰äº‹åŠ¡å‹äº‹å®è¡¨</strong></p><p>ä»¥<strong>æ¯ä¸ªäº‹åŠ¡æˆ–äº‹ä»¶ä¸ºå•ä½</strong>ï¼Œä¾‹å¦‚ä¸€ä¸ªé”€å”®è®¢å•è®°å½•ï¼Œä¸€ç¬”æ”¯ä»˜è®°å½•ç­‰ï¼Œä½œä¸ºäº‹å®è¡¨é‡Œçš„ä¸€è¡Œæ•°æ®ã€‚ä¸€æ—¦äº‹åŠ¡è¢«æäº¤ï¼Œäº‹å®è¡¨æ•°æ®è¢«æ’å…¥ï¼Œæ•°æ®å°±ä¸å†è¿›è¡Œæ›´æ”¹ï¼Œå…¶æ›´æ–°æ–¹å¼ä¸ºå¢é‡æ›´æ–°ã€‚</p><p><strong>2ï¼‰å‘¨æœŸå‹å¿«ç…§äº‹å®è¡¨</strong></p><p>å‘¨æœŸå‹å¿«ç…§äº‹å®è¡¨ä¸­<strong>ä¸ä¼šä¿ç•™æ‰€æœ‰æ•°æ®ï¼Œåªä¿ç•™å›ºå®šæ—¶é—´é—´éš”çš„æ•°æ®</strong>ï¼Œä¾‹å¦‚æ¯å¤©æˆ–è€…æ¯æœˆçš„é”€å”®é¢ï¼Œæˆ–æ¯æœˆçš„è´¦æˆ·ä½™é¢ç­‰ã€‚</p><p>ä¾‹å¦‚è´­ç‰©è½¦ï¼Œæœ‰åŠ å‡å•†å“ï¼Œéšæ—¶éƒ½æœ‰å¯èƒ½å˜åŒ–ï¼Œä½†æ˜¯æˆ‘ä»¬æ›´å…³å¿ƒæ¯å¤©ç»“æŸæ—¶è¿™é‡Œé¢æœ‰å¤šå°‘å•†å“ï¼Œæ–¹ä¾¿æˆ‘ä»¬åæœŸç»Ÿè®¡åˆ†æã€‚</p><p><strong>3ï¼‰ç´¯ç§¯å‹å¿«ç…§äº‹å®è¡¨</strong></p><p><strong>ç´¯è®¡å¿«ç…§äº‹å®è¡¨ç”¨äºè·Ÿè¸ªä¸šåŠ¡äº‹å®çš„å˜åŒ–ã€‚</strong>ä¾‹å¦‚ï¼Œæ•°æ®ä»“åº“ä¸­å¯èƒ½éœ€è¦ç´¯ç§¯æˆ–è€…å­˜å‚¨è®¢å•ä»ä¸‹è®¢å•å¼€å§‹ï¼Œåˆ°è®¢å•å•†å“è¢«æ‰“åŒ…ã€è¿è¾“ã€å’Œç­¾æ”¶çš„å„ä¸ªä¸šåŠ¡é˜¶æ®µçš„æ—¶é—´ç‚¹æ•°æ®æ¥è·Ÿè¸ªè®¢å•å£°æ˜å‘¨æœŸçš„è¿›å±•æƒ…å†µã€‚å½“è¿™ä¸ªä¸šåŠ¡è¿‡ç¨‹è¿›è¡Œæ—¶ï¼Œäº‹å®è¡¨çš„è®°å½•ä¹Ÿè¦ä¸æ–­æ›´æ–°ã€‚</p></blockquote><h4 id="5ã€ç»´åº¦æ¨¡å‹åˆ†ç±»"><a href="#5ã€ç»´åº¦æ¨¡å‹åˆ†ç±»" class="headerlink" title="5ã€ç»´åº¦æ¨¡å‹åˆ†ç±»"></a>5ã€ç»´åº¦æ¨¡å‹åˆ†ç±»</h4><h5 id="5-1ã€æ˜Ÿå‹æ¨¡å‹"><a href="#5-1ã€æ˜Ÿå‹æ¨¡å‹" class="headerlink" title="5.1ã€æ˜Ÿå‹æ¨¡å‹"></a>5.1ã€æ˜Ÿå‹æ¨¡å‹</h5><blockquote><p>é›ªèŠ±æ¨¡å‹ä¸æ˜Ÿå‹æ¨¡å‹çš„åŒºåˆ«ä¸»è¦åœ¨äºç»´åº¦çš„å±‚çº§ï¼Œæ ‡å‡†çš„æ˜Ÿå‹æ¨¡å‹ç»´åº¦åªæœ‰ä¸€å±‚ï¼Œè€Œé›ªèŠ±æ¨¡å‹å¯èƒ½ä¼šæ¶‰åŠå¤šçº§<img src="https://file.buildworld.cn/img/20210107202646.png"></p></blockquote><h5 id="5-2ã€é›ªèŠ±æ¨¡å‹"><a href="#5-2ã€é›ªèŠ±æ¨¡å‹" class="headerlink" title="5.2ã€é›ªèŠ±æ¨¡å‹"></a>5.2ã€é›ªèŠ±æ¨¡å‹</h5><p><img src="https://file.buildworld.cn/img/20210107204147.png"></p><h5 id="5-3ã€æ˜Ÿåº§æ¨¡å‹"><a href="#5-3ã€æ˜Ÿåº§æ¨¡å‹" class="headerlink" title="5.3ã€æ˜Ÿåº§æ¨¡å‹"></a>5.3ã€æ˜Ÿåº§æ¨¡å‹</h5><blockquote><p>æ˜Ÿåº§æ¨¡å‹ä¸å‰ä¸¤ç§æƒ…å†µçš„åŒºåˆ«æ˜¯äº‹å®è¡¨çš„æ•°é‡ï¼Œæ˜Ÿåº§æ¨¡å‹æ˜¯åŸºäºå¤šä¸ªäº‹å®è¡¨çš„ã€‚</p></blockquote><p><img src="https://file.buildworld.cn/img/20210107210328.png"></p><h4 id="6ã€æ•°æ®ä»“åº“å»ºæ¨¡"><a href="#6ã€æ•°æ®ä»“åº“å»ºæ¨¡" class="headerlink" title="6ã€æ•°æ®ä»“åº“å»ºæ¨¡"></a>6ã€æ•°æ®ä»“åº“å»ºæ¨¡</h4><h5 id="6-1ã€ODSå±‚"><a href="#6-1ã€ODSå±‚" class="headerlink" title="6.1ã€ODSå±‚"></a>6.1ã€ODSå±‚</h5><blockquote><ul><li>ç”¨æˆ·è¡Œä¸ºæ•°æ®</li><li>ä¸šåŠ¡æ•°æ®</li></ul></blockquote><h5 id="6-2ã€DWDå±‚"><a href="#6-2ã€DWDå±‚" class="headerlink" title="6.2ã€DWDå±‚"></a>6.2ã€DWDå±‚</h5><blockquote><p>DWDå±‚éœ€è¦æ„å»ºç»´åº¦æ¨¡å‹ï¼Œä¸€èˆ¬é‡‡ç”¨æ˜Ÿå‹æ¨¡å‹ã€‚è§ä¸Šé¢å›¾</p><p><strong>ç»´åº¦å»ºæ¨¡ä¸€èˆ¬æŒ‰ç…§ä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š</strong></p><p><code>é€‰æ‹©ä¸šåŠ¡è¿‡ç¨‹â†’å£°æ˜ç²’åº¦â†’ç¡®è®¤ç»´åº¦â†’ç¡®è®¤äº‹å®</code></p><p><strong>ï¼ˆ1ï¼‰é€‰æ‹©ä¸šåŠ¡è¿‡ç¨‹</strong></p><p>åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼ŒæŒ‘é€‰æˆ‘ä»¬æ„Ÿå…´è¶£çš„ä¸šåŠ¡çº¿ï¼Œæ¯”å¦‚ä¸‹å•ä¸šåŠ¡ï¼Œæ”¯ä»˜ä¸šåŠ¡ï¼Œé€€æ¬¾ä¸šåŠ¡ï¼Œç‰©æµä¸šåŠ¡ï¼Œä¸€æ¡ä¸šåŠ¡çº¿å¯¹åº”ä¸€å¼ äº‹å®è¡¨ã€‚</p><p>å¦‚æœæ˜¯ä¸­å°å…¬å¸ï¼Œå°½é‡æŠŠæ‰€æœ‰ä¸šåŠ¡è¿‡ç¨‹éƒ½é€‰æ‹©ã€‚</p><p>å¦‚æœæ˜¯å¤§å…¬å¸ï¼ˆ1000å¤šå¼ è¡¨ï¼‰ï¼Œé€‰æ‹©å’Œéœ€æ±‚ç›¸å…³çš„ä¸šåŠ¡çº¿ã€‚</p><p><strong>ï¼ˆ2ï¼‰å£°æ˜ç²’åº¦</strong></p><p>æ•°æ®ç²’åº¦æŒ‡æ•°æ®ä»“åº“çš„æ•°æ®ä¸­ä¿å­˜æ•°æ®çš„ç»†åŒ–ç¨‹åº¦æˆ–ç»¼åˆç¨‹åº¦çš„çº§åˆ«ã€‚</p><p>å£°æ˜ç²’åº¦æ„å‘³ç€ç²¾ç¡®å®šä¹‰äº‹å®è¡¨ä¸­çš„ä¸€è¡Œæ•°æ®è¡¨ç¤ºä»€ä¹ˆï¼Œåº”è¯¥å°½å¯èƒ½é€‰æ‹©<strong>æœ€å°ç²’åº¦</strong>ï¼Œä»¥æ­¤æ¥åº”å„ç§å„æ ·çš„éœ€æ±‚ã€‚</p><p><strong>å…¸å‹çš„ç²’åº¦å£°æ˜å¦‚ä¸‹ï¼š</strong></p><p>è®¢å•äº‹å®è¡¨ä¸­ä¸€è¡Œæ•°æ®è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªè®¢å•ä¸­çš„ä¸€ä¸ªå•†å“é¡¹ã€‚</p><p>æ”¯ä»˜äº‹å®è¡¨ä¸­ä¸€è¡Œæ•°æ®è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªæ”¯ä»˜è®°å½•ã€‚</p><p><strong>ï¼ˆ3ï¼‰ç¡®å®šç»´åº¦</strong></p><p>ç»´åº¦çš„ä¸»è¦ä½œç”¨æ˜¯æè¿°ä¸šåŠ¡æ˜¯äº‹å®ï¼Œä¸»è¦è¡¨ç¤ºçš„æ˜¯â€œè°ï¼Œä½•å¤„ï¼Œä½•æ—¶â€ç­‰ä¿¡æ¯ã€‚</p><p>ç¡®å®šç»´åº¦çš„åŸåˆ™æ˜¯ï¼šåç»­éœ€æ±‚ä¸­æ˜¯å¦è¦åˆ†æç›¸å…³ç»´åº¦çš„æŒ‡æ ‡ã€‚ä¾‹å¦‚ï¼Œéœ€è¦ç»Ÿè®¡ï¼Œä»€ä¹ˆæ—¶é—´ä¸‹çš„è®¢å•å¤šï¼Œå“ªä¸ªåœ°åŒºä¸‹çš„è®¢å•å¤šï¼Œå“ªä¸ªç”¨æˆ·ä¸‹çš„è®¢å•å¤šã€‚éœ€è¦ç¡®å®šçš„ç»´åº¦å°±åŒ…æ‹¬ï¼šæ—¶é—´ç»´åº¦ã€åœ°åŒºç»´åº¦ã€ç”¨æˆ·ç»´åº¦ã€‚</p><p><strong>ï¼ˆ4ï¼‰ç¡®å®šäº‹å®</strong></p><p>æ­¤å¤„çš„â€œäº‹å®â€ä¸€è¯ï¼ŒæŒ‡çš„æ˜¯ä¸šåŠ¡ä¸­çš„åº¦é‡å€¼ï¼ˆæ¬¡æ•°ã€ä¸ªæ•°ã€ä»¶æ•°ã€é‡‘é¢ï¼Œå¯ä»¥è¿›è¡Œç´¯åŠ ï¼‰ï¼Œä¾‹å¦‚è®¢å•é‡‘é¢ã€ä¸‹å•æ¬¡æ•°ç­‰ã€‚</p><p>åœ¨DWDå±‚ï¼Œä»¥<strong>ä¸šåŠ¡è¿‡ç¨‹</strong>ä¸ºå»ºæ¨¡é©±åŠ¨ï¼ŒåŸºäºæ¯ä¸ªå…·ä½“ä¸šåŠ¡è¿‡ç¨‹çš„ç‰¹ç‚¹ï¼Œæ„å»º<strong>æœ€ç»†ç²’åº¦</strong>çš„æ˜ç»†å±‚äº‹å®è¡¨ã€‚äº‹å®è¡¨å¯åšé€‚å½“çš„å®½è¡¨åŒ–å¤„ç†ã€‚</p></blockquote><h5 id="6-3-DWSå’ŒDWTå±‚"><a href="#6-3-DWSå’ŒDWTå±‚" class="headerlink" title="6.3 DWSå’ŒDWTå±‚"></a>6.3 DWSå’ŒDWTå±‚</h5><blockquote><p><code>DWSå’ŒDWTå±‚çš„åŒºåˆ«</code>ï¼šDWSå±‚å­˜æ”¾çš„æ‰€æœ‰ä¸»é¢˜å¯¹è±¡å½“å¤©çš„æ±‡æ€»è¡Œä¸ºï¼Œä¾‹å¦‚æ¯ä¸ªåœ°åŒºå½“å¤©çš„ä¸‹å•æ¬¡æ•°ï¼Œä¸‹å•é‡‘é¢ç­‰ï¼ŒDWTå±‚å­˜æ”¾çš„æ˜¯æ‰€æœ‰ä¸»é¢˜å¯¹è±¡çš„ç´¯ç§¯è¡Œä¸ºï¼Œä¾‹å¦‚æ¯ä¸ªåœ°åŒºæœ€è¿‘ï¼—å¤©ï¼ˆ15å¤©ã€30å¤©ã€60å¤©ï¼‰çš„ä¸‹å•æ¬¡æ•°ã€ä¸‹å•é‡‘é¢ç­‰ã€‚</p></blockquote><h5 id="6-4-ADSå±‚"><a href="#6-4-ADSå±‚" class="headerlink" title="6.4 ADSå±‚"></a>6.4 ADSå±‚</h5><h3 id="ä¸‰ã€æµæ‰¹ä¸€ä½“æ¶æ„"><a href="#ä¸‰ã€æµæ‰¹ä¸€ä½“æ¶æ„" class="headerlink" title="ä¸‰ã€æµæ‰¹ä¸€ä½“æ¶æ„"></a>ä¸‰ã€æµæ‰¹ä¸€ä½“æ¶æ„</h3><h4 id="1ã€ä¼ ç»Ÿæ•°ä»“æ¶æ„ï¼ˆLambdaï¼‰"><a href="#1ã€ä¼ ç»Ÿæ•°ä»“æ¶æ„ï¼ˆLambdaï¼‰" class="headerlink" title="1ã€ä¼ ç»Ÿæ•°ä»“æ¶æ„ï¼ˆLambdaï¼‰"></a>1ã€ä¼ ç»Ÿæ•°ä»“æ¶æ„ï¼ˆLambdaï¼‰</h4><p><img src="https://file.buildworld.cn/img/20210115195432.png"></p><blockquote><p>ä¼ ç»Ÿçš„Lambdaæ¶æ„åˆ†ä¸ºï¼š</p><ul><li>ä¸šåŠ¡å±‚</li><li>å­˜å‚¨å±‚</li><li>è®¡ç®—å±‚</li><li>æœåŠ¡å±‚</li><li>åº”ç”¨å±‚</li></ul></blockquote><p>ä¼ ç»Ÿçš„æ¶æ„å¾ˆçµæ´»ï¼Œæµå’Œæ‰¹ä¹‹é—´æ²¡æœ‰ç›¸äº’è€¦åˆï¼Œä½†æ˜¯ä¹Ÿä¼š<strong>å¸¦æ¥çš„é—®é¢˜</strong>ï¼š</p><ul><li><strong>æ•ˆç‡å±‚é¢</strong>ï¼šæµæ‰¹åº•å±‚æ•°æ®æ¨¡å‹ä¸ä¸€è‡´ï¼Œå¯¼è‡´åº”ç”¨å±‚éœ€è¦åšå¤§é‡çš„æ‹¼æ¥é€»è¾‘ï¼ˆåŒæ¯”ã€ç¯æ¯”ã€äºŒæ¬¡åŠ å·¥ç­‰ï¼‰ï¼Œæ­å»ºæ•ˆç‡ä½ï¼Œä¸”å®¹æ˜“å‡ºé”™ã€‚</li><li><strong>æˆæœ¬å±‚é¢</strong>ï¼šæµæ‰¹å­˜å‚¨ç³»ç»Ÿéš”ç¦»ï¼ˆé¢å‘ä¸åŒå†™å…¥åœºæ™¯ï¼‰ï¼Œæä¾›çš„æ•°æ®æœåŠ¡ä¸ä¸€è‡´ï¼Œç»´æŠ¤æˆæœ¬é«˜ã€‚åŒæ—¶ï¼Œæ‰‹å·¥åˆ›å»ºæ•°æ®åŒæ­¥ä»»åŠ¡ï¼Œå¢åŠ äº†å¼€å‘æˆæœ¬å’Œå­˜å‚¨æˆæœ¬ã€‚</li><li><strong>è´¨é‡ä¸èµ„æºå±‚é¢</strong>ï¼šé¦–å…ˆï¼Œä¸€ä¸ªä¸šåŠ¡é€»è¾‘ï¼Œä¸¤ä¸ªå¼•æ“ä¸¤å¥—ä»£ç ï¼ŒSQL é€»è¾‘ä¸èƒ½å¤ç”¨ï¼Œæ•°æ®ä¸€è‡´æ€§å’Œè´¨é‡éš¾ä»¥ä¿éšœã€‚å…¶æ¬¡ï¼Œä¸åŒå¹³å°å’Œå¼•æ“é—´åˆ‡æ¢ï¼Œå¼€å‘ä½“éªŒå‰²è£‚ï¼Œå®¹æ˜“å‡ºç°å˜æ›´é—æ¼ã€‚å¹¶ä¸”ï¼Œæ‰¹å¤„ç†&amp;æµå¤„ç†é›†ç¾¤æ— æ³•åšåˆ°é”™å³°ï¼Œèµ„æºåˆ©ç”¨ç‡è¾ƒä½ã€‚</li></ul><h4 id="2ã€æµæ‰¹ä¸€ä½“æ¶æ„ï¼ˆKappa-Lambdaï¼‰"><a href="#2ã€æµæ‰¹ä¸€ä½“æ¶æ„ï¼ˆKappa-Lambdaï¼‰" class="headerlink" title="2ã€æµæ‰¹ä¸€ä½“æ¶æ„ï¼ˆKappa+Lambdaï¼‰"></a>2ã€æµæ‰¹ä¸€ä½“æ¶æ„ï¼ˆKappa+Lambdaï¼‰</h4><p><strong>æœ¬è´¨ä¸Šæ˜¯åœ¨æµçš„åœºæ™¯ä¸­å¯»æ‰¾æ‰¹åœºæ™¯</strong></p><p><img src="https://file.buildworld.cn/img/20210115200803.png"></p><ul><li><strong>æµæ‰¹é€»è¾‘å±‚</strong>ï¼šè¿™æ˜¯æœ€é‡è¦çš„éƒ¨åˆ†ä¹‹ä¸€ã€‚ä¸šåŠ¡å±‚å’Œå­˜å‚¨å±‚ä»ç„¶ä¸å˜ï¼Œåœ¨æ­¤ä¹‹ä¸Šæ„å»ºä¸€ä¸ªæµæ‰¹é€»è¾‘å±‚æ¥è¿›è¡Œæµå­˜å‚¨å’Œæ‰¹å­˜å‚¨çš„æ˜ å°„ã€‚æœ‰äº†è¿™ä¸ªé€»è¾‘å±‚ï¼Œå°±å¯ä»¥åŸºäº Flink å¼•æ“é¢å‘ç»Ÿä¸€çš„é€»è¾‘å±‚åšä¸šåŠ¡é€»è¾‘è¡¨è¾¾ï¼Œå¹¶ä¸”è¾“å‡ºæ˜¯ç»Ÿä¸€çš„ã€‚</li><li><strong>è®¡ç®—å±‚</strong>ï¼šåšæµæ‰¹ç»Ÿä¸€å¤„ç†ã€‚é¦–å…ˆï¼Œä¸€å¥—ä»£ç ï¼Œä¸¤ç§è®¡ç®—æ¨¡å¼ï¼Œé€»è¾‘ç»Ÿä¸€ï¼Œçµæ´»åˆ‡æ¢ï¼Œå¯ä»¥å®ç°ç ”å‘æ•ˆç‡å¤§å¹…æå‡ã€‚å…¶æ¬¡ï¼Œæµæ‰¹è®¡ç®—èµ„æºæ··éƒ¨ï¼Œèµ„æºåˆ©ç”¨ç‡æå‡ã€‚</li><li><strong>æœåŠ¡å±‚</strong>ï¼šåšæµæ‰¹ç»Ÿä¸€å­˜å‚¨ï¼Œæ— éœ€æ‰‹å·¥åŒæ­¥ï¼Œæ— é‡å¤å­˜å‚¨ã€‚</li><li><strong>åº”ç”¨å±‚</strong>ï¼šè¿›è¡Œäº§å“ç»„è£…ï¼Œæµæ‰¹å­˜å‚¨é€æ˜åŒ–ï¼ŒæŸ¥è¯¢é€»è¾‘å®Œå…¨ä¸€è‡´ï¼Œåº”ç”¨ç«¯æ¥å…¥æˆæœ¬å¤§å¹…é™ä½ï¼Œç‚¹æŸ¥ / OLAP åˆ†æç»Ÿä¸€æ”¯æŒã€‚</li></ul>]]></content>
    
    
    <summary type="html">æ•°æ®ä»“åº“ï¼Œè‹±æ–‡åç§°ä¸ºData Warehouseï¼Œå¯ç®€å†™ä¸ºDWæˆ–DWHã€‚æ•°æ®ä»“åº“ï¼Œæ˜¯ä¸ºä¼ä¸šæ‰€æœ‰çº§åˆ«çš„å†³ç­–åˆ¶å®šè¿‡ç¨‹ï¼Œæä¾›æ‰€æœ‰ç±»å‹æ•°æ®æ”¯æŒçš„æˆ˜ç•¥é›†åˆã€‚</summary>
    
    
    
    <category term="BigData" scheme="https://www.buildworld.cn/categories/BigData/"/>
    
    
    <category term="Data WareHouse" scheme="https://www.buildworld.cn/tags/Data-WareHouse/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•å­¦ä¹ è®°å½•</title>
    <link href="https://www.buildworld.cn/2020/11/04/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    <id>https://www.buildworld.cn/2020/11/04/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/</id>
    <published>2020-11-04T01:20:49.000Z</published>
    <updated>2021-04-09T02:15:11.754Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="ä¸€ã€ä»‹ç»"><a href="#ä¸€ã€ä»‹ç»" class="headerlink" title="ä¸€ã€ä»‹ç»"></a>ä¸€ã€ä»‹ç»</h3><h4 id="1ã€å¸¸è§çš„æ•°æ®ç»“æ„"><a href="#1ã€å¸¸è§çš„æ•°æ®ç»“æ„" class="headerlink" title="1ã€å¸¸è§çš„æ•°æ®ç»“æ„"></a>1ã€å¸¸è§çš„æ•°æ®ç»“æ„</h4><blockquote><p><code>ã€Œé˜Ÿåˆ—ã€</code>ã€<code>ã€Œæ ˆã€</code>è¿™ä¸¤ç§æ•°æ®ç»“æ„æ—¢å¯ä»¥ä½¿â½¤é“¾è¡¨ä¹Ÿå¯ä»¥ä½¿â½¤æ•°ç»„å®ç°ã€‚â½¤æ•°ç»„å®ç°ï¼Œå°±è¦å¤„ç†æ‰©å®¹ç¼©å®¹çš„é—®é¢˜ï¼›â½¤é“¾è¡¨å®ç°ï¼Œæ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œä½†éœ€è¦æ›´å¤šçš„å†…å­˜ç©ºé—´å­˜å‚¨èŠ‚ç‚¹æŒ‡é’ˆã€‚</p><p><code>ã€Œå›¾ã€</code>çš„ä¸¤ç§è¡¨â½°â½…æ³•ï¼Œé‚»æ¥è¡¨å°±æ˜¯é“¾è¡¨ï¼Œé‚»æ¥çŸ©é˜µå°±æ˜¯â¼†ç»´æ•°ç»„ã€‚é‚»æ¥çŸ©é˜µåˆ¤æ–­è¿é€šæ€§è¿…é€Ÿï¼Œå¹¶å¯ä»¥è¿›â¾çŸ©é˜µè¿ç®—è§£å†³â¼€äº›é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœå›¾â½è¾ƒç¨€ç–çš„è¯å¾ˆè€—è´¹ç©ºé—´ã€‚é‚»æ¥è¡¨â½è¾ƒèŠ‚çœç©ºé—´ï¼Œä½†æ˜¯å¾ˆå¤šæ“ä½œçš„æ•ˆç‡ä¸Šè‚¯å®šâ½ä¸è¿‡é‚»æ¥çŸ©é˜µã€‚</p><p><code>ã€Œæ•£åˆ—è¡¨ã€</code>å°±æ˜¯é€šè¿‡æ•£åˆ—å‡½æ•°æŠŠé”®æ˜ å°„åˆ°â¼€ä¸ªâ¼¤æ•°ç»„â¾¥ã€‚â½½ä¸”å¯¹äºè§£å†³æ•£åˆ—å†²çªçš„â½…æ³•ï¼Œæ‹‰é“¾æ³•éœ€è¦é“¾è¡¨ç‰¹æ€§ï¼Œæ“ä½œç®€å•ï¼Œä½†éœ€è¦é¢å¤–çš„ç©ºé—´å­˜å‚¨æŒ‡é’ˆï¼›çº¿æ€§æ¢æŸ¥æ³•å°±éœ€è¦æ•°ç»„ç‰¹æ€§ï¼Œä»¥ä¾¿è¿ç»­å¯»å€ï¼Œä¸éœ€è¦æŒ‡é’ˆçš„å­˜å‚¨ç©ºé—´ï¼Œä½†æ“ä½œç¨å¾®å¤æ‚äº›ã€‚</p><p><code>ã€Œæ ‘ã€</code>ï¼Œâ½¤æ•°ç»„å®ç°å°±æ˜¯ã€Œå †ã€ï¼Œå› ä¸ºã€Œå †ã€æ˜¯â¼€ä¸ªå®Œå…¨â¼†å‰æ ‘ï¼Œâ½¤æ•°ç»„å­˜å‚¨ä¸éœ€è¦èŠ‚ç‚¹æŒ‡é’ˆï¼Œæ“ä½œä¹Ÿâ½è¾ƒç®€å•ï¼›â½¤é“¾è¡¨å®ç°å°±æ˜¯å¾ˆå¸¸â»…çš„é‚£ç§ã€Œæ ‘ã€ï¼Œå› ä¸ºä¸â¼€å®šæ˜¯å®Œå…¨â¼†å‰æ ‘ï¼Œæ‰€ä»¥ä¸é€‚åˆâ½¤æ•°ç»„å­˜å‚¨ã€‚ä¸ºæ­¤ï¼Œåœ¨è¿™ç§é“¾è¡¨ã€Œæ ‘ã€ç»“æ„ä¹‹ä¸Šï¼Œâ¼œè¡â½£å‡ºå„ç§å·§å¦™çš„è®¾è®¡ï¼Œâ½å¦‚â¼†å‰æœç´¢æ ‘ã€AVLæ ‘ã€çº¢â¿Šæ ‘ã€åŒºé—´æ ‘ã€B æ ‘ç­‰ç­‰ï¼Œä»¥åº”å¯¹ä¸åŒçš„é—®é¢˜ã€‚</p></blockquote><h4 id="2ã€å¸¸è§çš„ç®—æ³•æ¡†æ¶"><a href="#2ã€å¸¸è§çš„ç®—æ³•æ¡†æ¶" class="headerlink" title="2ã€å¸¸è§çš„ç®—æ³•æ¡†æ¶"></a>2ã€å¸¸è§çš„ç®—æ³•æ¡†æ¶</h4><blockquote><p>æ•°ç»„éå†æ¡†æ¶ï¼Œå…¸å‹çš„çº¿æ€§è¿­ä»£ç»“æ„ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">void</span> <span class="title">traverse</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line"><span class="comment">// è¿­ä»£è®¿é—® arr[i]</span></span><br><span class="line">      &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><blockquote><p>é“¾è¡¨éå†æ¡†æ¶ï¼Œå…¼å…·è¿­ä»£å’Œé€’å½’ç»“æ„ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* åŸºæœ¬çš„å•é“¾è¡¨èŠ‚ç‚¹ */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> val;</span><br><span class="line">    ListNode next;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">traverse</span><span class="params">(ListNode head)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">for</span> (ListNode p = head; p != <span class="keyword">null</span>; p = p.next) &#123;</span><br><span class="line"><span class="comment">// è¿­ä»£è®¿é—® p.val</span></span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">traverse</span><span class="params">(ListNode head)</span> </span>&#123;</span><br><span class="line"><span class="comment">// é€’å½’è®¿é—® head.val</span></span><br><span class="line">     traverse(head.next)</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><blockquote><p>â¼†å‰æ ‘éå†æ¡†æ¶ï¼Œå…¸å‹çš„â¾®çº¿æ€§é€’å½’éå†ç»“æ„ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* åŸºæœ¬çš„â¼†å‰æ ‘èŠ‚ç‚¹ */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> val;</span><br><span class="line">    TreeNode left, right;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">void</span> <span class="title">traverse</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">        traverse(root.left)</span><br><span class="line">        traverse(root.right)</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="äºŒã€åŠ¨æ€è§„åˆ’"><a href="#äºŒã€åŠ¨æ€è§„åˆ’" class="headerlink" title="äºŒã€åŠ¨æ€è§„åˆ’"></a>äºŒã€åŠ¨æ€è§„åˆ’</h3><h4 id="1ã€æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ç®—æ³•ä¼˜åŒ–"><a href="#1ã€æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ç®—æ³•ä¼˜åŒ–" class="headerlink" title="1ã€æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ç®—æ³•ä¼˜åŒ–"></a>1ã€æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ç®—æ³•ä¼˜åŒ–</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–æ³¢é‚£å¥‘æ•°åˆ—(å¤‡å¿˜å½•)</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">fib3</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (N &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span>[] meno = <span class="keyword">new</span> <span class="keyword">int</span>[N + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">return</span> helper(meno, N);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">helper</span><span class="params">(<span class="keyword">int</span>[] meno, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span> || n == <span class="number">2</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (meno[n] != <span class="number">0</span>) <span class="keyword">return</span> meno[n];</span><br><span class="line"></span><br><span class="line">    meno[n] = helper(meno, n - <span class="number">1</span>) + helper(meno, n - <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">return</span> meno[n];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–æ³¢é‚£å¥‘æ•°åˆ—(dpè¡¨)</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">fib</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span>[] dp = <span class="keyword">new</span> <span class="keyword">int</span>[N + <span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">1</span>] = dp[<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">3</span>; i &lt;= N; i++) &#123;</span><br><span class="line">        dp[i] = dp[i - <span class="number">1</span>] + dp[i - <span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dp[N];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–æ³¢é‚£å¥‘æ•°åˆ—(ç©ºé—´å¤æ‚åº¦é™ä¸º1)</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">fib2</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span> || n == <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> prev = <span class="number">1</span>, curr = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">3</span>; i &lt;= n; i++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> sum = prev + curr;</span><br><span class="line">        prev = curr;</span><br><span class="line">        curr = sum;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> curr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸‰ã€å›æº¯ç®—æ³•"><a href="#ä¸‰ã€å›æº¯ç®—æ³•" class="headerlink" title="ä¸‰ã€å›æº¯ç®—æ³•"></a>ä¸‰ã€å›æº¯ç®—æ³•</h3><p><strong>çº¯æš´åŠ›ç©·ä¸¾ç®—æ³•ï¼Œå¤æ‚åº¦å¾ˆé«˜</strong></p><h4 id="å›æº¯ç®—æ³•çš„æ¡†æ¶ï¼š"><a href="#å›æº¯ç®—æ³•çš„æ¡†æ¶ï¼š" class="headerlink" title="å›æº¯ç®—æ³•çš„æ¡†æ¶ï¼š"></a>å›æº¯ç®—æ³•çš„æ¡†æ¶ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">result = []</span><br><span class="line"><span class="function">def <span class="title">backtrack</span><span class="params">(è·¯å¾„, é€‰æ‹©åˆ—è¡¨)</span>:</span></span><br><span class="line"><span class="function"><span class="keyword">if</span> æ»¡â¾œç»“æŸæ¡ä»¶:</span></span><br><span class="line"><span class="function">result.<span class="title">add</span><span class="params">(è·¯å¾„)</span></span></span><br><span class="line"><span class="function">return</span></span><br><span class="line"><span class="function"><span class="keyword">for</span> é€‰æ‹© in é€‰æ‹©åˆ—è¡¨:</span></span><br><span class="line"><span class="function">åšé€‰æ‹©</span></span><br><span class="line"><span class="function"><span class="title">backtrack</span><span class="params">(è·¯å¾„, é€‰æ‹©åˆ—è¡¨)</span></span></span><br><span class="line"><span class="function">æ’¤é”€é€‰æ‹©</span></span><br></pre></td></tr></table></figure><h4 id="1ã€å…¨æ’åˆ—ç®—æ³•"><a href="#1ã€å…¨æ’åˆ—ç®—æ³•" class="headerlink" title="1ã€å…¨æ’åˆ—ç®—æ³•"></a>1ã€å…¨æ’åˆ—ç®—æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * å…¨æ’åˆ—ä»£ç </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MiChong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-11-04 08:35</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuanPaiLie</span> </span>&#123;</span><br><span class="line">    <span class="comment">//è·¯å¾„é›†åˆ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ç»“æœï¼š[[1, 2, 3], [1, 3, 2], [2, 1, 3], [2, 3, 1], [3, 1, 2], [3, 2, 1]]</span></span><br><span class="line">        <span class="keyword">int</span>[] nums = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; res = permute(nums);</span><br><span class="line">        System.out.println(res.toString());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;List&lt;Integer&gt;&gt; permute(<span class="keyword">int</span>[] nums) &#123;</span><br><span class="line">        LinkedList&lt;Integer&gt; track = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">        backtrack(nums, track);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  è·¯å¾„ï¼šè®°å½•åœ¨ track ä¸­</span></span><br><span class="line"><span class="comment">     *  é€‰æ‹©åˆ—è¡¨ï¼šnums ä¸­ä¸å­˜åœ¨äº track çš„é‚£äº›å…ƒç´ </span></span><br><span class="line"><span class="comment">     *  ç»“æŸæ¡ä»¶ï¼šnums ä¸­çš„å…ƒç´ å…¨éƒ½åœ¨ track ä¸­å‡ºç°</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nums éœ€è¦æ’åˆ—çš„æ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> track å­˜æ”¾çš„è·¯å¾„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">backtrack</span><span class="params">(<span class="keyword">int</span>[] nums, LinkedList&lt;Integer&gt; track)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ°åº•äº†ï¼Œè·³å‡ºæ­¤æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">if</span> (track.size() == nums.length) &#123;</span><br><span class="line">            res.add(<span class="keyword">new</span> LinkedList(track));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="comment">// æ’é™¤ä¸åˆæ³•çš„é€‰æ‹©</span></span><br><span class="line">            <span class="keyword">if</span> (track.contains(nums[i]))</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åšé€‰æ‹©</span></span><br><span class="line">            track.add(nums[i]);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è¿›å…¥ä¸‹ä¸€å±‚å†³ç­–æ ‘</span></span><br><span class="line">            backtrack(nums, track);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å–æ¶ˆé€‰æ‹©</span></span><br><span class="line">            track.removeLast();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å››ã€BFSç®—æ³•"><a href="#å››ã€BFSç®—æ³•" class="headerlink" title="å››ã€BFSç®—æ³•"></a>å››ã€BFSç®—æ³•</h3><p><strong>å›¾çš„æœç´¢ç®—æ³•åˆ†ä¸ºBDFï¼ˆå¹¿åº¦ä¼˜å…ˆæœç´¢ï¼‰å’Œï¼ˆæ·±åº¦ä¼˜å…ˆæœç´¢ï¼‰</strong></p><h4 id="BFSæ¡†æ¶"><a href="#BFSæ¡†æ¶" class="headerlink" title="BFSæ¡†æ¶"></a>BFSæ¡†æ¶</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¡ç®—ä»èµ·ç‚¹ start åˆ°ç»ˆç‚¹ target çš„æœ€è¿‘è·ç¦»</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">BFS</span><span class="params">(Node start, Node target)</span> </span>&#123;</span><br><span class="line">    Queue&lt;Node&gt; q; <span class="comment">// æ ¸â¼¼æ•°æ®ç»“æ„</span></span><br><span class="line">    Set&lt;Node&gt; visited; <span class="comment">// é¿å…â¾›å›å¤´è·¯</span></span><br><span class="line">    q.offer(start); <span class="comment">// å°†èµ·ç‚¹åŠ â¼Šé˜Ÿåˆ—</span></span><br><span class="line">    visited.add(start);</span><br><span class="line">    <span class="keyword">int</span> step = <span class="number">0</span>; <span class="comment">// è®°å½•æ‰©æ•£çš„æ­¥æ•°</span></span><br><span class="line">    <span class="keyword">while</span> (q not empty) &#123;</span><br><span class="line">        <span class="keyword">int</span> sz = q.size();</span><br><span class="line">        <span class="comment">/* å°†å½“å‰é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹å‘å››å‘¨æ‰©æ•£ */</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sz; i++) &#123;</span><br><span class="line">            Node cur = q.poll();</span><br><span class="line">            <span class="comment">/* åˆ’é‡ç‚¹ï¼šè¿™â¾¥åˆ¤æ–­æ˜¯å¦åˆ°è¾¾ç»ˆç‚¹ */</span></span><br><span class="line">            <span class="keyword">if</span> (cur is target)</span><br><span class="line">            <span class="keyword">return</span> step;</span><br><span class="line">            <span class="comment">/* å°† cur çš„ç›¸é‚»èŠ‚ç‚¹åŠ â¼Šé˜Ÿåˆ— */</span></span><br><span class="line">            <span class="keyword">for</span> (Node x : cur.adj())</span><br><span class="line">                <span class="keyword">if</span> (x not in visited) &#123;</span><br><span class="line">                q.offer(x);</span><br><span class="line">                visited.add(x);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* åˆ’é‡ç‚¹ï¼šæ›´æ–°æ­¥æ•°åœ¨è¿™â¾¥ */</span></span><br><span class="line">        step++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="äºŒå‰æ ‘çš„æœ€å°æ·±åº¦"><a href="#äºŒå‰æ ‘çš„æœ€å°æ·±åº¦" class="headerlink" title="äºŒå‰æ ‘çš„æœ€å°æ·±åº¦"></a><a href="https://leetcode-cn.com/problems/minimum-depth-of-binary-tree/">äºŒå‰æ ‘çš„æœ€å°æ·±åº¦</a></h4><blockquote><p>é¢˜ç›®åœ°å€ï¼š<a href="https://leetcode-cn.com/problems/minimum-depth-of-binary-tree/">https://leetcode-cn.com/problems/minimum-depth-of-binary-tree/</a></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> val;</span><br><span class="line">    TreeNode left;</span><br><span class="line">    TreeNode right;</span><br><span class="line"></span><br><span class="line">    TreeNode() &#123; &#125;</span><br><span class="line">    TreeNode(<span class="keyword">int</span> val) &#123; <span class="keyword">this</span>.val = val; &#125;</span><br><span class="line">    TreeNode(<span class="keyword">int</span> val, TreeNode left, TreeNode right) &#123;</span><br><span class="line">        <span class="keyword">this</span>.val = val;</span><br><span class="line">        <span class="keyword">this</span>.left = left;</span><br><span class="line">        <span class="keyword">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minDepth</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (root == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    Queue&lt;TreeNode&gt; q = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">    q.offer(root);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> depth = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!q.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">int</span> sz = q.size();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sz; i++) &#123;</span><br><span class="line">            TreeNode cur = q.poll();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (cur.left == <span class="keyword">null</span> &amp;&amp; cur.right == <span class="keyword">null</span>) <span class="keyword">return</span> depth;</span><br><span class="line">            <span class="keyword">if</span> (cur.left != <span class="keyword">null</span>) q.offer(cur.left);</span><br><span class="line">            <span class="keyword">if</span> (cur.right != <span class="keyword">null</span>) q.offer(cur.right);</span><br><span class="line">        &#125;</span><br><span class="line">        depth++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> depth;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>DFSçš„æ—¶é—´å¤æ‚åº¦æ¯”BFSé«˜ï¼Œä½†æ˜¯DFSçš„ç©ºé—´å¤æ‚åº¦æ¯”BFSä½ã€‚</p><p>DFSåœ¨æœ€åçš„æƒ…å†µä¸‹ç©ºé—´å¤æ‚åº¦ä¸ºO(logN)ï¼Œè€ŒBFSæœ€åæƒ…å†µä¸‹çš„ç©ºé—´å¤æ‚åº¦ä¸ºO(N)ã€‚</p></blockquote><h3 id="äº”ã€äºŒåˆ†æœç´¢"><a href="#äº”ã€äºŒåˆ†æœç´¢" class="headerlink" title="äº”ã€äºŒåˆ†æœç´¢"></a>äº”ã€äºŒåˆ†æœç´¢</h3><h4 id="é›¶ã€â¼†åˆ†æŸ¥æ‰¾æ¡†æ¶"><a href="#é›¶ã€â¼†åˆ†æŸ¥æ‰¾æ¡†æ¶" class="headerlink" title="é›¶ã€â¼†åˆ†æŸ¥æ‰¾æ¡†æ¶"></a>é›¶ã€â¼†åˆ†æŸ¥æ‰¾æ¡†æ¶</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">binarySearch</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>, right = ...;</span><br><span class="line">        <span class="keyword">while</span> (...)&#123;</span><br><span class="line">            <span class="keyword">int</span> mid = left + (right - left) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (nums[mid] == target) &#123;</span><br><span class="line">...</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums[mid] &lt; target) &#123;</span><br><span class="line">                left = ...</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums[mid] &gt; target) &#123;</span><br><span class="line">                right = ...</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ...;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="äºŒåˆ†æŸ¥æ‰¾"><a href="#äºŒåˆ†æŸ¥æ‰¾" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾"></a>äºŒåˆ†æŸ¥æ‰¾</h4><blockquote><p>é¢˜ç›®åœ°å€ï¼š <a href="https://leetcode-cn.com/problems/binary-search/">https://leetcode-cn.com/problems/binary-search/</a></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">binarySearch</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> right = nums.length - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (left &lt;= right) &#123;</span><br><span class="line">        <span class="keyword">int</span> mid = left + (right - left) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (nums[mid] == target) <span class="keyword">return</span> mid;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (nums[mid] &lt; target) left = mid + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (nums[mid] &gt; target) right = mid - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">ç¼–ç¨‹=æ•°æ®ç»“æ„+ç®—æ³•</summary>
    
    
    
    <category term="ç®—æ³•" scheme="https://www.buildworld.cn/categories/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="åŠ¨æ€è§„åˆ’" scheme="https://www.buildworld.cn/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"/>
    
    <category term="æ•°æ®ç»“æ„" scheme="https://www.buildworld.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>BigData--åˆ†å¸ƒå¼æµæ•°æ®æµå¼•æ“Apache Flink</title>
    <link href="https://www.buildworld.cn/2020/09/11/BigData-%E5%88%86%E5%B8%83%E5%BC%8F%E6%B5%81%E6%95%B0%E6%8D%AE%E6%B5%81%E5%BC%95%E6%93%8EApache-Flink/"/>
    <id>https://www.buildworld.cn/2020/09/11/BigData-%E5%88%86%E5%B8%83%E5%BC%8F%E6%B5%81%E6%95%B0%E6%8D%AE%E6%B5%81%E5%BC%95%E6%93%8EApache-Flink/</id>
    <published>2020-09-11T02:59:30.000Z</published>
    <updated>2021-04-09T02:15:45.438Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p><img src="https://flink.apache.org/img/flink-header-logo.svg"></p><p><a href="https://flink.apache.org/">å®˜ç½‘ï¼šhttps://flink.apache.org/</a></p><h3 id="ä¸€ã€Flinkçš„é‡è¦ç‰¹ç‚¹"><a href="#ä¸€ã€Flinkçš„é‡è¦ç‰¹ç‚¹" class="headerlink" title="ä¸€ã€Flinkçš„é‡è¦ç‰¹ç‚¹"></a>ä¸€ã€Flinkçš„é‡è¦ç‰¹ç‚¹</h3><h4 id="1ï¼‰äº‹ä»¶é©±åŠ¨å‹ï¼ˆEvent-drivenï¼‰"><a href="#1ï¼‰äº‹ä»¶é©±åŠ¨å‹ï¼ˆEvent-drivenï¼‰" class="headerlink" title="1ï¼‰äº‹ä»¶é©±åŠ¨å‹ï¼ˆEvent-drivenï¼‰"></a>1ï¼‰äº‹ä»¶é©±åŠ¨å‹ï¼ˆEvent-drivenï¼‰</h4><blockquote><ul><li><code>äº‹ä»¶é©±åŠ¨çš„åº”ç”¨ç¨‹åº</code>æ˜¯ä¸€ä¸ªæœ‰çŠ¶æ€çš„åº”ç”¨ç¨‹åºï¼Œå®ƒä»ä¸€ä¸ªæˆ–å¤šä¸ªäº‹ä»¶æµæ¥æ”¶äº‹ä»¶ï¼Œå¹¶é€šè¿‡è§¦å‘è®¡ç®—ã€çŠ¶æ€æ›´æ–°æˆ–å¤–éƒ¨æ“ä½œå¯¹ä¼ å…¥äº‹ä»¶ä½œå‡ºååº”ã€‚</li><li><code>äº‹ä»¶é©±åŠ¨åº”ç”¨ç¨‹åº</code>æ˜¯ä¼ ç»Ÿåº”ç”¨ç¨‹åºè®¾è®¡çš„ä¸€ç§å‘å±•ï¼Œå®ƒå…·æœ‰åˆ†ç¦»çš„è®¡ç®—å’Œæ•°æ®å­˜å‚¨å±‚ã€‚åœ¨è¿™ç§ä½“ç³»ç»“æ„ä¸­ï¼Œåº”ç”¨ç¨‹åºä»è¿œç¨‹äº‹åŠ¡æ•°æ®åº“è¯»å–æ•°æ®å¹¶å°†å…¶æŒä¹…åŒ–ã€‚</li><li>ç›¸åï¼Œ<code>äº‹ä»¶é©±åŠ¨åº”ç”¨ç¨‹åº</code>åŸºäºæœ‰çŠ¶æ€æµå¤„ç†åº”ç”¨ç¨‹åºã€‚åœ¨è¿™ä¸ªè®¾è®¡ä¸­ï¼Œæ•°æ®å’Œè®¡ç®—è¢«æ”¾åœ¨åŒä¸€ä¸ªä½ç½®ï¼Œä»è€Œäº§ç”Ÿæœ¬åœ°ï¼ˆå†…å­˜æˆ–ç£ç›˜ï¼‰æ•°æ®è®¿é—®ã€‚å®¹é”™æ˜¯é€šè¿‡å®šæœŸå°†æ£€æŸ¥ç‚¹å†™å…¥è¿œç¨‹æŒä¹…å­˜å‚¨æ¥å®ç°çš„ã€‚ä¸‹å›¾æè¿°äº†ä¼ ç»Ÿåº”ç”¨ç¨‹åºä½“ç³»ç»“æ„ä¸äº‹ä»¶é©±åŠ¨åº”ç”¨ç¨‹åºä¹‹é—´çš„åŒºåˆ«ã€‚</li></ul></blockquote><p><img src="https://file.buildworld.cn/img/20200911125128.png"></p><p><strong>kafkaä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—å°±æ˜¯ä¸€ç§å…¸å‹çš„äº‹ä»¶é©±åŠ¨å‹åº”ç”¨ã€‚</strong></p><h4 id="2ï¼‰-æµã€æ‰¹ï¼ˆstreamï¼Œmicro-batchingï¼‰"><a href="#2ï¼‰-æµã€æ‰¹ï¼ˆstreamï¼Œmicro-batchingï¼‰" class="headerlink" title="2ï¼‰ æµã€æ‰¹ï¼ˆstreamï¼Œmicro-batchingï¼‰"></a>2ï¼‰ æµã€æ‰¹ï¼ˆstreamï¼Œmicro-batchingï¼‰</h4><blockquote><p><code>Spark</code>ä¸­ï¼Œä¸€åˆ‡éƒ½æ˜¯æ‰¹æ¬¡ç»„æˆçš„ï¼Œç¦»çº¿æ•°æ®æ˜¯ä¸€ä¸ªå¤§æ‰¹æ¬¡ï¼Œå®æ—¶æ•°æ®æ˜¯ä¸€ä¸ªä¸ªæ— é™çš„å°æ‰¹æ¬¡ç»„æˆçš„ã€‚</p><p><code>Flink</code>ä¸­ï¼Œä¸€åˆ‡éƒ½æ˜¯ç”±æµç»„æˆçš„ï¼Œç¦»çº¿æ•°æ®æ˜¯æœ‰ç•Œé™çš„æµï¼Œå®æ—¶æ•°æ®æ˜¯ä¸€ä¸ªæ²¡æœ‰ç•Œé™çš„æµï¼Œè¿™å°±æ˜¯æ‰€è°“çš„æœ‰ç•Œæµå’Œæ— ç•Œæµã€‚</p></blockquote><h4 id="3ï¼‰åˆ†å±‚API"><a href="#3ï¼‰åˆ†å±‚API" class="headerlink" title="3ï¼‰åˆ†å±‚API"></a>3ï¼‰åˆ†å±‚API</h4><p><img src="https://file.buildworld.cn/img/20200911155213.png"></p><blockquote><p>è¶Šé¡¶å±‚è¶ŠæŠ½è±¡ï¼Œæœ€é«˜å±‚çº§çš„æŠ½è±¡æ˜¯SQLã€‚</p><p>è¶Šåº•å±‚è¶Šå…·ä½“</p></blockquote><h3 id="äºŒã€Flinkä½¿ç”¨ï¼ˆword-countï¼‰"><a href="#äºŒã€Flinkä½¿ç”¨ï¼ˆword-countï¼‰" class="headerlink" title="äºŒã€Flinkä½¿ç”¨ï¼ˆword countï¼‰"></a>äºŒã€Flinkä½¿ç”¨ï¼ˆword countï¼‰</h3><h4 id="1ã€è®¾ç½®pomæ–‡ä»¶"><a href="#1ã€è®¾ç½®pomæ–‡ä»¶" class="headerlink" title="1ã€è®¾ç½®pomæ–‡ä»¶"></a>1ã€è®¾ç½®pomæ–‡ä»¶</h4><blockquote><p>æ³¨æ„ä¸‹é¢çš„ä¾èµ–è®¾ç½®ï¼Œä½¿ç”¨çš„æ˜¯scala 2.12.xç‰ˆæœ¬ï¼ŒFlinkç‰ˆæœ¬ä¸º1.10.1</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.buildworld.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>FlinkTrain<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-scala_2.12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.10.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.flink/flink-streaming-scala --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-streaming-scala_2.12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.10.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- è¯¥æ’ä»¶ç”¨äºå°†Scalaä»£ç ç¼–è¯‘æˆclassæ–‡ä»¶ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.alchim31.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>scala-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- å£°æ˜ç»‘å®šåˆ°mavençš„compileé˜¶æ®µ --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="tag">&lt;/<span class="name">descriptorRef</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">id</span>&gt;</span>make-assembly<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>single<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2ã€ç¼–å†™scalaä»£ç "><a href="#2ã€ç¼–å†™scalaä»£ç " class="headerlink" title="2ã€ç¼–å†™scalaä»£ç "></a>2ã€ç¼–å†™scalaä»£ç </h4><h5 id="1ï¼‰æ‰¹å¤„ç†-wordcount"><a href="#1ï¼‰æ‰¹å¤„ç†-wordcount" class="headerlink" title="1ï¼‰æ‰¹å¤„ç† wordcount"></a>1ï¼‰æ‰¹å¤„ç† wordcount</h5><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.buildworld.flink</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.scala.&#123;<span class="type">DataSet</span>, <span class="type">ExecutionEnvironment</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.scala._</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰¹å¤„ç†çš„word count</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">WordCount</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºä¸€ä¸ªæ‰¹å¤„ç†çš„æ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    <span class="keyword">val</span> env: <span class="type">ExecutionEnvironment</span> = <span class="type">ExecutionEnvironment</span>.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</span></span><br><span class="line">    <span class="keyword">val</span> inputPath = <span class="string">&quot;D:\\Java\\project\\Scala\\FlinkTrain\\src\\main\\resources\\hello.txt&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> dataSet: <span class="type">DataSet</span>[<span class="type">String</span>] = env.readTextFile(inputPath)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹æ•°æ®è¿›è¡Œè½¬æ¢å¤„ç†ç»Ÿè®¡ï¼Œå…ˆåˆ†è¯ï¼Œå†æŒ‰ç…§wordè¿›è¡Œåˆ†ç»„ï¼Œæœ€åè¿›è¡Œèšåˆç»Ÿè®¡</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> resultDataSet: <span class="type">DataSet</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = dataSet</span><br><span class="line">      .flatMap(_.split(<span class="string">&quot; &quot;</span>))</span><br><span class="line">      .map((_, <span class="number">1</span>))</span><br><span class="line">      .groupBy(<span class="number">0</span>) <span class="comment">//ä»¥ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºkeyè¿›è¡Œåˆ†ç»„</span></span><br><span class="line">      .sum(<span class="number">1</span>) <span class="comment">//å¯¹æ‰€æœ‰æ•°æ®çš„ç¬¬äºŒä¸ªå…ƒç´ æ±‚å’Œ</span></span><br><span class="line"></span><br><span class="line">    resultDataSet.print()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2ï¼‰æµå¤„ç†wordcount"><a href="#2ï¼‰æµå¤„ç†wordcount" class="headerlink" title="2ï¼‰æµå¤„ç†wordcount"></a>2ï¼‰æµå¤„ç†wordcount</h5><p><strong>è¶…çº§ç®€å•ï¼Œæ¯”sparkstreamingçš„æµå¼å¤„ç†ç®€å•å¤šäº†ï¼ï¼ï¼</strong></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.scala._</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµå¤„ç†çš„word count</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">WordCountByStream</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºä¸€ä¸ªæ‰¹å¤„ç†çš„æ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    <span class="keyword">val</span> env: <span class="type">StreamExecutionEnvironment</span> = <span class="type">StreamExecutionEnvironment</span>.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®å¹¶è¡Œåº¦</span></span><br><span class="line">    env.setParallelism(<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä»ç«¯å£ä¸­è¯»å–æ•°æ®</span></span><br><span class="line">    <span class="keyword">val</span> dataSet: <span class="type">DataStream</span>[<span class="type">String</span>] = env.socketTextStream(<span class="string">&quot;192.168.162.102&quot;</span>, <span class="number">7777</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹æ•°æ®è¿›è¡Œè½¬æ¢å¤„ç†ç»Ÿè®¡ï¼Œå…ˆåˆ†è¯ï¼Œå†æŒ‰ç…§wordè¿›è¡Œåˆ†ç»„ï¼Œæœ€åè¿›è¡Œèšåˆç»Ÿè®¡</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> resultDataSet = dataSet</span><br><span class="line">      .flatMap(_.split(<span class="string">&quot; &quot;</span>))</span><br><span class="line">      .filter(_.nonEmpty)</span><br><span class="line">      .map((_, <span class="number">1</span>))</span><br><span class="line">      .keyBy(<span class="number">0</span>) <span class="comment">//ä»¥ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºkeyè¿›è¡Œåˆ†ç»„</span></span><br><span class="line">      .sum(<span class="number">1</span>) <span class="comment">//å¯¹æ‰€æœ‰æ•°æ®çš„ç¬¬äºŒä¸ªå…ƒç´ æ±‚å’Œ</span></span><br><span class="line"></span><br><span class="line">    resultDataSet.print()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯åŠ¨ä»»åŠ¡æ‰§è¡Œ</span></span><br><span class="line">    env.execute()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¡¥å……</strong></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.utils.<span class="type">ParameterTool</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯ä»¥å†²å¯åŠ¨å‚æ•°é‡Œé¢è¯»å–æŒ‡å®šçš„å‚æ•°</span></span><br><span class="line"><span class="keyword">val</span> parameterTool: <span class="type">ParameterTool</span> = <span class="type">ParameterTool</span>.fromArgs(args)</span><br><span class="line"><span class="keyword">val</span> host: <span class="type">String</span> = parameterTool.get(<span class="string">&quot;host&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> port: <span class="type">Int</span> = parameterTool.getInt(<span class="string">&quot;port&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="ä¸‰ã€Flink-è¿è¡Œæ¶æ„"><a href="#ä¸‰ã€Flink-è¿è¡Œæ¶æ„" class="headerlink" title="ä¸‰ã€Flink è¿è¡Œæ¶æ„"></a>ä¸‰ã€Flink è¿è¡Œæ¶æ„</h3><h4 id="1ã€Flinkè¿è¡Œæ—¶ç»„ä»¶"><a href="#1ã€Flinkè¿è¡Œæ—¶ç»„ä»¶" class="headerlink" title="1ã€Flinkè¿è¡Œæ—¶ç»„ä»¶"></a>1ã€Flinkè¿è¡Œæ—¶ç»„ä»¶</h4><p><img src="https://file.buildworld.cn/img/20200914200131.png"></p><blockquote><ul><li><p><strong>ä½œä¸šç®¡ç†å™¨ï¼ˆJobManagerï¼‰</strong><br>æ§åˆ¶ä¸€ä¸ªåº”ç”¨ç¨‹åºæ‰§è¡Œçš„ä¸»è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½ä¼šè¢«ä¸€ä¸ªä¸åŒçš„JobManager æ‰€æ§åˆ¶æ‰§è¡Œã€‚JobManager ä¼šå…ˆæ¥æ”¶åˆ°è¦æ‰§è¡Œçš„åº”ç”¨ç¨‹åºï¼Œè¿™ä¸ªåº”ç”¨ç¨‹åºä¼šåŒ…æ‹¬ï¼šä½œä¸šå›¾ï¼ˆJobGraphï¼‰ã€é€»è¾‘æ•°æ®æµå›¾ï¼ˆlogical dataflow graphï¼‰å’Œæ‰“åŒ…äº†æ‰€æœ‰çš„ç±»ã€åº“å’Œå…¶å®ƒèµ„æºçš„ JAR åŒ…ã€‚JobManager ä¼šæŠŠ JobGraph è½¬æ¢æˆä¸€ä¸ªç‰©ç†å±‚é¢çš„æ•°æ®æµå›¾ï¼Œè¿™ä¸ªå›¾è¢«å«åšâ€œæ‰§è¡Œå›¾â€ï¼ˆExecutionGraphï¼‰ï¼ŒåŒ…å«äº†æ‰€æœ‰å¯ä»¥å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡ã€‚JobManager ä¼šå‘èµ„æºç®¡ç†å™¨ï¼ˆResourceManagerï¼‰è¯·æ±‚æ‰§è¡Œä»»åŠ¡å¿…è¦çš„èµ„æºï¼Œä¹Ÿå°±æ˜¯ä»»åŠ¡ç®¡ç†å™¨ï¼ˆTaskManagerï¼‰ä¸Šçš„æ’æ§½ï¼ˆslotï¼‰ã€‚ä¸€æ—¦å®ƒè·å–åˆ°äº†è¶³å¤Ÿçš„èµ„æºï¼Œå°±ä¼šå°†æ‰§è¡Œå›¾åˆ†å‘åˆ°çœŸæ­£è¿è¡Œå®ƒä»¬çš„<br>TaskManager ä¸Šã€‚è€Œåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒJobManager ä¼šè´Ÿè´£æ‰€æœ‰éœ€è¦ä¸­å¤®åè°ƒçš„æ“ä½œï¼Œæ¯”å¦‚è¯´æ£€æŸ¥ç‚¹ï¼ˆcheckpointsï¼‰çš„åè°ƒã€‚</p></li><li><p><strong>èµ„æºç®¡ç†å™¨ï¼ˆResourceManagerï¼‰</strong><br>ä¸»è¦è´Ÿè´£ç®¡ç†ä»»åŠ¡ç®¡ç†å™¨ï¼ˆTaskManagerï¼‰çš„æ’æ§½ï¼ˆslotï¼‰ï¼ŒTaskManger æ’æ§½æ˜¯ Flink ä¸­<br>å®šä¹‰çš„å¤„ç†èµ„æºå•å…ƒã€‚Flink ä¸ºä¸åŒçš„ç¯å¢ƒå’Œèµ„æºç®¡ç†å·¥å…·æä¾›äº†ä¸åŒèµ„æºç®¡ç†å™¨ï¼Œæ¯”å¦‚<br>YARNã€Mesosã€K8sï¼Œä»¥åŠ standalone éƒ¨ç½²ã€‚å½“ JobManager ç”³è¯·æ’æ§½èµ„æºæ—¶ï¼ŒResourceManagerä¼šå°†æœ‰ç©ºé—²æ’æ§½çš„ TaskManager åˆ†é…ç»™ JobManagerã€‚å¦‚æœ ResourceManager æ²¡æœ‰è¶³å¤Ÿçš„æ’æ§½æ¥æ»¡è¶³ JobManager çš„è¯·æ±‚ï¼Œå®ƒè¿˜å¯ä»¥å‘èµ„æºæä¾›å¹³å°å‘èµ·ä¼šè¯ï¼Œä»¥æä¾›å¯åŠ¨ TaskManagerè¿›ç¨‹çš„å®¹å™¨ã€‚å¦å¤–ï¼ŒResourceManager è¿˜è´Ÿè´£ç»ˆæ­¢ç©ºé—²çš„ TaskManagerï¼Œé‡Šæ”¾è®¡ç®—èµ„æºã€‚</p></li><li><p><strong>ä»»åŠ¡ç®¡ç†å™¨ï¼ˆTaskManagerï¼‰</strong></p><p>Flink ä¸­çš„å·¥ä½œè¿›ç¨‹ã€‚é€šå¸¸åœ¨ Flink ä¸­ä¼šæœ‰å¤šä¸ª TaskManager è¿è¡Œï¼Œæ¯ä¸€ä¸ª TaskManageréƒ½åŒ…å«äº†ä¸€å®šæ•°é‡çš„æ’æ§½ï¼ˆslotsï¼‰ã€‚æ’æ§½çš„æ•°é‡é™åˆ¶äº† TaskManager èƒ½å¤Ÿæ‰§è¡Œçš„ä»»åŠ¡æ•°é‡ã€‚<br>å¯åŠ¨ä¹‹åï¼ŒTaskManager ä¼šå‘èµ„æºç®¡ç†å™¨æ³¨å†Œå®ƒçš„æ’æ§½ï¼›æ”¶åˆ°èµ„æºç®¡ç†å™¨çš„æŒ‡ä»¤åï¼ŒTaskManager å°±ä¼šå°†ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ’æ§½æä¾›ç»™ JobManager è°ƒç”¨ã€‚JobManager å°±å¯ä»¥å‘æ’æ§½åˆ†é…ä»»åŠ¡ï¼ˆtasksï¼‰æ¥æ‰§è¡Œäº†ã€‚åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ª TaskManager å¯ä»¥è·Ÿå…¶å®ƒè¿è¡ŒåŒä¸€åº”ç”¨ç¨‹<br>åºçš„ TaskManager äº¤æ¢æ•°æ®ã€‚</p></li><li><p><strong>åˆ†å‘å™¨ï¼ˆDispatcherï¼‰</strong></p><p>å¯ä»¥è·¨ä½œä¸šè¿è¡Œï¼Œå®ƒä¸ºåº”ç”¨æäº¤æä¾›äº† REST æ¥å£ã€‚å½“ä¸€ä¸ªåº”ç”¨è¢«æäº¤æ‰§è¡Œæ—¶ï¼Œåˆ†å‘å™¨<br>å°±ä¼šå¯åŠ¨å¹¶å°†åº”ç”¨ç§»äº¤ç»™ä¸€ä¸ª JobManagerã€‚ç”±äºæ˜¯ REST æ¥å£ï¼Œæ‰€ä»¥ Dispatcher å¯ä»¥ä½œä¸ºé›†<br>ç¾¤çš„ä¸€ä¸ª HTTP æ¥å…¥ç‚¹ï¼Œè¿™æ ·å°±èƒ½å¤Ÿä¸å—é˜²ç«å¢™é˜»æŒ¡ã€‚Dispatcher ä¹Ÿä¼šå¯åŠ¨ä¸€ä¸ª Web UIï¼Œç”¨<br>æ¥æ–¹ä¾¿åœ°å±•ç¤ºå’Œç›‘æ§ä½œä¸šæ‰§è¡Œçš„ä¿¡æ¯ã€‚Dispatcher åœ¨æ¶æ„ä¸­å¯èƒ½å¹¶ä¸æ˜¯å¿…éœ€çš„ï¼Œè¿™å–å†³äºåº”<br>ç”¨æäº¤è¿è¡Œçš„æ–¹å¼ã€‚</p></li></ul></blockquote><h4 id="2ã€ä»»åŠ¡æäº¤æµç¨‹"><a href="#2ã€ä»»åŠ¡æäº¤æµç¨‹" class="headerlink" title="2ã€ä»»åŠ¡æäº¤æµç¨‹"></a>2ã€ä»»åŠ¡æäº¤æµç¨‹</h4><p><img src="https://file.buildworld.cn/img/20200914205020.png"></p><h4 id="3ã€ä»»åŠ¡è°ƒåº¦åŸç†"><a href="#3ã€ä»»åŠ¡è°ƒåº¦åŸç†" class="headerlink" title="3ã€ä»»åŠ¡è°ƒåº¦åŸç†"></a>3ã€ä»»åŠ¡è°ƒåº¦åŸç†</h4><p>Task Slot  æ˜¯é™æ€çš„æ¦‚å¿µï¼Œæ˜¯æŒ‡ TaskManager  å…·æœ‰çš„å¹¶å‘æ‰§è¡Œèƒ½åŠ›ï¼Œå¯ä»¥é€šè¿‡å‚æ•° taskmanager.numberOfTaskSlots è¿›è¡Œé…ç½®ï¼›è€Œ å¹¶è¡Œåº¦ parallelism  æ˜¯åŠ¨æ€æ¦‚å¿µ ï¼Œå³ å³ TaskManager  è¿è¡Œç¨‹åºæ—¶å®é™…ä½¿ç”¨çš„å¹¶å‘èƒ½åŠ›ï¼Œå¯ä»¥é€šè¿‡å‚æ•° parallelism.defaultè¿›è¡Œé…ç½®ã€‚</p><h3 id="å››ã€Flinkæµå¤„ç†API"><a href="#å››ã€Flinkæµå¤„ç†API" class="headerlink" title="å››ã€Flinkæµå¤„ç†API"></a>å››ã€Flinkæµå¤„ç†API</h3><h4 id="1ã€ä¸‰ç§ä¸åŒæ–¹å¼è¯»å–æ•°æ®"><a href="#1ã€ä¸‰ç§ä¸åŒæ–¹å¼è¯»å–æ•°æ®" class="headerlink" title="1ã€ä¸‰ç§ä¸åŒæ–¹å¼è¯»å–æ•°æ®"></a>1ã€ä¸‰ç§ä¸åŒæ–¹å¼è¯»å–æ•°æ®</h4><p>bin/kafka-topics.sh  â€“zookeeper localhost:2181 â€“list</p><p>bin/kafka-topics.sh  â€“zookeeper localhost:2181 â€“create â€“replication-factor 3 â€“partitions 1 â€“topic sensor</p><p>bin/kafka-console-producer.sh â€“broker-list 10.81.1.56:9092 â€“topic sensor</p><p>bin/kafka-console-consumer.sh â€“bootstrap-server localhost:9092 â€“from-beginning â€“topic sensor</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sensor_1, 1547718199, 35.8</span><br></pre></td></tr></table></figure><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.<span class="type">Properties</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.serialization.<span class="type">SimpleStringSchema</span></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.scala._</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.connectors.kafka.<span class="type">FlinkKafkaConsumer011</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰æ ·ä¾‹ç±»ï¼Œæ¸©åº¦ä¼ æ„Ÿå™¨</span></span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">SensorReading</span>(<span class="params">id: <span class="type">String</span>, timestamp: <span class="type">Long</span>, temperature: <span class="type">Double</span></span>)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">SourceTest</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    <span class="keyword">val</span> env: <span class="type">StreamExecutionEnvironment</span> = <span class="type">StreamExecutionEnvironment</span>.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line"><span class="comment">//    //1ã€ä»é›†åˆä¸­è¯»å–æ•°æ®</span></span><br><span class="line"><span class="comment">//    val data = List(</span></span><br><span class="line"><span class="comment">//      SensorReading(&quot;sensor_1&quot;, 1547718199, 35.8),</span></span><br><span class="line"><span class="comment">//      SensorReading(&quot;sensor_6&quot;, 1547718201, 15.4),</span></span><br><span class="line"><span class="comment">//      SensorReading(&quot;sensor_7&quot;, 1547718202, 6.7),</span></span><br><span class="line"><span class="comment">//      SensorReading(&quot;sensor_10&quot;, 1547718205, 38.1)</span></span><br><span class="line"><span class="comment">//    )</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    val stream1: DataStream[SensorReading] = env.fromCollection(data)</span></span><br><span class="line"><span class="comment">//    stream1.print()</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    //2ã€ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</span></span><br><span class="line"><span class="comment">//    val stream2 = env.readTextFile(&quot;YOUR_FILE_PATH&quot;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//3ã€ä»kafkaä¸­è¯»å–æ•°æ®</span></span><br><span class="line">    <span class="keyword">val</span> properties = <span class="keyword">new</span> <span class="type">Properties</span>()</span><br><span class="line">    properties.setProperty(<span class="string">&quot;bootstrap.servers&quot;</span>, <span class="string">&quot;localhost:9092&quot;</span>)</span><br><span class="line">    properties.setProperty(<span class="string">&quot;group.id&quot;</span>, <span class="string">&quot;consumer-group&quot;</span>)</span><br><span class="line">    properties.setProperty(<span class="string">&quot;auto.offset.reset&quot;</span>, <span class="string">&quot;latest&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> stream3: <span class="type">DataStream</span>[<span class="type">String</span>] = env.addSource(<span class="keyword">new</span> <span class="type">FlinkKafkaConsumer011</span>[<span class="type">String</span>](<span class="string">&quot;sensor&quot;</span>, <span class="keyword">new</span> <span class="type">SimpleStringSchema</span>(), properties))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> value: <span class="type">DataStream</span>[<span class="type">String</span>] = stream3.flatMap(_.split(<span class="string">&quot;,&quot;</span>)).filter(_.nonEmpty)</span><br><span class="line"></span><br><span class="line">    value.print()</span><br><span class="line">    <span class="comment">//æ‰§è¡Œ</span></span><br><span class="line">    env.execute()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2ã€è‡ªå®šä¹‰-Source"><a href="#2ã€è‡ªå®šä¹‰-Source" class="headerlink" title="2ã€è‡ªå®šä¹‰ Source"></a>2ã€è‡ªå®šä¹‰ Source</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySensorSource</span> <span class="keyword">extends</span> <span class="title">SourceFunction</span>[<span class="type">SensorReading</span>] </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// flag: è¡¨ç¤ºæ•°æ®æºæ˜¯å¦è¿˜åœ¨æ­£å¸¸è¿è¡Œ</span></span><br><span class="line">  <span class="keyword">var</span> running: <span class="type">Boolean</span> = <span class="literal">true</span></span><br><span class="line">  <span class="keyword">var</span> num = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">run</span></span>(sourceContext: <span class="type">SourceFunction</span>.<span class="type">SourceContext</span>[<span class="type">SensorReading</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">//å®šä¹‰ä¸€ä¸ªéšæœºæ•°å‘ç”Ÿå™¨</span></span><br><span class="line">    <span class="keyword">val</span> rand = <span class="keyword">new</span> <span class="type">Random</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment">//éšæœºç”Ÿæˆä¸€ç»„ä¼ æ„Ÿå™¨çš„åˆå§‹æ¸©åº¦</span></span><br><span class="line">    <span class="keyword">var</span> curTemp = <span class="number">1.</span>to(<span class="number">10</span>).map(</span><br><span class="line">      i =&gt; (<span class="string">&quot;sensor_&quot;</span> + i, <span class="number">65</span> + rand.nextGaussian() * <span class="number">20</span>)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (running) &#123;</span><br><span class="line">      <span class="comment">//æ›´æ–°æ¸©åº¦å€¼</span></span><br><span class="line">      curTemp = curTemp.map(</span><br><span class="line">        t =&gt; (t._1, t._2 + rand.nextGaussian())</span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">      <span class="comment">//è·å–å½“å‰çš„æ—¶é—´æˆ³</span></span><br><span class="line">      <span class="keyword">val</span> curTime: <span class="type">Long</span> = <span class="type">System</span>.currentTimeMillis()</span><br><span class="line"></span><br><span class="line">      curTemp.foreach(</span><br><span class="line">        t =&gt; sourceContext.collect(<span class="type">SensorReading</span>(t._1, curTime, t._2))</span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">      num+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (num == <span class="number">5</span>)&#123;</span><br><span class="line">        cancel()</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="type">Thread</span>.sleep(<span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">cancel</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    running = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨è‡ªå®šä¹‰Source"><a href="#ä½¿ç”¨è‡ªå®šä¹‰Source" class="headerlink" title="ä½¿ç”¨è‡ªå®šä¹‰Source"></a>ä½¿ç”¨è‡ªå®šä¹‰Source</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> stream4: <span class="type">DataStream</span>[<span class="type">SensorReading</span>] = env.addSource(<span class="keyword">new</span> <span class="type">MySensorSource</span>())</span><br><span class="line">stream4.print()</span><br></pre></td></tr></table></figure><h4 id="3ã€Transformè½¬æ¢ç®—å­"><a href="#3ã€Transformè½¬æ¢ç®—å­" class="headerlink" title="3ã€Transformè½¬æ¢ç®—å­"></a>3ã€Transformè½¬æ¢ç®—å­</h4><h5 id="map"><a href="#map" class="headerlink" title="map"></a>map</h5><h5 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap"></a>flatMap</h5><h5 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h5><h5 id="KeyBy"><a href="#KeyBy" class="headerlink" title="KeyBy"></a>KeyBy</h5><h5 id="æ»šåŠ¨èšåˆç®—å­ï¼ˆRolling-Aggregationï¼‰"><a href="#æ»šåŠ¨èšåˆç®—å­ï¼ˆRolling-Aggregationï¼‰" class="headerlink" title="æ»šåŠ¨èšåˆç®—å­ï¼ˆRolling Aggregationï¼‰"></a>æ»šåŠ¨èšåˆç®—å­ï¼ˆRolling Aggregationï¼‰</h5><blockquote><p>è¿™äº›ç®—å­å¯ä»¥é’ˆå¯¹ KeyedStream çš„æ¯ä¸€ä¸ªæ”¯æµåšèšåˆã€‚</p><p>sum()<br>min()<br>max()<br>minBy()<br>maxBy()</p></blockquote><h5 id="Reduce"><a href="#Reduce" class="headerlink" title="Reduce"></a>Reduce</h5><blockquote><p><code>KeyedStream</code> â†’ â†’ <code>DataStream</code>ï¼šä¸€ä¸ªåˆ†ç»„æ•°æ®æµçš„èšåˆæ“ä½œï¼Œåˆå¹¶å½“å‰çš„å…ƒç´ å’Œä¸Šæ¬¡èšåˆçš„ç»“æœï¼Œäº§ç”Ÿä¸€ä¸ªæ–°çš„å€¼ï¼Œè¿”å›çš„æµä¸­åŒ…å«æ¯ä¸€æ¬¡èšåˆçš„ç»“æœï¼Œè€Œä¸æ˜¯åªè¿”å›æœ€åä¸€æ¬¡èšåˆçš„æœ€ç»ˆç»“æœã€‚</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> resultStream = dataStream</span><br><span class="line">  .keyBy(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">  .reduce((curState, newData) =&gt;</span><br><span class="line">    <span class="type">SensorReading</span>(curState.id, newData.timestamp, curState.temperature.min(newData.temperature))</span><br><span class="line">  )</span><br></pre></td></tr></table></figure><h5 id="Split-å’Œ-å’Œ-Select"><a href="#Split-å’Œ-å’Œ-Select" class="headerlink" title="Split å’Œ å’Œ Select"></a>Split å’Œ å’Œ Select</h5><p><img src="https://file.buildworld.cn/img/20201011165829.png" alt="DataStream â†’ â†’ SplitStreamï¼šæ ¹æ®æŸäº›ç‰¹å¾æŠŠä¸€ä¸ª DataStream æ‹†åˆ†æˆä¸¤ä¸ªæˆ–è€…å¤šä¸ª DataStreamã€‚"></p><p><img src="https://file.buildworld.cn/img/20201011165909.png" alt="SplitStream â†’DataStreamï¼šä»ä¸€ä¸ª SplitStream ä¸­è·å–ä¸€ä¸ªæˆ–è€…å¤šä¸ªDataStreamã€‚"></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">SensorReading</span>(<span class="params">id: <span class="type">String</span>, timestamp: <span class="type">Long</span>, temperature: <span class="type">Double</span></span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> resultStream = dataStream</span><br><span class="line">  .keyBy(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">  .reduce((curState, newData) =&gt;</span><br><span class="line">    <span class="type">SensorReading</span>(curState.id, newData.timestamp, curState.temperature.min(newData.temperature))</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°æ®è¿‡æ»¤ï¼ŒæŒ‰ç…§æŒ‡å®šæ¡ä»¶å°†æ•°æ®åˆ†å¼€æ¥</span></span><br><span class="line"><span class="keyword">val</span> splitStream = resultStream.split(data =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (data.temperature &gt; <span class="number">30</span>)</span><br><span class="line">    <span class="type">Seq</span>(<span class="string">&quot;high&quot;</span>)</span><br><span class="line">  <span class="keyword">else</span> <span class="type">Seq</span>(<span class="string">&quot;low&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> high = splitStream.select(<span class="string">&quot;high&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> low = splitStream.select(<span class="string">&quot;low&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> all = splitStream.select(<span class="string">&quot;high&quot;</span>, <span class="string">&quot;low&quot;</span>)</span><br></pre></td></tr></table></figure><h5 id="Connectå’ŒCoMap"><a href="#Connectå’ŒCoMap" class="headerlink" title="Connectå’ŒCoMap"></a>Connectå’ŒCoMap</h5><p><img src="https://file.buildworld.cn/img/20201012100125.png"></p><p><img src="https://file.buildworld.cn/img/20201012100146.png"></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> warning: <span class="type">DataStream</span>[(<span class="type">String</span>, <span class="type">Double</span>)] = high.map(sensorData =&gt; (sensorData.id, sensorData.temperature))</span><br><span class="line"></span><br><span class="line"><span class="comment">// DataStream,DataStream â†’ â†’ ConnectedStreamsï¼šè¿æ¥ä¸¤ä¸ªä¿æŒä»–ä»¬ç±»å‹çš„æ•°æ®æµï¼Œä¸¤ä¸ªæ•°æ®æµè¢« Connect ä¹‹åï¼Œåªæ˜¯è¢«æ”¾åœ¨äº†ä¸€ä¸ªåŒä¸€ä¸ªæµä¸­ï¼Œå†…éƒ¨ä¾ç„¶ä¿æŒå„è‡ªçš„æ•°æ®å’Œå½¢å¼ä¸å‘ç”Ÿä»»ä½•å˜åŒ–ï¼Œä¸¤ä¸ªæµç›¸äº’ç‹¬ç«‹ã€‚</span></span><br><span class="line"><span class="keyword">val</span> connected: <span class="type">ConnectedStreams</span>[(<span class="type">String</span>, <span class="type">Double</span>), <span class="type">SensorReading</span>] = warning.connect(low)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ConnectedStreams â†’ DataStreamï¼šä½œç”¨äº ConnectedStreams ä¸Šï¼ŒåŠŸèƒ½ä¸ mapå’Œ flatMap ä¸€æ ·ï¼Œå¯¹ ConnectedStreams ä¸­çš„æ¯ä¸€ä¸ª Stream åˆ†åˆ«è¿›è¡Œ map å’Œ flatMapå¤„ç†ã€‚</span></span><br><span class="line"><span class="keyword">val</span> coMap: <span class="type">DataStream</span>[<span class="type">Product</span>] = connected.map(</span><br><span class="line">  warningData =&gt; (warningData._1, warningData._2, <span class="string">&quot;WARNING&quot;</span>),</span><br><span class="line">  lowData =&gt; (lowData.id, lowData.temperature, <span class="string">&quot;SAFE&quot;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">coMap.print()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°ç»“æœ</span></span><br><span class="line"><span class="number">10</span>&gt; (sensor_7,<span class="number">6.7</span>,<span class="type">SAFE</span>)</span><br><span class="line"><span class="number">8</span>&gt; (sensor_6,<span class="number">15.4</span>,<span class="type">SAFE</span>)</span><br><span class="line"><span class="number">6</span>&gt; (sensor_10,<span class="number">38.1</span>,<span class="type">WARNING</span>)</span><br><span class="line"><span class="number">7</span>&gt; (sensor_1,<span class="number">30.8</span>,<span class="type">WARNING</span>)</span><br><span class="line"><span class="number">7</span>&gt; (sensor_1,<span class="number">30.8</span>,<span class="type">WARNING</span>)</span><br><span class="line"><span class="number">7</span>&gt; (sensor_1,<span class="number">30.8</span>,<span class="type">WARNING</span>)</span><br><span class="line"><span class="number">7</span>&gt; (sensor_1,<span class="number">30.8</span>,<span class="type">WARNING</span>)</span><br><span class="line"><span class="number">7</span>&gt; (sensor_1,<span class="number">30.8</span>,<span class="type">WARNING</span>)</span><br><span class="line"><span class="number">7</span>&gt; (sensor_1,<span class="number">30.8</span>,<span class="type">WARNING</span>)</span><br></pre></td></tr></table></figure><h5 id="Union"><a href="#Union" class="headerlink" title="Union"></a>Union</h5><p><img src="https://file.buildworld.cn/img/20201012101514.png"></p><blockquote><ul><li>Union ä¹‹å‰ä¸¤ä¸ªæµçš„ç±»å‹å¿…é¡»æ˜¯ä¸€æ ·ï¼ŒConnect å¯ä»¥ä¸ä¸€æ ·ï¼Œåœ¨ä¹‹åçš„ coMapä¸­å†å»è°ƒæ•´æˆä¸ºä¸€æ ·çš„ã€‚</li><li>Connect åªèƒ½æ“ä½œä¸¤ä¸ªæµï¼ŒUnion å¯ä»¥æ“ä½œå¤šä¸ªã€‚</li></ul></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> unionStream: <span class="type">DataStream</span>[<span class="type">SensorReading</span>] = high.union(low)</span><br><span class="line">unionStream.print(<span class="string">&quot;union:::&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="4ã€æ”¯æŒçš„æ•°æ®ç±»å‹"><a href="#4ã€æ”¯æŒçš„æ•°æ®ç±»å‹" class="headerlink" title="4ã€æ”¯æŒçš„æ•°æ®ç±»å‹"></a>4ã€æ”¯æŒçš„æ•°æ®ç±»å‹</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> env = <span class="type">StreamExecutionEnvironment</span>.getExecutionEnvironment</span><br><span class="line">env.setParallelism(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//åŸºæœ¬æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="keyword">val</span> numbers: <span class="type">DataStream</span>[<span class="type">Long</span>] = env.fromElements(<span class="number">1</span>L, <span class="number">2</span>L, <span class="number">3</span>L, <span class="number">4</span>L)</span><br><span class="line"><span class="keyword">val</span> res: <span class="type">DataStream</span>[<span class="type">Long</span>] = numbers.map(n =&gt; n + <span class="number">1</span>)</span><br><span class="line">res.print(<span class="string">&quot;ç›¸åŠ ï¼š&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ƒç»„</span></span><br><span class="line"><span class="keyword">val</span> persons1: <span class="type">DataStream</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = env.fromElements(</span><br><span class="line">  (<span class="string">&quot;michong&quot;</span>, <span class="number">25</span>),</span><br><span class="line">  (<span class="string">&quot;lili&quot;</span>, <span class="number">15</span>)</span><br><span class="line">)</span><br><span class="line"><span class="comment">//å…ƒç»„æ•°æ®è¿‡æ»¤</span></span><br><span class="line"><span class="keyword">val</span> res1: <span class="type">DataStream</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = persons1.filter(p =&gt; p._2 &gt; <span class="number">18</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Scalaæ ·ä¾‹ç±»</span></span><br><span class="line"><span class="keyword">val</span> persons2: <span class="type">DataStream</span>[<span class="type">Person</span>] = env.fromElements(</span><br><span class="line">  <span class="type">Person</span>(<span class="string">&quot;MiChong&quot;</span>, <span class="number">25</span>),</span><br><span class="line">  <span class="type">Person</span>(<span class="string">&quot;Lili&quot;</span>, <span class="number">15</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> res2: <span class="type">DataStream</span>[<span class="type">Person</span>] = persons2.filter(</span><br><span class="line">  p =&gt; p.age &gt; <span class="number">18</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">res2.print(<span class="string">&quot;æˆå¹´äººï¼š &quot;</span>)</span><br><span class="line">env.execute()</span><br></pre></td></tr></table></figure><h4 id="5ã€å®ç°-UDF-å‡½æ•°â€”â€”æ›´ç»†ç²’åº¦çš„æ§åˆ¶æµ"><a href="#5ã€å®ç°-UDF-å‡½æ•°â€”â€”æ›´ç»†ç²’åº¦çš„æ§åˆ¶æµ" class="headerlink" title="5ã€å®ç° UDF å‡½æ•°â€”â€”æ›´ç»†ç²’åº¦çš„æ§åˆ¶æµ"></a>5ã€å®ç° UDF å‡½æ•°â€”â€”æ›´ç»†ç²’åº¦çš„æ§åˆ¶æµ</h4><h6 id="å‡½æ•°ç±»ï¼ˆFunction-Classesï¼‰"><a href="#å‡½æ•°ç±»ï¼ˆFunction-Classesï¼‰" class="headerlink" title="å‡½æ•°ç±»ï¼ˆFunction Classesï¼‰"></a>å‡½æ•°ç±»ï¼ˆFunction Classesï¼‰</h6><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> res2: <span class="type">DataStream</span>[<span class="type">Person</span>] = persons2.filter(<span class="keyword">new</span> <span class="type">MyFilter</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyFilter</span> <span class="keyword">extends</span> <span class="title">FilterFunction</span>[<span class="type">Person</span>] </span>&#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">filter</span></span>(p: <span class="type">Person</span>): <span class="type">Boolean</span> = &#123;</span><br><span class="line">    p.age &gt; <span class="number">18</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="å¯Œå‡½æ•°ï¼ˆRich-Functionsï¼‰"><a href="#å¯Œå‡½æ•°ï¼ˆRich-Functionsï¼‰" class="headerlink" title="å¯Œå‡½æ•°ï¼ˆRich Functionsï¼‰"></a>å¯Œå‡½æ•°ï¼ˆRich Functionsï¼‰</h6><blockquote><p>â€œå¯Œå‡½æ•°â€æ˜¯ DataStream API æä¾›çš„ä¸€ä¸ªå‡½æ•°ç±»çš„æ¥å£ï¼Œæ‰€æœ‰ Flink å‡½æ•°ç±»éƒ½æœ‰å…¶ Rich ç‰ˆæœ¬ã€‚å®ƒä¸å¸¸è§„å‡½æ•°çš„ä¸åŒåœ¨äºï¼Œå¯ä»¥è·å–è¿è¡Œç¯å¢ƒçš„ä¸Šä¸‹æ–‡ï¼Œå¹¶æ‹¥æœ‰ä¸€äº›ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥å®ç°æ›´å¤æ‚çš„åŠŸèƒ½ã€‚</p><p><strong>ç”Ÿå‘½å‘¨æœŸ</strong></p><ul><li><code>open()</code>æ–¹æ³•æ˜¯ rich function çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œå½“ä¸€ä¸ªç®—å­ä¾‹å¦‚ map æˆ–è€… filterè¢«è°ƒç”¨ä¹‹å‰ open()ä¼šè¢«è°ƒç”¨ã€‚</li><li><code>close()</code>æ–¹æ³•æ˜¯ç”Ÿå‘½å‘¨æœŸä¸­çš„æœ€åä¸€ä¸ªè°ƒç”¨çš„æ–¹æ³•ï¼Œåšä¸€äº›æ¸…ç†å·¥ä½œã€‚</li><li><code>getRuntimeContext()</code>æ–¹æ³•æä¾›äº†å‡½æ•°çš„ RuntimeContext çš„ä¸€äº›ä¿¡æ¯ï¼Œä¾‹å¦‚å‡½æ•°æ‰§è¡Œçš„å¹¶è¡Œåº¦ï¼Œä»»åŠ¡çš„åå­—ï¼Œä»¥åŠ state çŠ¶æ€</li></ul></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyFlatMap</span> <span class="keyword">extends</span> <span class="title">RichFlatMapFunction</span>[<span class="type">Int</span>, (<span class="type">Int</span>, <span class="type">Int</span>)] </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> subTaskIndex = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">open</span></span>(parameters: <span class="type">Configuration</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    subTaskIndex = getRuntimeContext.getIndexOfThisSubtask</span><br><span class="line">    <span class="comment">//åšä¸€äº›åˆå§‹åŒ–å·¥ä½œï¼Œå»ºç«‹HDFSçš„è¿æ¥</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">flatMap</span></span>(in: <span class="type">Int</span>, collector: <span class="type">Collector</span>[(<span class="type">Int</span>, <span class="type">Int</span>)]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">if</span> (in % <span class="number">2</span> == subTaskIndex) &#123;</span><br><span class="line">      collector.collect((subTaskIndex, in))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">close</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// ä»¥ä¸‹åšä¸€äº›æ¸…ç†å·¥ä½œï¼Œæ–­å¼€HDFSçš„è¿æ¥</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6ã€Sink"><a href="#6ã€Sink" class="headerlink" title="6ã€Sink"></a>6ã€Sink</h4><blockquote><p>Flinkçš„å¯¹å¤–è¾“å‡ºæ“ä½œ</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.<span class="type">Properties</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.serialization.<span class="type">SimpleStringSchema</span></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.scala._</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.connectors.kafka.&#123;<span class="type">FlinkKafkaConsumer011</span>, <span class="type">FlinkKafkaProducer011</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰æ ·ä¾‹ç±»ï¼Œæ¸©åº¦ä¼ æ„Ÿå™¨</span></span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">SensorReading</span>(<span class="params">id: <span class="type">String</span>, timestamp: <span class="type">Long</span>, temperature: <span class="type">Double</span></span>)</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">SourceTest</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    <span class="keyword">val</span> env: <span class="type">StreamExecutionEnvironment</span> = <span class="type">StreamExecutionEnvironment</span>.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3ã€ä»kafkaä¸­è¯»å–æ•°æ®</span></span><br><span class="line">    <span class="keyword">val</span> properties = <span class="keyword">new</span> <span class="type">Properties</span>()</span><br><span class="line">    properties.setProperty(<span class="string">&quot;bootstrap.servers&quot;</span>, <span class="string">&quot;10.12.42.174:9092&quot;</span>)</span><br><span class="line">    properties.setProperty(<span class="string">&quot;group.id&quot;</span>, <span class="string">&quot;consumer-group&quot;</span>)</span><br><span class="line">    <span class="comment">//    properties.setProperty(&quot;auto.offset.reset&quot;, &quot;latest&quot;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> stream3: <span class="type">DataStream</span>[<span class="type">String</span>] = env.addSource(<span class="keyword">new</span> <span class="type">FlinkKafkaConsumer011</span>[<span class="type">String</span>](<span class="string">&quot;sensor&quot;</span>, <span class="keyword">new</span> <span class="type">SimpleStringSchema</span>(), properties))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†ä»kafkaè·å–çš„æ•°æ®å¤„ç†</span></span><br><span class="line">    <span class="keyword">val</span> outputStream: <span class="type">DataStream</span>[<span class="type">String</span>] = stream3.map(</span><br><span class="line">      data =&gt; &#123;</span><br><span class="line">        <span class="keyword">var</span> arr = data.split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">        <span class="type">SensorReading</span>(arr(<span class="number">0</span>), arr(<span class="number">1</span>).toLong, arr(<span class="number">2</span>).toDouble).toString</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†å¤„å¤„ä¹‹åçš„æ•°æ®é‡æ–°å‘é€åˆ°kafkaä¸­</span></span><br><span class="line">    outputStream.addSink(<span class="keyword">new</span> <span class="type">FlinkKafkaProducer011</span>[<span class="type">String</span>](<span class="string">&quot;10.12.42.174:9092&quot;</span>, <span class="string">&quot;sensor_res&quot;</span>, <span class="keyword">new</span> <span class="type">SimpleStringSchema</span>()))</span><br><span class="line">    outputStream.print()</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ‰§è¡Œ</span></span><br><span class="line">    env.execute()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-connector-kafka-0.11_2.12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.10.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h6 id="JDBCè‡ªå®šä¹‰sink"><a href="#JDBCè‡ªå®šä¹‰sink" class="headerlink" title="JDBCè‡ªå®šä¹‰sink"></a>JDBCè‡ªå®šä¹‰sink</h6><blockquote><p>æ•°æ®ä»Kafkaè·å–ï¼Œç„¶åè¿›è¡ŒdataStreamè½¬æ¢ï¼Œæœ€åå°†ç»“æœä¿å­˜åœ¨mysqlä¸­</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.&#123;<span class="type">Connection</span>, <span class="type">DriverManager</span>, <span class="type">PreparedStatement</span>&#125;</span><br><span class="line"><span class="keyword">import</span> java.util.<span class="type">Properties</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.serialization.<span class="type">SimpleStringSchema</span></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.configuration.<span class="type">Configuration</span></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.sink.&#123;<span class="type">RichSinkFunction</span>, <span class="type">SinkFunction</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.scala._</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.connectors.kafka.&#123;<span class="type">FlinkKafkaConsumer011</span>, <span class="type">FlinkKafkaProducer011</span>&#125;</span><br><span class="line"><span class="comment">// å®šä¹‰æ ·ä¾‹ç±»ï¼Œæ¸©åº¦ä¼ æ„Ÿå™¨</span></span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">SensorReading</span>(<span class="params">id: <span class="type">String</span>, timestamp: <span class="type">Long</span>, temperature: <span class="type">Double</span></span>)</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">SourceTest</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    <span class="keyword">val</span> env: <span class="type">StreamExecutionEnvironment</span> = <span class="type">StreamExecutionEnvironment</span>.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3ã€ä»kafkaä¸­è¯»å–æ•°æ®</span></span><br><span class="line">    <span class="keyword">val</span> properties = <span class="keyword">new</span> <span class="type">Properties</span>()</span><br><span class="line">    properties.setProperty(<span class="string">&quot;bootstrap.servers&quot;</span>, <span class="string">&quot;10.12.42.174:9092&quot;</span>)</span><br><span class="line">    properties.setProperty(<span class="string">&quot;group.id&quot;</span>, <span class="string">&quot;consumer-group&quot;</span>)</span><br><span class="line">    <span class="comment">//    properties.setProperty(&quot;auto.offset.reset&quot;, &quot;latest&quot;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> stream3: <span class="type">DataStream</span>[<span class="type">String</span>] = env.addSource(<span class="keyword">new</span> <span class="type">FlinkKafkaConsumer011</span>[<span class="type">String</span>](<span class="string">&quot;sensor&quot;</span>, <span class="keyword">new</span> <span class="type">SimpleStringSchema</span>(), properties))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†ä»kafkaè·å–çš„æ•°æ®å¤„ç†</span></span><br><span class="line">    <span class="keyword">val</span> outputStream: <span class="type">DataStream</span>[<span class="type">SensorReading</span>] = stream3.map(</span><br><span class="line">      data =&gt; &#123;</span><br><span class="line">        <span class="keyword">var</span> arr = data.split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">        <span class="type">SensorReading</span>(arr(<span class="number">0</span>), arr(<span class="number">1</span>).toLong, arr(<span class="number">2</span>).toDouble)</span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†å¤„å¤„ä¹‹åçš„æ•°æ®é‡æ–°å‘é€åˆ°kafkaä¸­</span></span><br><span class="line">    <span class="comment">//    outputStream.addSink(new FlinkKafkaProducer011[String](&quot;10.12.42.174:9092&quot;, &quot;sensor_res&quot;, new SimpleStringSchema()))</span></span><br><span class="line">    <span class="comment">//    outputStream.print()</span></span><br><span class="line"></span><br><span class="line">    outputStream.addSink(<span class="keyword">new</span> <span class="type">MyJdbcSink</span>())</span><br><span class="line">    <span class="comment">//æ‰§è¡Œ</span></span><br><span class="line">    env.execute()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰å…³äºSinkçš„JDBCè¿æ¥å¤„ç†</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyJdbcSink</span>(<span class="params"></span>) <span class="keyword">extends</span> <span class="title">RichSinkFunction</span>[<span class="type">SensorReading</span>] </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–è‡ªå®šä¹‰å‚æ•°</span></span><br><span class="line">  <span class="keyword">var</span> conn: <span class="type">Connection</span> = _</span><br><span class="line">  <span class="keyword">var</span> insertStmt: <span class="type">PreparedStatement</span> = _</span><br><span class="line">  <span class="keyword">var</span> updateStmt: <span class="type">PreparedStatement</span> = _</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ›å»ºæ•°æ®åº“è¿æ¥</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">open</span></span>(parameters: <span class="type">Configuration</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    conn = <span class="type">DriverManager</span>.getConnection(<span class="string">&quot;jdbc:mysql://10.12.42.174/flink&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;root&quot;</span>)</span><br><span class="line">    insertStmt = conn.prepareStatement(<span class="string">&quot;insert into sensor_temp(id,temp) values (?,?)&quot;</span>)</span><br><span class="line">    updateStmt = conn.prepareStatement(<span class="string">&quot;update sensor_temp set temp =? where id = ? &quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">invoke</span></span>(value: <span class="type">SensorReading</span>, context: <span class="type">SinkFunction</span>.<span class="type">Context</span>[_]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…ˆæ‰§è¡Œæ›´æ–°ç¨‹åºï¼ŒæŸ¥åˆ°å°±æ›´æ–°</span></span><br><span class="line">    updateStmt.setDouble(<span class="number">1</span>, value.temperature)</span><br><span class="line">    updateStmt.setString(<span class="number">2</span>, value.id)</span><br><span class="line">    updateStmt.execute()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰æ›´æ–°çš„å†…å®¹å°±æ’å…¥</span></span><br><span class="line">    <span class="keyword">if</span> (updateStmt.getUpdateCount == <span class="number">0</span>) &#123;</span><br><span class="line">      insertStmt.setString(<span class="number">1</span>, value.id)</span><br><span class="line">      insertStmt.setDouble(<span class="number">2</span>, value.temperature)</span><br><span class="line">      insertStmt.execute()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">close</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    insertStmt.close()</span><br><span class="line">    updateStmt.close()</span><br><span class="line">    conn.close()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="äº”ã€Flinkä¸­çš„Window"><a href="#äº”ã€Flinkä¸­çš„Window" class="headerlink" title="äº”ã€Flinkä¸­çš„Window"></a>äº”ã€Flinkä¸­çš„Window</h3><blockquote><p>Windowæ˜¯ä¸€ç§<strong>åˆ‡å‰²æ— é™æ•°æ®</strong>ä¸º<strong>æœ‰é™å—</strong>è¿›è¡Œå¤„ç†çš„æ‰‹æ®µã€‚</p></blockquote><h4 id="1ã€Windowç±»å‹"><a href="#1ã€Windowç±»å‹" class="headerlink" title="1ã€Windowç±»å‹"></a>1ã€Windowç±»å‹</h4><ul><li>CountWindow:æŒ‰ç…§æŒ‡å®šçš„æ•°æ®æ¡æ•°ç”Ÿæˆä¸€ä¸ªwindowï¼Œå’Œæ—¶é—´æ²¡æœ‰å…³ç³»</li><li>TimeWindow:æŒ‰ç…§æ—¶é—´ç”Ÿæˆwindow</li></ul><h4 id="2ã€çª—å£å®ç°åŸç†çš„ä¸åŒåˆ†æˆä¸‰ç±»"><a href="#2ã€çª—å£å®ç°åŸç†çš„ä¸åŒåˆ†æˆä¸‰ç±»" class="headerlink" title="2ã€çª—å£å®ç°åŸç†çš„ä¸åŒåˆ†æˆä¸‰ç±»"></a>2ã€çª—å£å®ç°åŸç†çš„ä¸åŒåˆ†æˆä¸‰ç±»</h4><h5 id="1ï¼‰æ»šåŠ¨çª—å£ï¼ˆTumbling-Windows"><a href="#1ï¼‰æ»šåŠ¨çª—å£ï¼ˆTumbling-Windows" class="headerlink" title="1ï¼‰æ»šåŠ¨çª—å£ï¼ˆTumbling Windows)"></a>1ï¼‰æ»šåŠ¨çª—å£ï¼ˆTumbling Windows)</h5><blockquote><p>å°†æ•°æ®ä¾æ®<code>å›ºå®šçš„çª—å£é•¿åº¦</code>å¯¹æ•°æ®è¿›è¡Œ<code>åˆ‡ç‰‡</code>ã€‚</p><p><strong>ç‰¹ç‚¹ï¼šæ—¶é—´å¯¹é½ï¼Œçª—å£é•¿åº¦å›ºå®šï¼Œæ²¡æœ‰é‡å ã€‚</strong></p></blockquote><h5 id="2ï¼‰æ»‘åŠ¨çª—å£ï¼ˆSliding-Windowsï¼‰"><a href="#2ï¼‰æ»‘åŠ¨çª—å£ï¼ˆSliding-Windowsï¼‰" class="headerlink" title="2ï¼‰æ»‘åŠ¨çª—å£ï¼ˆSliding Windowsï¼‰"></a>2ï¼‰æ»‘åŠ¨çª—å£ï¼ˆSliding Windowsï¼‰</h5><blockquote><p>æ»‘åŠ¨çª—å£ç”±<code>å›ºå®šçš„çª—å£é•¿åº¦</code>å’Œ<code>æ»‘åŠ¨é—´éš”</code>ç»„æˆã€‚</p><p><strong>ç‰¹ç‚¹ï¼šæ—¶é—´å¯¹é½ï¼Œçª—å£é•¿åº¦å›ºå®šï¼Œå¯ä»¥æœ‰é‡å </strong></p></blockquote><h5 id="3ï¼‰ä¼šè¯çª—å£ï¼ˆSession-Windows"><a href="#3ï¼‰ä¼šè¯çª—å£ï¼ˆSession-Windows" class="headerlink" title="3ï¼‰ä¼šè¯çª—å£ï¼ˆSession Windows)"></a>3ï¼‰ä¼šè¯çª—å£ï¼ˆSession Windows)</h5><blockquote><p>ç”±ä¸€ç³»åˆ—äº‹ä»¶ç»„åˆä¸€ä¸ªæŒ‡å®šæ—¶é—´é•¿åº¦çš„ <code>timeout</code> é—´éš™ç»„æˆï¼Œç±»ä¼¼äº web åº”ç”¨çš„sessionï¼Œä¹Ÿå°±æ˜¯ä¸€æ®µæ—¶é—´æ²¡æœ‰æ¥æ”¶åˆ°æ–°æ•°æ®å°±ä¼šç”Ÿæˆæ–°çš„çª—å£ã€‚</p><p><strong>ç‰¹ç‚¹ï¼šæ—¶é—´æ— å¯¹é½ã€‚</strong></p><p><img src="https://file.buildworld.cn/img/20201013095706.png"></p></blockquote><h4 id="3ã€Window-API"><a href="#3ã€Window-API" class="headerlink" title="3ã€Window API"></a>3ã€Window API</h4><h5 id="TimeWindow"><a href="#TimeWindow" class="headerlink" title="TimeWindow"></a>TimeWindow</h5><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.<span class="type">Time</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†ä»kafkaè·å–çš„æ•°æ®å¤„ç†</span></span><br><span class="line"><span class="keyword">val</span> outputStream: <span class="type">DataStream</span>[<span class="type">SensorReading</span>] = stream3.map(</span><br><span class="line">  data =&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> arr = data.split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">    <span class="type">SensorReading</span>(arr(<span class="number">0</span>), arr(<span class="number">1</span>).toLong, arr(<span class="number">2</span>).toDouble)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">outputStream</span><br><span class="line">  .map(data =&gt; (data.id, data.temperature))</span><br><span class="line">  .keyBy(_._1) <span class="comment">//å®‰è£…äºŒå…ƒç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆidï¼‰åˆ†ç»„</span></span><br><span class="line">  .timeWindow(<span class="type">Time</span>.seconds(<span class="number">10</span>)) <span class="comment">// ä¸€ä¸ªå‚æ•°å°±æ˜¯æ»šåŠ¨çª—å£ï¼Œä¸¤ä¸ªå‚æ•°å°±æ˜¯æ»‘åŠ¨çª—å£</span></span><br><span class="line">  .window(<span class="type">SlidingEventTimeWindows</span>.of(<span class="type">Time</span>.seconds(<span class="number">15</span>),<span class="type">Time</span>.seconds(<span class="number">5</span>)))  <span class="comment">// ä¼šè¯çª—å£</span></span><br><span class="line">  .reduce((curRes, newData) =&gt; (curRes._1, curRes._2.min(newData._2), newData._3))</span><br></pre></td></tr></table></figure><h5 id="CountWindow"><a href="#CountWindow" class="headerlink" title="CountWindow"></a>CountWindow</h5><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">outputStream</span><br><span class="line">  .map(data =&gt; (data.id, data.temperature))</span><br><span class="line">  .keyBy(_._1) <span class="comment">//å®‰è£…äºŒå…ƒç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆidï¼‰åˆ†ç»„</span></span><br><span class="line">  .countWindow(<span class="number">5</span>) <span class="comment">// ä¸€ä¸ªå‚æ•°å°±æ˜¯æ»šåŠ¨çª—å£ï¼Œä¸¤ä¸ªå‚æ•°å°±æ˜¯æ»‘åŠ¨çª—å£</span></span><br><span class="line">  .reduce((curRes, newData) =&gt; (curRes._1, curRes._2.min(newData._2), newData._3))</span><br></pre></td></tr></table></figure><h4 id="4ã€window-function"><a href="#4ã€window-function" class="headerlink" title="4ã€window function"></a>4ã€window function</h4><blockquote><ul><li><strong>å¢é‡èšåˆå‡½æ•°ï¼ˆincremental aggregation functionsï¼‰</strong><br>æ¯æ¡æ•°æ®åˆ°æ¥å°±è¿›è¡Œè®¡ç®—ï¼Œä¿æŒä¸€ä¸ªç®€å•çš„çŠ¶æ€ã€‚å…¸å‹çš„å¢é‡èšåˆå‡½æ•°æœ‰ReduceFunction, AggregateFunctionã€‚</li><li><strong>å…¨çª—å£å‡½æ•°ï¼ˆfull window functionsï¼‰</strong><br>å…ˆæŠŠçª—å£æ‰€æœ‰æ•°æ®æ”¶é›†èµ·æ¥ï¼Œç­‰åˆ°è®¡ç®—çš„æ—¶å€™ä¼šéå†æ‰€æœ‰æ•°æ®ã€‚ProcessWindowFunction å°±æ˜¯ä¸€ä¸ªå…¨çª—å£å‡½æ•°ã€‚</li></ul></blockquote><h3 id="å…­ã€æ—¶é—´è¯­ä¹‰ä¸-Wartermark"><a href="#å…­ã€æ—¶é—´è¯­ä¹‰ä¸-Wartermark" class="headerlink" title="å…­ã€æ—¶é—´è¯­ä¹‰ä¸ Wartermark"></a>å…­ã€æ—¶é—´è¯­ä¹‰ä¸ Wartermark</h3><p><strong>åœ¨ Flink  çš„æµå¼å¤„ç†ä¸­ï¼Œç»å¤§éƒ¨åˆ†çš„ä¸šåŠ¡éƒ½ä¼šä½¿ç”¨ <code>eventTime</code></strong></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line"><span class="keyword">val</span> env: <span class="type">StreamExecutionEnvironment</span> = <span class="type">StreamExecutionEnvironment</span>.getExecutionEnvironment</span><br><span class="line"><span class="comment">// ä»è°ƒç”¨æ—¶åˆ»å¼€å§‹ç»™ env åˆ›å»ºçš„æ¯ä¸€ä¸ª stream è¿½åŠ æ—¶é—´ç‰¹å¾</span></span><br><span class="line">env.setStreamTimeCharacteristic(<span class="type">TimeCharacteristic</span>.<span class="type">EventTime</span>)</span><br></pre></td></tr></table></figure><h4 id="Watermark"><a href="#Watermark" class="headerlink" title="Watermark"></a>Watermark</h4><ul><li>Watermark æ˜¯ä¸€ç§è¡¡é‡ Event Time è¿›å±•çš„æœºåˆ¶ã€‚</li><li><strong>Watermark  æ˜¯ç”¨äºå¤„ç†ä¹±åºäº‹ä»¶çš„</strong>ï¼Œè€Œæ­£ç¡®çš„å¤„ç†ä¹±åºäº‹ä»¶ï¼Œé€šå¸¸ç”¨Watermark æœºåˆ¶ç»“åˆ window æ¥å®ç°ã€‚</li><li>æ•°æ®æµä¸­çš„ Watermark ç”¨äºè¡¨ç¤º timestamp å°äº Watermark çš„æ•°æ®ï¼Œéƒ½å·²ç»åˆ°è¾¾äº†ï¼Œå› æ­¤ï¼Œwindow çš„æ‰§è¡Œä¹Ÿæ˜¯ç”± Watermark è§¦å‘çš„ã€‚</li><li>Watermark å¯ä»¥ç†è§£æˆä¸€ä¸ªå»¶è¿Ÿè§¦å‘æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½® Watermark çš„å»¶æ—¶æ—¶é•¿ tï¼Œæ¯æ¬¡ç³»ç»Ÿä¼šæ ¡éªŒå·²ç»åˆ°è¾¾çš„æ•°æ®ä¸­æœ€å¤§çš„ maxEventTimeï¼Œç„¶åè®¤å®š eventTimeå°äº maxEventTime - t çš„æ‰€æœ‰æ•°æ®éƒ½å·²ç»åˆ°è¾¾ï¼Œå¦‚æœæœ‰çª—å£çš„åœæ­¢æ—¶é—´ç­‰äºmaxEventTime â€“ tï¼Œé‚£ä¹ˆè¿™ä¸ªçª—å£è¢«è§¦å‘æ‰§è¡Œã€‚</li></ul><h3 id="ä¸ƒã€ProcessFunction-APIï¼ˆåº•å±‚-APIï¼‰"><a href="#ä¸ƒã€ProcessFunction-APIï¼ˆåº•å±‚-APIï¼‰" class="headerlink" title="ä¸ƒã€ProcessFunction APIï¼ˆåº•å±‚ APIï¼‰"></a>ä¸ƒã€ProcessFunction APIï¼ˆåº•å±‚ APIï¼‰</h3><blockquote><p>Process Function ç”¨æ¥æ„å»ºäº‹ä»¶é©±åŠ¨çš„åº”ç”¨ä»¥åŠå®ç°è‡ªå®šä¹‰çš„ä¸šåŠ¡é€»è¾‘(ä½¿ç”¨ä¹‹å‰çš„window å‡½æ•°å’Œè½¬æ¢ç®—å­æ— æ³•å®ç°)ã€‚</p><p>Flink æä¾›äº† 8 ä¸ª Process Functionï¼š<br>â€¢  ProcessFunction<br>â€¢  KeyedProcessFunction<br>â€¢  CoProcessFunction<br>â€¢  ProcessJoinFunction<br>â€¢  BroadcastProcessFunction<br>â€¢  KeyedBroadcastProcessFunction<br>â€¢  ProcessWindowFunction<br>â€¢  ProcessAllWindowFunction</p></blockquote><h4 id="TimerService-å’Œ-å®šæ—¶å™¨ï¼ˆTimersï¼‰æ¡ˆä¾‹"><a href="#TimerService-å’Œ-å®šæ—¶å™¨ï¼ˆTimersï¼‰æ¡ˆä¾‹" class="headerlink" title="TimerService å’Œ å®šæ—¶å™¨ï¼ˆTimersï¼‰æ¡ˆä¾‹"></a>TimerService å’Œ å®šæ—¶å™¨ï¼ˆTimersï¼‰æ¡ˆä¾‹</h4><blockquote><p>ç›‘æ§æ¸©åº¦ä¼ æ„Ÿå™¨çš„æ¸©åº¦å€¼ï¼Œå¦‚æœæ¸©åº¦å€¼åœ¨ 10 ç§’é’Ÿä¹‹å†…(processing time)è¿ç»­ä¸Šå‡ï¼Œåˆ™æŠ¥è­¦</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.buildworld.flink.processfunc.bean.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ValueState;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ValueStateDescriptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.tuple.Tuple;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.configuration.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStreamSource;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.KeyedProcessFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.Collector;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MiChong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-12-07 15:02</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProcessFunction_App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">        env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//socket æ–‡æœ¬æµ</span></span><br><span class="line">        DataStreamSource&lt;String&gt; inputStream = env.socketTextStream(<span class="string">&quot;localhost&quot;</span>, <span class="number">7777</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è½¬æ¢ä¸ºSensorReadingç±»å‹</span></span><br><span class="line">        DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">            String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//æµ‹è¯•keyedProcessFunctionï¼Œå…ˆåˆ†ç»„å†å®šä¹‰</span></span><br><span class="line">        dataStream.keyBy(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">                .process(<span class="keyword">new</span> TempConsIncreWarning(<span class="number">10</span>))</span><br><span class="line">                .print();</span><br><span class="line"></span><br><span class="line">        env.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ç°è‡ªå®šä¹‰å¤„ç†å‡½æ•°ï¼Œæ£€æµ‹ä¸€æ®µæ—¶é—´å†…çš„æ¸©åº¦è¿ç»­ä¸Šå‡ï¼Œè¾“å‡ºæŠ¥è­¦</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TempConsIncreWarning</span> <span class="keyword">extends</span> <span class="title">KeyedProcessFunction</span>&lt;<span class="title">Tuple</span>, <span class="title">SensorReading</span>, <span class="title">String</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®šä¹‰ç§æœ‰å±æ€§ï¼Œå½“å‰ç»Ÿè®¡çš„æ—¶é—´é—´éš”</span></span><br><span class="line">        <span class="keyword">private</span> Integer interval;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å®šä¹‰çŠ¶æ€ï¼Œä¿å­˜ä¸Šä¸€æ¬¡çš„æ¸©åº¦å€¼ï¼Œå®šæ—¶å™¨æ—¶é—´æˆ³</span></span><br><span class="line">        <span class="keyword">private</span> ValueState&lt;Double&gt; lastTempState;</span><br><span class="line">        <span class="keyword">private</span> ValueState&lt;Long&gt; timerTsState;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TempConsIncreWarning</span><span class="params">(Integer interval)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.interval = interval;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(Configuration parameters)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            lastTempState = getRuntimeContext().getState(<span class="keyword">new</span> ValueStateDescriptor&lt;Double&gt;(<span class="string">&quot;last-temp&quot;</span>, Double.class, Double.MIN_VALUE));</span><br><span class="line">            timerTsState = getRuntimeContext().getState(<span class="keyword">new</span> ValueStateDescriptor&lt;Long&gt;(<span class="string">&quot;time-ts&quot;</span>, Long.class));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processElement</span><span class="params">(SensorReading sensorReading, Context context, Collector&lt;String&gt; collector)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å–å‡ºçŠ¶æ€</span></span><br><span class="line">            Double lastTemp = lastTempState.value();</span><br><span class="line">            Long timerTs = timerTsState.value();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//æ›´æ–°æ¸©åº¦çŠ¶æ€</span></span><br><span class="line">            lastTempState.update(sensorReading.getTemperature());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å¦‚æœæ¸©åº¦ä¸Šå‡å¹¶ä¸”æ²¡æœ‰å®šæ—¶å™¨çš„æ—¶å€™ï¼Œæ³¨å†Œ10ç§’ä¹‹åçš„å®šæ—¶å™¨ï¼Œå¼€å§‹ç­‰å¾…</span></span><br><span class="line">            <span class="keyword">if</span> (sensorReading.getTemperature() &gt; lastTemp &amp;&amp; timerTs == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">//è®¡ç®—å‡ºå®šæ—¶å™¨çš„æ—¶é—´æˆ³</span></span><br><span class="line">                Long ts = context.timerService().currentProcessingTime() + interval * <span class="number">1000L</span>;</span><br><span class="line">                context.timerService().registerProcessingTimeTimer(ts);</span><br><span class="line">                timerTsState.update(ts);</span><br><span class="line">                System.out.println(<span class="string">&quot;æ¸©åº¦ä¸Šå‡&quot;</span>);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å¦‚æœæ¸©åº¦ä¸‹é™ï¼Œåˆ é™¤å®šæ—¶å™¨</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (sensorReading.getTemperature() &lt; lastTemp &amp;&amp; timerTs != <span class="keyword">null</span>) &#123;</span><br><span class="line">                context.timerService().deleteProcessingTimeTimer(timerTs);</span><br><span class="line">                timerTsState.clear();</span><br><span class="line">                System.out.println(<span class="string">&quot;æ¸©åº¦ä¸‹é™&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTimer</span><span class="params">(<span class="keyword">long</span> timestamp, OnTimerContext ctx, Collector&lt;String&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            out.collect(<span class="string">&quot;ä¼ æ„Ÿå™¨ï¼š&quot;</span> + ctx.getCurrentKey().getField(<span class="number">0</span>) + <span class="string">&quot;æ¸©åº¦å€¼è¿ç»­&quot;</span> + interval + <span class="string">&quot;ç§’ä¸Šå‡&quot;</span> + <span class="string">&quot;,å½“å‰æ¸©åº¦ä¸ºï¼š&quot;</span> + lastTempState.value());</span><br><span class="line">            timerTsState.clear();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            lastTempState.clear();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¾§è¾“å‡ºæµï¼ˆSideOutputï¼‰"><a href="#ä¾§è¾“å‡ºæµï¼ˆSideOutputï¼‰" class="headerlink" title="ä¾§è¾“å‡ºæµï¼ˆSideOutputï¼‰"></a>ä¾§è¾“å‡ºæµï¼ˆSideOutputï¼‰</h4><blockquote><p>æ¡ˆä¾‹ï¼šç”¨æ¥ç›‘æ§ä¼ æ„Ÿå™¨æ¸©åº¦å€¼ï¼Œå°†æ¸©åº¦å€¼ä½äº 30 åº¦çš„æ•°æ®è¾“å‡ºåˆ° side outputã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProcessFunction_SideOutputCase</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">        env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//socket æ–‡æœ¬æµ</span></span><br><span class="line">        DataStreamSource&lt;String&gt; inputStream = env.socketTextStream(<span class="string">&quot;localhost&quot;</span>, <span class="number">7777</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è½¬æ¢ä¸ºSensorReadingç±»å‹</span></span><br><span class="line">        DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">            String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> OutputTag&lt;SensorReading&gt; lowTempTag = <span class="keyword">new</span> OutputTag&lt;SensorReading&gt;(<span class="string">&quot;lowTemp&quot;</span>) &#123;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æµ‹è¯•keyedProcessFunctionï¼Œè‡ªå®šä¹‰ä¾§è¾“å‡ºæµå®ç°åˆ†æµæ“ä½œ</span></span><br><span class="line">        SingleOutputStreamOperator&lt;SensorReading&gt; highTempStream = dataStream.keyBy(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">                .process(<span class="keyword">new</span> ProcessFunction&lt;SensorReading, SensorReading&gt;() &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processElement</span><span class="params">(SensorReading sensorReading, Context context, Collector&lt;SensorReading&gt; collector)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (sensorReading.getTemperature() &lt; <span class="number">30</span>) &#123;</span><br><span class="line">                            context.output(lowTempTag, sensorReading);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            collector.collect(sensorReading);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">        DataStream&lt;SensorReading&gt; lowTempStream = highTempStream.getSideOutput(lowTempTag);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ†åˆ«è¾“å‡º</span></span><br><span class="line">        highTempStream.print(<span class="string">&quot;high&quot;</span>);</span><br><span class="line">        lowTempStream.print(<span class="string">&quot;low&quot;</span>);</span><br><span class="line"></span><br><span class="line">        env.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…«ã€çŠ¶æ€ç¼–ç¨‹å’Œå®¹é”™æœºåˆ¶"><a href="#å…«ã€çŠ¶æ€ç¼–ç¨‹å’Œå®¹é”™æœºåˆ¶" class="headerlink" title="å…«ã€çŠ¶æ€ç¼–ç¨‹å’Œå®¹é”™æœºåˆ¶"></a>å…«ã€çŠ¶æ€ç¼–ç¨‹å’Œå®¹é”™æœºåˆ¶</h3><blockquote><p>æµå¼è®¡ç®—åˆ†ä¸º<code>æœ‰çŠ¶æ€</code>å’Œ<code>æ— çŠ¶æ€</code>ä¸¤ç§æƒ…å†µã€‚æ— çŠ¶æ€çš„è®¡ç®—è§‚å¯Ÿæ¯ä¸ªç‹¬ç«‹äº‹ä»¶ï¼Œå¹¶æ ¹æ®æœ€åä¸€ä¸ªäº‹ä»¶è¾“å‡ºç»“æœï¼ˆ<strong>æ— çŠ¶æ€æµå¤„ç†</strong>æ¯æ¬¡åªè½¬æ¢ä¸€æ¡è¾“å…¥è®°å½•ï¼Œå¹¶ä¸”ä»…æ ¹æ®æœ€æ–°çš„è¾“å…¥è®°å½•è¾“å‡ºç»“æœï¼‰ã€‚æœ‰çŠ¶æ€çš„è®¡ç®—åˆ™ä¼šåŸºäºå¤šä¸ªäº‹ä»¶è¾“å‡ºç»“æœï¼ˆ<strong>æœ‰çŠ¶æ€æµå¤„ç†</strong>ç»´æŠ¤æ‰€æœ‰å·²å¤„ç†è®°å½•çš„çŠ¶æ€å€¼ï¼Œå¹¶æ ¹æ®æ¯æ¡æ–°è¾“å…¥çš„è®°å½•æ›´æ–°çŠ¶æ€ï¼Œå› æ­¤è¾“å‡ºè®°å½•(ç°æ¡)åæ˜ çš„æ˜¯ç»¼åˆè€ƒè™‘å¤šä¸ªäº‹ä»¶ä¹‹åçš„ç»“æœã€‚ï¼‰ã€‚</p></blockquote><h4 id="1ã€Flinkæ£€æŸ¥ç‚¹ç®—æ³•â€“æ£€æŸ¥ç‚¹åˆ†ç•Œçº¿ï¼ˆCheckpoint-Barrierï¼‰"><a href="#1ã€Flinkæ£€æŸ¥ç‚¹ç®—æ³•â€“æ£€æŸ¥ç‚¹åˆ†ç•Œçº¿ï¼ˆCheckpoint-Barrierï¼‰" class="headerlink" title="1ã€Flinkæ£€æŸ¥ç‚¹ç®—æ³•â€“æ£€æŸ¥ç‚¹åˆ†ç•Œçº¿ï¼ˆCheckpoint Barrierï¼‰"></a>1ã€Flinkæ£€æŸ¥ç‚¹ç®—æ³•â€“æ£€æŸ¥ç‚¹åˆ†ç•Œçº¿ï¼ˆCheckpoint Barrierï¼‰</h4><blockquote><ul><li>Flink çš„æ£€æŸ¥ç‚¹ç®—æ³•ç”¨åˆ°äº†ä¸€ç§ç§°ä¸ºåˆ†ç•Œçº¿ï¼ˆbarrierï¼‰çš„ç‰¹æ®Šæ•°æ®å½¢å¼ï¼Œç”¨æ¥æŠŠä¸€æ¡æµä¸Šæ•°æ®æŒ‰ç…§ä¸åŒçš„æ£€æŸ¥ç‚¹åˆ†å¼€ã€‚</li><li>åˆ†ç•Œçº¿ä¹‹å‰åˆ°æ¥çš„æ•°æ®å¯¼è‡´çš„çŠ¶æ€æ›´æ”¹ï¼Œéƒ½ä¼šè¢«åŒ…å«åœ¨å½“å‰åˆ†ç•Œçº¿æ‰€å±çš„æ£€æŸ¥ç‚¹ä¸­ï¼›è€ŒåŸºäºåˆ†ç•Œçº¿ä¹‹åçš„æ•°æ®å¯¼è‡´çš„æ‰€æœ‰æ›´æ”¹ï¼Œå°±ä¼šè¢«åŒ…å«åœ¨ä¹‹åçš„æ£€æŸ¥ç‚¹ä¸­ã€‚</li></ul></blockquote><h4 id="2ã€ä¿å­˜ç‚¹ï¼ˆSavepointsï¼‰"><a href="#2ã€ä¿å­˜ç‚¹ï¼ˆSavepointsï¼‰" class="headerlink" title="2ã€ä¿å­˜ç‚¹ï¼ˆSavepointsï¼‰"></a>2ã€ä¿å­˜ç‚¹ï¼ˆSavepointsï¼‰</h4><blockquote><ul><li>Flink è¿˜æä¾›äº†å¯ä»¥è‡ªå®šä¹‰çš„é•œåƒä¿å­˜åŠŸèƒ½ï¼Œå°±æ˜¯<code>ä¿å­˜ç‚¹ï¼ˆsavepointsï¼‰</code></li><li>åŸåˆ™ä¸Šï¼Œåˆ›å»ºä¿å­˜ç‚¹ä½¿ç”¨çš„ç®—æ³•ä¸æ£€æŸ¥ç‚¹å®Œå…¨ç›¸åŒï¼Œå› æ­¤ä¿å­˜ç‚¹å¯ä»¥è®¤ä¸ºå°±æ˜¯å…·æœ‰ä¸€äº›é¢å¤–å…ƒæ•°æ®çš„æ£€æŸ¥ç‚¹</li><li>Flinkä¸ä¼šè‡ªåŠ¨åˆ›å»ºä¿å­˜ç‚¹ï¼Œå› æ­¤ç”¨æˆ·ï¼ˆæˆ–è€…å¤–éƒ¨è°ƒåº¦ç¨‹åºï¼‰å¿…é¡»æ˜ç¡®åœ°è§¦å‘åˆ›å»ºæ“ä½œ</li><li>ä¿å­˜ç‚¹æ˜¯ä¸€ä¸ªå¼ºå¤§çš„åŠŸèƒ½ã€‚é™¤äº†æ•…éšœæ¢å¤å¤–ï¼Œä¿å­˜ç‚¹å¯ä»¥ç”¨äºï¼šæœ‰è®¡åˆ’çš„æ‰‹åŠ¨å¤‡ä»½ï¼Œæ›´æ–°åº”ç”¨ç¨‹åºï¼Œç‰ˆæœ¬è¿ç§»ï¼Œæš‚åœå’Œé‡å¯åº”ç”¨ï¼Œç­‰ç­‰</li></ul></blockquote><h4 id="3ã€å®¹é”™æœºåˆ¶é…ç½®é¡¹"><a href="#3ã€å®¹é”™æœºåˆ¶é…ç½®é¡¹" class="headerlink" title="3ã€å®¹é”™æœºåˆ¶é…ç½®é¡¹"></a>3ã€å®¹é”™æœºåˆ¶é…ç½®é¡¹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line"></span><br><span class="line"><span class="comment">//2ã€æ£€æŸ¥ç‚¹é…ç½®</span></span><br><span class="line">env.enableCheckpointing(<span class="number">300</span>);</span><br><span class="line"><span class="comment">//é«˜çº§é€‰é¡¹</span></span><br><span class="line">env.getCheckpointConfig().setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE);</span><br><span class="line">env.getCheckpointConfig().setCheckpointTimeout(<span class="number">60000L</span>);</span><br><span class="line">env.getCheckpointConfig().setMaxConcurrentCheckpoints(<span class="number">2</span>);</span><br><span class="line">env.getCheckpointConfig().setMinPauseBetweenCheckpoints(<span class="number">100L</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//3ã€é‡å¯ç­–ç•¥é…ç½®</span></span><br><span class="line"><span class="comment">// å›ºå®šå»¶è¿Ÿé‡å¯</span></span><br><span class="line">env.setRestartStrategy(RestartStrategies.fixedDelayRestart(<span class="number">3</span>, <span class="number">10000L</span>));</span><br><span class="line"><span class="comment">//å¤±è´¥ç‡é‡å¯</span></span><br><span class="line">env.setRestartStrategy(RestartStrategies.failureRateRestart(<span class="number">3</span>, Time.minutes(<span class="number">10</span>),Time.minutes(<span class="number">1</span>)));</span><br></pre></td></tr></table></figure><h4 id="4ã€çŠ¶æ€ä¸€è‡´æ€§åˆ†ç±»"><a href="#4ã€çŠ¶æ€ä¸€è‡´æ€§åˆ†ç±»" class="headerlink" title="4ã€çŠ¶æ€ä¸€è‡´æ€§åˆ†ç±»"></a>4ã€çŠ¶æ€ä¸€è‡´æ€§åˆ†ç±»</h4><blockquote><p>Flink çš„ä¸€ä¸ªé‡å¤§ä»·å€¼åœ¨äºï¼Œ å®ƒæ—¢ä¿è¯äº† <code>exactly-once</code> ï¼Œä¹Ÿå…·æœ‰<code>ä½å»¶è¿Ÿ</code>å’Œ<code>é«˜åååŠ›</code>çš„å¤„ç†èƒ½åŠ›ã€‚</p></blockquote><p><img src="https://file.buildworld.cn/img/20201208182144.png"></p><h4 id="5ã€Flinkå’Œkafkaå®ç°ç«¯åˆ°ç«¯çš„-exactly-once-è¯­ä¹‰"><a href="#5ã€Flinkå’Œkafkaå®ç°ç«¯åˆ°ç«¯çš„-exactly-once-è¯­ä¹‰" class="headerlink" title="5ã€Flinkå’Œkafkaå®ç°ç«¯åˆ°ç«¯çš„ exactly-once  è¯­ä¹‰"></a>5ã€Flinkå’Œkafkaå®ç°ç«¯åˆ°ç«¯çš„ exactly-once  è¯­ä¹‰</h4><p><img src="https://file.buildworld.cn/img/20201209123608.png"></p><h3 id="ä¹ã€Table-APIå’ŒFlink-SQL"><a href="#ä¹ã€Table-APIå’ŒFlink-SQL" class="headerlink" title="ä¹ã€Table APIå’ŒFlink SQL"></a>ä¹ã€Table APIå’ŒFlink SQL</h3><h4 id="1ã€å¼•å…¥pomä¾èµ–"><a href="#1ã€å¼•å…¥pomä¾èµ–" class="headerlink" title="1ã€å¼•å…¥pomä¾èµ–"></a>1ã€å¼•å…¥pomä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.10.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-streaming-java_2.12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.10.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-table-planner_2.12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.10.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">&lt;!--é˜¿é‡Œå·´å·´è´¡çŒ®å‡ºæ¥çš„Blink--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-table-planner-blink_2.12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.10.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2ã€ç®€å•çš„ä¾‹å­"><a href="#2ã€ç®€å•çš„ä¾‹å­" class="headerlink" title="2ã€ç®€å•çš„ä¾‹å­"></a>2ã€ç®€å•çš„ä¾‹å­</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//1ã€è¯»å–æ•°æ®</span></span><br><span class="line">DataStreamSource&lt;String&gt; inputStream = env.readTextFile(<span class="string">&quot;D:\\Java\\project\\Flink_Java\\src\\main\\resources\\sensor.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2ã€è½¬åŒ–æˆpojo</span></span><br><span class="line">DataStream&lt;SensorReading&gt; dataStream = inputStream.map(</span><br><span class="line">        line -&gt; &#123;</span><br><span class="line">            String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">//3ã€åˆ›å»ºè¡¨ç¯å¢ƒ</span></span><br><span class="line">StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env);</span><br><span class="line"></span><br><span class="line"><span class="comment">//4ã€åŸºäºæµåˆ›å»ºä¸€å¼ è¡¨</span></span><br><span class="line">Table dataTable = tableEnv.fromDataStream(dataStream);</span><br><span class="line"></span><br><span class="line"><span class="comment">//5ã€è°ƒç”¨table APIè¿›è¡Œè½¬åŒ–æ“ä½œ</span></span><br><span class="line">Table resTable = dataTable.select(<span class="string">&quot;id,temperature&quot;</span>)</span><br><span class="line">        .where(<span class="string">&quot; id = &#x27;sensor_1&#x27;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//6ã€æ‰§è¡ŒSQL</span></span><br><span class="line">tableEnv.createTemporaryView(<span class="string">&quot;sensor&quot;</span>, dataTable);</span><br><span class="line">String sql = <span class="string">&quot;select id,temperature from sensor where id = &#x27;sensor_1&#x27;&quot;</span>;</span><br><span class="line">Table resultSqlTable = tableEnv.sqlQuery(sql);</span><br><span class="line"></span><br><span class="line"><span class="comment">//7ã€æ‰“å°å‡ºæŸ¥è¯¢ç»“æœ</span></span><br><span class="line">tableEnv.toAppendStream(resTable, Row.class).print(<span class="string">&quot;result&quot;</span>);</span><br><span class="line">tableEnv.toAppendStream(resultSqlTable, Row.class).print(<span class="string">&quot;resultSql&quot;</span>);</span><br><span class="line"></span><br><span class="line">env.execute();</span><br></pre></td></tr></table></figure><h4 id="3ã€æ–°è€ç‰ˆæœ¬çš„æµã€æ‰¹å¤„ç†æ–¹æ³•"><a href="#3ã€æ–°è€ç‰ˆæœ¬çš„æµã€æ‰¹å¤„ç†æ–¹æ³•" class="headerlink" title="3ã€æ–°è€ç‰ˆæœ¬çš„æµã€æ‰¹å¤„ç†æ–¹æ³•"></a>3ã€æ–°è€ç‰ˆæœ¬çš„æµã€æ‰¹å¤„ç†æ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1ã€åˆ›å»ºç¯å¢ƒ</span></span><br><span class="line">StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.1 åŸºäºè€ç‰ˆæœ¬plannerçš„æµå¤„ç†</span></span><br><span class="line">EnvironmentSettings oldStreamSettings = EnvironmentSettings</span><br><span class="line">        .newInstance()</span><br><span class="line">        .useOldPlanner()</span><br><span class="line">        .inStreamingMode()</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">StreamTableEnvironment oldStreamTableEnv = StreamTableEnvironment.create(env, oldStreamSettings);</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.2 åŸºäºè€ç‰ˆæœ¬plannerçš„æ‰¹å¤„ç†</span></span><br><span class="line">ExecutionEnvironment batchEnv = ExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">BatchTableEnvironment oldBatchTableEnv = BatchTableEnvironment.create(batchEnv);</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.3 åŸºäºBlinkçš„æµå¤„ç†</span></span><br><span class="line">EnvironmentSettings blinkStreamSettings = EnvironmentSettings</span><br><span class="line">        .newInstance()</span><br><span class="line">        .useBlinkPlanner()</span><br><span class="line">        .inStreamingMode()</span><br><span class="line">        .build();</span><br><span class="line">StreamTableEnvironment blinkStreamTableEnv = StreamTableEnvironment.create(env, blinkStreamSettings);</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.4 åŸºäºBlinkçš„æ‰¹å¤„ç†</span></span><br><span class="line">EnvironmentSettings blinkBatchSettings = EnvironmentSettings</span><br><span class="line">        .newInstance()</span><br><span class="line">        .useBlinkPlanner()</span><br><span class="line">        .inBatchMode()</span><br><span class="line">        .build();</span><br><span class="line">TableEnvironment blinkBatchTableEnv = TableEnvironment.create(blinkBatchSettings);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">env.execute();</span><br></pre></td></tr></table></figure><h4 id="4ã€è¿æ¥å¤–éƒ¨ç³»ç»Ÿåˆ›å»ºä¸€å¼ è¡¨"><a href="#4ã€è¿æ¥å¤–éƒ¨ç³»ç»Ÿåˆ›å»ºä¸€å¼ è¡¨" class="headerlink" title="4ã€è¿æ¥å¤–éƒ¨ç³»ç»Ÿåˆ›å»ºä¸€å¼ è¡¨"></a>4ã€è¿æ¥å¤–éƒ¨ç³»ç»Ÿåˆ›å»ºä¸€å¼ è¡¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1ã€åˆ›å»ºç¯å¢ƒ</span></span><br><span class="line">StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2ã€è¡¨çš„åˆ›å»ºï¼šè¿æ¥å¤–éƒ¨ç³»ç»Ÿï¼Œè¯»å–æ•°æ®</span></span><br><span class="line"><span class="comment">// 2.1 è¯»å–æ–‡ä»¶</span></span><br><span class="line">String filePath = <span class="string">&quot;D:\\Java\\project\\Flink_Java\\src\\main\\resources\\sensor.txt&quot;</span>;</span><br><span class="line">tableEnv.connect(<span class="keyword">new</span> FileSystem().path(filePath))</span><br><span class="line">.withFormat(<span class="keyword">new</span> Csv())</span><br><span class="line">.withSchema(<span class="keyword">new</span> Schema()</span><br><span class="line">        .field(<span class="string">&quot;id&quot;</span>, DataTypes.STRING())</span><br><span class="line">        .field(<span class="string">&quot;timestamp&quot;</span>,DataTypes.BIGINT())</span><br><span class="line">        .field(<span class="string">&quot;temp&quot;</span>,DataTypes.DOUBLE())</span><br><span class="line">).createTemporaryTable(<span class="string">&quot;inputTable&quot;</span>);</span><br><span class="line"></span><br><span class="line">Table inputTable = tableEnv.from(<span class="string">&quot;inputTable&quot;</span>);</span><br><span class="line">inputTable.printSchema();</span><br><span class="line">tableEnv.toAppendStream(inputTable, Row.class).print();</span><br><span class="line"></span><br><span class="line">env.execute();</span><br></pre></td></tr></table></figure><h4 id="5ã€æŸ¥è¯¢è½¬æ¢"><a href="#5ã€æŸ¥è¯¢è½¬æ¢" class="headerlink" title="5ã€æŸ¥è¯¢è½¬æ¢"></a>5ã€æŸ¥è¯¢è½¬æ¢</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">/ <span class="number">3</span> æŸ¥è¯¢è½¬æ¢</span><br><span class="line"><span class="comment">// 3.1 Table API</span></span><br><span class="line"><span class="comment">// ç®€å•è½¬æ¢</span></span><br><span class="line">Table resultTable = inputTable.select(<span class="string">&quot;id,temperature&quot;</span>)</span><br><span class="line">        .filter(<span class="string">&quot;id = &#x27;sensor_6&#x27;&quot;</span>);</span><br><span class="line"><span class="comment">// èšåˆç»Ÿè®¡</span></span><br><span class="line">Table aggTable = inputTable.groupBy(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">        .select(<span class="string">&quot;id,id.count as count,temperature.avg as avgTemp&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.2 SQL</span></span><br><span class="line">Table sqlTable = tableEnv.sqlQuery(<span class="string">&quot;select id,temperature from inputTable where id = &#x27;sensor_6&#x27;&quot;</span>);</span><br><span class="line">Table sqlQuery = tableEnv.sqlQuery(<span class="string">&quot;select id,count(id) as cnt,avg(temperature) as avgTemp from inputTable group by id&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°è¾“å‡º</span></span><br><span class="line">tableEnv.toAppendStream(resultTable,Row.class).print(<span class="string">&quot;resultTable&quot;</span>);</span><br><span class="line">tableEnv.toRetractStream(aggTable,Row.class).print(<span class="string">&quot;aggTable&quot;</span>);</span><br><span class="line">tableEnv.toAppendStream(sqlTable,Row.class).print(<span class="string">&quot;sqlTable&quot;</span>);</span><br><span class="line">tableEnv.toRetractStream(sqlQuery,Row.class).print(<span class="string">&quot;sqlQuery&quot;</span>);</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 4ã€è¾“å‡ºåˆ°æ–‡ä»¶</span></span><br><span class="line"><span class="comment">// è¿æ¥å¤–éƒ¨æ–‡ä»¶æ³¨å†Œè¾“å‡ºè¡¨</span></span><br><span class="line">String outputFilePath = <span class="string">&quot;D:\\Java\\project\\Flink_Java\\src\\main\\resources\\output_sensor.txt&quot;</span>;</span><br><span class="line"></span><br><span class="line"> tableEnv.connect(<span class="keyword">new</span> FileSystem().path(outputFilePath))</span><br><span class="line">                .withFormat(<span class="keyword">new</span> Csv())</span><br><span class="line">                .withSchema(<span class="keyword">new</span> Schema()</span><br><span class="line">                        .field(<span class="string">&quot;id&quot;</span>, DataTypes.STRING())</span><br><span class="line"><span class="comment">//                        .field(&quot;cnt&quot;,DataTypes.BIGINT())</span></span><br><span class="line">                        .field(<span class="string">&quot;temperature&quot;</span>, DataTypes.DOUBLE()))</span><br><span class="line">                .createTemporaryTable(<span class="string">&quot;outputTable&quot;</span>);</span><br><span class="line"></span><br><span class="line">Table outputTable = tableEnv.from(<span class="string">&quot;outputTable&quot;</span>);</span><br><span class="line">resultTable.insertInto(<span class="string">&quot;outputTable&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="6ã€Table-amp-amp-Kafka"><a href="#6ã€Table-amp-amp-Kafka" class="headerlink" title="6ã€Table&amp;&amp;Kafka"></a>6ã€Table&amp;&amp;Kafka</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 1ã€åˆ›å»ºç¯å¢ƒ</span></span><br><span class="line">        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">        env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2ã€è¿æ¥kafkaï¼Œè¯»å–æ•°æ®</span></span><br><span class="line">        tableEnv.connect(<span class="keyword">new</span> Kafka()</span><br><span class="line">                .version(<span class="string">&quot;0.11&quot;</span>)</span><br><span class="line">                .topic(<span class="string">&quot;sensor&quot;</span>)</span><br><span class="line">                .property(<span class="string">&quot;zookeeper.connect&quot;</span>, <span class="string">&quot;10.12.42.174:2181&quot;</span>)</span><br><span class="line">                .property(<span class="string">&quot;bootstrap.servers&quot;</span>, <span class="string">&quot;10.12.42.174:9092&quot;</span>))</span><br><span class="line">                .withFormat(<span class="keyword">new</span> Csv())</span><br><span class="line">                .withSchema(<span class="keyword">new</span> Schema()</span><br><span class="line">                        .field(<span class="string">&quot;id&quot;</span>, DataTypes.STRING())</span><br><span class="line">                        .field(<span class="string">&quot;timestamp&quot;</span>, DataTypes.BIGINT())</span><br><span class="line">                        .field(<span class="string">&quot;temp&quot;</span>, DataTypes.DOUBLE()))</span><br><span class="line">        .createTemporaryTable(<span class="string">&quot;inputTable&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3ã€æŸ¥è¯¢è½¬æ¢</span></span><br><span class="line">        <span class="comment">// ç®€å•è½¬æ¢</span></span><br><span class="line">        Table sensorTable = tableEnv.from(<span class="string">&quot;inputTable&quot;</span>);</span><br><span class="line">        Table resultTable = sensorTable.select(<span class="string">&quot;id,temp&quot;</span>)</span><br><span class="line">                .filter(<span class="string">&quot;id = &#x27;sensor_6&#x27;&quot;</span>);</span><br><span class="line">        <span class="comment">// èšåˆç»Ÿè®¡</span></span><br><span class="line">        Table aggTable = sensorTable.groupBy(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">                .select(<span class="string">&quot;id,id.count as count,temp.avg as avgTemp&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4ã€è¾“å‡ºåˆ°æ–‡ä»¶</span></span><br><span class="line">        <span class="comment">// è¿æ¥å¤–éƒ¨æ–‡ä»¶æ³¨å†Œè¾“å‡ºè¡¨</span></span><br><span class="line"></span><br><span class="line">        tableEnv.connect(<span class="keyword">new</span> Kafka()</span><br><span class="line">                .version(<span class="string">&quot;0.11&quot;</span>)</span><br><span class="line">                .topic(<span class="string">&quot;flink&quot;</span>)</span><br><span class="line">                .property(<span class="string">&quot;zookeeper.connect&quot;</span>, <span class="string">&quot;10.12.42.174:2181&quot;</span>)</span><br><span class="line">                .property(<span class="string">&quot;bootstrap.servers&quot;</span>, <span class="string">&quot;10.12.42.174:9092&quot;</span>))</span><br><span class="line">                .withFormat(<span class="keyword">new</span> Csv())</span><br><span class="line">                .withSchema(<span class="keyword">new</span> Schema()</span><br><span class="line">                        .field(<span class="string">&quot;id&quot;</span>, DataTypes.STRING())</span><br><span class="line"><span class="comment">//                        .field(&quot;timestamp&quot;, DataTypes.BIGINT())</span></span><br><span class="line">                        .field(<span class="string">&quot;temp&quot;</span>, DataTypes.DOUBLE()))</span><br><span class="line">                .createTemporaryTable(<span class="string">&quot;outputTable&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5ã€å†™å…¥åˆ°kafkaä¸­</span></span><br><span class="line">        resultTable.insertInto(<span class="string">&quot;outputTable&quot;</span>);</span><br><span class="line"></span><br><span class="line">        env.execute();</span><br></pre></td></tr></table></figure><h4 id="7ã€æ›´æ–°æ¨¡å¼"><a href="#7ã€æ›´æ–°æ¨¡å¼" class="headerlink" title="7ã€æ›´æ–°æ¨¡å¼"></a>7ã€æ›´æ–°æ¨¡å¼</h4><blockquote><ul><li>å¯¹äºæµå¼æŸ¥è¯¢ï¼Œéœ€è¦å£°æ˜å¦‚ä½•åœ¨è¡¨å’Œå¤–éƒ¨è¿æ¥å™¨ä¹‹é—´æ‰§è¡Œè½¬æ¢</li><li>ä¸å¤–éƒ¨ç³»ç»Ÿäº¤æ¢çš„æ¶ˆæ¯ç±»å‹ï¼Œç”±æ›´æ–°æ¨¡å¼ï¼ˆUpdate Modeï¼‰æŒ‡å®š</li></ul></blockquote><p><img src="https://file.buildworld.cn/img/20201209210053.png"></p><h4 id="8ã€è¾“å‡ºåˆ°MySQL"><a href="#8ã€è¾“å‡ºåˆ°MySQL" class="headerlink" title="8ã€è¾“å‡ºåˆ°MySQL"></a>8ã€è¾“å‡ºåˆ°MySQL</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-jdbc_2.12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.10.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">&lt;/dependency</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4ã€è¿æ¥MySQL</span></span><br><span class="line">String sinkDDL = <span class="string">&quot;create table jdbcOutputTable (&quot;</span> +</span><br><span class="line">        <span class="string">&quot; id varchar(20) not null, &quot;</span> +</span><br><span class="line">        <span class="string">&quot; avgTemp double not null &quot;</span> +</span><br><span class="line">        <span class="string">&quot;) with (&quot;</span> +</span><br><span class="line">        <span class="string">&quot; &#x27;connector.type&#x27; = &#x27;jdbc&#x27;, &quot;</span> +</span><br><span class="line">        <span class="string">&quot; &#x27;connector.url&#x27; = &#x27;jdbc:mysql://localhost:3306/flink&#x27;, &quot;</span> +</span><br><span class="line">        <span class="string">&quot; &#x27;connector.table&#x27; = &#x27;sensor_count&#x27;, &quot;</span> +</span><br><span class="line">        <span class="string">&quot; &#x27;connector.driver&#x27; = &#x27;com.mysql.jdbc.Driver&#x27;, &quot;</span> +</span><br><span class="line">        <span class="string">&quot; &#x27;connector.username&#x27; = &#x27;root&#x27;, &quot;</span> +</span><br><span class="line">        <span class="string">&quot; &#x27;connector.password&#x27; = &#x27;root&#x27; )&quot;</span>;</span><br><span class="line">tableEnv.sqlUpdate(sinkDDL);</span><br><span class="line">aggTable.insertInto(<span class="string">&quot;jdbcOutputTable&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="9ã€åŠ¨æ€è¡¨å’ŒæŒç»­æŸ¥è¯¢"><a href="#9ã€åŠ¨æ€è¡¨å’ŒæŒç»­æŸ¥è¯¢" class="headerlink" title="9ã€åŠ¨æ€è¡¨å’ŒæŒç»­æŸ¥è¯¢"></a>9ã€åŠ¨æ€è¡¨å’ŒæŒç»­æŸ¥è¯¢</h4><p><img src="https://file.buildworld.cn/img/20201211151959.png"></p><blockquote><ul><li>æµè¢«è½¬æ¢ä¸ºåŠ¨æ€è¡¨</li><li>å¯¹åŠ¨æ€è¡¨è®¡ç®—è¿ç»­æŸ¥è¯¢ï¼Œç”Ÿæˆæ–°çš„åŠ¨æ€è¡¨</li><li>ç”Ÿæˆçš„åŠ¨æ€è¡¨è¢«è½¬æ¢å›æµ</li></ul></blockquote><h4 id="10ã€Group-Windows"><a href="#10ã€Group-Windows" class="headerlink" title="10ã€Group Windows"></a>10ã€Group Windows</h4><blockquote><p>æ»šåŠ¨çª—å£ï¼ˆTumbling windowsï¼‰â€“ æ»šåŠ¨çª—å£è¦ç”¨ <code>Tumble</code> ç±»æ¥å®šä¹‰</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Tumbling Event-time Window</span></span><br><span class="line">.window(Tumble.over(<span class="string">&quot;10.minutes&quot;</span>).on(<span class="string">&quot;rowtime&quot;</span>).as(<span class="string">&quot;w&quot;</span>))</span><br><span class="line"><span class="comment">// Tumbling Processing-time Window</span></span><br><span class="line">.window( Tumble.over(<span class="string">&quot; 10.minutes &quot;</span>).on(<span class="string">&quot; proctime &quot;</span>).as(<span class="string">&quot;w&quot;</span>))</span><br><span class="line"><span class="comment">// Tumbling Row-count Window</span></span><br><span class="line">.window( Tumble.over(<span class="string">&quot; 10.rows &quot;</span>).on(<span class="string">&quot; proctime &quot;</span>).as(<span class="string">&quot;w&quot;</span>))</span><br></pre></td></tr></table></figure><blockquote><p>æ»‘åŠ¨çª—å£ï¼ˆSliding windowsï¼‰â€“ æ»‘åŠ¨çª—å£è¦ç”¨ <code>Slide</code> ç±»æ¥å®šä¹‰</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Sliding Event-time Window</span></span><br><span class="line">.window(Slide.over(<span class="string">&quot;10.minutes&quot;</span>).every(<span class="string">&quot;5.minutes&quot;</span>).on(<span class="string">&quot;rowtime&quot;</span>).as(<span class="string">&quot;w&quot;</span>))</span><br><span class="line"><span class="comment">// Sliding Processing-time window</span></span><br><span class="line">.window(Slide.over(<span class="string">&quot;10.minutes&quot;</span>).every(<span class="string">&quot;5.minutes&quot;</span>).on(<span class="string">&quot;proctime&quot;</span>).as(<span class="string">&quot;w&quot;</span>))</span><br><span class="line"><span class="comment">// Sliding Row-count window</span></span><br><span class="line">.window(Slide.over(<span class="string">&quot;10.rows&quot;</span>).every(<span class="string">&quot;5.rows&quot;</span>).on(<span class="string">&quot;proctime&quot;</span>).as(<span class="string">&quot;w&quot;</span>))</span><br></pre></td></tr></table></figure><h4 id="11ã€è‡ªå®šä¹‰UDF"><a href="#11ã€è‡ªå®šä¹‰UDF" class="headerlink" title="11ã€è‡ªå®šä¹‰UDF"></a>11ã€è‡ªå®šä¹‰UDF</h4><h5 id="æ ‡é‡å‡½æ•°ï¼ˆScalar-Functionsï¼‰"><a href="#æ ‡é‡å‡½æ•°ï¼ˆScalar-Functionsï¼‰" class="headerlink" title="æ ‡é‡å‡½æ•°ï¼ˆScalar Functionsï¼‰"></a>æ ‡é‡å‡½æ•°ï¼ˆScalar Functionsï¼‰</h5><blockquote><p>â€¢ ç”¨æˆ·å®šä¹‰çš„æ ‡é‡å‡½æ•°ï¼Œå¯ä»¥å°†0ã€1æˆ–å¤šä¸ªæ ‡é‡å€¼ï¼Œæ˜ å°„åˆ°æ–°çš„æ ‡é‡å€¼<br>â€¢ ä¸ºäº†å®šä¹‰æ ‡é‡å‡½æ•°ï¼Œå¿…é¡»åœ¨ <code>org.apache.flink.table.functions</code> ä¸­æ‰©å±•åŸºç±»<code>ScalarFunction</code>ï¼Œå¹¶å®ç°ï¼ˆä¸€ä¸ªæˆ–å¤šä¸ªï¼‰æ±‚å€¼ï¼ˆevalï¼‰æ–¹æ³•<br>â€¢ æ ‡é‡å‡½æ•°çš„è¡Œä¸ºç”±æ±‚å€¼æ–¹æ³•å†³å®šï¼Œæ±‚å€¼æ–¹æ³•å¿…é¡»å…¬å¼€å£°æ˜å¹¶å‘½åä¸º <code>eval</code></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScalarFunctionTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 1ã€åˆ›å»ºç¯å¢ƒ</span></span><br><span class="line">        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">        env.setParallelism(<span class="number">1</span>);</span><br><span class="line">        env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);</span><br><span class="line"></span><br><span class="line">        StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2ã€è¡¨çš„åˆ›å»ºï¼šè¿æ¥å¤–éƒ¨ç³»ç»Ÿï¼Œè¯»å–æ•°æ®</span></span><br><span class="line">        <span class="comment">// 2.1 è¯»å–æ–‡ä»¶</span></span><br><span class="line">        String filePath = <span class="string">&quot;D:\\Java\\project\\Flink_Java\\src\\main\\resources\\sensor.txt&quot;</span>;</span><br><span class="line">        DataStream&lt;String&gt; inputStream = env.readTextFile(filePath);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. è½¬æ¢æˆPOJO</span></span><br><span class="line">        DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">            String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">        &#125;)</span><br><span class="line">                .assignTimestampsAndWatermarks(<span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;SensorReading&gt;(Time.seconds(<span class="number">2</span>)) &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(SensorReading element)</span> </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4ã€å°†æµè½¬æ¢ä¸ºè¡¨</span></span><br><span class="line">        Table sensorTable = tableEnv.fromDataStream(dataStream, <span class="string">&quot;id,timestamp as ts,temperature as temp&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è‡ªå®šä¹‰æ ‡é‡å‡½æ•°ï¼Œå®ç°æ±‚idçš„hashå€¼</span></span><br><span class="line">        <span class="comment">// 4.1 table API</span></span><br><span class="line">        HashCode hashCode = <span class="keyword">new</span> HashCode(<span class="number">21</span>);</span><br><span class="line">        <span class="comment">// éœ€è¦åœ¨ç¯å¢ƒä¸­æ³¨å†ŒUDF</span></span><br><span class="line">        tableEnv.registerFunction(<span class="string">&quot;hashCode&quot;</span>,hashCode);</span><br><span class="line">        Table resultTable = sensorTable.select(<span class="string">&quot;id,ts,hashCode(id)&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.2 SQL</span></span><br><span class="line">        tableEnv.createTemporaryView(<span class="string">&quot;sensor&quot;</span>,sensorTable);</span><br><span class="line">        Table resultSqlTable = tableEnv.sqlQuery(<span class="string">&quot;select id,ts,hashCode(id) from sensor&quot;</span>);</span><br><span class="line"></span><br><span class="line">        tableEnv.toAppendStream(resultTable, Row.class).print(<span class="string">&quot;resultTable&quot;</span>);</span><br><span class="line">        tableEnv.toRetractStream(resultSqlTable, Row.class).print(<span class="string">&quot;resultSqlTable&quot;</span>);</span><br><span class="line"></span><br><span class="line">        env.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ç°è‡ªå®šä¹‰çš„ScalarFunction</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">HashCode</span> <span class="keyword">extends</span> <span class="title">ScalarFunction</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> factor = <span class="number">13</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">HashCode</span><span class="params">(<span class="keyword">int</span> factor)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.factor = factor;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">eval</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> s.hashCode() * factor;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="è¡¨å‡½æ•°ï¼ˆTable-Functionsï¼‰"><a href="#è¡¨å‡½æ•°ï¼ˆTable-Functionsï¼‰" class="headerlink" title="è¡¨å‡½æ•°ï¼ˆTable Functionsï¼‰"></a>è¡¨å‡½æ•°ï¼ˆTable Functionsï¼‰</h5><blockquote><p>â€¢ ç”¨æˆ·å®šä¹‰çš„è¡¨å‡½æ•°ï¼Œä¹Ÿå¯ä»¥å°†0ã€1æˆ–å¤šä¸ªæ ‡é‡å€¼ä½œä¸ºè¾“å…¥å‚æ•°ï¼›ä¸æ ‡é‡å‡½æ•°ä¸åŒçš„æ˜¯ï¼Œå®ƒå¯ä»¥è¿”å›ä»»æ„æ•°é‡çš„è¡Œä½œä¸ºè¾“å‡ºï¼Œè€Œä¸æ˜¯å•ä¸ªå€¼<br>â€¢ ä¸ºäº†å®šä¹‰ä¸€ä¸ªè¡¨å‡½æ•°ï¼Œå¿…é¡»æ‰©å±• <code>org.apache.flink.table.functions</code> ä¸­çš„åŸºç±»<code>TableFunction</code> å¹¶å®ç°ï¼ˆä¸€ä¸ªæˆ–å¤šä¸ªï¼‰æ±‚å€¼æ–¹æ³•<br>â€¢ è¡¨å‡½æ•°çš„è¡Œä¸ºç”±å…¶æ±‚å€¼æ–¹æ³•å†³å®šï¼Œæ±‚å€¼æ–¹æ³•å¿…é¡»æ˜¯ <code>public</code> çš„ï¼Œå¹¶å‘½åä¸º <code>eval</code></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    <span class="comment">// å®ç°è‡ªå®šä¹‰TableFunction</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Split</span> <span class="keyword">extends</span> <span class="title">TableFunction</span>&lt;<span class="title">Tuple2</span>&lt;<span class="title">String</span>, <span class="title">Integer</span>&gt;&gt;</span>&#123;</span><br><span class="line">        <span class="comment">// å®šä¹‰å±æ€§ï¼Œåˆ†éš”ç¬¦</span></span><br><span class="line">        <span class="keyword">private</span> String separator = <span class="string">&quot;,&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Split</span><span class="params">(String separator)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.separator = separator;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¿…é¡»å®ç°ä¸€ä¸ªevalæ–¹æ³•ï¼Œæ²¡æœ‰è¿”å›å€¼</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eval</span><span class="params">( String str )</span></span>&#123;</span><br><span class="line">            <span class="keyword">for</span>( String s: str.split(separator) )&#123;</span><br><span class="line">                collect(<span class="keyword">new</span> Tuple2&lt;&gt;(s, s.length()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line"><span class="comment">// 4. è‡ªå®šä¹‰è¡¨å‡½æ•°ï¼Œå®ç°å°†idæ‹†åˆ†ï¼Œå¹¶è¾“å‡ºï¼ˆword, lengthï¼‰</span></span><br><span class="line">        <span class="comment">// 4.1 table API</span></span><br><span class="line">        Split split = <span class="keyword">new</span> Split(<span class="string">&quot;_&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éœ€è¦åœ¨ç¯å¢ƒä¸­æ³¨å†ŒUDF</span></span><br><span class="line">        tableEnv.registerFunction(<span class="string">&quot;split&quot;</span>, split);</span><br><span class="line">        Table resultTable = sensorTable</span><br><span class="line">                .joinLateral(<span class="string">&quot;split(id) as (word, length)&quot;</span>)</span><br><span class="line">                .select(<span class="string">&quot;id, ts, word, length&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.2 SQL</span></span><br><span class="line">        tableEnv.createTemporaryView(<span class="string">&quot;sensor&quot;</span>, sensorTable);</span><br><span class="line">        Table resultSqlTable = tableEnv.sqlQuery(<span class="string">&quot;select id, ts, word, length &quot;</span> +</span><br><span class="line">                <span class="string">&quot; from sensor, lateral table(split(id)) as splitid(word, length)&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="èšåˆå‡½æ•°ï¼ˆAggregate-Functionsï¼‰"><a href="#èšåˆå‡½æ•°ï¼ˆAggregate-Functionsï¼‰" class="headerlink" title="èšåˆå‡½æ•°ï¼ˆAggregate Functionsï¼‰"></a>èšåˆå‡½æ•°ï¼ˆAggregate Functionsï¼‰</h5><blockquote><p><strong>AggregateFunction çš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š</strong></p><p>é¦–å…ˆï¼Œå®ƒéœ€è¦ä¸€ä¸ªç´¯åŠ å™¨ï¼ˆAccumulatorï¼‰ï¼Œç”¨æ¥ä¿å­˜èšåˆä¸­é—´ç»“æœçš„æ•°æ®ç»“æ„ï¼›å¯ä»¥é€šè¿‡è°ƒç”¨ createAccumulator() æ–¹æ³•åˆ›å»ºç©ºç´¯åŠ å™¨<br>éšåï¼Œå¯¹æ¯ä¸ªè¾“å…¥è¡Œè°ƒç”¨å‡½æ•°çš„ accumulate() æ–¹æ³•æ¥æ›´æ–°ç´¯åŠ å™¨<br>å¤„ç†å®Œæ‰€æœ‰è¡Œåï¼Œå°†è°ƒç”¨å‡½æ•°çš„ getValue() æ–¹æ³•æ¥è®¡ç®—å¹¶è¿”å›æœ€ç»ˆç»“æœ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// å®ç°è‡ªå®šä¹‰çš„AggregateFunction</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AvgTemp</span> <span class="keyword">extends</span> <span class="title">AggregateFunction</span>&lt;<span class="title">Double</span>, <span class="title">Tuple2</span>&lt;<span class="title">Double</span>, <span class="title">Integer</span>&gt;&gt;</span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Double <span class="title">getValue</span><span class="params">(Tuple2&lt;Double, Integer&gt; accumulator)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> accumulator.f0 / accumulator.f1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Tuple2&lt;Double, Integer&gt; <span class="title">createAccumulator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(<span class="number">0.0</span>, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¿…é¡»å®ç°ä¸€ä¸ªaccumulateæ–¹æ³•ï¼Œæ¥æ•°æ®ä¹‹åæ›´æ–°çŠ¶æ€</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accumulate</span><span class="params">( Tuple2&lt;Double, Integer&gt; accumulator, Double temp )</span></span>&#123;</span><br><span class="line">            accumulator.f0 += temp;</span><br><span class="line">            accumulator.f1 += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line">        <span class="comment">// 4. è‡ªå®šä¹‰èšåˆå‡½æ•°ï¼Œæ±‚å½“å‰ä¼ æ„Ÿå™¨çš„å¹³å‡æ¸©åº¦å€¼</span></span><br><span class="line">        <span class="comment">// 4.1 table API</span></span><br><span class="line">        AvgTemp avgTemp = <span class="keyword">new</span> AvgTemp();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éœ€è¦åœ¨ç¯å¢ƒä¸­æ³¨å†ŒUDF</span></span><br><span class="line">        tableEnv.registerFunction(<span class="string">&quot;avgTemp&quot;</span>, avgTemp);</span><br><span class="line">        Table resultTable = sensorTable</span><br><span class="line">                .groupBy(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">                .aggregate( <span class="string">&quot;avgTemp(temp) as avgtemp&quot;</span> )</span><br><span class="line">                .select(<span class="string">&quot;id, avgtemp&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="è¡¨èšåˆå‡½æ•°ï¼ˆTable-Aggregate-Functionsï¼‰"><a href="#è¡¨èšåˆå‡½æ•°ï¼ˆTable-Aggregate-Functionsï¼‰" class="headerlink" title="è¡¨èšåˆå‡½æ•°ï¼ˆTable Aggregate Functionsï¼‰"></a>è¡¨èšåˆå‡½æ•°ï¼ˆTable Aggregate Functionsï¼‰</h5><blockquote><p><strong>TableAggregateFunction çš„å·¥ä½œåŸç†å¦‚ä¸‹:</strong><br>â€“ é¦–å…ˆï¼Œå®ƒåŒæ ·éœ€è¦ä¸€ä¸ªç´¯åŠ å™¨ï¼ˆAccumulatorï¼‰ï¼Œå®ƒæ˜¯ä¿å­˜èšåˆä¸­é—´ç»“æœçš„æ•°æ®ç»“æ„ã€‚é€šè¿‡è°ƒç”¨ createAccumulator() æ–¹æ³•å¯ä»¥åˆ›å»ºç©ºç´¯åŠ å™¨ã€‚<br>â€“ éšåï¼Œå¯¹æ¯ä¸ªè¾“å…¥è¡Œè°ƒç”¨å‡½æ•°çš„ accumulate() æ–¹æ³•æ¥æ›´æ–°ç´¯åŠ å™¨ã€‚<br>â€“ å¤„ç†å®Œæ‰€æœ‰è¡Œåï¼Œå°†è°ƒç”¨å‡½æ•°çš„ emitValue() æ–¹æ³•æ¥è®¡ç®—å¹¶è¿”å›æœ€ç»ˆç»“æœã€‚</p></blockquote>]]></content>
    
    
    <summary type="html">Apache FlinkÂ® â€” Stateful Computations over Data Streams.</summary>
    
    
    
    <category term="BigData" scheme="https://www.buildworld.cn/categories/BigData/"/>
    
    
    <category term="Apache" scheme="https://www.buildworld.cn/tags/Apache/"/>
    
    <category term="Flink" scheme="https://www.buildworld.cn/tags/Flink/"/>
    
  </entry>
  
  <entry>
    <title>BigData--å¤§æ•°æ®æŠ€æœ¯ä¹‹Sparkæœºå™¨å­¦ä¹ åº“MLLib</title>
    <link href="https://www.buildworld.cn/2020/09/09/BigData-%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8BSpark%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%BA%93MLLib/"/>
    <id>https://www.buildworld.cn/2020/09/09/BigData-%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8BSpark%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%BA%93MLLib/</id>
    <published>2020-09-09T03:58:07.000Z</published>
    <updated>2021-04-09T02:17:19.979Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><blockquote><p>MLlib fits into Sparkâ€™s APIs and interoperates with NumPy in Python (as of Spark 0.9) and R libraries (as of Spark 1.5). You can use any Hadoop data source (e.g. HDFS, HBase, or local files), making it easy to plug into Hadoop workflows.</p></blockquote><h3 id="1ã€Spark-MLibä»‹ç»"><a href="#1ã€Spark-MLibä»‹ç»" class="headerlink" title="1ã€Spark MLibä»‹ç»"></a>1ã€Spark MLibä»‹ç»</h3><blockquote><ul><li>MLlib æ˜¯ Spark çš„æœºå™¨å­¦ä¹ åº“ï¼Œæ—¨åœ¨ç®€åŒ–æœºå™¨å­¦ä¹ çš„å·¥ç¨‹å®è·µå·¥ä½œï¼Œå¹¶æ–¹ä¾¿æ‰©å±•åˆ°æ›´å¤§è§„æ¨¡ã€‚</li><li>MLlib ç”±ä¸€äº›é€šç”¨çš„å­¦ä¹ ç®—æ³•å’Œå·¥å…·ç»„æˆï¼ŒåŒ…æ‹¬åˆ†ç±»ã€å›å½’ã€èšç±»ã€ååŒè¿‡æ»¤ã€é™ç»´ç­‰ï¼ŒåŒæ—¶è¿˜åŒ…æ‹¬åº•å±‚çš„ä¼˜åŒ–åŸè¯­å’Œé«˜å±‚çš„ç®¡é“ APIã€‚</li></ul></blockquote><table><thead><tr><th>åç§°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æ•°æ®ç±»å‹</td><td>å‘é‡ã€å¸¦ç±»åˆ«çš„å‘é‡ã€çŸ©é˜µç­‰</td></tr><tr><td>æ•°å­¦ç»Ÿè®¡è®¡ç®—åº“</td><td>åŸºæœ¬ç»Ÿè®¡é‡ã€ç›¸å…³åˆ†æã€éšæœºæ•°äº§ç”Ÿå™¨ã€å‡è®¾æ£€éªŒç­‰</td></tr><tr><td>ç®—æ³•è¯„æµ‹</td><td>AUCã€å‡†ç¡®ç‡ã€å¬å›ç‡ã€F-Measure ç­‰</td></tr><tr><td>æœºå™¨å­¦ä¹ ç®—æ³•</td><td>åˆ†ç±»ç®—æ³•ã€å›å½’ç®—æ³•ã€èšç±»ç®—æ³•ã€ååŒè¿‡æ»¤ç­‰</td></tr></tbody></table><blockquote><p><strong>Spark æœºå™¨å­¦ä¹ åº“ä» 1.2 ç‰ˆæœ¬ä»¥åè¢«åˆ†ä¸ºä¸¤ä¸ªåŒ…ï¼š</strong></p><ul><li><code>spark.mllib </code>åŒ…å«åŸºäºRDDçš„åŸå§‹ç®—æ³•APIã€‚Spark MLlib å†å²æ¯”è¾ƒé•¿ï¼Œåœ¨1.0 ä»¥å‰çš„ç‰ˆæœ¬å³å·²ç»åŒ…å«äº†ï¼Œæä¾›çš„ç®—æ³•å®ç°éƒ½æ˜¯åŸºäºåŸå§‹çš„ RDDã€‚</li><li><a href="http://spark.apache.org/docs/latest/ml-guide.html"><code>spark.ml</code></a> åˆ™æä¾›äº†åŸºäº<a href="http://spark.apache.org/docs/latest/sql-programming-guide.html#dataframes">DataFrames</a> é«˜å±‚æ¬¡çš„APIï¼Œå¯ä»¥ç”¨æ¥æ„å»ºæœºå™¨å­¦ä¹ å·¥ä½œæµï¼ˆ<code>PipeLine</code>ï¼‰ã€‚<code>ML Pipeline</code> å¼¥è¡¥äº†åŸå§‹ MLlib åº“çš„ä¸è¶³ï¼Œå‘ç”¨æˆ·æä¾›äº†ä¸€ä¸ªåŸºäº DataFrame çš„æœºå™¨å­¦ä¹ å·¥ä½œæµå¼ API å¥—ä»¶ã€‚</li></ul></blockquote><pre><code>#### ç›®å‰MLlibæ”¯æŒçš„ä¸»è¦çš„æœºå™¨å­¦ä¹ ç®—æ³•</code></pre><p><img src="https://file.buildworld.cn/img/20200909141502.png"></p><h3 id="2ã€ä½¿ç”¨"><a href="#2ã€ä½¿ç”¨" class="headerlink" title="2ã€ä½¿ç”¨"></a>2ã€ä½¿ç”¨</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.spark/spark-mllib --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-mllib_2.12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><ul><li><code>DataFrame</code>ï¼šä½¿ç”¨Spark SQLä¸­çš„DataFrameä½œä¸ºæ•°æ®é›†ï¼Œå®ƒå¯ä»¥å®¹çº³å„ç§æ•°æ®ç±»å‹ã€‚ è¾ƒä¹‹ RDDï¼ŒåŒ…å«äº† schema ä¿¡æ¯ï¼Œæ›´ç±»ä¼¼ä¼ ç»Ÿæ•°æ®åº“ä¸­çš„äºŒç»´è¡¨æ ¼ã€‚å®ƒè¢« ML Pipeline ç”¨æ¥å­˜å‚¨æºæ•°æ®ã€‚ä¾‹å¦‚ï¼ŒDataFrameä¸­çš„åˆ—å¯ä»¥æ˜¯å­˜å‚¨çš„æ–‡æœ¬ï¼Œç‰¹å¾å‘é‡ï¼ŒçœŸå®æ ‡ç­¾å’Œé¢„æµ‹çš„æ ‡ç­¾ç­‰ã€‚</li><li><code>Transformer</code>ï¼šç¿»è¯‘æˆè½¬æ¢å™¨ï¼Œæ˜¯ä¸€ç§å¯ä»¥å°†ä¸€ä¸ªDataFrameè½¬æ¢ä¸ºå¦ä¸€ä¸ªDataFrameçš„ç®—æ³•ã€‚æ¯”å¦‚ä¸€ä¸ªæ¨¡å‹å°±æ˜¯ä¸€ä¸ª Transformerã€‚å®ƒå¯ä»¥æŠŠ ä¸€ä¸ªä¸åŒ…å«é¢„æµ‹æ ‡ç­¾çš„æµ‹è¯•æ•°æ®é›† DataFrame æ‰“ä¸Šæ ‡ç­¾ï¼Œè½¬åŒ–æˆå¦ä¸€ä¸ªåŒ…å«é¢„æµ‹æ ‡ç­¾çš„ DataFrameã€‚æŠ€æœ¯ä¸Šï¼ŒTransformerå®ç°äº†ä¸€ä¸ªæ–¹æ³•transformï¼ˆï¼‰ï¼Œå®ƒé€šè¿‡é™„åŠ ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—å°†ä¸€ä¸ªDataFrameè½¬æ¢ä¸ºå¦ä¸€ä¸ªDataFrameã€‚</li><li><code>Estimator</code>ï¼šç¿»è¯‘æˆä¼°è®¡å™¨æˆ–è¯„ä¼°å™¨ï¼Œå®ƒæ˜¯å­¦ä¹ ç®—æ³•æˆ–åœ¨è®­ç»ƒæ•°æ®ä¸Šçš„è®­ç»ƒæ–¹æ³•çš„æ¦‚å¿µæŠ½è±¡ã€‚åœ¨ Pipeline é‡Œé€šå¸¸æ˜¯è¢«ç”¨æ¥æ“ä½œ DataFrame æ•°æ®å¹¶ç”Ÿäº§ä¸€ä¸ª Transformerã€‚ä»æŠ€æœ¯ä¸Šè®²ï¼ŒEstimatorå®ç°äº†ä¸€ä¸ªæ–¹æ³•fitï¼ˆï¼‰ï¼Œå®ƒæ¥å—ä¸€ä¸ªDataFrameå¹¶äº§ç”Ÿä¸€ä¸ªè½¬æ¢å™¨ã€‚å¦‚ä¸€ä¸ªéšæœºæ£®æ—ç®—æ³•å°±æ˜¯ä¸€ä¸ª Estimatorï¼Œå®ƒå¯ä»¥è°ƒç”¨fitï¼ˆï¼‰ï¼Œé€šè¿‡è®­ç»ƒç‰¹å¾æ•°æ®è€Œå¾—åˆ°ä¸€ä¸ªéšæœºæ£®æ—æ¨¡å‹ã€‚</li><li><code>Paramete</code>rï¼šParameter è¢«ç”¨æ¥è®¾ç½® Transformer æˆ–è€… Estimator çš„å‚æ•°ã€‚ç°åœ¨ï¼Œæ‰€æœ‰è½¬æ¢å™¨å’Œä¼°è®¡å™¨å¯å…±äº«ç”¨äºæŒ‡å®šå‚æ•°çš„å…¬å…±APIã€‚ParamMapæ˜¯ä¸€ç»„ï¼ˆå‚æ•°ï¼Œå€¼ï¼‰å¯¹ã€‚</li><li><code>PipeLine</code>ï¼šç¿»è¯‘ä¸ºå·¥ä½œæµæˆ–è€…ç®¡é“ã€‚å·¥ä½œæµå°†å¤šä¸ªå·¥ä½œæµé˜¶æ®µï¼ˆè½¬æ¢å™¨å’Œä¼°è®¡å™¨ï¼‰è¿æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆæœºå™¨å­¦ä¹ çš„å·¥ä½œæµï¼Œå¹¶è·å¾—ç»“æœè¾“å‡ºã€‚</li></ul></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.buildworld.spark.ml</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.ml.&#123;<span class="type">Pipeline</span>, <span class="type">PipelineModel</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.ml.classification.<span class="type">LogisticRegression</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.ml.feature.&#123;<span class="type">HashingTF</span>, <span class="type">Tokenizer</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.&#123;<span class="type">Row</span>, <span class="type">SparkSession</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.ml.linalg.<span class="type">Vector</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">SparkMLIB_DEMO</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> spark: <span class="type">SparkSession</span> = <span class="type">SparkSession</span>.builder().master(<span class="string">&quot;local&quot;</span>).appName(<span class="string">&quot;MLib&quot;</span>).getOrCreate()</span><br><span class="line">    <span class="keyword">import</span> spark.implicits._</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¼•å…¥è¦åŒ…å«çš„åŒ…å¹¶æ„å»ºè®­ç»ƒæ•°æ®é›†</span></span><br><span class="line">    <span class="keyword">val</span> training = spark.createDataFrame(<span class="type">Seq</span>(</span><br><span class="line">      (<span class="number">0</span>L, <span class="string">&quot;a b c d e spark&quot;</span>, <span class="number">1.0</span>),</span><br><span class="line">      (<span class="number">1</span>L, <span class="string">&quot;b d&quot;</span>, <span class="number">0.0</span>),</span><br><span class="line">      (<span class="number">2</span>L, <span class="string">&quot;spark f g h&quot;</span>, <span class="number">1.0</span>),</span><br><span class="line">      (<span class="number">3</span>L, <span class="string">&quot;hadoop mapreduce&quot;</span>, <span class="number">0.0</span>)</span><br><span class="line">    )).toDF(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;text&quot;</span>, <span class="string">&quot;label&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> tokenizer: <span class="type">Tokenizer</span> = <span class="keyword">new</span> <span class="type">Tokenizer</span>()</span><br><span class="line">      .setInputCol(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">      .setOutputCol(<span class="string">&quot;words&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> hashingTF: <span class="type">HashingTF</span> = <span class="keyword">new</span> <span class="type">HashingTF</span>()</span><br><span class="line">      .setNumFeatures(<span class="number">1000</span>)</span><br><span class="line">      .setInputCol(tokenizer.getInputCol)</span><br><span class="line">      .setOutputCol(<span class="string">&quot;features&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> lr: <span class="type">LogisticRegression</span> = <span class="keyword">new</span> <span class="type">LogisticRegression</span>()</span><br><span class="line">      .setMaxIter(<span class="number">10</span>)</span><br><span class="line">      .setRegParam(<span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç…§å…·ä½“çš„å¤„ç†é€»è¾‘æœ‰åºçš„ç»„ç»‡PipelineStages å¹¶åˆ›å»ºä¸€ä¸ªPipeline</span></span><br><span class="line">    <span class="keyword">val</span> pipeline: <span class="type">Pipeline</span> = <span class="keyword">new</span> <span class="type">Pipeline</span>().setStages(<span class="type">Array</span>(tokenizer, hashingTF, lr))</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç°åœ¨æ„å»ºçš„Pipelineæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªEstimatorï¼Œåœ¨å®ƒçš„fitï¼ˆï¼‰æ–¹æ³•è¿è¡Œä¹‹åï¼Œå®ƒå°†äº§ç”Ÿä¸€ä¸ªPipelineModelï¼Œå®ƒæ˜¯ä¸€ä¸ªTransformerã€‚</span></span><br><span class="line">    <span class="keyword">val</span> model: <span class="type">PipelineModel</span> = pipeline.fit(training)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ„å»ºæµ‹è¯•æ•°æ®</span></span><br><span class="line">    <span class="keyword">val</span> test = spark.createDataFrame(<span class="type">Seq</span>(</span><br><span class="line">      (<span class="number">4</span>L, <span class="string">&quot;spark i j k&quot;</span>),</span><br><span class="line">      (<span class="number">5</span>L, <span class="string">&quot;l m n&quot;</span>),</span><br><span class="line">      (<span class="number">6</span>L, <span class="string">&quot;spark a&quot;</span>),</span><br><span class="line">      (<span class="number">7</span>L, <span class="string">&quot;apache hadoop&quot;</span>)</span><br><span class="line">    )).toDF(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;text&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è°ƒç”¨æˆ‘ä»¬è®­ç»ƒå¥½çš„PipelineModelçš„transformï¼ˆï¼‰æ–¹æ³•ï¼Œè®©æµ‹è¯•æ•°æ®æŒ‰é¡ºåºé€šè¿‡æ‹Ÿåˆçš„å·¥ä½œæµï¼Œç”Ÿæˆæˆ‘ä»¬æ‰€éœ€è¦çš„é¢„æµ‹ç»“æœã€‚</span></span><br><span class="line">    model.transform(test).select(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;text&quot;</span>, <span class="string">&quot;probability&quot;</span>, <span class="string">&quot;prediction&quot;</span>).collect().foreach &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="type">Row</span>(id: <span class="type">Long</span>, text: <span class="type">String</span>, prob: <span class="type">Vector</span>, prediction: <span class="type">Double</span>) =&gt;</span><br><span class="line">        println(<span class="string">s&quot;(<span class="subst">$id</span>, <span class="subst">$text</span>) --&gt; prob=<span class="subst">$prob</span>, prediction=<span class="subst">$prediction</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="å…ˆæŒ–ä¸ªå‘ï¼Œåé¢æœ‰æœºä¼šå†æ¥å­¦ä¹ "><a href="#å…ˆæŒ–ä¸ªå‘ï¼Œåé¢æœ‰æœºä¼šå†æ¥å­¦ä¹ " class="headerlink" title="å…ˆæŒ–ä¸ªå‘ï¼Œåé¢æœ‰æœºä¼šå†æ¥å­¦ä¹ "></a>å…ˆæŒ–ä¸ªå‘ï¼Œåé¢æœ‰æœºä¼šå†æ¥å­¦ä¹ </h3>]]></content>
    
    
    <summary type="html">MLlib is Apache Spark&#39;s scalable machine learning library.</summary>
    
    
    
    <category term="BigData" scheme="https://www.buildworld.cn/categories/BigData/"/>
    
    
    <category term="Spark" scheme="https://www.buildworld.cn/tags/Spark/"/>
    
    <category term="MLlib" scheme="https://www.buildworld.cn/tags/MLlib/"/>
    
  </entry>
  
  <entry>
    <title>BigData--å¤§æ•°æ®æŠ€æœ¯ä¹‹SparkStreaming</title>
    <link href="https://www.buildworld.cn/2020/09/07/BigData-%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8BSparkStreaming/"/>
    <id>https://www.buildworld.cn/2020/09/07/BigData-%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8BSparkStreaming/</id>
    <published>2020-09-07T02:31:19.000Z</published>
    <updated>2021-04-09T02:17:29.254Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><blockquote><p>Spark Streamingç”¨äºæµå¼æ•°æ®çš„å¤„ç†ã€‚Spark Streamingæ”¯æŒçš„æ•°æ®è¾“å…¥æºå¾ˆå¤šï¼Œä¾‹å¦‚ï¼šKafkaã€Flumeã€Twitterã€ZeroMQå’Œç®€å•çš„TCPå¥—æ¥å­—ç­‰ç­‰ã€‚æ•°æ®è¾“å…¥åå¯ä»¥ç”¨Sparkçš„é«˜åº¦æŠ½è±¡åŸè¯­å¦‚ï¼šmapã€reduceã€joinã€windowç­‰è¿›è¡Œè¿ç®—ã€‚è€Œç»“æœä¹Ÿèƒ½ä¿å­˜åœ¨å¾ˆå¤šåœ°æ–¹ï¼Œå¦‚HDFSï¼Œæ•°æ®åº“ç­‰ã€‚</p></blockquote><p><img src="https://file.buildworld.cn/img/20200906163217.png"></p><h3 id="1ã€SparkStreamingæ¶æ„"><a href="#1ã€SparkStreamingæ¶æ„" class="headerlink" title="1ã€SparkStreamingæ¶æ„"></a>1ã€SparkStreamingæ¶æ„</h3><p><img src="https://file.buildworld.cn/img/20200907215002.png" alt="SparkStreamingæ¶æ„"></p><h4 id="ä¾èµ–ï¼ˆé‡‡ç”¨scala-2-12-xç‰ˆæœ¬ï¼‰"><a href="#ä¾èµ–ï¼ˆé‡‡ç”¨scala-2-12-xç‰ˆæœ¬ï¼‰" class="headerlink" title="ä¾èµ–ï¼ˆé‡‡ç”¨scala 2.12.xç‰ˆæœ¬ï¼‰"></a>ä¾èµ–ï¼ˆé‡‡ç”¨scala 2.12.xç‰ˆæœ¬ï¼‰</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-core_2.12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-sql_2.12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-streaming_2.12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-streaming-kafka-0-10_2.12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kafka-clients<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.11.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2ã€WordCountæ¡ˆä¾‹å®æ“"><a href="#2ã€WordCountæ¡ˆä¾‹å®æ“" class="headerlink" title="2ã€WordCountæ¡ˆä¾‹å®æ“"></a>2ã€WordCountæ¡ˆä¾‹å®æ“</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.buildworld.spark.streaming</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkConf</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming.&#123;<span class="type">Seconds</span>, <span class="type">StreamingContext</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">WordCount</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨SparkStreamingå®ŒæˆWordCount</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sparké…ç½®å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">val</span> sparkConf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">&quot;local[*]&quot;</span>).setAppName(<span class="string">&quot;WordCount&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®æ—¶æ•°æ®åˆ†æç¯å¢ƒå¯¹è±¡</span></span><br><span class="line">    <span class="comment">//é‡‡é›†å‘¨æœŸï¼šä»¥æŒ‡å®šçš„æ—¶é—´ä¸ºå‘¨æœŸé‡‡é›†å®æ—¶æ•°æ®</span></span><br><span class="line">    <span class="keyword">val</span> streamingContext = <span class="keyword">new</span> <span class="type">StreamingContext</span>(sparkConf, <span class="type">Seconds</span>(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä»æŒ‡å®šçš„ç«¯å£ä¸­é‡‡é›†æ•°æ®</span></span><br><span class="line">    <span class="keyword">val</span> socketLineDStream = streamingContext.socketTextStream(<span class="string">&quot;hadoop102&quot;</span>, <span class="number">9999</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°†é‡‡é›†çš„ä¹¦ç±è¿›è¡Œåˆ†è§£ï¼Œæ‰å¹³åŒ–</span></span><br><span class="line">    <span class="keyword">val</span> wordDStream = socketLineDStream.flatMap(line =&gt; line.split(<span class="string">&quot; &quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°†æ•°æ®è¿›è¡Œç»“æ„çš„è½¬æ¢ï¼Œæ–¹ä¾¿ç»Ÿè®¡åˆ†æ</span></span><br><span class="line">    <span class="keyword">val</span> mapDStream = wordDStream.map((_, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°†è½¬æ¢ç»“æ„ä¹‹åçš„æ•°æ®è¿›è¡Œèšåˆå¤„ç†</span></span><br><span class="line">    <span class="keyword">val</span> wordToSumDStream = mapDStream.reduceByKey(_ + _)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°†ç»“æœæ‰“å°å‡ºæ¥</span></span><br><span class="line">    wordToSumDStream.print()</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¯åŠ¨é‡‡é›†å™¨</span></span><br><span class="line">    streamingContext.start()</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Driverç­‰å¾…é‡‡é›†å™¨çš„æ‰§è¡Œ</span></span><br><span class="line">    streamingContext.awaitTermination()</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€è‡ªå®šä¹‰æ•°æ®æº"><a href="#3ã€è‡ªå®šä¹‰æ•°æ®æº" class="headerlink" title="3ã€è‡ªå®šä¹‰æ•°æ®æº"></a>3ã€è‡ªå®šä¹‰æ•°æ®æº</h3><blockquote><p>é™¤äº†å¯ä»¥ä»socketä¸­è¯»å–æ•°æ®ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä»mysqlä¸­è¯»å–æ•°æ®ï¼Œå…·ä½“çœ‹è‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚</p></blockquote><h4 id="1ï¼‰å£°æ˜é‡‡é›†å™¨"><a href="#1ï¼‰å£°æ˜é‡‡é›†å™¨" class="headerlink" title="1ï¼‰å£°æ˜é‡‡é›†å™¨"></a>1ï¼‰å£°æ˜é‡‡é›†å™¨</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å£°æ˜é‡‡é›†å™¨</span></span><br><span class="line"><span class="comment">// 1) ç»§æ‰¿Receiver</span></span><br><span class="line"><span class="comment">// 2) é‡å†™onStart,onStopæ–¹æ³•</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyReceiver</span>(<span class="params">host: <span class="type">String</span>, port: <span class="type">Int</span></span>) <span class="keyword">extends</span> <span class="title">Receiver</span>[<span class="type">String</span>](<span class="params"><span class="type">StorageLevel</span>.<span class="type">MEMORY_ONLY</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> socket: <span class="type">Socket</span> = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">receive</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    socket = <span class="keyword">new</span> <span class="type">Socket</span>(host, port)</span><br><span class="line">    <span class="keyword">val</span> reader = <span class="keyword">new</span> <span class="type">BufferedReader</span>(<span class="keyword">new</span> <span class="type">InputStreamReader</span>(socket.getInputStream, <span class="string">&quot;UTF-8&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> line: <span class="type">String</span> = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">//å°†é‡‡é›†çš„æ•°æ®å­˜å‚¨åˆ°é‡‡é›†å™¨çš„å†…éƒ¨è¿›è¡Œè½¬æ¢</span></span><br><span class="line">      <span class="keyword">this</span>.store(line)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">onStart</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="type">Thread</span>(<span class="keyword">new</span> <span class="type">Runnable</span> &#123;</span><br><span class="line">      <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">run</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">        receive()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;).start()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">onStop</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    socket.close()</span><br><span class="line">    socket = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2ï¼‰ä½¿ç”¨è‡ªå®šä¹‰çš„é‡‡é›†å™¨"><a href="#2ï¼‰ä½¿ç”¨è‡ªå®šä¹‰çš„é‡‡é›†å™¨" class="headerlink" title="2ï¼‰ä½¿ç”¨è‡ªå®šä¹‰çš„é‡‡é›†å™¨"></a>2ï¼‰ä½¿ç”¨è‡ªå®šä¹‰çš„é‡‡é›†å™¨</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä»æŒ‡å®šçš„ç«¯å£ä¸­é‡‡é›†æ•°æ®</span></span><br><span class="line"><span class="keyword">val</span> receiverStream = streamingContext.receiverStream(<span class="keyword">new</span> <span class="type">MyReceiver</span>(<span class="string">&quot;hadoop102&quot;</span>, <span class="number">9999</span>))</span><br></pre></td></tr></table></figure><h3 id="4ã€Kafkaæ•°æ®æºï¼ˆç‰ˆæœ¬kafka0-11-xï¼‰"><a href="#4ã€Kafkaæ•°æ®æºï¼ˆç‰ˆæœ¬kafka0-11-xï¼‰" class="headerlink" title="4ã€Kafkaæ•°æ®æºï¼ˆç‰ˆæœ¬kafka0.11.xï¼‰"></a>4ã€Kafkaæ•°æ®æºï¼ˆç‰ˆæœ¬kafka0.11.xï¼‰</h3><blockquote><p>ä¸¤ä¸ªç‰ˆæœ¬çš„ä»£ç ä¸å¤ªä¸€æ ·ï¼š</p><p>sparkå®˜ç½‘kafka0.10ç‰ˆæœ¬æ ·ä¾‹ï¼š<a href="http://spark.apache.org/docs/2.3.0/streaming-kafka-0-10-integration.html">http://spark.apache.org/docs/2.3.0/streaming-kafka-0-10-integration.html</a></p><p>sparkå®˜ç½‘kafka0.8.xç‰ˆæœ¬æ ·ä¾‹ï¼š<a href="http://spark.apache.org/docs/2.3.0/streaming-kafka-0-8-integration.html">http://spark.apache.org/docs/2.3.0/streaming-kafka-0-8-integration.html</a></p></blockquote><p><strong>ä»¥ä¸‹ä»£ç åœ¨kafka0.11.xä¸Šé¢çš„è¿è¡Œçš„</strong></p><h4 id="æ¨¡æ‹Ÿäº§ç”Ÿæ•°æ®ï¼ˆé€šè¿‡ä»£ç è‡ªåŠ¨ç”Ÿæˆæ¶ˆæ¯ï¼‰"><a href="#æ¨¡æ‹Ÿäº§ç”Ÿæ•°æ®ï¼ˆé€šè¿‡ä»£ç è‡ªåŠ¨ç”Ÿæˆæ¶ˆæ¯ï¼‰" class="headerlink" title="æ¨¡æ‹Ÿäº§ç”Ÿæ•°æ®ï¼ˆé€šè¿‡ä»£ç è‡ªåŠ¨ç”Ÿæˆæ¶ˆæ¯ï¼‰"></a>æ¨¡æ‹Ÿäº§ç”Ÿæ•°æ®ï¼ˆé€šè¿‡ä»£ç è‡ªåŠ¨ç”Ÿæˆæ¶ˆæ¯ï¼‰</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * äº§ç”Ÿæ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">KafkaWordProducer</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// kafkaæœåŠ¡å™¨åœ°å€</span></span><br><span class="line">    <span class="keyword">val</span> brokers = <span class="string">&quot;hadoop102:9092&quot;</span></span><br><span class="line">    <span class="comment">// kafka topic</span></span><br><span class="line">    <span class="keyword">val</span> topic = <span class="string">&quot;michong&quot;</span></span><br><span class="line">    <span class="comment">// æ¯ç§’å‘é€ä¸‰æ¬¡æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">val</span> messagesPerSec = <span class="number">1</span></span><br><span class="line">    <span class="comment">// æ¯æ¬¡å‘é€äº”ä¸ªæ•°å­—</span></span><br><span class="line">    <span class="keyword">val</span> wordsPerMessage = <span class="number">5</span></span><br><span class="line">    <span class="keyword">val</span> props = <span class="keyword">new</span> util.<span class="type">HashMap</span>[<span class="type">String</span>, <span class="type">Object</span>]()</span><br><span class="line">    props.put(<span class="type">ProducerConfig</span>.<span class="type">BOOTSTRAP_SERVERS_CONFIG</span>, brokers)</span><br><span class="line">    props.put(<span class="type">ProducerConfig</span>.<span class="type">VALUE_SERIALIZER_CLASS_CONFIG</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>)</span><br><span class="line">    props.put(<span class="type">ProducerConfig</span>.<span class="type">KEY_SERIALIZER_CLASS_CONFIG</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> producer = <span class="keyword">new</span> <span class="type">KafkaProducer</span>[<span class="type">String</span>, <span class="type">String</span>](props)</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">      (<span class="number">1</span> to messagesPerSec.toInt).foreach&#123;</span><br><span class="line">        messageNum =&gt; <span class="keyword">val</span> str = (<span class="number">1</span> to wordsPerMessage.toInt).map(x =&gt; <span class="type">Random</span>.nextInt(<span class="number">30</span>).toString).mkString(<span class="string">&quot; &quot;</span>)</span><br><span class="line">          println(str)</span><br><span class="line">          <span class="keyword">val</span> message = <span class="keyword">new</span> <span class="type">ProducerRecord</span>[<span class="type">String</span>, <span class="type">String</span>](topic, <span class="literal">null</span>, str)</span><br><span class="line">          producer.send(message)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">Thread</span>.sleep(<span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="æ§åˆ¶å°ç”ŸæˆTopicä»¥åŠæ¶ˆæ¯"><a href="#æ§åˆ¶å°ç”ŸæˆTopicä»¥åŠæ¶ˆæ¯" class="headerlink" title="æ§åˆ¶å°ç”ŸæˆTopicä»¥åŠæ¶ˆæ¯"></a>æ§åˆ¶å°ç”ŸæˆTopicä»¥åŠæ¶ˆæ¯</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ç”Ÿæˆä¸€ä¸ªåå­—å«michong çš„topic</span></span><br><span class="line">bin/kafka-topics.sh --zookeeper hadoop102:2181 --create --replication-factor 2 --partitions 3 --topic michong</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿›å…¥kafkaæ§åˆ¶å°æ‰‹åŠ¨è¾“å…¥æ¶ˆæ¯</span></span><br><span class="line">bin/kafka-console-producer.sh --broker-list hadoop102:9092 --topic michong</span><br></pre></td></tr></table></figure><h4 id="Wordcountè¯é¢‘ç»Ÿè®¡"><a href="#Wordcountè¯é¢‘ç»Ÿè®¡" class="headerlink" title="Wordcountè¯é¢‘ç»Ÿè®¡"></a>Wordcountè¯é¢‘ç»Ÿè®¡</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">al sparkConf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">&quot;kafkaDirectWordCount&quot;</span>).setMaster(<span class="string">&quot;local[*]&quot;</span>)</span><br><span class="line">  <span class="keyword">val</span> ssc = <span class="keyword">new</span> <span class="type">StreamingContext</span>(sparkConf, <span class="type">Seconds</span>(<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">val</span> <span class="type">KafkaTopic</span> = <span class="type">List</span>(<span class="string">&quot;michong&quot;</span>)</span><br><span class="line">  <span class="keyword">val</span> kafkaParams = <span class="type">Map</span>[<span class="type">String</span>, <span class="type">Object</span>](</span><br><span class="line">    <span class="string">&quot;bootstrap.servers&quot;</span> -&gt; <span class="string">&quot;hadoop102:9092&quot;</span>,</span><br><span class="line">    <span class="string">&quot;key.deserializer&quot;</span> -&gt; classOf[<span class="type">StringDeserializer</span>],</span><br><span class="line">    <span class="string">&quot;value.deserializer&quot;</span> -&gt; classOf[<span class="type">StringDeserializer</span>],</span><br><span class="line">    <span class="string">&quot;group.id&quot;</span> -&gt; <span class="string">&quot;michong&quot;</span>,</span><br><span class="line">    <span class="string">&quot;auto.offset.reset&quot;</span> -&gt; <span class="string">&quot;latest&quot;</span>,</span><br><span class="line">    <span class="string">&quot;enable.auto.commit&quot;</span> -&gt; (<span class="literal">false</span>: java.lang.<span class="type">Boolean</span>)</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="comment">// TODO ... æ¶ˆè´¹æ•°æ®</span></span><br><span class="line">  <span class="comment">// messages æ˜¯å…¨éƒ¨çš„æ•°æ®</span></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŒ‡å®škafkaæ•°æ®æº</span></span><br><span class="line"><span class="comment">     * sscï¼šStreamingContextçš„å®ä¾‹</span></span><br><span class="line"><span class="comment">     * LocationStrategiesï¼šä½ç½®ç­–ç•¥ï¼Œå¦‚æœkafkaçš„brokerèŠ‚ç‚¹è·ŸExecutoråœ¨åŒä¸€å°æœºå™¨ä¸Šç»™ä¸€ç§ç­–ç•¥ï¼Œä¸åœ¨ä¸€å°æœºå™¨ä¸Šç»™å¦å¤–ä¸€ç§ç­–ç•¥</span></span><br><span class="line"><span class="comment">     * è®¾å®šç­–ç•¥åä¼šä»¥æœ€ä¼˜çš„ç­–ç•¥è¿›è¡Œè·å–æ•°æ®</span></span><br><span class="line"><span class="comment">     * ä¸€èˆ¬åœ¨ä¼ä¸šä¸­kafkaèŠ‚ç‚¹è·ŸExecutorä¸ä¼šæ”¾åˆ°ä¸€å°æœºå™¨çš„ï¼ŒåŸå› æ˜¯kakfaæ˜¯æ¶ˆæ¯å­˜å‚¨çš„ï¼ŒExecutorç”¨æ¥åšæ¶ˆæ¯çš„è®¡ç®—ï¼Œ</span></span><br><span class="line"><span class="comment">     * å› æ­¤è®¡ç®—ä¸å­˜å‚¨åˆ†å¼€ï¼Œå­˜å‚¨å¯¹ç£ç›˜è¦æ±‚é«˜ï¼Œè®¡ç®—å¯¹å†…å­˜ã€CPUè¦æ±‚é«˜</span></span><br><span class="line"><span class="comment">     * å¦‚æœExecutorèŠ‚ç‚¹è·ŸBrokerèŠ‚ç‚¹åœ¨ä¸€èµ·çš„è¯ä½¿ç”¨PreferBrokersç­–ç•¥ï¼Œå¦‚æœä¸åœ¨ä¸€èµ·çš„è¯ä½¿ç”¨PreferConsistentç­–ç•¥</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨PreferConsistentç­–ç•¥çš„è¯ï¼Œå°†æ¥åœ¨kafkaä¸­æ‹‰å–äº†æ•°æ®ä»¥åå°½é‡å°†æ•°æ®åˆ†æ•£åˆ°æ‰€æœ‰çš„Executorä¸Š</span></span><br><span class="line"><span class="comment">     * ConsumerStrategiesï¼šæ¶ˆè´¹è€…ç­–ç•¥ï¼ˆæŒ‡å®šå¦‚ä½•æ¶ˆè´¹ï¼‰</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">  <span class="keyword">val</span> messages = <span class="type">KafkaUtils</span>.createDirectStream(ssc,</span><br><span class="line">    <span class="type">LocationStrategies</span>.<span class="type">PreferConsistent</span>,</span><br><span class="line">    <span class="type">ConsumerStrategies</span>.<span class="type">Subscribe</span>[<span class="type">String</span>, <span class="type">String</span>](<span class="type">KafkaTopic</span>, kafkaParams))</span><br><span class="line">  <span class="comment">// x.valueè·å¾—æ•°æ®é‡Œçš„å€¼</span></span><br><span class="line">  messages.map(x =&gt; x.value())</span><br><span class="line">    .flatMap(_.split(<span class="string">&quot; &quot;</span>))</span><br><span class="line">    .map(x =&gt; (x, <span class="number">1</span>))</span><br><span class="line">    .reduceByKey(_ + _)</span><br><span class="line">    .print()</span><br><span class="line">  ssc.start()</span><br><span class="line">  ssc.awaitTermination()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç»Ÿè®¡ç»“æœå¦‚ä¸‹"><a href="#ç»Ÿè®¡ç»“æœå¦‚ä¸‹" class="headerlink" title="ç»Ÿè®¡ç»“æœå¦‚ä¸‹"></a>ç»Ÿè®¡ç»“æœå¦‚ä¸‹</h4><p><img src="https://file.buildworld.cn/img/20200907202538.png"></p><h3 id="5ã€DStreamè½¬æ¢"><a href="#5ã€DStreamè½¬æ¢" class="headerlink" title="5ã€DStreamè½¬æ¢"></a>5ã€DStreamè½¬æ¢</h3><h4 id="æ— çŠ¶æ€è½¬åŒ–æ“ä½œ"><a href="#æ— çŠ¶æ€è½¬åŒ–æ“ä½œ" class="headerlink" title="æ— çŠ¶æ€è½¬åŒ–æ“ä½œ"></a>æ— çŠ¶æ€è½¬åŒ–æ“ä½œ</h4><p><strong>ä¸Šé¢çš„Wordcountè¯é¢‘ç»Ÿè®¡ä»£ç å°±æ˜¯ä½¿ç”¨çš„æ— çŠ¶æ€è½¬åŒ–æ“ä½œã€‚</strong></p><blockquote><p>æ— çŠ¶æ€è½¬åŒ–æ“ä½œå°±æ˜¯æŠŠç®€å•çš„RDDè½¬åŒ–æ“ä½œåº”ç”¨åˆ°æ¯ä¸ªæ‰¹æ¬¡ä¸Šï¼Œä¹Ÿå°±æ˜¯è½¬åŒ–DStreamä¸­çš„æ¯ä¸€ä¸ªRDDã€‚éƒ¨åˆ†æ— çŠ¶æ€è½¬åŒ–æ“ä½œåˆ—åœ¨äº†ä¸‹è¡¨ä¸­ã€‚æ³¨æ„ï¼Œé’ˆå¯¹é”®å€¼å¯¹çš„DStreamè½¬åŒ–æ“ä½œ(æ¯”å¦‚ reduceByKey())è¦æ·»åŠ <code>import StreamingContext._</code>æ‰èƒ½åœ¨Scalaä¸­ä½¿ç”¨ã€‚</p><ul><li>map(func) ï¼šå¯¹æºDStreamçš„æ¯ä¸ªå…ƒç´ ï¼Œé‡‡ç”¨funcå‡½æ•°è¿›è¡Œè½¬æ¢ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„DStreamï¼›</li><li>flatMap(func)ï¼š ä¸mapç›¸ä¼¼ï¼Œä½†æ˜¯æ¯ä¸ªè¾“å…¥é¡¹å¯ç”¨è¢«æ˜ å°„ä¸º0ä¸ªæˆ–è€…å¤šä¸ªè¾“å‡ºé¡¹ï¼›</li><li>filter(func)ï¼š è¿”å›ä¸€ä¸ªæ–°çš„DStreamï¼Œä»…åŒ…å«æºDStreamä¸­æ»¡è¶³å‡½æ•°funcçš„é¡¹ï¼›</li><li>repartition(numPartitions)ï¼š é€šè¿‡åˆ›å»ºæ›´å¤šæˆ–è€…æ›´å°‘çš„åˆ†åŒºæ”¹å˜DStreamçš„å¹¶è¡Œç¨‹åº¦ï¼›</li><li>union(otherStream)ï¼š è¿”å›ä¸€ä¸ªæ–°çš„DStreamï¼ŒåŒ…å«æºDStreamå’Œå…¶ä»–DStreamçš„å…ƒç´ ï¼›</li><li>count()ï¼šç»Ÿè®¡æºDStreamä¸­æ¯ä¸ªRDDçš„å…ƒç´ æ•°é‡ï¼›</li><li>reduce(func)ï¼šåˆ©ç”¨å‡½æ•°funcèšé›†æºDStreamä¸­æ¯ä¸ªRDDçš„å…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«å•å…ƒç´ RDDsçš„æ–°DStreamï¼›</li><li>countByValue()ï¼šåº”ç”¨äºå…ƒç´ ç±»å‹ä¸ºKçš„DStreamä¸Šï¼Œè¿”å›ä¸€ä¸ªï¼ˆKï¼ŒVï¼‰é”®å€¼å¯¹ç±»å‹çš„æ–°DStreamï¼Œæ¯ä¸ªé”®çš„å€¼æ˜¯åœ¨åŸDStreamçš„æ¯ä¸ªRDDä¸­çš„å‡ºç°æ¬¡æ•°ï¼›</li><li>reduceByKey(func, [numTasks])ï¼šå½“åœ¨ä¸€ä¸ªç”±(K,V)é”®å€¼å¯¹ç»„æˆçš„DStreamä¸Šæ‰§è¡Œè¯¥æ“ä½œæ—¶ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ç”±(K,V)é”®å€¼å¯¹ç»„æˆçš„DStreamï¼Œæ¯ä¸€ä¸ªkeyçš„å€¼å‡ç”±ç»™å®šçš„recuceå‡½æ•°ï¼ˆfuncï¼‰èšé›†èµ·æ¥ï¼›</li><li>join(otherStream, [numTasks])ï¼šå½“åº”ç”¨äºä¸¤ä¸ªDStreamï¼ˆä¸€ä¸ªåŒ…å«ï¼ˆK,Vï¼‰é”®å€¼å¯¹,ä¸€ä¸ªåŒ…å«(K,W)é”®å€¼å¯¹ï¼‰ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«(K, (V, W))é”®å€¼å¯¹çš„æ–°DStreamï¼›</li><li>cogroup(otherStream, [numTasks])ï¼šå½“åº”ç”¨äºä¸¤ä¸ªDStreamï¼ˆä¸€ä¸ªåŒ…å«ï¼ˆK,Vï¼‰é”®å€¼å¯¹,ä¸€ä¸ªåŒ…å«(K,W)é”®å€¼å¯¹ï¼‰ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«(K, Seq[V], Seq[W])çš„å…ƒç»„ï¼›</li><li>transform(func)ï¼šé€šè¿‡å¯¹æºDStreamçš„æ¯ä¸ªRDDåº”ç”¨RDD-to-RDDå‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªæ–°DStreamã€‚æ”¯æŒåœ¨æ–°çš„DStreamä¸­åšä»»ä½•RDDæ“ä½œã€‚</li></ul></blockquote><p><img src="https://file.buildworld.cn/img/20200907210350.png"></p><h4 id="æœ‰çŠ¶æ€è½¬åŒ–æ“ä½œ"><a href="#æœ‰çŠ¶æ€è½¬åŒ–æ“ä½œ" class="headerlink" title="æœ‰çŠ¶æ€è½¬åŒ–æ“ä½œ"></a>æœ‰çŠ¶æ€è½¬åŒ–æ“ä½œ</h4><p><strong>å°†å†å²æ•°æ®ä¹Ÿæ‹¿è¿‡æ¥åˆ†æ</strong></p><h5 id="è¿½è¸ªçŠ¶æ€å˜åŒ–-updateStateByKey-çš„è½¬æ¢"><a href="#è¿½è¸ªçŠ¶æ€å˜åŒ–-updateStateByKey-çš„è½¬æ¢" class="headerlink" title="è¿½è¸ªçŠ¶æ€å˜åŒ–(updateStateByKey)çš„è½¬æ¢"></a>è¿½è¸ªçŠ¶æ€å˜åŒ–(updateStateByKey)çš„è½¬æ¢</h5><blockquote><p><code>UpdateStateByKey</code>åŸè¯­ç”¨äºè®°å½•å†å²è®°å½•ï¼Œæœ‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ DStream ä¸­è·¨æ‰¹æ¬¡ç»´æŠ¤çŠ¶æ€(ä¾‹å¦‚æµè®¡ç®—ä¸­ç´¯åŠ wordcount)ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œ<code>updateStateByKey()</code> ä¸ºæˆ‘ä»¬æä¾›äº†å¯¹ä¸€ä¸ªçŠ¶æ€å˜é‡çš„è®¿é—®ï¼Œç”¨äºé”®å€¼å¯¹å½¢å¼çš„ DStreamã€‚ç»™å®šä¸€ä¸ªç”±(é”®ï¼Œäº‹ä»¶)å¯¹æ„æˆçš„ DStreamï¼Œå¹¶ä¼ é€’ä¸€ä¸ªæŒ‡å®šå¦‚ä½•æ ¹æ®æ–°çš„äº‹ä»¶ æ›´æ–°æ¯ä¸ªé”®å¯¹åº”çŠ¶æ€çš„å‡½æ•°ï¼Œå®ƒå¯ä»¥æ„å»ºå‡ºä¸€ä¸ªæ–°çš„ DStreamï¼Œå…¶å†…éƒ¨æ•°æ®ä¸º(é”®ï¼ŒçŠ¶æ€) å¯¹ã€‚ </p><p><code>updateStateByKey()</code> çš„ç»“æœä¼šæ˜¯ä¸€ä¸ªæ–°çš„ DStreamï¼Œå…¶å†…éƒ¨çš„ RDD åºåˆ—æ˜¯ç”±æ¯ä¸ªæ—¶é—´åŒºé—´å¯¹åº”çš„(é”®ï¼ŒçŠ¶æ€)å¯¹ç»„æˆçš„ã€‚</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.<span class="type">ConsumerRecord</span></span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.common.serialization.<span class="type">StringDeserializer</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.rdd.<span class="type">RDD</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming.dstream.&#123;<span class="type">DStream</span>, <span class="type">InputDStream</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming.kafka010._</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming.&#123;<span class="type">Seconds</span>, <span class="type">StreamingContext</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">HashPartitioner</span>, <span class="type">SparkConf</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">KafkaDirectStream</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">  <span class="comment">// æ›´æ–°æ–¹æ³•</span></span><br><span class="line">  <span class="keyword">val</span> updateFunc = (it: <span class="type">Iterator</span>[(<span class="type">String</span>, <span class="type">Seq</span>[<span class="type">Int</span>], <span class="type">Option</span>[<span class="type">Int</span>])]) =&gt; &#123;</span><br><span class="line">    it.map &#123; <span class="keyword">case</span> (w, s, o) =&gt; (w, s.sum + o.getOrElse(<span class="number">0</span>)) &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> conf: <span class="type">SparkConf</span> = <span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">&quot;KafkaDirectStream&quot;</span>).setMaster(<span class="string">&quot;local[*]&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> ssc: <span class="type">StreamingContext</span> = <span class="keyword">new</span> <span class="type">StreamingContext</span>(conf, <span class="type">Seconds</span>(<span class="number">5</span>))</span><br><span class="line">    ssc.checkpoint(<span class="string">&quot;./ck&quot;</span>)</span><br><span class="line">    <span class="comment">//è·ŸKafkaæ•´åˆï¼ˆç›´è¿æ–¹å¼ï¼Œè°ƒç”¨Kafkaåº•å±‚çš„æ¶ˆè´¹æ•°æ®çš„APIï¼‰</span></span><br><span class="line">    <span class="keyword">val</span> brokerList = <span class="string">&quot;hadoop102:9092&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> kafkaParams = <span class="type">Map</span>[<span class="type">String</span>, <span class="type">Object</span>](</span><br><span class="line">      <span class="string">&quot;bootstrap.servers&quot;</span> -&gt; brokerList,</span><br><span class="line">      <span class="string">&quot;key.deserializer&quot;</span> -&gt; classOf[<span class="type">StringDeserializer</span>],</span><br><span class="line">      <span class="string">&quot;value.deserializer&quot;</span> -&gt; classOf[<span class="type">StringDeserializer</span>],</span><br><span class="line">      <span class="string">&quot;group.id&quot;</span> -&gt; <span class="string">&quot;michong&quot;</span>,</span><br><span class="line">      <span class="comment">//è¿™ä¸ªä»£è¡¨ï¼Œä»»åŠ¡å¯åŠ¨ä¹‹å‰äº§ç”Ÿçš„æ•°æ®ä¹Ÿè¦è¯»</span></span><br><span class="line">      <span class="string">&quot;auto.offset.reset&quot;</span> -&gt; <span class="string">&quot;earliest&quot;</span>,</span><br><span class="line">      <span class="string">&quot;enable.auto.commit&quot;</span> -&gt; (<span class="literal">false</span>: java.lang.<span class="type">Boolean</span>)</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">val</span> topics = <span class="type">Array</span>(<span class="string">&quot;michong&quot;</span>)</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŒ‡å®škafkaæ•°æ®æº</span></span><br><span class="line"><span class="comment">     * sscï¼šStreamingContextçš„å®ä¾‹</span></span><br><span class="line"><span class="comment">     * LocationStrategiesï¼šä½ç½®ç­–ç•¥ï¼Œå¦‚æœkafkaçš„brokerèŠ‚ç‚¹è·ŸExecutoråœ¨åŒä¸€å°æœºå™¨ä¸Šç»™ä¸€ç§ç­–ç•¥ï¼Œä¸åœ¨ä¸€å°æœºå™¨ä¸Šç»™å¦å¤–ä¸€ç§ç­–ç•¥</span></span><br><span class="line"><span class="comment">     * è®¾å®šç­–ç•¥åä¼šä»¥æœ€ä¼˜çš„ç­–ç•¥è¿›è¡Œè·å–æ•°æ®</span></span><br><span class="line"><span class="comment">     * ä¸€èˆ¬åœ¨ä¼ä¸šä¸­kafkaèŠ‚ç‚¹è·ŸExecutorä¸ä¼šæ”¾åˆ°ä¸€å°æœºå™¨çš„ï¼ŒåŸå› æ˜¯kakfaæ˜¯æ¶ˆæ¯å­˜å‚¨çš„ï¼ŒExecutorç”¨æ¥åšæ¶ˆæ¯çš„è®¡ç®—ï¼Œ</span></span><br><span class="line"><span class="comment">     * å› æ­¤è®¡ç®—ä¸å­˜å‚¨åˆ†å¼€ï¼Œå­˜å‚¨å¯¹ç£ç›˜è¦æ±‚é«˜ï¼Œè®¡ç®—å¯¹å†…å­˜ã€CPUè¦æ±‚é«˜</span></span><br><span class="line"><span class="comment">     * å¦‚æœExecutorèŠ‚ç‚¹è·ŸBrokerèŠ‚ç‚¹åœ¨ä¸€èµ·çš„è¯ä½¿ç”¨PreferBrokersç­–ç•¥ï¼Œå¦‚æœä¸åœ¨ä¸€èµ·çš„è¯ä½¿ç”¨PreferConsistentç­–ç•¥</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨PreferConsistentç­–ç•¥çš„è¯ï¼Œå°†æ¥åœ¨kafkaä¸­æ‹‰å–äº†æ•°æ®ä»¥åå°½é‡å°†æ•°æ®åˆ†æ•£åˆ°æ‰€æœ‰çš„Executorä¸Š</span></span><br><span class="line"><span class="comment">     * ConsumerStrategiesï¼šæ¶ˆè´¹è€…ç­–ç•¥ï¼ˆæŒ‡å®šå¦‚ä½•æ¶ˆè´¹ï¼‰</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">val</span> directStream: <span class="type">InputDStream</span>[<span class="type">ConsumerRecord</span>[<span class="type">String</span>, <span class="type">String</span>]] = <span class="type">KafkaUtils</span>.createDirectStream(ssc,</span><br><span class="line">      <span class="type">LocationStrategies</span>.<span class="type">PreferConsistent</span>,</span><br><span class="line">      <span class="type">ConsumerStrategies</span>.<span class="type">Subscribe</span>[<span class="type">String</span>, <span class="type">String</span>](topics, kafkaParams)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ‰“å°å‡ºè¯é¢‘ç»Ÿè®¡ç»“æœ</span></span><br><span class="line">    <span class="keyword">val</span> result: <span class="type">DStream</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = directStream.map(_.value()).flatMap(_.split(<span class="string">&quot; &quot;</span>))</span><br><span class="line">      .map((_, <span class="number">1</span>))</span><br><span class="line">      .updateStateByKey(updateFunc, <span class="keyword">new</span> <span class="type">HashPartitioner</span>(ssc.sparkContext.defaultParallelism), <span class="literal">true</span>)</span><br><span class="line">    result.print()</span><br><span class="line"></span><br><span class="line">    directStream.foreachRDD(rdd =&gt; &#123;</span><br><span class="line">      <span class="keyword">val</span> offsetRange: <span class="type">Array</span>[<span class="type">OffsetRange</span>] = rdd.asInstanceOf[<span class="type">HasOffsetRanges</span>].offsetRanges</span><br><span class="line">      <span class="keyword">val</span> maped: <span class="type">RDD</span>[(<span class="type">String</span>, <span class="type">String</span>)] = rdd.map(record =&gt; (record.key, record.value))</span><br><span class="line">      <span class="comment">//è®¡ç®—é€»è¾‘</span></span><br><span class="line">      maped.foreach(println)</span><br><span class="line">      <span class="comment">//å¾ªç¯è¾“å‡º</span></span><br><span class="line">      println(<span class="string">&quot;************&quot;</span>+<span class="type">System</span>.currentTimeMillis()+<span class="string">&quot;************&quot;</span>)</span><br><span class="line">      <span class="keyword">for</span> (o &lt;- offsetRange) &#123;</span><br><span class="line">        println(<span class="string">s&quot;<span class="subst">$&#123;o.topic&#125;</span> <span class="subst">$&#123;o.partition&#125;</span> <span class="subst">$&#123;o.fromOffset&#125;</span> <span class="subst">$&#123;o.untilOffset&#125;</span>&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    ssc.start()</span><br><span class="line">    ssc.awaitTermination()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Window-Operations"><a href="#Window-Operations" class="headerlink" title="Window Operations"></a>Window Operations</h5><blockquote><p>Window Operationså¯ä»¥è®¾ç½®çª—å£çš„å¤§å°å’Œæ»‘åŠ¨çª—å£çš„é—´éš”æ¥åŠ¨æ€çš„è·å–å½“å‰Steamingçš„å…è®¸çŠ¶æ€ã€‚åŸºäºçª—å£çš„æ“ä½œä¼šåœ¨ä¸€ä¸ªæ¯” StreamingContext çš„æ‰¹æ¬¡é—´éš”æ›´é•¿çš„æ—¶é—´èŒƒå›´å†…ï¼Œé€šè¿‡æ•´åˆå¤šä¸ªæ‰¹æ¬¡çš„ç»“æœï¼Œè®¡ç®—å‡ºæ•´ä¸ªçª—å£çš„ç»“æœã€‚</p></blockquote><p><img src="https://file.buildworld.cn/img/20200908094728.png"></p><p><strong>æ‰€æœ‰åŸºäºçª—å£çš„æ“ä½œéƒ½éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸ºçª—å£æ—¶é•¿ä»¥åŠæ»‘åŠ¨æ­¥é•¿ï¼Œä¸¤è€…éƒ½å¿…é¡»æ˜¯ StreamContext çš„æ‰¹æ¬¡é—´éš”çš„æ•´æ•°å€ã€‚</strong></p><h6 id="å…³äºWindowçš„æ“ä½œæœ‰å¦‚ä¸‹åŸè¯­ï¼š"><a href="#å…³äºWindowçš„æ“ä½œæœ‰å¦‚ä¸‹åŸè¯­ï¼š" class="headerlink" title="å…³äºWindowçš„æ“ä½œæœ‰å¦‚ä¸‹åŸè¯­ï¼š"></a>å…³äºWindowçš„æ“ä½œæœ‰å¦‚ä¸‹åŸè¯­ï¼š</h6><blockquote><ul><li>ï¼ˆ1ï¼‰<code>window(windowLength, slideInterval):</code> åŸºäºå¯¹æºDStreamçª—åŒ–çš„æ‰¹æ¬¡è¿›è¡Œè®¡ç®—è¿”å›ä¸€ä¸ªæ–°çš„Dstream</li><li>ï¼ˆ2ï¼‰<code>countByWindow(windowLength, slideInterval)ï¼š</code>è¿”å›ä¸€ä¸ªæ»‘åŠ¨çª—å£è®¡æ•°æµä¸­çš„å…ƒç´ ã€‚</li><li>ï¼ˆ3ï¼‰<code>reduceByWindow(func, windowLength, slideInterval)ï¼š</code>é€šè¿‡ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°æ•´åˆæ»‘åŠ¨åŒºé—´æµå…ƒç´ æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å•å…ƒç´ æµã€‚</li><li>ï¼ˆ4ï¼‰<code>reduceByKeyAndWindow(func, windowLength, slideInterval, [numTasks])ï¼š</code>å½“åœ¨ä¸€ä¸ª(K,V)å¯¹çš„DStreamä¸Šè°ƒç”¨æ­¤å‡½æ•°ï¼Œä¼šè¿”å›ä¸€ä¸ªæ–°(K,V)å¯¹çš„DStreamï¼Œæ­¤å¤„é€šè¿‡å¯¹æ»‘åŠ¨çª—å£ä¸­æ‰¹æ¬¡æ•°æ®ä½¿ç”¨reduceå‡½æ•°æ¥æ•´åˆæ¯ä¸ªkeyçš„valueå€¼ã€‚Note:é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ“ä½œä½¿ç”¨Sparkçš„é»˜è®¤æ•°é‡å¹¶è¡Œä»»åŠ¡(æœ¬åœ°æ˜¯2)ï¼Œåœ¨é›†ç¾¤æ¨¡å¼ä¸­ä¾æ®é…ç½®å±æ€§(spark.default.parallelism)æ¥åšgroupingã€‚ä½ å¯ä»¥é€šè¿‡è®¾ç½®å¯é€‰å‚æ•°numTasksæ¥è®¾ç½®ä¸åŒæ•°é‡çš„tasksã€‚</li><li>ï¼ˆ5ï¼‰<code>reduceByKeyAndWindow(func, invFunc, windowLength, slideInterval, [numTasks])ï¼š</code>è¿™ä¸ªå‡½æ•°æ˜¯ä¸Šè¿°å‡½æ•°çš„æ›´é«˜æ•ˆç‰ˆæœ¬ï¼Œæ¯ä¸ªçª—å£çš„reduceå€¼éƒ½æ˜¯é€šè¿‡ç”¨å‰ä¸€ä¸ªçª—çš„reduceå€¼æ¥é€’å¢è®¡ç®—ã€‚é€šè¿‡reduceè¿›å…¥åˆ°æ»‘åŠ¨çª—å£æ•°æ®å¹¶â€åå‘reduceâ€ç¦»å¼€çª—å£çš„æ—§æ•°æ®æ¥å®ç°è¿™ä¸ªæ“ä½œã€‚ä¸€ä¸ªä¾‹å­æ˜¯éšç€çª—å£æ»‘åŠ¨å¯¹keysçš„â€œåŠ â€â€œå‡â€è®¡æ•°ã€‚é€šè¿‡å‰è¾¹ä»‹ç»å¯ä»¥æƒ³åˆ°ï¼Œè¿™ä¸ªå‡½æ•°åªé€‚ç”¨äºâ€å¯é€†çš„reduceå‡½æ•°â€ï¼Œä¹Ÿå°±æ˜¯è¿™äº›reduceå‡½æ•°æœ‰ç›¸åº”çš„â€åreduceâ€å‡½æ•°(ä»¥å‚æ•°invFuncå½¢å¼ä¼ å…¥)ã€‚å¦‚å‰è¿°å‡½æ•°ï¼Œreduceä»»åŠ¡çš„æ•°é‡é€šè¿‡å¯é€‰å‚æ•°æ¥é…ç½®ã€‚æ³¨æ„ï¼šä¸ºäº†ä½¿ç”¨è¿™ä¸ªæ“ä½œï¼Œ<a href="#checkpointing">æ£€æŸ¥ç‚¹</a>å¿…é¡»å¯ç”¨ã€‚ </li><li>ï¼ˆ6ï¼‰<code>countByValueAndWindow(windowLength,slideInterval, [numTasks])ï¼š</code>å¯¹(K,V)å¯¹çš„DStreamè°ƒç”¨ï¼Œè¿”å›(K,Long)å¯¹çš„æ–°DStreamï¼Œå…¶ä¸­æ¯ä¸ªkeyçš„å€¼æ˜¯å…¶åœ¨æ»‘åŠ¨çª—å£ä¸­é¢‘ç‡ã€‚å¦‚ä¸Šï¼Œå¯é…ç½®reduceä»»åŠ¡æ•°é‡ã€‚</li></ul><p><code>reduceByWindow()</code> å’Œ <code>reduceByKeyAndWindow()</code> è®©æˆ‘ä»¬å¯ä»¥å¯¹æ¯ä¸ªçª—å£æ›´é«˜æ•ˆåœ°è¿›è¡Œå½’çº¦æ“ä½œã€‚å®ƒä»¬æ¥æ”¶ä¸€ä¸ªå½’çº¦å‡½æ•°ï¼Œåœ¨æ•´ä¸ªçª—å£ä¸Šæ‰§è¡Œï¼Œæ¯”å¦‚ +ã€‚é™¤æ­¤ä»¥å¤–ï¼Œå®ƒä»¬è¿˜æœ‰ä¸€ç§ç‰¹æ®Šå½¢å¼ï¼Œé€šè¿‡åªè€ƒè™‘æ–°è¿›å…¥çª—å£çš„æ•°æ®å’Œç¦»å¼€çª—å£çš„æ•°æ®ï¼Œè®© Spark å¢é‡è®¡ç®—å½’çº¦ç»“æœã€‚è¿™ç§ç‰¹æ®Šå½¢å¼éœ€è¦æä¾›å½’çº¦å‡½æ•°çš„ä¸€ä¸ªé€†å‡½æ•°ï¼Œæ¯” å¦‚ + å¯¹åº”çš„é€†å‡½æ•°ä¸º -ã€‚å¯¹äºè¾ƒå¤§çš„çª—å£ï¼Œæä¾›é€†å‡½æ•°å¯ä»¥å¤§å¤§æé«˜æ‰§è¡Œæ•ˆç‡  </p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//çª—å£å¤§å°åº”è¯¥ä¸ºé‡‡é›†å‘¨æœŸçš„æ•´æ•°å€ï¼Œçª—å£æ»‘åŠ¨çš„æ­¥é•¿ä¹Ÿåº”è¯¥ä¸ºé‡‡é›†å‘¨æœŸçš„æ•´æ•°å€</span></span><br><span class="line"><span class="keyword">val</span> windowDStream: <span class="type">DStream</span>[<span class="type">ConsumerRecord</span>[<span class="type">String</span>, <span class="type">String</span>]] = directStream.window(<span class="type">Seconds</span>(<span class="number">10</span>), <span class="type">Seconds</span>(<span class="number">5</span>))</span><br></pre></td></tr></table></figure><h3 id="6ã€DStreamè¾“å‡º"><a href="#6ã€DStreamè¾“å‡º" class="headerlink" title="6ã€DStreamè¾“å‡º"></a>6ã€DStreamè¾“å‡º</h3><blockquote><p>è¾“å‡ºæ“ä½œæŒ‡å®šäº†å¯¹æµæ•°æ®ç»è½¬åŒ–æ“ä½œå¾—åˆ°çš„æ•°æ®æ‰€è¦æ‰§è¡Œçš„æ“ä½œ(ä¾‹å¦‚æŠŠç»“æœæ¨å…¥å¤–éƒ¨æ•°æ®åº“æˆ–è¾“å‡ºåˆ°å±å¹•ä¸Š)ã€‚ä¸RDDä¸­çš„æƒ°æ€§æ±‚å€¼ç±»ä¼¼ï¼Œå¦‚æœä¸€ä¸ªDStreamåŠå…¶æ´¾ç”Ÿå‡ºçš„DStreaméƒ½æ²¡æœ‰è¢«æ‰§è¡Œè¾“å‡ºæ“ä½œï¼Œé‚£ä¹ˆè¿™äº›DStreamå°±éƒ½ä¸ä¼šè¢«æ±‚å€¼ã€‚å¦‚æœStreamingContextä¸­æ²¡æœ‰è®¾å®šè¾“å‡ºæ“ä½œï¼Œæ•´ä¸ªcontextå°±éƒ½ä¸ä¼šå¯åŠ¨ã€‚ </p><p><strong>è¾“å‡ºæ“ä½œå¦‚ä¸‹ï¼š</strong></p><ul><li><p>ï¼ˆ1ï¼‰<code>print()ï¼š</code>åœ¨è¿è¡Œæµç¨‹åºçš„é©±åŠ¨ç»“ç‚¹ä¸Šæ‰“å°DStreamä¸­æ¯ä¸€æ‰¹æ¬¡æ•°æ®çš„æœ€å¼€å§‹10ä¸ªå…ƒç´ ã€‚è¿™ç”¨äºå¼€å‘å’Œè°ƒè¯•ã€‚åœ¨Python APIä¸­ï¼ŒåŒæ ·çš„æ“ä½œå«print()ã€‚</p></li><li><p>ï¼ˆ2ï¼‰<code>saveAsTextFiles(prefix, [suffix])ï¼š</code>ä»¥textæ–‡ä»¶å½¢å¼å­˜å‚¨è¿™ä¸ªDStreamçš„å†…å®¹ã€‚æ¯ä¸€æ‰¹æ¬¡çš„å­˜å‚¨æ–‡ä»¶ååŸºäºå‚æ•°ä¸­çš„prefixå’Œsuffixã€‚â€prefix-Time_IN_MS[.suffix]â€. </p></li><li><p>ï¼ˆ3ï¼‰<code>saveAsObjectFiles(prefix, [suffix])ï¼š</code>ä»¥Javaå¯¹è±¡åºåˆ—åŒ–çš„æ–¹å¼å°†Streamä¸­çš„æ•°æ®ä¿å­˜ä¸º SequenceFiles . æ¯ä¸€æ‰¹æ¬¡çš„å­˜å‚¨æ–‡ä»¶ååŸºäºå‚æ•°ä¸­çš„ä¸ºâ€prefix-TIME_IN_MS[.suffix]â€. Pythonä¸­ç›®å‰ä¸å¯ç”¨ã€‚</p></li><li><p>ï¼ˆ4ï¼‰<code>saveAsHadoopFiles(prefix, [suffix])ï¼š</code>å°†Streamä¸­çš„æ•°æ®ä¿å­˜ä¸º Hadoop files. æ¯ä¸€æ‰¹æ¬¡çš„å­˜å‚¨æ–‡ä»¶ååŸºäºå‚æ•°ä¸­çš„ä¸ºâ€prefix-TIME_IN_MS[.suffix]â€ã€‚<br>Python API Pythonä¸­ç›®å‰ä¸å¯ç”¨ã€‚</p></li><li><p>ï¼ˆ5ï¼‰<code>foreachRDD(func)ï¼š</code>è¿™æ˜¯æœ€é€šç”¨çš„è¾“å‡ºæ“ä½œï¼Œå³å°†å‡½æ•° func ç”¨äºäº§ç”Ÿäº streamçš„æ¯ä¸€ä¸ªRDDã€‚å…¶ä¸­ å‚æ•°ä¼ å…¥çš„å‡½æ•°funcåº”è¯¥å®ç°å°†æ¯ä¸€ä¸ªRDDä¸­æ•°æ®æ¨é€åˆ°å¤–éƒ¨ç³»ç»Ÿï¼Œå¦‚å°†RDDå­˜å…¥æ–‡ä»¶æˆ–è€…é€šè¿‡ç½‘ç»œå°†å…¶å†™å…¥æ•°æ®åº“ã€‚æ³¨æ„ï¼šå‡½æ•°funcåœ¨è¿è¡Œæµåº”ç”¨çš„é©±åŠ¨ä¸­è¢«æ‰§è¡Œï¼ŒåŒæ—¶å…¶ä¸­ä¸€èˆ¬å‡½æ•°RDDæ“ä½œä»è€Œå¼ºåˆ¶å…¶å¯¹äºæµRDDçš„è¿ç®—ã€‚</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">windowDStream.foreachRDD(rdd =&gt; &#123;</span><br><span class="line">  <span class="keyword">val</span> offsetRange: <span class="type">Array</span>[<span class="type">OffsetRange</span>] = rdd.asInstanceOf[<span class="type">HasOffsetRanges</span>].offsetRanges</span><br><span class="line">  <span class="keyword">val</span> maped: <span class="type">RDD</span>[(<span class="type">String</span>, <span class="type">String</span>)] = rdd.map(record =&gt; (record.key, record.value))</span><br><span class="line">  <span class="comment">//è®¡ç®—é€»è¾‘</span></span><br><span class="line">  maped.foreach(println)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//å¾ªç¯è¾“å‡º</span></span><br><span class="line">  println(<span class="string">&quot;************&quot;</span>+<span class="type">System</span>.currentTimeMillis()+<span class="string">&quot;************&quot;</span>)</span><br><span class="line">  <span class="keyword">for</span> (o &lt;- offsetRange) &#123;</span><br><span class="line">    println(<span class="string">s&quot;<span class="subst">$&#123;o.topic&#125;</span> <span class="subst">$&#123;o.partition&#125;</span> <span class="subst">$&#123;o.fromOffset&#125;</span> <span class="subst">$&#123;o.untilOffset&#125;</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><p>é€šç”¨çš„è¾“å‡ºæ“ä½œforeachRDD()ï¼Œå®ƒç”¨æ¥å¯¹DStreamä¸­çš„RDDè¿è¡Œä»»æ„è®¡ç®—ã€‚è¿™å’Œtransform() æœ‰äº›ç±»ä¼¼ï¼Œéƒ½å¯ä»¥è®©æˆ‘ä»¬è®¿é—®ä»»æ„RDDã€‚åœ¨foreachRDD()ä¸­ï¼Œå¯ä»¥é‡ç”¨æˆ‘ä»¬åœ¨Sparkä¸­å®ç°çš„æ‰€æœ‰è¡ŒåŠ¨æ“ä½œã€‚</p><p>æ¯”å¦‚ï¼Œå¸¸è§çš„ç”¨ä¾‹ä¹‹ä¸€æ˜¯æŠŠæ•°æ®å†™åˆ°è¯¸å¦‚MySQLçš„å¤–éƒ¨æ•°æ®åº“ä¸­ã€‚ æ³¨æ„ï¼š</p><ul><li>ï¼ˆ1ï¼‰è¿æ¥ä¸èƒ½å†™åœ¨driverå±‚é¢ï¼›</li><li>ï¼ˆ2ï¼‰å¦‚æœå†™åœ¨foreachåˆ™æ¯ä¸ªRDDéƒ½åˆ›å»ºï¼Œå¾—ä¸å¿å¤±ï¼›</li><li>ï¼ˆ3ï¼‰å¢åŠ foreachPartitionï¼Œåœ¨åˆ†åŒºåˆ›å»ºã€‚</li></ul></blockquote>]]></content>
    
    
    <summary type="html">Spark Streamingç”¨äºæµå¼æ•°æ®çš„å¤„ç†ã€‚Spark Streamingæ”¯æŒçš„æ•°æ®è¾“å…¥æºå¾ˆå¤šï¼Œä¾‹å¦‚ï¼šKafkaã€Flumeã€Twitterã€ZeroMQå’Œç®€å•çš„TCPå¥—æ¥å­—ç­‰ç­‰ã€‚</summary>
    
    
    
    <category term="BigData" scheme="https://www.buildworld.cn/categories/BigData/"/>
    
    
    <category term="Spark" scheme="https://www.buildworld.cn/tags/Spark/"/>
    
    <category term="SparkStreaming" scheme="https://www.buildworld.cn/tags/SparkStreaming/"/>
    
  </entry>
  
  <entry>
    <title>BigData--å¤§æ•°æ®æŠ€æœ¯ä¹‹SparkSQL</title>
    <link href="https://www.buildworld.cn/2020/09/03/BigData-%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8BSparkSQL/"/>
    <id>https://www.buildworld.cn/2020/09/03/BigData-%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8BSparkSQL/</id>
    <published>2020-09-03T07:44:59.000Z</published>
    <updated>2021-04-09T02:17:25.672Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p><img src="https://file.buildworld.cn/img/20200810132517.png"></p><h3 id="ä¸€ã€Spark-SQLæ¦‚è¿°"><a href="#ä¸€ã€Spark-SQLæ¦‚è¿°" class="headerlink" title="ä¸€ã€Spark SQLæ¦‚è¿°"></a>ä¸€ã€Spark SQLæ¦‚è¿°</h3><h4 id="1ã€DataFrame"><a href="#1ã€DataFrame" class="headerlink" title="1ã€DataFrame"></a>1ã€DataFrame</h4><blockquote><p>ä¸RDDç±»ä¼¼ï¼ŒDataFrameä¹Ÿæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®å®¹å™¨ã€‚ç„¶è€ŒDataFrameæ›´åƒä¼ ç»Ÿæ•°æ®åº“çš„äºŒç»´è¡¨æ ¼ï¼Œé™¤äº†æ•°æ®ä»¥å¤–ï¼Œè¿˜è®°å½•æ•°æ®çš„ç»“æ„ä¿¡æ¯ï¼Œå³schemaã€‚åŒæ—¶ï¼Œä¸Hiveç±»ä¼¼ï¼ŒDataFrameä¹Ÿæ”¯æŒåµŒå¥—æ•°æ®ç±»å‹ï¼ˆstructã€arrayå’Œmapï¼‰ã€‚ä»APIæ˜“ç”¨æ€§çš„è§’åº¦ä¸Šçœ‹ï¼ŒDataFrame APIæä¾›çš„æ˜¯ä¸€å¥—é«˜å±‚çš„å…³ç³»æ“ä½œï¼Œæ¯”å‡½æ•°å¼çš„RDD APIè¦æ›´åŠ å‹å¥½ï¼Œé—¨æ§›æ›´ä½ã€‚</p></blockquote><h4 id="2ã€DataSet"><a href="#2ã€DataSet" class="headerlink" title="2ã€DataSet"></a>2ã€DataSet</h4><blockquote><ul><li>1ï¼‰æ˜¯<code>Dataframe API</code>çš„ä¸€ä¸ªæ‰©å±•ï¼Œæ˜¯Sparkæœ€æ–°çš„æ•°æ®æŠ½è±¡ã€‚</li><li>2ï¼‰ç”¨æˆ·å‹å¥½çš„APIé£æ ¼ï¼Œæ—¢å…·æœ‰ç±»å‹å®‰å…¨æ£€æŸ¥ä¹Ÿå…·æœ‰Dataframeçš„æŸ¥è¯¢ä¼˜åŒ–ç‰¹æ€§ã€‚</li><li>3ï¼‰Datasetæ”¯æŒç¼–è§£ç å™¨ï¼Œå½“éœ€è¦è®¿é—®éå †ä¸Šçš„æ•°æ®æ—¶å¯ä»¥é¿å…ååºåˆ—åŒ–æ•´ä¸ªå¯¹è±¡ï¼Œæé«˜äº†æ•ˆç‡ã€‚</li><li>4ï¼‰æ ·ä¾‹ç±»è¢«ç”¨æ¥åœ¨Datasetä¸­å®šä¹‰æ•°æ®çš„ç»“æ„ä¿¡æ¯ï¼Œæ ·ä¾‹ç±»ä¸­æ¯ä¸ªå±æ€§çš„åç§°ç›´æ¥æ˜ å°„åˆ°DataSetä¸­çš„å­—æ®µåç§°ã€‚</li><li>5ï¼‰ Dataframeæ˜¯Datasetçš„ç‰¹åˆ—ï¼Œ<code>DataFrame=Dataset[Row]</code> ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡asæ–¹æ³•å°†Dataframeè½¬æ¢ä¸ºDatasetã€‚Rowæ˜¯ä¸€ä¸ªç±»å‹ï¼Œè·ŸCarã€Personè¿™äº›çš„ç±»å‹ä¸€æ ·ï¼Œæ‰€æœ‰çš„è¡¨ç»“æ„ä¿¡æ¯æˆ‘éƒ½ç”¨Rowæ¥è¡¨ç¤ºã€‚</li><li>6ï¼‰DataSetæ˜¯å¼ºç±»å‹çš„ã€‚æ¯”å¦‚å¯ä»¥æœ‰Dataset[Car]ï¼ŒDataset[Person].</li><li>7ï¼‰DataFrameåªæ˜¯çŸ¥é“å­—æ®µï¼Œä½†æ˜¯ä¸çŸ¥é“å­—æ®µçš„ç±»å‹ï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œè¿™äº›æ“ä½œçš„æ—¶å€™æ˜¯æ²¡åŠæ³•åœ¨ç¼–è¯‘çš„æ—¶å€™æ£€æŸ¥æ˜¯å¦ç±»å‹å¤±è´¥çš„ï¼Œæ¯”å¦‚ä½ å¯ä»¥å¯¹ä¸€ä¸ªStringè¿›è¡Œå‡æ³•æ“ä½œï¼Œåœ¨æ‰§è¡Œçš„æ—¶å€™æ‰æŠ¥é”™ï¼Œè€ŒDataSetä¸ä»…ä»…çŸ¥é“å­—æ®µï¼Œè€Œä¸”çŸ¥é“å­—æ®µç±»å‹ï¼Œæ‰€ä»¥æœ‰æ›´ä¸¥æ ¼çš„é”™è¯¯æ£€æŸ¥ã€‚å°±è·ŸJSONå¯¹è±¡å’Œç±»å¯¹è±¡ä¹‹é—´çš„ç±»æ¯”ã€‚</li></ul></blockquote><p><img src="https://file.buildworld.cn/img/20200810163552.png"></p><h3 id="äºŒã€SparkSQLç¨‹åº"><a href="#äºŒã€SparkSQLç¨‹åº" class="headerlink" title="äºŒã€SparkSQLç¨‹åº"></a>äºŒã€SparkSQLç¨‹åº</h3><h4 id="1ã€user-json"><a href="#1ã€user-json" class="headerlink" title="1ã€user.json"></a>1ã€user.json</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;id&quot;</span> : <span class="string">&quot;1201&quot;</span>, <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;satish&quot;</span>, <span class="attr">&quot;age&quot;</span> : <span class="string">&quot;25&quot;</span>&#125;</span><br><span class="line">&#123;<span class="attr">&quot;id&quot;</span> : <span class="string">&quot;1202&quot;</span>, <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;krishna&quot;</span>, <span class="attr">&quot;age&quot;</span> : <span class="string">&quot;28&quot;</span>&#125;</span><br><span class="line">&#123;<span class="attr">&quot;id&quot;</span> : <span class="string">&quot;1203&quot;</span>, <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;amith&quot;</span>, <span class="attr">&quot;age&quot;</span> : <span class="string">&quot;39&quot;</span>&#125;</span><br><span class="line">&#123;<span class="attr">&quot;id&quot;</span> : <span class="string">&quot;1204&quot;</span>, <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;javed&quot;</span>, <span class="attr">&quot;age&quot;</span> : <span class="string">&quot;23&quot;</span>&#125;</span><br><span class="line">&#123;<span class="attr">&quot;id&quot;</span> : <span class="string">&quot;1205&quot;</span>, <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;prudvi&quot;</span>, <span class="attr">&quot;age&quot;</span> : <span class="string">&quot;23&quot;</span>&#125;</span><br></pre></td></tr></table></figure><h4 id="2ã€åŸºæœ¬ä½¿ç”¨"><a href="#2ã€åŸºæœ¬ä½¿ç”¨" class="headerlink" title="2ã€åŸºæœ¬ä½¿ç”¨"></a>2ã€åŸºæœ¬ä½¿ç”¨</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//è®¾ç½®é…ç½®</span></span><br><span class="line">  <span class="keyword">val</span> sparkConf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">&quot;local[*]&quot;</span>).setAppName(<span class="string">&quot;Spark SQL&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//åˆ›å»ºSparkSession</span></span><br><span class="line">  <span class="keyword">val</span> spark = <span class="type">SparkSession</span></span><br><span class="line">    .builder()</span><br><span class="line">    .appName(<span class="string">&quot;Spark SQL basic example&quot;</span>)</span><br><span class="line">    .config(sparkConf)</span><br><span class="line">    .getOrCreate()</span><br><span class="line"></span><br><span class="line">  <span class="comment">//åŠ è½½jsonæ•°æ®</span></span><br><span class="line">  <span class="keyword">val</span> dataFrame = spark.read.json(<span class="string">&quot;data\\user.json&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//åˆ›å»ºuserè§†å›¾</span></span><br><span class="line">  dataFrame.createOrReplaceTempView(<span class="string">&quot;user&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//æ‰§è¡ŒSQLè¯­å¥ï¼Œå¹¶æ‰“å°ç»“æœ</span></span><br><span class="line">  spark.sql(<span class="string">&quot;select * from user where age &gt; 25&quot;</span>).show()</span><br><span class="line"></span><br><span class="line">  <span class="comment">//å…³é—­</span></span><br><span class="line">  spark.stop</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3ã€ç›¸äº’è½¬æ¢"><a href="#3ã€ç›¸äº’è½¬æ¢" class="headerlink" title="3ã€ç›¸äº’è½¬æ¢"></a>3ã€ç›¸äº’è½¬æ¢</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®¾ç½®é…ç½®</span></span><br><span class="line"><span class="keyword">val</span> sparkConf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">&quot;local[*]&quot;</span>).setAppName(<span class="string">&quot;Spark SQL&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºSparkSession</span></span><br><span class="line"><span class="keyword">val</span> spark = <span class="type">SparkSession</span></span><br><span class="line">  .builder()</span><br><span class="line">  .appName(<span class="string">&quot;Spark SQL basic example&quot;</span>)</span><br><span class="line">  .config(sparkConf)</span><br><span class="line">  .getOrCreate()</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿›è¡Œè½¬æ¢ä¹‹å‰ï¼Œéœ€è¦å¼•å…¥éšå¼è½¬æ¢è§„åˆ™</span></span><br><span class="line"><span class="keyword">import</span> spark.implicits._</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºRDD</span></span><br><span class="line"><span class="keyword">val</span> rdd = spark.sparkContext.makeRDD(<span class="type">List</span>((<span class="number">1</span>, <span class="string">&quot;michong&quot;</span>, <span class="number">20</span>), (<span class="number">2</span>, <span class="string">&quot;qjzxzxd&quot;</span>, <span class="number">21</span>), (<span class="number">3</span>, <span class="string">&quot;ç±³è™«&quot;</span>, <span class="number">18</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment">// è½¬æ¢ä¸ºDF</span></span><br><span class="line"><span class="keyword">val</span> df = rdd.toDF(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;age&quot;</span>)</span><br><span class="line">df.show()</span><br><span class="line"></span><br><span class="line"><span class="comment">// è½¬æ¢ä¸ºDS</span></span><br><span class="line"><span class="keyword">val</span> ds = df.as[<span class="type">User</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// è½¬æ¢ä¸ºDF</span></span><br><span class="line"><span class="keyword">val</span> df1 = ds.toDF()</span><br><span class="line"></span><br><span class="line"><span class="comment">// è½¬æ¢ä¸ºRDD</span></span><br><span class="line"><span class="keyword">val</span> rdd1 = df1.rdd</span><br><span class="line">rdd1.foreach(row=&gt;&#123;</span><br><span class="line">  println(row.getString(<span class="number">1</span>))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//é‡Šæ”¾èµ„æº</span></span><br><span class="line">spark.stop</span><br></pre></td></tr></table></figure><h4 id="4ã€RDDå’ŒDataSetä¹‹é—´ç›¸äº’è½¬æ¢"><a href="#4ã€RDDå’ŒDataSetä¹‹é—´ç›¸äº’è½¬æ¢" class="headerlink" title="4ã€RDDå’ŒDataSetä¹‹é—´ç›¸äº’è½¬æ¢"></a>4ã€RDDå’ŒDataSetä¹‹é—´ç›¸äº’è½¬æ¢</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®¾ç½®é…ç½®</span></span><br><span class="line"><span class="keyword">val</span> sparkConf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">&quot;local[*]&quot;</span>).setAppName(<span class="string">&quot;Spark SQL&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºSparkSession</span></span><br><span class="line"><span class="keyword">val</span> spark = <span class="type">SparkSession</span></span><br><span class="line">  .builder()</span><br><span class="line">  .appName(<span class="string">&quot;Spark SQL basic example&quot;</span>)</span><br><span class="line">  .config(sparkConf)</span><br><span class="line">  .getOrCreate()</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿›è¡Œè½¬æ¢ä¹‹å‰ï¼Œéœ€è¦å¼•å…¥éšå¼è½¬æ¢è§„åˆ™</span></span><br><span class="line"><span class="keyword">import</span> spark.implicits._</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºRDD</span></span><br><span class="line"><span class="keyword">val</span> rdd = spark.sparkContext.makeRDD(<span class="type">List</span>((<span class="number">1</span>, <span class="string">&quot;michong&quot;</span>, <span class="number">20</span>), (<span class="number">2</span>, <span class="string">&quot;qjzxzxd&quot;</span>, <span class="number">21</span>), (<span class="number">3</span>, <span class="string">&quot;ç±³è™«&quot;</span>, <span class="number">18</span>)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> userRDD = rdd.map&#123;</span><br><span class="line">  <span class="keyword">case</span> (id,name,age)=&gt;&#123;</span><br><span class="line">    <span class="type">User</span>(id,name,age)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//RDDè½¬æ¢ä¸ºDataSet</span></span><br><span class="line"><span class="keyword">val</span> userDS = userRDD.toDS()</span><br><span class="line"></span><br><span class="line"><span class="comment">//Represents the content of the Dataset as an `RDD` of `T`.</span></span><br><span class="line"><span class="keyword">val</span> rdd1 = userDS.rdd</span><br><span class="line"></span><br><span class="line">rdd1.foreach(println)</span><br><span class="line"></span><br><span class="line"><span class="comment">//é‡Šæ”¾èµ„æº</span></span><br><span class="line">spark.stop</span><br></pre></td></tr></table></figure><h4 id="5ã€ç”¨æˆ·è‡ªå®šä¹‰èšåˆå‡½æ•°"><a href="#5ã€ç”¨æˆ·è‡ªå®šä¹‰èšåˆå‡½æ•°" class="headerlink" title="5ã€ç”¨æˆ·è‡ªå®šä¹‰èšåˆå‡½æ•°"></a>5ã€ç”¨æˆ·è‡ªå®šä¹‰èšåˆå‡½æ•°</h4><h5 id="æ–¹å¼ä¸€"><a href="#æ–¹å¼ä¸€" class="headerlink" title="æ–¹å¼ä¸€"></a>æ–¹å¼ä¸€</h5><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">hello4</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">//è®¾ç½®é…ç½®</span></span><br><span class="line">    <span class="keyword">val</span> sparkConf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">&quot;local[*]&quot;</span>).setAppName(<span class="string">&quot;Spark SQL&quot;</span>)</span><br><span class="line">    <span class="comment">//åˆ›å»ºSparkSession</span></span><br><span class="line">    <span class="keyword">val</span> spark = <span class="type">SparkSession</span></span><br><span class="line">      .builder()</span><br><span class="line">      .appName(<span class="string">&quot;Spark SQL basic example&quot;</span>)</span><br><span class="line">      .config(sparkConf)</span><br><span class="line">      .getOrCreate()</span><br><span class="line">    <span class="comment">//åˆ›å»ºèšåˆå‡½æ•°</span></span><br><span class="line">    <span class="keyword">val</span> udaf = <span class="keyword">new</span> <span class="type">MyAgeAvgFunction</span></span><br><span class="line">    spark.udf.register(<span class="string">&quot;avgAge&quot;</span>,udaf)</span><br><span class="line">    <span class="comment">//ä½¿ç”¨èšåˆå‡½æ•°</span></span><br><span class="line">    <span class="keyword">val</span> frame = spark.read.json(<span class="string">&quot;data/user.json&quot;</span>)</span><br><span class="line">    frame.createOrReplaceTempView(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">    spark.sql(<span class="string">&quot;select avgAge(age) from user&quot;</span>).show</span><br><span class="line"></span><br><span class="line">    spark.stop</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜ç”¨æˆ·è‡ªå®šä¹‰èšåˆå‡½æ•°</span></span><br><span class="line"><span class="comment">// 1ï¼‰ç»§æ‰¿UserDefinedAggregateFunction</span></span><br><span class="line"><span class="comment">// 2ï¼‰å®ç°æ–¹æ³•</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyAgeAvgFunction</span> <span class="keyword">extends</span> <span class="title">UserDefinedAggregateFunction</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å‡½æ•°è¾“å…¥çš„æ•°æ®ç»“æ„</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">inputSchema</span></span>: <span class="type">StructType</span> = &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="type">StructType</span>().add(<span class="string">&quot;age&quot;</span>, <span class="type">LongType</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¡ç®—æ—¶çš„æ•°æ®ç»“æ„</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">bufferSchema</span></span>: <span class="type">StructType</span> = &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="type">StructType</span>().add(<span class="string">&quot;sum&quot;</span>, <span class="type">LongType</span>).add(<span class="string">&quot;count&quot;</span>, <span class="type">LongType</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å‡½æ•°è¿”å›çš„æ•°æ®ç±»å‹</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">dataType</span></span>: <span class="type">DataType</span> = <span class="type">DoubleType</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å‡½æ•°æ˜¯å¦ç¨³å®š</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">deterministic</span></span>: <span class="type">Boolean</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//è®¡ç®—ä¹‹å‰çš„ç¼“å†²åŒºçš„åˆå§‹åŒ–</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">initialize</span></span>(buffer: <span class="type">MutableAggregationBuffer</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    buffer(<span class="number">0</span>) = <span class="number">0</span>L</span><br><span class="line">    buffer(<span class="number">1</span>) = <span class="number">0</span>L</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ ¹æ®æŸ¥è¯¢ç»“æœæ›´æ–°ç¼“å†²åŒºçš„æ•°æ®</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">update</span></span>(buffer: <span class="type">MutableAggregationBuffer</span>, input: <span class="type">Row</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    buffer(<span class="number">0</span>) = buffer.getLong(<span class="number">0</span>) + input.getLong(<span class="number">0</span>)</span><br><span class="line">    buffer(<span class="number">1</span>) = buffer.getLong(<span class="number">1</span>) + <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†å¤šä¸ªèŠ‚ç‚¹çš„ç¼“å†²åŒºåˆå¹¶</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">merge</span></span>(buffer1: <span class="type">MutableAggregationBuffer</span>, buffer2: <span class="type">Row</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// sum</span></span><br><span class="line">    buffer1(<span class="number">0</span>) = buffer1.getLong(<span class="number">0</span>) + buffer2.getLong(<span class="number">0</span>)</span><br><span class="line">    <span class="comment">// count</span></span><br><span class="line">    buffer1(<span class="number">1</span>) = buffer1.getLong(<span class="number">1</span>) + buffer2.getLong(<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¡ç®—</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">evaluate</span></span>(buffer: <span class="type">Row</span>): <span class="type">Any</span> = &#123;</span><br><span class="line">    buffer.getLong(<span class="number">0</span>).toDouble / buffer.getLong(<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ–¹å¼äºŒï¼ˆå¼ºç±»å‹ï¼‰"><a href="#æ–¹å¼äºŒï¼ˆå¼ºç±»å‹ï¼‰" class="headerlink" title="æ–¹å¼äºŒï¼ˆå¼ºç±»å‹ï¼‰"></a>æ–¹å¼äºŒï¼ˆå¼ºç±»å‹ï¼‰</h5><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkConf</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.&#123;<span class="type">DataFrame</span>, <span class="type">Dataset</span>, <span class="type">Encoder</span>, <span class="type">Encoders</span>, <span class="type">SparkSession</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.expressions.<span class="type">Aggregator</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">hello5</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">//è®¾ç½®é…ç½®</span></span><br><span class="line">    <span class="keyword">val</span> sparkConf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">&quot;local[*]&quot;</span>).setAppName(<span class="string">&quot;Spark SQL&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºSparkSession</span></span><br><span class="line">    <span class="keyword">val</span> spark = <span class="type">SparkSession</span></span><br><span class="line">      .builder()</span><br><span class="line">      .appName(<span class="string">&quot;Spark SQL basic example&quot;</span>)</span><br><span class="line">      .config(sparkConf)</span><br><span class="line">      .getOrCreate()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼•å…¥éšå¼è½¬æ¢</span></span><br><span class="line">    <span class="keyword">import</span> spark.implicits._</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºèšåˆå‡½æ•°</span></span><br><span class="line">    <span class="keyword">val</span> udaf = <span class="keyword">new</span> <span class="type">MyAgeAvgClassFunction</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°†èšåˆå‡½æ•°è½¬åŒ–ä¸ºæŸ¥è¯¢åˆ—</span></span><br><span class="line">    <span class="keyword">val</span> avgCol = udaf.toColumn.name(<span class="string">&quot;avgAge&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä½¿ç”¨èšåˆå‡½æ•°</span></span><br><span class="line">    <span class="keyword">val</span> frame:<span class="type">DataFrame</span> = spark.read.json(<span class="string">&quot;data/user.json&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> userDS :<span class="type">Dataset</span>[<span class="type">UserBean</span>]= frame.as[<span class="type">UserBean</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åº”ç”¨å‡½æ•°</span></span><br><span class="line">    userDS.select(avgCol).show()</span><br><span class="line">    spark.stop</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">UserBean</span>(<span class="params">name: <span class="type">String</span>, age: <span class="type">BigInt</span></span>)</span></span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">AvgBuffer</span>(<span class="params">var sum: <span class="type">BigInt</span>, var count: <span class="type">Int</span></span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜ç”¨æˆ·è‡ªå®šä¹‰èšåˆå‡½æ•°(å¼ºç±»å‹)</span></span><br><span class="line"><span class="comment">// 1ï¼‰ç»§æ‰¿Aggregator</span></span><br><span class="line"><span class="comment">// 2ï¼‰å®ç°æ–¹æ³•</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyAgeAvgClassFunction</span> <span class="keyword">extends</span> <span class="title">Aggregator</span>[<span class="type">UserBean</span>, <span class="type">AvgBuffer</span>, <span class="type">Double</span>] </span>&#123;</span><br><span class="line">  <span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">zero</span></span>: <span class="type">AvgBuffer</span> = &#123;</span><br><span class="line">    <span class="type">AvgBuffer</span>(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * èšåˆæ•°æ®</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @param b</span></span><br><span class="line"><span class="comment">   * @param a</span></span><br><span class="line"><span class="comment">   * @return</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">reduce</span></span>(b: <span class="type">AvgBuffer</span>, a: <span class="type">UserBean</span>): <span class="type">AvgBuffer</span> = &#123;</span><br><span class="line">    b.sum = b.sum + a.age</span><br><span class="line">    b.count = b.count + <span class="number">1</span></span><br><span class="line">    b</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ç¼“å†²åŒºåˆå¹¶æ“ä½œ</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @param b1</span></span><br><span class="line"><span class="comment">   * @param b2</span></span><br><span class="line"><span class="comment">   * @return</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">merge</span></span>(b1: <span class="type">AvgBuffer</span>, b2: <span class="type">AvgBuffer</span>): <span class="type">AvgBuffer</span> = &#123;</span><br><span class="line">    b1.sum = b1.sum + b2.sum</span><br><span class="line">    b1.count = b1.count + b2.count</span><br><span class="line">    b1</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * å®Œæˆè®¡ç®—</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @param reduction</span></span><br><span class="line"><span class="comment">   * @return</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">finish</span></span>(reduction: <span class="type">AvgBuffer</span>): <span class="type">Double</span> = &#123;</span><br><span class="line">    reduction.sum.toDouble / reduction.count</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">bufferEncoder</span></span>: <span class="type">Encoder</span>[<span class="type">AvgBuffer</span>] = <span class="type">Encoders</span>.product</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">outputEncoder</span></span>: <span class="type">Encoder</span>[<span class="type">Double</span>] = <span class="type">Encoders</span>.scalaDouble</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6ã€Sparkè¿æ¥MySQLæ•°æ®åº“"><a href="#6ã€Sparkè¿æ¥MySQLæ•°æ®åº“" class="headerlink" title="6ã€Sparkè¿æ¥MySQLæ•°æ®åº“"></a>6ã€Sparkè¿æ¥MySQLæ•°æ®åº“</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®¾ç½®é…ç½®</span></span><br><span class="line"><span class="keyword">val</span> sparkConf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">&quot;local[*]&quot;</span>).setAppName(<span class="string">&quot;Spark SQL&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºSparkSession</span></span><br><span class="line"><span class="keyword">val</span> spark = <span class="type">SparkSession</span></span><br><span class="line">  .builder()</span><br><span class="line">  .appName(<span class="string">&quot;Spark SQL basic example&quot;</span>)</span><br><span class="line">  .config(sparkConf)</span><br><span class="line">  .getOrCreate()</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> jdbcDF = spark.read</span><br><span class="line">  .format(<span class="string">&quot;jdbc&quot;</span>)</span><br><span class="line">  .option(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;jdbc:mysql://127.0.0.1:3306/qiniuyun?serverTimezone=CTT&amp;useUnicode=true&amp;characterEncoding=UTF8&quot;</span>)</span><br><span class="line">  .option(<span class="string">&quot;dbtable&quot;</span>, <span class="string">&quot;myfile&quot;</span>)</span><br><span class="line">  .option(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;root&quot;</span>)</span><br><span class="line">  .option(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;root&quot;</span>)</span><br><span class="line">  .load()</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºè§†å›¾</span></span><br><span class="line">jdbcDF.createOrReplaceTempView(<span class="string">&quot;myfile&quot;</span>)</span><br><span class="line"><span class="comment">// æŸ¥è¯¢å‡ºæ•°æ®</span></span><br><span class="line">spark.sql(<span class="string">&quot;select * from myfile&quot;</span>).show</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Spark SQLæ˜¯Sparkç”¨æ¥å¤„ç†ç»“æ„åŒ–æ•°æ®çš„ä¸€ä¸ªæ¨¡å—ï¼Œå®ƒæä¾›äº†2ä¸ªç¼–ç¨‹æŠ½è±¡ï¼šDataFrameå’ŒDataSetï¼Œå¹¶ä¸”ä½œä¸ºåˆ†å¸ƒå¼SQLæŸ¥è¯¢å¼•æ“çš„ä½œç”¨ã€‚</summary>
    
    
    
    <category term="BigData" scheme="https://www.buildworld.cn/categories/BigData/"/>
    
    
    <category term="Spark" scheme="https://www.buildworld.cn/tags/Spark/"/>
    
    <category term="SparkSQL" scheme="https://www.buildworld.cn/tags/SparkSQL/"/>
    
  </entry>
  
  <entry>
    <title>BigData--å¤§æ•°æ®åˆ†æå¼•æ“Spark</title>
    <link href="https://www.buildworld.cn/2020/08/03/BigData-%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%BC%95%E6%93%8ESpark/"/>
    <id>https://www.buildworld.cn/2020/08/03/BigData-%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%BC%95%E6%93%8ESpark/</id>
    <published>2020-08-03T02:23:37.000Z</published>
    <updated>2021-04-09T02:17:15.900Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="ä¸€ã€Sparkè¿è¡Œ"><a href="#ä¸€ã€Sparkè¿è¡Œ" class="headerlink" title="ä¸€ã€Sparkè¿è¡Œ"></a>ä¸€ã€Sparkè¿è¡Œ</h2><h3 id="1ã€Sparkå†…ç½®æ¨¡å—"><a href="#1ã€Sparkå†…ç½®æ¨¡å—" class="headerlink" title="1ã€Sparkå†…ç½®æ¨¡å—"></a>1ã€Sparkå†…ç½®æ¨¡å—</h3><p><img src="https://file.buildworld.cn/img/20200803102434.png"></p><blockquote><ul><li><code>Spark Core</code>ï¼šå®ç°äº†Sparkçš„åŸºæœ¬åŠŸèƒ½ï¼ŒåŒ…å«ä»»åŠ¡è°ƒåº¦ã€å†…å­˜ç®¡ç†ã€é”™è¯¯æ¢å¤ã€ä¸å­˜å‚¨ç³»ç»Ÿäº¤äº’ç­‰æ¨¡å—ã€‚Spark Coreä¸­è¿˜åŒ…å«äº†å¯¹å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†(Resilient Distributed DataSetï¼Œç®€ç§°RDD)çš„APIå®šä¹‰ã€‚ </li><li><code>Spark SQL</code>ï¼šæ˜¯Sparkç”¨æ¥æ“ä½œç»“æ„åŒ–æ•°æ®çš„ç¨‹åºåŒ…ã€‚é€šè¿‡Spark SQLï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ SQLæˆ–è€…Apache Hiveç‰ˆæœ¬çš„SQLæ–¹è¨€(HQL)æ¥æŸ¥è¯¢æ•°æ®ã€‚Spark SQLæ”¯æŒå¤šç§æ•°æ®æºï¼Œæ¯”å¦‚Hiveè¡¨ã€Parquetä»¥åŠJSONç­‰ã€‚ </li><li><code>Spark Streaming</code>ï¼šæ˜¯Sparkæä¾›çš„å¯¹å®æ—¶æ•°æ®è¿›è¡Œæµå¼è®¡ç®—çš„ç»„ä»¶ã€‚æä¾›äº†ç”¨æ¥æ“ä½œæ•°æ®æµçš„APIï¼Œå¹¶ä¸”ä¸Spark Coreä¸­çš„ RDD APIé«˜åº¦å¯¹åº”ã€‚ </li><li><code>Spark MLlib</code>ï¼šæä¾›å¸¸è§çš„æœºå™¨å­¦ä¹ (ML)åŠŸèƒ½çš„ç¨‹åºåº“ã€‚åŒ…æ‹¬åˆ†ç±»ã€å›å½’ã€èšç±»ã€ååŒè¿‡æ»¤ç­‰ï¼Œè¿˜æä¾›äº†æ¨¡å‹è¯„ä¼°ã€æ•°æ® å¯¼å…¥ç­‰é¢å¤–çš„æ”¯æŒåŠŸèƒ½ã€‚ </li><li><code>é›†ç¾¤ç®¡ç†å™¨</code>ï¼šSpark è®¾è®¡ä¸ºå¯ä»¥é«˜æ•ˆåœ°åœ¨ä¸€ä¸ªè®¡ç®—èŠ‚ç‚¹åˆ°æ•°åƒä¸ªè®¡ç®—èŠ‚ç‚¹ä¹‹é—´ä¼¸ç¼©è®¡ ç®—ã€‚ä¸ºäº†å®ç°è¿™æ ·çš„è¦æ±‚ï¼ŒåŒæ—¶è·å¾—æœ€å¤§çµæ´»æ€§ï¼ŒSparkæ”¯æŒåœ¨å„ç§é›†ç¾¤ç®¡ç†å™¨(Cluster Manager)ä¸Šè¿è¡Œï¼ŒåŒ…æ‹¬Hadoop YARNã€Apache Mesosï¼Œä»¥åŠSparkè‡ªå¸¦çš„ä¸€ä¸ªç®€æ˜“è°ƒåº¦ å™¨ï¼Œå«ä½œ<strong>ç‹¬ç«‹è°ƒåº¦å™¨</strong>ã€‚</li></ul></blockquote><h3 id="2ã€sparké€šç”¨è¿è¡Œå»ºè®®æµç¨‹"><a href="#2ã€sparké€šç”¨è¿è¡Œå»ºè®®æµç¨‹" class="headerlink" title="2ã€sparké€šç”¨è¿è¡Œå»ºè®®æµç¨‹"></a>2ã€sparké€šç”¨è¿è¡Œå»ºè®®æµç¨‹</h3><p><img src="https://file.buildworld.cn/img/20200726140437.png"></p><blockquote><ul><li>textFile(â€œinputâ€)ï¼šè¯»å–æœ¬åœ°æ–‡ä»¶inputæ–‡ä»¶å¤¹æ•°æ®ï¼›</li><li>flatMap(_.split(â€œ â€œ))ï¼šå‹å¹³æ“ä½œï¼ŒæŒ‰ç…§ç©ºæ ¼åˆ†å‰²ç¬¦å°†ä¸€è¡Œæ•°æ®æ˜ å°„æˆä¸€ä¸ªä¸ªå•è¯ï¼›</li><li>map((_,1))ï¼šå¯¹æ¯ä¸€ä¸ªå…ƒç´ æ“ä½œï¼Œå°†å•è¯æ˜ å°„ä¸ºå…ƒç»„ï¼›</li><li>reduceByKey(<em>+</em>)ï¼šæŒ‰ç…§keyå°†å€¼è¿›è¡Œèšåˆï¼Œç›¸åŠ ï¼›</li><li>collectï¼šå°†æ•°æ®æ”¶é›†åˆ°Driverç«¯å±•ç¤ºã€‚</li></ul></blockquote><h3 id="3ã€Sparkå’Œyarnè”åŠ¨"><a href="#3ã€Sparkå’Œyarnè”åŠ¨" class="headerlink" title="3ã€Sparkå’Œyarnè”åŠ¨"></a>3ã€Sparkå’Œyarnè”åŠ¨</h3><p><img src="https://file.buildworld.cn/img/20200726174442.png"></p><h2 id="äºŒã€RDDè½¬æ¢"><a href="#äºŒã€RDDè½¬æ¢" class="headerlink" title="äºŒã€RDDè½¬æ¢"></a>äºŒã€RDDè½¬æ¢</h2><h3 id="1ã€-Valueç±»å‹"><a href="#1ã€-Valueç±»å‹" class="headerlink" title="1ã€ Valueç±»å‹"></a>1ã€ Valueç±»å‹</h3><h4 id="1ï¼‰map-func"><a href="#1ï¼‰map-func" class="headerlink" title="1ï¼‰map(func)"></a>1ï¼‰map(func)</h4><blockquote><p>è¿”å›ä¸€ä¸ªæ–°çš„RDDï¼Œè¯¥RDDç”±æ¯ä¸€ä¸ªè¾“å…¥å…ƒç´ ç»è¿‡funcå‡½æ•°è½¬æ¢åç»„æˆ</p></blockquote><h4 id="2ï¼‰mapPartitions-func"><a href="#2ï¼‰mapPartitions-func" class="headerlink" title="2ï¼‰mapPartitions(func)"></a>2ï¼‰mapPartitions(func)</h4><blockquote><p>ç±»ä¼¼äºmapï¼Œä½†ç‹¬ç«‹åœ°åœ¨RDDçš„æ¯ä¸€ä¸ªåˆ†ç‰‡ä¸Šè¿è¡Œï¼Œå› æ­¤åœ¨ç±»å‹ä¸ºTçš„RDDä¸Šè¿è¡Œæ—¶ï¼Œfuncçš„å‡½æ•°ç±»å‹å¿…é¡»æ˜¯Iterator[T] =&gt; Iterator[U]ã€‚å‡è®¾æœ‰Nä¸ªå…ƒç´ ï¼Œæœ‰Mä¸ªåˆ†åŒºï¼Œé‚£ä¹ˆmapçš„å‡½æ•°çš„å°†è¢«è°ƒç”¨Næ¬¡,è€ŒmapPartitionsè¢«è°ƒç”¨Mæ¬¡,ä¸€ä¸ªå‡½æ•°ä¸€æ¬¡å¤„ç†æ‰€æœ‰åˆ†åŒºã€‚</p></blockquote><h4 id="3ï¼‰mapPartitionsWithIndex-func"><a href="#3ï¼‰mapPartitionsWithIndex-func" class="headerlink" title="3ï¼‰mapPartitionsWithIndex(func)"></a>3ï¼‰mapPartitionsWithIndex(func)</h4><blockquote><p>ç±»ä¼¼äºmapPartitionsï¼Œä½†funcå¸¦æœ‰ä¸€ä¸ªæ•´æ•°å‚æ•°è¡¨ç¤ºåˆ†ç‰‡çš„ç´¢å¼•å€¼ï¼Œå› æ­¤åœ¨ç±»å‹ä¸ºTçš„RDDä¸Šè¿è¡Œæ—¶ï¼Œfuncçš„å‡½æ•°ç±»å‹å¿…é¡»æ˜¯(Int, Interator[T]) =&gt; Iterator[U]ï¼›</p></blockquote><p><strong>map()å’ŒmapPartition()çš„åŒºåˆ«</strong></p><blockquote><ul><li>map()ï¼šæ¯æ¬¡å¤„ç†ä¸€æ¡æ•°æ®ã€‚</li><li>mapPartition()ï¼šæ¯æ¬¡å¤„ç†ä¸€ä¸ªåˆ†åŒºçš„æ•°æ®ï¼Œè¿™ä¸ªåˆ†åŒºçš„æ•°æ®å¤„ç†å®Œåï¼ŒåŸRDDä¸­åˆ†åŒºçš„æ•°æ®æ‰èƒ½é‡Šæ”¾ï¼Œå¯èƒ½å¯¼è‡´OOMã€‚</li></ul></blockquote><h4 id="4ï¼‰flatMap-func"><a href="#4ï¼‰flatMap-func" class="headerlink" title="4ï¼‰flatMap(func)"></a>4ï¼‰flatMap(func)</h4><blockquote><p>ç±»ä¼¼äºmapï¼Œä½†æ˜¯æ¯ä¸€ä¸ªè¾“å…¥å…ƒç´ å¯ä»¥è¢«æ˜ å°„ä¸º0æˆ–å¤šä¸ªè¾“å‡ºå…ƒç´ ï¼ˆæ‰€ä»¥funcåº”è¯¥è¿”å›ä¸€ä¸ªåºåˆ—ï¼Œè€Œä¸æ˜¯å•ä¸€å…ƒç´ ï¼‰</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> config = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">&quot;local[*]&quot;</span>).setAppName(<span class="string">&quot;WordCount&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(config)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> listRDD: <span class="type">RDD</span>[<span class="type">List</span>[<span class="type">Int</span>]] = sc.makeRDD(<span class="type">Array</span>(<span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>), <span class="type">List</span>(<span class="number">3</span>, <span class="number">4</span>)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> flatMapRDD = listRDD.flatMap(datas =&gt; datas)</span><br><span class="line"></span><br><span class="line">flatMapRDD.collect().foreach(println)</span><br></pre></td></tr></table></figure><h4 id="5ï¼‰glom"><a href="#5ï¼‰glom" class="headerlink" title="5ï¼‰glom"></a>5ï¼‰glom</h4><blockquote><p>å°†æ¯ä¸€ä¸ªåˆ†åŒºå½¢æˆä¸€ä¸ªæ•°ç»„ï¼Œå½¢æˆæ–°çš„RDDç±»å‹æ—¶RDD[Array[T]]</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> config = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">&quot;local[*]&quot;</span>).setAppName(<span class="string">&quot;WordCount&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(config)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> listRDD = sc.makeRDD(<span class="number">1</span> to <span class="number">16</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> flatMapRDD = listRDD.glom()</span><br><span class="line"></span><br><span class="line">flatMapRDD.collect().foreach(array=&gt;&#123;</span><br><span class="line">  println(array.mkString(<span class="string">&quot;,&quot;</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="6ï¼‰groupBy-func"><a href="#6ï¼‰groupBy-func" class="headerlink" title="6ï¼‰groupBy(func)"></a>6ï¼‰groupBy(func)</h4><blockquote><p>åˆ†ç»„ï¼ŒæŒ‰ç…§ä¼ å…¥å‡½æ•°çš„è¿”å›å€¼è¿›è¡Œåˆ†ç»„ã€‚å°†ç›¸åŒçš„keyå¯¹åº”çš„å€¼æ”¾å…¥ä¸€ä¸ªè¿­ä»£å™¨ã€‚</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> config = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">&quot;local[*]&quot;</span>).setAppName(<span class="string">&quot;WordCount&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(config)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> listRDD = sc.makeRDD(<span class="number">1</span> to <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> groupByRDD = listRDD.groupBy(i =&gt; i % <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">groupByRDD.collect().foreach(println)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰“å°ç»“æœ</span></span><br><span class="line">(<span class="number">0</span>,<span class="type">CompactBuffer</span>(<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">16</span>))</span><br><span class="line">(<span class="number">1</span>,<span class="type">CompactBuffer</span>(<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">15</span>))</span><br></pre></td></tr></table></figure><h4 id="7ï¼‰filter-func"><a href="#7ï¼‰filter-func" class="headerlink" title="7ï¼‰filter(func)"></a>7ï¼‰filter(func)</h4><blockquote><p>è¿‡æ»¤ã€‚è¿”å›ä¸€ä¸ªæ–°çš„RDDï¼Œè¯¥RDDç”±ç»è¿‡funcå‡½æ•°è®¡ç®—åè¿”å›å€¼ä¸ºtrueçš„è¾“å…¥å…ƒç´ ç»„æˆã€‚</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> config = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">&quot;local[*]&quot;</span>).setAppName(<span class="string">&quot;WordCount&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(config)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> listRDD = sc.makeRDD(<span class="number">1</span> to <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> filterRDD = listRDD.filter(i =&gt; (i % <span class="number">2</span>) == <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">filterRDD.collect().foreach(println)</span><br></pre></td></tr></table></figure><h4 id="8ï¼‰sample-withReplacement-fraction-seed"><a href="#8ï¼‰sample-withReplacement-fraction-seed" class="headerlink" title="8ï¼‰sample(withReplacement, fraction, seed)"></a>8ï¼‰sample(withReplacement, fraction, seed)</h4><blockquote><p>ä»¥æŒ‡å®šçš„éšæœºç§å­éšæœºæŠ½æ ·å‡ºæ•°é‡ä¸ºfractionçš„æ•°æ®ï¼ŒwithReplacementè¡¨ç¤ºæ˜¯æŠ½å‡ºçš„æ•°æ®æ˜¯å¦æ”¾å›ï¼Œtrueä¸ºæœ‰æ”¾å›çš„æŠ½æ ·ï¼Œfalseä¸ºæ— æ”¾å›çš„æŠ½æ ·ï¼Œseedç”¨äºæŒ‡å®šéšæœºæ•°ç”Ÿæˆå™¨ç§å­ã€‚</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> config = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">&quot;local[*]&quot;</span>).setAppName(<span class="string">&quot;WordCount&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(config)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> listRDD = sc.makeRDD(<span class="number">1</span> to <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> sampleRDD = listRDD.sample(<span class="literal">false</span>, <span class="number">0.4</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">sampleRDD.collect().foreach(println)</span><br></pre></td></tr></table></figure><h4 id="9ï¼‰distinct-numTasks"><a href="#9ï¼‰distinct-numTasks" class="headerlink" title="9ï¼‰distinct([numTasks]))"></a>9ï¼‰distinct([numTasks]))</h4><blockquote><p>å¯¹æºRDDè¿›è¡Œå»é‡åè¿”å›ä¸€ä¸ªæ–°çš„RDDã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰8ä¸ªå¹¶è¡Œä»»åŠ¡æ¥æ“ä½œï¼Œä½†æ˜¯å¯ä»¥ä¼ å…¥ä¸€ä¸ªå¯é€‰çš„numTaskså‚æ•°æ”¹å˜å®ƒã€‚</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> config = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">&quot;local[*]&quot;</span>).setAppName(<span class="string">&quot;WordCount&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(config)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> listRDD = sc.makeRDD(<span class="number">1</span> to <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> distinctRDD = listRDD.distinct()</span><br><span class="line"></span><br><span class="line">distinctRDD.collect().foreach(println)</span><br></pre></td></tr></table></figure><h4 id="10ï¼‰coalesce-numPartitions"><a href="#10ï¼‰coalesce-numPartitions" class="headerlink" title="10ï¼‰coalesce(numPartitions)"></a>10ï¼‰coalesce(numPartitions)</h4><blockquote><p>ç¼©å‡åˆ†åŒºæ•°ï¼Œç”¨äºå¤§æ•°æ®é›†è¿‡æ»¤åï¼Œæé«˜å°æ•°æ®é›†çš„æ‰§è¡Œæ•ˆç‡ã€‚</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> config = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">&quot;local[*]&quot;</span>).setAppName(<span class="string">&quot;WordCount&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(config)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> listRDD = sc.makeRDD(<span class="number">1</span> to <span class="number">16</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">println(<span class="string">&quot;ç¼©å‡åˆ†åŒºå‰=&quot;</span> + listRDD.partitions.size)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> coalesceRDD = listRDD.coalesce(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">println(<span class="string">&quot;ç¼©å‡åˆ†åŒºå=&quot;</span> + coalesceRDD.partitions.size)</span><br></pre></td></tr></table></figure><h4 id="11ï¼‰-repartition-numPartitions"><a href="#11ï¼‰-repartition-numPartitions" class="headerlink" title="11ï¼‰ repartition(numPartitions)"></a>11ï¼‰ repartition(numPartitions)</h4><blockquote><p>æ ¹æ®åˆ†åŒºæ•°ï¼Œé‡æ–°é€šè¿‡ç½‘ç»œéšæœºæ´—ç‰Œæ‰€æœ‰æ•°æ®ã€‚</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> config = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">&quot;local[*]&quot;</span>).setAppName(<span class="string">&quot;WordCount&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(config)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> listRDD = sc.makeRDD(<span class="number">1</span> to <span class="number">16</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> repartitionRDD = listRDD.repartition(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">repartitionRDD.collect().foreach(println)</span><br></pre></td></tr></table></figure><p><strong>coalesceå’Œrepartitionçš„åŒºåˆ«</strong></p><ul><li><ol><li>coalesceé‡æ–°åˆ†åŒºï¼Œå¯ä»¥é€‰æ‹©æ˜¯å¦è¿›è¡Œshuffleè¿‡ç¨‹ã€‚ç”±å‚æ•°<code>shuffle: Boolean = false/true</code>å†³å®šã€‚</li></ol></li><li><ol start="2"><li>repartitionå®é™…ä¸Šæ˜¯è°ƒç”¨çš„coalesceï¼Œé»˜è®¤æ˜¯è¿›è¡Œshuffleçš„ã€‚æºç å¦‚ä¸‹ï¼š</li></ol></li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">repartition</span></span>(numPartitions: <span class="type">Int</span>)(<span class="keyword">implicit</span> ord: <span class="type">Ordering</span>[<span class="type">T</span>] = <span class="literal">null</span>): <span class="type">RDD</span>[<span class="type">T</span>] = withScope &#123;</span><br><span class="line"> coalesce(numPartitions, shuffle = <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="12ï¼‰sortBy-func-ascending-numTasks"><a href="#12ï¼‰sortBy-func-ascending-numTasks" class="headerlink" title="12ï¼‰sortBy(func,[ascending], [numTasks])"></a>12ï¼‰sortBy(func,[ascending], [numTasks])</h4><blockquote><p>ä½¿ç”¨funcå…ˆå¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼ŒæŒ‰ç…§å¤„ç†åçš„æ•°æ®æ¯”è¾ƒç»“æœæ’åºï¼Œé»˜è®¤ä¸ºæ­£åº(ä»å°åˆ°å¤§)ã€‚</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> config = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">&quot;local[*]&quot;</span>).setAppName(<span class="string">&quot;WordCount&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(config)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> listRDD = sc.makeRDD(<span class="number">1</span> to <span class="number">16</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®‰è£…é™¤ä»¥2ä½™æ•°æ¥æ’åº</span></span><br><span class="line"><span class="keyword">val</span> sortByRDD = listRDD.sortBy(x=&gt;x%<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">sortByRDD.collect().foreach(println)</span><br></pre></td></tr></table></figure><h4 id="13ï¼‰pipe-command-envVars"><a href="#13ï¼‰pipe-command-envVars" class="headerlink" title="13ï¼‰pipe(command, [envVars])"></a>13ï¼‰pipe(command, [envVars])</h4><blockquote><p>ç®¡é“ï¼Œé’ˆå¯¹æ¯ä¸ªåˆ†åŒºï¼Œéƒ½æ‰§è¡Œä¸€ä¸ªshellè„šæœ¬ï¼Œè¿”å›è¾“å‡ºçš„RDDã€‚</p></blockquote><h3 id="2ã€åŒValueç±»å‹"><a href="#2ã€åŒValueç±»å‹" class="headerlink" title="2ã€åŒValueç±»å‹"></a>2ã€åŒValueç±»å‹</h3><h4 id="1ï¼‰union-otherDataset"><a href="#1ï¼‰union-otherDataset" class="headerlink" title="1ï¼‰union(otherDataset)"></a>1ï¼‰union(otherDataset)</h4><blockquote><p>å¯¹æºRDDå’Œå‚æ•°RDDæ±‚å¹¶é›†åè¿”å›ä¸€ä¸ªæ–°çš„RDDã€‚</p></blockquote><h4 id="2ï¼‰subtract-otherDataset"><a href="#2ï¼‰subtract-otherDataset" class="headerlink" title="2ï¼‰subtract (otherDataset)"></a>2ï¼‰subtract (otherDataset)</h4><blockquote><p>è®¡ç®—å·®çš„ä¸€ç§å‡½æ•°ï¼Œå»é™¤ä¸¤ä¸ªRDDä¸­ç›¸åŒçš„å…ƒç´ ï¼Œä¸åŒçš„RDDå°†ä¿ç•™ä¸‹æ¥ã€‚</p></blockquote><h4 id="3ï¼‰intersection-otherDataset"><a href="#3ï¼‰intersection-otherDataset" class="headerlink" title="3ï¼‰intersection(otherDataset)"></a>3ï¼‰intersection(otherDataset)</h4><blockquote><p>å¯¹æºRDDå’Œå‚æ•°RDDæ±‚äº¤é›†åè¿”å›ä¸€ä¸ªæ–°çš„RDDã€‚</p></blockquote><h4 id="4ï¼‰cartesian-otherDataset"><a href="#4ï¼‰cartesian-otherDataset" class="headerlink" title="4ï¼‰cartesian(otherDataset)"></a>4ï¼‰cartesian(otherDataset)</h4><blockquote><p>ç¬›å¡å°”ç§¯<strong>ï¼ˆå°½é‡é¿å…ä½¿ç”¨ï¼‰</strong></p></blockquote><h4 id="5ï¼‰zip-otherDataset"><a href="#5ï¼‰zip-otherDataset" class="headerlink" title="5ï¼‰zip(otherDataset)"></a>5ï¼‰zip(otherDataset)</h4><blockquote><p>å°†ä¸¤ä¸ªRDDç»„åˆæˆKey/Valueå½¢å¼çš„RDD,è¿™é‡Œé»˜è®¤ä¸¤ä¸ªRDDçš„partitionæ•°é‡ä»¥åŠå…ƒç´ æ•°é‡éƒ½ç›¸åŒï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p></blockquote><h3 id="3ã€Key-Valueç±»å‹"><a href="#3ã€Key-Valueç±»å‹" class="headerlink" title="3ã€Key-Valueç±»å‹"></a>3ã€Key-Valueç±»å‹</h3><h4 id="1ï¼‰partitionBy"><a href="#1ï¼‰partitionBy" class="headerlink" title="1ï¼‰partitionBy"></a>1ï¼‰partitionBy</h4><blockquote><p>å¯¹pairRDDè¿›è¡Œåˆ†åŒºæ“ä½œï¼Œå¦‚æœåŸæœ‰çš„partionRDDå’Œç°æœ‰çš„partionRDDæ˜¯ä¸€è‡´çš„è¯å°±ä¸è¿›è¡Œåˆ†åŒºï¼Œ å¦åˆ™ä¼šç”ŸæˆShuffleRDDï¼Œå³ä¼šäº§ç”Ÿshuffleè¿‡ç¨‹ã€‚</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">val</span> config = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">&quot;local[*]&quot;</span>).setAppName(<span class="string">&quot;WordCount&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(config)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">val</span> listRDD = sc.makeRDD(<span class="type">List</span>((<span class="string">&quot;a&quot;</span>,<span class="number">1</span>),(<span class="string">&quot;b&quot;</span>,<span class="number">2</span>),(<span class="string">&quot;c&quot;</span>,<span class="number">3</span>)))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">val</span> partRDD = listRDD.partitionBy(<span class="keyword">new</span> <span class="type">MyPartitioner</span>(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">  partRDD.saveAsTextFile(<span class="string">&quot;output&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è‡ªå®šä¹‰</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPartitioner</span>(<span class="params">partitions:<span class="type">Int</span></span>) <span class="keyword">extends</span> <span class="title">Partitioner</span></span>&#123;</span><br><span class="line">  <span class="comment">//è®¾ç½®åˆ†åŒºæ•°ç›®</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">numPartitions</span></span>: <span class="type">Int</span> = &#123;</span><br><span class="line">    partitions</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//è®¾ç½®æ•°æ®å­˜æ”¾ä½ç½®</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">getPartition</span></span>(key: <span class="type">Any</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">    <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2ï¼‰groupByKey"><a href="#2ï¼‰groupByKey" class="headerlink" title="2ï¼‰groupByKey"></a>2ï¼‰groupByKey</h4><blockquote><p>groupByKeyä¹Ÿæ˜¯å¯¹æ¯ä¸ªkeyè¿›è¡Œæ“ä½œï¼Œä½†åªç”Ÿæˆä¸€ä¸ª<code>sequence</code>ã€‚</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> config = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">&quot;local[*]&quot;</span>).setAppName(<span class="string">&quot;WordCount&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(config)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> words = <span class="type">Array</span>(<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;three&quot;</span>, <span class="string">&quot;three&quot;</span>, <span class="string">&quot;three&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> wordPairsRDD = sc.parallelize(words).map(word =&gt; (word, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> group = wordPairsRDD.groupByKey()</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°†ç›¸åŒkeyå¯¹åº”å€¼èšåˆåˆ°ä¸€ä¸ªsequenceä¸­</span></span><br><span class="line">group.collect().foreach(println)</span><br><span class="line"><span class="comment">//è®¡ç®—ç›¸åŒkeyå¯¹åº”å€¼çš„ç›¸åŠ ç»“æœ</span></span><br><span class="line">group.map(t=&gt;(t._1,t._2.sum)).foreach(println)</span><br></pre></td></tr></table></figure><h4 id="3ï¼‰reduceByKey-func-numTasks"><a href="#3ï¼‰reduceByKey-func-numTasks" class="headerlink" title="3ï¼‰reduceByKey(func, [numTasks])"></a>3ï¼‰reduceByKey(func, [numTasks])</h4><blockquote><p>åœ¨ä¸€ä¸ª(K,V)çš„RDDä¸Šè°ƒç”¨ï¼Œè¿”å›ä¸€ä¸ª(K,V)çš„RDDï¼Œä½¿ç”¨æŒ‡å®šçš„reduceå‡½æ•°ï¼Œå°†ç›¸åŒkeyçš„å€¼èšåˆåˆ°ä¸€èµ·ï¼Œreduceä»»åŠ¡çš„ä¸ªæ•°å¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå¯é€‰çš„å‚æ•°æ¥è®¾ç½®ã€‚</p></blockquote><p><strong>reduceByKeyå’ŒgroupByKeyçš„åŒºåˆ«</strong></p><blockquote><ul><li><ol><li>reduceByKeyï¼šæŒ‰ç…§keyè¿›è¡Œèšåˆï¼Œåœ¨shuffleä¹‹å‰æœ‰combineï¼ˆé¢„èšåˆï¼‰æ“ä½œï¼Œè¿”å›ç»“æœæ˜¯RDD[k,v].</li></ol></li><li><ol start="2"><li>groupByKeyï¼šæŒ‰ç…§keyè¿›è¡Œåˆ†ç»„ï¼Œç›´æ¥è¿›è¡Œshuffleã€‚</li></ol></li><li><ol start="3"><li>å¼€å‘æŒ‡å¯¼ï¼šreduceByKeyæ¯”groupByKeyå¿«ï¼Œå»ºè®®ä½¿ç”¨ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„æ˜¯å¦ä¼šå½±å“ä¸šåŠ¡é€»è¾‘ã€‚</li></ol></li></ul></blockquote><p><img src="https://file.buildworld.cn/img/20200803194634.png"></p><h4 id="4ï¼‰aggregateByKey"><a href="#4ï¼‰aggregateByKey" class="headerlink" title="4ï¼‰aggregateByKey"></a>4ï¼‰aggregateByKey</h4><blockquote><p>å‚æ•°ï¼š<code>(zeroValue:U,[partitioner: Partitioner]) (seqOp: (U, V) =&gt; U,combOp: (U, U) =&gt; U)</code></p><ul><li><ol><li>ä½œç”¨ï¼šåœ¨kvå¯¹çš„RDDä¸­ï¼Œï¼ŒæŒ‰keyå°†valueè¿›è¡Œåˆ†ç»„åˆå¹¶ï¼Œåˆå¹¶æ—¶ï¼Œå°†æ¯ä¸ªvalueå’Œåˆå§‹å€¼ä½œä¸ºseqå‡½æ•°çš„å‚æ•°ï¼Œè¿›è¡Œè®¡ç®—ï¼Œè¿”å›çš„ç»“æœä½œä¸ºä¸€ä¸ªæ–°çš„kvå¯¹ï¼Œç„¶åå†å°†ç»“æœæŒ‰ç…§keyè¿›è¡Œåˆå¹¶ï¼Œæœ€åå°†æ¯ä¸ªåˆ†ç»„çš„valueä¼ é€’ç»™combineå‡½æ•°è¿›è¡Œè®¡ç®—ï¼ˆå…ˆå°†å‰ä¸¤ä¸ªvalueè¿›è¡Œè®¡ç®—ï¼Œå°†è¿”å›ç»“æœå’Œä¸‹ä¸€ä¸ªvalueä¼ ç»™combineå‡½æ•°ï¼Œä»¥æ­¤ç±»æ¨ï¼‰ï¼Œå°†keyä¸è®¡ç®—ç»“æœä½œä¸ºä¸€ä¸ªæ–°çš„kvå¯¹è¾“å‡ºã€‚</li></ol></li><li><ol start="2"><li>å‚æ•°æè¿°ï¼š</li></ol></li></ul><p>ï¼ˆ1ï¼‰<code>zeroValue</code>ï¼šç»™æ¯ä¸€ä¸ªåˆ†åŒºä¸­çš„æ¯ä¸€ä¸ªkeyä¸€ä¸ªåˆå§‹å€¼ï¼›</p><p>ï¼ˆ2ï¼‰<code>seqOp</code>ï¼šå‡½æ•°ç”¨äºåœ¨æ¯ä¸€ä¸ªåˆ†åŒºä¸­ç”¨åˆå§‹å€¼é€æ­¥è¿­ä»£valueï¼›</p><p>ï¼ˆ3ï¼‰<code>combOp</code>ï¼šå‡½æ•°ç”¨äºåˆå¹¶æ¯ä¸ªåˆ†åŒºä¸­çš„ç»“æœã€‚</p></blockquote><p><img src="https://file.buildworld.cn/img/20200804105505.png"></p><p><strong>åˆ›å»ºä¸€ä¸ªpairRDDï¼Œå–å‡ºæ¯ä¸ªåˆ†åŒºç›¸åŒkeyå¯¹åº”å€¼çš„æœ€å¤§å€¼ï¼Œç„¶åç›¸åŠ </strong></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> config = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">&quot;local[*]&quot;</span>).setAppName(<span class="string">&quot;WordCount&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(config)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>((<span class="string">&quot;a&quot;</span>, <span class="number">3</span>), (<span class="string">&quot;a&quot;</span>, <span class="number">2</span>), (<span class="string">&quot;c&quot;</span>, <span class="number">4</span>), (<span class="string">&quot;b&quot;</span>, <span class="number">3</span>), (<span class="string">&quot;c&quot;</span>, <span class="number">6</span>), (<span class="string">&quot;c&quot;</span>, <span class="number">8</span>)), <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">rdd.glom().collect().foreach(println)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> value = rdd.aggregateByKey(<span class="number">0</span>)(math.max(_, _), _ + _)</span><br><span class="line"></span><br><span class="line">value.collect().foreach(println)</span><br></pre></td></tr></table></figure><h4 id="5ï¼‰foldByKey"><a href="#5ï¼‰foldByKey" class="headerlink" title="5ï¼‰foldByKey"></a>5ï¼‰foldByKey</h4><blockquote><p>å‚æ•°ï¼š<code>(zeroValue: V)(func: (V, V) =&gt; V): RDD[(K, V)]</code></p></blockquote><ul><li><ol><li>ä½œç”¨ï¼šaggregateByKeyçš„ç®€åŒ–æ“ä½œï¼Œseqopå’Œcombopç›¸åŒ</li></ol></li><li><ol start="2"><li>éœ€æ±‚ï¼šåˆ›å»ºä¸€ä¸ªpairRDDï¼Œè®¡ç®—ç›¸åŒkeyå¯¹åº”å€¼çš„ç›¸åŠ ç»“æœ</li></ol></li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> agg = rdd.foldByKey(<span class="number">0</span>)(_+_)</span><br></pre></td></tr></table></figure><h4 id="6ï¼‰combineByKey-C"><a href="#6ï¼‰combineByKey-C" class="headerlink" title="6ï¼‰combineByKey[C]"></a>6ï¼‰combineByKey[C]</h4><blockquote><p>å‚æ•°ï¼š<code>(createCombiner: V =&gt; C, mergeValue: (C, V) =&gt; C, mergeCombiners: (C, C) =&gt; C)</code> </p></blockquote><blockquote><ul><li><ol><li>ä½œç”¨ï¼šå¯¹ç›¸åŒKï¼ŒæŠŠVåˆå¹¶æˆä¸€ä¸ªé›†åˆã€‚</li></ol></li><li><ol start="2"><li>å‚æ•°æè¿°ï¼š</li></ol><p>ï¼ˆ1ï¼‰createCombiner: combineByKey() ä¼šéå†åˆ†åŒºä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œå› æ­¤æ¯ä¸ªå…ƒç´ çš„é”®è¦ä¹ˆè¿˜æ²¡æœ‰é‡åˆ°è¿‡ï¼Œè¦ä¹ˆå°±å’Œä¹‹å‰çš„æŸä¸ªå…ƒç´ çš„é”®ç›¸åŒã€‚å¦‚æœè¿™æ˜¯ä¸€ä¸ªæ–°çš„å…ƒç´ ,combineByKey()ä¼šä½¿ç”¨ä¸€ä¸ªå«ä½œcreateCombiner()çš„å‡½æ•°æ¥åˆ›å»ºé‚£ä¸ªé”®å¯¹åº”çš„ç´¯åŠ å™¨çš„åˆå§‹å€¼</p><p>ï¼ˆ2ï¼‰mergeValue: å¦‚æœè¿™æ˜¯ä¸€ä¸ªåœ¨å¤„ç†å½“å‰åˆ†åŒºä¹‹å‰å·²ç»é‡åˆ°çš„é”®ï¼Œå®ƒä¼šä½¿ç”¨mergeValue()æ–¹æ³•å°†è¯¥é”®çš„ç´¯åŠ å™¨å¯¹åº”çš„å½“å‰å€¼ä¸è¿™ä¸ªæ–°çš„å€¼è¿›è¡Œåˆå¹¶</p><p>ï¼ˆ3ï¼‰mergeCombiners: ç”±äºæ¯ä¸ªåˆ†åŒºéƒ½æ˜¯ç‹¬ç«‹å¤„ç†çš„ï¼Œ å› æ­¤å¯¹äºåŒä¸€ä¸ªé”®å¯ä»¥æœ‰å¤šä¸ªç´¯åŠ å™¨ã€‚å¦‚æœæœ‰ä¸¤ä¸ªæˆ–è€…æ›´å¤šçš„åˆ†åŒºéƒ½æœ‰å¯¹åº”åŒä¸€ä¸ªé”®çš„ç´¯åŠ å™¨ï¼Œ å°±éœ€è¦ä½¿ç”¨ç”¨æˆ·æä¾›çš„ mergeCombiners() æ–¹æ³•å°†å„ä¸ªåˆ†åŒºçš„ç»“æœè¿›è¡Œåˆå¹¶ã€‚</p></li></ul></blockquote><p><img src="https://file.buildworld.cn/img/20200804152509.png"></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> config = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">&quot;local[*]&quot;</span>).setAppName(<span class="string">&quot;WordCount&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(config)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> input = sc.parallelize(<span class="type">Array</span>((<span class="string">&quot;a&quot;</span>, <span class="number">88</span>), (<span class="string">&quot;b&quot;</span>, <span class="number">95</span>), (<span class="string">&quot;a&quot;</span>, <span class="number">91</span>), (<span class="string">&quot;b&quot;</span>, <span class="number">93</span>), (<span class="string">&quot;a&quot;</span>, <span class="number">95</span>), (<span class="string">&quot;b&quot;</span>, <span class="number">98</span>)),<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> value = input.combineByKey(x =&gt; x, (x: <span class="type">Int</span>, y: <span class="type">Int</span>) =&gt; x + y, (x: <span class="type">Int</span>, y: <span class="type">Int</span>) =&gt; x + y)</span><br><span class="line"></span><br><span class="line">value.collect().foreach(println)</span><br></pre></td></tr></table></figure><h4 id="7ï¼‰sortByKey-ascending-numTasks"><a href="#7ï¼‰sortByKey-ascending-numTasks" class="headerlink" title="7ï¼‰sortByKey([ascending], [numTasks])"></a>7ï¼‰sortByKey([ascending], [numTasks])</h4><blockquote><p>ä½œç”¨ï¼šåœ¨ä¸€ä¸ª(K,V)çš„RDDä¸Šè°ƒç”¨ï¼ŒKå¿…é¡»å®ç°Orderedæ¥å£ï¼Œè¿”å›ä¸€ä¸ªæŒ‰ç…§keyè¿›è¡Œæ’åºçš„(K,V)çš„RDD</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> input = sc.parallelize(<span class="type">Array</span>((<span class="string">&quot;a&quot;</span>, <span class="number">88</span>), (<span class="string">&quot;b&quot;</span>, <span class="number">95</span>), (<span class="string">&quot;a&quot;</span>, <span class="number">91</span>), (<span class="string">&quot;b&quot;</span>, <span class="number">93</span>), (<span class="string">&quot;a&quot;</span>, <span class="number">95</span>), (<span class="string">&quot;b&quot;</span>, <span class="number">98</span>)),<span class="number">2</span>)</span><br><span class="line"><span class="keyword">val</span> value1 = input.sortByKey(<span class="literal">true</span>)</span><br></pre></td></tr></table></figure><h4 id="8ï¼‰mapValues"><a href="#8ï¼‰mapValues" class="headerlink" title="8ï¼‰mapValues"></a>8ï¼‰mapValues</h4><blockquote><p>é’ˆå¯¹äº(K,V)å½¢å¼çš„ç±»å‹åªå¯¹Vè¿›è¡Œæ“ä½œ</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> config = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">&quot;local[*]&quot;</span>).setAppName(<span class="string">&quot;WordCount&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(config)</span><br><span class="line"><span class="keyword">val</span> input = sc.parallelize(<span class="type">Array</span>((<span class="string">&quot;a&quot;</span>, <span class="number">88</span>), (<span class="string">&quot;b&quot;</span>, <span class="number">95</span>), (<span class="string">&quot;a&quot;</span>, <span class="number">91</span>), (<span class="string">&quot;b&quot;</span>, <span class="number">93</span>), (<span class="string">&quot;a&quot;</span>, <span class="number">95</span>), (<span class="string">&quot;b&quot;</span>, <span class="number">98</span>)), <span class="number">2</span>)</span><br><span class="line"><span class="keyword">val</span> value1 = input.mapValues(_ + <span class="number">100</span>)</span><br><span class="line">value1.collect().foreach(println)</span><br></pre></td></tr></table></figure><h4 id="9ï¼‰join-otherDataset-numTasks"><a href="#9ï¼‰join-otherDataset-numTasks" class="headerlink" title="9ï¼‰join(otherDataset, [numTasks])"></a>9ï¼‰join(otherDataset, [numTasks])</h4><blockquote><p>åœ¨ç±»å‹ä¸º(K,V)å’Œ(K,W)çš„RDDä¸Šè°ƒç”¨ï¼Œè¿”å›ä¸€ä¸ªç›¸åŒkeyå¯¹åº”çš„æ‰€æœ‰å…ƒç´ å¯¹åœ¨ä¸€èµ·çš„(K,(V,W))çš„RDD</p></blockquote><h4 id="10ï¼‰cogroup-otherDataset-numTasks"><a href="#10ï¼‰cogroup-otherDataset-numTasks" class="headerlink" title="10ï¼‰cogroup(otherDataset, [numTasks])"></a>10ï¼‰cogroup(otherDataset, [numTasks])</h4><blockquote><p>åœ¨ç±»å‹ä¸º(K,V)å’Œ(K,W)çš„RDDä¸Šè°ƒç”¨ï¼Œè¿”å›ä¸€ä¸ª(K,(Iterable<V>,Iterable<W>))ç±»å‹çš„RDD</p></blockquote><h3 id="ä¸‰ã€Actionï¼ˆè¡ŒåŠ¨ç®—å­ï¼‰"><a href="#ä¸‰ã€Actionï¼ˆè¡ŒåŠ¨ç®—å­ï¼‰" class="headerlink" title="ä¸‰ã€Actionï¼ˆè¡ŒåŠ¨ç®—å­ï¼‰"></a>ä¸‰ã€Actionï¼ˆè¡ŒåŠ¨ç®—å­ï¼‰</h3><h4 id="1ï¼‰reduce-func"><a href="#1ï¼‰reduce-func" class="headerlink" title="1ï¼‰reduce(func)"></a>1ï¼‰reduce(func)</h4><blockquote><p>é€šè¿‡funcå‡½æ•°èšé›†RDDä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œå…ˆèšåˆåˆ†åŒºå†…æ•°æ®ï¼Œå†èšåˆåˆ†åŒºé—´æ•°æ®ã€‚</p></blockquote><h4 id="2ï¼‰collect"><a href="#2ï¼‰collect" class="headerlink" title="2ï¼‰collect()"></a>2ï¼‰collect()</h4><blockquote><p>åœ¨é©±åŠ¨ç¨‹åºä¸­ï¼Œä»¥æ•°ç»„çš„å½¢å¼è¿”å›æ•°æ®é›†çš„æ‰€æœ‰å…ƒç´ ã€‚</p></blockquote><h4 id="3ï¼‰-count"><a href="#3ï¼‰-count" class="headerlink" title="3ï¼‰ count()"></a>3ï¼‰ count()</h4><blockquote><p>è¿”å›RDDä¸­å…ƒç´ çš„ä¸ªæ•°</p></blockquote><h4 id="4ï¼‰first"><a href="#4ï¼‰first" class="headerlink" title="4ï¼‰first()"></a>4ï¼‰first()</h4><blockquote><p>è¿”å›RDDä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ </p></blockquote><h4 id="5ï¼‰take-n"><a href="#5ï¼‰take-n" class="headerlink" title="5ï¼‰take(n)"></a>5ï¼‰take(n)</h4><blockquote><p>è¿”å›ä¸€ä¸ªç”±RDDçš„å‰nä¸ªå…ƒç´ ç»„æˆçš„æ•°ç»„</p></blockquote><h4 id="6ï¼‰takeOrdered-n"><a href="#6ï¼‰takeOrdered-n" class="headerlink" title="6ï¼‰takeOrdered(n)"></a>6ï¼‰takeOrdered(n)</h4><blockquote><p>è¿”å›è¯¥RDDæ’åºåçš„å‰nä¸ªå…ƒç´ ç»„æˆçš„æ•°ç»„</p></blockquote><h4 id="7ï¼‰aggregate-num-func1-func2"><a href="#7ï¼‰aggregate-num-func1-func2" class="headerlink" title="7ï¼‰aggregate(num)(func1)(func2)"></a>7ï¼‰aggregate(num)(func1)(func2)</h4><blockquote><ul><li><ol><li>å‚æ•°ï¼š(zeroValue: U)(seqOp: (U, T) â‡’ U, combOp: (U, U) â‡’ U)</li></ol></li><li><ol start="2"><li>ä½œç”¨ï¼šaggregateå‡½æ•°å°†æ¯ä¸ªåˆ†åŒºé‡Œé¢çš„å…ƒç´ é€šè¿‡seqOpå’Œåˆå§‹å€¼è¿›è¡Œèšåˆï¼Œç„¶åç”¨combineå‡½æ•°å°†æ¯ä¸ªåˆ†åŒºçš„ç»“æœå’Œåˆå§‹å€¼(zeroValue)è¿›è¡Œcombineæ“ä½œã€‚è¿™ä¸ªå‡½æ•°æœ€ç»ˆè¿”å›çš„ç±»å‹ä¸éœ€è¦å’ŒRDDä¸­å…ƒç´ ç±»å‹ä¸€è‡´ã€‚</li></ol></li></ul></blockquote><h4 id="8ï¼‰fold-num-func"><a href="#8ï¼‰fold-num-func" class="headerlink" title="8ï¼‰fold(num)(func)"></a>8ï¼‰fold(num)(func)</h4><blockquote><p>ä½œç”¨ï¼šæŠ˜å æ“ä½œï¼Œaggregateçš„ç®€åŒ–æ“ä½œï¼Œseqopå’Œcombopä¸€æ ·ã€‚</p></blockquote><h4 id="9ï¼‰saveAsTextFile-path"><a href="#9ï¼‰saveAsTextFile-path" class="headerlink" title="9ï¼‰saveAsTextFile(path)"></a>9ï¼‰saveAsTextFile(path)</h4><blockquote><p>å°†æ•°æ®é›†çš„å…ƒç´ ä»¥textfileçš„å½¢å¼ä¿å­˜åˆ°HDFSæ–‡ä»¶ç³»ç»Ÿæˆ–è€…å…¶ä»–æ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¯¹äºæ¯ä¸ªå…ƒç´ ï¼ŒSparkå°†ä¼šè°ƒç”¨toStringæ–¹æ³•ï¼Œå°†å®ƒè£…æ¢ä¸ºæ–‡ä»¶ä¸­çš„æ–‡æœ¬</p></blockquote><h4 id="10ï¼‰saveAsSequenceFile-path"><a href="#10ï¼‰saveAsSequenceFile-path" class="headerlink" title="10ï¼‰saveAsSequenceFile(path)"></a>10ï¼‰saveAsSequenceFile(path)</h4><blockquote><p>å°†æ•°æ®é›†ä¸­çš„å…ƒç´ ä»¥Hadoop sequencefileçš„æ ¼å¼ä¿å­˜åˆ°æŒ‡å®šçš„ç›®å½•ä¸‹ï¼Œå¯ä»¥ä½¿HDFSæˆ–è€…å…¶ä»–Hadoopæ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿã€‚</p></blockquote><h4 id="11ï¼‰saveAsObjectFile-path"><a href="#11ï¼‰saveAsObjectFile-path" class="headerlink" title="11ï¼‰saveAsObjectFile(path)"></a>11ï¼‰saveAsObjectFile(path)</h4><blockquote><p>ç”¨äºå°†RDDä¸­çš„å…ƒç´ åºåˆ—åŒ–æˆå¯¹è±¡ï¼Œå­˜å‚¨åˆ°æ–‡ä»¶ä¸­ã€‚</p></blockquote><h4 id="12ï¼‰-countByKey"><a href="#12ï¼‰-countByKey" class="headerlink" title="12ï¼‰ countByKey()"></a>12ï¼‰ countByKey()</h4><blockquote><p>é’ˆå¯¹(K,V)ç±»å‹çš„RDDï¼Œè¿”å›ä¸€ä¸ª(K,Int)çš„mapï¼Œè¡¨ç¤ºæ¯ä¸€ä¸ªkeyå¯¹åº”çš„å…ƒç´ ä¸ªæ•°ã€‚</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd = sc.parallelize(<span class="type">List</span>((<span class="number">1</span>,<span class="number">3</span>),(<span class="number">1</span>,<span class="number">2</span>),(<span class="number">1</span>,<span class="number">4</span>),(<span class="number">2</span>,<span class="number">3</span>),(<span class="number">3</span>,<span class="number">6</span>),(<span class="number">3</span>,<span class="number">8</span>)),<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> total = rdd.countByKey()</span><br><span class="line"></span><br><span class="line">println(total)</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰“å°ç»“æœ</span></span><br><span class="line"><span class="type">Map</span>(<span class="number">3</span> -&gt; <span class="number">2</span>, <span class="number">1</span> -&gt; <span class="number">3</span>, <span class="number">2</span> -&gt; <span class="number">1</span>)</span><br></pre></td></tr></table></figure><h4 id="13ï¼‰-foreach-func"><a href="#13ï¼‰-foreach-func" class="headerlink" title="13ï¼‰ foreach(func)"></a>13ï¼‰ foreach(func)</h4><blockquote><p>åœ¨æ•°æ®é›†çš„æ¯ä¸€ä¸ªå…ƒç´ ä¸Šï¼Œè¿è¡Œå‡½æ•°funcè¿›è¡Œæ›´æ–°ã€‚</p></blockquote><h3 id="å››ã€RDDä¾èµ–å…³ç³»"><a href="#å››ã€RDDä¾èµ–å…³ç³»" class="headerlink" title="å››ã€RDDä¾èµ–å…³ç³»"></a>å››ã€RDDä¾èµ–å…³ç³»</h3><h4 id="1ï¼‰Lineage"><a href="#1ï¼‰Lineage" class="headerlink" title="1ï¼‰Lineage"></a>1ï¼‰Lineage</h4><blockquote><p>RDDåªæ”¯æŒç²—ç²’åº¦è½¬æ¢ï¼Œå³åœ¨å¤§é‡è®°å½•ä¸Šæ‰§è¡Œçš„å•ä¸ªæ“ä½œã€‚å°†åˆ›å»ºRDDçš„ä¸€ç³»åˆ—<code>Lineage</code>ï¼ˆè¡€ç»Ÿï¼‰è®°å½•ä¸‹æ¥ï¼Œä»¥ä¾¿æ¢å¤ä¸¢å¤±çš„åˆ†åŒºã€‚RDDçš„<code>Lineage</code>ä¼šè®°å½•RDDçš„å…ƒæ•°æ®ä¿¡æ¯å’Œè½¬æ¢è¡Œä¸ºï¼Œå½“è¯¥RDDçš„éƒ¨åˆ†åˆ†åŒºæ•°æ®ä¸¢å¤±æ—¶ï¼Œå®ƒå¯ä»¥æ ¹æ®è¿™äº›ä¿¡æ¯æ¥é‡æ–°è¿ç®—å’Œæ¢å¤ä¸¢å¤±çš„æ•°æ®åˆ†åŒºã€‚</p></blockquote><h4 id="2ï¼‰çª„ä¾èµ–"><a href="#2ï¼‰çª„ä¾èµ–" class="headerlink" title="2ï¼‰çª„ä¾èµ–"></a>2ï¼‰çª„ä¾èµ–</h4><blockquote><p>çª„ä¾èµ–æŒ‡çš„æ˜¯æ¯ä¸€ä¸ªçˆ¶RDDçš„Partitionæœ€å¤šè¢«å­RDDçš„ä¸€ä¸ªPartitionä½¿ç”¨.</p></blockquote><h4 id="3ï¼‰å®½ä¾èµ–"><a href="#3ï¼‰å®½ä¾èµ–" class="headerlink" title="3ï¼‰å®½ä¾èµ–"></a>3ï¼‰å®½ä¾èµ–</h4><blockquote><p>å®½ä¾èµ–æŒ‡çš„æ˜¯å¤šä¸ªå­RDDçš„Partitionä¼šä¾èµ–åŒä¸€ä¸ªçˆ¶RDDçš„Partitionï¼Œä¼šå¼•èµ·shuffle.</p></blockquote><h4 id="4ï¼‰DAG-Directed-Acyclic-Graph"><a href="#4ï¼‰DAG-Directed-Acyclic-Graph" class="headerlink" title="4ï¼‰DAG(Directed Acyclic Graph)"></a>4ï¼‰DAG(Directed Acyclic Graph)</h4><blockquote><p>DAG(Directed Acyclic Graph)å«åšæœ‰å‘æ— ç¯å›¾ï¼ŒåŸå§‹çš„RDDé€šè¿‡ä¸€ç³»åˆ—çš„è½¬æ¢å°±å°±å½¢æˆäº†DAGï¼Œæ ¹æ®RDDä¹‹é—´çš„ä¾èµ–å…³ç³»çš„ä¸åŒå°†DAGåˆ’åˆ†æˆä¸åŒçš„Stageï¼Œå¯¹äºçª„ä¾èµ–ï¼Œpartitionçš„è½¬æ¢å¤„ç†åœ¨Stageä¸­å®Œæˆè®¡ç®—ã€‚å¯¹äºå®½ä¾èµ–ï¼Œç”±äºæœ‰Shuffleçš„å­˜åœ¨ï¼Œåªèƒ½åœ¨parent RDDå¤„ç†å®Œæˆåï¼Œæ‰èƒ½å¼€å§‹æ¥ä¸‹æ¥çš„è®¡ç®—ï¼Œå› æ­¤<strong>å®½ä¾èµ–æ˜¯åˆ’åˆ†Stageçš„ä¾æ®</strong>ã€‚</p></blockquote><p><img src="https://file.buildworld.cn/img/20200807164413.png"></p><h3 id="äº”ã€ç´¯åŠ å™¨"><a href="#äº”ã€ç´¯åŠ å™¨" class="headerlink" title="äº”ã€ç´¯åŠ å™¨"></a>äº”ã€ç´¯åŠ å™¨</h3><blockquote><p>ç´¯åŠ å™¨ç”¨æ¥å¯¹ä¿¡æ¯è¿›è¡Œèšåˆï¼Œé€šå¸¸åœ¨å‘ Sparkä¼ é€’å‡½æ•°æ—¶ï¼Œæ¯”å¦‚ä½¿ç”¨ map() å‡½æ•°æˆ–è€…ç”¨ filter() ä¼ æ¡ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨é©±åŠ¨å™¨ç¨‹åºä¸­å®šä¹‰çš„å˜é‡ï¼Œä½†æ˜¯é›†ç¾¤ä¸­è¿è¡Œçš„æ¯ä¸ªä»»åŠ¡éƒ½ä¼šå¾—åˆ°è¿™äº›å˜é‡çš„ä¸€ä»½æ–°çš„å‰¯æœ¬ï¼Œæ›´æ–°è¿™äº›å‰¯æœ¬çš„å€¼ä¹Ÿä¸ä¼šå½±å“é©±åŠ¨å™¨ä¸­çš„å¯¹åº”å˜é‡ã€‚å¦‚æœæˆ‘ä»¬æƒ³å®ç°æ‰€æœ‰åˆ†ç‰‡å¤„ç†æ—¶æ›´æ–°å…±äº«å˜é‡çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆç´¯åŠ å™¨å¯ä»¥å®ç°æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> config = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">&quot;local[*]&quot;</span>).setAppName(<span class="string">&quot;WordCount&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(config)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> rdd: <span class="type">RDD</span>[<span class="type">Int</span>] = sc.makeRDD(<span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>), <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºç´¯åŠ å™¨å¯¹è±¡</span></span><br><span class="line"><span class="keyword">val</span> accumulator: <span class="type">LongAccumulator</span> = sc.longAccumulator</span><br><span class="line"></span><br><span class="line">rdd.foreach &#123;</span><br><span class="line">  <span class="keyword">case</span> i =&gt; &#123;</span><br><span class="line">    <span class="comment">//æ‰§è¡Œç´¯åŠ å™¨çš„ç´¯åŠ åŠŸèƒ½</span></span><br><span class="line">    accumulator.add(i)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è·å–ç´¯åŠ å™¨ä¿å­˜çš„å€¼</span></span><br><span class="line">println(accumulator.value)</span><br></pre></td></tr></table></figure><h4 id="è‡ªå®šä¹‰ç´¯åŠ å™¨"><a href="#è‡ªå®šä¹‰ç´¯åŠ å™¨" class="headerlink" title="è‡ªå®šä¹‰ç´¯åŠ å™¨"></a>è‡ªå®šä¹‰ç´¯åŠ å™¨</h4><blockquote><p>è‡ªå®šä¹‰ç´¯åŠ å™¨ç±»å‹çš„åŠŸèƒ½åœ¨1.Xç‰ˆæœ¬ä¸­å°±å·²ç»æä¾›äº†ï¼Œä½†æ˜¯ä½¿ç”¨èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œåœ¨2.0ç‰ˆæœ¬åï¼Œç´¯åŠ å™¨çš„æ˜“ç”¨æ€§æœ‰äº†è¾ƒå¤§çš„æ”¹è¿›ï¼Œè€Œä¸”å®˜æ–¹è¿˜æä¾›äº†ä¸€ä¸ªæ–°çš„æŠ½è±¡ç±»ï¼š<code>AccumulatorV2</code>æ¥æä¾›æ›´åŠ å‹å¥½çš„è‡ªå®šä¹‰ç±»å‹ç´¯åŠ å™¨çš„å®ç°æ–¹å¼ã€‚å®ç°è‡ªå®šä¹‰ç±»å‹ç´¯åŠ å™¨éœ€è¦ç»§æ‰¿<code>AccumulatorV2</code>å¹¶è‡³å°‘è¦†å†™ä¸‹ä¾‹ä¸­å‡ºç°çš„æ–¹æ³•ã€‚</p></blockquote><h3 id="å…­ã€å¹¿æ’­å˜é‡ï¼ˆè°ƒä¼˜ç­–ç•¥ï¼‰"><a href="#å…­ã€å¹¿æ’­å˜é‡ï¼ˆè°ƒä¼˜ç­–ç•¥ï¼‰" class="headerlink" title="å…­ã€å¹¿æ’­å˜é‡ï¼ˆè°ƒä¼˜ç­–ç•¥ï¼‰"></a>å…­ã€å¹¿æ’­å˜é‡ï¼ˆè°ƒä¼˜ç­–ç•¥ï¼‰</h3><blockquote><p>å¹¿æ’­å˜é‡ç”¨æ¥é«˜æ•ˆåˆ†å‘è¾ƒå¤§çš„å¯¹è±¡ã€‚å‘æ‰€æœ‰å·¥ä½œèŠ‚ç‚¹å‘é€ä¸€ä¸ªè¾ƒå¤§çš„<strong>åªè¯»</strong>å€¼ï¼Œä»¥ä¾›ä¸€ä¸ªæˆ–å¤šä¸ªSparkæ“ä½œä½¿ç”¨ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ çš„åº”ç”¨éœ€è¦å‘æ‰€æœ‰èŠ‚ç‚¹å‘é€ä¸€ä¸ªè¾ƒå¤§çš„åªè¯»æŸ¥è¯¢è¡¨ï¼Œç”šè‡³æ˜¯æœºå™¨å­¦ä¹ ç®—æ³•ä¸­çš„ä¸€ä¸ªå¾ˆå¤§çš„ç‰¹å¾å‘é‡ï¼Œå¹¿æ’­å˜é‡ç”¨èµ·æ¥éƒ½å¾ˆé¡ºæ‰‹ã€‚ åœ¨å¤šä¸ªå¹¶è¡Œæ“ä½œä¸­ä½¿ç”¨åŒä¸€ä¸ªå˜é‡ï¼Œä½†æ˜¯ Sparkä¼šä¸ºæ¯ä¸ªä»»åŠ¡åˆ†åˆ«å‘é€ã€‚</p></blockquote><blockquote><p>ä½¿ç”¨å¹¿æ’­å˜é‡çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>(1) é€šè¿‡å¯¹ä¸€ä¸ªç±»å‹ T çš„å¯¹è±¡è°ƒç”¨ SparkContext.broadcast åˆ›å»ºå‡ºä¸€ä¸ª Broadcast[T] å¯¹è±¡ã€‚ ä»»ä½•å¯åºåˆ—åŒ–çš„ç±»å‹éƒ½å¯ä»¥è¿™ä¹ˆå®ç°ã€‚ </li><li>(2) é€šè¿‡ value å±æ€§è®¿é—®è¯¥å¯¹è±¡çš„å€¼(åœ¨ Java ä¸­ä¸º value() æ–¹æ³•)ã€‚ </li><li>(3) å˜é‡åªä¼šè¢«å‘åˆ°å„ä¸ªèŠ‚ç‚¹ä¸€æ¬¡ï¼Œåº”ä½œä¸ºåªè¯»å€¼å¤„ç†(ä¿®æ”¹è¿™ä¸ªå€¼ä¸ä¼šå½±å“åˆ°åˆ«çš„èŠ‚ç‚¹)ã€‚</li></ul></blockquote>]]></content>
    
    
    <summary type="html">Apache Sparkâ„¢ is a unified analytics engine for large-scale data processing.</summary>
    
    
    
    <category term="BigData" scheme="https://www.buildworld.cn/categories/BigData/"/>
    
    
    <category term="Spark" scheme="https://www.buildworld.cn/tags/Spark/"/>
    
  </entry>
  
  <entry>
    <title>å¤§æ•°æ®åˆ©å™¨--Scalaè¯­è¨€å­¦ä¹ (é«˜çº§)</title>
    <link href="https://www.buildworld.cn/2020/07/20/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%88%A9%E5%99%A8-Scala%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0-%E9%AB%98%E7%BA%A7/"/>
    <id>https://www.buildworld.cn/2020/07/20/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%88%A9%E5%99%A8-Scala%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0-%E9%AB%98%E7%BA%A7/</id>
    <published>2020-07-20T07:24:08.000Z</published>
    <updated>2020-07-25T04:23:05.542Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Scalaé«˜çº§"><a href="#Scalaé«˜çº§" class="headerlink" title="Scalaé«˜çº§"></a>Scalaé«˜çº§</h2><h2 id="ä¸€ã€é›†åˆ"><a href="#ä¸€ã€é›†åˆ" class="headerlink" title="ä¸€ã€é›†åˆ"></a>ä¸€ã€é›†åˆ</h2><blockquote><p>Scala çš„é›†åˆæœ‰ä¸‰å¤§ç±»ï¼š<code>åºåˆ— Seqã€é›† Setã€æ˜ å°„ Map</code>ï¼Œæ‰€æœ‰çš„é›†åˆéƒ½æ‰©å±•è‡ª Iterable ç‰¹è´¨ï¼Œåœ¨ Scala ä¸­é›†åˆæœ‰<strong>å¯å˜ï¼ˆmutableï¼‰</strong>å’Œ<strong>ä¸å¯å˜ï¼ˆimmutableï¼‰</strong>ä¸¤ç§ç±»å‹ã€‚</p></blockquote><p><img src="https://file.buildworld.cn/img/20200720092724.png"></p><blockquote><ul><li>1.Setã€Map æ˜¯ Java ä¸­ä¹Ÿæœ‰çš„é›†åˆã€‚</li><li>2.<code>Seq</code> æ˜¯ Java æ²¡æœ‰çš„ï¼Œæˆ‘ä»¬å‘ç° List å½’å±åˆ° Seq äº†,å› æ­¤è¿™é‡Œçš„ List å°±å’Œ java ä¸æ˜¯åŒä¸€ä¸ªæ¦‚å¿µäº†ã€‚</li><li>3.æˆ‘ä»¬å‰é¢çš„ for å¾ªç¯æœ‰ä¸€ä¸ª 1 to 3 ,å°±æ˜¯ <code>IndexedSeq</code> ä¸‹çš„ <code>Vector</code>ã€‚</li><li>4.String ä¹Ÿæ˜¯å±äº <code>IndexeSeq</code>ã€‚</li><li>5.æˆ‘ä»¬å‘ç°ç»å…¸çš„æ•°æ®ç»“æ„æ¯”å¦‚ <code>Queue</code> å’Œ <code>Stack</code> è¢«å½’å±åˆ° <code>LinearSeq</code>ã€‚</li><li>6.å¤§å®¶æ³¨æ„ Scala ä¸­çš„ Map ä½“ç³»æœ‰ä¸€ä¸ª <code>SortedMap</code>,è¯´æ˜ Scala çš„ Map å¯ä»¥æ”¯æŒæ’åºã€‚</li><li>7.<code>IndexSeq</code> å’Œ <code>LinearSeq</code> çš„åŒºåˆ«[<strong>IndexSeq æ˜¯é€šè¿‡ç´¢å¼•æ¥æŸ¥æ‰¾å’Œå®šä½ï¼Œå› æ­¤é€Ÿåº¦å¿«ï¼Œæ¯”å¦‚ String å°±æ˜¯ä¸€ä¸ªç´¢å¼•é›†åˆï¼Œé€šè¿‡ç´¢å¼•å³å¯å®šä½</strong>] [<strong>LineaSeq æ˜¯çº¿å‹çš„ï¼Œå³æœ‰å¤´å°¾çš„æ¦‚å¿µï¼Œè¿™ç§æ•°æ®ç»“æ„ä¸€èˆ¬æ˜¯é€šè¿‡éå†æ¥æŸ¥æ‰¾ï¼Œå®ƒçš„ä»·å€¼åœ¨äºåº”ç”¨åˆ°ä¸€äº›ã€‚å…·ä½“çš„åº”ç”¨åœºæ™¯ (ç”µå•†ç½‘ç«™, å¤§æ•°æ®æ¨èç³»ç»Ÿ :æœ€è¿‘æµè§ˆçš„ 10 ä¸ªå•†å“)</strong>]</li></ul></blockquote><h3 id="1ã€æ•°ç»„"><a href="#1ã€æ•°ç»„" class="headerlink" title="1ã€æ•°ç»„"></a>1ã€æ•°ç»„</h3><h4 id="ä¸å¯å˜æ•°ç»„"><a href="#ä¸å¯å˜æ•°ç»„" class="headerlink" title="ä¸å¯å˜æ•°ç»„"></a>ä¸å¯å˜æ•°ç»„</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¬¬ä¸€ç§åˆ›å»ºæ–¹æ³•</span></span><br><span class="line"><span class="keyword">val</span> num = <span class="keyword">new</span> <span class="type">Array</span>[<span class="type">Int</span>](<span class="number">5</span>)</span><br><span class="line"><span class="comment">//èµ‹å€¼,é›†åˆå…ƒç´ é‡‡ç”¨å°æ‹¬å·è®¿é—®</span></span><br><span class="line">num(<span class="number">1</span>) = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬äºŒç§åˆ›å»ºæ–¹æ³•,åœ¨å®šä¹‰æ•°ç»„æ—¶ï¼Œç›´æ¥èµ‹å€¼//ä½¿ç”¨ apply æ–¹æ³•åˆ›å»ºæ•°ç»„å¯¹è±¡</span></span><br><span class="line"><span class="keyword">val</span> num2 = <span class="type">Array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</span><br></pre></td></tr></table></figure><h4 id="å¯å˜æ•°ç»„"><a href="#å¯å˜æ•°ç»„" class="headerlink" title="å¯å˜æ•°ç»„"></a>å¯å˜æ•°ç»„</h4><p><strong>å˜é•¿æ•°ç»„(å£°æ˜æ³›å‹)</strong></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> num = <span class="type">ArrayBuffer</span>[<span class="type">Any</span>](<span class="number">1</span>, <span class="string">&quot;michong&quot;</span>, <span class="number">3.14</span>)</span><br><span class="line"><span class="comment">//æ·»åŠ </span></span><br><span class="line">num.appendAll(<span class="string">&quot;hi&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> (i &lt;- num) &#123;</span><br><span class="line">  println(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ é™¤</span></span><br><span class="line">num.remove(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¿®æ”¹</span></span><br><span class="line">num(<span class="number">0</span>) = <span class="string">&quot;hello&quot;</span></span><br></pre></td></tr></table></figure><h4 id="ç›¸äº’è½¬åŒ–"><a href="#ç›¸äº’è½¬åŒ–" class="headerlink" title="ç›¸äº’è½¬åŒ–"></a>ç›¸äº’è½¬åŒ–</h4><blockquote><ul><li><ol><li><code>arr1.toBuffer</code> //å®šé•¿æ•°ç»„è½¬å¯å˜æ•°ç»„</li></ol></li><li><ol start="2"><li><code>arr2.toArray</code> //å¯å˜æ•°ç»„è½¬å®šé•¿æ•°ç»„</li></ol></li></ul></blockquote><h3 id="2ã€å…ƒç»„"><a href="#2ã€å…ƒç»„" class="headerlink" title="2ã€å…ƒç»„"></a>2ã€å…ƒç»„</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.buildworld.scala.day3</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">demo2</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºå…ƒç»„</span></span><br><span class="line">    <span class="keyword">val</span> tuple = (<span class="number">1</span>,<span class="number">2</span>,<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">    <span class="comment">//è®¿é—®å…ƒç»„</span></span><br><span class="line">    <span class="comment">//1. ä½¿ç”¨ _é¡ºåºå·</span></span><br><span class="line">    println(tuple._2) <span class="comment">// &quot;hello&quot;</span></span><br><span class="line">    <span class="comment">//2. ä½¿ç”¨</span></span><br><span class="line">    println(tuple.productElement(<span class="number">2</span>)) <span class="comment">//ä¸‹æ ‡æ˜¯ä» 0 å¼€å§‹è®¡ç®—</span></span><br><span class="line">    <span class="comment">//éå†å…ƒç»„</span></span><br><span class="line">    <span class="keyword">for</span>(i&lt;-tuple.productIterator)&#123;</span><br><span class="line">      println(i)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Tuple3</span>[+<span class="type">T1</span>, +<span class="type">T2</span>, +<span class="type">T3</span>](<span class="params">_1: <span class="type">T1</span>, _2: <span class="type">T2</span>, _3: <span class="type">T3</span></span>) <span class="keyword">extends</span> <span class="title">Product3</span>[<span class="type">T1</span>, <span class="type">T2</span>, <span class="type">T3</span>] </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">toString</span></span>: <span class="type">String</span> = <span class="string">&quot;(&quot;</span> + _1 + <span class="string">&quot;,&quot;</span> + _2 + <span class="string">&quot;,&quot;</span> + _3 + <span class="string">&quot;)&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€List"><a href="#3ã€List" class="headerlink" title="3ã€List"></a>3ã€List</h3><blockquote><ul><li><ol><li>List é»˜è®¤ä¸ºä¸å¯å˜çš„é›†åˆ</li></ol></li><li><ol start="2"><li>List åœ¨ scala åŒ…å¯¹è±¡å£°æ˜çš„,å› æ­¤ä¸éœ€è¦å¼•å…¥å…¶å®ƒåŒ…ä¹Ÿå¯ä»¥ä½¿ç”¨</li></ol></li><li><ol start="3"><li>val List = scala.collection.immutable.List</li></ol></li><li><ol start="4"><li>List ä¸­å¯ä»¥æ”¾ä»»ä½•æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚ arr1 çš„ç±»å‹ä¸º List[Any]</li></ol></li><li><ol start="5"><li>å¦‚æœå¸Œæœ›å¾—åˆ°ä¸€ä¸ªç©ºåˆ—è¡¨ï¼Œå¯ä»¥ä½¿ç”¨ Nil å¯¹è±¡, åœ¨ scala åŒ…å¯¹è±¡å£°æ˜çš„,å› æ­¤ä¸éœ€è¦å¼•å…¥å…¶å®ƒåŒ…ä¹Ÿå¯ä»¥ä½¿ç”¨</li></ol></li></ul></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> list = <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">println(list )</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªç©ºlist</span></span><br><span class="line"><span class="keyword">val</span> list02 = <span class="type">Nil</span></span><br><span class="line">println(list02)</span><br><span class="line"></span><br><span class="line"><span class="comment">//åœ¨liståé¢æ·»åŠ å…ƒç´ </span></span><br><span class="line"><span class="keyword">val</span> list03 = list:+<span class="number">4</span></span><br><span class="line">println(list03)</span><br><span class="line"></span><br><span class="line"><span class="comment">//åœ¨listå‰é¢æ·»åŠ å…ƒç´ </span></span><br><span class="line"><span class="keyword">val</span> list04 = <span class="string">&quot;hi&quot;</span>+:list</span><br><span class="line">println(list04)</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¦å·::è¡¨ç¤ºå‘é›†åˆä¸­,æ–°å»ºé›†åˆæ·»åŠ å…ƒç´ ã€‚ä»å³å‘å·¦</span></span><br><span class="line"><span class="keyword">val</span> list5 = <span class="number">4</span> :: <span class="number">5</span> :: <span class="number">6</span> :: list :: <span class="type">Nil</span></span><br><span class="line">println(list5)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ::: è¿ç®—ç¬¦æ˜¯å°†é›†åˆä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ åŠ å…¥åˆ°ç©ºé›†åˆä¸­å», ::: å·¦å³ä¸¤è¾¹éœ€è¦æ—¶é›†åˆ.</span></span><br><span class="line"><span class="keyword">val</span> list6 = <span class="number">4</span> :: <span class="number">5</span> :: <span class="number">6</span> :: list ::: <span class="type">Nil</span></span><br><span class="line">println(list6)</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç»“æœ</span></span><br><span class="line"><span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="type">List</span>()</span><br><span class="line"><span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="type">List</span>(hi, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="type">List</span>(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>))</span><br><span class="line"><span class="type">List</span>(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure><h4 id="åˆ—è¡¨ListBuffer"><a href="#åˆ—è¡¨ListBuffer" class="headerlink" title="åˆ—è¡¨ListBuffer"></a>åˆ—è¡¨ListBuffer</h4><p><strong>ListBuffer:ListBuffer æ˜¯å¯å˜çš„ list é›†åˆï¼Œå¯ä»¥æ·»åŠ ï¼Œåˆ é™¤å…ƒç´ ,ListBuffer å±äºåº</strong></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">demo4</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> list = <span class="type">ListBuffer</span>[<span class="type">Int</span>](<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    list.addOne(<span class="number">4</span>)</span><br><span class="line">    list.append(<span class="number">5</span>)</span><br><span class="line">    println(list)</span><br><span class="line"></span><br><span class="line">    list += <span class="number">6</span></span><br><span class="line">    println(list)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//++ è¡¨ç¤ºçš„æ˜¯åŠ å…¥çš„æ˜¯é›†åˆä¸­çš„å„ä¸ªå…ƒç´ </span></span><br><span class="line">    <span class="keyword">val</span> list2 = list ++ list</span><br><span class="line">    println(list2)</span><br><span class="line"></span><br><span class="line">    list2.remove(<span class="number">0</span>)</span><br><span class="line">    println(list2)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¾“å‡º</span></span><br><span class="line"><span class="type">ListBuffer</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line"><span class="type">ListBuffer</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line"><span class="type">ListBuffer</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line"><span class="type">ListBuffer</span>(<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br></pre></td></tr></table></figure><h3 id="4ã€é˜Ÿåˆ—"><a href="#4ã€é˜Ÿåˆ—" class="headerlink" title="4ã€é˜Ÿåˆ—"></a>4ã€é˜Ÿåˆ—</h3><blockquote><ul><li><ol><li>é˜Ÿåˆ—æ˜¯ä¸€ä¸ªæœ‰åºåˆ—è¡¨ï¼Œåœ¨åº•å±‚å¯ä»¥ç”¨æ•°ç»„æˆ–æ˜¯é“¾è¡¨æ¥å®ç°ã€‚</li></ol></li><li><ol start="2"><li>å…¶è¾“å…¥å’Œè¾“å‡ºè¦éµå¾ªå…ˆå…¥å…ˆå‡ºçš„åŸåˆ™ã€‚å³ï¼šå…ˆå­˜å…¥é˜Ÿåˆ—çš„æ•°æ®ï¼Œè¦å…ˆå–å‡ºã€‚åå­˜å…¥çš„è¦åå–å‡ºã€‚</li></ol></li><li><ol start="3"><li>åœ¨ Scala ä¸­ï¼Œç”±è®¾è®¡è€…ç›´æ¥ç»™æˆ‘ä»¬æä¾›é˜Ÿåˆ—ç±»å‹ä½¿ç”¨ã€‚</li></ol></li><li><ol start="4"><li>åœ¨ scala ä¸­, æœ‰ <code>scala.collection.mutable.Queue</code> å’Œ <code>scala.collection.immutable.Queue</code> , ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨å¼€å‘ä¸­é€šå¸¸ä½¿ç”¨å¯å˜é›†åˆä¸­çš„é˜Ÿåˆ—</li></ol></li></ul></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scala.collection.mutable</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">demo5</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºé˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">val</span> q1  = <span class="keyword">new</span> mutable.<span class="type">Queue</span>[<span class="type">Int</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿½åŠ æ•°æ®</span></span><br><span class="line">    q1+=<span class="number">1</span></span><br><span class="line">    q1+=<span class="number">2</span></span><br><span class="line">    println(q1)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ·»åŠ list</span></span><br><span class="line">    q1++=<span class="type">List</span>(<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">    println(q1)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å–å‡ºé˜Ÿåˆ—æœ€å‰é¢çš„é‚£ä¸ªå…ƒç´ </span></span><br><span class="line">    println(q1.dequeue())</span><br><span class="line">    println(q1)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é˜Ÿå°¾è¿½åŠ å…ƒç´ </span></span><br><span class="line">    q1.enqueue(<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>)</span><br><span class="line">    println(q1)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿”å›é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">    println(q1.head)</span><br><span class="line">    <span class="comment">//è¿”å›é˜Ÿåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">    println(q1.last)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿”å›é™¤ç¬¬ä¸€ä¸ªå…ƒç´ ä»¥å¤–çš„å…¶ä»–å…ƒç´ çš„é˜Ÿåˆ—</span></span><br><span class="line">    println(q1.tail)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç»“æœ</span></span><br><span class="line"><span class="type">Queue</span>(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="type">Queue</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="type">Queue</span>(<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="type">Queue</span>(<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="type">Queue</span>(<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>)</span><br></pre></td></tr></table></figure><h3 id="5ã€æ˜ å°„â€“Map"><a href="#5ã€æ˜ å°„â€“Map" class="headerlink" title="5ã€æ˜ å°„â€“Map"></a>5ã€æ˜ å°„â€“Map</h3><blockquote><ul><li><ol><li>Scala ä¸­çš„ Map å’Œ Java ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ•£åˆ—è¡¨ï¼Œå®ƒå­˜å‚¨çš„å†…å®¹ä¹Ÿæ˜¯é”®å€¼å¯¹(key-value)æ˜ å°„ï¼ŒScala ä¸­<strong>ä¸å¯å˜çš„ Map æ˜¯æœ‰åºçš„</strong>ï¼Œ<strong>å¯å˜çš„ Map æ˜¯æ— åºçš„</strong>ã€‚</li></ol></li><li><ol start="2"><li>Scala ä¸­ï¼Œæœ‰<code>å¯å˜ Map (scala.collection.mutable.Map)</code> å’Œ <code>ä¸å¯å˜ Map(scala.collection.immutable.Map)</code>ã€‚</li></ol></li></ul></blockquote><h4 id="æ„å»ºmap"><a href="#æ„å»ºmap" class="headerlink" title="æ„å»ºmap"></a>æ„å»ºmap</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ„é€ ä¸å¯å˜mapï¼Œè¾“å…¥è¾“å‡ºç»“æœä¸€è‡´</span></span><br><span class="line"><span class="keyword">val</span> map1 = <span class="type">Map</span>(<span class="string">&quot;MiChong&quot;</span> -&gt; <span class="number">25</span>, <span class="string">&quot;Zz&quot;</span> -&gt; <span class="number">24</span>, <span class="string">&quot;Alice&quot;</span> -&gt; <span class="number">18</span>)</span><br><span class="line">println(map1)</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ„é€ å¯å˜map</span></span><br><span class="line"><span class="keyword">val</span> map2 = scala.collection.mutable.<span class="type">Map</span>(<span class="string">&quot;MiChong&quot;</span> -&gt; <span class="number">25</span>, <span class="string">&quot;Zz&quot;</span> -&gt; <span class="number">24</span>, <span class="string">&quot;Alice&quot;</span> -&gt; <span class="number">18</span>)</span><br><span class="line">println(map2)</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºç©ºçš„map</span></span><br><span class="line"><span class="keyword">val</span> map3 = <span class="keyword">new</span> mutable.<span class="type">HashMap</span>[<span class="type">String</span>,<span class="type">Int</span>]</span><br><span class="line">println(map3)</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯¹å¶å…ƒç»„,å³åˆ›å»ºåŒ…å«é”®å€¼å¯¹çš„äºŒå…ƒç»„</span></span><br><span class="line"><span class="keyword">val</span> map4 = mutable.<span class="type">Map</span>((<span class="string">&quot;A&quot;</span>,<span class="number">1</span>),(<span class="string">&quot;B&quot;</span>,<span class="number">2</span>),(<span class="string">&quot;C&quot;</span>,<span class="number">3</span>))</span><br><span class="line">println(map4(<span class="string">&quot;A&quot;</span>))</span><br></pre></td></tr></table></figure><h4 id="å–å€¼"><a href="#å–å€¼" class="headerlink" title="å–å€¼"></a>å–å€¼</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">demo7</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> map1 = <span class="type">Map</span>(<span class="string">&quot;MiChong&quot;</span> -&gt; <span class="number">25</span>, <span class="string">&quot;Zz&quot;</span> -&gt; <span class="number">24</span>, <span class="string">&quot;Alice&quot;</span> -&gt; <span class="number">18</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ–¹å¼1</span></span><br><span class="line">    <span class="comment">//    1) å¦‚æœ key å­˜åœ¨ï¼Œåˆ™è¿”å›å¯¹åº”çš„å€¼</span></span><br><span class="line">    <span class="comment">//    2) å¦‚æœ key ä¸å­˜åœ¨ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸[java.util.NoSuchElementException]</span></span><br><span class="line">    println(map1(<span class="string">&quot;Zz&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ–¹å¼2ã€</span></span><br><span class="line">    <span class="comment">// 1.å¦‚æœ key å­˜åœ¨ï¼Œåˆ™è¿”å› true</span></span><br><span class="line">    <span class="comment">// 2.å¦‚æœ key ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› false</span></span><br><span class="line">    println(map1.contains(<span class="string">&quot;Zz&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ–¹å¼3ã€é€šè¿‡ æ˜ å°„.get(é”®) è¿™æ ·çš„è°ƒç”¨è¿”å›ä¸€ä¸ª Option å¯¹è±¡ï¼Œè¦ä¹ˆæ˜¯ Someï¼Œè¦ä¹ˆæ˜¯ None</span></span><br><span class="line">    <span class="comment">//  2) å¦‚æœ map.get(key) key å­˜åœ¨è¿”å› some,å¦‚æœ key ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› None</span></span><br><span class="line">    <span class="comment">//  3) å¦‚æœ map.get(key).get key å­˜åœ¨ï¼Œè¿”å› key å¯¹åº”çš„å€¼,å¦åˆ™ï¼ŒæŠ›å‡ºå¼‚å¸¸ java.util.NoSuchElementException: None.get</span></span><br><span class="line">    println(map1.get(<span class="string">&quot;Zz&quot;</span>).get)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ–¹å¼4ã€getOrElse()</span></span><br><span class="line">    <span class="comment">//å¦‚æœ key å­˜åœ¨ï¼Œè¿”å› key å¯¹åº”çš„å€¼ã€‚</span></span><br><span class="line">    <span class="comment">//å¦‚æœ key ä¸å­˜åœ¨ï¼Œè¿”å›é»˜è®¤å€¼ã€‚åœ¨ java ä¸­åº•å±‚æœ‰å¾ˆå¤šç±»ä¼¼çš„æ“ä½œã€‚</span></span><br><span class="line">    println(map1.getOrElse(<span class="string">&quot;zz&quot;</span>,<span class="string">&quot;default&quot;</span>))</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹å’Œæ·»åŠ "><a href="#ä¿®æ”¹å’Œæ·»åŠ " class="headerlink" title="ä¿®æ”¹å’Œæ·»åŠ "></a>ä¿®æ”¹å’Œæ·»åŠ </h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scala.collection.mutable</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">demo8</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> map1 = mutable.<span class="type">Map</span>(<span class="string">&quot;MiChong&quot;</span> -&gt; <span class="number">25</span>, <span class="string">&quot;Zz&quot;</span> -&gt; <span class="number">24</span>, <span class="string">&quot;Alice&quot;</span> -&gt; <span class="number">18</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¿®æ”¹å’Œæ·»åŠ </span></span><br><span class="line">    <span class="comment">//1) map æ˜¯å¯å˜çš„ï¼Œæ‰èƒ½ä¿®æ”¹ï¼Œå¦åˆ™æŠ¥é”™</span></span><br><span class="line">    <span class="comment">//2) å¦‚æœ key å­˜åœ¨ï¼šåˆ™ä¿®æ”¹å¯¹åº”çš„å€¼,key ä¸å­˜åœ¨,ç­‰ä»·äºæ·»åŠ ä¸€ä¸ª key-val</span></span><br><span class="line">    map1(<span class="string">&quot;qjzxzxd&quot;</span>)= <span class="number">22</span></span><br><span class="line">    println(map1)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ·»åŠ å¤šä¸ªå…ƒç´ </span></span><br><span class="line">    map1 +=(<span class="string">&quot;qjzxzxd&quot;</span>-&gt;<span class="number">1</span>,<span class="string">&quot;demo2&quot;</span>-&gt;<span class="number">2</span>)</span><br><span class="line">    println(map1)</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="éå†"><a href="#éå†" class="headerlink" title="éå†"></a>éå†</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.buildworld.scala.day3</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.collection.mutable</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">demo8</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> map1 = mutable.<span class="type">Map</span>(<span class="string">&quot;MiChong&quot;</span> -&gt; <span class="number">25</span>, <span class="string">&quot;Zz&quot;</span> -&gt; <span class="number">24</span>, <span class="string">&quot;Alice&quot;</span> -&gt; <span class="number">18</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//éå†map</span></span><br><span class="line">    <span class="keyword">for</span> ((k, v) &lt;- map1) &#123;</span><br><span class="line">      println(<span class="string">&quot;é”®ï¼š&quot;</span> + k + <span class="string">&quot;  å€¼ï¼š&quot;</span> + v)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (k&lt;-map1.keys)&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(v&lt;-map1.values)&#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6ã€é›†â€“Set"><a href="#6ã€é›†â€“Set" class="headerlink" title="6ã€é›†â€“Set"></a>6ã€é›†â€“Set</h3><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒScala ä½¿ç”¨çš„æ˜¯ä¸å¯å˜é›†åˆï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨å¯å˜é›†åˆï¼Œéœ€è¦å¼•ç”¨ <code>scala.collection.mutable.Set</code> åŒ…</p></blockquote><h4 id="æ–°å»ºset"><a href="#æ–°å»ºset" class="headerlink" title="æ–°å»ºset"></a>æ–°å»ºset</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.buildworld.scala.day3</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.collection.mutable</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">demo9</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸å¯å˜</span></span><br><span class="line">    <span class="keyword">val</span> set1 = <span class="type">Set</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">    println(set1)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¯å˜</span></span><br><span class="line">    <span class="keyword">val</span> set2 = mutable.<span class="type">Set</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="string">&quot;abc&quot;</span>)</span><br><span class="line">    println(set2)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç»“æœ</span></span><br><span class="line"><span class="type">Set</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="type">HashSet</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, abc, <span class="number">4</span>)</span><br></pre></td></tr></table></figure><h4 id="æ·»åŠ set"><a href="#æ·»åŠ set" class="headerlink" title="æ·»åŠ set"></a>æ·»åŠ set</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¯å˜</span></span><br><span class="line"><span class="keyword">val</span> set2 = mutable.<span class="type">Set</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="string">&quot;abc&quot;</span>)</span><br><span class="line">println(set2)</span><br><span class="line"></span><br><span class="line">set2.add(<span class="number">5</span>)</span><br><span class="line">set2 += <span class="number">6</span></span><br><span class="line">set2 +=(<span class="number">7</span>)</span><br><span class="line">println(set2)</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç»“æœ</span></span><br><span class="line"><span class="type">HashSet</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, abc, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>)</span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¯å˜</span></span><br><span class="line"><span class="keyword">val</span> set2 = mutable.<span class="type">Set</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="string">&quot;abc&quot;</span>)</span><br><span class="line">println(set2)</span><br><span class="line"></span><br><span class="line">set2.add(<span class="number">5</span>)</span><br><span class="line">set2 += <span class="number">6</span></span><br><span class="line">set2 += (<span class="number">7</span>)</span><br><span class="line">println(set2)</span><br><span class="line"></span><br><span class="line">set2 -= <span class="number">2</span></span><br><span class="line">set2 -= (<span class="number">3</span>)</span><br><span class="line">set2.remove(<span class="number">4</span>)</span><br><span class="line">println(set2)</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç»“æœ</span></span><br><span class="line"><span class="type">HashSet</span>(<span class="number">1</span>, abc, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>)</span><br></pre></td></tr></table></figure><h4 id="éå†-1"><a href="#éå†-1" class="headerlink" title="éå†"></a>éå†</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¯å˜</span></span><br><span class="line"><span class="keyword">val</span> set2 = mutable.<span class="type">Set</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="string">&quot;abc&quot;</span>)</span><br><span class="line">println(set2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (x &lt;- set2) &#123;</span><br><span class="line">  println(x)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Setæ›´å¤šæ“ä½œ"><a href="#Setæ›´å¤šæ“ä½œ" class="headerlink" title="Setæ›´å¤šæ“ä½œ"></a>Setæ›´å¤šæ“ä½œ</h4><table><thead><tr><th align="center">åºå·</th><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td align="center">1</td><td>def +(elem: A): Set[A]</td><td>ä¸ºé›†åˆæ·»åŠ æ–°å…ƒç´ ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„é›†åˆï¼Œé™¤éå…ƒç´ å·²å­˜åœ¨</td></tr><tr><td align="center">2</td><td>def -(elem: A): Set[A]</td><td>ç§»é™¤é›†åˆä¸­çš„å…ƒç´ ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„é›†åˆ</td></tr><tr><td align="center">3</td><td>def contains(elem: A): Boolean</td><td>å¦‚æœå…ƒç´ åœ¨é›†åˆä¸­å­˜åœ¨ï¼Œè¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚</td></tr><tr><td align="center">4</td><td>def &amp;(that: Set[A]): Set[A]</td><td>è¿”å›ä¸¤ä¸ªé›†åˆçš„äº¤é›†</td></tr><tr><td align="center">5</td><td>def &amp;~(that: Set[A]): Set[A]</td><td>è¿”å›ä¸¤ä¸ªé›†åˆçš„å·®é›†</td></tr><tr><td align="center">6</td><td>def ++(elems: A): Set[A]</td><td>åˆå¹¶ä¸¤ä¸ªé›†åˆ</td></tr><tr><td align="center">7</td><td>def drop(n: Int): Set[A]]</td><td>è¿”å›ä¸¢å¼ƒå‰nä¸ªå…ƒç´ æ–°é›†åˆ</td></tr><tr><td align="center">8</td><td>def dropRight(n: Int): Set[A]</td><td>è¿”å›ä¸¢å¼ƒæœ€ånä¸ªå…ƒç´ æ–°é›†åˆ</td></tr><tr><td align="center">9</td><td>def dropWhile(p: (A) =&gt; Boolean): Set[A]</td><td>ä»å·¦å‘å³ä¸¢å¼ƒå…ƒç´ ï¼Œç›´åˆ°æ¡ä»¶pä¸æˆç«‹</td></tr><tr><td align="center">10</td><td>def max: A //æ¼”ç¤ºä¸‹</td><td>æŸ¥æ‰¾æœ€å¤§å…ƒç´ </td></tr><tr><td align="center">11</td><td>def min: A //æ¼”ç¤ºä¸‹</td><td>æŸ¥æ‰¾æœ€å°å…ƒç´ </td></tr><tr><td align="center">12</td><td>def take(n: Int): Set[A]</td><td>è¿”å›å‰ n ä¸ªå…ƒç´ </td></tr></tbody></table><h3 id="7ã€é›†åˆå…ƒç´ çš„æ˜ å°„-map-æ˜ å°„æ“ä½œ"><a href="#7ã€é›†åˆå…ƒç´ çš„æ˜ å°„-map-æ˜ å°„æ“ä½œ" class="headerlink" title="7ã€é›†åˆå…ƒç´ çš„æ˜ å°„-map æ˜ å°„æ“ä½œ"></a>7ã€é›†åˆå…ƒç´ çš„æ˜ å°„-map æ˜ å°„æ“ä½œ</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">val</span> list = <span class="type">List</span>(<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>)</span><br><span class="line">  <span class="comment">//mapä¸­ä¼ å…¥ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºå¤„ç†listä¸­æ¯ä¸ªå…ƒç´ </span></span><br><span class="line">  <span class="keyword">val</span> list2 = list.map(f1)</span><br><span class="line">  println(list2)</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">val</span> f2 = f1 _</span><br><span class="line">  println(f2(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span></span>(n:<span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">  n*<span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8ã€flatmap-æ˜ å°„ï¼šflat-å³å‹æ‰ï¼Œå‹å¹³ï¼Œæ‰å¹³åŒ–æ˜ å°„"><a href="#8ã€flatmap-æ˜ å°„ï¼šflat-å³å‹æ‰ï¼Œå‹å¹³ï¼Œæ‰å¹³åŒ–æ˜ å°„" class="headerlink" title="8ã€flatmap æ˜ å°„ï¼šflat å³å‹æ‰ï¼Œå‹å¹³ï¼Œæ‰å¹³åŒ–æ˜ å°„"></a>8ã€flatmap æ˜ å°„ï¼šflat å³å‹æ‰ï¼Œå‹å¹³ï¼Œæ‰å¹³åŒ–æ˜ å°„</h3><blockquote><p>flatmapï¼šflat å³å‹æ‰ï¼Œå‹å¹³ï¼Œæ‰å¹³åŒ–ï¼Œæ•ˆæœå°±æ˜¯å°†é›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ çš„å­å…ƒç´ æ˜ å°„åˆ°æŸä¸ªå‡½æ•°å¹¶è¿”å›æ–°çš„é›†åˆã€‚</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">val</span> names = <span class="type">List</span>(<span class="string">&quot;MiChong&quot;</span>)</span><br><span class="line">  </span><br><span class="line">  println(names.flatMap(upper))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upper</span></span>(string: <span class="type">String</span>):<span class="type">String</span>=&#123;</span><br><span class="line">  string.toUpperCase</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9ã€é›†åˆå…ƒç´ çš„è¿‡æ»¤-filter"><a href="#9ã€é›†åˆå…ƒç´ çš„è¿‡æ»¤-filter" class="headerlink" title="9ã€é›†åˆå…ƒç´ çš„è¿‡æ»¤-filter"></a>9ã€é›†åˆå…ƒç´ çš„è¿‡æ»¤-filter</h3><blockquote><p>filterï¼šå°†ç¬¦åˆè¦æ±‚çš„æ•°æ®(ç­›é€‰)æ”¾ç½®åˆ°æ–°çš„é›†åˆä¸­</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">demo3</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åªä¿ç•™Aå¼€å¤´çš„å•è¯</span></span><br><span class="line">    <span class="keyword">val</span> list  = <span class="type">List</span>(<span class="string">&quot;Ace&quot;</span>,<span class="string">&quot;Baby&quot;</span>,<span class="string">&quot;Zoom&quot;</span>)</span><br><span class="line">    println(list.filter(startA))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">startA</span></span>(string: <span class="type">String</span>): <span class="type">Boolean</span> =&#123;</span><br><span class="line">    <span class="keyword">if</span>(string.startsWith(<span class="string">&quot;A&quot;</span>)) <span class="literal">true</span> <span class="keyword">else</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10ã€reduceLeft-åŒ–ç®€"><a href="#10ã€reduceLeft-åŒ–ç®€" class="headerlink" title="10ã€reduceLeft åŒ–ç®€"></a>10ã€reduceLeft åŒ–ç®€</h3><blockquote><p>åŒ–ç®€ï¼šå°† äºŒå…ƒå‡½æ•°å¼•ç”¨äºé›†åˆä¸­çš„å‡½æ•°,ã€‚</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">demo4</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> list  = <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</span><br><span class="line">    println(list.reduceLeft(sum))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//æ‰§è¡Œç›¸åŠ ç¨‹åº</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">sum</span></span>(n1: <span class="type">Int</span>, n2: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">    n1 + n2</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="11ã€æŠ˜å â€“fold"><a href="#11ã€æŠ˜å â€“fold" class="headerlink" title="11ã€æŠ˜å â€“fold"></a>11ã€æŠ˜å â€“fold</h3><blockquote><ul><li><ol><li>fold å‡½æ•°å°†ä¸Š ä¸€æ­¥è¿”å›çš„å€¼ä½œä¸ºå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ç»§ç»­ä¼ é€’å‚ä¸è¿ç®—ï¼Œç›´åˆ° list  ä¸­çš„æ‰€æœ‰å…ƒç´ è¢«éå†ã€‚</li></ol></li><li><ol start="2"><li>å¯ä»¥æŠŠ <code>reduceLeft</code>  çœ‹åšç®€åŒ–ç‰ˆçš„ <code>foldLeft</code></li></ol></li></ul></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">demo5</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> list = <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">    println(list.foldLeft(<span class="number">5</span>)(minus)) <span class="comment">//ä»å·¦åˆ°å³</span></span><br><span class="line">    println(list.foldRight(<span class="number">5</span>)(minus))<span class="comment">//ä»å³åˆ°å·¦</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">minus</span></span>(n1:<span class="type">Int</span>,n2:<span class="type">Int</span>):<span class="type">Int</span>=&#123;</span><br><span class="line">    n1 - n2</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="12ã€æ‰«æâ€“scan"><a href="#12ã€æ‰«æâ€“scan" class="headerlink" title="12ã€æ‰«æâ€“scan"></a>12ã€æ‰«æâ€“scan</h3><blockquote><p>æ‰«æï¼Œå³å¯¹åš æŸä¸ªé›†åˆçš„æ‰€æœ‰å…ƒç´ åš fold  æ“ä½œï¼Œä½†æ˜¯ä¼šæŠŠäº§ç”Ÿçš„å­˜ æ‰€æœ‰ä¸­é—´ç»“æœæ”¾ç½®äºä¸€ä¸ªé›†åˆä¸­ä¿å­˜ // æ–æ³¢é‚£å¥‘</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> list = (<span class="number">1</span> to <span class="number">5</span>).scanLeft(<span class="number">5</span>)(minus)</span><br><span class="line">    println(list)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">minus</span></span>(n1:<span class="type">Int</span>,n2:<span class="type">Int</span>):<span class="type">Int</span>=&#123;</span><br><span class="line">    n1 - n2</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç»“æœ</span></span><br><span class="line"><span class="type">Vector</span>(<span class="number">5</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">-1</span>, <span class="number">-5</span>, <span class="number">-10</span>)</span><br></pre></td></tr></table></figure><h2 id="äºŒã€æ¨¡å¼åŒ¹é…"><a href="#äºŒã€æ¨¡å¼åŒ¹é…" class="headerlink" title="äºŒã€æ¨¡å¼åŒ¹é…"></a>äºŒã€æ¨¡å¼åŒ¹é…</h2><blockquote><ul><li><ol><li>å¦‚æœæ‰€æœ‰ case éƒ½ä¸åŒ¹é…ï¼Œé‚£ä¹ˆä¼šæ‰§è¡Œ <code>case _</code> åˆ†æ”¯ï¼Œç±»ä¼¼äº Java ä¸­ default è¯­å¥</li></ol></li><li><ol start="2"><li>å¦‚æœæ‰€æœ‰ case éƒ½ä¸åŒ¹é…ï¼Œåˆæ²¡æœ‰å†™ case _ åˆ†æ”¯ï¼Œé‚£ä¹ˆä¼šæŠ›å‡º <code>MatchError</code></li></ol></li><li><ol start="3"><li>æ¯ä¸ª case ä¸­ï¼Œ<strong>ä¸ç”¨ break è¯­å¥</strong>ï¼Œè‡ªåŠ¨ä¸­æ–­ case</li></ol></li><li><ol start="4"><li>å¯ä»¥åœ¨ match ä¸­ä½¿ç”¨å…¶å®ƒç±»å‹ï¼Œè€Œä¸ä»…ä»…æ˜¯å­—ç¬¦,å¯ä»¥æ˜¯è¡¨è¾¾å¼</li></ol></li><li><ol start="5"><li><code>=&gt;</code> ç­‰ä»·äº java swtich çš„ <code>:</code></li></ol></li><li><ol start="6"><li>=&gt; åé¢çš„ä»£ç å—åˆ°ä¸‹ä¸€ä¸ª caseï¼Œ æ˜¯ä½œä¸ºä¸€ä¸ªæ•´ä½“æ‰§è¡Œï¼Œå¯ä»¥ä½¿ç”¨{} æ‰©èµ·æ¥ï¼Œä¹Ÿå¯ä»¥ä¸æ‰©ã€‚</li></ol></li></ul></blockquote><h3 id="1ã€å®ˆå«"><a href="#1ã€å®ˆå«" class="headerlink" title="1ã€å®ˆå«"></a>1ã€å®ˆå«</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (ch &lt;- <span class="string">&quot;+-3!&quot;</span>)&#123;</span><br><span class="line">  ch <span class="keyword">match</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> &#x27;+&#x27; =&gt; println(ch)</span><br><span class="line">    <span class="keyword">case</span> &#x27;-&#x27; =&gt; println(ch)</span><br><span class="line">    <span class="comment">//case _ if ... è¿™é‡Œä¸æ˜¯é»˜è®¤åŒ¹é…, è¡¨ç¤ºå¿½ç•¥ ch ï¼Œ è€Œæ˜¯è¿›è¡Œåé¢çš„ if åŒ¹é….</span></span><br><span class="line">    <span class="keyword">case</span> _ <span class="keyword">if</span> ch.toString.equals(&#x27;<span class="number">3</span>&#x27;) =&gt;println(ch)</span><br><span class="line">    <span class="keyword">case</span> _ =&gt; println(<span class="string">&quot;end&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€åŒ¹é…æ•°ç»„"><a href="#2ã€åŒ¹é…æ•°ç»„" class="headerlink" title="2ã€åŒ¹é…æ•°ç»„"></a>2ã€åŒ¹é…æ•°ç»„</h3><blockquote><ul><li><ol><li><code>Array(0)</code> åŒ¹é…åªæœ‰ä¸€ä¸ªå…ƒç´ ä¸”ä¸º 0 çš„æ•°ç»„ã€‚</li></ol></li><li><ol start="2"><li><code>Array(x,y)</code> åŒ¹é…æ•°ç»„æœ‰ä¸¤ä¸ªå…ƒç´ ï¼Œå¹¶å°†ä¸¤ä¸ªå…ƒç´ èµ‹å€¼ä¸º x å’Œ yã€‚å½“ç„¶å¯ä»¥ä¾æ¬¡ç±»æ¨ Array(x,y,z) åŒ¹é…æ•°ç»„æœ‰ 3 ä¸ªå…ƒç´ çš„ç­‰ç­‰â€¦.</li></ol></li><li><ol start="3"><li><code>Array(0,_*)</code> åŒ¹é…æ•°ç»„ä»¥ 0 å¼€å§‹</li></ol></li></ul></blockquote><h3 id="3ã€åŒ¹é…åˆ—è¡¨"><a href="#3ã€åŒ¹é…åˆ—è¡¨" class="headerlink" title="3ã€åŒ¹é…åˆ—è¡¨"></a>3ã€åŒ¹é…åˆ—è¡¨</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (list &lt;- <span class="type">Array</span>(<span class="type">List</span>(<span class="number">0</span>), <span class="type">List</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="type">List</span>(<span class="number">88</span>), <span class="type">List</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="type">List</span>(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>))) &#123;</span><br><span class="line">  <span class="keyword">val</span> result = list <span class="keyword">match</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span> :: <span class="type">Nil</span> =&gt; <span class="string">&quot;0&quot;</span> <span class="comment">// åŒ¹é…çš„ List(0)</span></span><br><span class="line">    <span class="keyword">case</span> x :: y :: <span class="type">Nil</span> =&gt; x + <span class="string">&quot; &quot;</span> + y <span class="comment">// åŒ¹é…çš„æ˜¯æœ‰ä¸¤ä¸ªå…ƒç´ çš„ List(x,y)</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span> :: tail =&gt; <span class="string">&quot;0 ...&quot;</span> <span class="comment">// åŒ¹é… ä»¥ 0 å¼€å¤´çš„åé¢æœ‰ä»»æ„å…ƒç´ çš„ List</span></span><br><span class="line">    <span class="keyword">case</span> x :: <span class="type">Nil</span> =&gt; <span class="type">List</span>(x)</span><br><span class="line">    <span class="keyword">case</span> _ =&gt; <span class="string">&quot;something else&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€åŒ¹é…å…ƒç»„"><a href="#4ã€åŒ¹é…å…ƒç»„" class="headerlink" title="4ã€åŒ¹é…å…ƒç»„"></a>4ã€åŒ¹é…å…ƒç»„</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¯·è¿”å› (34, 89) =&gt; (89,34)</span></span><br><span class="line"><span class="keyword">for</span> (pair &lt;- <span class="type">Array</span>((<span class="number">0</span>, <span class="number">1</span>), (<span class="number">34</span>, <span class="number">89</span>), (<span class="number">1</span>, <span class="number">0</span>), (<span class="number">1</span>, <span class="number">1</span>), (<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>))) &#123;</span><br><span class="line">  <span class="keyword">val</span> result = pair <span class="keyword">match</span> &#123; <span class="comment">//</span></span><br><span class="line">    <span class="keyword">case</span> (<span class="number">0</span>, _) =&gt; <span class="string">&quot;0 ...&quot;</span> <span class="comment">// è¡¨ç¤ºåŒ¹é… 0 å¼€å¤´çš„äºŒå…ƒç»„</span></span><br><span class="line">    <span class="keyword">case</span> (y, <span class="number">0</span>) =&gt; y <span class="comment">//è¡¨ç¤ºåŒ¹é… 0 ç»“å°¾çš„äºŒå…ƒç»„</span></span><br><span class="line">    <span class="keyword">case</span> (x, y) =&gt; (y, x)</span><br><span class="line">    <span class="keyword">case</span> _ =&gt; <span class="string">&quot;other&quot;</span> <span class="comment">//.é»˜è®¤</span></span><br><span class="line">  &#125;</span><br><span class="line">  println(result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€å¯¹è±¡åŒ¹é…"><a href="#5ã€å¯¹è±¡åŒ¹é…" class="headerlink" title="5ã€å¯¹è±¡åŒ¹é…"></a>5ã€å¯¹è±¡åŒ¹é…</h3><blockquote><ul><li><ol><li>æ„å»ºå¯¹è±¡æ—¶ apply ä¼šè¢«è°ƒç”¨ ï¼Œæ¯”å¦‚ val n1 = Square(5)</li></ol></li><li><ol start="2"><li>å½“å°† Square(n) å†™åœ¨ case åæ—¶[case Square(n) =&gt; xxx]ï¼Œä¼šé»˜è®¤è°ƒç”¨ unapply æ–¹æ³•(å¯¹è±¡æå–å™¨)</li></ol></li><li><ol start="3"><li>number ä¼šè¢« ä¼ é€’ç»™ def unapply(z: Double) çš„ z å½¢å‚</li></ol></li><li><ol start="4"><li>å¦‚æœè¿”å›çš„æ˜¯ Some é›†åˆï¼Œåˆ™ unapply æå–å™¨è¿”å›çš„ç»“æœä¼šè¿”å›ç»™ n è¿™ä¸ªå½¢å‚</li></ol></li><li><ol start="5"><li>case ä¸­å¯¹è±¡çš„ unapply æ–¹æ³•(æå–å™¨)è¿”å› some é›†åˆåˆ™ä¸ºåŒ¹é…æˆåŠŸ</li></ol></li><li><ol start="6"><li>è¿”å› None é›†åˆåˆ™ä¸ºåŒ¹é…å¤±è´¥</li></ol></li></ul></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// æ¨¡å¼åŒ¹é…ä½¿ç”¨ï¼š</span></span><br><span class="line">    <span class="keyword">val</span> number: <span class="type">Double</span> = <span class="number">36.0</span> <span class="comment">//Square(6.0)</span></span><br><span class="line">    <span class="comment">//è¯´æ˜</span></span><br><span class="line">    <span class="comment">//1. å½“ number å»å’Œ case Square(n) æ—¶ï¼Œä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œ</span></span><br><span class="line">    <span class="comment">//2. æŠŠ number ä¼ é€’ç»™ Square unapply(z: Double) çš„ z</span></span><br><span class="line">    <span class="comment">//3. unapply è¢«è°ƒç”¨ï¼Œè¿”å›ä¸€ä¸ªç»“æœ, è¿”å›çš„ç»“æœå’Œç¨‹åºå‘˜çš„é€»è¾‘ä»£ç ,æ¯”å¦‚ Some(math.sqrt(z))</span></span><br><span class="line">    <span class="comment">//4. å¦‚æœè¿”å›çš„ç»“æœæ˜¯ Some é›†åˆï¼Œåˆ™è¡¨ç¤ºåŒ¹é…æˆåŠŸ ,å¦‚æœè¿”å›çš„æ˜¯ None åˆ™è¡¨ç¤ºåŒ¹é…å¤±è´¥</span></span><br><span class="line">    <span class="comment">//5. å¦‚æœåŒ¹é…æˆåŠŸï¼Œå°±æ˜¯å°† Some(?) çš„ å€¼,èµ‹ç»™ case Square(n) çš„ n</span></span><br><span class="line">    <span class="comment">//6. è¿™æ ·å°±ç­‰ä»·äºå°†åŸæ¥å¯¹è±¡çš„æ„å»ºå‚æ•°ï¼Œæå–å‡ºæ¥ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºå¯¹è±¡åŒ¹é…, è¿™ä¸ªä½¿ç”¨å¾ˆå¤š.</span></span><br><span class="line">    number <span class="keyword">match</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="type">Square</span>(n) =&gt; println(n) <span class="comment">// 6.0</span></span><br><span class="line">      <span class="keyword">case</span> _ =&gt; println(<span class="string">&quot;nothing matched&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¯´æ˜</span></span><br><span class="line"><span class="comment">//1. unapply ä¸ºå¯¹è±¡æå–å™¨</span></span><br><span class="line"><span class="comment">//2. apply å¯¹è±¡æ„å»ºå™¨</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Square</span> </span>&#123; <span class="comment">//é™æ€æ€§è´¨</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">unapply</span></span>(z: <span class="type">Double</span>): <span class="type">Option</span>[<span class="type">Double</span>] = &#123;</span><br><span class="line">    println(<span class="string">&quot;unapply è¢«è°ƒç”¨ z =&quot;</span> + z) <span class="comment">// 36.0</span></span><br><span class="line">    <span class="type">Some</span>(math.sqrt(z)) <span class="comment">// Some(6.0)</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(z: <span class="type">Double</span>): <span class="type">Double</span> = z * z</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6ã€æ ·ä¾‹ç±»"><a href="#6ã€æ ·ä¾‹ç±»" class="headerlink" title="6ã€æ ·ä¾‹ç±»"></a>6ã€æ ·ä¾‹ç±»</h3><blockquote><ul><li><ol><li>æ ·ä¾‹ç±»ä»ç„¶æ˜¯ç±»ã€‚</li></ol></li><li><ol start="2"><li>æ ·ä¾‹ç±»ç”¨ case å…³é”®å­—è¿›è¡Œå£°æ˜ã€‚</li></ol></li><li><ol start="3"><li>æ ·ä¾‹ç±»æ˜¯ä¸ºæ¨¡å¼åŒ¹é…(å¯¹è±¡)è€Œä¼˜åŒ–çš„ç±»ã€‚</li></ol></li><li><ol start="4"><li>æ„é€ å™¨ä¸­çš„æ¯ä¸€ä¸ªå‚æ•°éƒ½æˆä¸º valâ€”â€”é™¤éå®ƒè¢«æ˜¾å¼åœ°å£°æ˜ä¸º varï¼ˆä¸å»ºè®®è¿™æ ·åšï¼‰ã€‚</li></ol></li><li><ol start="5"><li>åœ¨æ ·ä¾‹ç±»å¯¹åº”çš„ä¼´ç”Ÿå¯¹è±¡ä¸­æä¾› apply æ–¹æ³•è®©ä½ ä¸ç”¨ new å…³é”®å­—å°±èƒ½æ„é€ å‡ºç›¸åº”çš„å¯¹è±¡ã€‚</li></ol></li><li><ol start="6"><li>æä¾› unapply æ–¹æ³•è®©æ¨¡å¼åŒ¹é…å¯ä»¥å·¥ä½œã€‚</li></ol></li><li><ol start="7"><li>å°†è‡ªåŠ¨ç”Ÿæˆ toStringã€equalsã€hashCode å’Œ copy æ–¹æ³•(æœ‰ç‚¹ç±»ä¼¼æ¨¡æ¿ç±»ï¼Œç›´æ¥ç»™ç”Ÿæˆï¼Œä¾›ç¨‹åºå‘˜ä½¿ç”¨)ã€‚</li></ol></li><li><ol start="8"><li>é™¤ä¸Šè¿°å¤–ï¼Œæ ·ä¾‹ç±»å’Œå…¶ä»–ç±»å®Œå…¨ä¸€æ ·ã€‚ä½ å¯ä»¥æ·»åŠ æ–¹æ³•å’Œå­—æ®µï¼Œæ‰©å±•å®ƒä»¬ã€‚</li></ol></li></ul></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æŠ½è±¡ç±»</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Amount</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Dollar</span>(<span class="params">value: <span class="type">Double</span></span>) <span class="keyword">extends</span> <span class="title">Amount</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Currency æ ·ä¾‹ç±»</span></span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Currency</span>(<span class="params">value: <span class="type">Double</span>, unit: <span class="type">String</span></span>) <span class="keyword">extends</span> <span class="title">Amount</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//NoAmount æ ·ä¾‹ç±»</span></span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">object</span> <span class="title">NoAmount</span> <span class="keyword">extends</span> <span class="title">Amount</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ·ä¾‹ç±»ä¾ç„¶å¯ä»¥æœ‰è‡ªå·±çš„æ–¹æ³•å’Œå±æ€§</span></span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span>(<span class="params">name: <span class="type">String</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> age = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">cry</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">&quot;å°ç‹—æ±ªæ±ªå«~~&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7ã€å¯†å°ç±»"><a href="#7ã€å¯†å°ç±»" class="headerlink" title="7ã€å¯†å°ç±»"></a>7ã€å¯†å°ç±»</h3><blockquote><ul><li><ol><li>å¦‚æœæƒ³è®© case ç±»çš„æ‰€æœ‰å­ç±»éƒ½å¿…é¡»åœ¨ç”³æ˜è¯¥ç±»çš„ç›¸åŒçš„æºæ–‡ä»¶ä¸­å®šä¹‰ï¼Œå¯ä»¥å°†æ ·ä¾‹ç±»çš„é€šç”¨è¶…ç±»å£°æ˜ä¸º<code>sealed</code>ï¼Œè¿™ä¸ªè¶…ç±»ç§°ä¹‹ä¸ºå¯†å°ç±»ã€‚</li></ol></li><li><ol start="2"><li>å¯†å°å°±æ˜¯ä¸èƒ½åœ¨å…¶ä»–æ–‡ä»¶ä¸­å®šä¹‰/ä½¿ç”¨ç±»ã€‚</li></ol></li></ul></blockquote><h2 id="ä¸‰ã€å‡½æ•°å¼ç¼–ç¨‹"><a href="#ä¸‰ã€å‡½æ•°å¼ç¼–ç¨‹" class="headerlink" title="ä¸‰ã€å‡½æ•°å¼ç¼–ç¨‹"></a>ä¸‰ã€å‡½æ•°å¼ç¼–ç¨‹</h2><h3 id="1ã€åå‡½æ•°"><a href="#1ã€åå‡½æ•°" class="headerlink" title="1ã€åå‡½æ•°"></a>1ã€åå‡½æ•°</h3><blockquote><p>åœ¨å¯¹ç¬¦åˆæŸä¸ªæ¡ä»¶ï¼Œè€Œä¸æ˜¯æ‰€æœ‰æƒ…å†µ è¿›è¡Œé€»è¾‘æ“ä½œæ—¶ï¼Œä½¿ç”¨åå‡½æ•°æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©å°†åŒ…åœ¨å¤§æ‹¬å·å†…çš„ä¸€ç»„ case è¯­å¥å°è£…ä¸ºå‡½æ•°ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºåå‡½æ•°ï¼Œå®ƒåªå¯¹ä¼šä½œç”¨äºæŒ‡å®šç±»å‹çš„å‚æ•°æˆ–æŒ‡å®šèŒƒå›´å€¼çš„å‚æ•°å®æ–½è®¡ç®—ï¼Œè¶…å‡ºèŒƒå›´çš„å€¼ä¼šå¿½ç•¥.</p><p>åå‡½æ•°åœ¨ Scala ä¸­æ˜¯ä¸€ä¸ªç‰¹è´¨ <code>PartialFunction</code></p></blockquote><blockquote><ul><li><ol><li>ä½¿ç”¨æ„å»ºç‰¹è´¨çš„å®ç°ç±»(ä½¿ç”¨çš„æ–¹å¼æ˜¯ PartialFunction çš„åŒ¿åå­ç±»)</li></ol></li><li><ol start="2"><li>PartialFunction æ˜¯ä¸ªç‰¹è´¨(çœ‹æºç )</li></ol></li><li><ol start="3"><li>æ„å»ºåå‡½æ•°æ—¶ï¼Œå‚æ•°å½¢å¼ [Any, Int]æ˜¯æ³›å‹ï¼Œç¬¬ä¸€ä¸ªè¡¨ç¤ºä¼ å…¥å‚æ•°ç±»å‹ï¼Œç¬¬äºŒä¸ªè¡¨ç¤ºè¿”å›å‚æ•°</li></ol></li><li><ol start="4"><li>å½“ä½¿ç”¨åå‡½æ•°æ—¶ï¼Œä¼šéå†é›†åˆçš„æ‰€æœ‰å…ƒç´ ï¼Œç¼–è¯‘å™¨æ‰§è¡Œæµç¨‹æ—¶å…ˆæ‰§è¡Œ isDefinedAt()å¦‚æœä¸º true ,å°±ä¼šæ‰§è¡Œ apply,æ„å»ºä¸€ä¸ªæ–°çš„ Int å¯¹è±¡è¿”å›</li></ol></li><li><ol start="5"><li>æ‰§è¡Œ isDefinedAt() ä¸º false å°±è¿‡æ»¤æ‰è¿™ä¸ªå…ƒç´ ï¼Œå³ä¸æ„å»ºæ–°çš„ Int å¯¹è±¡.</li></ol></li><li><ol start="6"><li>map å‡½æ•°ä¸æ”¯æŒåå‡½æ•°ï¼Œå› ä¸º map åº•å±‚çš„æœºåˆ¶å°±æ˜¯æ‰€æœ‰å¾ªç¯éå†ï¼Œæ— æ³•è¿‡æ»¤å¤„ç†åŸæ¥é›†åˆçš„å…ƒç´ </li></ol></li><li><ol start="7"><li>collect å‡½æ•°æ”¯æŒåå‡½æ•°</li></ol></li></ul></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">demo2</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> list = <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="string">&quot;abc&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> function1 = <span class="keyword">new</span> <span class="type">PartialFunction</span>[<span class="type">Any</span>,<span class="type">Int</span>] &#123;</span><br><span class="line">      <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">isDefinedAt</span></span>(x: <span class="type">Any</span>): <span class="type">Boolean</span> = &#123;</span><br><span class="line">        <span class="comment">//åˆ¤æ–­xæ˜¯å¦æ˜¯intç±»å‹</span></span><br><span class="line">        x.isInstanceOf[<span class="type">Int</span>]</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(v1: <span class="type">Any</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">        <span class="comment">//å°†æ˜¯intç±»å‹çš„å…ƒç´ å€¼+1,ç„¶åè¿”å›ç›¸åŠ ä¹‹åçš„å€¼</span></span><br><span class="line">        v1.asInstanceOf[<span class="type">Int</span>] + <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒç”¨åå‡½æ•°ä¸èƒ½ä½¿ç”¨ map, è€Œæ˜¯ collect</span></span><br><span class="line">    <span class="keyword">val</span> list2 = list.collect(function1)</span><br><span class="line">    println(list2)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åå‡½æ•°ç®€åŒ–</strong></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–¹å¼1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span></span>: <span class="type">PartialFunction</span>[<span class="type">Any</span>, <span class="type">Int</span>] = &#123;</span><br><span class="line">  <span class="keyword">case</span> i: <span class="type">Int</span> =&gt; i + <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">println(list.collect(f2))</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–¹å¼2</span></span><br><span class="line"><span class="keyword">val</span> list = <span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="string">&quot;abc&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> list3 = list.collect &#123;</span><br><span class="line">    <span class="keyword">case</span> i: <span class="type">Int</span> =&gt; i + <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">println(list3)</span><br></pre></td></tr></table></figure><h3 id="2ã€åŒ¿åå‡½æ•°"><a href="#2ã€åŒ¿åå‡½æ•°" class="headerlink" title="2ã€åŒ¿åå‡½æ•°"></a>2ã€åŒ¿åå‡½æ•°</h3><blockquote><p>æ²¡æœ‰åå­—çš„å‡½æ•°å°±æ˜¯åŒ¿åå‡½æ•°ï¼Œå¯ä»¥é€šè¿‡ å‡½æ•°è¡¨è¾¾å¼ï¼Œæ¥è®¾ç½®åŒ¿åå‡½æ•°</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> add = (a: <span class="type">Int</span>, b: <span class="type">Int</span>) =&gt; a + b</span><br><span class="line">println(add(<span class="number">1</span>,<span class="number">2</span>))</span><br></pre></td></tr></table></figure><h3 id="3ã€é«˜é˜¶å‡½æ•°"><a href="#3ã€é«˜é˜¶å‡½æ•°" class="headerlink" title="3ã€é«˜é˜¶å‡½æ•°"></a>3ã€é«˜é˜¶å‡½æ•°</h3><blockquote><p>èƒ½å¤Ÿæ¥å—å‡½æ•°ä½œä¸ºå‚æ•°çš„å‡½æ•°ï¼Œå«åšé«˜é˜¶å‡½æ•° <code>(higher-order function)</code>ã€‚å¯ä½¿åº”ç”¨ç¨‹åºæ›´åŠ å¥å£®ã€‚ é«˜é˜¶å‡½æ•°å¯ä»¥è¿”å›ä¸€ä¸ªåŒ¿åå‡½æ•°ã€‚</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">demo3</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(minusxy(<span class="number">3</span>)(<span class="number">4</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">minusxy</span></span>(x: <span class="type">Int</span>) = &#123;</span><br><span class="line">    (y: <span class="type">Int</span>) =&gt; x - y</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€é—­åŒ…"><a href="#4ã€é—­åŒ…" class="headerlink" title="4ã€é—­åŒ…"></a>4ã€é—­åŒ…</h3><blockquote><p>åŸºæœ¬ä»‹ç»ï¼šé—­åŒ…å°±æ˜¯ä¸€ä¸ªå‡½æ•°å’Œä¸å…¶ç›¸å…³çš„å¼•ç”¨ç¯å¢ƒï¼ˆå˜é‡/å€¼ï¼‰ç»„åˆçš„ä¸€ä¸ªæ•´ä½“(å®ä½“)ã€‚</p></blockquote><p><strong>få°±æ˜¯ä¸€ä¸ªé—­åŒ…</strong></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">demo3</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> f = minusxy(<span class="number">10</span>)</span><br><span class="line">    println(f(<span class="number">2</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">minusxy</span></span>(x: <span class="type">Int</span>) = &#123;</span><br><span class="line">    (y: <span class="type">Int</span>) =&gt; x - y</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€å‡½æ•°æŸ¯é‡ŒåŒ–-curry"><a href="#5ã€å‡½æ•°æŸ¯é‡ŒåŒ–-curry" class="headerlink" title="5ã€å‡½æ•°æŸ¯é‡ŒåŒ–(curry)"></a>5ã€å‡½æ•°æŸ¯é‡ŒåŒ–(curry)</h3><blockquote><ul><li><ol><li>å‡½æ•°ç¼–ç¨‹ä¸­ï¼Œæ¥å—å¤šä¸ªå‚æ•°çš„å‡½æ•°éƒ½å¯ä»¥è½¬åŒ–ä¸ºæ¥å—å•ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œè¿™ä¸ªè½¬åŒ–è¿‡ç¨‹å°±å«æŸ¯é‡ŒåŒ–ã€‚</li></ol></li><li><ol start="2"><li>æŸ¯é‡ŒåŒ–å°±æ˜¯è¯æ˜äº†å‡½æ•°åªéœ€è¦ä¸€ä¸ªå‚æ•°è€Œå·²ã€‚å…¶å®æˆ‘ä»¬åˆšæ‰çš„å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œå·²ç»æ¶‰åŠåˆ°äº†æŸ¯é‡ŒåŒ–æ“ä½œã€‚</li></ol></li><li><ol start="3"><li>ä¸ç”¨è®¾ç«‹æŸ¯é‡ŒåŒ–å­˜åœ¨çš„æ„ä¹‰è¿™æ ·çš„å‘½é¢˜ã€‚æŸ¯é‡ŒåŒ–å°±æ˜¯ä»¥å‡½æ•°ä¸ºä¸»ä½“è¿™ç§æ€æƒ³å‘å±•çš„å¿…ç„¶äº§ç”Ÿçš„ç»“æœã€‚(å³ï¼šæŸ¯é‡ŒåŒ–æ˜¯é¢å‘å‡½æ•°æ€æƒ³çš„å¿…ç„¶äº§ç”Ÿç»“æœ)<br>ä¼ ç»Ÿæ–¹å¼, å‡½æ•°/æ–¹æ³•(å˜é‡)ï¼Œ å¯¹è±¡.æ–¹æ³•(å˜é‡)<br>é›†åˆ.å‡½æ•°(å‡½æ•°).å‡½æ•°(å‡½æ•°).å‡½æ•°(å‡½æ•°) //å‡½æ•°é“¾</li></ol></li></ul></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">eq</span></span>(s1: <span class="type">String</span>)(s2: <span class="type">String</span>):<span class="type">Boolean</span>=&#123;</span><br><span class="line">  s1.eq(s2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6ã€æ§åˆ¶æŠ½è±¡"><a href="#6ã€æ§åˆ¶æŠ½è±¡" class="headerlink" title="6ã€æ§åˆ¶æŠ½è±¡"></a>6ã€æ§åˆ¶æŠ½è±¡</h3><blockquote><ul><li><ol><li>å‚æ•°æ˜¯å‡½æ•°</li></ol></li><li><ol start="2"><li>å‡½æ•°å‚æ•°æ²¡æœ‰è¾“å…¥å€¼ä¹Ÿæ²¡æœ‰è¿”å›å€¼</li></ol></li></ul></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">myRunThread</span></span>(f1: =&gt;<span class="type">Unit</span>)=&#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="type">Thread</span>&#123;</span><br><span class="line">      <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">run</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">        f1</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;.start()</span><br><span class="line">  </span><br><span class="line">  myRunThread&#123;</span><br><span class="line">    println(<span class="string">&quot;start&quot;</span>)</span><br><span class="line">    <span class="type">Thread</span>.sleep(<span class="number">2000</span>)</span><br><span class="line">    println(<span class="string">&quot;end&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å››ã€æ³›å‹"><a href="#å››ã€æ³›å‹" class="headerlink" title="å››ã€æ³›å‹"></a>å››ã€æ³›å‹</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">demo2</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> value = <span class="keyword">new</span> <span class="type">IntMessage</span>[<span class="type">Int</span>](<span class="number">20</span>)</span><br><span class="line">    println(value.get)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åœ¨ Scala å®šä¹‰æ³›å‹ç”¨[T]ï¼Œ s ä¸ºæ³›å‹çš„å¼•ç”¨</span></span><br><span class="line">  <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Message</span>[<span class="type">T</span>](<span class="params">s:<span class="type">T</span></span>)</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span></span>:<span class="type">T</span> = s</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//å¯ä»¥æ„å»º Int ç±»å‹çš„ Message</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">IntMessage</span>[<span class="type">Int</span>](<span class="params">msg:<span class="type">Int</span></span>) <span class="keyword">extends</span> <span class="title">Message</span>(<span class="params">msg</span>)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//String ç±»å‹çš„ Message</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">StringMessage</span>[<span class="type">String</span>](<span class="params">msg:<span class="type">String</span></span>) <span class="keyword">extends</span> <span class="title">Message</span>(<span class="params">msg</span>)</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1ã€ä¸Šç•Œã€ä¸‹ç•Œ"><a href="#1ã€ä¸Šç•Œã€ä¸‹ç•Œ" class="headerlink" title="1ã€ä¸Šç•Œã€ä¸‹ç•Œ"></a>1ã€ä¸Šç•Œã€ä¸‹ç•Œ</h3><p><strong>scala ä¸­ä¸Šç•Œ</strong><br>åœ¨ scala é‡Œè¡¨ç¤ºæŸä¸ªç±»å‹æ˜¯ A ç±»å‹çš„å­ç±»å‹ï¼Œä¹Ÿç§°ä¸Šç•Œæˆ–ä¸Šé™ï¼Œä½¿ç”¨ &lt;: å…³é”®å­—ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">T</span> &lt;:<span class="type">A</span>] <span class="comment">//A æ˜¯ T çš„ä¸Šç•Œ</span></span><br><span class="line"><span class="comment">//æˆ–ç”¨é€šé…ç¬¦:</span></span><br><span class="line">[_ &lt;:<span class="type">A</span>]</span><br></pre></td></tr></table></figure><p><strong>scala ä¸­ä¸‹ç•Œ</strong><br>åœ¨ scala çš„ä¸‹ç•Œæˆ–ä¸‹é™ï¼Œä½¿ç”¨ &gt;: å…³é”®å­—ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">T</span> &gt;: <span class="type">A</span>] <span class="comment">//A æ˜¯ T çš„ä¸‹ç•Œ,ä¸‹é™</span></span><br><span class="line"><span class="comment">//æˆ–ç”¨é€šé…ç¬¦:</span></span><br><span class="line">[_ &gt;:<span class="type">A</span>]</span><br></pre></td></tr></table></figure><h3 id="2ã€åå˜ã€é€†å˜å’Œä¸å˜"><a href="#2ã€åå˜ã€é€†å˜å’Œä¸å˜" class="headerlink" title="2ã€åå˜ã€é€†å˜å’Œä¸å˜"></a>2ã€åå˜ã€é€†å˜å’Œä¸å˜</h3><blockquote><p>Scala çš„åå˜(+)ï¼Œé€†å˜(-)ï¼Œåå˜ covariantã€é€†å˜ contravariantã€ä¸å¯å˜ invariant</p></blockquote><ul><li><ol><li>C[+T]ï¼šå¦‚æœ A æ˜¯ B çš„å­ç±»ï¼Œé‚£ä¹ˆ C[A]æ˜¯ C[B]çš„å­ç±»ï¼Œç§°ä¸ºåå˜ã€‚</li></ol></li><li><ol start="2"><li>C[-T]ï¼šå¦‚æœ A æ˜¯ B çš„å­ç±»ï¼Œé‚£ä¹ˆ C[B]æ˜¯ C[A]çš„å­ç±»ï¼Œç§°ä¸ºé€†å˜ã€‚</li></ol></li><li><ol start="3"><li>C[T]ï¼šæ— è®º A å’Œ B æ˜¯ä»€ä¹ˆå…³ç³»ï¼ŒC[A]å’Œ C[B]æ²¡æœ‰ä»å±å…³ç³»ã€‚ç§°ä¸ºä¸å˜ã€‚</li></ol></li></ul>]]></content>
    
    
    <summary type="html">Scala combines object-oriented and functional programming in one concise, high-level language. Scala&#39;s static types help avoid bugs in complex applications, and its JVM and JavaScript runtimes let you build high-performance systems with easy access to huge ecosystems of libraries.</summary>
    
    
    
    <category term="ç¼–ç¨‹è¯­è¨€" scheme="https://www.buildworld.cn/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
    <category term="Scala" scheme="https://www.buildworld.cn/tags/Scala/"/>
    
  </entry>
  
  <entry>
    <title>å¤§æ•°æ®åˆ©å™¨--Scalaè¯­è¨€å­¦ä¹ (åŸºç¡€)</title>
    <link href="https://www.buildworld.cn/2020/07/12/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%88%A9%E5%99%A8-Scala%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/"/>
    <id>https://www.buildworld.cn/2020/07/12/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%88%A9%E5%99%A8-Scala%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/</id>
    <published>2020-07-12T08:21:30.000Z</published>
    <updated>2020-07-20T08:16:48.581Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Scala"><a href="#Scala" class="headerlink" title="Scala"></a>Scala</h2><blockquote><p>Scala combines object-oriented and functional programming in one concise, high-level language. Scalaâ€™s static types help avoid bugs in complex applications, and its JVM and JavaScript runtimes let you build high-performance systems with easy access to huge ecosystems of libraries.</p></blockquote><blockquote><p>ç»™å¤§å®¶æ¨èä¸€ä¸ªåœ¨çº¿çš„scalaæ–‡æ¡£ç½‘ç«™ï¼š<a href="https://static.runoob.com/download/Scala%E8%AF%AD%E8%A8%80%E8%A7%84%E8%8C%83.pdf">https://static.runoob.com/download/Scala%E8%AF%AD%E8%A8%80%E8%A7%84%E8%8C%83.pdf</a></p></blockquote><h3 id="1ã€ScalaåŸºæœ¬çš„ç¨‹åºç»“æ„è¯´æ˜"><a href="#1ã€ScalaåŸºæœ¬çš„ç¨‹åºç»“æ„è¯´æ˜" class="headerlink" title="1ã€ScalaåŸºæœ¬çš„ç¨‹åºç»“æ„è¯´æ˜"></a>1ã€ScalaåŸºæœ¬çš„ç¨‹åºç»“æ„è¯´æ˜</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¯¹ scala çš„åŸºæœ¬çš„ç¨‹åºç»“æ„è¯´æ˜</span></span><br><span class="line"><span class="comment">//1. object æ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œè¡¨ç¤ºä¸€ä¸ªä¼´ç”Ÿå¯¹è±¡</span></span><br><span class="line"><span class="comment">//2. å¦‚æœè¯¥æ–‡ä»¶åªå‡ºç°äº†ä¸€ä¸ª object HelloScala å°±ä¼šåœ¨ç¼–è¯‘åä¸¤ä¸ª.class æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//3. ç¬¬ä¸€ä¸ªæ–‡ä»¶æ˜¯ HelloScala.class è¿™ä¸ªè¡¨ç¤ºä»–çš„ä¼´ç”Ÿç±»ï¼Œä½†æ˜¯ç©ºçš„.</span></span><br><span class="line"><span class="comment">//4. ç¬¬ 2 ä¸ªæ–‡ä»¶æ˜¯ HelloScala$.class å¯¹åº”çš„æ˜¯ object HelloScala,ä½†æ˜¯æœ¬è´¨æ˜¯è°ƒç”¨å®ƒå¯¹åº”çš„ä¸€ä¸ªé™æ€å±æ€§ MODULE$</span></span><br><span class="line"><span class="comment">//5. è¿™ä¸¤ä¸ªæ–‡ä»¶çš„å…³ç³»å’Œ main å‡½æ•°çš„å…¥å£å…³ç³»ä¸€ä¼šåˆ†æ</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">HelloScala</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 1. def è¡¨ç¤ºä¸€ä¸ªæ–¹æ³•æˆ–è€…ä¸€ä¸ªå‡½æ•°</span></span><br><span class="line">  <span class="comment">// 2. main è¡¨ç¤ºå…¥å£</span></span><br><span class="line">  <span class="comment">// 3. args: Array[String] è¡¨ç¤ºå½¢å‚ï¼Œargs æ˜¯å½¢å‚å Array[String] æ˜¯å½¢å‚ç±»å‹è¡¨ç¤ºä¸€ä¸ª Array æ•°ç»„</span></span><br><span class="line">  <span class="comment">// 4. :Unit è¡¨ç¤ºè¿”å›å€¼ç±»å‹ä¸º Unit ï¼Œç­‰ä»·äº java çš„ void</span></span><br><span class="line">  <span class="comment">// 5. = è¡¨ç¤º åé¢å†™çš„æ˜¯å‡½æ•°ä½“/æ–¹æ³•ä½“, å®ƒè¿˜æœ‰è¿”å›å€¼ç±»å‹æ¨å¯¼çš„ä½œç”¨</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]):<span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// è¡¨ç¤ºæ˜¯ è¾“å‡ºï¼Œ ç±»ä¼¼ System.out.println(&quot;hello, scala ä¸–ç•Œ!&quot;)</span></span><br><span class="line">    <span class="comment">// åœ¨ scala è¯­å¥åï¼Œä¸éœ€è¦å¸¦; //ä½“ç°ç®€æ´</span></span><br><span class="line">    println(<span class="string">&quot;hello, scala ä¸–ç•Œ!&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€Scala-çš„æ•°æ®ç±»å‹ä¸€è§ˆå›¾"><a href="#2ã€Scala-çš„æ•°æ®ç±»å‹ä¸€è§ˆå›¾" class="headerlink" title="2ã€Scala çš„æ•°æ®ç±»å‹ä¸€è§ˆå›¾"></a>2ã€Scala çš„æ•°æ®ç±»å‹ä¸€è§ˆå›¾</h3><p><img src="https://file.buildworld.cn/img/20200712154042.png"></p><ul><li><ol><li><code>Any</code> æ˜¯æ‰€æœ‰ç±»çš„æ ¹ç±»å‹,å³æ‰€æœ‰ç±»çš„çˆ¶ç±»(åŸºç±»)</li></ol></li><li><ol start="2"><li>åœ¨ <code>Scala</code>ä¸­ç±»åˆ†ä¸ºä¸¤ä¸ªå¤§çš„ç±»å‹åˆ†æ”¯(<code>AnyVal</code> [<strong>å€¼ç±»å‹ï¼Œå³å¯ä»¥ç†è§£æˆå°±æ˜¯ java çš„åŸºæœ¬æ•°æ®ç±»å‹</strong>],<code>AnyRef</code> ç±»å‹)</li></ol></li><li><ol start="3"><li>åœ¨ <code>AnyVal</code> è™½ç„¶å«å€¼ç±»å‹ï¼Œä½†æ˜¯ä»ç„¶æ˜¯<strong>ç±»(å¯¹è±¡)</strong></li></ol></li><li><ol start="4"><li>åœ¨ <code>Scala</code>ä¸­æœ‰ä¸¤ä¸ªç‰¹åˆ«çš„ç±»å‹(<code>Null</code> ), è¿˜æœ‰ä¸€ä¸ªæ˜¯ <code>Nothing</code></li></ol></li><li><ol start="5"><li><code>Null</code> ç±»å‹åªæœ‰ä¸€ä¸ªå®ä¾‹ <code>null</code>, ä»–æ˜¯ <code>bottom class</code> ,æ˜¯ <code>AnyRef</code> çš„å­ç±».</li></ol></li><li><ol start="6"><li><code>Nothing</code> ç±»å‹æ˜¯æ‰€æœ‰ç±»çš„å­ç±»ï¼Œ å®ƒçš„ä»·å€¼æ˜¯åœ¨äºå› ä¸ºå®ƒæ˜¯æ‰€æœ‰ç±»çš„å­ç±»ï¼Œå°±å¯ä»¥å°† <code>Nothing</code> ç±»å‹çš„å¯¹è±¡è¿”å›ç»™ä»»æ„çš„å˜é‡æˆ–è€…æ–¹æ³•ï¼Œæ¯”å¦‚æ¡ˆä¾‹</li></ol><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span></span>():<span class="type">Nothing</span>= &#123; <span class="comment">//è¡¨ç¤º f1 æ–¹æ³•å°±æ˜¯æ²¡æœ‰æ­£å¸¸çš„è¿”å›å€¼ï¼Œä¸“é—¨ç”¨äºè¿”å›å¼‚å¸¸</span></span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">Exception</span>(<span class="string">&quot;å¼‚å¸¸å‘ç”Ÿ&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><ol start="7"><li>åœ¨ <code>Scala</code>ä¸­ä»ç„¶éµå®ˆ ä½ç²¾åº¦çš„æ•°æ®è‡ªåŠ¨çš„è½¬æˆé«˜ç²¾åº¦çš„æ•°æ®ç±»å‹ã€‚</li></ol></li><li><ol start="8"><li>åœ¨ <code>Scala</code>ä¸­ï¼Œ<code>Unit</code> ç±»å‹æ¯”è¾ƒç‰¹æ®Šï¼Œè¿™ä¸ªç±»å‹ä¹Ÿåªæœ‰ä¸€ä¸ªå®ä¾‹ ()  </li></ol></li></ul><h4 id="Scalaæ•°æ®ç±»å‹åˆ—è¡¨"><a href="#Scalaæ•°æ®ç±»å‹åˆ—è¡¨" class="headerlink" title="Scalaæ•°æ®ç±»å‹åˆ—è¡¨"></a>Scalaæ•°æ®ç±»å‹åˆ—è¡¨</h4><table><thead><tr><th align="center">æ•°æ®ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td align="center">Byte</td><td>8ä½æœ‰ç¬¦å·è¡¥ç æ•´æ•°ã€‚æ•°å€¼åŒºé—´ä¸º -128 åˆ° 127</td></tr><tr><td align="center">Short</td><td>16ä½æœ‰ç¬¦å·è¡¥ç æ•´æ•°ã€‚æ•°å€¼åŒºé—´ä¸º -32768 åˆ° 32767</td></tr><tr><td align="center">Int</td><td>32ä½æœ‰ç¬¦å·è¡¥ç æ•´æ•°ã€‚æ•°å€¼åŒºé—´ä¸º -2147483648 åˆ° 2147483647</td></tr><tr><td align="center">Long</td><td>64ä½æœ‰ç¬¦å·è¡¥ç æ•´æ•°ã€‚æ•°å€¼åŒºé—´ä¸º -9223372036854775808 åˆ° 9223372036854775807</td></tr><tr><td align="center">Float</td><td>32 ä½ IEEE 754æ ‡å‡†çš„å•ç²¾åº¦æµ®ç‚¹æ•°</td></tr><tr><td align="center">Double</td><td>64 ä½ IEEE 754æ ‡å‡†çš„åŒç²¾åº¦æµ®ç‚¹æ•°</td></tr><tr><td align="center">Char</td><td>16ä½æ— ç¬¦å·Unicodeå­—ç¬¦, åŒºé—´å€¼ä¸º U+0000 åˆ° U+FFFF</td></tr><tr><td align="center">String</td><td>å­—ç¬¦åºåˆ—</td></tr><tr><td align="center">Boolean</td><td>trueæˆ–false</td></tr><tr><td align="center">Unit</td><td>è¡¨ç¤ºæ— å€¼ï¼Œå’Œå…¶ä»–è¯­è¨€ä¸­voidç­‰åŒã€‚ç”¨ä½œä¸è¿”å›ä»»ä½•ç»“æœçš„æ–¹æ³•çš„ç»“æœç±»å‹ã€‚Unitåªæœ‰ä¸€ä¸ªå®ä¾‹å€¼ï¼Œå†™æˆ()ã€‚</td></tr><tr><td align="center">Null</td><td><strong>null  å¯ä»¥èµ‹å€¼ç»™ä»»æ„å¼•ç”¨ç±»å‹(AnyRef)ï¼Œä½†æ˜¯ä¸èƒ½èµ‹å€¼ç»™å€¼ç±»å‹</strong></td></tr><tr><td align="center">Nothing</td><td>Nothingç±»å‹åœ¨Scalaçš„ç±»å±‚çº§çš„æœ€ä½ç«¯ï¼›å®ƒæ˜¯ä»»ä½•å…¶ä»–ç±»å‹çš„å­ç±»å‹ã€‚</td></tr><tr><td align="center">Any</td><td>Anyæ˜¯æ‰€æœ‰å…¶ä»–ç±»çš„è¶…ç±»</td></tr><tr><td align="center">AnyRef</td><td>AnyRefç±»æ˜¯Scalaé‡Œæ‰€æœ‰å¼•ç”¨ç±»(reference class)çš„åŸºç±»</td></tr></tbody></table><h3 id="3ã€å‡½æ•°å¼ç¼–ç¨‹"><a href="#3ã€å‡½æ•°å¼ç¼–ç¨‹" class="headerlink" title="3ã€å‡½æ•°å¼ç¼–ç¨‹"></a>3ã€å‡½æ•°å¼ç¼–ç¨‹</h3><h4 id="å‡½æ•°å¼ç¼–ç¨‹åŸºç¡€"><a href="#å‡½æ•°å¼ç¼–ç¨‹åŸºç¡€" class="headerlink" title="å‡½æ•°å¼ç¼–ç¨‹åŸºç¡€"></a>å‡½æ•°å¼ç¼–ç¨‹åŸºç¡€</h4><blockquote><ul><li><ol><li>å‡½æ•°å®šä¹‰/å£°æ˜</li></ol></li><li><ol start="2"><li>å‡½æ•°è¿è¡Œæœºåˆ¶</li></ol></li><li><ol start="3"><li>é€’å½’ [<strong>æ¨èç¼–ç¨‹è€…é€’å½’æ¥è§£å†³é—®é¢˜, ç®—æ³•åŸºç¡€, é‚®å·®é—®é¢˜ï¼Œæœ€çŸ­è·¯å¾„ï¼ŒèƒŒåŒ…é—®é¢˜, è¿·å®«ï¼Œå›æº¯</strong> ]</li></ol></li><li><ol start="4"><li>è¿‡ç¨‹</li></ol></li><li><ol start="5"><li>æƒ°æ€§å‡½æ•°å’Œå¼‚å¸¸</li></ol></li></ul></blockquote><h4 id="å‡½æ•°å¼ç¼–ç¨‹é«˜çº§"><a href="#å‡½æ•°å¼ç¼–ç¨‹é«˜çº§" class="headerlink" title="å‡½æ•°å¼ç¼–ç¨‹é«˜çº§"></a>å‡½æ•°å¼ç¼–ç¨‹é«˜çº§</h4><blockquote><ul><li><ol><li>å€¼å‡½æ•°(å‡½æ•°å­—é¢é‡)</li></ol></li><li><ol start="2"><li>é«˜é˜¶å‡½æ•°</li></ol></li><li><ol start="3"><li>é—­åŒ…</li></ol></li><li><ol start="4"><li>åº”ç”¨å‡½æ•°</li></ol></li><li><ol start="5"><li>æŸ¯é‡ŒåŒ–å‡½æ•°ï¼ŒæŠ½è±¡æ§åˆ¶..</li></ol></li></ul></blockquote><p><strong>åœ¨ Scala å½“ä¸­ï¼Œå‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œåƒå˜é‡ä¸€æ ·ï¼Œæ—¢å¯ä»¥ä½œä¸ºå‡½æ•°çš„å‚æ•°ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å°†å‡½æ•°èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡. ï¼Œå‡½æ•°çš„åˆ›å»ºä¸ç”¨ä¾èµ–äºç±»æˆ–è€…å¯¹è±¡ï¼Œè€Œåœ¨ Java å½“ä¸­ï¼Œå‡½æ•°çš„åˆ›å»ºåˆ™è¦ä¾èµ–äºç±»ã€æŠ½è±¡ç±»æˆ–è€…æ¥å£ã€‚</strong></p><h4 id="æƒ°æ€§å‡½æ•°"><a href="#æƒ°æ€§å‡½æ•°" class="headerlink" title="æƒ°æ€§å‡½æ•°"></a>æƒ°æ€§å‡½æ•°</h4><blockquote><p>å½“å‡½æ•°è¿”å›å€¼è¢«å£°æ˜ä¸º lazy æ—¶ï¼Œå‡½æ•°çš„æ‰§è¡Œå°†è¢«æ¨è¿Ÿï¼Œç›´åˆ°æˆ‘ä»¬é¦–æ¬¡å¯¹æ­¤å–å€¼ï¼Œè¯¥å‡½æ•°æ‰ä¼šæ‰§è¡Œã€‚è¿™ç§å‡½æ•°æˆ‘ä»¬ç§°ä¹‹ä¸ºæƒ°æ€§å‡½æ•°ï¼Œåœ¨ Java çš„æŸäº›æ¡†æ¶ä»£ç ä¸­ç§°ä¹‹ä¸ºæ‡’åŠ è½½(å»¶è¿ŸåŠ è½½ï¼‰,Javaä¸­æ²¡æœ‰åŸç”Ÿæ–¹æ³•ã€‚</p></blockquote><ul><li><ol><li><code>lazy</code> ä¸èƒ½ä¿®é¥° <code>var</code> ç±»å‹çš„å˜é‡</li></ol></li><li><ol start="2"><li>ä¸ä½†æ˜¯åœ¨è°ƒç”¨å‡½æ•°æ—¶ï¼ŒåŠ äº† <code>lazy</code> ,ä¼šå¯¼è‡´å‡½æ•°çš„æ‰§è¡Œè¢«æ¨è¿Ÿï¼Œæˆ‘ä»¬åœ¨å£°æ˜ä¸€ä¸ªå˜é‡æ—¶ï¼Œå¦‚æœç»™å£°æ˜äº† <code>lazy</code> ,é‚£ä¹ˆå˜é‡å€¼å¾—åˆ†é…ä¹Ÿä¼šæ¨è¿Ÿã€‚ æ¯”å¦‚ <code>lazy val i = 10</code></li></ol></li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Demo1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">lazy</span> <span class="keyword">val</span> res = sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>)</span><br><span class="line">    println(res) <span class="comment">//ä½¿ç”¨resæ—¶ï¼Œæ‰ä¼šçœŸæ­£çš„å¼€å§‹è®¡ç®—</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">sum</span></span>(args: <span class="type">Int</span>*): <span class="type">Int</span> = &#123;</span><br><span class="line">    <span class="keyword">var</span> res = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> (n &lt;- args) &#123;</span><br><span class="line">      res += n</span><br><span class="line">    &#125;</span><br><span class="line">    res</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¼‚å¸¸"><a href="#å¼‚å¸¸" class="headerlink" title="å¼‚å¸¸"></a>å¼‚å¸¸</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//scala ä¸­å»æ‰æ‰€è°“çš„ checkedï¼ˆç¼–è¯‘ï¼‰ å¼‚å¸¸</span></span><br><span class="line">    <span class="comment">//è®¾è®¡è€…è®¤ä¸ºï¼Œå¦‚æœç¨‹åºå‘˜ç¼–ç¨‹æ—¶ï¼Œè®¤ä¸ºæŸæ®µä»£ç å¯ç–‘ï¼Œå°±ç›´æ¥ try å¹¶å¤„ç†</span></span><br><span class="line">    <span class="comment">//è¯´æ˜</span></span><br><span class="line">    <span class="comment">//1. å¦‚æœä»£ç å¯ç–‘ï¼Œä½¿ç”¨ try è¿›è¡Œå¤„ç†</span></span><br><span class="line">    <span class="comment">//2. åœ¨ catch ä¸­ï¼Œå¯ä»¥æœ‰å¤šä¸ª case ï¼Œå¯¹å¯èƒ½çš„å¼‚å¸¸è¿›è¡ŒåŒ¹é…</span></span><br><span class="line">    <span class="comment">//3. case ex: Exception =&gt; println(&quot;å¼‚å¸¸ä¿¡æ¯=&quot; + ex.getMessage)</span></span><br><span class="line">    <span class="comment">// (1) case æ˜¯ä¸€ä¸ªå…³é”®å­—</span></span><br><span class="line">    <span class="comment">// (2) ex: Exception å¼‚å¸¸çš„ç§ç±»</span></span><br><span class="line">    <span class="comment">// (3) =&gt; è¡¨æ˜åçš„ä»£ç æ˜¯å¯¹å¼‚å¸¸è¿›è¡Œå¤„ç†,å¦‚æœå¤„ç†çš„ä»£ç æœ‰å¤šæ¡è¯­å¥å¯ä»¥&#123;&#125;æ‰©èµ·</span></span><br><span class="line">    <span class="comment">//4. åœ¨ scala ä¸­æŠŠèŒƒå›´å°çš„å¼‚å¸¸æ”¾åœ¨åé¢ï¼Œè¯­æ³•ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ä¸æ¨è</span></span><br><span class="line">    <span class="comment">//5. å¦‚æœæ•è·å¼‚å¸¸ï¼Œä»£ç å³ä½¿å‡ºç°å¼‚å¸¸ï¼Œç¨‹åºä¹Ÿä¸ä¼šå´©æºƒã€‚</span></span><br><span class="line">    </span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> n = <span class="number">10</span> /<span class="number">0</span></span><br><span class="line">  &#125;<span class="keyword">catch</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> ex:<span class="type">ArithmeticException</span>=&gt;&#123;</span><br><span class="line">      println(<span class="string">&quot;å¼‚å¸¸ï¼š&quot;</span>+ex.getMessage)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> exception: <span class="type">Exception</span>=&gt;&#123;</span><br><span class="line">      println(exception.getMessage)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">    printf(<span class="string">&quot;å®Œæˆ&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Scala æä¾›äº† <code>throws</code> å…³é”®å­—æ¥å£°æ˜å¼‚å¸¸ã€‚å¯ä»¥ä½¿ç”¨æ–¹æ³•å®šä¹‰å£°æ˜å¼‚å¸¸ã€‚ å®ƒå‘è°ƒç”¨è€…å‡½æ•°æä¾›äº†æ­¤æ–¹æ³•å¯èƒ½å¼•å‘æ­¤å¼‚å¸¸çš„ä¿¡æ¯ã€‚ å®ƒæœ‰åŠ©äºè°ƒç”¨å‡½æ•°å¤„ç†å¹¶å°†è¯¥ä»£ç åŒ…å«åœ¨ try-catch å—ä¸­ï¼Œä»¥é¿å…ç¨‹åºå¼‚å¸¸ç»ˆæ­¢ã€‚åœ¨ scala ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>@throws</code> æ³¨é‡Šæ¥å£°æ˜å¼‚å¸¸</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@throws</span> (classOf[<span class="type">ArithmeticException</span>])</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">function1</span></span>(): <span class="type">Unit</span> =&#123;</span><br><span class="line">  <span class="keyword">var</span> n = <span class="number">10</span>/<span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€Scala-æ„é€ å™¨çš„åŸºæœ¬è¯­æ³•"><a href="#4ã€Scala-æ„é€ å™¨çš„åŸºæœ¬è¯­æ³•" class="headerlink" title="4ã€Scala æ„é€ å™¨çš„åŸºæœ¬è¯­æ³•"></a>4ã€Scala æ„é€ å™¨çš„åŸºæœ¬è¯­æ³•</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">ç±»å</span>(<span class="params"> å½¢å‚åˆ—è¡¨</span>) </span>&#123; <span class="comment">//  ä¸»æ„é€ å™¨</span></span><br><span class="line"><span class="comment">//  ç±»ä½“</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">this</span></span>( å½¢å‚åˆ—è¡¨) &#123; <span class="comment">//  è¾…åŠ©æ„é€ å™¨</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">this</span></span>( å½¢å‚åˆ—è¡¨) &#123; <span class="comment">// è¾…åŠ©æ„é€ å™¨å¯ä»¥æœ‰å¤šä¸ª...</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å±æ€§é«˜çº§"><a href="#å±æ€§é«˜çº§" class="headerlink" title="å±æ€§é«˜çº§"></a>å±æ€§é«˜çº§</h4><blockquote><ul><li><ol><li>Scala ç±»çš„ä¸»æ„é€ å™¨çš„å½¢å‚<code>æœªç”¨ä»»ä½•ä¿®é¥°ç¬¦ä¿®é¥°</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªå‚æ•°æ˜¯å±€éƒ¨å˜é‡ã€‚</li></ol></li><li><ol start="2"><li>å¦‚æœå‚æ•°ä½¿ç”¨ <code>val</code> å…³é”®å­—å£°æ˜ï¼Œé‚£ä¹ˆ Scala ä¼šå°†å‚æ•°ä½œä¸ºç±»çš„ç§æœ‰çš„åªè¯»å±æ€§ä½¿ç”¨</li></ol></li><li><ol start="3"><li>å¦‚æœå‚æ•°ä½¿ç”¨ <code>var</code> å…³é”®å­—å£°æ˜ï¼Œé‚£ä¹ˆé‚£ä¹ˆ Scala ä¼šå°†å‚æ•°ä½œä¸ºç±»çš„æˆå‘˜å±æ€§ä½¿ç”¨,å¹¶ä¼šæä¾›å±æ€§å¯¹åº”çš„xxx()[ç±»ä¼¼ getter]/xxx_$eq()[ç±»ä¼¼ setter]æ–¹æ³•ï¼Œå³è¿™æ—¶çš„æˆå‘˜å±æ€§æ˜¯ç§æœ‰çš„ï¼Œä½†æ˜¯å¯è¯»å†™ã€‚</li></ol></li></ul></blockquote><h4 id="Bean-å±æ€§"><a href="#Bean-å±æ€§" class="headerlink" title="Bean å±æ€§"></a>Bean å±æ€§</h4><blockquote><p>JavaBeans è§„èŒƒå®šä¹‰äº† Java çš„å±æ€§æ˜¯åƒ getXxxï¼ˆï¼‰å’Œ setXxxï¼ˆï¼‰çš„æ–¹æ³•ã€‚è®¸å¤š Java å·¥å…·ï¼ˆæ¡†æ¶ï¼‰éƒ½ä¾èµ–è¿™ä¸ªå‘½åä¹ æƒ¯ã€‚ä¸ºäº† Java çš„äº’æ“ä½œæ€§ã€‚å°† Scala å­—æ®µåŠ <code>@BeanProperty</code> æ—¶ï¼Œè¿™æ ·ä¼šè‡ªåŠ¨ç”Ÿæˆè§„èŒƒçš„ setXxx/getXxx æ–¹æ³•ã€‚è¿™æ—¶å¯ä»¥ä½¿ç”¨ å¯¹è±¡.setXxx() å’Œ å¯¹è±¡.getXxx() æ¥è°ƒç”¨å±æ€§ã€‚</p></blockquote><ul><li><ol><li>ç»™æŸä¸ªå±æ€§åŠ å…¥<code>@BeanPropetry</code> æ³¨è§£åï¼Œä¼šç”Ÿæˆ getXXX å’Œ setXXX çš„æ–¹æ³•</li></ol></li><li><ol start="2"><li>å¹¶ä¸”å¯¹ åŸæ¥åº•å±‚è‡ªåŠ¨ç”Ÿæˆç±»ä¼¼ xxx(),xxx_$eq()</li></ol></li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">  <span class="meta">@BeanProperty</span> <span class="keyword">var</span> name: <span class="type">String</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="meta">@BeanProperty</span> <span class="keyword">var</span> age: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">  <span class="meta">@BeanProperty</span> <span class="keyword">var</span> color: <span class="type">String</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">this</span></span>(name: <span class="type">String</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>()</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">toString</span> </span>= <span class="string">s&quot;Cat(<span class="subst">$name</span>, <span class="subst">$age</span>, <span class="subst">$color</span>)&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€Scala-ä¸­åŒ…çš„å¯è§æ€§å’Œè®¿é—®ä¿®é¥°ç¬¦çš„ä½¿ç”¨"><a href="#5ã€Scala-ä¸­åŒ…çš„å¯è§æ€§å’Œè®¿é—®ä¿®é¥°ç¬¦çš„ä½¿ç”¨" class="headerlink" title="5ã€Scala ä¸­åŒ…çš„å¯è§æ€§å’Œè®¿é—®ä¿®é¥°ç¬¦çš„ä½¿ç”¨"></a>5ã€Scala ä¸­åŒ…çš„å¯è§æ€§å’Œè®¿é—®ä¿®é¥°ç¬¦çš„ä½¿ç”¨</h3><blockquote><ul><li><ol><li>å½“å±æ€§è®¿é—®æƒé™ä¸ºé»˜è®¤æ—¶ï¼Œä»åº•å±‚çœ‹å±æ€§æ˜¯ private çš„ï¼Œä½†æ˜¯å› ä¸ºæä¾›äº† xxx_$eq()[ç±»ä¼¼ setter]/xxx()[ç±»ä¼¼getter] æ–¹æ³•ï¼Œå› æ­¤ä»ä½¿ç”¨æ•ˆæœçœ‹æ˜¯ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥è®¿é—®)ã€‚</li></ol></li><li><ol start="2"><li>å½“æ–¹æ³•è®¿é—®æƒé™ä¸ºé»˜è®¤æ—¶ï¼Œé»˜è®¤ä¸º public è®¿é—®æƒé™ã€‚</li></ol></li><li><ol start="3"><li><code>private</code> ä¸ºç§æœ‰æƒé™ï¼Œåªåœ¨ç±»çš„å†…éƒ¨å’Œä¼´ç”Ÿå¯¹è±¡ä¸­å¯ç”¨ã€‚</li></ol></li><li><ol start="4"><li><code>protected</code> ä¸ºå—ä¿æŠ¤æƒé™ï¼Œscala  ä¸­å—ä¿æŠ¤æƒé™æ¯” Java  ä¸­æ›´ä¸¥æ ¼ ï¼Œ <strong>åªèƒ½å­ç±»è®¿é—®ï¼Œé—®åŒåŒ…æ— æ³•è®¿é—®</strong> (ç¼–è¯‘å™¨ä»è¯­æ³•å±‚é¢æ§åˆ¶)ã€‚</li></ol></li><li><ol start="5"><li><strong>åœ¨ scala ä¸­æ²¡æœ‰ public å…³é”®å­—</strong>,å³ä¸èƒ½ç”¨ public æ˜¾å¼çš„ä¿®é¥°å±æ€§å’Œæ–¹æ³•ã€‚</li></ol></li></ul></blockquote><p><strong>scala è®¾è®¡è€…å°†è®¿é—®çš„æ–¹å¼åˆ†æˆä¸‰å¤§ç±»: (1) å¤„å¤„å¯ä»¥è®¿é—® public (2) å­ç±»å’Œä¼´ç”Ÿå¯¹è±¡èƒ½è®¿é—® protected (3) æœ¬ç±»å’Œä¼´ç”Ÿå¯¹è±¡è®¿é—® private</strong></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> </span>&#123;</span><br><span class="line"><span class="comment">//import å¯ä»¥æ”¾åœ¨ä»»ä½•çš„åœ°æ–¹ï¼ŒåŒæ—¶ä»–çš„ä½œç”¨èŒƒå›´å°±æ˜¯&#123;&#125; å—ä¸­</span></span><br><span class="line"><span class="comment">//import å¦‚æœä½¿ç”¨åˆ° 3 æ¬¡åŠä»¥ä¸Šï¼Œåˆ™å¯ä»¥æ”¾åœ¨æ–‡ä»¶å‰é¢,å¦åˆ™å¯ä»¥ä½¿ç”¨å°±è¿‘å¼•å…¥.</span></span><br><span class="line"><span class="keyword">import</span> scala.beans.<span class="type">BeanProperty</span></span><br><span class="line"><span class="meta">@BeanProperty</span> <span class="keyword">var</span> name : <span class="type">String</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Java ä¸­å¦‚æœæƒ³è¦å¯¼å…¥åŒ…ä¸­æ‰€æœ‰çš„ç±»ï¼Œå¯ä»¥é€šè¿‡é€šé…ç¬¦*ï¼ŒScala ä¸­é‡‡ç”¨ä¸‹ _</span></span><br><span class="line"><span class="comment">//å¦‚æœä¸æƒ³è¦æŸä¸ªåŒ…ä¸­å…¨éƒ¨çš„ç±»ï¼Œè€Œæ˜¯å…¶ä¸­çš„å‡ ä¸ªç±»ï¼Œå¯ä»¥é‡‡ç”¨é€‰å–å™¨,ä½¿ç”¨&#123;&#125; æ‹¬èµ·æ¥å³å¯ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¦‚æœæœ‰å¤šä¸ªåŒåçš„ç±»æˆ–è€… trait ç­‰ï¼Œå¯ä»¥ä½¿ç”¨ scala é‡å‘½åçš„æœºåˆ¶æ¥è§£å†³.</span></span><br><span class="line"><span class="keyword">import</span> java.util.&#123; <span class="type">HashMap</span>=&gt;<span class="type">JavaHashMap</span>, <span class="type">List</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¦‚æœæŸä¸ªå†²çªçš„ç±»æ ¹æœ¬å°±ä¸ä¼šç”¨åˆ°ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å¯ä»¥ç›´æ¥éšè—æ‰</span></span><br><span class="line"><span class="keyword">import</span> java.util.&#123; <span class="type">HashMap</span>=&gt;_, _&#125; <span class="comment">// å«ä¹‰ä¸º å¼•å…¥ java.util åŒ…çš„æ‰€æœ‰ç±»ï¼Œä½†æ˜¯å¿½ç•¥ HahsMap ç±»</span></span><br></pre></td></tr></table></figure><h3 id="6ã€ç»§æ‰¿"><a href="#6ã€ç»§æ‰¿" class="headerlink" title="6ã€ç»§æ‰¿"></a>6ã€ç»§æ‰¿</h3><h4 id="é‡å†™æ–¹æ³•"><a href="#é‡å†™æ–¹æ³•" class="headerlink" title="é‡å†™æ–¹æ³•"></a>é‡å†™æ–¹æ³•</h4><p><strong>Scala æ˜ç¡®è§„å®šï¼Œ é‡å†™ä¸€ä¸ªéæŠ½è±¡æ–¹æ³•éœ€è¦ç”¨ override  ä¿®é¥°ç¬¦ï¼Œè°ƒç”¨è¶…ç±»çš„æ–¹æ³•ä½¿ç”¨ super  å…³é”®å­—</strong></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">  <span class="keyword">var</span> student = <span class="keyword">new</span> student</span><br><span class="line">  student.name = <span class="string">&quot;michong&quot;</span></span><br><span class="line">  student.num = <span class="string">&quot;123123&quot;</span></span><br><span class="line"></span><br><span class="line">  student.getInfo()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> name: <span class="type">String</span> = _</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">getInfo</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">&quot;å§“åï¼š&quot;</span> + name)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">student</span> <span class="keyword">extends</span> <span class="title">person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> num: <span class="type">String</span> = _</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">getInfo</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">super</span>.getInfo()</span><br><span class="line">    println(<span class="string">&quot;å­¦å·ï¼š&quot;</span> + num)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Scala-ä¸­ç±»å‹æ£€æŸ¥å’Œè½¬æ¢"><a href="#Scala-ä¸­ç±»å‹æ£€æŸ¥å’Œè½¬æ¢" class="headerlink" title="Scala ä¸­ç±»å‹æ£€æŸ¥å’Œè½¬æ¢"></a>Scala ä¸­ç±»å‹æ£€æŸ¥å’Œè½¬æ¢</h4><p><strong>åŸºæœ¬ä»‹ç»</strong></p><blockquote><p>è¦æµ‹è¯•æŸä¸ªå¯¹è±¡æ˜¯å¦å±äºæŸä¸ªç»™å®šçš„ç±»ï¼Œå¯ä»¥ç”¨ <code>isInstanceOf</code> æ–¹æ³•ã€‚ç”¨ <code>asInstanceOf</code> æ–¹æ³•å°†å¼•ç”¨è½¬æ¢ä¸ºå­ç±»çš„å¼•ç”¨ã€‚<code>classOf</code> è·å–å¯¹è±¡çš„ç±»åã€‚</p></blockquote><ul><li><ol><li>classOf[String]å°±å¦‚åŒ Java çš„ String.class ã€‚</li></ol></li><li><ol start="2"><li>obj.isInstanceOf[T]å°±å¦‚åŒ Java çš„ obj instanceof T åˆ¤æ–­ obj æ˜¯ä¸æ˜¯ T ç±»å‹ã€‚</li></ol></li><li><ol start="3"><li>obj.asInstanceOf[T]å°±å¦‚åŒ Java çš„(T)obj å°† obj å¼ºè½¬æˆ T ç±»å‹</li></ol></li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> student:person = <span class="keyword">new</span> student</span><br><span class="line">student.name = <span class="string">&quot;michong&quot;</span></span><br><span class="line">student.asInstanceOf[student].num = <span class="string">&quot;123123&quot;</span></span><br></pre></td></tr></table></figure><h4 id="var-é‡å†™æŠ½è±¡çš„-var-å±æ€§å°ç»“"><a href="#var-é‡å†™æŠ½è±¡çš„-var-å±æ€§å°ç»“" class="headerlink" title="var é‡å†™æŠ½è±¡çš„ var å±æ€§å°ç»“"></a>var é‡å†™æŠ½è±¡çš„ var å±æ€§å°ç»“</h4><blockquote><ul><li>ä¸€ä¸ªå±æ€§æ²¡æœ‰åˆå§‹åŒ–ï¼Œé‚£ä¹ˆè¿™ä¸ªå±æ€§å°±æ˜¯æŠ½è±¡å±æ€§</li><li>æŠ½è±¡å±æ€§åœ¨ç¼–è¯‘æˆå­—èŠ‚ç æ–‡ä»¶æ—¶ï¼Œå±æ€§å¹¶ä¸ä¼šå£°æ˜ï¼Œä½†æ˜¯ä¼šè‡ªåŠ¨ç”ŸæˆæŠ½è±¡æ–¹æ³•ï¼Œæ‰€ä»¥ç±»å¿…é¡»å£°æ˜ä¸ºæŠ½è±¡ç±»</li><li>å¦‚æœæ˜¯è¦†å†™ä¸€ä¸ªçˆ¶ç±»çš„æŠ½è±¡å±æ€§ï¼Œé‚£ä¹ˆ <code>override</code> å…³é”®å­—å¯çœç•¥ [åŸå› ï¼šçˆ¶ç±»çš„æŠ½è±¡å±æ€§ï¼Œç”Ÿæˆçš„æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œå› æ­¤å°±ä¸æ¶‰åŠåˆ°æ–¹æ³•é‡å†™çš„æ¦‚å¿µï¼Œå› æ­¤ <code>override</code> å¯çœç•¥]</li></ul></blockquote><h4 id="Scala-æŠ½è±¡ç±»"><a href="#Scala-æŠ½è±¡ç±»" class="headerlink" title="Scala æŠ½è±¡ç±»"></a>Scala æŠ½è±¡ç±»</h4><blockquote><ul><li><ol><li>æŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹</li></ol></li><li><ol start="2"><li>æŠ½è±¡ç±»ä¸ä¸€å®šè¦åŒ…å« abstract æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´,æŠ½è±¡ç±»å¯ä»¥æ²¡æœ‰ abstract æ–¹æ³•</li></ol></li><li><ol start="3"><li>ä¸€æ—¦ç±»åŒ…å«äº†æŠ½è±¡æ–¹æ³•æˆ–è€…æŠ½è±¡å±æ€§,åˆ™è¿™ä¸ªç±»å¿…é¡»å£°æ˜ä¸º abstract</li></ol></li><li><ol start="4"><li>æŠ½è±¡æ–¹æ³•ä¸èƒ½æœ‰ä¸»ä½“ï¼Œä¸å…è®¸ä½¿ç”¨ abstract ä¿®é¥°ã€‚</li></ol></li><li><ol start="5"><li>å¦‚æœä¸€ä¸ªç±»ç»§æ‰¿äº†æŠ½è±¡ç±»ï¼Œåˆ™å®ƒå¿…é¡»å®ç°æŠ½è±¡ç±»çš„æ‰€æœ‰æŠ½è±¡æ–¹æ³•å’ŒæŠ½è±¡å±æ€§ï¼Œé™¤éå®ƒè‡ªå·±ä¹Ÿå£°æ˜ä¸º abstractç±»ã€‚ã€æ¡ˆä¾‹æ¼”ç¤º+åç¼–è¯‘ã€‘</li></ol></li><li><ol start="6"><li>æŠ½è±¡æ–¹æ³•å’ŒæŠ½è±¡å±æ€§ä¸èƒ½ä½¿ç”¨ privateã€final æ¥ä¿®é¥°ï¼Œå› ä¸ºè¿™äº›å…³é”®å­—éƒ½æ˜¯å’Œé‡å†™/å®ç°ç›¸è¿èƒŒçš„ã€‚</li></ol></li><li><ol start="7"><li>æŠ½è±¡ç±»ä¸­å¯ä»¥æœ‰å®ç°çš„æ–¹æ³•.</li></ol></li><li><ol start="8"><li>å­ç±»é‡å†™æŠ½è±¡æ–¹æ³•ä¸éœ€è¦ overrideï¼Œå†™ä¸Šä¹Ÿä¸ä¼šé”™.</li></ol></li></ul></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">person</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name:<span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">student</span> <span class="keyword">extends</span> <span class="title">person</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name:<span class="type">String</span>=<span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŒ¿åå­ç±»"><a href="#åŒ¿åå­ç±»" class="headerlink" title="åŒ¿åå­ç±»"></a>åŒ¿åå­ç±»</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">  <span class="comment">//æŠ½è±¡ç±»ï¼Œä»–ä¸èƒ½å®ä¾‹åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åŒ¿åå­ç±»çš„æ–¹å¼åˆ›å»ºä¸€ä¸ªå®ä¾‹</span></span><br><span class="line">  <span class="keyword">val</span> p = <span class="keyword">new</span> person &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> name: <span class="type">String</span> = <span class="string">&quot;123&quot;</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">info</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">      println(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  p.info()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">person</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name:<span class="type">String</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">info</span></span>()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7ã€ä¼´ç”Ÿå¯¹è±¡"><a href="#7ã€ä¼´ç”Ÿå¯¹è±¡" class="headerlink" title="7ã€ä¼´ç”Ÿå¯¹è±¡"></a>7ã€ä¼´ç”Ÿå¯¹è±¡</h3><blockquote><ul><li><ol><li>Scala ä¸­ä¼´ç”Ÿå¯¹è±¡é‡‡ç”¨ <code>object</code> å…³é”®å­—å£°æ˜ï¼Œä¼´ç”Ÿå¯¹è±¡ä¸­å£°æ˜çš„å…¨æ˜¯ â€œ<code>é™æ€</code>â€œå†…å®¹ï¼Œå¯ä»¥é€šè¿‡ä¼´ç”Ÿå¯¹è±¡åç§°ç›´æ¥è°ƒç”¨ã€‚</li></ol></li><li><ol start="2"><li>ä¼´ç”Ÿå¯¹è±¡å¯¹åº”çš„ç±»ç§°ä¹‹ä¸ºä¼´ç”Ÿç±»ï¼Œä¼´ç”Ÿå¯¹è±¡çš„åç§°åº”è¯¥å’Œä¼´ç”Ÿç±»åä¸€è‡´ã€‚</li></ol></li><li><ol start="3"><li>ä¼´ç”Ÿå¯¹è±¡ä¸­çš„å±æ€§å’Œæ–¹æ³•éƒ½å¯ä»¥é€šè¿‡ä¼´ç”Ÿå¯¹è±¡åç›´æ¥è°ƒç”¨è®¿é—®</li></ol></li><li><ol start="4"><li>ä»è¯­æ³•è§’åº¦æ¥è®²ï¼Œæ‰€è°“çš„ä¼´ç”Ÿå¯¹è±¡å…¶å®å°±æ˜¯ç±»çš„é™æ€æ–¹æ³•å’Œé™æ€å˜é‡çš„é›†åˆ</li></ol></li><li><ol start="5"><li>ä»æŠ€æœ¯è§’åº¦æ¥è®²ï¼Œscala è¿˜æ˜¯æ²¡æœ‰ç”Ÿæˆé™æ€çš„å†…å®¹ï¼Œåªä¸è¿‡æ˜¯å°†ä¼´ç”Ÿå¯¹è±¡ç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„ç±»ï¼Œå®ç°å±æ€§å’Œæ–¹æ³•çš„è°ƒç”¨ã€‚[åç¼–è¯‘çœ‹æºç ]</li></ol></li><li><ol start="6"><li>ä»åº•å±‚åŸç†çœ‹ï¼Œä¼´ç”Ÿå¯¹è±¡å®ç°é™æ€ç‰¹æ€§æ˜¯ä¾èµ–äº <code>public static final MODULE$</code> å®ç°çš„ã€‚</li></ol></li><li><ol start="7"><li> ä¼´ç”Ÿå¯¹è±¡çš„å£°æ˜åº”è¯¥å’Œä¼´ç”Ÿç±»çš„å£°æ˜åœ¨åŒä¸€ä¸ªæºç æ–‡ä»¶ä¸­(å¦‚æœä¸åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ä¼šè¿è¡Œé”™è¯¯!)ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰ä¼´ç”Ÿç±»ï¼Œä¹Ÿå°±æ²¡æœ‰æ‰€è°“çš„ä¼´ç”Ÿå¯¹è±¡äº†ï¼Œæ‰€ä»¥æ”¾åœ¨å“ªé‡Œå°±æ— æ‰€è°“äº†ã€‚</li></ol></li><li><ol start="8"><li>å¦‚æœ class A ç‹¬ç«‹å­˜åœ¨ï¼Œé‚£ä¹ˆ A å°±æ˜¯ä¸€ä¸ªç±»ï¼Œ å¦‚æœ object A ç‹¬ç«‹å­˜åœ¨ï¼Œé‚£ä¹ˆ A å°±æ˜¯ä¸€ä¸ªâ€é™æ€â€æ€§è´¨çš„å¯¹è±¡[å³ç±»å¯¹è±¡], åœ¨ object A ä¸­å£°æ˜çš„å±æ€§å’Œæ–¹æ³•å¯ä»¥é€šè¿‡ A.å±æ€§ å’Œ A.æ–¹æ³• æ¥å®ç°è°ƒç”¨</li></ol></li></ul></blockquote><p><strong>æ¡ˆä¾‹</strong></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.buildworld.scala.day2</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">demo1</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> p1 = <span class="keyword">new</span> <span class="type">Person</span>(<span class="string">&quot;michong&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> p2 = <span class="keyword">new</span> <span class="type">Person</span>(<span class="string">&quot;qjzxzxd&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> p3 = <span class="keyword">new</span> <span class="type">Person</span>(<span class="string">&quot;ç±³è™«&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="type">Person</span>.joinGroup(p1)</span><br><span class="line">    <span class="type">Person</span>.joinGroup(p2)</span><br><span class="line">    <span class="type">Person</span>.joinGroup(p3)</span><br><span class="line"></span><br><span class="line">    <span class="type">Person</span>.showInfo()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params">pname: <span class="type">String</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span> = pname</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">object</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> num: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">joinGroup</span></span>(person: <span class="type">Person</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">      num += <span class="number">1</span></span><br><span class="line">      println(person.name + <span class="string">&quot;--åŠ å…¥ç»„ç»‡&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">showInfo</span></span>(): <span class="type">Unit</span> =&#123;</span><br><span class="line">       println(<span class="string">&quot;å½“å‰&quot;</span>+num+<span class="string">&quot;äºº&quot;</span>)</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">say</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">      println(<span class="string">&quot;Say Hi&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8ã€ç‰¹è´¨-trait"><a href="#8ã€ç‰¹è´¨-trait" class="headerlink" title="8ã€ç‰¹è´¨(trait)"></a>8ã€ç‰¹è´¨(trait)</h3><h4 id="traitçš„å£°æ˜"><a href="#traitçš„å£°æ˜" class="headerlink" title="traitçš„å£°æ˜"></a><strong>traitçš„å£°æ˜</strong></h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">å</span> <span class="title">ç‰¹è´¨å</span> </span>&#123;</span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">ä½“</span> <span class="title">ä½“</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>) <span class="class"><span class="keyword">trait</span> <span class="title">å‘½å</span> <span class="title">ä¸€èˆ¬é¦–å­—æ¯å¤§å†™</span>.</span></span><br><span class="line"><span class="number">2</span>) åœ¨ scala ä¸­ï¼Œjava ä¸­çš„æ¥å£å¯ä»¥å½“åšç‰¹è´¨ä½¿ç”¨</span><br></pre></td></tr></table></figure><p><strong>traitä½¿ç”¨</strong></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#æ²¡æœ‰çˆ¶ç±»</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ç±»å</span> <span class="keyword">extends</span> <span class="title">è´¨</span> <span class="title">ç‰¹è´¨</span> 1 <span class="keyword">with</span> <span class="title">è´¨</span> <span class="title">ç‰¹è´¨</span> 2 <span class="keyword">with</span> <span class="title">è´¨</span> <span class="title">ç‰¹è´¨</span> 3 ..</span></span><br><span class="line">#æœ‰çˆ¶ç±»</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ç±»å</span> <span class="keyword">extends</span> <span class="title">çˆ¶ç±»</span> <span class="keyword">with</span> <span class="title">è´¨</span> <span class="title">ç‰¹è´¨</span> 1 <span class="keyword">with</span> <span class="title">è´¨</span> <span class="title">ç‰¹è´¨</span> 2 <span class="keyword">with</span>  </span></span><br></pre></td></tr></table></figure><h4 id="å¸¦æœ‰ç‰¹è´¨çš„å¯¹è±¡ï¼ŒåŠ¨æ€æ··å…¥"><a href="#å¸¦æœ‰ç‰¹è´¨çš„å¯¹è±¡ï¼ŒåŠ¨æ€æ··å…¥" class="headerlink" title="å¸¦æœ‰ç‰¹è´¨çš„å¯¹è±¡ï¼ŒåŠ¨æ€æ··å…¥"></a><strong>å¸¦æœ‰ç‰¹è´¨çš„å¯¹è±¡ï¼ŒåŠ¨æ€æ··å…¥</strong></h4><blockquote><ul><li><ol><li>é™¤äº†å¯ä»¥åœ¨ç±»å£°æ˜æ—¶ç»§æ‰¿ç‰¹è´¨ä»¥å¤–ï¼Œè¿˜å¯ä»¥åœ¨æ„å»ºå¯¹è±¡æ—¶æ··å…¥ç‰¹è´¨ï¼Œæ‰©å±•ç›®æ ‡ç±»çš„åŠŸèƒ½ã€åç¼–è¯‘çœ‹åŠ¨æ€æ··å…¥æœ¬è´¨ã€‘</li></ol></li><li><ol start="2"><li>æ­¤ç§æ–¹å¼ä¹Ÿå¯ä»¥åº”ç”¨äºå¯¹æŠ½è±¡ç±»åŠŸèƒ½è¿›è¡Œæ‰©å±•</li></ol></li><li><ol start="3"><li>åŠ¨æ€æ··å…¥æ˜¯ Scala ç‰¹æœ‰çš„æ–¹å¼ï¼ˆjava æ²¡æœ‰åŠ¨æ€æ··å…¥ï¼‰ï¼Œå¯åœ¨ä¸ä¿®æ”¹ç±»å£°æ˜/å®šä¹‰çš„æƒ…å†µä¸‹ï¼Œæ‰©å±•ç±»çš„åŠŸèƒ½ï¼Œéå¸¸çš„çµæ´»ï¼Œè€¦åˆæ€§ä½ ã€‚</li></ol></li><li><ol start="4"><li>åŠ¨æ€æ··å…¥å¯ä»¥åœ¨ä¸å½±å“åŸæœ‰çš„ç»§æ‰¿å…³ç³»çš„åŸºç¡€ä¸Šï¼Œç»™æŒ‡å®šçš„ç±»æ‰©å±•åŠŸèƒ½ã€‚[å¦‚ä½•ç†è§£]</li></ol></li><li><ol start="5"><li>æŠ½è±¡ç±»ä¸­æœ‰ æŠ½è±¡çš„æ–¹æ³•ï¼Œå¦‚ä½•åŠ¨æ€æ··å…¥ç‰¹è´¨-&gt;å¯ä»¥ï¼Œåœ¨åˆ›å»ºå®ä¾‹æ—¶ï¼Œå®ç°æŠ½è±¡æ–¹æ³•å³å¯</li></ol></li></ul></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.buildworld.scala.day2</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">demo2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> c = <span class="keyword">new</span> <span class="type">C</span></span><br><span class="line">    c.getConnect(<span class="string">&quot;root&quot;</span>,<span class="string">&quot;123456&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¸¦æœ‰ç‰¹è´¨çš„å¯¹è±¡ï¼ŒåŠ¨æ€æ··å…¥</span></span><br><span class="line">    <span class="keyword">val</span> b = <span class="keyword">new</span> <span class="type">B</span> <span class="keyword">with</span> <span class="type">Trait1</span>&#123;</span><br><span class="line">      <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">getConnect</span></span>(user: <span class="type">String</span>, pwd: <span class="type">String</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">        println(<span class="string">&quot;ç”¨æˆ·ç™»å½•ä¿¡æ¯ï¼šuser: &quot;</span>+user+<span class="string">&quot; pwd: &quot;</span>+pwd)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    b.getConnect(<span class="string">&quot;root&quot;</span>,<span class="string">&quot;123456&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">trait</span> <span class="title">Trait1</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getConnect</span></span>(user:<span class="type">String</span>,pwd:<span class="type">String</span>): <span class="type">Unit</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">C</span> <span class="keyword">extends</span> <span class="title">A</span> <span class="keyword">with</span> <span class="title">Trait1</span></span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">getConnect</span></span>(user: <span class="type">String</span>, pwd: <span class="type">String</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">      println(<span class="string">&quot;ç”¨æˆ·ç™»å½•ä¿¡æ¯ï¼šuser: &quot;</span>+user+<span class="string">&quot; pwd: &quot;</span>+pwd)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">D</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">E</span> <span class="keyword">extends</span> <span class="title">D</span> <span class="keyword">with</span> <span class="title">Trait1</span></span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">getConnect</span></span>(user: <span class="type">String</span>, pwd: <span class="type">String</span>): <span class="type">Unit</span> = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç‰¹è´¨æ„é€ é¡ºåº"><a href="#ç‰¹è´¨æ„é€ é¡ºåº" class="headerlink" title="ç‰¹è´¨æ„é€ é¡ºåº"></a><strong>ç‰¹è´¨æ„é€ é¡ºåº</strong></h4><blockquote><p>ç‰¹è´¨ä¹Ÿæ˜¯æœ‰æ„é€ å™¨çš„ï¼Œæ„é€ å™¨ä¸­çš„å†…å®¹ç”±â€œå­—æ®µçš„åˆå§‹åŒ–â€å’Œä¸€äº›å…¶ä»–è¯­å¥æ„æˆã€‚å…·ä½“å®ç°è¯·å‚è€ƒâ€œç‰¹è´¨å åŠ â€</p></blockquote><ul><li><strong>ç¬¬ä¸€ç§ç‰¹è´¨æ„é€ é¡ºåº(å£°æ˜ç±»çš„åŒæ—¶æ··å…¥ç‰¹è´¨)</strong></li></ul><blockquote><ol><li>è°ƒç”¨å½“å‰ç±»çš„è¶…ç±»æ„é€ å™¨</li><li>ç¬¬ä¸€ä¸ªç‰¹è´¨çš„çˆ¶ç‰¹è´¨æ„é€ å™¨</li><li>ç¬¬ä¸€ä¸ªç‰¹è´¨æ„é€ å™¨</li><li>ç¬¬äºŒä¸ªç‰¹è´¨æ„é€ å™¨çš„çˆ¶ç‰¹è´¨æ„é€ å™¨, å¦‚æœå·²ç»æ‰§è¡Œè¿‡ï¼Œå°±ä¸å†æ‰§è¡Œ</li><li>ç¬¬äºŒä¸ªç‰¹è´¨æ„é€ å™¨</li><li>â€¦â€¦.é‡å¤ 4,5 çš„æ­¥éª¤(å¦‚æœæœ‰ç¬¬ 3 ä¸ªï¼Œç¬¬ 4 ä¸ªç‰¹è´¨)</li></ol></blockquote><ul><li><strong>ç¬¬ 2 ç§ç‰¹è´¨æ„é€ é¡ºåº(åœ¨æ„å»ºå¯¹è±¡æ—¶ï¼ŒåŠ¨æ€æ··å…¥ç‰¹è´¨)</strong></li></ul><blockquote><ol><li>è°ƒç”¨å½“å‰ç±»çš„è¶…ç±»æ„é€ </li><li>å½“å‰ç±»æ„é€ </li><li>ç¬¬ä¸€ä¸ªç‰¹è´¨æ„é€ å™¨çš„çˆ¶ç‰¹è´¨æ„é€ å™¨</li><li>ç¬¬ä¸€ä¸ªç‰¹è´¨æ„é€ å™¨.</li><li>ç¬¬äºŒä¸ªç‰¹è´¨æ„é€ å™¨çš„çˆ¶ç‰¹è´¨æ„é€ å™¨, å¦‚æœå·²ç»æ‰§è¡Œè¿‡ï¼Œå°±ä¸å†æ‰§è¡Œ</li><li>ç¬¬äºŒä¸ªç‰¹è´¨æ„é€ å™¨</li><li>â€¦â€¦é‡å¤ 5,6 çš„æ­¥éª¤(å¦‚æœæœ‰ç¬¬ 3 ä¸ªï¼Œç¬¬ 4 ä¸ªç‰¹è´¨)</li></ol></blockquote><h4 id="è‡ªèº«ç±»å‹"><a href="#è‡ªèº«ç±»å‹" class="headerlink" title="è‡ªèº«ç±»å‹"></a>è‡ªèº«ç±»å‹</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#åœ¨<span class="type">Logger</span>ä¸­å·²ç»å¯ä»¥ä½¿ç”¨<span class="type">Exception</span>ä¸­çš„ç›¸å…³çš„æ–¹æ³•äº†</span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Logger</span></span>&#123;</span><br><span class="line">  <span class="keyword">this</span>:<span class="type">Exception</span>=&gt;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">log</span></span>()=&#123;</span><br><span class="line">    println(getMessage)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#ä½¿ç”¨<span class="type">MyLogger</span>æ—¶å…ˆç»§æ‰¿<span class="type">Exception</span>ç±»</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyLogger</span> <span class="keyword">extends</span> <span class="title">Exception</span> <span class="keyword">with</span> <span class="title">Logger</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><h4 id="åµŒå¥—"><a href="#åµŒå¥—" class="headerlink" title="åµŒå¥—"></a>åµŒå¥—</h4><blockquote><ul><li>æ–¹å¼ 1<br>å†…éƒ¨ç±»å¦‚æœæƒ³è¦è®¿é—®å¤–éƒ¨ç±»çš„å±æ€§ï¼Œå¯ä»¥é€šè¿‡å¤–éƒ¨ç±»å¯¹è±¡è®¿é—®ã€‚å³ï¼šè®¿é—®æ–¹å¼ï¼š<strong>å¤–éƒ¨ç±»å.this.å±æ€§å</strong></li><li>æ–¹å¼ 2<br>å†…éƒ¨ç±»å¦‚æœæƒ³è¦è®¿é—®å¤–éƒ¨ç±»çš„å±æ€§ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¤–éƒ¨ç±»åˆ«åè®¿é—®(æ¨è)ã€‚å³ï¼š<strong>è®¿é—®æ–¹å¼ï¼šå¤–éƒ¨ç±»ååˆ«å.å±æ€§å</strong> ã€å¤–éƒ¨ç±»å.this ç­‰ä»· å¤–éƒ¨ç±»ååˆ«åã€‘</li></ul></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AAA</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  myOuter=&gt;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">InnerAAA</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä½¿ç”¨åˆ«åçš„æ–¹å¼æ¥è®¿é—®å¤–éƒ¨ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œç›¸å½“äº myouter æ˜¯ä¸€ä¸ªå¤–éƒ¨ç±»çš„å®ä¾‹ AAA.this</span></span><br><span class="line">    <span class="comment">//è¿™æ—¶éœ€è¦å°†å¤–éƒ¨ç±»çš„å±æ€§å’Œæ–¹æ³•çš„å®šä¹‰/å£°æ˜æ”¾åœ¨åˆ«åå</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span></span>(innerAAA: <span class="type">InnerAAA</span>): <span class="type">Unit</span> =&#123;</span><br><span class="line">      println(innerAAA)</span><br><span class="line"></span><br><span class="line">      println(myOuter.name)</span><br><span class="line">      println(myOuter.sal)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> name:<span class="type">String</span>=_</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> sal:<span class="type">Double</span>=_</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9ã€éšå¼è½¬æ¢"><a href="#9ã€éšå¼è½¬æ¢" class="headerlink" title="9ã€éšå¼è½¬æ¢"></a>9ã€éšå¼è½¬æ¢</h3><h4 id="éšå¼å€¼"><a href="#éšå¼å€¼" class="headerlink" title="éšå¼å€¼"></a>éšå¼å€¼</h4><blockquote><p>éšå¼å€¼ä¹Ÿå«éšå¼å˜é‡ï¼Œå°†æŸä¸ªå½¢å‚å˜é‡æ ‡è®°ä¸º implicitï¼Œæ‰€ä»¥ç¼–è¯‘å™¨ä¼šåœ¨æ–¹æ³•çœç•¥éšå¼å‚æ•°çš„æƒ…å†µä¸‹å»æœç´¢ä½œç”¨åŸŸå†…çš„éšå¼å€¼ä½œä¸ºç¼ºçœå‚æ•°</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.buildworld.scala.day2</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">demo5</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//éšå¼å€¼</span></span><br><span class="line">    <span class="keyword">implicit</span> <span class="keyword">val</span> str1:<span class="type">String</span> = <span class="string">&quot;michong&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hello</span></span>(<span class="keyword">implicit</span> name:<span class="type">String</span>): <span class="type">Unit</span> =&#123;</span><br><span class="line">      println(name)</span><br><span class="line">    &#125;</span><br><span class="line">    hello</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="éšå¼ç±»"><a href="#éšå¼ç±»" class="headerlink" title="éšå¼ç±»"></a>éšå¼ç±»</h4><blockquote><ul><li><ol><li>å…¶æ‰€å¸¦çš„ æ„é€ å‚æ•°æœ‰ä¸”åªèƒ½æœ‰ä¸€ä¸ª</li></ol></li><li><ol start="2"><li>éšå¼ç±»å¿…é¡»è¢«å®šä¹‰åœ¨â€œç±»â€æˆ–â€œä¼´ç”Ÿå¯¹è±¡â€æˆ–â€œåŒ…å¯¹è±¡â€é‡Œï¼Œå³éšå¼ç±»ä¸èƒ½æ˜¯é¡¶çº§çš„(top-level objects)</li></ol></li><li><ol start="3"><li>éšå¼ç±»ä¸èƒ½æ˜¯ case classï¼ˆcase class åœ¨åç»­ä»‹ç»æ ·ä¾‹ç±»ï¼‰</li></ol></li><li><ol start="4"><li>ä½œç”¨åŸŸå†…ä¸èƒ½æœ‰ä¸ä¹‹ç›¸åŒåç§°çš„æ ‡è¯†ç¬¦</li></ol></li></ul></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.buildworld.scala.day2</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">demo5</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> db = <span class="keyword">new</span> <span class="type">MySql</span></span><br><span class="line">    db.add()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">  <span class="comment">//éšå¼ç±»</span></span><br><span class="line">  <span class="keyword">implicit</span> <span class="class"><span class="keyword">class</span> <span class="title">DB</span>(<span class="params">val m :<span class="type">MySql</span></span>)</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span></span>(): <span class="type">Unit</span> =&#123;</span><br><span class="line">      println(<span class="string">&quot;æ·»åŠ &quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">MySql</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="éšå¼å‡½æ•°"><a href="#éšå¼å‡½æ•°" class="headerlink" title="éšå¼å‡½æ•°"></a>éšå¼å‡½æ•°</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.buildworld.scala.day2</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">demo4</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//éšå¼å‡½æ•°</span></span><br><span class="line">    <span class="keyword">implicit</span> <span class="function"><span class="keyword">def</span> <span class="title">addDelete</span></span>(mySql: <span class="type">MySql</span>):<span class="type">DB</span>=&#123;</span><br><span class="line">       <span class="keyword">new</span> <span class="type">DB</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">var</span> db = <span class="keyword">new</span> <span class="type">MySql</span></span><br><span class="line">    db.delete()</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">MySql</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">DB</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span></span>(): <span class="type">Unit</span> =&#123;</span><br><span class="line">      println(<span class="string">&quot;åˆ é™¤æ•°æ®ï¼ï¼ï¼&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="éšå¼è§£ææœºåˆ¶"><a href="#éšå¼è§£ææœºåˆ¶" class="headerlink" title="éšå¼è§£ææœºåˆ¶"></a>éšå¼è§£ææœºåˆ¶</h4><blockquote><ul><li><ol><li>é¦–å…ˆä¼šåœ¨ å½“å‰ä»£ç ä½œç”¨åŸŸä¸‹æŸ¥æ‰¾éšå¼å®ä½“ï¼ˆéšå¼æ–¹æ³•ã€éšå¼ç±»ã€éšå¼å¯¹è±¡ï¼‰ã€‚(ä¸€èˆ¬æ˜¯è¿™ç§æƒ…å†µ)</li></ol></li><li><ol start="2"><li>å¦‚æœç¬¬ä¸€æ¡è§„åˆ™æŸ¥æ‰¾éšå¼å®ä½“å¤±è´¥ï¼Œä¼šç»§ç»­åœ¨éšå¼å‚æ•°çš„ç±»å‹çš„ä½œç”¨åŸŸé‡ŒæŸ¥æ‰¾ã€‚ç±»å‹çš„ä½œç”¨åŸŸæ˜¯æŒ‡ä¸è¯¥ç±»å‹ç›¸å…³è”çš„å…¨éƒ¨ä¼´ç”Ÿæ¨¡å—ï¼Œä¸€ä¸ªéšå¼å®ä½“çš„ç±»å‹ T å®ƒçš„æŸ¥æ‰¾èŒƒå›´å¦‚ä¸‹( ç¬¬äºŒç§æƒ…å†µèŒƒå›´å¹¿ä¸”å¤æ‚åœ¨ä½¿ç”¨æ—¶ï¼Œåº”å½“å°½é‡é¿å…å‡ºç°)ï¼š</li></ol></li><li><p>a) å¦‚æœ T è¢«å®šä¹‰ä¸º T with A with B with C,é‚£ä¹ˆ A,B,C éƒ½æ˜¯ T çš„éƒ¨åˆ†ï¼Œåœ¨ T çš„éšå¼è§£æè¿‡ç¨‹ä¸­ï¼Œå®ƒä»¬çš„ä¼´ç”Ÿå¯¹è±¡éƒ½ä¼šè¢«æœç´¢ã€‚</p></li><li><p>b) å¦‚æœ T æ˜¯å‚æ•°åŒ–ç±»å‹ï¼Œé‚£ä¹ˆç±»å‹å‚æ•°å’Œä¸ç±»å‹å‚æ•°ç›¸å…³è”çš„éƒ¨åˆ†éƒ½ç®—ä½œ T çš„éƒ¨åˆ†ï¼Œæ¯”å¦‚ List[String]çš„éšå¼æœç´¢ä¼šæœç´¢ List çš„ä¼´ç”Ÿå¯¹è±¡å’Œ String çš„ä¼´ç”Ÿå¯¹è±¡ã€‚</p></li><li><p>c) å¦‚æœ T æ˜¯ä¸€ä¸ªå•ä¾‹ç±»å‹ p.Tï¼Œå³ T æ˜¯å±äºæŸä¸ª p å¯¹è±¡å†…ï¼Œé‚£ä¹ˆè¿™ä¸ª p å¯¹è±¡ä¹Ÿä¼šè¢«æœç´¢ã€‚</p></li><li><p>d) å¦‚æœ T æ˜¯ä¸ªç±»å‹æ³¨å…¥ S#Tï¼Œé‚£ä¹ˆ S å’Œ T éƒ½ä¼šè¢«æœç´¢ã€‚</p></li></ul></blockquote>]]></content>
    
    
    <summary type="html">Scala combines object-oriented and functional programming in one concise, high-level language. Scala&#39;s static types help avoid bugs in complex applications, and its JVM and JavaScript runtimes let you build high-performance systems with easy access to huge ecosystems of libraries.</summary>
    
    
    
    <category term="ç¼–ç¨‹è¯­è¨€" scheme="https://www.buildworld.cn/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/"/>
    
    
    <category term="Scala" scheme="https://www.buildworld.cn/tags/Scala/"/>
    
  </entry>
  
  <entry>
    <title>BigData-Apache HBaseæ•°æ®åº“</title>
    <link href="https://www.buildworld.cn/2020/07/09/BigData-Apache-HBase%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    <id>https://www.buildworld.cn/2020/07/09/BigData-Apache-HBase%E6%95%B0%E6%8D%AE%E5%BA%93/</id>
    <published>2020-07-09T08:13:00.000Z</published>
    <updated>2020-07-10T08:03:23.879Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="HBase"><a href="#HBase" class="headerlink" title="HBase"></a>HBase</h2><h2 id="HBase-1"><a href="#HBase-1" class="headerlink" title="HBase"></a>HBase</h2><blockquote><p>Apache](<a href="https://www.apache.org/">https://www.apache.org/</a>) HBaseâ„¢ is the <a href="https://hadoop.apache.org/">Hadoop</a> database, a distributed, scalable, big data store.</p></blockquote><h2 id="ä¸€ã€HBaseåŸç†"><a href="#ä¸€ã€HBaseåŸç†" class="headerlink" title="ä¸€ã€HBaseåŸç†"></a>ä¸€ã€HBaseåŸç†</h2><h3 id="1ã€æ•°æ®æ¨¡å‹"><a href="#1ã€æ•°æ®æ¨¡å‹" class="headerlink" title="1ã€æ•°æ®æ¨¡å‹"></a>1ã€æ•°æ®æ¨¡å‹</h3><h4 id="1-ï¼‰-Name-Space"><a href="#1-ï¼‰-Name-Space" class="headerlink" title="1 ï¼‰ Name Space"></a>1 ï¼‰ Name Space</h4><blockquote><p>å‘½åç©ºé—´ï¼Œç±»ä¼¼äºå…³ç³»å‹æ•°æ®åº“çš„ DatabBase æ¦‚å¿µï¼Œæ¯ä¸ªå‘½åç©ºé—´ä¸‹æœ‰å¤šä¸ªè¡¨ã€‚HBaseæœ‰ä¸¤ä¸ªè‡ªå¸¦çš„å‘½åç©ºé—´ï¼Œåˆ†åˆ«æ˜¯ <code>hbase</code> å’Œ <code>default</code>ï¼Œhbase ä¸­å­˜æ”¾çš„æ˜¯ HBase å†…ç½®çš„è¡¨ï¼Œdefault è¡¨æ˜¯ç”¨æˆ·é»˜è®¤ä½¿ç”¨çš„å‘½åç©ºé—´ã€‚</p></blockquote><h4 id="2-ï¼‰-Region"><a href="#2-ï¼‰-Region" class="headerlink" title="2 ï¼‰ Region"></a>2 ï¼‰ Region</h4><blockquote><p>ç±»ä¼¼äºå…³ç³»å‹æ•°æ®åº“çš„è¡¨æ¦‚å¿µã€‚ä¸åŒçš„æ˜¯ï¼ŒHBase å®šä¹‰è¡¨æ—¶åªéœ€è¦å£°æ˜åˆ—æ—å³å¯ï¼Œä¸éœ€è¦å£°æ˜å…·ä½“çš„åˆ—ã€‚è¿™æ„å‘³ç€ï¼Œå¾€ HBase å†™å…¥æ•°æ®æ—¶ï¼Œå­—æ®µå¯ä»¥åŠ¨æ€ã€æŒ‰éœ€æŒ‡å®šã€‚å› æ­¤ï¼Œå’Œå…³ç³»å‹æ•°æ®åº“ç›¸æ¯”ï¼ŒHBase èƒ½å¤Ÿè½»æ¾åº”å¯¹å­—æ®µå˜æ›´çš„åœºæ™¯ã€‚</p></blockquote><h4 id="3-ï¼‰-Row"><a href="#3-ï¼‰-Row" class="headerlink" title="3 ï¼‰ Row"></a>3 ï¼‰ Row</h4><blockquote><p>HBase è¡¨ä¸­çš„æ¯è¡Œæ•°æ®éƒ½ç”±ä¸€ä¸ª <code>RowKey</code> å’Œå¤šä¸ª  <code>Column</code>ï¼ˆåˆ—ï¼‰ç»„æˆï¼Œæ•°æ®æ˜¯æŒ‰ç…§ <code>RowKey</code>çš„å­—å…¸é¡ºåºå­˜å‚¨çš„ï¼Œå¹¶ä¸”æŸ¥è¯¢æ•°æ®æ—¶åªèƒ½æ ¹æ® <code>RowKey</code> è¿›è¡Œæ£€ç´¢ï¼Œæ‰€ä»¥ <code>RowKey</code> çš„è®¾è®¡ååˆ†é‡è¦ã€‚</p></blockquote><h4 id="4-ï¼‰-Column"><a href="#4-ï¼‰-Column" class="headerlink" title="4 ï¼‰ Column"></a>4 ï¼‰ Column</h4><blockquote><p>HBase ä¸­çš„æ¯ä¸ªåˆ—éƒ½ç”± Column Family(åˆ—æ—)å’Œ Column Qualifierï¼ˆåˆ—é™å®šç¬¦ï¼‰è¿›è¡Œé™å®šï¼Œä¾‹å¦‚ <code>infoï¼šnameï¼Œinfoï¼šage</code>ã€‚å»ºè¡¨æ—¶ï¼Œåªéœ€æŒ‡æ˜åˆ—æ—ï¼Œè€Œåˆ—é™å®šç¬¦æ— éœ€é¢„å…ˆå®šä¹‰ã€‚</p></blockquote><h3 id="2ã€HBaseåŸºç¡€æ¶æ„"><a href="#2ã€HBaseåŸºç¡€æ¶æ„" class="headerlink" title="2ã€HBaseåŸºç¡€æ¶æ„"></a>2ã€HBaseåŸºç¡€æ¶æ„</h3><p><img src="https://file.buildworld.cn/img/20200705133837.png"></p><h4 id="1-ï¼‰-Region-Server"><a href="#1-ï¼‰-Region-Server" class="headerlink" title="1 ï¼‰ Region Server"></a>1 ï¼‰ Region Server</h4><blockquote><p><code>Region Server</code> ä¸º Region çš„ç®¡ç†è€…ï¼Œå…¶å®ç°ç±»ä¸º <code>HRegionServer</code>ï¼Œä¸»è¦ä½œç”¨å¦‚ä¸‹:<br>å¯¹äºæ•°æ®çš„æ“ä½œï¼š<code>get, put, delete</code>ï¼›<br>å¯¹äº Region çš„æ“ä½œï¼š<code>splitRegionã€compactRegion</code>ã€‚</p></blockquote><h3 id="2-ï¼‰-Master"><a href="#2-ï¼‰-Master" class="headerlink" title="2 ï¼‰ Master"></a>2 ï¼‰ Master</h3><blockquote><p><code>Master</code> æ˜¯æ‰€æœ‰ <code>Region Server</code> çš„ç®¡ç†è€…ï¼Œå…¶å®ç°ç±»ä¸º <code>HMaster</code>ï¼Œä¸»è¦ä½œç”¨å¦‚ä¸‹ï¼š<br>å¯¹äºè¡¨çš„æ“ä½œï¼š<code>create, delete, alter</code><br>å¯¹äº<code>RegionServer</code>çš„æ“ä½œï¼šåˆ†é…<code>regions</code>åˆ°æ¯ä¸ª<code>RegionServer</code>ï¼Œç›‘æ§æ¯ä¸ª<code>RegionServer</code>çš„çŠ¶æ€ï¼Œè´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»ã€‚</p></blockquote><h4 id="3-ï¼‰-Zookeeper"><a href="#3-ï¼‰-Zookeeper" class="headerlink" title="3 ï¼‰ Zookeeper"></a>3 ï¼‰ Zookeeper</h4><blockquote><p><code>HBase</code> é€šè¿‡ <code>Zookeeper</code> æ¥åš Master çš„é«˜å¯ç”¨ã€<code>RegionServer</code> çš„ç›‘æ§ã€å…ƒæ•°æ®çš„å…¥å£ä»¥åŠé›†ç¾¤é…ç½®çš„ç»´æŠ¤ç­‰å·¥ä½œã€‚</p></blockquote><h4 id="4-ï¼‰-HDFS"><a href="#4-ï¼‰-HDFS" class="headerlink" title="4 ï¼‰ HDFS"></a>4 ï¼‰ HDFS</h4><blockquote><p><code>HDFS</code> ä¸º <code>HBase</code> æä¾›æœ€ç»ˆçš„åº•å±‚æ•°æ®å­˜å‚¨æœåŠ¡ï¼ŒåŒæ—¶ä¸º <code>HBase</code> æä¾›é«˜å¯ç”¨çš„æ”¯æŒã€‚</p></blockquote><h3 id="3ã€HBaseæ¶æ„è¯¦è§£"><a href="#3ã€HBaseæ¶æ„è¯¦è§£" class="headerlink" title="3ã€HBaseæ¶æ„è¯¦è§£"></a>3ã€HBaseæ¶æ„è¯¦è§£</h3><p><img src="https://file.buildworld.cn/img/20200706133638.png"></p><h4 id="1ï¼‰StoreFile"><a href="#1ï¼‰StoreFile" class="headerlink" title="1ï¼‰StoreFile"></a>1ï¼‰StoreFile</h4><blockquote><p>ä¿å­˜å®é™…æ•°æ®çš„ç‰©ç†æ–‡ä»¶ï¼Œ<code>StoreFile</code> ä»¥ <code>HFile</code> çš„å½¢å¼å­˜å‚¨åœ¨ HDFS ä¸Šã€‚æ¯ä¸ª <code>Store</code> ä¼šæœ‰ä¸€ä¸ªæˆ–å¤šä¸ª <code>StoreFileï¼ˆHFile</code>ï¼‰ï¼Œæ•°æ®åœ¨æ¯ä¸ª <code>StoreFile</code> ä¸­éƒ½æ˜¯æœ‰åºçš„ã€‚</p></blockquote><h4 id="2ï¼‰MemStore"><a href="#2ï¼‰MemStore" class="headerlink" title="2ï¼‰MemStore"></a>2ï¼‰MemStore</h4><blockquote><p>å†™ç¼“å­˜ï¼Œç”±äº <code>HFile</code> ä¸­çš„æ•°æ®è¦æ±‚æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥æ•°æ®æ˜¯å…ˆå­˜å‚¨åœ¨ <code>MemStore</code> ä¸­ï¼Œæ’å¥½åºåï¼Œç­‰åˆ°è¾¾åˆ·å†™æ—¶æœºæ‰ä¼šåˆ·å†™åˆ° <code>HFile</code>ï¼Œæ¯æ¬¡åˆ·å†™éƒ½ä¼šå½¢æˆä¸€ä¸ªæ–°çš„ <code>HFile</code>ã€‚ </p></blockquote><h4 id="3ï¼‰WALï¼ˆWrite-Ahead-logfileï¼‰"><a href="#3ï¼‰WALï¼ˆWrite-Ahead-logfileï¼‰" class="headerlink" title="3ï¼‰WALï¼ˆWrite-Ahead logfileï¼‰"></a>3ï¼‰WALï¼ˆWrite-Ahead logfileï¼‰</h4><blockquote><p>ç”±äºæ•°æ®è¦ç» <code>MemStore</code> æ’åºåæ‰èƒ½åˆ·å†™åˆ° <code>HFile</code>ï¼Œä½†æŠŠæ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ä¼šæœ‰å¾ˆé«˜çš„æ¦‚ç‡å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ•°æ®ä¼šå…ˆå†™åœ¨ä¸€ä¸ªå«åš <code>Write-Ahead logfile</code> çš„æ–‡ä»¶ä¸­ï¼Œç„¶åå†å†™å…¥ <code>MemStore</code> ä¸­ã€‚æ‰€ä»¥åœ¨ç³»ç»Ÿå‡ºç°æ•…éšœçš„æ—¶å€™ï¼Œæ•°æ®å¯ä»¥é€šè¿‡è¿™ä¸ªæ—¥å¿—æ–‡ä»¶é‡å»ºã€‚<strong>ï¼ˆHLogï¼‰</strong></p></blockquote><h3 id="4ã€HBaseå†™æµç¨‹"><a href="#4ã€HBaseå†™æµç¨‹" class="headerlink" title="4ã€HBaseå†™æµç¨‹"></a>4ã€HBaseå†™æµç¨‹</h3><p><img src="https://file.buildworld.cn/img/20200706193753.png"></p><blockquote><ul><li>1ï¼‰<code>Client</code> å…ˆè®¿é—® <code>zookeeper</code>ï¼Œè·å– <code>hbase:meta</code> è¡¨ä½äºå“ªä¸ª <code>Region Server</code>ã€‚ </li><li>2ï¼‰è®¿é—®å¯¹åº”çš„ <code>Region Server</code>ï¼Œè·å– <code>hbase:meta</code> è¡¨ï¼Œæ ¹æ®è¯»è¯·æ±‚çš„ <code>namespace:table/rowkey</code>ï¼ŒæŸ¥è¯¢å‡ºç›®æ ‡æ•°æ®ä½äºå“ªä¸ª <code>Region Server</code> ä¸­çš„å“ªä¸ª <code>Region</code> ä¸­ã€‚å¹¶å°†è¯¥ <code>table</code> çš„ <code>region</code> ä¿¡æ¯ä»¥åŠ <code>meta</code> è¡¨çš„ä½ç½®ä¿¡æ¯ç¼“å­˜åœ¨å®¢æˆ·ç«¯çš„ <code>meta cache</code>ï¼Œæ–¹ä¾¿ä¸‹æ¬¡è®¿é—®ã€‚</li><li>3ï¼‰ä¸ç›®æ ‡ <code>Region Server</code> è¿›è¡Œé€šè®¯ï¼›</li><li>4ï¼‰å°†æ•°æ®é¡ºåºå†™å…¥ï¼ˆè¿½åŠ ï¼‰åˆ° WALï¼› </li><li>5ï¼‰å°†æ•°æ®å†™å…¥å¯¹åº”çš„ <code>MemStore</code>ï¼Œæ•°æ®ä¼šåœ¨ <code>MemStore</code> è¿›è¡Œæ’åºï¼› </li><li>6ï¼‰å‘å®¢æˆ·ç«¯å‘é€ <code>ack</code>ï¼› </li><li>7ï¼‰ç­‰è¾¾åˆ° <code>MemStore</code> çš„åˆ·å†™æ—¶æœºåï¼Œå°†æ•°æ®åˆ·å†™åˆ° <code>HFile</code>ã€‚</li></ul></blockquote><h3 id="5ã€è¯»æµç¨‹"><a href="#5ã€è¯»æµç¨‹" class="headerlink" title="5ã€è¯»æµç¨‹"></a>5ã€è¯»æµç¨‹</h3><p><img src="https://file.buildworld.cn/img/20200706223000.png"></p><blockquote><ul><li>1ï¼‰<code>Client</code> å…ˆè®¿é—® <code>zookeeper</code>ï¼Œè·å– <code>hbase:meta</code> è¡¨ä½äºå“ªä¸ª <code>Region Server</code>ã€‚ </li><li>2ï¼‰è®¿é—®å¯¹åº”çš„ <code>Region Server</code>ï¼Œè·å– <code>hbase:meta</code> è¡¨ï¼Œæ ¹æ®è¯»è¯·æ±‚çš„ <code>namespace:table/rowkey</code>ï¼ŒæŸ¥è¯¢å‡ºç›®æ ‡æ•°æ®ä½äºå“ªä¸ª <code>Region Server</code> ä¸­çš„å“ªä¸ª <code>Region</code> ä¸­ã€‚å¹¶å°†è¯¥ <code>table</code> çš„ <code>region</code> ä¿¡æ¯ä»¥åŠ <code>meta</code> è¡¨çš„ä½ç½®ä¿¡æ¯ç¼“å­˜åœ¨å®¢æˆ·ç«¯çš„ <code>meta cache</code>ï¼Œæ–¹ä¾¿ä¸‹æ¬¡è®¿é—®ã€‚</li><li>3ï¼‰ä¸ç›®æ ‡ <code>Region Server</code> è¿›è¡Œé€šè®¯ï¼›</li><li>4ï¼‰åˆ†åˆ«åœ¨ <code>Block Cache</code>ï¼ˆè¯»ç¼“å­˜ï¼‰ï¼Œ<code>MemStore</code> å’Œ <code>Store Fileï¼ˆHFileï¼‰</code>ä¸­æŸ¥è¯¢ç›®æ ‡æ•°æ®ï¼Œå¹¶å°†æŸ¥åˆ°çš„æ‰€æœ‰æ•°æ®è¿›è¡Œåˆå¹¶ã€‚æ­¤å¤„æ‰€æœ‰æ•°æ®æ˜¯æŒ‡åŒä¸€æ¡æ•°æ®çš„ä¸åŒç‰ˆæœ¬<code>ï¼ˆtime stampï¼‰</code>æˆ–è€…ä¸åŒçš„ç±»å‹<code>ï¼ˆPut/Deleteï¼‰</code>ã€‚</li><li>5ï¼‰ å°†ä»æ–‡ä»¶ä¸­æŸ¥è¯¢åˆ°çš„æ•°æ®å—ï¼ˆBlockï¼ŒHFile æ•°æ®å­˜å‚¨å•å…ƒï¼Œé»˜è®¤å¤§å°ä¸º 64KBï¼‰ç¼“å­˜åˆ°<code>Block Cache</code>ã€‚ </li><li>6ï¼‰å°†åˆå¹¶åçš„æœ€ç»ˆç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ul></blockquote><p><strong>å†…å­˜å’Œç£ç›˜åŒæ—¶è¯»å–ï¼Œä½†æ˜¯å°†ä¸¤ä¸ªæ•°æ®è¿›è¡Œå¯¹æ¯”ï¼Œè¿”å›æ—¶é—´æˆ³å¤§çš„æ•°æ®ï¼Œæ‰€ä»¥è¯´HBaseè¯»å–æ¯”å†™å…¥è¦æ…¢å¾—å¤š</strong></p><h3 id="6ã€StoreFile-Compaction"><a href="#6ã€StoreFile-Compaction" class="headerlink" title="6ã€StoreFile Compaction"></a>6ã€<strong>StoreFile Compaction</strong></h3><blockquote><p><code>Compaction</code> åˆ†ä¸ºä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯ <code>Minor Compaction</code> å’Œ <code>Major Compaction</code>ã€‚<code>Minor Compaction</code>ä¼šå°†ä¸´è¿‘çš„è‹¥å¹²ä¸ªè¾ƒå°çš„ <code>HFile</code> åˆå¹¶æˆä¸€ä¸ªè¾ƒå¤§çš„ <code>HFile</code>ï¼Œä½†<strong>ä¸ä¼šæ¸…ç†è¿‡æœŸå’Œåˆ é™¤çš„æ•°æ®</strong>ã€‚<code>Major Compaction</code> ä¼šå°†ä¸€ä¸ª <code>Store</code> ä¸‹çš„æ‰€æœ‰çš„ <code>HFile</code> åˆå¹¶æˆä¸€ä¸ªå¤§ <code>HFile</code>ï¼Œå¹¶ä¸”<strong>ä¼šæ¸…ç†æ‰è¿‡æœŸå’Œåˆ é™¤çš„æ•°æ®</strong>ã€‚ </p></blockquote><p><img src="https://ae01.alicdn.com/kf/Hfc24467fbef54cd39b2f87d5a53bd52cs.jpg"></p><h2 id="äºŒã€HBase-APIä½¿ç”¨ï¼ˆJavaï¼‰"><a href="#äºŒã€HBase-APIä½¿ç”¨ï¼ˆJavaï¼‰" class="headerlink" title="äºŒã€HBase APIä½¿ç”¨ï¼ˆJavaï¼‰"></a>äºŒã€HBase APIä½¿ç”¨ï¼ˆJavaï¼‰</h2><h3 id="1ã€æ·»åŠ ä¾èµ–"><a href="#1ã€æ·»åŠ ä¾èµ–" class="headerlink" title="1ã€æ·»åŠ ä¾èµ–"></a>1ã€æ·»åŠ ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hbase<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hbase-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hbase<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hbase-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2ã€Javaè°ƒç”¨"><a href="#2ã€Javaè°ƒç”¨" class="headerlink" title="2ã€Javaè°ƒç”¨"></a>2ã€Javaè°ƒç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.buildworld.hbase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.util.Bytes;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MiChong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-07-09 19:03</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Connection connection = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Admin admin = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">//1ã€è·å–é…ç½®æ–‡ä»¶ä¿¡æ¯</span></span><br><span class="line">        Configuration configuration = HBaseConfiguration.create();</span><br><span class="line">        configuration.set(<span class="string">&quot;hbase.zookeeper.quorum&quot;</span>, <span class="string">&quot;hadoop102,hadoop103,hadoop104&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//2ã€åˆ›å»ºè¿æ¥å¯¹è±¡</span></span><br><span class="line">            connection = ConnectionFactory.createConnection(configuration);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//3ã€åˆ›å»ºAdminå¯¹è±¡</span></span><br><span class="line">            admin = connection.getAdmin();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (admin != <span class="keyword">null</span>) &#123;</span><br><span class="line">            admin.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (connection != <span class="keyword">null</span>) &#123;</span><br><span class="line">            connection.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1ã€åˆ¤æ–­è¡¨æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isTabExist</span><span class="params">(String tableName)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//3ã€åˆ¤æ–­è¡¨æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">boolean</span> exists = admin.tableExists(TableName.valueOf(tableName));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> exists;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2ã€åˆ›å»ºè¡¨</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createTable</span><span class="params">(String tableName, String... cfs)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ¤æ–­å‚æ•°æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">        <span class="keyword">if</span> (cfs.length &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;è¯·è®¾ç½®&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ¤æ–­è¡¨æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (isTabExist(tableName)) &#123;</span><br><span class="line">            System.out.println(tableName + <span class="string">&quot;è¡¨å·²ç»å­˜åœ¨&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºè¡¨æè¿°å™¨</span></span><br><span class="line">        HTableDescriptor hTableDescriptor = <span class="keyword">new</span> HTableDescriptor(TableName.valueOf(tableName));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (String cf : cfs) &#123;</span><br><span class="line">            <span class="comment">//åˆ›å»ºåˆ—æ—æè¿°å™¨</span></span><br><span class="line">            HColumnDescriptor hColumnDescriptor = <span class="keyword">new</span> HColumnDescriptor(cf);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ·»åŠ å…·ä½“çš„åˆ—æ—ä¿¡æ¯</span></span><br><span class="line">            hTableDescriptor.addFamily(hColumnDescriptor);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºè¡¨</span></span><br><span class="line">        admin.createTable(hTableDescriptor);</span><br><span class="line">        System.out.println(tableName + <span class="string">&quot;è¡¨åˆ›å»ºæˆåŠŸï¼&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3ã€åˆ é™¤è¡¨</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">dropTable</span><span class="params">(String tableName)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1ã€åˆ¤æ–­è¡¨æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (!isTabExist(tableName)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;è¦åˆ é™¤çš„è¡¨ä¸å­˜åœ¨ï¼ï¼ï¼&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//2ã€ä½¿è¡¨ä¸‹çº¿</span></span><br><span class="line">        admin.disableTable(TableName.valueOf(tableName));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3ã€åˆ é™¤è¡¨</span></span><br><span class="line">        admin.deleteTable(TableName.valueOf(tableName));</span><br><span class="line"></span><br><span class="line">        System.out.println(tableName + <span class="string">&quot;è¡¨åˆ é™¤æˆåŠŸï¼ï¼ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4ã€åˆ›å»ºå‘½åç©ºé—´</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createNameSpace</span><span class="params">(String ns)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºå‘½åç©ºé—´æè¿°å™¨</span></span><br><span class="line">        NamespaceDescriptor build = NamespaceDescriptor.create(ns).build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//åˆ›å»ºå‘½åç©ºé—´</span></span><br><span class="line">            admin.createNamespace(build);</span><br><span class="line">            System.out.println(ns + <span class="string">&quot;å‘½åç©ºé—´å·²ç»åˆ›å»ºå®Œæˆï¼&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NamespaceExistException ne) &#123;</span><br><span class="line">            System.out.println(ns + <span class="string">&quot;å‘½åç©ºé—´å·²ç»å­˜åœ¨ï¼ï¼ï¼&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5ã€å¾€è¡¨é‡Œé¢æ’å…¥æ•°æ®</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">putData</span><span class="params">(String tableName, String rowKey, String cf, String cn, String value)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–è¡¨å¯¹è±¡</span></span><br><span class="line">        Table table = connection.getTable(TableName.valueOf(tableName));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºputå¯¹è±¡</span></span><br><span class="line">        Put put = <span class="keyword">new</span> Put(Bytes.toBytes(rowKey));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»™putå¯¹è±¡èµ‹å€¼</span></span><br><span class="line">        put.addColumn(Bytes.toBytes(cf), Bytes.toBytes(cn), Bytes.toBytes(value));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ’å…¥æ•°æ®</span></span><br><span class="line">        table.put(put);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å…³é—­è¿æ¥</span></span><br><span class="line">        table.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//6ã€è·å–æ•°æ®</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getData</span><span class="params">(String tableName, String rowKey, String cf, String cn)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1ã€è·å–è¡¨å¯¹è±¡</span></span><br><span class="line">        Table table = connection.getTable(TableName.valueOf(tableName));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2ã€åˆ›å»ºGetå¯¹è±¡</span></span><br><span class="line">        Get get = <span class="keyword">new</span> Get(Bytes.toBytes(rowKey));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®è·å–æŒ‡å®šæ—çš„å€¼</span></span><br><span class="line">        <span class="comment">//get.addFamily(Bytes.toBytes(cf));</span></span><br><span class="line">        <span class="comment">//è·å–æŒ‡å®šæ—å’ŒæŒ‡å®šåˆ—çš„å€¼</span></span><br><span class="line">        get.addColumn(Bytes.toBytes(cf), Bytes.toBytes(cn));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3ã€è·å–æ•°æ®</span></span><br><span class="line">        Result result = table.get(get);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4ã€è§£æresult</span></span><br><span class="line">        Cell[] cells = result.rawCells();</span><br><span class="line">        <span class="keyword">for</span> (Cell cell : cells) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;CF:&quot;</span> + Bytes.toString(CellUtil.cloneFamily(cell))</span><br><span class="line">                    + <span class="string">&quot; --CN:&quot;</span> + Bytes.toString(CellUtil.cloneQualifier(cell))</span><br><span class="line">                    + <span class="string">&quot; --Value:&quot;</span> + Bytes.toString(CellUtil.cloneValue(cell)));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        table.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//7ã€è·å–æ•°æ®</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">scanTable</span><span class="params">(String tableName)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1ã€è·å–è¡¨å¯¹è±¡</span></span><br><span class="line">        Table table = connection.getTable(TableName.valueOf(tableName));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2ã€è·å–æ‰«æå™¨</span></span><br><span class="line">        Scan scan = <span class="keyword">new</span> Scan(Bytes.toBytes(<span class="string">&quot;1001&quot;</span>));</span><br><span class="line"></span><br><span class="line">        ResultScanner scanner = table.getScanner(scan);</span><br><span class="line">        <span class="keyword">for</span> (Result result : scanner) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Cell cell : result.rawCells()) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;CF:&quot;</span> + Bytes.toString(CellUtil.cloneFamily(cell))</span><br><span class="line">                        + <span class="string">&quot; --CN:&quot;</span> + Bytes.toString(CellUtil.cloneQualifier(cell))</span><br><span class="line">                        + <span class="string">&quot; --Value:&quot;</span> + Bytes.toString(CellUtil.cloneValue(cell)));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        table.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//8ã€åˆ é™¤æ•°æ®</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">deleteData</span><span class="params">(String tableName, String rowKey, String cf, String cn)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        Table table = connection.getTable(TableName.valueOf(tableName));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ„å»ºåˆ é™¤å¯¹è±¡</span></span><br><span class="line">        Delete delete = <span class="keyword">new</span> Delete(Bytes.toBytes(rowKey));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ é™¤æŒ‡å®šçš„åˆ—æ—</span></span><br><span class="line">        <span class="comment">//delete.addFamily(Bytes.toBytes(cf));</span></span><br><span class="line">        delete.addColumns(Bytes.toBytes(cf), Bytes.toBytes(cn));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ‰§è¡Œåˆ é™¤æ“ä½œ</span></span><br><span class="line">        table.delete(delete);</span><br><span class="line"></span><br><span class="line">        table.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1ã€æµ‹è¯•è¡¨æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="comment">// System.out.println(isTabExist(&quot;student&quot;));</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2ã€åˆ›å»ºè¡¨æµ‹è¯•</span></span><br><span class="line">        <span class="comment">//createTable(&quot;idea:java&quot;, &quot;class&quot;, &quot;desc&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//3ã€åˆ é™¤è¡¨æµ‹è¯•</span></span><br><span class="line">        <span class="comment">//dropTable(&quot;teacher&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//4ã€æµ‹è¯•å‘½åç©ºé—´åˆ›å»º</span></span><br><span class="line">        <span class="comment">//createNameSpace(&quot;idea&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//5ã€æµ‹è¯•æ’å…¥å¦‚æ•°æ®</span></span><br><span class="line">        <span class="comment">//putData(&quot;student&quot;,&quot;1003&quot;,&quot;info&quot;,&quot;name&quot;,&quot;michong&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//6ã€è·å–è¡¨æ•°æ®</span></span><br><span class="line">        <span class="comment">//getData(&quot;student&quot;, &quot;1001&quot;, &quot;info&quot;, &quot;sex&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//7ã€æ‰«æè¡¨</span></span><br><span class="line">        <span class="comment">//scanTable(&quot;student&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//8ã€æµ‹è¯•åˆ é™¤</span></span><br><span class="line">        deleteData(<span class="string">&quot;student&quot;</span>, <span class="string">&quot;1002&quot;</span>, <span class="string">&quot;info&quot;</span>, <span class="string">&quot;name&quot;</span>);</span><br><span class="line"></span><br><span class="line">        close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Apache HBaseâ„¢ is the Hadoop database, a distributed, scalable, big data store.</summary>
    
    
    
    <category term="BigData" scheme="https://www.buildworld.cn/categories/BigData/"/>
    
    
    <category term="HBase" scheme="https://www.buildworld.cn/tags/HBase/"/>
    
  </entry>
  
  <entry>
    <title>BCI-EEGè„‘ç”µæ•°æ®å¤„ç†</title>
    <link href="https://www.buildworld.cn/2020/07/07/BCI-EEG%E8%84%91%E7%94%B5%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/"/>
    <id>https://www.buildworld.cn/2020/07/07/BCI-EEG%E8%84%91%E7%94%B5%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/</id>
    <published>2020-07-07T11:42:56.000Z</published>
    <updated>2021-04-09T02:13:38.361Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="EEGè„‘ç”µæ•°æ®å¤„ç†"><a href="#EEGè„‘ç”µæ•°æ®å¤„ç†" class="headerlink" title="EEGè„‘ç”µæ•°æ®å¤„ç†"></a>EEGè„‘ç”µæ•°æ®å¤„ç†</h2><blockquote><p>è„‘ç”µæ³¢ï¼ˆElectroencephalogram,EEGï¼‰æ˜¯ä¸€ç§ä½¿ç”¨ç”µç”Ÿç†æŒ‡æ ‡è®°å½•å¤§è„‘æ´»åŠ¨çš„æ–¹æ³•ï¼Œå¤§è„‘åœ¨æ´»åŠ¨æ—¶ï¼Œå¤§é‡ç¥ç»å…ƒåŒæ­¥å‘ç”Ÿçš„çªè§¦åç”µä½ç»æ€»å’Œåå½¢æˆçš„ã€‚å®ƒè®°å½•å¤§è„‘æ´»åŠ¨æ—¶çš„ç”µæ³¢å˜åŒ–ï¼Œæ˜¯è„‘ç¥ç»ç»†èƒçš„ç”µç”Ÿç†æ´»åŠ¨åœ¨å¤§è„‘çš®å±‚æˆ–å¤´çš®è¡¨é¢çš„æ€»ä½“åæ˜ ã€‚è„‘æœºæ¥<br>å£ï¼ˆBCIï¼‰ï¼Œæ˜¯ä¸€ç§é€šè¿‡æ£€æµ‹ä¸­æ¢ç¥ç»ç³»ç»Ÿæ´»åŠ¨å¹¶å°†å…¶è½¬åŒ–ä¸ºäººå·¥è¾“å‡ºï¼Œæ¥æ›¿ä»£ã€ä¿®å¤ã€å¢å¼ºã€è¡¥å……æˆ–è€…æ”¹å–„ä¸­æ¢ç¥ç»ç³»ç»Ÿçš„æ­£å¸¸è¾“å‡ºï¼Œä»è€Œæ”¹å˜ä¸­æ¢ç¥ç»ç³»ç»Ÿä¸å†…å¤–ç¯å¢ƒä¹‹é—´çš„äº¤äº’ä½œç”¨çš„æŠ€æœ¯ã€‚</p></blockquote><h3 id="ä¸€ã€åå¤§åŸºæœ¬æ­¥éª¤"><a href="#ä¸€ã€åå¤§åŸºæœ¬æ­¥éª¤" class="headerlink" title="ä¸€ã€åå¤§åŸºæœ¬æ­¥éª¤"></a>ä¸€ã€åå¤§åŸºæœ¬æ­¥éª¤</h3><h4 id="1ã€-å®šä½é€šé“ä½ç½®"><a href="#1ã€-å®šä½é€šé“ä½ç½®" class="headerlink" title="1ã€ å®šä½é€šé“ä½ç½®"></a>1ã€ å®šä½é€šé“ä½ç½®</h4><blockquote><p>å°†EEGæ•°æ®åŠ è½½è¿›eeglabä¹‹åï¼Œ<code>eeglab</code>èƒ½å¤Ÿè¯»å–åˆ°çš„ä»…ä»…æ˜¯æ¯ä¸€ä¸ªé€šé“çš„åç§°å’Œæ•°å€¼ï¼Œä½†æ˜¯å®ƒå¹¶ä¸çŸ¥é“è¿™ä¸ªé€šé“æ˜¯ä½äºå¤´çš®ä¸Šçš„ä»€ä¹ˆåœ°æ–¹ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åŠ è½½è¿›ä¸€ä¸ªè·Ÿè®°å½•æ•°æ®æ—¶ç›¸åŒ¹é…çš„é€šé“ä½ç½®ä¿¡æ¯</p></blockquote><blockquote><p>eeglabä¸­é»˜è®¤çš„æ–‡ä»¶æ˜¯ <strong>standard-10-5-cap385(<a href="https://mp.weixin.qq.com/s?__biz=MzU5NjU4OTc4MA==&mid=2247484433&idx=1&sn=1d4bba3c10192920d8255d899a6d8f28&chksm=fe6129aac916a0bc648142cb3a53c0679cd1c03a21c20553bba0b4858c613cd6dd0e73e8b727&scene=21#wechat_redirect">å›½é™…10-5ç³»ç»Ÿ</a>)</strong></p></blockquote><h4 id="2ã€åˆ é™¤æ— ç”¨é€šé“"><a href="#2ã€åˆ é™¤æ— ç”¨é€šé“" class="headerlink" title="2ã€åˆ é™¤æ— ç”¨é€šé“"></a>2ã€åˆ é™¤æ— ç”¨é€šé“</h4><blockquote><p>åœ¨<strong>EEGLAB</strong>ä¸­é¢„å¤„ç†æ•°æ®çš„æ—¶å€™ï¼Œä½¿ç”¨<code>ICA</code>æ–¹å¼å»é™¤çœ¼ç”µæˆåˆ†ï¼Œè¿™ç§æ–¹å¼å¯ä»¥ä¸ç”¨çœ¼ç”µé€šé“æ•°æ®çš„å‚ä¸å°±å¯ä»¥è¿›è¡Œã€‚</p></blockquote><h4 id="3ã€æ»¤æ³¢"><a href="#3ã€æ»¤æ³¢" class="headerlink" title="3ã€æ»¤æ³¢"></a>3ã€æ»¤æ³¢</h4><blockquote><p>æ»¤æ³¢åˆ†ä¸º<code>é«˜é€šæ»¤æ³¢</code>ï¼Œ<code>ä½é€šæ»¤æ³¢</code>ï¼Œ<code>å¸¦é€šæ»¤æ³¢</code>å’Œ<code>å‡¹é™·æ»¤æ³¢</code>ã€‚</p></blockquote><ul><li><strong>é«˜é€šæ»¤æ³¢</strong>æ˜¯æŒ‡ï¼Œé«˜äºæŸä¸ªé¢‘ç‡çš„ä¿¡å·å¯ä»¥é€šè¿‡ï¼Œè€Œä½äºè¿™ä¸ªé¢‘ç‡çš„ä¿¡å·ä¼šè¢«è¡°å‡è¿‡æ»¤æ‰ã€‚è€Œ<strong>ä½é€šæ»¤æ³¢</strong>åˆ™ç›¸åï¼ŒæŒ‡çš„æ˜¯ä½äºæŸä¸ªé¢‘ç‡çš„ä¿¡å·å¯ä»¥é€šè¿‡ï¼Œè€Œé«˜äºè¿™ä¸ªé¢‘ç‡çš„ä¿¡å·åˆ™ç›¸åã€‚æ‰€ä»¥ï¼Œåœ¨è¾“å…¥æ•°å€¼çš„æ—¶å€™ï¼Œé«˜é€šæ»¤æ³¢è¦è¾“å…¥çš„æ˜¯ä¸€ä¸ªè¾ƒå°çš„æ•°å­—ï¼Œè€Œä½é€šæ»¤æ³¢åˆ™æ˜¯è¾“å…¥ä¸€ä¸ªè¾ƒå¤§çš„æ•°å­—ã€‚è¿™å¯èƒ½è·Ÿæˆ‘ä»¬çš„ç¬¬ä¸€ååº”æœ‰ç‚¹ç›¸æ‚–ã€‚å› æ­¤ï¼Œä¹Ÿå¯ä»¥ç”¨å®ƒä»¬çš„è‹±æ–‡å«æ³•æ¥è¾¨åˆ«ï¼Œé«˜é€š<code>high-pass</code>ï¼Œä½é€š<code>low-pass</code>ï¼Œè‹±æ–‡çœ‹èµ·æ¥å°±æ›´ä¸ºç›´è§‚äº†ã€‚</li><li><strong>å¸¦é€šæ»¤æ³¢</strong>ï¼ŒæŒ‡çš„æ˜¯åœ¨æŸä¸ªé¢‘ç‡æ®µèŒƒå›´å†…çš„ä¿¡å·å¯ä»¥é€šè¿‡ï¼Œè€Œè¿™ä¸ªé¢‘ç‡æ®µèŒƒå›´ä»¥å¤–çš„ä¿¡å·ä¼šè¢«è¡°å‡è¿‡æ»¤æ‰ï¼Œå°±ç›¸å½“äºåŒæ—¶åšäº†é«˜é€šæ»¤æ³¢å’Œä½é€šæ»¤æ³¢ã€‚</li><li><strong>å‡¹é™·æ»¤æ³¢</strong>ï¼ŒæŒ‡çš„æ˜¯åœ¨æŸä¸ªé¢‘ç‡èŒƒå›´å†…çš„ä¿¡å·ä¼šè¢«è¡°å‡è¿‡æ»¤æ‰ï¼Œè€Œè¿™ä¸ªé¢‘ç‡èŒƒå›´ä»¥å¤–çš„ä¿¡å·ä¼šè¢«ä¿ç•™ä¸‹æ¥ã€‚è¿™ä¸ªæ“ä½œé€šå¸¸æ˜¯ç”¨æ¥å»é™¤50Hzå¸‚ç”µçš„å¹²æ‰°ã€‚æˆ‘å›½çš„50Hzï¼Œå› æ­¤åœ¨æ”¶é›†åˆ°çš„ä¿¡å·ä¸­ï¼Œä¼šæœ‰ä¸€ä¸ªéå¸¸å¼ºçƒˆçš„50Hzé¢‘æ®µçš„ä¿¡å·å­˜åœ¨ï¼Œè¿™å°±å¯ä»¥ç”¨å‡¹é™·æ»¤æ³¢æ¥å»æ‰ã€‚</li></ul><h4 id="4ã€åˆ†æ®µ"><a href="#4ã€åˆ†æ®µ" class="headerlink" title="4ã€åˆ†æ®µ"></a>4ã€åˆ†æ®µ</h4><blockquote><p>æ•°æ®æ‰“ä¸Š<strong>mark</strong>ï¼Œå°†æ•°æ®åˆ‡åˆ†ä¸ºä¸€æ®µä¸€æ®µï¼Œåœ¨è¿™äº›èŒƒå›´ä»¥å¤–çš„çš„æ•°æ®ï¼Œç›´æ¥å»é™¤ã€‚</p><p>ä¸€èˆ¬çš„ERPåˆ†æ®µåœ¨äº‹ä»¶å‰200æ¯«ç§’åˆ°äº‹ä»¶å1000æ¯«ç§’è¿™ä¸ªæ—¶é—´æ®µå°±è¶³å¤Ÿäº†ï¼Œå› ä¸ºå‡ ä¹æ‰€æœ‰çš„ERPæˆåˆ†ï¼Œéƒ½æ˜¯åœ¨1ç§’ä»¥å†…äº§ç”Ÿçš„ã€‚ä½†æ˜¯å¦‚æœåæœŸè¿˜è¦åšæ—¶é¢‘åˆ†æçš„è¯ï¼Œåˆ™éœ€è¦å°†åˆ†æ®µæ—¶é—´æ‹‰é•¿ï¼Œæ‰©å¤§åˆ°äº‹ä»¶å‰1ç§’åˆ°äº‹ä»¶å2ç§’è¿™ä¸ªæ—¶é—´æ®µå†…ï¼Œå› ä¸ºæ—¶é¢‘åˆ†æçš„ç®—æ³•ï¼Œè¦æ±‚æ•°æ®è¦æœ‰ä¸€å®šçš„é•¿åº¦ã€‚</p></blockquote><h4 id="5ã€åŸºçº¿æ ¡æ­£"><a href="#5ã€åŸºçº¿æ ¡æ­£" class="headerlink" title="5ã€åŸºçº¿æ ¡æ­£"></a>5ã€åŸºçº¿æ ¡æ­£</h4><blockquote><p>è¢«è¯•è¢«è®¤ä¸ºæ˜¯å¤„äºä¸€ä¸ªç›¸å¯¹å¹³é™çš„çŠ¶æ€ï¼Œæ­¤æ—¶çš„è„‘ç”µæ´»åŠ¨ä»£è¡¨äº†ä¸€ä¸ªå¹³é™çŠ¶æ€ä¸‹çš„è„‘ç”µæ´»åŠ¨ï¼Œå°†è¿™æ®µæ—¶é—´å†…çš„è„‘ç”µæ´»åŠ¨å½“åšæˆä¸€ä¸ªåŸºçº¿ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œéƒ½æ˜¯ä»¥åˆ†æ®µä¸­ï¼Œäº‹ä»¶ä¹‹å‰è¿™æ®µæ—¶é—´æ¥ä½œä¸ºåŸºçº¿çš„ï¼Œæ¯”å¦‚åˆ†æ®µä¸º-200æ¯«ç§’åˆ°1000æ¯«ç§’ï¼Œé‚£å°±å°†æ‰€æœ‰çš„æ•°æ®ï¼Œå‡å»å‰200æ¯«ç±³ä»¥å†…æ•°æ®çš„å‡å€¼ã€‚</p><p>åŸºçº¿æ ¡æ­£çš„ç¬¬äºŒä¸ªä½œç”¨æ˜¯<strong>é˜²æ­¢æ•°æ®æ¼‚ç§»å¸¦æ¥çš„å½±å“</strong>ã€‚æœ‰æ—¶å€™å› ä¸ºæŸäº›åŸå› ï¼Œæˆ‘ä»¬é‡‡é›†åˆ°çš„æ•°æ®ï¼Œä¼šå‘ˆç°ä¸€ä¸ªé€æ¸ç¼“æ…¢å‘ä¸Šæ¼‚ç§»çš„è¶‹åŠ¿ï¼Œè€Œåœ¨åˆ†å®Œæ®µä¹‹åï¼Œç”±äºå‘ä¸Šé£˜çš„å½±å“ï¼Œæ¯ä¸€æ®µæ•°æ®çš„èµ·ç‚¹å°†ä¸åœ¨åŒä¸€ä¸ªåœ°æ–¹ï¼Œä¹Ÿä¼šä½¿å¾—è¿™æ®µæ•°æ®çš„ç»å¯¹æ³¢å¹…å˜é«˜ã€‚è€ŒåŸºçº¿æ ¡æ­£å°±å¯ä»¥æ ¡æ­£è¿™ç§æ¼‚ç§»å¸¦æ¥çš„å½±å“ï¼Œè®©æ¯ä¸€æ®µæ•°æ®éƒ½æ‹¥æœ‰ä¸€ä¸ªå·®ä¸å¤šçš„èµ·ç‚¹ã€‚</p></blockquote><h4 id="6ã€é‡å‚è€ƒ"><a href="#6ã€é‡å‚è€ƒ" class="headerlink" title="6ã€é‡å‚è€ƒ"></a>6ã€é‡å‚è€ƒ</h4><blockquote><ul><li>é¦–å…ˆè¦è§£é‡Šçš„æ˜¯å‚è€ƒçš„å®šä¹‰ã€‚æˆ‘ä»¬çœ‹åˆ°é‡‡é›†ä¹‹åçš„æ•°æ®æ˜¯ä¸€ä¸ªä¸ªçš„æ•°å€¼ï¼Œä½†è¿™ä¸ªæ•°å€¼æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Œå°±æ˜¯ç”µææ‰€åœ¨ä½ç½®è·Ÿå‚è€ƒç”µæä¹‹é—´çš„ç”µä½å·®ã€‚</li><li>ä¸€èˆ¬åœ¨è„‘ç”µè®°å½•çš„æ—¶å€™ä¼šé‡‡ç”¨çš„å‚è€ƒç”µææœ‰é¼»å°–å‚è€ƒï¼Œczæˆ–å¤´é¡¶ä¸­å¤®å‚è€ƒï¼Œè¿˜æœ‰å•ä¾§ä¹³çªå‚è€ƒï¼Œä¹³çªå°±æ˜¯è€³æœµåé¢ä¸€å°å—çªèµ·çš„åŒºåŸŸã€‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„æ¯ä¸ªé€šé“çš„æ•°å€¼ï¼Œå…¶å®å°±æ˜¯æŒ‡è¿™ä¸ªé€šé“è·Ÿå‚è€ƒé€šé“ä¹‹é—´çš„ç”µä½å·®ã€‚</li><li>åœ¨åˆ†ææ•°æ®çš„æ—¶å€™ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ä¼šæƒ³è¦è½¬æ¢å‚è€ƒç‚¹çš„ä½ç½®ã€‚å› ä¸ºä¸åŒä½ç½®çš„å‚è€ƒï¼Œä¼šå¯¹æ•°æ®é€ æˆä¸€å®šçš„å½±å“ã€‚æ¯”å¦‚è®°å½•æ—¶é‡‡ç”¨çš„æ˜¯czæˆ–å¤´é¡¶ä¸­å¤®å‚è€ƒï¼Œé‚£ä¹ˆè‡ªç„¶åœ°ï¼Œè·ç¦»czç‚¹è¾ƒè¿‘çš„ç”µæç‚¹ï¼Œè®°å½•åˆ°çš„ç”µä½å·®ä¼šéå¸¸å°ï¼Œè€Œç¦»å¾—è¿œçš„ç”µæè®°å½•åˆ°çš„ç”µä½å·®å°±è‡ªç„¶ä¼šå¤§ä¸€ç‚¹ï¼Œè¿™ç§å¤§ä¸å°çš„å·®å¼‚ï¼Œå¹¶ä¸æ˜¯ç”±è®¤çŸ¥æ´»åŠ¨äº§ç”Ÿçš„ï¼Œè€Œæ˜¯ç”±è®°å½•æ–¹å¼äº§ç”Ÿçš„ã€‚åˆæ¯”å¦‚ï¼Œå•ä¾§ä¹³çªå‚è€ƒï¼Œé‚£è„‘è¢‹å·¦è¾¹çš„ç”µæç‚¹è·Ÿå³è¾¹çš„ç”µæç‚¹ï¼Œä¹Ÿä¼šå­˜åœ¨ç€è®°å½•æ–¹å¼ä¸åŒäº§ç”Ÿçš„ç”µä½å·®ä¸åŒã€‚</li><li>å¸¸ç”¨çš„ä¸€äº›å‚è€ƒä½ç½®æœ‰åŒä¾§ä¹³çªå¹³å‡å‚è€ƒï¼ŒæŒ‡å°†ä¸¤ä¸ªä¹³çªæ•°æ®çš„å¹³å‡å€¼ä½œä¸ºå‚è€ƒæ•°æ®ï¼Œæˆ–è€…æ˜¯å…¨è„‘å¹³å‡å‚è€ƒï¼ŒæŒ‡çš„æ˜¯å°†å…¨è„‘æ‰€æœ‰æ•°æ®çš„å‡å€¼ä½œä¸ºå‚è€ƒæ•°æ®çš„æ–¹æ³•ï¼Œä¸è¿‡ä½¿ç”¨å…¨è„‘å¹³å‡å‚è€ƒçš„æ—¶å€™è¦æ³¨æ„ï¼Œçœ¼ç”µæ•°æ®ä¸è¦çº³å…¥å…¶ä¸­ï¼Œå› ä¸ºçœ¼ç”µæ•°æ®çš„æ³¢åŠ¨èµ·ä¼éå¸¸å¤§ï¼Œå¾ˆå®¹æ˜“å¯¹æ•°æ®é€ æˆæ¯”è¾ƒå¤§çš„å¹²æ‰°ã€‚</li></ul></blockquote><h4 id="7ã€é™ä½é‡‡æ ·ç‡"><a href="#7ã€é™ä½é‡‡æ ·ç‡" class="headerlink" title="7ã€é™ä½é‡‡æ ·ç‡"></a>7ã€é™ä½é‡‡æ ·ç‡</h4><blockquote><ul><li>é‡‡æ ·ç‡çš„å•ä½æ˜¯Hzï¼ŒæŒ‡çš„æ˜¯ä¸€ç§’å†…è¦è®°å½•å¤šå°‘ä¸ªæ•°æ®ç‚¹çš„æ„æ€ï¼Œæ¯”å¦‚åŸå§‹æ•°æ®çš„é‡‡æ ·ç‡æ˜¯1000Hzçš„è¯ï¼Œå°±æ˜¯ä»£è¡¨ä¸€ç§’å†…æœ‰1000ä¸ªæ•°æ®ç‚¹ã€‚</li><li>åœ¨åæœŸåˆ†æçš„æ—¶å€™ï¼Œæˆ‘ä»¬æœ‰æ—¶å€™ä¼šæƒ³è¦é™ä½é‡‡æ ·ç‡ï¼Œæ¯”å¦‚é™åˆ°500Hzæˆ–è€…250Hzã€‚è¿™æ ·åšæœ€å¤§çš„å¥½å¤„å…¶å®å°±æ˜¯å‡å°æ•°æ®é‡ï¼Œä»¥æé«˜è®¡ç®—é€Ÿåº¦ï¼Œæ²¡æœ‰å…¶ä»–çš„ä½œç”¨äº†ã€‚æ‰€ä»¥è¿™ä¸€æ­¥å¹¶ä¸æ˜¯å¿…é¡»çš„ã€‚</li><li>ä½†é™ä½é‡‡æ ·ç‡éœ€è¦æ³¨æ„ä¸¤ç‚¹ï¼Œ<strong>ä¸€æ˜¯é™ä½é‡‡æ ·ç‡è¦åœ¨æ»¤æ³¢ä¹‹å</strong>ã€‚å› ä¸ºé™ä½é‡‡æ ·ç‡ä¼šä½¿æˆ‘ä»¬ä¸¢å¤±é«˜é¢‘ä¿¡æ¯ï¼Œä½¿é«˜é¢‘ä¿¡æ¯å˜å¾—æ‰­æ›²ï¼Œæ‰€ä»¥æœ€å¥½åœ¨ä¿ç•™äº†æˆ‘ä»¬æ„Ÿå…´è¶£æ³¢æ®µä¹‹åå†å»é™ä½é‡‡æ ·ç‡ï¼Œè¿™æ ·å¯ä»¥ä¿è¯ä¿¡å·æœ€å¤§ç¨‹åº¦ä¸ä¼šå¤±çœŸã€‚<strong>äºŒæ˜¯æœ‰ä¸€ä¸ªé‡‡æ ·å®šç†ï¼Œ</strong>ç†è®ºä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬çš„é‡‡æ ·ç‡å¿…é¡»æ˜¯æˆ‘ä»¬æƒ³è¦åˆ†æçš„æ³¢æ®µçš„ä¸¤å€ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³è¦åˆ†æ60Hzçš„æ³¢ï¼Œé‚£æ•°æ®é‡‡æ ·ç‡ä¸º120Hzå°±è¶³å¤Ÿäº†ã€‚å®é™…ä¸Šï¼Œå»ºè®®é‡‡æ ·ç‡æœ€å¥½åœ¨åˆ†ææ³¢æ®µçš„ä¸‰åˆ°å››å€ã€‚</li></ul></blockquote><h4 id="8ã€æ’å€¼åå¯¼"><a href="#8ã€æ’å€¼åå¯¼" class="headerlink" title="8ã€æ’å€¼åå¯¼"></a>8ã€æ’å€¼åå¯¼</h4><blockquote><ul><li>åœ¨åšå®Œä¸Šè¿°è¿™äº›å¤„ç†ä¹‹åï¼Œå¯ä»¥ä¿å­˜ä¸€ä¸‹æ•°æ®ã€‚å› ä¸ºåœ¨è¿™ä¹‹å‰çš„æ“ä½œï¼Œæ˜¯æ¯ä¸ªè¢«è¯•éƒ½éœ€è¦åšçš„åŸºç¡€æ“ä½œï¼ŒåæœŸæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»£ç æ¥å®ç°æ‰¹å¤„ç†ã€‚è€Œåœ¨è¿™ä¹‹åçš„æ“ä½œï¼Œæ˜¯éœ€è¦æ ¹æ®æ¯ä¸ªè¢«è¯•çš„å…·ä½“æƒ…å†µå…·ä½“åˆ†æå»å¤„ç†çš„ï¼Œå› æ­¤åªèƒ½ä¸€ä¸ªä¸ªåšï¼Œä¸èƒ½è¿›è¡Œæ‰¹å¤„ç†ã€‚</li><li>ä»è¿™ä¸€æ­¥å¼€å§‹å¯ä»¥è¯´æ˜¯çœŸæ­£çš„å»é™¤ä¼ªè¿¹çš„è¿‡ç¨‹äº†ã€‚å»ä¼ªè¿¹å¤§ä½“åˆ†ä¸ºä¸¤ç§ï¼Œ<code>æ¨ªå‘æ“ä½œ</code>å’Œ<code>çºµå‘æ“ä½œ</code>ï¼Œ<strong>æ¨ªå‘å³å¯¹é€šé“è¿›è¡Œæ ¡æ­£æ“ä½œï¼Œå¯¹æ•°æ®ä¸å¥½çš„å¯¼è”è¿›è¡Œæ’å€¼å¤„ç†ï¼Œçºµå‘æ˜¯æŒ‡æŒ‘å‡ºæ•°æ®ä¸å¥½çš„trialsï¼Œåˆ é™¤æ‰ã€‚</strong>å»ºè®®æ˜¯å…ˆæ¨ªå‘å¤„ç†åå†çºµå‘å‰”é™¤ï¼Œå°½é‡ä¿ç•™ä¸‹æ›´å¤šçš„trialsæ•°ã€‚</li><li>EEGLABä¸­æ’å€¼åå¯¼æœ‰ä¸¤ç§æ–¹å¼ï¼Œ<strong>ä¸€ç§æ˜¯ä»¥æŸé€šé“å‘¨å›´å‡ ä¸ªé€šé“çš„æ•°æ®çš„å¹³å‡å€¼ï¼Œæ¥æ›¿ä»£è¿™ä¸ªé€šé“çš„æ•°æ®ï¼Œè¿™ç§ç›´æ¥é€šè¿‡ä»£ç å®ç°å³å¯ã€‚</strong> <strong>å¦å¤–ä¸€ç§æ˜¯EEGLABé‡Œå†…ç½®çš„ä¸€ç§ç®—æ³•å®ç°</strong>ï¼Œå…·ä½“æ¢ç®—æ˜¯ä»€ä¹ˆè¿‡ç¨‹æˆ‘ä¹Ÿä¸å¤ªæ¸…æ¥šï¼Œä½†æ˜¯æˆ‘é—®è¿‡è´¾ä¼šå®¾è€å¸ˆï¼Œä»–æ˜¯æ¨èä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•ã€‚åŸå› åœ¨äºï¼Œæˆ‘ä»¬è®°å½•çš„æ˜¯å¤´çš®è„‘ç”µï¼Œå¤´æ˜¯ä¸€ä¸ªçƒä½“ï¼Œå› æ­¤ç›´æ¥ç”¨å‘¨å›´æ•°æ®çš„å‡å€¼æ¥ä»£æ›¿è¿™ç§æ–¹æ³•æœ‰ç‚¹ç²—ç³™ï¼Œè€ŒEEGLABå†…ç½®çš„æ–¹æ³•åˆ™ä¼šè€ƒè™‘åˆ°å®¹ç§¯ä¼ å¯¼æ•ˆåº”ï¼Œä»¥åŠè¿‘çš„ç‚¹å’Œè¿œçš„ç‚¹è´¡çŒ®çš„æƒé‡ä¸åŒæ¥è¿›è¡Œæ’å€¼ï¼Œå› æ­¤ä¼šæ›´åŠ æœ‰æ•ˆã€‚</li></ul></blockquote><h4 id="9ã€ç‹¬ç«‹ä¸»æˆåˆ†åˆ†æ"><a href="#9ã€ç‹¬ç«‹ä¸»æˆåˆ†åˆ†æ" class="headerlink" title="9ã€ç‹¬ç«‹ä¸»æˆåˆ†åˆ†æ"></a>9ã€ç‹¬ç«‹ä¸»æˆåˆ†åˆ†æ</h4><p><strong><a href="https://mp.weixin.qq.com/s?__biz=MzU5NjU4OTc4MA==&mid=2247486858&idx=1&sn=abb9ba31da1264ca1f2d5a690ee04b4d&chksm=fe612031c916a927a710161d50ac9e5c8969b02141c5952c739e4689d61f59bbdf8e391f7186&scene=21#wechat_redirect">å¦‚ä½•è¯†åˆ«ICAæˆåˆ†</a></strong></p><blockquote><p>è¿™æ˜¯ä¸€ä¸ªå¾ˆæœ‰ç”¨ä½†ä¹Ÿå¾ˆéš¾çš„æ–¹æ³•ï¼Œæˆ‘å¹¶ä¸æ˜¯ååˆ†æ¸…æ¥šå®ƒçš„åŸç†ï¼Œåªèƒ½å¤§æ¦‚ç†è§£ï¼Œä¹Ÿåªèƒ½å¤§æ¦‚æè¿°ä¸€ä¸‹ã€‚å‰é¢è¯´è¿‡ï¼Œæˆ‘ä»¬è®°å½•åˆ°çš„æ˜¯å¤´çš®è„‘ç”µï¼Œè„‘ç”µå¸½ä¸Šåˆ’å‡ºäº†ä¸€ä¸ªä¸ªçš„ç‚¹æ¥è¡¨ç¤ºä½ç½®ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨<code>FPz</code>ç‚¹è®°å½•åˆ°çš„æ•°æ®ï¼Œå°±çœŸçš„æ˜¯<code>FPz</code>ç‚¹è¿™ä¸ªä½ç½®å¤´çš®ä¸‹æ–¹çš„åŒºåŸŸæ‰€äº§ç”Ÿçš„ç”µæ´»åŠ¨ï¼Ÿä¸ä¸€å®šã€‚åšè¿‡å®éªŒçš„éƒ½çŸ¥é“ï¼Œçœ¨çœ¼ä¼šäº§ç”Ÿå½±å“ï¼Œå·¦å³çœ‹ä¼šäº§ç”Ÿå½±å“ï¼Œå¸½å­æˆ´å¾—å¤ªç´§å¯¼è‡´è‚Œè‚‰ç´§å¼ ä¹Ÿä¼šäº§ç”Ÿå½±å“ï¼Œè¿˜æœ‰å·¦å³çš„<code>FP1ï¼ŒFP2</code>å¤„äº§ç”Ÿçš„ç”µæ´»åŠ¨ä¹Ÿä¼šå½±å“åˆ°<code>FPz</code>ï¼Œç”šè‡³åœ¨ç¦»å®ƒæœ€è¿œçš„Ozç‚¹ä¸‹æ–¹äº§ç”Ÿçš„ç”µæ´»åŠ¨ï¼Œä¹Ÿæœ‰å¯èƒ½å¯¹å‰æ–¹<code>FPz</code>ç‚¹äº§ç”Ÿå¾®å¼±çš„å½±å“ã€‚å› ä¸ºçœŸæ­£çš„ç”µæ´»åŠ¨äº§ç”Ÿäºå¤´çš®ä¸‹æ–¹é¢…éª¨å†…éƒ¨ï¼Œå®ƒç»è¿‡äº†è¿™ä¹ˆä¸€å±‚åˆä¸€å±‚çš„ä¼ æ’­ä¹‹åï¼Œä¸åŒæºçš„ç”µæ´»åŠ¨è‚¯å®šä¼šç›¸äº’å½±å“ï¼Œä»è€Œå¯¼è‡´æŸä¸ªè®°å½•ç‚¹è®°å½•åˆ°çš„æ•°æ®ï¼Œæ··åˆäº†å¾ˆå¤šä¸åŒæˆåˆ†çš„ç”µæ´»åŠ¨ã€‚è€Œç‹¬ç«‹ä¸»æˆåˆ†åˆ†æï¼Œå°±æ˜¯è¦å¯¹è®°å½•ç‚¹çš„æ•°æ®åšä¸€ä¸ªé€†è¿ç®—ï¼ŒæŠŠæ¯ä¸ªè®°å½•ç‚¹çš„æ•°æ®ï¼Œ åˆ†è§£æˆä¸€ä¸ªåˆä¸€ä¸ªçš„æˆåˆ†ç»„æˆã€‚ç„¶åæˆ‘ä»¬å†ä»ä¸­å‰”é™¤æ‰ä¼ªè¿¹æˆåˆ†ï¼Œæ¯”å¦‚çœ¨çœ¼çš„æˆåˆ†ï¼Œè‚Œè‚‰ç´§å¼ çš„æˆåˆ†ç­‰ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªç›¸å¯¹å¹²å‡€çš„æ•°æ®ã€‚</p></blockquote><h4 id="10ã€å‰”é™¤åæ®µ"><a href="#10ã€å‰”é™¤åæ®µ" class="headerlink" title="10ã€å‰”é™¤åæ®µ"></a>10ã€å‰”é™¤åæ®µ</h4><blockquote><ul><li>é¢„å¤„ç†åˆ°äº†è¿™ä¸€æ­¥ï¼Œå·²ç»æ¥è¿‘äºå®Œæˆäº†ã€‚æœ€åä¸€ä¸ªæ­¥éª¤å°±æ˜¯è¦å‰”é™¤æ‰æ³¢å¹…è¶…è¿‡100å¾®å¹…çš„trial(è¦æ±‚ä¸¥æ ¼ä¸€ç‚¹ä¹Ÿå¯ä»¥å®šä½80)ï¼Œå› ä¸ºæ³¢å¹…èµ·ä¼è¿™ä¹ˆå¤§çš„æ´»åŠ¨ï¼Œå·²ç»ä¸æ˜¯ç”±è®¤çŸ¥æ´»åŠ¨å¼•èµ·çš„äº†ï¼Œè‚¯å®šæ˜¯ç”±äºå…¶ä»–çš„åŠ¨ä½œå¼•èµ·çš„ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å‰”é™¤æ‰ã€‚</li><li>è¿™ä¸€æ­¥æ“ä½œä¸€å®šè¦åœ¨æ’å€¼åå¯¼å’ŒICAå»é™¤çœ¼ç”µæˆåˆ†ä¹‹åå†åšï¼Œå› ä¸ºæœ‰å¯èƒ½è¢«è¯•çœ¨çœ¼æ¯”è¾ƒé¢‘ç¹ï¼Œé‚£è¿™ä¹ˆæ“ä½œä¸‹æ¥ï¼Œæœ‰å¯èƒ½å°±éœ€è¦åˆ æ‰æ¥è¿‘ä¸€åŠçš„trialsæ•°äº†ï¼Œåˆ æ‰çš„trialsæ•°å¤ªå¤šï¼Œè¿™ä¸ªæ•°æ®ä¹Ÿå°±åºŸäº†ã€‚æ‰€ä»¥è¦å°†å®ƒç•™åˆ°æœ€åä¸€æ­¥æ‰åšï¼ŒåŒæ—¶ï¼Œè¿™ä¸ªæ“ä½œä¹Ÿèƒ½ç”¨æ¥æ£€æŸ¥æˆ‘ä»¬å‰ä¸¤æ­¥æ“ä½œæ˜¯å¦è¶³å¤Ÿæœ‰æ•ˆã€‚</li></ul></blockquote><h3 id="äºŒã€ICA-ç‹¬ç«‹æˆåˆ†åˆ†æ"><a href="#äºŒã€ICA-ç‹¬ç«‹æˆåˆ†åˆ†æ" class="headerlink" title="äºŒã€ICA(ç‹¬ç«‹æˆåˆ†åˆ†æ)"></a>äºŒã€ICA(ç‹¬ç«‹æˆåˆ†åˆ†æ)</h3><p><strong>ICAæ˜¯ä¸€ç§åˆ†ç¦»çº¿æ€§æ··åˆæºçš„æŠ€æœ¯ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æ··åˆç„¶ååˆ†å¼€ä¸¤ä¸ªæºã€‚</strong></p><p><a href="https://labeling.ucsd.edu/tutorial/labels">ICAåˆ¤æ–­ç½‘ç«™</a></p><p><a href="https://mp.weixin.qq.com/s?__biz=MzU5NjU4OTc4MA==&mid=2247485932&idx=1&sn=8749bfe4967f60de387fe7f9ba38be62&chksm=fe612457c916ad41df8ec9f2890458d86ca4ac7df44c360a4e77234e6a26115e40c957cf979a&scene=21#wechat_redirect">ç»“åˆmatlabä»£ç æ¡ˆä¾‹è§£é‡ŠICAç‹¬ç«‹æˆåˆ†åˆ†æåŸç†</a></p><h4 id="1ã€ICAå‡è®¾"><a href="#1ã€ICAå‡è®¾" class="headerlink" title="1ã€ICAå‡è®¾"></a>1ã€ICAå‡è®¾</h4><blockquote><p>åŸºäºICAçš„ä¼ªå½±æ ¡æ­£å¯ä»¥é€šè¿‡çº¿æ€§åˆ†è§£ä»EEGæ•°æ®ä¸­åˆ†ç¦»å¹¶å»é™¤å¤šç§ä¼ªå½±ã€‚ICAæ–¹æ³•åŸºäºä»¥ä¸‹å‡è®¾ï¼š</p><ul><li>1ï¼‰åœ¨å¤´çš®ä¸Šè®°å½•çš„æ—¶é—´åºåˆ—æ˜¯æ—¶é—´ä¸Šç‹¬ç«‹çš„å¤§è„‘å’Œä¼ªè¿¹æ´»åŠ¨çš„ç©ºé—´ç¨³å®šæ··åˆç‰©ï¼Œ</li><li>2ï¼‰å¹¶ä¸”å¤§è„‘ï¼Œå¤´çš®å’Œèº«ä½“ä¸åŒéƒ¨ä½äº§ç”Ÿçš„ç”µåŠ¿ä¹‹å’Œä¸ºåœ¨ç”µæä¸Šå‘ˆçº¿æ€§å…³ç³»ï¼Œ</li><li>3ï¼‰ä»æºåˆ°ç”µæçš„ä¼ æ’­å»¶è¿Ÿå¯ä»¥å¿½ç•¥ä¸è®¡</li></ul></blockquote><h4 id="2ã€ICAç‰¹æ€§"><a href="#2ã€ICAç‰¹æ€§" class="headerlink" title="2ã€ICAç‰¹æ€§"></a>2ã€ICAç‰¹æ€§</h4><blockquote><ul><li>ICAåªèƒ½åˆ†ç¦»çº¿æ€§æ··åˆçš„æºã€‚</li><li>ç”±äºICAå¤„ç†çš„æ˜¯ç‚¹äº‘ï¼Œå› æ­¤æ”¹å˜ç‚¹çš„ç»˜åˆ¶é¡ºåº(EEGä¸­çš„æ—¶é—´ç‚¹é¡ºåº)å¯¹ç®—æ³•çš„ç»“æœå‡ ä¹æ²¡æœ‰å½±å“ã€‚</li><li>æ”¹å˜é€šé“é¡ºåº(ä¾‹å¦‚åœ¨EEGä¸­äº¤æ¢ç”µæä½ç½®)ä¹Ÿä¸ä¼šå½±å“ç®—æ³•çš„ç»“æœã€‚å¯¹äºè„‘ç”µä¿¡å·æ¥è¯´ï¼Œè¯¥ç®—æ³•å¯¹ç”µæä½ç½®æ²¡æœ‰å…ˆéªŒçŸ¥è¯†ï¼ŒICAåˆ†é‡åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥è¢«è§£æä¸ºä¸€ä¸ªç­‰æ•ˆå¶æå­ï¼Œè¿™è¯æ˜äº†ICAèƒ½å¤Ÿåˆ†ç¦»å‡ºçš®å±‚åŒæ­¥åŒ–çš„è‡´å¯†åŒºåŸŸã€‚</li><li> ç”±äºç‹¬ç«‹åˆ†é‡åˆ†æé€šè¿‡æœ€å¤§åŒ–æºçš„éé«˜æ–¯æ€§æ¥åˆ†ç¦»æºï¼Œæ‰€ä»¥å®Œç¾çš„é«˜æ–¯æºæ˜¯ä¸èƒ½è¢«åˆ†ç¦»çš„ã€‚</li><li> å³ä½¿ä¿¡æ¯æºä¸æ˜¯ç‹¬ç«‹çš„ï¼Œç‹¬ç«‹åˆ†é‡åˆ†æä¹Ÿèƒ½æ‰¾åˆ°ä¸€ä¸ªæœ€å¤§ç‹¬ç«‹ç©ºé—´ã€‚</li></ul></blockquote><h3 id="ä¸‰ã€å…±ç©ºé—´æ¨¡å¼-Common-Spatial-Pattern-CSP"><a href="#ä¸‰ã€å…±ç©ºé—´æ¨¡å¼-Common-Spatial-Pattern-CSP" class="headerlink" title="ä¸‰ã€å…±ç©ºé—´æ¨¡å¼(Common Spatial Pattern, CSP)"></a>ä¸‰ã€å…±ç©ºé—´æ¨¡å¼(Common Spatial Pattern, CSP)</h3><p><a href="https://mp.weixin.qq.com/s?__biz=MzU5NjU4OTc4MA==&mid=2247486495&idx=1&sn=3bb4aa2415bf9c48947f700db3a1a69e&chksm=fe6121a4c916a8b2a585a5e3d10aa38d6e578726e77403efabfb05c14d5855a6916ad7b9e93e&scene=21#wechat_redirect">è¯¦ç»†ä»‹ç»åœ°å€</a></p><blockquote><p><code>å…±ç©ºé—´æ¨¡å¼ï¼ˆCommon Spatial Pattern, CSPï¼‰</code>æ˜¯ä¸€ç§å¯¹ä¸¤åˆ†ç±»ä»»åŠ¡ä¸‹çš„ç©ºåŸŸæ»¤æ³¢ç‰¹å¾æå–ç®—æ³•ï¼Œèƒ½å¤Ÿä»å¤šé€šé“çš„è„‘æœºæ¥å£æ•°æ®é‡Œé¢æå–å‡ºæ¯ä¸€ç±»çš„ç©ºé—´åˆ†å¸ƒæˆåˆ†ã€‚å…¬å…±ç©ºé—´æ¨¡å¼ç®—æ³•çš„åŸºæœ¬åŸç†æ˜¯åˆ©ç”¨çŸ©é˜µçš„å¯¹è§’åŒ–ï¼Œæ‰¾åˆ°ä¸€ç»„æœ€ä¼˜ç©ºé—´æ»¤æ³¢å™¨è¿›è¡ŒæŠ•å½±ï¼Œä½¿å¾—ä¸¤ç±»ä¿¡å·çš„æ–¹å·®å€¼å·®å¼‚æœ€å¤§åŒ–ï¼Œä»è€Œå¾—åˆ°å…·æœ‰è¾ƒé«˜åŒºåˆ†åº¦çš„ç‰¹å¾å‘é‡ã€‚</p></blockquote><h4 id="1ã€CSPå‘å±•å²"><a href="#1ã€CSPå‘å±•å²" class="headerlink" title="1ã€CSPå‘å±•å²"></a>1ã€CSPå‘å±•å²</h4><p><img src="https://file.buildworld.cn/img/37d37a272098ac16bee4514f24235efe_640_wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1.png" alt="å…±ç©ºé—´æ¨¡å¼ï¼ˆCSPï¼‰çš„ç ”ç©¶æ¦‚å†µ"></p><blockquote><p>ç”±äºä¸åŒç‰¹å¾çš„ä¿¡æ¯åŒ…å«åœ¨ä¿¡å·çš„ä¸åŒé¢‘æ®µä¸­ï¼Œå› æ­¤è€ƒè™‘EEGä¿¡å·ï¼Œå¯ä»¥å°†å…¶åˆ†ç¦»åˆ°ä¸åŒçš„ç‰¹å®šé¢‘æ®µè¿›è¡Œåˆ†æã€‚åœ¨å½“å‰ç ”ç©¶çš„ç‰¹å¾æå–å’Œç‰¹å¾åˆ†ç±»ç®—æ³•ä¸­ï¼Œ<code>CSP</code>æ˜¯æ€§èƒ½æœ€å¥½å’Œåº”ç”¨æœ€å¹¿æ³›çš„ç‰¹å¾æå–æ–¹æ³•ã€‚<code>CSP</code>å°†å½“å‰æ•°æ®è½¬æ¢åˆ°å¦ä¸€ä¸ªæ–°çš„ç©ºé—´ï¼Œä½¿å¾—ç±»é—´æ•°æ®çš„æ–¹å·®æœ€å¤§åŒ–ï¼Œç±»å†…çš„æ–¹å·®æœ€å°åŒ–ã€‚</p></blockquote><blockquote><p>é€šå¸¸ï¼Œåœ¨è¿åŠ¨æƒ³è±¡EEGä¿¡å·åˆ†ç±»ä¸­ï¼Œ<code>CSP</code>ç®—æ³•å¾€å¾€é€‰æ‹©å®½é¢‘æ®µï¼ˆ4-40HZï¼‰æ¥è¿›è¡Œä¿¡å·å¤„ç†ã€‚ç ”ç©¶è¡¨æ˜ï¼Œè¿™ä¸ªå®½é¢‘æ®µåŒ…å«äº†å¤§å¤šæ•°çš„è¿åŠ¨æƒ³è±¡ç›¸å…³çš„ä¿¡æ¯ï¼ŒåŒæ—¶ï¼Œä¹ŸåŒ…å«ç€å…¶ä»–å†—ä½™ä¿¡æ¯ï¼Œæ‰€ä»¥ä¸å°‘ç ”ç©¶å·¥ä½œé‡ç‚¹è€ƒè™‘è¿™ä¸ªå®½é¢‘æ®µçš„é€‰æ‹©æœ€ä½³é—®é¢˜ï¼Œä»¥æ­¤æ¥æ”¹å–„CSPçš„åˆ†ç±»æ€§èƒ½ã€‚åœ¨æå‡ºçš„<code>å…±ç©ºé—´é¢‘è°±æ¨¡å¼ï¼ˆCSSPï¼‰</code>ä¸­ï¼Œ<code>æœ‰é™è„‰å†²å“åº”ï¼ˆFIRï¼‰æ»¤æ³¢å™¨</code>åœ¨<code>CSPæ»¤æ³¢å™¨</code>çš„åŸºç¡€ä¸Šè¿›è¡Œäº†ä¼˜åŒ–ï¼Œé€šè¿‡æ’å…¥æ—¶é—´å»¶è¿ŸÏ„æ¥å®ç°ï¼Œè¯¥æ—¶é—´å»¶è¿ŸÏ„å…è®¸å•ç‹¬è°ƒè°é¢‘ç‡æ»¤æ³¢å™¨ï¼Œè¯„ä¼°è‹¥å¹²æ ·æœ¬ç‚¹çš„æ—¶é—´å»¶è¿ŸÏ„å€¼ï¼Œå¹¶ä¸”ä½¿ç”¨10å€äº¤å‰éªŒè¯æ¥é€‰æ‹©æœ€ä½³å€¼ã€‚ä½¿ç”¨å¸¦é€šæ»¤æ³¢å™¨å¯¹ä¿¡å·è¿›è¡Œæ»¤æ³¢ï¼Œç„¶åè¿›è¡Œç©ºé—´æ»¤æ³¢å’Œç‰¹å¾æå–ã€‚å®éªŒç»“æœæ˜¾ç¤ºCSSPæ”¹è¿›äº†æ€§èƒ½ã€‚æå‡ºçš„<code>å…±ç¨€ç–é¢‘è°±ç©ºé—´æ¨¡å¼ï¼ˆCSSSPï¼‰</code>è¿›ä¸€æ­¥æ”¹è¿›äº†CSSPæ–¹æ³•ï¼Œå…¶æ‰¾åˆ°æ‰€æœ‰ä¿¡é“å…±ç”¨çš„é¢‘è°±æ¨¡å¼ï¼Œè€ŒéCSSPä¸ºæ¯ä¸ªä¿¡é“æ‰¾åˆ°ä¸åŒçš„é¢‘è°±æ¨¡å¼ã€‚</p></blockquote><blockquote><p>å·²ç»æå‡ºçš„<code>å­å¸¦å…¬ç©ºé—´æ¨¡å¼ï¼ˆSBCSPï¼‰</code>ï¼Œå…¶ä¸­åœ¨å¤šä¸ªå­å¸¦å¤„å¯¹è¿åŠ¨å›¾åƒEEGä¿¡å·è¿›è¡Œæ»¤æ³¢ï¼Œå¹¶ä¸”ä»æ¯ä¸ªå­å¸¦æå–CSPç‰¹å¾ã€‚ä¸ºäº†å‡å°å­å¸¦çš„ç»´æ•°ï¼Œ<code>çº¿æ€§åˆ¤åˆ«åˆ†æï¼ˆLDAï¼‰</code>åˆ†åˆ«åº”ç”¨äºæ¯ä¸ªå­å¸¦çš„ç‰¹å¾ï¼Œå¹¶èåˆåœ¨ä¸€èµ·ä»¥è¿›è¡Œåˆ†ç±»ã€‚ SBCSPå®ç°äº†æ¯”CSPï¼ŒCSSPå’ŒCSSSPæ›´é«˜çš„åˆ†ç±»ç²¾åº¦ã€‚ç„¶è€Œï¼ŒSBCSPå¿½ç•¥äº†ä»ä¸åŒå­å¸¦è·å¾—çš„CSPç‰¹å¾çš„å¯èƒ½å…³è”ï¼Œå› æ­¤æå‡ºäº†<code>æ»¤æ³¢å™¨ç»„CSPï¼ˆFBCSPï¼‰</code>æ¥è§£å†³è¯¥é—®é¢˜ã€‚ FBCSPè®¡ç®—æ¥è‡ªå¤šä¸ªå­å¸¦çš„CSPç‰¹å¾çš„äº’ä¿¡æ¯ï¼Œä»¥ä¾¿é€‰æ‹©æœ€å…·è¾¨è¯†æ€§çš„ç‰¹å¾ï¼Œæ‰€é€‰ç‰¹å¾ä½¿ç”¨æ”¯æŒå‘é‡æœºï¼ˆSVMï¼‰åˆ†ç±»å™¨è¿›è¡Œåˆ†ç±»ã€‚ FBCSPçš„è¡¨ç°ä¼˜äºSBCSPï¼Œç„¶è€Œï¼Œå®ƒä»ç„¶ä½¿ç”¨äº†è‹¥å¹²å­å¸¦ï¼Œè¿™äº›å­å¸¦ä¾ç„¶ä¼šå¸¦æ¥ä¸å°‘çš„è®¡ç®—æˆæœ¬çš„å¢åŠ ã€‚æ‰€ä»¥æå‡º<code>DFBCSP</code>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒDFBCSPåˆ©ç”¨å•ä¿¡é“ï¼ˆC3ï¼ŒC4æˆ–Czï¼‰é¢‘å¸¦åŠŸç‡çš„Fisheræ¯”ï¼ˆFRï¼‰æ¥ä»å¤šä¸ªé‡å å­é¢‘å¸¦ä¸­é€‰æ‹©æœ€å…·åˆ¤åˆ«æ€§çš„å­é¢‘å¸¦ã€‚ç„¶åä¸ºæ¯ä¸ªå­å¸¦æå–CSPç‰¹å¾ï¼Œå¹¶ä½¿ç”¨SVMåˆ†ç±»å™¨è¿›è¡Œåˆ†ç±»ã€‚ä¸SBCSPå’ŒFBCSPç›¸æ¯”ï¼Œ<strong>DFBCSPå®ç°äº†æ›´é«˜çš„åˆ†ç±»å‡†ç¡®åº¦å’Œæ›´ä½çš„è®¡ç®—æˆæœ¬ã€‚</strong></p></blockquote><h4 id="DFBCSPæ¡†æ¶"><a href="#DFBCSPæ¡†æ¶" class="headerlink" title="DFBCSPæ¡†æ¶"></a>DFBCSPæ¡†æ¶</h4><p><img src="https://file.buildworld.cn/img/e2fc1833625a49db3fba73dec5c9f5e0_640_wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1.png" alt="DFBCSPæ¡†æ¶"></p><blockquote><p>è€ƒè™‘<code>DFBCSP</code>çš„ä¼˜åŠ£ï¼Œå› æ­¤æå‡ºäº†ä¸€ç§æ”¹è¿›çš„<code>DFBCSP</code>æ–¹æ³•æ¥è§£å†³è¿™äº›é—®é¢˜ã€‚é¦–å…ˆï¼Œä½¿ç”¨ä»ä½¿ç”¨æ‰€æœ‰é€šé“æ•°æ®ç”Ÿæˆçš„ç‰¹å¾è®¡ç®—çš„äº’ä¿¡æ¯ï¼Œè€Œä¸æ˜¯åƒåœ¨<code>DFBCSP-FR</code>ä¸­é‚£æ ·ä½¿ç”¨å•é€šé“é¢‘å¸¦åŠŸç‡çš„FRï¼Œæ¥é€‰æ‹©èƒ½å¤Ÿäº§ç”Ÿæœ€ä½³ç»“æœçš„é¢‘å¸¦ã€‚è€Œä¸ä½¿ç”¨ä»…ä½¿ç”¨å•ä¸ªä¿¡é“é¢‘å¸¦åŠŸç‡å’ŒFRä½œä¸ºé€‰æ‹©å­é¢‘å¸¦ï¼ˆ<code>DFBCSP-FR</code>ï¼‰çš„æ–¹æ³•ã€‚è¿™æ˜¯å› ä¸ºEEGä¿¡å·ä¸»è¦å—å™ªå£°æ±¡æŸ“ã€‚å› æ­¤ï¼Œå¦‚æœç”¨äºè®¡ç®—FRçš„å•ä¸ªä¿¡é“è¢«å™ªå£°ç ´åï¼Œåˆ™é€‰æ‹©å‡ºæ¥çš„é¢‘æ®µå°†ä¼šå½±å“åˆ†ç±»å™¨çš„åˆ†ç±»ç²¾åº¦ã€‚è¿™å¯¼è‡´é€‰æ‹©çš„å­å¸¦å¾€å¾€ä¸æ˜¯æœ€æœ‰æ•ˆçš„å­å¸¦ï¼Œå› ä¸ºå¯èƒ½é€‰æ‹©äº†å…·æœ‰å†—ä½™ä¿¡æ¯çš„å­å¸¦ã€‚å› æ­¤ï¼Œæ–‡ç« å»ºè®®åˆ©ç”¨æ‰€æœ‰å¯ç”¨ä¿¡é“æ•°æ®é€šè¿‡åˆ©ç”¨äº’ä¿¡æ¯æ¥é€‰æ‹©æœ€å…·åˆ¤åˆ«æ€§çš„å­å¸¦ï¼Œä»¥ä¾¿è·å¾—æœ€ä½³ç»“æœã€‚ä¸ä½¿ç”¨ç”¨äºé¢‘å¸¦é€‰æ‹©çš„å•ä¿¡é“ä¿¡æ¯ç›¸æ¯”ï¼Œä½¿ç”¨æ‰€æœ‰ä¿¡é“æ•°æ®è¿›è¡Œé¢‘å¸¦é€‰æ‹©å‡å°‘äº†é€‰æ‹©å…·æœ‰å†—ä½™ä¿¡æ¯çš„å­é¢‘å¸¦çš„æœºä¼šã€‚</p><p>å…¶æ¬¡ï¼Œæ–‡ç« ä¸å†åƒåœ¨DFBCSP-FRä¸­é‚£æ ·ä»…ä½¿ç”¨æ¥è‡ªé‡å å­å¸¦çš„CSPç‰¹å¾ï¼Œè€Œæ˜¯ç»“åˆåˆ©ç”¨å®½å¸¦CSPå’ŒCSSPçš„ç‰¹å¾ä¿¡æ¯ï¼Œæ–‡ç« å¼•å…¥äº†7-30Hzçš„å•ä¸ªå®½å¸¦ä»¥åŠåœ¨4-30HzèŒƒå›´å†…çš„12ä¸ªé‡å å­å¸¦ï¼Œå¸¦å®½ä¸º4Hzå¹¶ä¸”é‡å 2Hzã€‚</p></blockquote><p><strong>æ”¹è¿›DFBCSPç®—æ³•çš„è¯¦ç»†æµç¨‹æ¡†å›¾</strong></p><p><img src="https://file.buildworld.cn/img/604a420080a816a842b035414e8e6e6e_640_wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1.png" alt="æ”¹è¿›DFBCSPç®—æ³•çš„è¯¦ç»†æµç¨‹æ¡†å›¾"></p><h3 id="å››ã€EEGä¿¡å·ç‰¹å¾æå–ç®—æ³•-MIæ–¹å‘"><a href="#å››ã€EEGä¿¡å·ç‰¹å¾æå–ç®—æ³•-MIæ–¹å‘" class="headerlink" title="å››ã€EEGä¿¡å·ç‰¹å¾æå–ç®—æ³•(MIæ–¹å‘)"></a>å››ã€EEGä¿¡å·ç‰¹å¾æå–ç®—æ³•(MIæ–¹å‘)</h3><p><strong>EEGä¿¡å·ç‰¹å¾æå–å°±æ˜¯ä»¥è„‘ç”µä¿¡å·ä½œä¸ºæºä¿¡å·ï¼Œç¡®å®šå„ç§å‚æ•°å¹¶ä»¥æ­¤ä¸ºå‘é‡ç»„æˆè¡¨å¾ä¿¡å·ç‰¹å¾çš„ç‰¹å¾å‘é‡ã€‚</strong></p><blockquote><p>ç‰¹å¾åƒæ•°ä¸»è¦åŒ…æ‹¬<code>æ—¶åŸŸä¿¡å·(å¦‚å¹…å€¼)</code>å’Œ<code>é¢‘åŸŸä¿¡å·(å¦‚é¢‘ç‡)</code>ä¸¤å¤§ç±»ï¼Œç›¸åº”çš„ç‰¹å¾æå–æ–¹æ³•ä¹Ÿåˆ†ä¸º<code>æ—¶åŸŸæ³•</code>ã€<code>é¢‘åŸŸæ³•</code> å’Œ<code>æ—¶-é¢‘åŸŸ</code>æ–¹æ³•ã€‚</p></blockquote><h4 id="1ã€é¢‘åŸŸåˆ†æ"><a href="#1ã€é¢‘åŸŸåˆ†æ" class="headerlink" title="1ã€é¢‘åŸŸåˆ†æ"></a>1ã€é¢‘åŸŸåˆ†æ</h4><blockquote><p>é¢‘åŸŸåˆ†ææ–¹æ³•ä¸»è¦æ˜¯<strong>åŸºäºEEGä¿¡å·å„é¢‘æ®µåŠŸç‡ã€ç›¸å¹²</strong>ç­‰ã€‚</p></blockquote><blockquote><p>è¿™ç±»æ–¹æ³•æ˜¯å»ºç«‹åœ¨å‡è®¾EEGä¿¡å·å…·æœ‰å¹³ç¨³ç‰¹æ€§çš„åŸºç¡€ä¸Šï¼ŒåŒæ—¶åªæ˜¯è€ƒè™‘ä¿¡å·çš„é¢‘åŸŸä¿¡æ¯ï¼Œå¿½ç•¥ä¿¡å·åœ¨æ—¶é—´ä¸Šçš„åˆ†è¾¨ç‡ã€‚åœ¨EEGä¿¡å·ç ”ç©¶ä¸­ï¼Œå¸¸ç”¨çš„é¢‘åŸŸåˆ†ææ–¹æ³•åŒ…æ‹¬<code>åŠŸç‡è°±ä¼°è®¡</code>(<code>ç›´æ¥æ³•å’Œé—´æ¥æ³•</code>)ã€‚</p><p><strong>è¿åŠ¨æƒ³è±¡EEGä¿¡å·</strong>çš„<code>ERD</code>å’Œ<code>ERS</code>ç°è±¡åªå‡ºç°åœ¨ç‰¹å®šé¢‘ç‡èŒƒå›´ï¼Œæ¯”å¦‚<code>8-12Hz çš„Muæ³¢</code>å’Œ<code>18-26Hz çš„Beta æ³¢</code>ã€‚å› æ­¤ï¼Œé€šè¿‡åŠŸç‡è°±ç­‰è°±åˆ†ææ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æœ‰æ•ˆåœ°ä»EEGæå–ä¸­ç‰¹å¾ã€‚å…¶ä¸­æ¯”è¾ƒå‡ºåçš„æ–¹æ³•æœ‰è‡ªå›å½’åŠŸç‡è°±åˆ†æã€åŒè°±åˆ†ææ³•ç­‰ã€‚</p></blockquote><h4 id="2ã€æ—¶åŸŸåˆ†æ"><a href="#2ã€æ—¶åŸŸåˆ†æ" class="headerlink" title="2ã€æ—¶åŸŸåˆ†æ"></a>2ã€æ—¶åŸŸåˆ†æ</h4><blockquote><p>æ—¶åŸŸåˆ†ææ–¹æ³•åˆ™ä¸»è¦åˆ†æEEGï¼Œå¦‚<code>å¹…åº¦</code>ã€<code>å‡å€¼</code>ã€<code>æ–¹å·®</code>ã€<code>åæ­ªåº¦</code>ã€<code>å³­åº¦</code>ç­‰ã€‚</p></blockquote><blockquote><p>è¿™ç±»æ–¹æ³•ä¸»è¦æ˜¯åˆ©ç”¨EEGæ³¢å½¢çš„æ€§è´¨ï¼Œå¦‚æ³¢å¹…ã€å‡å€¼ã€æ–¹å·®ã€åæ­ªåº¦å’Œå³­åº¦ç­‰å¯¹ä¸´åºŠEEGè®°å½•è¿›è¡Œè§‚å¯Ÿåˆ†æã€‚åœ¨EEGä¿¡å·ç ”ç©¶ä¸­ï¼Œå¸¸ç”¨çš„æ—¶åŸŸåˆ†ææ–¹æ³•æœ‰ï¼š<code>è¿‡é›¶ç‚¹åˆ†æ</code>ã€<code>ç›´æ–¹å›¾åˆ†æ</code>ã€<code>æ–¹å·®åˆ†æ</code>ã€<code>ç›¸å…³åˆ†æ</code>ã€<code>å³°å€¼æ£€æµ‹</code>ã€<code>æ³¢å½¢å‚æ•°åˆ†æ</code>å’Œ<code>æ³¢å½¢è¯†åˆ«</code>ç­‰ã€‚</p></blockquote><h4 id="3ã€ç©ºåŸŸæ–¹æ³•ï¼š"><a href="#3ã€ç©ºåŸŸæ–¹æ³•ï¼š" class="headerlink" title="3ã€ç©ºåŸŸæ–¹æ³•ï¼š"></a>3ã€ç©ºåŸŸæ–¹æ³•ï¼š</h4><blockquote><p>è¿™æ˜¯è¿‘å¹´è¿åŠ¨æƒ³è±¡é¢†åŸŸæ¯”è¾ƒé€šç”¨çš„ç‰¹å¾æå–æ–¹æ³•ï¼Œä¸»è¦é€šè¿‡è®¾è®¡ç©ºåŸŸæ»¤æ³¢å™¨å¯¹EEG çš„å¤šé€šé“ç©ºé—´åˆ†å¸ƒè¿›è¡Œå¤„ç†ï¼Œæå–å¯åˆ†çš„ç‰¹å¾ã€‚åŒ…æ‹¬ï¼š<code>å…±ç©ºåŸŸæ¨¡å¼æ³•ï¼ˆCommon spatialpatternï¼ŒCSPï¼‰</code>ï¼Œä»¥åŠåŸºäºCSPæ”¹è¿›çš„æ–¹æ³•ã€‚</p></blockquote><p><strong>åŸºäºCSPæ”¹è¿›çš„æ–¹æ³•åŒ…æ‹¬ï¼š</strong></p><ul><li><p>1.æ—¶ç©ºæ»¤æ³¢çš„å…±ç©ºè°±æ¨¡å¼ï¼ˆCommon spatio-spectralpattern, CSSPï¼‰ï¼›</p></li><li><p>2.å…±ç¨€ç–è°±ç©ºæ¨¡å¼ï¼ˆCommon sparse spectral spatial patternï¼ŒCSSSPï¼‰ï¼›</p></li><li><p>3.æ­£åˆ™åŒ–å…¬ç”¨ç©ºé—´æ¨¡å¼ï¼ˆRegularized Common Spatial Pattern, RCSP)ç­‰ã€‚</p></li></ul><h4 id="4ã€å°æ³¢æ¨¡ç³Šç†µçš„ç‰¹å¾æå–æ–¹æ³•"><a href="#4ã€å°æ³¢æ¨¡ç³Šç†µçš„ç‰¹å¾æå–æ–¹æ³•" class="headerlink" title="4ã€å°æ³¢æ¨¡ç³Šç†µçš„ç‰¹å¾æå–æ–¹æ³•"></a>4ã€å°æ³¢æ¨¡ç³Šç†µçš„ç‰¹å¾æå–æ–¹æ³•</h4><blockquote><p>é‰´äºè„‘ç”µä¿¡å·çš„éçº¿æ€§ç‰¹æ€§å’Œè¿åŠ¨æƒ³è±¡æ—¶çš„èŠ‚å¾‹ç‰¹æ€§ï¼Œæå‡ºäº†å°æ³¢æ¨¡ç³Šç†µçš„ç‰¹å¾æå–æ–¹æ³•ï¼Œåˆ©ç”¨å°æ³¢å˜æ¢å°†EEGä¿¡å·è¿›è¡Œå°æ³¢åˆ†è§£ï¼Œå¾—åˆ°å¯¹åº”è¿åŠ¨æƒ³è±¡EEGä¿¡å·çš„alphaå’ŒbetaèŠ‚å¾‹ï¼Œç„¶åé‡‡ç”¨æ¨¡ç³Šç†µæ–¹æ³•æå–ç‰¹å¾ã€‚</p></blockquote><h4 id="5ã€å¸¸ä½¿ç”¨çš„ç‰¹å¾æå–æ–¹æ³•ï¼š"><a href="#5ã€å¸¸ä½¿ç”¨çš„ç‰¹å¾æå–æ–¹æ³•ï¼š" class="headerlink" title="5ã€å¸¸ä½¿ç”¨çš„ç‰¹å¾æå–æ–¹æ³•ï¼š"></a>5ã€å¸¸ä½¿ç”¨çš„ç‰¹å¾æå–æ–¹æ³•ï¼š</h4><ul><li>è‡ªå›å½’(auto regressive, AR)</li><li>å‚…é‡Œå¶å˜æ¢(Fourier transform,FT)</li><li>è¡¨é¢æ‹‰æ™®æ‹‰æ–¯(surface-Laplacian)å˜æ¢</li><li>å°æ³¢å˜æ¢(Wavelet transform,WT)</li></ul><p><strong>å¿«é€Ÿå‚…é‡Œå¶å˜æ¢(Fast Fourier transform, FFT)</strong></p><blockquote><p>ç»å…¸çš„FFTåœ¨åˆ†æç¡®å®šä¿¡å·å’Œå¹³ç¨³ä¿¡å·æ—¶å¾ˆæœ‰æ•ˆï¼Œä½†åœ¨åˆ†æçªå˜ä¿¡å·çš„é¢‘è°±æ—¶å…·æœ‰ä¸€å®šçš„å±€é™æ€§ã€‚å¯¹äºalphaæ³¢ã€betaæ³¢ç­‰è„‘ç”µåŸºæœ¬èŠ‚å¾‹ï¼ŒåŠŸç‡è°±åˆ†ææˆ–FFTç­‰æ–¹æ³•å¯ä»¥ä»é¢‘åŸŸä¸­ç›´æ¥æå–å‡ºç‰¹å¾ã€‚</p></blockquote><p><strong>ç¨€ç–å‚…é‡Œå¶å˜æ¢(Sparse Fourier transform, SFT)</strong></p><blockquote><p>SFTæ˜¯æ—¶é—´çª—å†…ä¿¡å·ç‰¹å¾çš„å¹³å‡ï¼Œæ—¶é—´çª—é‡Œä¿¡å·è¶ŠçŸ­ï¼Œè·å¾—çš„æ—¶é—´åˆ†è¾¨ç‡å°±è¶Šé«˜ã€‚è¯¥æ–¹æ³•åœ¨ä¸€å®šç¨‹åº¦ä¸Šå…‹æœäº†FFTä¸å…·æœ‰çš„å±€éƒ¨åˆ†æèƒ½åŠ›çš„ç¼ºé™·ï¼Œåœ¨æŸäº›ä¿¡å·å¤„ç†ä¸­æœ‰ä¸€å®šçš„ä½œç”¨ã€‚</p></blockquote><p><strong>è‡ªé€‚åº”è‡ªå›å½’(Adaptive Auto Regressive ,AAR)</strong></p><blockquote><p>AARæ¨¡å‹å‚æ•°æ–¹æ³•éšæ¯ä¸€æ ·æœ¬ç‚¹çš„è¾“å…¥è€Œæ”¹å˜ï¼Œèƒ½å¤Ÿå¾ˆå¥½åœ°åæ˜ å¤§è„‘çš„çŠ¶æ€ã€‚ä¸è¿‡ï¼Œè¯¥æ–¹æ³•æ›´é€‚åˆåˆ†æå¹³ç¨³çš„è„‘ç”µä¿¡å·ï¼Œå¯¹åŒ…å«é«˜åº¦éå¹³ç¨³ä¿¡å·çš„è¿åŠ¨æƒ³è±¡EEGï¼Œè¯¥æ¨¡å‹æ˜¯æœ‰å±€é™æ€§çš„ã€‚</p></blockquote><p><strong>å°æ³¢å˜æ¢(Wavelettransform, WT)</strong></p><blockquote><p>å°æ³¢å˜æ¢åœ¨ä½é¢‘æ—¶çš„æ—¶é—´åˆ†è¾¨ç‡è¾ƒä½ï¼Œè€Œé¢‘ç‡åˆ†è¾¨ç‡è¾ƒé«˜ï¼›åœ¨é«˜é¢‘æ—¶çš„æ—¶é—´åˆ†è¾¨ç‡è¾ƒé«˜ï¼Œè€Œé¢‘ç‡åˆ†è¾¨ç‡è¾ƒä½ï¼Œæ­£ç¬¦åˆä½é¢‘ä¿¡å·å˜åŒ–ç·©æ…¢è€Œé«˜é¢‘ä¿¡å·å˜åŒ–è¾ƒå¿«çš„ç‰¹ç‚¹ã€‚å› æ­¤å°æ³¢åˆ†ææ¯”å‚…é‡Œå¶å˜æ¢å’ŒçŸ­æ—¶å‚…é‡Œå¶å˜æ¢æ›´é€‚åˆåˆ†æéå¹³ç¨³çš„è„‘ç”µä¿¡å·ã€‚</p></blockquote><p>æˆ‘çš„åšå®¢å³å°†åŒæ­¥è‡³è…¾è®¯äº‘+ç¤¾åŒºï¼Œé‚€è¯·å¤§å®¶ä¸€åŒå…¥é©»ï¼š<a href="https://cloud.tencent.com/developer/support-plan?invite_code=2zy5g5eac5kwc">https://cloud.tencent.com/developer/support-plan?invite_code=2zy5g5eac5kwc</a></p>]]></content>
    
    
    <summary type="html">è„‘ç”µæ³¢ï¼ˆElectroencephalogram,EEGï¼‰æ˜¯ä¸€ç§ä½¿ç”¨ç”µç”Ÿç†æŒ‡æ ‡è®°å½•å¤§è„‘æ´»åŠ¨çš„æ–¹æ³•ï¼Œå¤§è„‘åœ¨æ´»åŠ¨æ—¶ï¼Œå¤§é‡ç¥ç»å…ƒåŒæ­¥å‘ç”Ÿçš„çªè§¦åç”µä½ç»æ€»å’Œåå½¢æˆçš„ã€‚å®ƒè®°å½•å¤§è„‘æ´»åŠ¨æ—¶çš„ç”µæ³¢å˜åŒ–ï¼Œæ˜¯è„‘ç¥ç»ç»†èƒçš„ç”µç”Ÿç†æ´»åŠ¨åœ¨å¤§è„‘çš®å±‚æˆ–å¤´çš®è¡¨é¢çš„æ€»ä½“åæ˜ ã€‚è„‘æœºæ¥å£ï¼ˆBCIï¼‰ï¼Œæ˜¯ä¸€ç§é€šè¿‡æ£€æµ‹ä¸­æ¢ç¥ç»ç³»ç»Ÿæ´»åŠ¨å¹¶å°†å…¶è½¬åŒ–ä¸ºäººå·¥è¾“å‡ºï¼Œæ¥æ›¿ä»£ã€ä¿®å¤ã€å¢å¼ºã€è¡¥å……æˆ–è€…æ”¹å–„ä¸­æ¢ç¥ç»ç³»ç»Ÿçš„æ­£å¸¸è¾“å‡ºï¼Œä»è€Œæ”¹å˜ä¸­æ¢ç¥ç»ç³»ç»Ÿä¸å†…å¤–ç¯å¢ƒä¹‹é—´çš„äº¤äº’ä½œç”¨çš„æŠ€æœ¯ã€‚</summary>
    
    
    
    <category term="è„‘æœºäº¤äº’" scheme="https://www.buildworld.cn/categories/%E8%84%91%E6%9C%BA%E4%BA%A4%E4%BA%92/"/>
    
    
    <category term="BCI" scheme="https://www.buildworld.cn/tags/BCI/"/>
    
    <category term="EEG" scheme="https://www.buildworld.cn/tags/EEG/"/>
    
    <category term="ICA" scheme="https://www.buildworld.cn/tags/ICA/"/>
    
  </entry>
  
  <entry>
    <title>BigData-æ¶ˆæ¯é˜Ÿåˆ—æ¡†æ¶Apache Kafkaå…¥é—¨ã€åŸç†è§£æ</title>
    <link href="https://www.buildworld.cn/2020/07/02/BigData-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E6%A1%86%E6%9E%B6Apache-Kafka/"/>
    <id>https://www.buildworld.cn/2020/07/02/BigData-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E6%A1%86%E6%9E%B6Apache-Kafka/</id>
    <published>2020-07-02T07:11:20.000Z</published>
    <updated>2020-09-07T03:11:57.878Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Kafkaâ€“æ¶ˆæ¯é˜Ÿåˆ—æ¡†æ¶"><a href="#Kafkaâ€“æ¶ˆæ¯é˜Ÿåˆ—æ¡†æ¶" class="headerlink" title="Kafkaâ€“æ¶ˆæ¯é˜Ÿåˆ—æ¡†æ¶"></a>Kafkaâ€“æ¶ˆæ¯é˜Ÿåˆ—æ¡†æ¶</h2><h3 id="1ã€Kafka-åŸºç¡€æ¶æ„"><a href="#1ã€Kafka-åŸºç¡€æ¶æ„" class="headerlink" title="1ã€Kafka åŸºç¡€æ¶æ„"></a>1ã€<strong>Kafka</strong> åŸºç¡€æ¶æ„</h3><p><img src="https://file.buildworld.cn/img/20200907111151.png"></p><blockquote><p>1ï¼‰<strong>Producer</strong> ï¼šæ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå°±æ˜¯å‘kafka brokerå‘æ¶ˆæ¯çš„å®¢æˆ·ç«¯ï¼›<br>2ï¼‰<strong>Consumer</strong> ï¼šæ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œå‘kafka brokerå–æ¶ˆæ¯çš„å®¢æˆ·ç«¯ï¼›<br>3ï¼‰<strong>Consumer Group ï¼ˆCGï¼‰</strong>ï¼šæ¶ˆè´¹è€…ç»„ï¼Œç”±å¤šä¸ªconsumerç»„æˆã€‚<code>æ¶ˆè´¹è€…ç»„å†…æ¯ä¸ªæ¶ˆè´¹è€…è´Ÿè´£æ¶ˆè´¹ä¸åŒåˆ†åŒºçš„æ•°æ®ï¼Œä¸€ä¸ªåˆ†åŒºåªèƒ½ç”±ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼›æ¶ˆè´¹è€…ç»„ä¹‹é—´äº’ä¸å½±å“ã€‚</code>æ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½å±äºæŸä¸ªæ¶ˆè´¹è€…ç»„ï¼Œå³æ¶ˆè´¹è€…ç»„æ˜¯é€»è¾‘ä¸Šçš„ä¸€ä¸ªè®¢é˜…è€…ã€‚<br>4ï¼‰<strong>Broker ï¼š</strong>ä¸€å°kafkaæœåŠ¡å™¨å°±æ˜¯ä¸€ä¸ªbrokerã€‚ä¸€ä¸ªé›†ç¾¤ç”±å¤šä¸ªbrokerç»„æˆã€‚ä¸€ä¸ªbrokerå¯ä»¥å®¹çº³å¤šä¸ªtopicã€‚<br>5ï¼‰<strong>Topic</strong> ï¼šå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªé˜Ÿåˆ—ï¼Œ<code>ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é¢å‘çš„éƒ½æ˜¯ä¸€ä¸ªtopic</code>ï¼›<br>6ï¼‰<strong>Partition</strong>ï¼šä¸ºäº†å®ç°æ‰©å±•æ€§ï¼Œä¸€ä¸ªéå¸¸å¤§çš„topicå¯ä»¥åˆ†å¸ƒåˆ°å¤šä¸ªbrokerï¼ˆå³æœåŠ¡å™¨ï¼‰ä¸Šï¼Œ<strong>ä¸€ä¸ªtopicå¯ä»¥åˆ†ä¸ºå¤šä¸ªpartition</strong>ï¼Œæ¯ä¸ªpartitionæ˜¯ä¸€ä¸ªæœ‰åºçš„é˜Ÿåˆ—ï¼›<br>7ï¼‰<strong>Replica</strong>ï¼šå‰¯æœ¬ï¼Œä¸ºä¿è¯é›†ç¾¤ä¸­çš„æŸä¸ªèŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œ<strong>è¯¥èŠ‚ç‚¹ä¸Šçš„partitionæ•°æ®ä¸ä¸¢å¤±ï¼Œä¸”kafkaä»ç„¶èƒ½å¤Ÿç»§ç»­å·¥ä½œ</strong>ï¼Œkafkaæä¾›äº†å‰¯æœ¬æœºåˆ¶ï¼Œä¸€ä¸ªtopicçš„æ¯ä¸ªåˆ†åŒºéƒ½æœ‰è‹¥å¹²ä¸ªå‰¯æœ¬ï¼Œä¸€ä¸ªleaderå’Œè‹¥å¹²ä¸ªfollowerã€‚<br>8ï¼‰<strong>leader</strong>ï¼šæ¯ä¸ªåˆ†åŒºå¤šä¸ªå‰¯æœ¬çš„â€œä¸»â€ï¼Œç”Ÿäº§è€…å‘é€æ•°æ®çš„å¯¹è±¡ï¼Œä»¥åŠæ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®çš„å¯¹è±¡éƒ½æ˜¯leaderã€‚<br>9ï¼‰<strong>follower</strong>ï¼šæ¯ä¸ªåˆ†åŒºå¤šä¸ªå‰¯æœ¬ä¸­çš„â€œä»â€ï¼Œå®æ—¶ä»leaderä¸­åŒæ­¥æ•°æ®ï¼Œä¿æŒå’Œleaderæ•°æ®çš„åŒæ­¥ã€‚leaderå‘ç”Ÿæ•…éšœæ—¶ï¼ŒæŸä¸ªfollowerä¼šæˆä¸ºæ–°çš„followerã€‚</p></blockquote><h3 id="2ã€-Kafka-å‘½ä»¤è¡Œæ“ä½œ"><a href="#2ã€-Kafka-å‘½ä»¤è¡Œæ“ä½œ" class="headerlink" title="2ã€ Kafka å‘½ä»¤è¡Œæ“ä½œ"></a>2ã€ <strong>Kafka</strong> å‘½ä»¤è¡Œæ“ä½œ</h3><h4 id="0ï¼‰å¯åŠ¨kafka"><a href="#0ï¼‰å¯åŠ¨kafka" class="headerlink" title="0ï¼‰å¯åŠ¨kafka"></a>0ï¼‰å¯åŠ¨kafka</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop102 kafka]$ /opt/module/kafka/bin/kafka-server-start.sh -daemon /opt/module/kafka/config/server.properties</span><br></pre></td></tr></table></figure><h4 id="1ï¼‰æŸ¥çœ‹æ‰€æœ‰çš„topic"><a href="#1ï¼‰æŸ¥çœ‹æ‰€æœ‰çš„topic" class="headerlink" title="1ï¼‰æŸ¥çœ‹æ‰€æœ‰çš„topic"></a>1ï¼‰æŸ¥çœ‹æ‰€æœ‰çš„topic</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop102 bin]$ kafka-topics.sh --list --zookeeper hadoop102:2181</span><br></pre></td></tr></table></figure><h4 id="2ï¼‰åˆ›å»ºtopic"><a href="#2ï¼‰åˆ›å»ºtopic" class="headerlink" title="2ï¼‰åˆ›å»ºtopic"></a>2ï¼‰åˆ›å»ºtopic</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop102 kafka]$ bin/kafka-topics.sh --zookeeper hadoop102:2181 --create --replication-factor 3 --partitions 1 --topic first</span><br></pre></td></tr></table></figure><blockquote><p>é€‰é¡¹è¯´æ˜ï¼š</p><p><code>--topic</code> å®šä¹‰topicå</p><p><code>--replication-factor</code>  å®šä¹‰å‰¯æœ¬æ•°</p><p><code>--partitions</code>  å®šä¹‰åˆ†åŒºæ•°</p></blockquote><h4 id="3ï¼‰åˆ é™¤"><a href="#3ï¼‰åˆ é™¤" class="headerlink" title="3ï¼‰åˆ é™¤"></a>3ï¼‰åˆ é™¤</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop102 kafka]$ bin/kafka-topics.sh --zookeeper hadoop102:2181 --delete --topic first</span><br></pre></td></tr></table></figure><p><strong>éœ€è¦server.propertiesä¸­è®¾ç½®delete.topic.enable=trueå¦åˆ™åªæ˜¯æ ‡è®°åˆ é™¤ã€‚</strong></p><h4 id="4ï¼‰å‘é€æ¶ˆæ¯"><a href="#4ï¼‰å‘é€æ¶ˆæ¯" class="headerlink" title="4ï¼‰å‘é€æ¶ˆæ¯"></a>4ï¼‰å‘é€æ¶ˆæ¯</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop102 bin]$ kafka-console-producer.sh --broker-list hadoop102:9092 --topic first</span><br></pre></td></tr></table></figure><h4 id="5ï¼‰æ¶ˆè´¹æ¶ˆæ¯"><a href="#5ï¼‰æ¶ˆè´¹æ¶ˆæ¯" class="headerlink" title="5ï¼‰æ¶ˆè´¹æ¶ˆæ¯"></a>5ï¼‰æ¶ˆè´¹æ¶ˆæ¯</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop103 kafka]$ kafka-console-consumer.sh --bootstrap-server hadoop102:9092 --from-beginning --topic first</span><br></pre></td></tr></table></figure><p><strong>--from-beginningï¼šä¼šæŠŠä¸»é¢˜ä¸­ä»¥å¾€æ‰€æœ‰çš„æ•°æ®éƒ½è¯»å–å‡ºæ¥ã€‚</strong></p><h4 id="6ï¼‰æŸ¥çœ‹æŸä¸ªtopicè¯¦æƒ…"><a href="#6ï¼‰æŸ¥çœ‹æŸä¸ªtopicè¯¦æƒ…" class="headerlink" title="6ï¼‰æŸ¥çœ‹æŸä¸ªtopicè¯¦æƒ…"></a>6ï¼‰æŸ¥çœ‹æŸä¸ªtopicè¯¦æƒ…</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop104 kafka]$ kafka-topics.sh --describe --topic first --zookeeper hadoop102:2181</span><br></pre></td></tr></table></figure><h4 id="7ï¼‰ä¿®æ”¹åˆ†åŒº"><a href="#7ï¼‰ä¿®æ”¹åˆ†åŒº" class="headerlink" title="7ï¼‰ä¿®æ”¹åˆ†åŒº"></a>7ï¼‰ä¿®æ”¹åˆ†åŒº</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop104 kafka]$ kafka-topics.sh --alter --topic first --zookeeper hadoop102:2181 --partitions 6</span><br></pre></td></tr></table></figure><h3 id="3ã€Kafka-å·¥ä½œæµç¨‹"><a href="#3ã€Kafka-å·¥ä½œæµç¨‹" class="headerlink" title="3ã€Kafka å·¥ä½œæµç¨‹"></a>3ã€<strong>Kafka</strong> å·¥ä½œæµç¨‹</h3><p><img src="https://file.buildworld.cn/img/20200702172047.png"></p><blockquote><p><code>Kafka</code>ä¸­æ¶ˆæ¯æ˜¯ä»¥<code>topic</code>è¿›è¡Œåˆ†ç±»çš„ï¼Œç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯ï¼Œéƒ½æ˜¯é¢å‘<code>topic</code>çš„ã€‚</p><p><code>topic</code>æ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œè€Œ<code>partition</code>æ˜¯ç‰©ç†ä¸Šçš„æ¦‚å¿µï¼Œæ¯ä¸ª<code>partition</code>å¯¹åº”äºä¸€ä¸ª<code>log</code>æ–‡ä»¶ï¼Œè¯¥<code>log</code>æ–‡ä»¶ä¸­å­˜å‚¨çš„å°±æ˜¯<code>producer</code>ç”Ÿäº§çš„æ•°æ®ã€‚<code>Producer</code>ç”Ÿäº§çš„æ•°æ®ä¼šè¢«ä¸æ–­è¿½åŠ åˆ°è¯¥<code>log</code>æ–‡ä»¶æœ«ç«¯ï¼Œä¸”æ¯æ¡æ•°æ®éƒ½æœ‰è‡ªå·±çš„<code>offset</code>ã€‚æ¶ˆè´¹è€…ç»„ä¸­çš„æ¯ä¸ªæ¶ˆè´¹è€…ï¼Œéƒ½ä¼šå®æ—¶è®°å½•è‡ªå·±æ¶ˆè´¹åˆ°äº†å“ªä¸ª<code>offset</code>ï¼Œä»¥ä¾¿å‡ºé”™æ¢å¤æ—¶ï¼Œä»ä¸Šæ¬¡çš„ä½ç½®ç»§ç»­æ¶ˆè´¹ã€‚</p></blockquote><h3 id="4ã€Kafkaæ–‡ä»¶å­˜å‚¨æœºåˆ¶"><a href="#4ã€Kafkaæ–‡ä»¶å­˜å‚¨æœºåˆ¶" class="headerlink" title="4ã€Kafkaæ–‡ä»¶å­˜å‚¨æœºåˆ¶"></a>4ã€Kafkaæ–‡ä»¶å­˜å‚¨æœºåˆ¶</h3><p><img src="https://file.buildworld.cn/img/20200702193119.png"></p><blockquote><p>ç”±äºç”Ÿäº§è€…ç”Ÿäº§çš„æ¶ˆæ¯ä¼šä¸æ–­è¿½åŠ åˆ°logæ–‡ä»¶æœ«å°¾ï¼Œä¸ºé˜²æ­¢logæ–‡ä»¶è¿‡å¤§å¯¼è‡´æ•°æ®å®šä½æ•ˆç‡ä½ä¸‹ï¼ŒKafkaé‡‡å–äº†<strong>åˆ†ç‰‡å’Œç´¢å¼•</strong>æœºåˆ¶ï¼Œå°†æ¯ä¸ª<code>partition</code>åˆ†ä¸ºå¤šä¸ª<code>segment</code>ã€‚æ¯ä¸ª<code>segment</code>å¯¹åº”ä¸¤ä¸ªæ–‡ä»¶â€”â€”â€œ<code>.index</code>â€æ–‡ä»¶å’Œâ€œ<code>.log</code>â€æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶ä½äºä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œè¯¥æ–‡ä»¶å¤¹çš„å‘½åè§„åˆ™ä¸ºï¼š<code>topicåç§°+åˆ†åŒºåºå·</code>ã€‚ä¾‹å¦‚ï¼Œfirstè¿™ä¸ªtopicæœ‰ä¸‰ä¸ªåˆ†åŒºï¼Œåˆ™å…¶å¯¹åº”çš„æ–‡ä»¶å¤¹ä¸ºfirst-0,first-1,first-2ã€‚</p></blockquote><h3 id="5ã€Kafka-ç”Ÿäº§è€…"><a href="#5ã€Kafka-ç”Ÿäº§è€…" class="headerlink" title="5ã€Kafka ç”Ÿäº§è€…"></a>5ã€Kafka ç”Ÿäº§è€…</h3><h4 id="1ï¼‰åˆ†åŒºåŸå› ï¼š"><a href="#1ï¼‰åˆ†åŒºåŸå› ï¼š" class="headerlink" title="1ï¼‰åˆ†åŒºåŸå› ï¼š"></a>1ï¼‰åˆ†åŒºåŸå› ï¼š</h4><ul><li>ï¼ˆ1ï¼‰ <strong>æ–¹ä¾¿åœ¨é›†ç¾¤ä¸­æ‰©å±•</strong>ï¼Œæ¯ä¸ª Partition å¯ä»¥é€šè¿‡è°ƒæ•´ä»¥é€‚åº”å®ƒæ‰€åœ¨çš„æœºå™¨ï¼Œè€Œä¸€ä¸ª topicåˆå¯ä»¥æœ‰å¤šä¸ª Partition ç»„æˆï¼Œå› æ­¤æ•´ä¸ªé›†ç¾¤å°±å¯ä»¥é€‚åº”ä»»æ„å¤§å°çš„æ•°æ®äº†ï¼›</li><li>ï¼ˆ2ï¼‰ <strong>å¯ä»¥æé«˜å¹¶å‘</strong>ï¼Œå› ä¸ºå¯ä»¥ä»¥ Partition ä¸ºå•ä½è¯»å†™äº†ã€‚</li></ul><h4 id="2ï¼‰æ•°æ®å¯é ä¿è¯"><a href="#2ï¼‰æ•°æ®å¯é ä¿è¯" class="headerlink" title="2ï¼‰æ•°æ®å¯é ä¿è¯"></a>2ï¼‰æ•°æ®å¯é ä¿è¯</h4><p><img src="https://file.buildworld.cn/img/20200703102441.png"></p><h5 id="ï¼ˆ1ï¼‰ack"><a href="#ï¼ˆ1ï¼‰ack" class="headerlink" title="ï¼ˆ1ï¼‰ack"></a>ï¼ˆ1ï¼‰ack</h5><blockquote><p>Topicçš„æ¯ä¸ªpartitionæ”¶åˆ°producerå‘é€çš„æ•°æ®åï¼Œ  éƒ½éœ€è¦å‘producerå‘é€<code>ack</code>ï¼ˆ<code>acknowledgement</code> ç¡®è®¤æ”¶åˆ°ï¼‰ï¼Œå¦‚æœproducer æ”¶åˆ° ackï¼Œå°±ä¼šè¿›è¡Œä¸‹ä¸€è½®çš„å‘é€ï¼Œå¦åˆ™é‡æ–°å‘é€æ•°æ®ã€‚</p></blockquote><h5 id="ï¼ˆ2ï¼‰in-sync-replica-set-ISR"><a href="#ï¼ˆ2ï¼‰in-sync-replica-set-ISR" class="headerlink" title="ï¼ˆ2ï¼‰in-sync replica set (ISR)"></a>ï¼ˆ2ï¼‰in-sync replica set (ISR)</h5><blockquote><p>Leader ç»´æŠ¤äº†ä¸€ä¸ªåŠ¨æ€çš„ <code>in-sync replica set (ISR)</code>ï¼Œæ„ä¸ºå’Œ leader ä¿æŒåŒæ­¥çš„ follower é›†åˆã€‚å½“ ISR ä¸­çš„ follower å®Œæˆæ•°æ®çš„åŒæ­¥ä¹‹åï¼Œleader å°±ä¼šç»™ follower å‘é€ ackã€‚å¦‚æœfolloweré•¿ æ—¶ é—´ æœª å‘ leader åŒ æ­¥ æ•° æ® ï¼Œ åˆ™ è¯¥ follower å°† è¢« è¸¢ å‡º ISR ï¼Œ è¯¥ æ—¶ é—´ é˜ˆ å€¼ ç”±<code>replica.lag.time.max.ms</code> å‚æ•°è®¾å®šã€‚Leader å‘ç”Ÿæ•…éšœä¹‹åï¼Œå°±ä¼šä» ISR ä¸­é€‰ä¸¾æ–°çš„ leaderã€‚</p></blockquote><p><strong>ackå…³ç³»æ•°æ®ä¸¢ä¸ä¸¢å¤±çš„é—®é¢˜ï¼ŒISRå…³ç³»æ•°æ®ä¸€è‡´æ€§å’Œå­˜å‚¨é—®é¢˜</strong></p><h3 id="6ã€Kafkaæ¶ˆè´¹è€…"><a href="#6ã€Kafkaæ¶ˆè´¹è€…" class="headerlink" title="6ã€Kafkaæ¶ˆè´¹è€…"></a>6ã€Kafkaæ¶ˆè´¹è€…</h3><h4 id="1ï¼‰æ¶ˆè´¹æ–¹å¼"><a href="#1ï¼‰æ¶ˆè´¹æ–¹å¼" class="headerlink" title="1ï¼‰æ¶ˆè´¹æ–¹å¼"></a>1ï¼‰æ¶ˆè´¹æ–¹å¼</h4><blockquote><p>æ¶ˆè´¹è€…é‡‡ç”¨<code>pullï¼ˆæ‹‰ï¼‰</code>æ¨¡å¼ä»brokerä¸­è¯»å–æ•°æ®ã€‚</p><p><code>pushï¼ˆæ¨ï¼‰</code>æ¨¡å¼éš¾ä»¥é€‚åº”æ¶ˆè´¹é€Ÿç‡ä¸åŒçš„æ¶ˆè´¹è€…ï¼</p><p>å¦‚æœkafkaæ²¡æœ‰æ•°æ®ï¼Œæ¶ˆè´¹è€…å¯èƒ½é™·å…¥åˆ°å¾ªç¯ä¸­ï¼Œä¸€ç›´è¿”å›ç©ºæ•°æ®ã€‚</p></blockquote><h4 id="2ï¼‰åˆ†é…ç­–ç•¥"><a href="#2ï¼‰åˆ†é…ç­–ç•¥" class="headerlink" title="2ï¼‰åˆ†é…ç­–ç•¥"></a>2ï¼‰åˆ†é…ç­–ç•¥</h4><ul><li>RoundRobin</li><li>Rangeï¼ˆé»˜è®¤çš„ï¼‰</li></ul><h4 id="3ï¼‰offset"><a href="#3ï¼‰offset" class="headerlink" title="3ï¼‰offset"></a>3ï¼‰offset</h4><blockquote><p>ä¸‹å›¾æ˜¯è®°å½•åœ¨zookeeperä¸­çš„æ•°æ®ç»“æ„</p></blockquote><p><img src="https://file.buildworld.cn/img/20200703152929.png"></p><h3 id="7ã€kafkaäº‹åŠ¡"><a href="#7ã€kafkaäº‹åŠ¡" class="headerlink" title="7ã€kafkaäº‹åŠ¡"></a>7ã€kafkaäº‹åŠ¡</h3><h4 id="1ï¼‰Producer-äº‹åŠ¡"><a href="#1ï¼‰Producer-äº‹åŠ¡" class="headerlink" title="1ï¼‰Producer  äº‹åŠ¡"></a>1ï¼‰Producer  äº‹åŠ¡</h4><blockquote><p>ä¸ºäº†å®ç°è·¨åˆ†åŒºè·¨ä¼šè¯çš„äº‹åŠ¡ï¼Œéœ€è¦å¼•å…¥ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ <strong>Transaction IDï¼ˆå®¢æˆ·ç«¯ç»™äºˆçš„ï¼‰</strong>ï¼Œå¹¶å°† <code>Producer</code>è·å¾—çš„<code>PID</code>å’Œ<code>Transaction ID</code>ç»‘å®šã€‚è¿™æ ·å½“Produceré‡å¯åå°±å¯ä»¥é€šè¿‡æ­£åœ¨è¿›è¡Œçš„TransactionID è·å¾—åŸæ¥çš„ PIDã€‚</p><p>ä¸ºäº†ç®¡ç† Transactionï¼ŒKafka å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ç»„ä»¶ <code>Transaction Coordinator</code>ã€‚Producer å°±æ˜¯é€šè¿‡å’Œ Transaction Coordinator äº¤äº’è·å¾— Transaction ID å¯¹åº”çš„ä»»åŠ¡çŠ¶æ€ã€‚TransactionCoordinator è¿˜è´Ÿè´£å°†äº‹åŠ¡æ‰€æœ‰å†™å…¥ Kafka çš„ä¸€ä¸ªå†…éƒ¨ Topicï¼Œè¿™æ ·å³ä½¿æ•´ä¸ªæœåŠ¡é‡å¯ï¼Œç”±äºäº‹åŠ¡çŠ¶æ€å¾—åˆ°ä¿å­˜ï¼Œè¿›è¡Œä¸­çš„äº‹åŠ¡çŠ¶æ€å¯ä»¥å¾—åˆ°æ¢å¤ï¼Œä»è€Œç»§ç»­è¿›è¡Œã€‚</p></blockquote><h4 id="2ï¼‰Consumer"><a href="#2ï¼‰Consumer" class="headerlink" title="2ï¼‰Consumer"></a>2ï¼‰Consumer</h4><blockquote><p>ç”±äº <code>Consumer</code> å¯ä»¥é€šè¿‡ <code>offset</code> è®¿é—®ä»»æ„ä¿¡æ¯ï¼Œè€Œä¸”ä¸åŒçš„ <code>Segment File</code> ç”Ÿå‘½å‘¨æœŸä¸åŒï¼ŒåŒä¸€äº‹åŠ¡çš„æ¶ˆæ¯å¯èƒ½ä¼šå‡ºç°é‡å¯åè¢«åˆ é™¤çš„æƒ…å†µã€‚</p></blockquote>]]></content>
    
    
    <summary type="html">Kafkaæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„åŸºäºå‘å¸ƒ/è®¢é˜…æ¨¡å¼çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¸»è¦åº”ç”¨äºå¤§æ•°æ®å®æ—¶å¤„ç†é¢†åŸŸã€‚</summary>
    
    
    
    <category term="BigData" scheme="https://www.buildworld.cn/categories/BigData/"/>
    
    
    <category term="Hadoop" scheme="https://www.buildworld.cn/tags/Hadoop/"/>
    
    <category term="Apache" scheme="https://www.buildworld.cn/tags/Apache/"/>
    
    <category term="Kafka" scheme="https://www.buildworld.cn/tags/Kafka/"/>
    
  </entry>
  
  <entry>
    <title>BigData--Apache Flumeæ¡†æ¶</title>
    <link href="https://www.buildworld.cn/2020/07/01/BigData-Flume%E6%A1%86%E6%9E%B6/"/>
    <id>https://www.buildworld.cn/2020/07/01/BigData-Flume%E6%A1%86%E6%9E%B6/</id>
    <published>2020-07-01T09:22:48.000Z</published>
    <updated>2020-07-03T08:40:08.920Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Flumeè¿›é˜¶"><a href="#Flumeè¿›é˜¶" class="headerlink" title="Flumeè¿›é˜¶"></a>Flumeè¿›é˜¶</h2><h3 id="1ã€FlumeåŸºæœ¬æ¡†æ¶"><a href="#1ã€FlumeåŸºæœ¬æ¡†æ¶" class="headerlink" title="1ã€FlumeåŸºæœ¬æ¡†æ¶"></a>1ã€FlumeåŸºæœ¬æ¡†æ¶</h3><p><img src="https://file.buildworld.cn/img/20200701104704.png"></p><p><strong>1. Event</strong></p><p><code>Event</code> æ˜¯ Flume NG æ•°æ®ä¼ è¾“çš„åŸºæœ¬å•å…ƒã€‚ç±»ä¼¼äº JMS å’Œæ¶ˆæ¯ç³»ç»Ÿä¸­çš„æ¶ˆæ¯ã€‚ä¸€ä¸ª Event ç”±æ ‡é¢˜å’Œæ­£æ–‡ç»„æˆï¼šå‰è€…æ˜¯é”®/å€¼æ˜ å°„ï¼Œåè€…æ˜¯ä»»æ„å­—èŠ‚æ•°ç»„ã€‚</p><p><strong>2. Source</strong></p><p>æ•°æ®æ”¶é›†ç»„ä»¶ï¼Œä»å¤–éƒ¨æ•°æ®æºæ”¶é›†æ•°æ®ï¼Œå¹¶å­˜å‚¨åˆ° Channel ä¸­ã€‚</p><p><strong>Sourceç±»å‹</strong></p><ul><li>ï¼ˆ1ï¼‰ç›‘æ§åå°æ—¥å¿—ï¼šexec</li><li>ï¼ˆ2ï¼‰ç›‘æ§åå°äº§ç”Ÿæ—¥å¿—çš„ç«¯å£ï¼šnetcat</li></ul><p><strong>3. Channel</strong></p><p><code>Channel</code> æ˜¯æºå’Œæ¥æ”¶å™¨ä¹‹é—´çš„ç®¡é“ï¼Œç”¨äºä¸´æ—¶å­˜å‚¨æ•°æ®ã€‚å¯ä»¥æ˜¯å†…å­˜æˆ–æŒä¹…åŒ–çš„æ–‡ä»¶ç³»ç»Ÿï¼š</p><ul><li><code>Memory Channel</code> : ä½¿ç”¨å†…å­˜ï¼Œä¼˜ç‚¹æ˜¯é€Ÿåº¦å¿«ï¼Œä½†æ•°æ®å¯èƒ½ä¼šä¸¢å¤± (å¦‚çªç„¶å®•æœº)ï¼›</li><li><code>File Channel</code> : ä½¿ç”¨æŒä¹…åŒ–çš„æ–‡ä»¶ç³»ç»Ÿï¼Œä¼˜ç‚¹æ˜¯èƒ½ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œä½†æ˜¯é€Ÿåº¦æ…¢ã€‚</li></ul><p><strong>4. Sink</strong></p><p><code>Sink</code> çš„ä¸»è¦åŠŸèƒ½ä» <code>Channel</code> ä¸­è¯»å– <code>Event</code> ï¼Œå¹¶å°†å…¶å­˜å…¥å¤–éƒ¨å­˜å‚¨ç³»ç»Ÿæˆ–å°†å…¶è½¬å‘åˆ°ä¸‹ä¸€ä¸ª<code>Source</code> ï¼ŒæˆåŠŸåå†ä» <code>Channel</code> ä¸­ç§»é™¤ <code>Event</code> ã€‚</p><p><strong>5. Agent</strong></p><p>æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ (JVM) è¿›ç¨‹ï¼ŒåŒ…å« <code>Source</code> ã€ <code>Channel</code> ã€ <code>Sink</code> ç­‰ç»„ä»¶ã€‚</p><h3 id="2ã€Flumeäº‹åŠ¡"><a href="#2ã€Flumeäº‹åŠ¡" class="headerlink" title="2ã€Flumeäº‹åŠ¡"></a>2ã€Flumeäº‹åŠ¡</h3><p><img src="https://file.buildworld.cn/img/20200701104347.png"></p><blockquote><p><strong>Flume çš„äº‹åŠ¡æœºåˆ¶ï¼ˆç±»ä¼¼æ•°æ®åº“çš„äº‹åŠ¡æœºåˆ¶ï¼‰</strong>ï¼šFlume ä½¿ç”¨ä¸¤ä¸ªç‹¬ç«‹çš„äº‹åŠ¡åˆ†åˆ«è´Ÿè´£ä»<code>Soucrce</code> åˆ° <code>Channel</code>ï¼Œä»¥åŠä» <code>Channel</code> åˆ° <code>Sink</code> çš„äº‹ä»¶ä¼ é€’ã€‚æ¯”å¦‚ <code>spooling directory source</code> ä¸ºæ–‡ä»¶çš„æ¯ä¸€è¡Œåˆ›å»ºä¸€ä¸ªäº‹ä»¶ï¼Œä¸€æ—¦äº‹åŠ¡ä¸­æ‰€æœ‰çš„äº‹ä»¶å…¨éƒ¨ä¼ é€’åˆ° <code>Channel</code> ä¸”æäº¤æˆåŠŸï¼Œé‚£ä¹ˆ <code>Soucrce</code> å°±å°†è¯¥æ–‡ä»¶æ ‡è®°ä¸ºå®Œæˆã€‚åŒç†ï¼Œäº‹åŠ¡ä»¥ç±»ä¼¼çš„æ–¹å¼å¤„ç†ä» <code>Channel</code> åˆ° <code>Sink</code> çš„ä¼ é€’è¿‡ç¨‹ï¼Œå¦‚æœå› ä¸ºæŸç§åŸå› ä½¿å¾—äº‹ä»¶æ— æ³•è®°å½•ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†ä¼šå›æ»šã€‚ä¸”æ‰€æœ‰çš„äº‹ä»¶éƒ½ä¼šä¿æŒåˆ° <code>Channel</code> ä¸­ï¼Œç­‰å¾…é‡æ–°ä¼ é€’ã€‚</p></blockquote><h3 id="3ã€Flume-Agent-å†…éƒ¨åŸç†"><a href="#3ã€Flume-Agent-å†…éƒ¨åŸç†" class="headerlink" title="3ã€Flume Agent å†…éƒ¨åŸç†"></a>3ã€<strong>Flume Agent</strong> å†…éƒ¨åŸç†</h3><p><img src="https://file.buildworld.cn/img/20200701113850.png"></p><p><strong>é‡è¦ç»„ä»¶ï¼š</strong> </p><p><strong>1ï¼‰ChannelSelector</strong> </p><p><code>ChannelSelector</code> çš„ä½œç”¨å°±æ˜¯é€‰å‡º <code>Event</code> å°†è¦è¢«å‘å¾€å“ªä¸ª <code>Channel</code>ã€‚å…¶å…±æœ‰ä¸¤ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ <code>Replicating</code>ï¼ˆå¤åˆ¶ï¼‰å’Œ <code>Multiplexing</code>ï¼ˆå¤šè·¯å¤ç”¨ï¼‰ã€‚</p><p><code>ReplicatingSelector</code> ä¼šå°†åŒä¸€ä¸ª <code>Event</code> å‘å¾€æ‰€æœ‰çš„ <code>Channel</code>ï¼Œ<code>Multiplexing</code> ä¼šæ ¹æ®ç›¸åº”çš„åŸåˆ™ï¼Œå°†ä¸åŒçš„ <code>Event</code> å‘å¾€ä¸åŒçš„ <code>Channel</code>ã€‚ </p><p><strong>2ï¼‰SinkProcessor</strong> </p><p><code>SinkProcessor</code> å…± æœ‰ ä¸‰ ç§ ç±» å‹ ï¼Œ åˆ† åˆ« æ˜¯ <code>DefaultSinkProcessor</code> ã€<code>LoadBalancingSinkProcessor</code> å’Œ <code>FailoverSinkProcessor</code></p><p><code>DefaultSinkProcessor</code> å¯¹ åº” çš„ æ˜¯ å• ä¸ª çš„ <code>Sink</code> ï¼Œ <code>LoadBalancingSinkProcessor</code> å’Œ <code>FailoverSinkProcessor</code> å¯¹åº”çš„æ˜¯ <code>Sink Group</code>ï¼Œ<code>LoadBalancingSinkProcessor</code> å¯ä»¥å®ç°è´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ï¼Œ<code>FailoverSinkProcessor</code> å¯ä»¥å®ç°æ•…éšœè½¬ç§»çš„åŠŸèƒ½ã€‚</p><h3 id="4ã€Flume-æ‹“æ‰‘ç»“æ„"><a href="#4ã€Flume-æ‹“æ‰‘ç»“æ„" class="headerlink" title="4ã€Flume æ‹“æ‰‘ç»“æ„"></a>4ã€<strong>Flume</strong> æ‹“æ‰‘ç»“æ„</h3><h4 id="ï¼ˆ1ï¼‰ã€ç®€å•ä¸²è”"><a href="#ï¼ˆ1ï¼‰ã€ç®€å•ä¸²è”" class="headerlink" title="ï¼ˆ1ï¼‰ã€ç®€å•ä¸²è”"></a>ï¼ˆ1ï¼‰ã€ç®€å•ä¸²è”</h4><p><img src="https://file.buildworld.cn/img/20200701145041.png"></p><blockquote><p>è¿™ç§æ¨¡å¼æ˜¯å°†å¤šä¸ª <code>flume</code> é¡ºåºè¿æ¥èµ·æ¥äº†ï¼Œä»æœ€åˆçš„ <code>source</code> å¼€å§‹åˆ°æœ€ç»ˆ <code>sink</code> ä¼ é€çš„ç›®çš„å­˜å‚¨ç³»ç»Ÿã€‚æ­¤æ¨¡å¼ä¸å»ºè®®æ¡¥æ¥è¿‡å¤šçš„ <code>flume</code> æ•°é‡ï¼Œ<code>flume</code> æ•°é‡è¿‡å¤šä¸ä»…ä¼šå½±å“ä¼ è¾“é€Ÿç‡ï¼Œè€Œä¸”ä¸€æ—¦ä¼ è¾“è¿‡ç¨‹ä¸­æŸä¸ªèŠ‚ç‚¹ flume å®•æœºï¼Œä¼šå½±å“æ•´ä¸ªä¼ è¾“ç³»ç»Ÿã€‚</p></blockquote><h4 id="ï¼ˆ2ï¼‰ã€å¤åˆ¶å’Œå¤šè·¯å¤ç”¨"><a href="#ï¼ˆ2ï¼‰ã€å¤åˆ¶å’Œå¤šè·¯å¤ç”¨" class="headerlink" title="ï¼ˆ2ï¼‰ã€å¤åˆ¶å’Œå¤šè·¯å¤ç”¨"></a>ï¼ˆ2ï¼‰ã€å¤åˆ¶å’Œå¤šè·¯å¤ç”¨</h4><p><img src="https://file.buildworld.cn/img/20200701145300.png"></p><blockquote><p><code>Flume</code> æ”¯æŒå°†äº‹ä»¶æµå‘ä¸€ä¸ªæˆ–è€…å¤šä¸ªç›®çš„åœ°ã€‚è¿™ç§æ¨¡å¼å¯ä»¥å°†ç›¸åŒæ•°æ®å¤åˆ¶åˆ°å¤šä¸ª<code>channel</code> ä¸­ï¼Œæˆ–è€…å°†ä¸åŒæ•°æ®åˆ†å‘åˆ°ä¸åŒçš„ <code>channel</code> ä¸­ï¼Œ<code>sink</code> å¯ä»¥é€‰æ‹©ä¼ é€åˆ°ä¸åŒçš„ç›®çš„åœ°ã€‚</p></blockquote><h4 id="ï¼ˆ3ï¼‰ã€è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»"><a href="#ï¼ˆ3ï¼‰ã€è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»" class="headerlink" title="ï¼ˆ3ï¼‰ã€è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»"></a>ï¼ˆ3ï¼‰ã€è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»</h4><p><img src="https://file.buildworld.cn/img/20200701145526.png"></p><blockquote><p><code>Flume</code>æ”¯æŒä½¿ç”¨å°†å¤šä¸ª<code>sink</code>é€»è¾‘ä¸Šåˆ†åˆ°ä¸€ä¸ª<code>sink</code>ç»„ï¼Œ<code>sink</code>ç»„é…åˆä¸åŒçš„<code>SinkProcessor</code>å¯ä»¥å®ç°è´Ÿè½½å‡è¡¡å’Œé”™è¯¯æ¢å¤çš„åŠŸèƒ½ã€‚</p></blockquote><h4 id="4-ã€èšåˆ"><a href="#4-ã€èšåˆ" class="headerlink" title="(4)ã€èšåˆ"></a>(4)ã€èšåˆ</h4><p><img src="https://file.buildworld.cn/img/20200701145800.png"></p><blockquote><p>è¿™ç§æ¨¡å¼æ˜¯æˆ‘ä»¬æœ€å¸¸è§çš„ï¼Œä¹Ÿéå¸¸å®ç”¨ï¼Œæ—¥å¸¸ web åº”ç”¨é€šå¸¸åˆ†å¸ƒåœ¨ä¸Šç™¾ä¸ªæœåŠ¡å™¨ï¼Œå¤§è€…ç”šè‡³ä¸Šåƒä¸ªã€ä¸Šä¸‡ä¸ªæœåŠ¡å™¨ã€‚äº§ç”Ÿçš„æ—¥å¿—ï¼Œå¤„ç†èµ·æ¥ä¹Ÿéå¸¸éº»çƒ¦ã€‚ç”¨ <code>flume</code> çš„è¿™ç§ç»„åˆæ–¹å¼èƒ½å¾ˆå¥½çš„è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæ¯å°æœåŠ¡å™¨éƒ¨ç½²ä¸€ä¸ª <code>flume</code> é‡‡é›†æ—¥å¿—ï¼Œä¼ é€åˆ°ä¸€ä¸ªé›†ä¸­æ”¶é›†æ—¥å¿—çš„<code>flume</code>ï¼Œå†ç”±æ­¤ <code>flume</code> ä¸Šä¼ åˆ° <code>hdfs</code>ã€<code>hive</code>ã€<code>hbase</code> ç­‰ï¼Œè¿›è¡Œæ—¥å¿—åˆ†æã€‚ </p></blockquote><h3 id="5ã€-Flume-å‚æ•°è°ƒä¼˜"><a href="#5ã€-Flume-å‚æ•°è°ƒä¼˜" class="headerlink" title="5ã€ Flume å‚æ•°è°ƒä¼˜"></a>5ã€ <strong>Flume</strong> å‚æ•°è°ƒä¼˜</h3><h4 id="ï¼ˆ1ï¼‰-Source"><a href="#ï¼ˆ1ï¼‰-Source" class="headerlink" title="ï¼ˆ1ï¼‰. Source"></a>ï¼ˆ1ï¼‰. Source</h4><blockquote><p>å¢åŠ  <code>Source</code> ä¸ªï¼ˆä½¿ç”¨ <code>Tair Dir Source</code> æ—¶å¯å¢åŠ  <code>FileGroups</code> ä¸ªæ•°ï¼‰å¯ä»¥å¢å¤§ Source çš„è¯»å–æ•°æ®çš„èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼šå½“æŸä¸€ä¸ªç›®å½•äº§ç”Ÿçš„æ–‡ä»¶è¿‡å¤šæ—¶éœ€è¦å°†è¿™ä¸ªæ–‡ä»¶ç›®å½•æ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶ç›®å½•ï¼ŒåŒæ—¶é…ç½®å¥½å¤šä¸ª Source ä»¥ä¿è¯ Source æœ‰è¶³å¤Ÿçš„èƒ½åŠ›è·å–åˆ°æ–°äº§ç”Ÿçš„æ•°æ®ã€‚</p></blockquote><blockquote><p><code>batchSize</code> å‚æ•°å†³å®š Source ä¸€æ¬¡æ‰¹é‡è¿è¾“åˆ° Channel çš„ event æ¡æ•°ï¼Œé€‚å½“è°ƒå¤§è¿™ä¸ªå‚æ•°å¯ä»¥æé«˜ Source æ¬è¿ Event åˆ° Channel æ—¶çš„æ€§èƒ½ã€‚</p></blockquote><h4 id="ï¼ˆ2ï¼‰-Channel"><a href="#ï¼ˆ2ï¼‰-Channel" class="headerlink" title="ï¼ˆ2ï¼‰. Channel"></a>ï¼ˆ2ï¼‰. Channel</h4><blockquote><p><code>type</code> é€‰æ‹© memory æ—¶ Channel çš„æ€§èƒ½æœ€å¥½ï¼Œä½†æ˜¯å¦‚æœ Flume è¿›ç¨‹æ„å¤–æŒ‚æ‰å¯èƒ½ä¼šä¸¢å¤±æ•°æ®ã€‚type é€‰æ‹© file æ—¶ Channel çš„å®¹é”™æ€§æ›´å¥½ï¼Œä½†æ˜¯æ€§èƒ½ä¸Šä¼šæ¯” memory channel å·®ã€‚</p></blockquote><blockquote><p>ä½¿ç”¨ <code>file Channel</code> æ—¶ <code>dataDirs</code> é…ç½®å¤šä¸ªä¸åŒç›˜ä¸‹çš„ç›®å½•å¯ä»¥æé«˜æ€§èƒ½ã€‚</p></blockquote><blockquote><p><code>Capacity</code> å‚æ•°å†³å®š <code>Channel</code> å¯å®¹çº³æœ€å¤§çš„ <code>event</code> æ¡æ•°ã€‚<code>transactionCapacity</code> å‚æ•°å†³å®šæ¯æ¬¡ Source å¾€ channel é‡Œé¢å†™çš„æœ€å¤§ event æ¡æ•°å’Œæ¯æ¬¡ Sink ä» channel é‡Œé¢è¯»çš„æœ€å¤§ eventæ¡æ•°ã€‚<strong>transactionCapacity éœ€è¦å¤§äº Source å’Œ Sink çš„ batchSize å‚æ•°ã€‚</strong></p></blockquote><h4 id="ï¼ˆ3ï¼‰-Sink"><a href="#ï¼ˆ3ï¼‰-Sink" class="headerlink" title="ï¼ˆ3ï¼‰. Sink"></a>ï¼ˆ3ï¼‰. Sink</h4><blockquote><p>å¢åŠ  <code>Sink</code> çš„ä¸ªæ•°å¯ä»¥å¢åŠ  Sink æ¶ˆè´¹ event çš„èƒ½åŠ›ã€‚Sink ä¹Ÿä¸æ˜¯è¶Šå¤šè¶Šå¥½å¤Ÿç”¨å°±è¡Œï¼Œè¿‡å¤šçš„ Sink ä¼šå ç”¨ç³»ç»Ÿèµ„æºï¼Œé€ æˆç³»ç»Ÿèµ„æºä¸å¿…è¦çš„æµªè´¹ã€‚</p></blockquote><blockquote><p><code>batchSize</code> å‚æ•°å†³å®š Sink ä¸€æ¬¡æ‰¹é‡ä» Channel è¯»å–çš„ event æ¡æ•°ï¼Œé€‚å½“è°ƒå¤§è¿™ä¸ªå‚æ•°å¯ä»¥æé«˜ Sink ä» Channel æ¬å‡º event çš„æ€§èƒ½ã€‚</p></blockquote><h3 id="6ã€Flume-çš„-Channel-Selectors"><a href="#6ã€Flume-çš„-Channel-Selectors" class="headerlink" title="6ã€Flume çš„ Channel Selectors"></a>6ã€<strong>Flume</strong> <strong>çš„</strong> Channel Selectors</h3><p><img src="https://file.buildworld.cn/img/20200701190722.png"></p>]]></content>
    
    
    <summary type="html">Flumeæ˜¯Clouderaæä¾›çš„ä¸€ä¸ªé«˜å¯ç”¨çš„ï¼Œé«˜å¯é çš„ï¼Œåˆ†å¸ƒå¼çš„æµ·é‡æ—¥å¿—é‡‡é›†ã€èšåˆå’Œä¼ è¾“çš„ç³»ç»Ÿã€‚FlumeåŸºäºæµå¼æ¶æ„ï¼Œçµæ´»ç®€å•ã€‚</summary>
    
    
    
    <category term="BigData" scheme="https://www.buildworld.cn/categories/BigData/"/>
    
    
    <category term="Hadoop" scheme="https://www.buildworld.cn/tags/Hadoop/"/>
    
    <category term="Flume" scheme="https://www.buildworld.cn/tags/Flume/"/>
    
    <category term="Apache" scheme="https://www.buildworld.cn/tags/Apache/"/>
    
  </entry>
  
  <entry>
    <title>BCI--Python-EEGå·¥å…·åº“MNE</title>
    <link href="https://www.buildworld.cn/2020/06/12/BCI-Python-EEG%E5%B7%A5%E5%85%B7%E5%BA%93MNE/"/>
    <id>https://www.buildworld.cn/2020/06/12/BCI-Python-EEG%E5%B7%A5%E5%85%B7%E5%BA%93MNE/</id>
    <published>2020-06-12T12:52:14.000Z</published>
    <updated>2021-04-09T02:13:59.681Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Python-EEGå·¥å…·åº“MNE"><a href="#Python-EEGå·¥å…·åº“MNE" class="headerlink" title="Python-EEGå·¥å…·åº“MNE"></a>Python-EEGå·¥å…·åº“MNE</h2><h3 id="ä¸€ã€ç¯å¢ƒé…ç½®"><a href="#ä¸€ã€ç¯å¢ƒé…ç½®" class="headerlink" title="ä¸€ã€ç¯å¢ƒé…ç½®"></a>ä¸€ã€ç¯å¢ƒé…ç½®</h3><h4 id="å®‰è£…MNE-python"><a href="#å®‰è£…MNE-python" class="headerlink" title="å®‰è£…MNE-python"></a>å®‰è£…MNE-python</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -U mne</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mne</span><br><span class="line"><span class="keyword">from</span> mne.datasets <span class="keyword">import</span> sample</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># sampleçš„å­˜æ”¾åœ°å€ï¼Œä¸‹é¢è¯­æ³•æ˜¯ä»ç½‘ç»œä¸­è·å–æ•°æ®é›†</span></span><br><span class="line"><span class="comment"># data_path = sample.data_path()</span></span><br><span class="line"><span class="comment"># è¯¥fifæ–‡ä»¶å­˜æ”¾åœ°å€</span></span><br><span class="line">fname = <span class="string">&#x27;F:/data/MNE-sample-data/MEG/sample/sample_audvis_raw.fif&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">å¦‚æœä¸Šè¿°ç»™å®šçš„åœ°å€ä¸­å­˜åœ¨è¯¥æ–‡ä»¶ï¼Œåˆ™ç›´æ¥åŠ è½½æœ¬åœ°æ–‡ä»¶ï¼Œ</span></span><br><span class="line"><span class="string">å¦‚æœä¸å­˜åœ¨åˆ™åœ¨ç½‘ä¸Šä¸‹è½½æ”¹æ•°æ®</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">raw = mne.io.read_raw_fif(fname)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">æ¡ˆä¾‹ï¼š</span></span><br><span class="line"><span class="string">è·å–10-20ç§’å†…çš„è‰¯å¥½çš„MEGæ•°æ®</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># æ ¹æ®typeæ¥é€‰æ‹© é‚£äº›è‰¯å¥½çš„MEGä¿¡å·(è‰¯å¥½çš„MEGä¿¡å·ï¼Œé€šè¿‡è®¾ç½®exclude=&quot;bads&quot;) channel,</span></span><br><span class="line"><span class="string">ç»“æœä¸º channelsæ‰€å¯¹åº”çš„çš„ç´¢å¼•</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">picks = mne.pick_types(raw.info, meg=<span class="literal">True</span>, exclude=<span class="string">&#x27;bads&#x27;</span>)</span><br><span class="line">t_idx = raw.time_as_index([<span class="number">10.</span>, <span class="number">20.</span>])</span><br><span class="line">data, times = raw[picks, t_idx[<span class="number">0</span>]:t_idx[<span class="number">1</span>]]</span><br><span class="line">plt.plot(times,data.T)</span><br><span class="line">plt.title(<span class="string">&quot;Sample channels&quot;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><ul><li>å‡ºç°ä¸‹é¢çš„å›¾ç‰‡ï¼Œè¯´æ˜ç¯å¢ƒæ­å»ºæˆåŠŸäº†</li></ul><p><img src="https://file.buildworld.cn/img/20200611205438.png"></p><h3 id="äºŒã€MNEä¸­æ•°æ®ç»“æ„RawåŠå…¶ç”¨æ³•ç®€ä»‹"><a href="#äºŒã€MNEä¸­æ•°æ®ç»“æ„RawåŠå…¶ç”¨æ³•ç®€ä»‹" class="headerlink" title="äºŒã€MNEä¸­æ•°æ®ç»“æ„RawåŠå…¶ç”¨æ³•ç®€ä»‹"></a>äºŒã€MNEä¸­æ•°æ®ç»“æ„RawåŠå…¶ç”¨æ³•ç®€ä»‹</h3><p><strong>Rawå¯¹è±¡ä¸»è¦ç”¨æ¥å­˜å‚¨è¿ç»­å‹æ•°æ®ï¼Œæ ¸å¿ƒæ•°æ®ä¸ºn_channelså’Œtimes,ä¹ŸåŒ…å«Infoå¯¹è±¡ã€‚</strong></p><h4 id="1ã€æ‰“å¼€rawæ•°æ®"><a href="#1ã€æ‰“å¼€rawæ•°æ®" class="headerlink" title="1ã€æ‰“å¼€rawæ•°æ®"></a>1ã€æ‰“å¼€rawæ•°æ®</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼•å…¥pythonåº“</span></span><br><span class="line"><span class="keyword">import</span> mne</span><br><span class="line"><span class="keyword">from</span> mne.datasets <span class="keyword">import</span> sample</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># sampleçš„å­˜æ”¾åœ°å€ï¼Œä¸‹é¢ä¸ºä»ç½‘ç»œåœ°å€ä¸‹è½½</span></span><br><span class="line"><span class="comment">#data_path = sample.data_path()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€æœ¬åœ°çš„æ•°æ®ï¼Œè¯¥fifæ–‡ä»¶å­˜æ”¾åœ°å€</span></span><br><span class="line">fname = data_path + <span class="string">&#x27;/MEG/sample/sample_audvis_raw.fif&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">å¦‚æœä¸Šè¿°ç»™å®šçš„åœ°å€ä¸­å­˜åœ¨è¯¥æ–‡ä»¶ï¼Œåˆ™ç›´æ¥åŠ è½½æœ¬åœ°æ–‡ä»¶ï¼Œ</span></span><br><span class="line"><span class="string">å¦‚æœä¸å­˜åœ¨åˆ™åœ¨ç½‘ä¸Šä¸‹è½½æ”¹æ•°æ®</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">raw = mne.io.read_raw_fif(fname)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€šå¸¸rawçš„æ•°æ®è®¿é—®æ–¹å¼å¦‚ä¸‹ï¼š</span></span><br><span class="line">data, times = raw[picks, time_slice]</span><br><span class="line"></span><br><span class="line"><span class="comment"># picks:æ˜¯æ ¹æ®æ¡ä»¶æŒ‘é€‰å‡ºæ¥çš„ç´¢å¼•ï¼›</span></span><br><span class="line"><span class="comment"># time_slice:æ—¶é—´åˆ‡ç‰‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æƒ³è¦è·å–rawä¸­æ‰€æœ‰æ•°æ®ï¼Œä»¥ä¸‹ä¸¤ç§æ–¹å¼å‡å¯ï¼š</span></span><br><span class="line">data,times=raw[:]</span><br><span class="line">data,times=raw[:,:]</span><br></pre></td></tr></table></figure><h4 id="2ã€sfreqï¼šé‡‡æ ·é¢‘ç‡"><a href="#2ã€sfreqï¼šé‡‡æ ·é¢‘ç‡" class="headerlink" title="2ã€sfreqï¼šé‡‡æ ·é¢‘ç‡"></a>2ã€sfreqï¼šé‡‡æ ·é¢‘ç‡</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">sfreqï¼šé‡‡æ ·é¢‘ç‡</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">rawè¿”å›æ‰€é€‰ä¿¡é“ä»¥åŠæ—¶é—´æ®µå†…çš„æ•°æ®å’Œæ—¶é—´ç‚¹ï¼Œ</span></span><br><span class="line"><span class="string">åˆ†åˆ«èµ‹å€¼ç»™dataä»¥åŠtimesï¼ˆå³rawå¯¹è±¡è¿”å›çš„æ˜¯ä¸¤ä¸ªarrayï¼‰</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">sfreq=raw.info[<span class="string">&#x27;sfreq&#x27;</span>]</span><br><span class="line">data,times=raw[:<span class="number">5</span>,<span class="built_in">int</span>(sfreq*<span class="number">1</span>):<span class="built_in">int</span>(sfreq*<span class="number">3</span>)]</span><br><span class="line">plt.plot(times,data.T)</span><br><span class="line">plt.title(<span class="string">&quot;Sample channels&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://file.buildworld.cn/img/20200612101529.png"></p><h4 id="3ã€ç»˜åˆ¶å„é€šé“çš„åŠŸç‡è°±å¯†åº¦"><a href="#3ã€ç»˜åˆ¶å„é€šé“çš„åŠŸç‡è°±å¯†åº¦" class="headerlink" title="3ã€ç»˜åˆ¶å„é€šé“çš„åŠŸç‡è°±å¯†åº¦"></a>3ã€ç»˜åˆ¶å„é€šé“çš„åŠŸç‡è°±å¯†åº¦</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">raw.plot_psd()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://file.buildworld.cn/img/20200612101711.png"></p><h4 id="4ã€ç»˜åˆ¶SSPçŸ¢é‡å›¾"><a href="#4ã€ç»˜åˆ¶SSPçŸ¢é‡å›¾" class="headerlink" title="4ã€ç»˜åˆ¶SSPçŸ¢é‡å›¾"></a>4ã€ç»˜åˆ¶SSPçŸ¢é‡å›¾</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">raw.plot_projs_topomap()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://file.buildworld.cn/img/20200612101820.png"></p><h4 id="5ã€ç»˜åˆ¶é€šé“é¢‘è°±å›¾ä½œä¸ºtopography"><a href="#5ã€ç»˜åˆ¶é€šé“é¢‘è°±å›¾ä½œä¸ºtopography" class="headerlink" title="5ã€ç»˜åˆ¶é€šé“é¢‘è°±å›¾ä½œä¸ºtopography"></a>5ã€ç»˜åˆ¶é€šé“é¢‘è°±å›¾ä½œä¸ºtopography</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">raw.plot_psd_topo()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://file.buildworld.cn/img/20200612102005.png"></p><h4 id="6ã€ç»˜åˆ¶ç”µæä½ç½®"><a href="#6ã€ç»˜åˆ¶ç”µæä½ç½®" class="headerlink" title="6ã€ç»˜åˆ¶ç”µæä½ç½®"></a>6ã€ç»˜åˆ¶ç”µæä½ç½®</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">raw.plot_sensors()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://file.buildworld.cn/img/20200612102107.png"></p><h3 id="ä¸‰ã€MNEä»å¤´åˆ›å»ºRawå¯¹è±¡"><a href="#ä¸‰ã€MNEä»å¤´åˆ›å»ºRawå¯¹è±¡" class="headerlink" title="ä¸‰ã€MNEä»å¤´åˆ›å»ºRawå¯¹è±¡"></a>ä¸‰ã€MNEä»å¤´åˆ›å»ºRawå¯¹è±¡</h3><h4 id="1ã€ç®€å•ä»‹ç»"><a href="#1ã€ç®€å•ä»‹ç»" class="headerlink" title="1ã€ç®€å•ä»‹ç»"></a>1ã€ç®€å•ä»‹ç»</h4><p><strong>åœ¨å®é™…è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶éœ€è¦ä»å¤´æ„å»ºæ•°æ®æ¥åˆ›å»ºRawå¯¹è±¡ã€‚</strong><br><strong>æ–¹å¼ï¼šé€šè¿‡<code>mne.io.RawArray</code>ç±»æ¥æ‰‹åŠ¨åˆ›å»ºRaw</strong></p><blockquote><p>æ³¨ï¼šä½¿ç”¨mne.io.RawArrayåˆ›å»ºRawå¯¹è±¡æ—¶ï¼Œå…¶æ„é€ å‡½æ•°åªæ¥å—çŸ©é˜µå’Œinfoå¯¹è±¡ã€‚</p></blockquote><p>æ•°æ®å¯¹åº”çš„å•ä½ï¼š</p><ul><li><code>V: eeg, eog, seeg, emg, ecg, bio, ecog</code></li><li><code>T: mag</code></li><li><code>T/m: grad</code></li><li><code>M: hbo, hbr</code></li><li><code>Am: dipole</code></li><li><code>AU: misc</code></li></ul><p>æ„å»ºä¸€ä¸ªRawå¯¹è±¡æ—¶ï¼Œéœ€è¦å‡†å¤‡ä¸¤ç§æ•°æ®ï¼Œä¸€ç§æ˜¯<strong>data</strong>æ•°æ®ï¼Œä¸€ç§æ˜¯<strong>Info</strong>æ•°æ®ï¼Œ</p><p>dataæ•°æ®æ˜¯ä¸€ä¸ªäºŒç»´æ•°æ®ï¼Œå½¢çŠ¶ä¸º<code>(n_channels,n_times)</code></p><h4 id="2ã€åŒ…è£…æ•°æ®"><a href="#2ã€åŒ…è£…æ•°æ®" class="headerlink" title="2ã€åŒ…è£…æ•°æ®"></a>2ã€åŒ…è£…æ•°æ®</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">ç”Ÿæˆä¸€ä¸ªå¤§å°ä¸º5x1000çš„äºŒç»´éšæœºæ•°æ®</span></span><br><span class="line"><span class="string">å…¶ä¸­5ä»£è¡¨5ä¸ªé€šé“ï¼Œ1000ä»£è¡¨times</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">data = np.random.randn(<span class="number">5</span>,<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">åˆ›å»ºinfoç»“æ„,</span></span><br><span class="line"><span class="string">å†…å®¹åŒ…æ‹¬ï¼šé€šé“åç§°å’Œé€šé“ç±»å‹</span></span><br><span class="line"><span class="string">è®¾ç½®é‡‡æ ·é¢‘ç‡ä¸º:sfreq=100</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">info = mne.create_info(</span><br><span class="line">    ch_names=[<span class="string">&#x27;MEG1&#x27;</span>,<span class="string">&#x27;MEG2&#x27;</span>,<span class="string">&#x27;EEG1&#x27;</span>,<span class="string">&#x27;EEG2&#x27;</span>,<span class="string">&#x27;EOG&#x27;</span>],</span><br><span class="line">    ch_types=[<span class="string">&#x27;grad&#x27;</span>,<span class="string">&#x27;grad&#x27;</span>,<span class="string">&#x27;eeg&#x27;</span>,<span class="string">&#x27;eeg&#x27;</span>,<span class="string">&#x27;eog&#x27;</span>],</span><br><span class="line">    sfreq=<span class="number">100</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">custom_raw = mne.io.RawArray(data,info)</span><br></pre></td></tr></table></figure><h4 id="3ã€å¯¹å›¾å½¢è¿›è¡Œç¼©æ”¾"><a href="#3ã€å¯¹å›¾å½¢è¿›è¡Œç¼©æ”¾" class="headerlink" title="3ã€å¯¹å›¾å½¢è¿›è¡Œç¼©æ”¾"></a>3ã€å¯¹å›¾å½¢è¿›è¡Œç¼©æ”¾</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">å¯¹å›¾å½¢è¿›è¡Œç¼©æ”¾</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">å¯¹äºå®é™…çš„EEG / MEGæ•°æ®ï¼Œåº”ä½¿ç”¨ä¸åŒçš„æ¯”ä¾‹å› å­ã€‚</span></span><br><span class="line"><span class="string">å¯¹é€šé“eegã€gradï¼Œeogçš„æ•°æ®è¿›è¡Œ2å€ç¼©å°</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">scalings = &#123;<span class="string">&#x27;eeg&#x27;</span>:<span class="number">2</span>,<span class="string">&#x27;grad&#x27;</span>:<span class="number">2</span>,<span class="string">&#x27;eog&#x27;</span>:<span class="number">2</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#scalings = &#x27;auto&#x27; è®¾ç½®è‡ªåŠ¨ç¼©æ”¾</span></span><br><span class="line"></span><br><span class="line">custom_raw.plot(n_channels=<span class="number">5</span>,</span><br><span class="line">                scalings=scalings,</span><br><span class="line">                title=<span class="string">&#x27;Data from arrays&#x27;</span>,</span><br><span class="line">                show=<span class="literal">True</span>,</span><br><span class="line">                block=<span class="literal">True</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://file.buildworld.cn/img/20200612110956.png"></p><h3 id="å››ã€MNEä¸­æ•°æ®ç»“æ„Epoch"><a href="#å››ã€MNEä¸­æ•°æ®ç»“æ„Epoch" class="headerlink" title="å››ã€MNEä¸­æ•°æ®ç»“æ„Epoch"></a>å››ã€MNEä¸­æ•°æ®ç»“æ„Epoch</h3><p><strong>ä»è¿ç»­çš„è„‘ç”µå›¾ä¿¡å·ä¸­æå–ä¸€äº›ç‰¹å®šæ—¶é—´çª—å£çš„ä¿¡å·ï¼Œè¿™äº›æ—¶é—´çª—å£å¯ä»¥ç§°ä½œä¸º<code>epochs</code>.</strong></p><h4 id="1ã€åˆ›å»ºEpochså¯¹è±¡æ–¹å¼æœ‰ä¸‰ç§ï¼š"><a href="#1ã€åˆ›å»ºEpochså¯¹è±¡æ–¹å¼æœ‰ä¸‰ç§ï¼š" class="headerlink" title="1ã€åˆ›å»ºEpochså¯¹è±¡æ–¹å¼æœ‰ä¸‰ç§ï¼š"></a>1ã€åˆ›å»ºEpochså¯¹è±¡æ–¹å¼æœ‰ä¸‰ç§ï¼š</h4><ul><li>(1)é€šè¿‡Rawå¯¹è±¡å’Œäº‹ä»¶äº‹ä»¶ç‚¹(event times)-</li><li>(2)é€šè¿‡è¯»å–.fifæ–‡ä»¶æ•°æ®ç”ŸæˆEpochå¯¹è±¡</li><li>(3)é€šè¿‡mne.EpochsArrayä»å¤´åˆ›å»ºEpochå¯¹è±¡</li></ul><h4 id="2ã€è¯»å–fifæ–‡ä»¶åˆ›å»ºEpochå¯¹è±¡"><a href="#2ã€è¯»å–fifæ–‡ä»¶åˆ›å»ºEpochå¯¹è±¡" class="headerlink" title="2ã€è¯»å–fifæ–‡ä»¶åˆ›å»ºEpochå¯¹è±¡"></a>2ã€è¯»å–fifæ–‡ä»¶åˆ›å»ºEpochå¯¹è±¡</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">æ­¥éª¤ï¼š</span><br><span class="line"><span class="number">1</span>ï¼‰è¯»å–fifæ–‡ä»¶ï¼Œæ„å»ºrawå¯¹è±¡;</span><br><span class="line"><span class="number">2</span>ï¼‰åˆ›å»ºeventå¯¹è±¡ï¼›</span><br><span class="line"><span class="number">3</span>ï¼‰åˆ›å»ºepochå¯¹è±¡ï¼›</span><br><span class="line"><span class="number">4</span>ï¼‰å¯¹epochè¿›è¡Œå åŠ å¹³å‡å¾—åˆ°evokedå¯¹è±¡ï¼›</span><br><span class="line"><span class="number">5</span>ï¼‰ç»˜åˆ¶evokedã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> mne</span><br><span class="line"><span class="keyword">from</span> mne <span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">from</span> mne.datasets <span class="keyword">import</span> sample</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»ç½‘ç»œä¸­ä¸‹è½½</span></span><br><span class="line">data_path = sample.data_path()</span><br><span class="line"></span><br><span class="line">raw_fname = data_path + <span class="string">&#x27;/MEG/sample/sample_audvis_filt-0-40_raw.fif&#x27;</span></span><br><span class="line">event_fname = data_path + <span class="string">&#x27;/MEG/sample/sample_audvis_filt-0-40_raw-eve.fif&#x27;</span></span><br><span class="line">event_id, tmin, tmax = <span class="number">1</span>, -<span class="number">0.2</span>, <span class="number">0.5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å–fifæ–‡ä»¶,åˆ›å»ºrawå¯¹è±¡</span></span><br><span class="line">raw = io.read_raw_fif(raw_fname)</span><br><span class="line"><span class="comment"># è¯»å–åŒ…å«eventçš„fifæ–‡ä»¶ï¼Œåˆ›å»ºeventå¯¹è±¡</span></span><br><span class="line">events = mne.read_events(event_fname)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"> æŒ‘é€‰é€šé“:EEG + MEG - bad channels </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">raw.info[<span class="string">&#x27;bads&#x27;</span>] += [<span class="string">&#x27;MEG 2443&#x27;</span>, <span class="string">&#x27;EEG 053&#x27;</span>]  <span class="comment"># bads + 2 more</span></span><br><span class="line">picks = mne.pick_types(raw.info, meg=<span class="literal">True</span>, eeg=<span class="literal">False</span>, stim=<span class="literal">True</span>, eog=<span class="literal">True</span>,</span><br><span class="line">                       exclude=<span class="string">&#x27;bads&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯»å–Epochæ•°æ®</span></span><br><span class="line">epochs = mne.Epochs(raw, events, event_id, tmin, tmax, proj=<span class="literal">True</span>,</span><br><span class="line">                    picks=picks, baseline=(<span class="literal">None</span>, <span class="number">0</span>), preload=<span class="literal">True</span>,</span><br><span class="line">                    reject=<span class="built_in">dict</span>(grad=<span class="number">4000e-13</span>, mag=<span class="number">4e-12</span>, eog=<span class="number">150e-6</span>))</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">å¯¹epochsæ•°æ®è¿›è¡Œæ±‚å¹³å‡è·å–è¯±å‘å“åº”</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">evoked = epochs.average()</span><br><span class="line"></span><br><span class="line">evoked.plot(time_unit=<span class="string">&#x27;s&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://file.buildworld.cn/img/20200612134440.png">                             </p><h4 id="3ã€ä»å¤´åˆ›å»ºEpochå¯¹è±¡"><a href="#3ã€ä»å¤´åˆ›å»ºEpochå¯¹è±¡" class="headerlink" title="3ã€ä»å¤´åˆ›å»ºEpochå¯¹è±¡"></a>3ã€ä»å¤´åˆ›å»ºEpochå¯¹è±¡</h4><p><strong>Epochså¯¹è±¡æ˜¯ä¸€ç§å°†è¿ç»­æ•°æ®è¡¨ç¤ºä¸ºæ—¶é—´æ®µé›†åˆçš„æ–¹æ³•</strong></p><blockquote><p>æ–¹å¼ï¼šåˆ©ç”¨<code>mne.EpochsArray</code>åˆ›å»ºEpochså¯¹è±¡ï¼Œåˆ›å»ºæ—¶ç›´æ¥æ„å»ºnumpyæ•°ç»„å³å¯ï¼Œæ•°ç»„çš„å½¢çŠ¶å¿…é¡»æ˜¯<code>(n_epochs, n_chans, n_times)</code></p></blockquote><p><strong>æ•°æ®å¯¹åº”çš„å•ä½ï¼š</strong></p><ul><li>V: eeg, eog, seeg, emg, ecg, bio, ecog</li><li>T: mag</li><li>T/m: grad</li><li>M: hbo, hbr</li><li>Am: dipole</li><li>AU: misc</li></ul><h5 id="ç¬¬ä¸€æ­¥ï¼šæ„å»ºæ•°æ®"><a href="#ç¬¬ä¸€æ­¥ï¼šæ„å»ºæ•°æ®" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šæ„å»ºæ•°æ®"></a>ç¬¬ä¸€æ­¥ï¼šæ„å»ºæ•°æ®</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬ä¸€æ­¥ï¼šæ„å»ºæ•°æ®</span><br><span class="line"></span><br><span class="line">æ„å»ºä¸€ä¸ªå¤§å°ä¸º10x5x200çš„ä¸‰ç»´æ•°ç»„ï¼Œæ•°ç»„ä¸­æ•°æ®æ˜¯éšæœºæ•°ï¼›</span><br><span class="line">ç¬¬ä¸€ç»´æ•°æ®è¡¨ç¤ºï¼š<span class="number">10</span> epochs</span><br><span class="line">ç¬¬äºŒç»´æ•°æ®è¡¨ç¤ºï¼š<span class="number">5</span> channels</span><br><span class="line">ç¬¬ä¸‰ç»´æ•°æ®è¡¨ç¤ºï¼š<span class="number">2</span> seconds per epoch</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡‡æ ·é¢‘ç‡</span></span><br><span class="line">sfreq = <span class="number">100</span></span><br><span class="line">data = np.random.randn(<span class="number">10</span>, <span class="number">5</span>, sfreq * <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªinfoç»“æ„</span></span><br><span class="line">info = mne.create_info(</span><br><span class="line">    ch_names=[<span class="string">&#x27;MEG1&#x27;</span>, <span class="string">&#x27;MEG2&#x27;</span>, <span class="string">&#x27;EEG1&#x27;</span>, <span class="string">&#x27;EEG2&#x27;</span>, <span class="string">&#x27;EOG&#x27;</span>],</span><br><span class="line">    ch_types=[<span class="string">&#x27;grad&#x27;</span>, <span class="string">&#x27;grad&#x27;</span>, <span class="string">&#x27;eeg&#x27;</span>, <span class="string">&#x27;eeg&#x27;</span>, <span class="string">&#x27;eog&#x27;</span>],</span><br><span class="line">    sfreq=sfreq</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h5 id="ç¬¬äºŒæ­¥ï¼šæ„å»ºevents"><a href="#ç¬¬äºŒæ­¥ï¼šæ„å»ºevents" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šæ„å»ºevents"></a>ç¬¬äºŒæ­¥ï¼šæ„å»ºevents</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">åœ¨åˆ›å»ºEpochså¯¹è±¡æ—¶ï¼Œå¿…é¡»æä¾›ä¸€ä¸ª<span class="string">&quot;events&quot;</span>æ•°ç»„ï¼Œ</span><br><span class="line"></span><br><span class="line">äº‹ä»¶(event)æè¿°çš„æ˜¯æŸä¸€ç§æ³¢å½¢(ç—‡çŠ¶)çš„èµ·å§‹ç‚¹ï¼Œå…¶ä¸ºä¸€ä¸ªä¸‰å…ƒç»„ï¼Œå½¢çŠ¶ä¸º(n_events,<span class="number">3</span>):</span><br><span class="line">ç¬¬ä¸€åˆ—å…ƒç´ ä»¥æ•´æ•°æ¥æè¿°çš„äº‹ä»¶èµ·å§‹é‡‡æ ·ç‚¹ï¼›</span><br><span class="line">ç¬¬äºŒåˆ—å…ƒç´ å¯¹åº”çš„æ˜¯å½“å‰äº‹ä»¶æ¥æºçš„åˆºæ¿€é€šé“(stimulus channel)çš„å…ˆå‰å€¼(previous value),è¯¥å€¼å¤§å¤šæ•°æƒ…å†µæ˜¯<span class="number">0</span>ï¼›</span><br><span class="line">ç¬¬ä¸‰åˆ—å…ƒç´ è¡¨ç¤ºçš„æ˜¯è¯¥eventçš„<span class="built_in">id</span>ã€‚</span><br><span class="line"></span><br><span class="line">events = np.array([</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>],</span><br><span class="line">    [<span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">3</span>, <span class="number">0</span>, <span class="number">2</span>],</span><br><span class="line">    [<span class="number">4</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">5</span>, <span class="number">0</span>, <span class="number">2</span>],</span><br><span class="line">    [<span class="number">6</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">7</span>, <span class="number">0</span>, <span class="number">2</span>],</span><br><span class="line">    [<span class="number">8</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">9</span>, <span class="number">0</span>, <span class="number">2</span>],</span><br><span class="line">])</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">è®¾ç½®äº‹ä»¶çš„<span class="built_in">id</span></span><br><span class="line"></span><br><span class="line">å¦‚æœæ˜¯<span class="built_in">dict</span>ï¼Œåˆ™ä»¥åå¯ä»¥ä½¿ç”¨è¿™äº›é”®è®¿é—®å…³è”çš„äº‹ä»¶ã€‚ç¤ºä¾‹ï¼š<span class="built_in">dict</span>ï¼ˆå¬è§‰=<span class="number">1</span>ï¼Œè§†è§‰=<span class="number">3</span>ï¼‰</span><br><span class="line">å¦‚æœæ˜¯<span class="built_in">int</span>ï¼Œå°†åˆ›å»ºä¸€ä¸ª<span class="built_in">id</span>ä¸ºstringçš„<span class="built_in">dict</span>ã€‚</span><br><span class="line">å¦‚æœæ˜¯åˆ—è¡¨ï¼Œåˆ™ä½¿ç”¨åˆ—è¡¨ä¸­æŒ‡å®šIDçš„æ‰€æœ‰äº‹ä»¶ã€‚</span><br><span class="line">å¦‚æœæ²¡æœ‰ï¼Œåˆ™æ‰€æœ‰äº‹ä»¶éƒ½å°†ä¸ä¸€èµ·ä½¿ç”¨ï¼Œå¹¶ä½¿ç”¨ä¸äº‹ä»¶<span class="built_in">id</span>æ•´æ•°å¯¹åº”çš„å­—ç¬¦ä¸²æ•´æ•°åç§°åˆ›å»º<span class="built_in">dict</span>ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºevent idï¼Œå—è¯•è€…æˆ–è€…å¾®ç¬‘æˆ–è€…çš±çœ‰</span></span><br><span class="line">event_id = <span class="built_in">dict</span>(smiling=<span class="number">1</span>, frowning=<span class="number">2</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">tmin:eventå¼€å§‹å‰çš„æ—¶é—´ï¼Œå¦‚æœæœªæŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸º0</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># è®¾ç½®äº‹ä»¶å¼€å§‹å‰æ—¶é—´ä¸º-0.1s</span></span><br><span class="line">tmin = -<span class="number">0.1</span></span><br></pre></td></tr></table></figure><h5 id="ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºepochså¯¹è±¡"><a href="#ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºepochså¯¹è±¡" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºepochså¯¹è±¡"></a>ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºepochså¯¹è±¡</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">åˆ©ç”¨mne.EpochsArrayåˆ›å»ºepochså¯¹è±¡</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">custom_epochs = mne.EpochsArray(data, info, events, tmin, event_id)</span><br><span class="line"><span class="built_in">print</span>(custom_epochs)</span><br><span class="line"><span class="comment"># ç»˜åˆ¶</span></span><br><span class="line">_ = custom_epochs[<span class="string">&#x27;smiling&#x27;</span>].average().plot(time_unit=<span class="string">&#x27;s&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://file.buildworld.cn/img/20200612153814.png"></p><h4 id="4ã€æŸ¥çœ‹epochå¯¹è±¡"><a href="#4ã€æŸ¥çœ‹epochå¯¹è±¡" class="headerlink" title="4ã€æŸ¥çœ‹epochå¯¹è±¡"></a>4ã€æŸ¥çœ‹epochå¯¹è±¡</h4><p><strong>epochså¯¹è±¡ç±»ä¼¼äºmne.io.Rawå¯¹è±¡ï¼Œä¹Ÿå…·æœ‰infoå±æ€§å’Œeventå±æ€§ã€‚</strong></p><p><strong>å¯ä»¥é€šè¿‡ä¸‹é¢ä¸¤ç§æ–¹å¼æ¥æŸ¥çœ‹epochå†…çš„eventç›¸å…³ä¿¡æ¯</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(epochs.events[:<span class="number">3</span>])</span><br><span class="line"><span class="built_in">print</span>(epochs.event_id)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(epochs[<span class="number">1</span>:<span class="number">5</span>])</span><br><span class="line"><span class="built_in">print</span>(epochs[<span class="string">&#x27;Auditory/Right&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢</span></span><br><span class="line"><span class="built_in">print</span>(epochs[<span class="string">&#x27;Right&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(epochs[<span class="string">&#x27;Right&#x27;</span>, <span class="string">&#x27;Left&#x27;</span>])</span><br></pre></td></tr></table></figure><h4 id="5ã€epochå¹³å‡å åŠ "><a href="#5ã€epochå¹³å‡å åŠ " class="headerlink" title="5ã€epochå¹³å‡å åŠ "></a>5ã€epochå¹³å‡å åŠ </h4><p><strong>é€šè¿‡è°ƒç”¨<code>mne.Epochs.average()</code>æ–¹æ³•å¯è¿”å›Evokedå¯¹è±¡ï¼Œaverage()æ–¹æ³•å¯ä»¥é€šè¿‡å‚æ•°æŒ‡å®šéœ€è¦çš„ä¿¡é“ã€‚</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ev_right = epochs[<span class="string">&#x27;Right&#x27;</span>].average()</span><br><span class="line">ev_left = epochs[<span class="string">&#x27;Left&#x27;</span>].average()</span><br><span class="line"></span><br><span class="line">f, axs = plt.subplots(<span class="number">3</span>, <span class="number">2</span>, figsize=(<span class="number">10</span>, <span class="number">5</span>))</span><br><span class="line">_ = f.suptitle(<span class="string">&#x27;Left / Right auditory&#x27;</span>, fontsize=<span class="number">20</span>)</span><br><span class="line">_ = ev_left.plot(axes=axs[:, <span class="number">0</span>], show=<span class="literal">False</span>, time_unit=<span class="string">&#x27;s&#x27;</span>)</span><br><span class="line">_ = ev_right.plot(axes=axs[:, <span class="number">1</span>], show=<span class="literal">False</span>, time_unit=<span class="string">&#x27;s&#x27;</span>)</span><br><span class="line">plt.tight_layout()</span><br></pre></td></tr></table></figure><p><img src="https://file.buildworld.cn/img/20200612162428.png"></p><h4 id="6ã€Epochå¯¹è±¡ä¸­çš„å…ƒæ•°æ®-metadata"><a href="#6ã€Epochå¯¹è±¡ä¸­çš„å…ƒæ•°æ®-metadata" class="headerlink" title="6ã€Epochå¯¹è±¡ä¸­çš„å…ƒæ•°æ®(metadata)"></a>6ã€Epochå¯¹è±¡ä¸­çš„å…ƒæ•°æ®(metadata)</h4><p>æœ‰æ—¶å€™ä½¿ç”¨<code>mne</code>çš„<code>metadata</code>å±æ€§æ¥å­˜å‚¨ç›¸å…³æ•°æ®ç‰¹åˆ«æœ‰ç”¨ï¼Œmetadataä½¿ç”¨<code>pandas.DataFrame</code>æ¥å°è£…æ•°æ®ã€‚å…¶ä¸­æ¯ä¸€è¡Œå¯¹åº”ä¸€ä¸ªepochï¼Œæ¯ä¸€åˆ—å¯¹åº”ä¸€ä¸ªepochçš„å…ƒæ•°æ®å±æ€§ã€‚åˆ—å¿…é¡»åŒ…å«å­—ç¬¦ä¸²ã€æ•´æ•°æˆ–æµ®ç‚¹æ•°ã€‚</p><h4 id="7ã€Epochsæ•°æ®å¯è§†åŒ–"><a href="#7ã€Epochsæ•°æ®å¯è§†åŒ–" class="headerlink" title="7ã€Epochsæ•°æ®å¯è§†åŒ–"></a>7ã€Epochsæ•°æ®å¯è§†åŒ–</h4><p><code>mne.Epochs.plot()</code>æä¾›äº†ä¸€ä¸ªäº¤äº’å¼æµè§ˆå™¨ï¼Œå½“ä¸å…³é”®å­—<code>block = True</code>ç»“åˆä½¿ç”¨æ—¶ï¼Œå…è®¸æ‰‹åŠ¨æ‹’ç»ã€‚è¿™å°†é˜»æ­¢è„šæœ¬æ‰§è¡Œï¼Œç›´åˆ°å…³é—­æµè§ˆå™¨çª—å£ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">åŠ è½½æ•°æ®ï¼Œå¦‚æœæœ¬åœ°æ— è¯¥æ•°æ®,</span></span><br><span class="line"><span class="string">åˆ™ä»ç½‘ç»œä¸­ä¸‹è½½</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">data_path = op.join(mne.datasets.sample.data_path(), <span class="string">&#x27;MEG&#x27;</span>, <span class="string">&#x27;sample&#x27;</span>)</span><br><span class="line"></span><br><span class="line">raw = mne.io.read_raw_fif(</span><br><span class="line">    op.join(data_path, <span class="string">&#x27;sample_audvis_filt-0-40_raw.fif&#x27;</span>), preload=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># è®¾ç½®event ID</span></span><br><span class="line">event_id = &#123;<span class="string">&#x27;auditory/left&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;auditory/right&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;visual/left&#x27;</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="string">&#x27;visual/right&#x27;</span>: <span class="number">4</span>, <span class="string">&#x27;smiley&#x27;</span>: <span class="number">5</span>, <span class="string">&#x27;button&#x27;</span>: <span class="number">32</span>&#125;</span><br><span class="line">events = mne.find_events(raw)</span><br><span class="line">epochs = mne.Epochs(raw, events, event_id=event_id, tmin=-<span class="number">0.2</span>, tmax=<span class="number">.5</span>,</span><br><span class="line">                    preload=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»˜åˆ¶epochs</span></span><br><span class="line">epochs.plot(block=<span class="literal">True</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/Hbd1728d2d0894d548c1a0ca2da6ed73fr.jpg"></p><p><strong>é¡¶éƒ¨çš„æ•°å­—è¡¨ç¤ºepochçš„äº‹ä»¶idã€‚åº•éƒ¨çš„æ•°å­—æ˜¯å„ä¸ªepochçš„è¿è¡Œç¼–å·ã€‚</strong></p><h3 id="äº”ã€Evokedç»“æ„"><a href="#äº”ã€Evokedç»“æ„" class="headerlink" title="äº”ã€Evokedç»“æ„"></a>äº”ã€Evokedç»“æ„</h3><p><strong>Evoked potential(EP</strong>)è¯±å‘ç”µä½æˆ–è¯±å‘ååº”æ˜¯æŒ‡åœ¨å‡ºç°è¯¸å¦‚é—ªå…‰æˆ–çº¯éŸ³ä¹‹ç±»çš„åˆºæ¿€åï¼Œä»äººç±»æˆ–å…¶ä»–åŠ¨ç‰©çš„ç¥ç»ç³»ç»Ÿï¼Œç‰¹åˆ«æ˜¯å¤§è„‘çš„ç‰¹å®šéƒ¨åˆ†è®°å½•çš„ç‰¹å®šæ¨¡å¼çš„ç”µä½ã€‚ä¸åŒå½¢å¼å’Œç±»å‹çš„åˆºæ¿€ä¼šäº§ç”Ÿä¸åŒç±»å‹çš„ç”µä½ã€‚</p><p>è¯±å‘ç”µä½æŒ¯å¹…å¾€å¾€è¾ƒä½ï¼Œä»å°äº1å¾®ä¼åˆ°æ•°å¾®ä¼ä¸ç­‰ï¼Œè€Œè„‘ç”µå›¾ä¸ºæ•°åå¾®ä¼ï¼Œè‚Œç”µå›¾ä¸ºæ¯«ä¼ï¼Œå¿ƒç”µå›¾é€šå¸¸æ¥è¿‘20æ¯«ä¼ã€‚ä¸ºäº†åœ¨EEGã€ECGã€EMGç­‰ç”Ÿç‰©ä¿¡å·å’Œç¯å¢ƒå™ªå£°çš„èƒŒæ™¯ä¸‹è§£å†³è¿™äº›ä½å¹…åº¦ç”µä½ï¼Œé€šå¸¸éœ€è¦å¯¹ä¿¡å·è¿›è¡Œå¹³å‡ã€‚<strong>ä¿¡å·è¢«æ—¶é—´é”å®šåœ¨åˆºæ¿€ä¸Šï¼Œå¤§éƒ¨åˆ†å™ªå£°æ˜¯éšæœºäº§ç”Ÿçš„ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡å¯¹é‡å¤å“åº”æ¥å¹³å‡æ‰å™ªå£°ã€‚</strong></p><p><strong>è¯±å‘ç”µä½(Evoked)ç»“æ„ä¸»è¦ç”¨äºå­˜å‚¨å®éªŒæœŸé—´çš„å¹³å‡æ•°æ®</strong>ï¼Œåœ¨MNEä¸­ï¼Œåˆ›å»ºEvokedå¯¹è±¡é€šå¸¸ä½¿ç”¨<code>mne.Epochs.average()</code>æ¥å¹³å‡epochsæ•°æ®æ¥å®ç°ã€‚</p>]]></content>
    
    
    <summary type="html">Python-EEGå·¥å…·åº“MNEçš„ä½¿ç”¨</summary>
    
    
    
    <category term="è„‘æœºäº¤äº’" scheme="https://www.buildworld.cn/categories/%E8%84%91%E6%9C%BA%E4%BA%A4%E4%BA%92/"/>
    
    
    <category term="BCI" scheme="https://www.buildworld.cn/tags/BCI/"/>
    
    <category term="Python" scheme="https://www.buildworld.cn/tags/Python/"/>
    
    <category term="MNE" scheme="https://www.buildworld.cn/tags/MNE/"/>
    
  </entry>
  
  <entry>
    <title>BCI--è„‘ç”µåŸºç¡€æ•´ç†</title>
    <link href="https://www.buildworld.cn/2020/06/10/BCI-%E8%84%91%E7%94%B5%E5%9F%BA%E7%A1%80%E6%95%B4%E7%90%86/"/>
    <id>https://www.buildworld.cn/2020/06/10/BCI-%E8%84%91%E7%94%B5%E5%9F%BA%E7%A1%80%E6%95%B4%E7%90%86/</id>
    <published>2020-06-10T12:59:22.000Z</published>
    <updated>2021-07-09T01:38:21.721Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="è„‘ç”µåŸºç¡€æ•´ç†"><a href="#è„‘ç”µåŸºç¡€æ•´ç†" class="headerlink" title="è„‘ç”µåŸºç¡€æ•´ç†"></a>è„‘ç”µåŸºç¡€æ•´ç†</h2><p><strong>è„‘æœºæ¥å£ï¼ˆBCIï¼‰</strong>ï¼Œæ˜¯ä¸€ç§é€šè¿‡æ£€æµ‹ä¸­æ¢ç¥ç»ç³»ç»Ÿæ´»åŠ¨å¹¶å°†å…¶è½¬åŒ–ä¸ºäººå·¥è¾“å‡ºï¼Œæ¥æ›¿ä»£ã€ä¿®å¤ã€å¢å¼ºã€è¡¥å……æˆ–è€…æ”¹å–„ä¸­æ¢ç¥ç»ç³»ç»Ÿçš„æ­£å¸¸è¾“å‡ºï¼Œä»è€Œæ”¹å˜ä¸­æ¢ç¥ç»ç³»ç»Ÿä¸å†…å¤–ç¯å¢ƒä¹‹é—´çš„äº¤äº’ä½œç”¨çš„æŠ€æœ¯ã€‚è„‘æœºæ¥å£æŠ€æœ¯é€šè¿‡ç½®äºå¤´çš®æˆ–é¢…å†…çš„ç”µæç­‰ä¼ æ„Ÿå™¨é‡‡é›†è„‘ç¥ç»æ´»åŠ¨ä¿¡å·ï¼Œç»è¿‡ä¿¡å·å¤„ç†ã€ç‰¹å¾æå–ã€æ¨¡å¼è¯†åˆ«ç­‰è¿‡ç¨‹ï¼Œå¯è·çŸ¥äººçš„æ§åˆ¶æ„å›¾ã€è®¤çŸ¥æˆ–å¿ƒç†çŠ¶æ€ã€ç¥ç»ç³»ç»Ÿç–¾ç—…çŠ¶æ€ç­‰ä¿¡æ¯ï¼Œä¸ºè¿åŠ¨ã€è¯­è¨€ç­‰åŠŸèƒ½æ®‹ç¼ºçš„æ‚£è€…æä¾›æ–°çš„æ§åˆ¶ã€äº¤æµé€šé“æˆ–åº·å¤æ‰‹æ®µï¼Œä¹Ÿå¯ä¸ºå¥åº·äººç¾¤æä¾›æ›´å¤šä¿¡æ¯è¾“å‡ºé€šé“ã€‚éšç€è„‘ç”µä¿¡å·é‡‡é›†æŠ€æœ¯ä¸ä¿¡å·å¤„ç†æŠ€æœ¯çš„å‘å±•æˆç†Ÿï¼Œè„‘æœºæ¥å£æŠ€æœ¯å·²é€æ¸èµ°å…¥ä¸´åºŠåº”ç”¨ï¼Œåœ¨è¯¸å¦‚ä¸­é£ã€æ³¨æ„åŠ›ç¼ºé™·ç­‰è„‘æŸä¼¤æˆ–å…¶ä»–ç¥ç»ç³»ç»Ÿç–¾ç—…æ‚£è€…çš„ä¸´åºŠåº·å¤ä¸­è¡¨ç°å‡ºè‰²ï¼Œä¸ºé«˜ä½æˆªç˜«ã€è‚Œèç¼©æ€§ä¾§ç´¢ç¡¬åŒ–ç—‡ç­‰è¿åŠ¨åŠŸèƒ½éšœç¢æ‚£è€…æä¾›æ–°çš„è¿åŠ¨åŠŸèƒ½æ›¿ä»£æ–¹æ¡ˆï¼Œä¸ºæƒ…ç»ªã€ç–²åŠ³ã€æ„è¯†çŠ¶æ€ç­‰çš„æ£€æµ‹å’Œè¯†åˆ«æä¾›å®¢è§‚æŒ‡æ ‡ã€‚</p><h3 id="ä¸€ã€é‡‡é›†è„‘ç”µä¿¡å·çš„å››ç§æŠ€æœ¯"><a href="#ä¸€ã€é‡‡é›†è„‘ç”µä¿¡å·çš„å››ç§æŠ€æœ¯" class="headerlink" title="ä¸€ã€é‡‡é›†è„‘ç”µä¿¡å·çš„å››ç§æŠ€æœ¯"></a>ä¸€ã€é‡‡é›†è„‘ç”µä¿¡å·çš„å››ç§æŠ€æœ¯</h3><h4 id="1ã€è„‘ç”µå›¾-Electroencephalography-EEG"><a href="#1ã€è„‘ç”µå›¾-Electroencephalography-EEG" class="headerlink" title="1ã€è„‘ç”µå›¾(Electroencephalography,EEG)"></a>1ã€è„‘ç”µå›¾(Electroencephalography,EEG)</h4><p><strong>è„‘ç”µå›¾</strong>é€šè¿‡ç”µæè®°å½•å¤§è„‘çš„ç”µæ´»åŠ¨ï¼Œç”µæé€šå¸¸åµŒå…¥ç”µæå¸½ä¸­ã€‚è¿™ç§ç”µæå¸½é€šå¸¸éœ€è¦ 5 åˆ†é’Ÿæ‰èƒ½å®‰è£…åœ¨ç”¨æˆ·èº«ä¸Šå¹¶è°ƒèŠ‚ç”µæä»¥è·å¾—è‰¯å¥½çš„ä¿¡å·ã€‚è„‘ç”µå›¾ç³»ç»Ÿç›¸å¯¹ä¾¿å®œä¸”ä¾¿æºï¼Œæ˜¯ BCI ç ”ç©¶ä¸­æœ€å¸¸è§çš„ç¥ç»å½±åƒå­¦æ–¹æ³•ã€‚</p><img src="https://ae01.alicdn.com/kf/H9d2bf4ace5bc4372932e4b2647ebfbecI.jpg" style="zoom:120%;" /><h4 id="2ã€çš®å±‚è„‘ç”µå›¾ï¼ˆElectrocorticography-ECoGï¼‰"><a href="#2ã€çš®å±‚è„‘ç”µå›¾ï¼ˆElectrocorticography-ECoGï¼‰" class="headerlink" title="2ã€çš®å±‚è„‘ç”µå›¾ï¼ˆElectrocorticography, ECoGï¼‰"></a>2ã€çš®å±‚è„‘ç”µå›¾ï¼ˆElectrocorticography, ECoGï¼‰</h4><p><strong>çš®å±‚è„‘ç”µå›¾</strong>æ¶‰åŠåˆ°é€šè¿‡å¤–ç§‘æ‰‹æœ¯å°†ç”µææ¤å…¥å¤§è„‘è¡¨é¢æ¥è®°å½•ç”µæ´»åŠ¨ã€‚ç›¸å¯¹äº EEG ä¼ æ„Ÿå™¨ï¼ŒECoG ä¼ æ„Ÿå™¨å…·æœ‰æ›´å¥½çš„ç©ºé—´åˆ†è¾¨ç‡ï¼Œèƒ½å¤Ÿå‡†ç¡®æ£€æµ‹è„‘ç”µå›¾ç”µæä¸å¯è§çš„é«˜é¢‘è„‘æ´»åŠ¨ã€‚ç”µæä¸€æ—¦æ¤å…¥ï¼Œå°±å¯ä»¥å‡†å¤‡ç”¨äº BCI æˆ–å…¶ä»–ä»»åŠ¡ï¼Œè€Œæ— éœ€åœ¨æ¯æ¬¡ä½¿ç”¨å‰è¿›è¡Œå‡†å¤‡ã€‚</p><h4 id="3ã€æ·±åº¦ç”µæ-Depth-electrode"><a href="#3ã€æ·±åº¦ç”µæ-Depth-electrode" class="headerlink" title="3ã€æ·±åº¦ç”µæ(Depth electrode)"></a>3ã€æ·±åº¦ç”µæ(Depth electrode)</h4><p>**æ·±åº¦ç”µæ(Depth electrode)**è®°å½•ä½¿ç”¨é€šè¿‡å¤–ç§‘æ‰‹æœ¯æ¤å…¥å¤§è„‘çš„ç”µæã€‚è¿™ç§æ–¹æ³•å…·æœ‰ç±»ä¼¼äº ECoG çš„å¸å¼•äººçš„ç‰¹æ€§ï¼Œä½†è®°å½•çš„æ˜¯æ¥è‡ªä¸€å°ç¾¤ç¥ç»å…ƒçš„æ´»åŠ¨ã€‚å› æ­¤ï¼Œè¿™ä¸¤ç§æ–¹æ³•æä¾›äº†å¤§è„‘æ´»åŠ¨çš„ä¸åŒå›¾æ™¯ã€‚</p><h4 id="4ã€åŠŸèƒ½ç£å…±æŒ¯æˆåƒ-FunctionalMagnetic-Resonance-Imaging-fMRI"><a href="#4ã€åŠŸèƒ½ç£å…±æŒ¯æˆåƒ-FunctionalMagnetic-Resonance-Imaging-fMRI" class="headerlink" title="4ã€åŠŸèƒ½ç£å…±æŒ¯æˆåƒ(FunctionalMagnetic Resonance Imaging, fMRI)"></a>4ã€åŠŸèƒ½ç£å…±æŒ¯æˆåƒ(FunctionalMagnetic Resonance Imaging, fMRI)</h4><p><strong>åŠŸèƒ½ç£å…±æŒ¯æˆåƒ</strong>ä¸èƒ½æµ‹é‡ç”µæ´»åŠ¨ï¼Œè€Œæ˜¯ç”¨æ¥æµ‹é‡ä¸ä¸åŒç²¾ç¥æ´»åŠ¨ç›¸å…³çš„å¤§è„‘è¡€æµå˜åŒ–ã€‚è€Œè¿™äº›å˜åŒ–ä¸èƒ½åƒä¸Šé¢ä¸‰ç§æ–¹æ³•é‚£æ ·ç”¨æ—¶é—´ç²¾åº¦æ¥æ£€æµ‹ã€‚fMRI ç³»ç»Ÿéœ€è¦éå¸¸å¼ºå¤§çš„ç£åœºï¼Œå› æ­¤è¦èŠ±è´¹æ˜‚è´µä¸”ä¸ä¾¿äºæºå¸¦ã€‚</p><p><img src="https://ae01.alicdn.com/kf/H16206fdcfb4548059e51de516e2b7492W.jpg"></p><h3 id="äºŒã€å¤§è„‘å¸ƒç½—å¾·æ›¼åˆ†åŒºç³»ç»Ÿ"><a href="#äºŒã€å¤§è„‘å¸ƒç½—å¾·æ›¼åˆ†åŒºç³»ç»Ÿ" class="headerlink" title="äºŒã€å¤§è„‘å¸ƒç½—å¾·æ›¼åˆ†åŒºç³»ç»Ÿ"></a>äºŒã€å¤§è„‘å¸ƒç½—å¾·æ›¼åˆ†åŒºç³»ç»Ÿ</h3><blockquote><p>å¸ƒç½—å¾·æ›¼åˆ†åŒºæ˜¯ä¸€ä¸ªæ ¹æ®ç»†èƒç»“æ„å°†å¤§è„‘çš®å±‚åˆ’åˆ†ä¸ºä¸€ç³»åˆ—è§£å‰–åŒºåŸŸçš„ç³»ç»Ÿã€‚ç¥ç»è§£å‰–å­¦ä¸­æ‰€è°“ç»†èƒç»“æ„ï¼ˆCytoarchitectureï¼‰ï¼Œæ˜¯æŒ‡åœ¨æŸ“è‰²çš„è„‘ç»„ç»‡ä¸­è§‚å¯Ÿåˆ°çš„ç¥ç»å…ƒçš„ç»„ç»‡æ–¹å¼ã€‚</p></blockquote><p><strong>å¤§è„‘åŠçƒå¤–ä¾§é¢çš„å¸ƒç½—å¾·æ›¼åˆ†åŒº</strong></p><p><img src="https://ae01.alicdn.com/kf/H80d11821245b474d81ad4e4342ae9fc0v.jpg" alt="å¤§è„‘åŠçƒå¤–ä¾§é¢çš„å¸ƒç½—å¾·æ›¼åˆ†åŒº"></p><p><strong>å¤§è„‘åŠçƒå†…ä¾§é¢çš„å¸ƒç½—å¾·æ›¼åˆ†åŒº</strong></p><p><img src="https://ae01.alicdn.com/kf/H759a4eb6677e40a1aae01258ab7642e89.jpg"></p><ul><li><p>é»„è‰²éƒ¨ä½æ˜¯ <strong>é¢å¶</strong>ï¼Œä¸»è¦åŠŸèƒ½ï¼šæ€ç»´ï¼Œè®¡åˆ’å’Œä¸­å¤®æ‰§è¡ŒèŒèƒ½ï¼›è¿åŠ¨æ‰§è¡Œï¼›</p></li><li><p>ç»¿è‰²éƒ¨ä½æ˜¯ <strong>é¡¶å¶</strong>ï¼Œä¸»è¦åŠŸèƒ½ï¼šä½“æ„ŸçŸ¥è§‰ï¼Œè§†è§‰å’Œä½“ç©ºé—´ä¿¡æ¯çš„æ•´åˆï¼›</p></li><li><p>çº¢è‰²éƒ¨ä½æ˜¯ <strong>é¢å¶</strong>ï¼Œä¸»è¦åŠŸèƒ½ï¼šè¯­è¨€åŠŸèƒ½å’Œå¬è§‰æ„ŸçŸ¥ï¼Œå‚ä¸é•¿æœŸè®°å¿†å’Œæƒ…æ„Ÿï¼›</p></li><li><p>é’è‰²éƒ¨ä½æ˜¯ <strong>æ•å¶</strong>ï¼Œä¸»è¦åŠŸèƒ½ï¼šè§†è§‰æ„ŸçŸ¥å’Œå¤„ç†ã€‚</p></li></ul><h3 id="ä¸‰ã€ç¨³æ€è§†è§‰è¯±å‘ç”µä½-SSVEP"><a href="#ä¸‰ã€ç¨³æ€è§†è§‰è¯±å‘ç”µä½-SSVEP" class="headerlink" title="ä¸‰ã€ç¨³æ€è§†è§‰è¯±å‘ç”µä½ SSVEP"></a>ä¸‰ã€ç¨³æ€è§†è§‰è¯±å‘ç”µä½ SSVEP</h3><p>è¯±å‘ç”µä½ä¸»è¦æœ‰<strong>è§†è§‰è¯±å‘ç”µä½</strong>ã€<strong>å¬è§‰è¯±å‘ç”µä½</strong>ä»¥åŠ<strong>è§¦è§‰è¯±å‘ç”µä½</strong>ä¸‰ç§ã€‚è§†è§‰è¯±å‘ç”µä½ç”±äºç®€å•ã€æ–¹ä¾¿è¢«å¹¿æ³›åº”ç”¨äºè„‘ç”µä¿¡å·çš„ç ”ç©¶ä¸­ã€‚å½“è§†è§‰æ”¶åˆ°å…‰æˆ–è€…å›¾å½¢é—ªçƒç­‰åˆºæ¿€æ—¶ï¼Œè„‘ç”µä¿¡å·çš„ç”µä½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™äº›ç”µä½çš„å˜åŒ–å°±æ˜¯<code>è§†è§‰è¯±å‘ç”µä½(Visual Evoked Potential, VEP)</code>ã€‚</p><h4 id="1ã€è§†è§‰è¯±å‘ç”µä½å¯ä»¥å¤§è‡´åˆ†ä¸ºä¸‰ç±»ï¼š"><a href="#1ã€è§†è§‰è¯±å‘ç”µä½å¯ä»¥å¤§è‡´åˆ†ä¸ºä¸‰ç±»ï¼š" class="headerlink" title="1ã€è§†è§‰è¯±å‘ç”µä½å¯ä»¥å¤§è‡´åˆ†ä¸ºä¸‰ç±»ï¼š"></a>1ã€è§†è§‰è¯±å‘ç”µä½å¯ä»¥å¤§è‡´åˆ†ä¸ºä¸‰ç±»ï¼š</h4><ul><li>ç¬æ—¶è§†è§‰è¯±å‘ç”µä½ï¼ˆTransient Visual EvokedPotentialï¼Œ TVEPï¼‰;</li><li>ç¨³æ€è§†è§‰è¯±å‘ç”µä½ï¼ˆSteady-State Visual EvokedPotential, SSVEPï¼‰;</li><li>ä¼ªéšæœºç è§†è§‰è¯±å‘ç”µä½ã€‚</li></ul><h4 id="2ã€SSVEP-ä¿¡å·åŸç†ä¸åŸºç¡€"><a href="#2ã€SSVEP-ä¿¡å·åŸç†ä¸åŸºç¡€" class="headerlink" title="2ã€SSVEP ä¿¡å·åŸç†ä¸åŸºç¡€"></a>2ã€SSVEP ä¿¡å·åŸç†ä¸åŸºç¡€</h4><p>å…³äº SSVEP ä¿¡å·çš„åŸç†ï¼Œä¸»æµè§‚ç‚¹è®¤ä¸ºå¤§è„‘é‡Œåˆ†å¸ƒçš„å„ç§ç¥ç»ç½‘ç»œéƒ½æœ‰å…¶å›ºæœ‰çš„è°æŒ¯é¢‘ç‡ï¼Œåœ¨æ­£å¸¸çŠ¶æ€ä¸‹ï¼Œè¿™äº›ç¥ç»ç½‘ç»œéƒ½æ˜¯äº’ä¸åŒæ­¥çš„ï¼Œä¹Ÿæ˜¯æ‚ä¹±æ— ç« ï¼Œæ²¡æœ‰è§„å¾‹çš„ï¼Œæ­¤æ—¶çš„è„‘ç”µä¿¡å·æ˜¯è‡ªå‘è„‘ç”µã€‚å½“æ–½åŠ ä¸€ä¸ªæ’å®šé¢‘ç‡çš„å¤–ç•Œè§†è§‰åˆºæ¿€æ—¶ï¼Œä¸åˆºæ¿€é¢‘ç‡æˆ–è°æ³¢é¢‘ç‡ç›¸ä¸€è‡´çš„ç¥ç»ç½‘ç»œå°±ä¼šäº§ç”Ÿè°æŒ¯ï¼Œå¯¼è‡´å¤§è„‘çš„ç”µä½æ´»åŠ¨åœ¨åˆºæ¿€é¢‘ç‡æˆ–è°æ³¢é¢‘ç‡å¤„å‡ºç°æ˜æ˜¾å˜åŒ–ï¼Œç”±æ­¤äº§ç”Ÿ SSVEP ä¿¡å·ã€‚</p><p><strong>åŸºäº SSVEP ä¿¡å·çš„ BCI ç³»ç»Ÿå°±æ˜¯é€šè¿‡æ£€æµ‹æ•å¶è§†è§‰åŒºçš„ EEG ä¿¡å·æ¥åˆ¤æ–­å¤§è„‘çš„æ€ç»´æ´»åŠ¨ã€‚</strong></p><p>å½“äººä½“å—åˆ°ä¸€ä¸ªå›ºå®šé¢‘ç‡çš„é—ªçƒæˆ–è€…å˜æ¢æ¨¡å¼çš„è§†è§‰åˆºæ¿€æ—¶ï¼Œå¤§è„‘çš®å±‚çš„ç”µä½æ´»åŠ¨å°†è¢«è°ƒåˆ¶ï¼Œä»è€Œäº§ç”Ÿä¸€ä¸ªè¿ç»­çš„ä¸”ä¸åˆºæ¿€é¢‘ç‡æœ‰å…³ï¼ˆåˆºæ¿€é¢‘ç‡çš„åŸºé¢‘æˆ–å€é¢‘å¤„ï¼‰çš„å“åº”ï¼Œè¿™ä¸ªå“åº”å…·æœ‰å’Œè§†è§‰åˆºæ¿€ç±»ä¼¼çš„å‘¨æœŸæ€§èŠ‚å¾‹ï¼Œå³ä¸º**ç¨³æ€è§†è§‰è¯±å‘ç”µä½(SSVEP)**ã€‚SSVEP ä¿¡å·è¡¨ç°åœ¨ EEG è„‘ç”µä¿¡å·ä¸­åˆ™æ˜¯åœ¨åŠŸç‡è°±ä¸­èƒ½åœ¨åˆºæ¿€é¢‘ç‡æˆ–è°æ³¢ä¸Šå‡ºç°è°±å³°ã€‚é€šè¿‡åˆ†ææ£€æµ‹è°±å³°å¤„å¯¹åº”çš„é¢‘ç‡ï¼Œå³èƒ½æ£€æµ‹åˆ°å—è¯•è€…è§†è§‰æ³¨è§†çš„åˆºæ¿€æºï¼Œä»è€Œèƒ½è¯†åˆ«å—è¯•è€…çš„æ„å›¾ã€‚</p><p>åœ¨ä½¿ç”¨è§†è§‰åˆºæ¿€è£…ç½®æ¥è·å– SSVEP ä¿¡å·æ—¶ï¼Œåœ¨å¤§è„‘çš®å±‚ä¸­ä¸æ•å¶è§†è§‰åŒºæœ‰å…³çš„è„‘ç”µé€šé“ä¸»è¦æœ‰å…­ä¸ªï¼ˆP03,P0Z,P04,01,0Z,02ï¼‰</p><p><img src="https://ae01.alicdn.com/kf/H44e9c152fad149eb839ca9e2171abf70R.jpg"></p><h4 id="3ã€è·å–-SSVEP-ä¿¡å·è¦æ³¨æ„çš„ç‚¹"><a href="#3ã€è·å–-SSVEP-ä¿¡å·è¦æ³¨æ„çš„ç‚¹" class="headerlink" title="3ã€è·å– SSVEP ä¿¡å·è¦æ³¨æ„çš„ç‚¹"></a>3ã€è·å– SSVEP ä¿¡å·è¦æ³¨æ„çš„ç‚¹</h4><ul><li>ï¼ˆ1ï¼‰èƒ½è¯±å‘ SSVEP å¹…åº¦éšé¢‘ç‡å˜åŒ–çš„å“åº”æ›²çº¿å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªåŒºåŸŸ:<code>ä½é¢‘åŒº(4~15Hz), ä¸­é¢‘åŒº(15~30Hz), é«˜é¢‘åŒº(30~60Hz)</code>ã€‚ä¸ç¨³å®šçš„é¢‘ç‡æ— æ³•è¯±å‘ç¨³å®šçš„ SSVEP ä¿¡å·ï¼Œå°†ä¸¥é‡å½±å“å¯¹ä¿¡å·è¯†åˆ«çš„å‡†ç¡®ç‡ï¼Œå› æ­¤ç¨³å®šçš„åˆºæ¿€é¢‘ç‡æ˜¯å¿…é¡»çš„ã€‚</li><li>ï¼ˆ2ï¼‰ä¸åŒäººçš„ SSVEP ä¿¡å·å¹…å€¼ä¸å°½ç›¸åŒï¼Œå¯¹ç›¸åŒé¢‘ç‡çš„å“åº”æ•æ„Ÿç¨‹åº¦ä¹Ÿå­˜åœ¨å·®å¼‚ï¼ŒåŒæ—¶ï¼Œç”±äºè°æ³¢æˆåˆ†çš„å­˜åœ¨ï¼Œè¦å°½é‡é¿å…ä¸€ä¸ªåˆºæ¿€é¢‘ç‡æ˜¯å¦ä¸€ä¸ªåˆºæ¿€é¢‘ç‡çš„æ•´æ•°å€ï¼Œå¦åˆ™å°†å®¹æ˜“å¼•èµ·è¯†åˆ«é”™è¯¯çš„æƒ…å†µã€‚</li><li>ï¼ˆ3ï¼‰è¯±å‘ SSVEP ä¿¡å·çš„åˆºæ¿€æºè¦å…·æœ‰å‹å¥½æ€§ï¼Œæ»¡è¶³å—è¯•è€…å¯¹äºèˆ’é€‚æ€§çš„è¦æ±‚ï¼Œåˆºæ¿€é¢‘ç‡è¿‡é«˜æˆ–æ˜¯åˆºæ¿€å¼ºåº¦è¿‡å¤§å®¹æ˜“å¯¼è‡´è§†è§‰ç–²åŠ³è€Œå½±å“è§†åŠ›å¥åº·ï¼Œç”šè‡³ä¼šè¯±å‘ç™«ç—«æ ·è„‘ç”µæ´»åŠ¨ã€‚</li></ul><img src="https://ae01.alicdn.com/kf/Ha4554517d6f34265b26a7bcf39756e22R.jpg" style="zoom:120%;" /><h3 id="å››ã€10-20-å›½é™…æ ‡å‡†å¯¼è”ç³»ç»Ÿ"><a href="#å››ã€10-20-å›½é™…æ ‡å‡†å¯¼è”ç³»ç»Ÿ" class="headerlink" title="å››ã€10-20 å›½é™…æ ‡å‡†å¯¼è”ç³»ç»Ÿ"></a>å››ã€10-20 å›½é™…æ ‡å‡†å¯¼è”ç³»ç»Ÿ</h3><h4 id="1ã€ç³»ç»Ÿä»‹ç»"><a href="#1ã€ç³»ç»Ÿä»‹ç»" class="headerlink" title="1ã€ç³»ç»Ÿä»‹ç»"></a>1ã€ç³»ç»Ÿä»‹ç»</h4><p><strong>10-20 ç³»ç»Ÿç”µææ”¾ç½®æ³•</strong>æ˜¯å›½é™…è„‘ç”µå›¾å­¦ä¼šè§„å®šçš„æ ‡å‡†ç”µææ”¾ç½®æ³•ã€‚é¢æä¸­ç‚¹è‡³é¼»æ ¹çš„è·ç¦»å’Œæ•ç‚¹è‡³æ•å¤–ç²—éš†çš„è·ç¦»å„å æ­¤è¿çº¿å…¨é•¿çš„ 10ï¼…ï¼Œå…¶ä½™å„ç‚¹å‡ä»¥æ­¤è¿çº¿å…¨é•¿çš„ 20ï¼…ç›¸éš”ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å› æ­¤å‘½åä¸º 10-20 ç³»ç»Ÿã€‚</p><blockquote><p>å¥‡æ•°è¡¨ç¤ºå¤§è„‘å·¦ä¾§ï¼Œå¶æ•°è¡¨ç¤ºå¤§è„‘å³ä¾§ã€‚å·¦å³ä¾§å„å– 8 ä¸ªç”µæï¼ŒåŠ ä¸Šå‰åä½ä¸Šçš„é¢ä¸­ç‚¹ï¼ˆFzï¼‰ã€ä¸­å¤®ç‚¹ï¼ˆCzï¼‰ã€é¡¶ç‚¹ï¼ˆPzï¼‰ä»¥åŠä¸¤ä¸ªè€³ç”µæå…± 21 ä¸ªç”µæã€‚</p></blockquote><p><img src="https://ae01.alicdn.com/kf/Ha523e4f5264c4f71af3e51d6c022830ch.jpg"></p><p>10-20 ç³»ç»Ÿçš„ç”µæä½ç½®ä¸»è¦ä»¥é¢…éª¨ä¸ºå‚ç…§ï¼Œå¹¶ä¸å› ä¸ªäººå¤´å›´æˆ–å¤´å‹çš„å·®å¼‚è€Œæœ‰æ‰€ä¸åŒã€‚10-20 ç³»ç»Ÿç”µæä½ç½®æè¿°å¦‚ä¸‹ï¼š</p><ul><li><p><strong>å‰åçŸ¢çŠ¶çº¿</strong>ï¼šä»é¼»æ ¹è‡³æ•å¤–ç²—éš†å–ä¸€è¿çº¿ï¼Œåœ¨æ­¤çº¿ä¸Šï¼Œç”±å‰è‡³åæ ‡å‡º 5 ä¸ªç‚¹ï¼Œä¾æ¬¡å‘½åä¸ºï¼šé¢æä¸­ç‚¹ï¼ˆFpzï¼‰ã€é¢ä¸­ç‚¹ï¼ˆFzï¼‰ã€ä¸­å¤®ç‚¹ï¼ˆCzï¼‰ã€é¡¶ç‚¹ï¼ˆPzï¼‰ã€æ•ç‚¹ï¼ˆOzï¼‰ã€‚é¢æä¸­ç‚¹è‡³é¼»æ ¹çš„è·ç¦»å’Œæ•ç‚¹è‡³æ•å¤–ç²—éš†çš„è·ç¦»å„å æ­¤è¿çº¿å…¨é•¿çš„ 10ï¼…ï¼Œå…¶ä½™å„ç‚¹å‡ä»¥æ­¤è¿çº¿å…¨é•¿çš„ 20ï¼…ç›¸éš”ã€‚</p></li><li><p><strong>æ¨ªä½</strong>ï¼šä»å·¦è€³å‰ç‚¹ï¼ˆè€³å±å‰é¢§å¼“æ ¹å‡¹é™·å¤„ï¼‰é€šè¿‡ä¸­å¤®ç‚¹è‡³å³è€³å‰ç‚¹å–ä¸€è¿çº¿ï¼Œåœ¨æ­¤è¿çº¿çš„å·¦å³ä¸¤ä¾§å¯¹ç§°æ ‡å‡ºå·¦é¢ä¸­ï¼ˆT3ï¼‰ã€å³é¢ä¸­ï¼ˆT4ï¼‰ã€å·¦ä¸­å¤®ï¼ˆC3ï¼‰ã€å³ä¸­å¤®ï¼ˆC4ï¼‰ã€‚T3ã€T4 ç‚¹ä¸è€³å‰ç‚¹çš„è·ç¦»å„å æ­¤çº¿å…¨é•¿çš„ 10ï¼…ï¼Œå…¶ä½™å„ç‚¹ï¼ˆåŒ…æ‹¬ Cz ç‚¹ï¼‰å‡ä»¥æ­¤è¿çº¿å…¨é•¿çš„ 20ï¼…ç›¸éš”ã€‚</p></li><li><p><strong>ä¾§ä½</strong>ï¼šä» Fpz ç‚¹å‘åé€šè¿‡ T3ã€T4 ç‚¹è‡³æ•ç‚¹åˆ†åˆ«å–å·¦å³ä¾§è¿çº¿ï¼Œåœ¨å·¦å³ä¾§è¿çº¿ä¸Šç”±å‰è‡³åå¯¹ç§°åœ°æ ‡å‡ºå·¦é¢æï¼ˆFp1 ï¼‰ã€å³é¢æï¼ˆFp2 ï¼‰ã€å·¦å‰é¢ï¼ˆF7ï¼‰ã€å³å‰é¢ï¼ˆF8ï¼‰ã€å·¦åé¢ï¼ˆT5ï¼‰ã€å³åé¢ï¼ˆT6ï¼‰ã€å·¦æ•ï¼ˆO1ï¼‰ã€å³æ•ï¼ˆO2ï¼‰å„ç‚¹ã€‚Fp1 ã€Fp2 ç‚¹è‡³é¢æä¸­ç‚¹ï¼ˆFpz ï¼‰çš„è·ç¦»ä¸ O1ã€O2 ç‚¹è‡³ Oz ç‚¹çš„è·ç¦»å„å æ­¤è¿çº¿å…¨é•¿çš„ 10ï¼…ï¼Œå…¶ä½™å„ç‚¹ï¼ˆåŒ…æ‹¬ T3ã€T4ï¼‰å‡ä»¥æ­¤è¿çº¿å…¨é•¿çš„ 20ï¼…ç›¸éš”ã€‚</p></li><li><p>å…¶ä½™çš„å·¦é¢ï¼ˆF3ï¼‰ã€å³é¢ï¼ˆF4ï¼‰ç‚¹åˆ†åˆ«ä½äº Fp1ã€Fp2 ä¸ C3ã€C4 ç‚¹çš„ä¸­é—´ï¼›å·¦é¡¶ï¼ˆP3ï¼‰ã€å³é¡¶ï¼ˆP4ï¼‰ç‚¹åˆ†åˆ«ä½äº C3ã€C4 ä¸ O1ã€O2 ç‚¹çš„ä¸­é—´ã€‚</p></li></ul><h4 id="2ã€10-20-ç³»ç»Ÿä¸­æ•°å­—ä¸å­—æ¯"><a href="#2ã€10-20-ç³»ç»Ÿä¸­æ•°å­—ä¸å­—æ¯" class="headerlink" title="2ã€10-20 ç³»ç»Ÿä¸­æ•°å­—ä¸å­—æ¯"></a>2ã€10-20 ç³»ç»Ÿä¸­æ•°å­—ä¸å­—æ¯</h4><h5 id="ï¼ˆ1ï¼‰æ•°å­—ä»£è¡¨çš„å«ä¹‰ï¼š"><a href="#ï¼ˆ1ï¼‰æ•°å­—ä»£è¡¨çš„å«ä¹‰ï¼š" class="headerlink" title="ï¼ˆ1ï¼‰æ•°å­—ä»£è¡¨çš„å«ä¹‰ï¼š"></a>ï¼ˆ1ï¼‰æ•°å­—ä»£è¡¨çš„å«ä¹‰ï¼š</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å·¦è„‘å•æ•°ï¼Œå³è„‘åŒæ•°ï¼›</span><br><span class="line"></span><br><span class="line">/ä»£è¡¨ä¸­é—´ï¼Œä¾‹ï¼šC3/T3å°±æ˜¯æŒ‡ä¸¤ç‚¹ä¹‹é—´çš„ä¸­é—´åœ°ç‚¹ï¼›</span><br><span class="line"></span><br><span class="line">-ä»£è¡¨æ¶µç›–ä¸¤ç‚¹æˆ–ç›¸è¿çš„æ‰€æœ‰ç‚¹ï¼Œä¾‹ï¼šC3-T3ä»£è¡¨æ¶µç›–è¿™ä¸¤ç‚¹ï¼›</span><br></pre></td></tr></table></figure><h5 id="ï¼ˆ2ï¼‰å­—æ¯ä»£è¡¨çš„å«ä¹‰ï¼š"><a href="#ï¼ˆ2ï¼‰å­—æ¯ä»£è¡¨çš„å«ä¹‰ï¼š" class="headerlink" title="ï¼ˆ2ï¼‰å­—æ¯ä»£è¡¨çš„å«ä¹‰ï¼š"></a>ï¼ˆ2ï¼‰å­—æ¯ä»£è¡¨çš„å«ä¹‰ï¼š</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">F: é¢å¶(Frontal lobe)</span><br><span class="line"></span><br><span class="line">Fp:å‰é¢å¶ï¼ˆFrontal polesï¼‰</span><br><span class="line"></span><br><span class="line">T: é¢å¶ï¼ˆTemporal lobesï¼‰</span><br><span class="line"></span><br><span class="line">O: æ•å¶ï¼ˆOccipital lobesï¼‰</span><br><span class="line"></span><br><span class="line">P: é¡¶å¶ï¼ˆParietal lobesï¼‰</span><br><span class="line"></span><br><span class="line">C: ä¸­å¿ƒéƒ¨ï¼ˆCentralï¼‰ æˆ–æ„Ÿè§‰è¿åŠ¨çš®å±‚ï¼ˆsensorimotorcortexï¼‰</span><br><span class="line"></span><br><span class="line">Z: é›¶ç‚¹ï¼ˆzeroï¼‰å³å·¦å³è„‘ä¸­å¿ƒ</span><br></pre></td></tr></table></figure><h3 id="äº”ã€è¿åŠ¨æƒ³è±¡ç³»ç»Ÿ"><a href="#äº”ã€è¿åŠ¨æƒ³è±¡ç³»ç»Ÿ" class="headerlink" title="äº”ã€è¿åŠ¨æƒ³è±¡ç³»ç»Ÿ"></a>äº”ã€è¿åŠ¨æƒ³è±¡ç³»ç»Ÿ</h3><h4 id="1ã€ç³»ç»Ÿä»‹ç»-1"><a href="#1ã€ç³»ç»Ÿä»‹ç»-1" class="headerlink" title="1ã€ç³»ç»Ÿä»‹ç»"></a>1ã€ç³»ç»Ÿä»‹ç»</h4><p><strong>è¿åŠ¨æƒ³è±¡ç³»ç»Ÿçš„ç”Ÿç†åŸºç¡€</strong>æ˜¯ï¼šå½“äººåœ¨æƒ³è±¡èº¯ä½“ä¸åŒéƒ¨ä½çš„è¿åŠ¨æ—¶ï¼Œä¼šç›¸åº”çš„æ¿€æ´»å¤§è„‘çš„ä¸åŒåŠŸèƒ½åŒºåŸŸï¼Œä»è€Œäº§ç”Ÿå…·æœ‰ä¸åŒç‰¹æ€§çš„è„‘ç”µä¿¡å·ã€‚è€Œæ‰€è°“çš„ä¸åŒç‰¹æ€§æŒ‡çš„æ˜¯<strong>äº‹ä»¶ç›¸å…³å»åŒæ­¥åŒ–ï¼ˆEvent-related desynchronizationï¼ŒERDï¼‰</strong>å’Œ<strong>äº‹ä»¶ç›¸å…³åŒæ­¥åŒ–ï¼ˆEvent-relatedsynchronizationï¼ŒERSï¼‰</strong>ç°è±¡ã€‚</p><p><strong>å½“äººåœ¨æƒ³è±¡è¿åŠ¨æ—¶ï¼Œå¤§è„‘çš®å±‚ç›¸å…³çš„åŒºåŸŸä¼šå‡ºç°ç‰¹å®šé¢‘ç‡æŒ¯å¹…å‡å°ï¼Œèƒ½é‡ä¸‹é™çš„æƒ…å†µï¼Œè¿™å°±æ˜¯ ERDï¼›è€Œå½“äººåœ¨æƒ³è±¡è¿åŠ¨ç»“æŸæˆ–è€…è¿›å…¥å¤§è„‘é™æ¯çŠ¶æ€æ—¶ï¼Œå¤§è„‘çš®å±‚ç›¸å…³åŒºåŸŸåˆ™ä¼šå‡ºç°æŒ¯å¹…å¢åŠ ï¼Œèƒ½é‡å¢åŠ çš„æƒ…å†µï¼Œè¿™å°±æ˜¯ ERSã€‚</strong></p><p>è€Œ ERD å’Œ ERS åªä¼šåœ¨ EEG çš„ç‰¹å®šé¢‘ç‡èŒƒå›´å†…å‡ºç°ï¼Œæ¯”å¦‚ 8-12Hz çš„<strong>Mu æ³¢</strong>ä»¥åŠ 18-26Hz çš„<strong>Beta æ³¢</strong>ã€‚</p><img src="https://file.buildworld.cn/img/14ec0be1f43b90b03b842e99427ba0c1_640_wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1.webp" style="zoom:150%;" /><p>ä¸Šå›¾è¯¦è§£ï¼šæƒ³è±¡å·¦æ‰‹å³æ‰‹è¿åŠ¨çš„<strong>ERD ç°è±¡</strong>ã€‚å½“æƒ³è±¡å·¦æ‰‹è¿åŠ¨æ—¶ï¼Œå¤§è„‘çš®å±‚å³ä¾§(<strong>C4 ç”µæ</strong>é™„è¿‘) å‡ºç° ERD ç°è±¡ï¼Œç›¸å…³åŒºåŸŸèƒ½é‡å‡å°ï¼›å½“æƒ³è±¡å³æ‰‹è¿åŠ¨æ—¶ï¼Œå¤§è„‘çš®å±‚å·¦ä¾§ï¼ˆ<strong>C3 ç”µæ</strong>é™„è¿‘ï¼‰å‡ºç° ERD ç°è±¡ï¼Œç›¸å…³åŒºåŸŸèƒ½é‡å‡å°ã€‚</p><p><strong>è¿åŠ¨æƒ³è±¡ç³»ç»Ÿæ˜¯æŒ‡å¯¹æƒ³è±¡è¿åŠ¨äº§ç”Ÿçš„ EEG ä¿¡å·è¿›è¡Œè§£ç ï¼Œä»è€Œè·çŸ¥è¢«è¯•çš„è¿åŠ¨æ„å›¾ï¼Œå°†ç›¸åº”çš„æ§åˆ¶å‘½ä»¤ä¼ ç»™å¤–æ¥è®¾å¤‡ï¼Œè¾¾åˆ°äººæœºäº¤äº’çš„ç›®çš„ã€‚</strong></p><h4 id="2ã€è„‘ç”µä¿¡å·çš„èŠ‚å¾‹æ³¢"><a href="#2ã€è„‘ç”µä¿¡å·çš„èŠ‚å¾‹æ³¢" class="headerlink" title="2ã€è„‘ç”µä¿¡å·çš„èŠ‚å¾‹æ³¢"></a>2ã€è„‘ç”µä¿¡å·çš„èŠ‚å¾‹æ³¢</h4><p>ä¸¤ç§åˆ†ç±»æ–¹æ³•ï¼š</p><p><strong>åˆ†ç±»æ–¹æ³•ä¸€</strong>ï¼šä»¥ Schwab é¢‘ç‡æ¥åˆ’åˆ†çš„è¯ï¼Œä¸€èˆ¬åˆ†ä¸ºä¸‰ç±»ï¼š<code>æ…¢æ³¢ã€ä¸­é—´å¿«æ³¢å’Œå¿«æ³¢</code>ã€‚</p><ul><li>1ï¼‰æ…¢æ³¢åŒ…æ‹¬ 0.5-3Hz èŒƒå›´çš„ delta æ³¢ã€4-7Hz çš„ theta æ³¢å’Œ 8-13Hz çš„ alpha æ³¢ï¼›</li><li>2ï¼‰ä¸­é—´å¿«æ³¢ä¸ºé¢‘ç‡åœ¨ 14-17Hz èŒƒå›´çš„æ³¢ï¼›</li><li>3ï¼‰å¿«æ³¢åŒ…æ‹¬ 18-30Hz çš„ beta æ³¢ã€31Hz ä»¥ä¸Šçš„ä¸º gama æ³¢ã€‚</li></ul><p><strong>åˆ†ç±»æ–¹æ³•äºŒ</strong>ï¼šWalter åˆ†ç±»ï¼Œå…±æœ‰ä»¥ä¸‹äº”ç§åˆ†ç±»ï¼š</p><ul><li>a.é¢‘ç‡åœ¨ 0.5-3.5Hz èŒƒå›´å†…ä¸º delta æ³¢ï¼Œ</li><li>b.é¢‘ç‡åœ¨ 4-7Hz èŒƒå›´å†…ä¸º theta æ³¢ï¼Œ</li><li>c.é¢‘ç‡åœ¨ 8-13Hz èŒƒå›´å†…ä¸º alphaï¼Œ</li><li>d.é¢‘ç‡åœ¨ 14-25Hz èŒƒå›´å†…ä¸º beta æ³¢ï¼Œ</li><li>e.é¢‘ç‡åœ¨ 26Hz ä»¥ä¸Šçš„ä¸º gama æ³¢ï¼Œ</li></ul><p><strong>ç‰¹åˆ«è¦æ³¨æ„çš„æ˜¯è¿™é‡Œå¯¹é¢‘ç‡åœ¨ 10Hz å·¦å³çš„æ³¢ç§°ä¸ºèŠ‚å¾‹ã€‚</strong></p><h4 id="3ã€ç‰¹å¾æå–ç®—æ³•"><a href="#3ã€ç‰¹å¾æå–ç®—æ³•" class="headerlink" title="3ã€ç‰¹å¾æå–ç®—æ³•"></a>3ã€ç‰¹å¾æå–ç®—æ³•</h4><p><strong>ï¼ˆ1ï¼‰æ—¶åŸŸæ–¹æ³•</strong>ï¼šè¿™æ˜¯æ¯”è¾ƒæ—©æœŸçš„ EEG ä¿¡å·å¤„ç†æ–¹æ³•ï¼Œä¸»è¦é€šè¿‡æå– EEG çš„æ³¢å½¢ç‰¹å¾ï¼Œæ¯”å¦‚æŒ¯å¹…ã€æ–¹å·®ã€æ³¢å³°ç­‰ï¼Œå¯¹ EEG ä¿¡å·è¿›è¡Œåˆ†æï¼›</p><p><strong>ï¼ˆ2ï¼‰é¢‘åŸŸæ–¹æ³•</strong>ï¼šè¿åŠ¨æƒ³è±¡ EEG ä¿¡å·çš„ ERD å’Œ ERS ç°è±¡åªå‡ºç°åœ¨ç‰¹å®šé¢‘ç‡èŒƒå›´ï¼Œæ¯”å¦‚ 8-12Hz çš„ Mu æ³¢å’Œ 18-26Hz çš„ Beta æ³¢ã€‚å› æ­¤ï¼Œé€šè¿‡åŠŸç‡è°±ç­‰è°±åˆ†ææ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æœ‰æ•ˆåœ°ä» EEG æå–ä¸­ç‰¹å¾ã€‚å…¶ä¸­æ¯”è¾ƒå‡ºåçš„æ–¹æ³•æœ‰è‡ªå›å½’åŠŸç‡è°±åˆ†æã€åŒè°±åˆ†ææ³•ç­‰ï¼›</p><p><strong>ï¼ˆ3ï¼‰ç©ºåŸŸæ–¹æ³•</strong>ï¼šè¿™æ˜¯è¿‘å¹´è¿åŠ¨æƒ³è±¡é¢†åŸŸæ¯”è¾ƒé€šç”¨çš„ç‰¹å¾æå–æ–¹æ³•ï¼Œä¸»è¦é€šè¿‡è®¾è®¡ç©ºåŸŸæ»¤æ³¢å™¨å¯¹ EEG çš„å¤šé€šé“ç©ºé—´åˆ†å¸ƒè¿›è¡Œå¤„ç†ï¼Œæå–å¯åˆ†çš„ç‰¹å¾ã€‚åŒ…æ‹¬ï¼š<code>å…±ç©ºåŸŸæ¨¡å¼æ³•ï¼ˆCommon spatialpatternï¼ŒCSPï¼‰</code>ï¼Œä»¥åŠåŸºäº CSP æ”¹è¿›çš„æ–¹æ³•ã€‚</p><p><strong>åŸºäº CSP æ”¹è¿›çš„æ–¹æ³•åŒ…æ‹¬ï¼š</strong></p><ul><li><p><code>æ—¶ç©ºæ»¤æ³¢çš„å…±ç©ºè°±æ¨¡å¼ï¼ˆCommon spatio-spectralpattern, CSSPï¼‰</code>ï¼›</p></li><li><p><code>å…±ç¨€ç–è°±ç©ºæ¨¡å¼ï¼ˆCommon sparse spectral spatial patternï¼ŒCSSSPï¼‰</code>ï¼›</p></li><li><p><code>æ­£åˆ™åŒ–å…¬ç”¨ç©ºé—´æ¨¡å¼ï¼ˆRegularized Common Spatial Pattern, RCSP)</code>ç­‰ã€‚</p></li></ul><p><strong>ï¼ˆ4ï¼‰å°æ³¢æ¨¡ç³Šç†µçš„ç‰¹å¾æå–æ–¹æ³•</strong>é‰´äºè„‘ç”µä¿¡å·çš„éçº¿æ€§ç‰¹æ€§å’Œè¿åŠ¨æƒ³è±¡æ—¶çš„èŠ‚å¾‹ç‰¹æ€§ï¼Œæå‡ºäº†<strong>å°æ³¢æ¨¡ç³Šç†µçš„ç‰¹å¾æå–æ–¹æ³•</strong>ï¼Œåˆ©ç”¨å°æ³¢å˜æ¢å°† EEG ä¿¡å·è¿›è¡Œå°æ³¢åˆ†è§£ï¼Œå¾—åˆ°å¯¹åº”è¿åŠ¨æƒ³è±¡ EEG ä¿¡å·çš„ alpha å’Œ beta èŠ‚å¾‹ï¼Œç„¶åé‡‡ç”¨æ¨¡ç³Šç†µæ–¹æ³•æå–ç‰¹å¾ã€‚</p><h4 id="4ã€åˆ†ç±»è¯†åˆ«ç®—æ³•"><a href="#4ã€åˆ†ç±»è¯†åˆ«ç®—æ³•" class="headerlink" title="4ã€åˆ†ç±»è¯†åˆ«ç®—æ³•"></a>4ã€åˆ†ç±»è¯†åˆ«ç®—æ³•</h4><p><strong>(1)LDA åˆ†ç±»å™¨</strong></p><p>LDA åˆ†ç±»å™¨(LinearDiscriminant Analysisï¼ŒLDA)æ˜¯ä¸€ç§ç®€å•é«˜æ•ˆçš„çº¿æ€§åˆ†ç±»å™¨ï¼Œå°†æ•°æ®å¾€ä½ç»´åº¦æ–¹å‘æŠ•å½±ï¼Œä½¿å¾—æŠ•å½±åçš„æ•°æ®å…·æœ‰ç±»å†…æ–¹å·®æœ€å°ï¼Œç±»é—´æ–¹å·®æœ€å¤§çš„ç‰¹æ€§ã€‚ä¹Ÿå³æ˜¯æŠ•å½±ååŒä¸€ç±»åˆ«çš„æ•°æ®å°½å¯èƒ½æ¥è¿‘ï¼Œä¸åŒç±»åˆ«çš„æ•°æ®å°½å¯èƒ½åˆ†å¼€ã€‚æœ€ååœ¨æœ€å¯åˆ†çš„æ•°æ®ä¸Šé€šè¿‡ç®€å•çš„é˜ˆå€¼è®¾ç½®è¿›è¡Œåˆ†ç±»ã€‚LDA æ˜¯è¿åŠ¨æƒ³è±¡ç³»ç»Ÿä¸­æœ€å¸¸ç”¨çš„åˆ†ç±»å™¨ï¼Œåœ¨å†å±Šçš„è„‘æœºæ¥å£ç«èµ›ä¸­éƒ½è¢«è®¸å¤šå‚èµ›è€…ä½¿ç”¨ã€‚è¿‘å¹´æ¥ï¼Œç»“åˆè¿åŠ¨æƒ³è±¡çš„ç‰¹ç‚¹ï¼Œè®¸å¤šåŸºäº LDA çš„æ”¹è¿›æ–¹æ³•ä¹Ÿè¢«æå‡ºæ¥ï¼Œæ¯”å¦‚è‡ªé€‚åº” LDAã€è´å¶æ–¯ LDA ç­‰ï¼Œå¹¶ä¸”éƒ½å–å¾—äº†å¾ˆå¥½çš„åˆ†ç±»æ€§èƒ½ã€‚</p><p><strong>(2)SVM åˆ†ç±»å™¨</strong></p><p>æ”¯æŒå‘é‡æœºåˆ†ç±»å™¨(SVM)æ˜¯æœºå™¨å­¦ä¹ é‡Œå…¸å‹çš„åˆ†ç±»å™¨ï¼Œé€šè¿‡æ„å»ºä¸€ä¸ªæœ€ä¼˜çš„åˆ†å‰²è¶…å¹³é¢ï¼Œä»è€Œå°†ä¸¤ç±»æ•°æ®å°½å¯èƒ½çš„åŒºåˆ†å¼€ã€‚SVM åœ¨è¿åŠ¨æƒ³è±¡ç³»ç»Ÿä¸­ä¹Ÿè¢«å¹¿æ³›çš„ä½¿ç”¨ï¼Œé™¤æ­¤ä¹‹å¤–ï¼ŒSVM åœ¨ P300ã€ç¨³æ€è§†è§‰è¯±å‘ç”µä½ï¼ˆSteady state visuallyevoked potentialsï¼ŒSSVEPï¼‰è„‘æœºæ¥å£ç³»ç»Ÿä¸­ä¹Ÿå¹¿æ³›ä½¿ç”¨ã€‚</p><p><strong>(3)è´å¶æ–¯åˆ†ç±»å™¨</strong></p><p>è´å¶æ–¯åˆ†ç±»å™¨æ˜¯åˆ©ç”¨è´å¶æ–¯å…¬å¼è®¡ç®—å‡ºæ ·æœ¬å±äºå„ä¸ªç±»åˆ«çš„åéªŒæ¦‚ç‡ï¼Œç„¶åæœ€å¤§åéªŒæ¦‚ç‡æ‰€å¯¹åº”çš„ç±»åˆ«åˆ™ä¸ºè¯¥æ ·æœ¬çš„ç±»åˆ«ã€‚è´å¶æ–¯åˆ†ç±»å™¨ä¹Ÿå¹¿æ³›çš„ä½¿ç”¨äºè¿åŠ¨æƒ³è±¡ç³»ç»Ÿï¼Œå¯¹ç‰¹å¾è¿›è¡Œåˆ†ç±»ã€‚</p><p><strong>(4)äººå·¥ç¥ç»ç½‘ç»œ</strong></p><p>äººå·¥ç¥ç»ç½‘ç»œæ˜¯åˆ©ç”¨å¤§è„‘ç¥ç»å…ƒç»“æ„å’Œä¿¡æ¯ä¼ é€’æœºç†ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå»ºç«‹å¤§è§„æ¨¡çš„å…·æœ‰è‡ªé€‚åº”èƒ½åŠ›çš„ç½‘ç»œç³»ç»Ÿï¼Œå¹¶ä¸”é€šè¿‡æ‹“æ‰‘ç»“æ„è¿æ¥ï¼ŒæŒ‰ç…§å¤§å‹è§„æ¨¡çš„å¹¶è¡Œæ–¹å¼æ’åˆ—è€Œæˆã€‚äººå·¥ç¥ç»ç½‘ç»œé€‚åˆéçº¿æ€§åˆ†æé—®é¢˜ï¼Œå¹¶ä¸”å…·æœ‰è¾ƒå¼ºçš„å­¦ä¹ å’Œå½’çº³èƒ½åŠ›ï¼Œè‡ªé€‚åº”æ€§å¼ºã€‚äººå·¥ç¥ç»ç½‘ç»œçš„æ¨¡å¼æœ‰å¾ˆå¤šç§ï¼Œç›®å‰å¸¸ç”¨çš„äººå·¥ç¥ç»ç½‘ç»œæœ‰ï¼šæ„ŸçŸ¥å™¨ã€å¤šå±‚æ„ŸçŸ¥å™¨ã€BP ç¥ç»ç½‘ç»œã€RBF ç¥ç»ç½‘ç»œç­‰ã€‚</p><p><strong>(5)èšç±»åˆ†ç±»å™¨</strong></p><p>èšç±»åˆ†ææ˜¯ä¸€ç§å…·æœ‰æ¢ç´¢æ€§è´¨çš„æ¨¡å¼åˆ†ç±»æ–¹æ³•ï¼Œåœ¨åˆ†ç±»æ—¶ä¸ä¾èµ–äºä»»ä½•å…³äºåˆ†ç±»çš„å…ˆéªŒçŸ¥è¯†ï¼Œè€Œæ˜¯é‡‡ç”¨ç›¸ä¼¼åº¦é‡çš„æ–¹æ³•ï¼Œå¯¹å…·æœ‰ç›¸åŒæˆ–ç›¸ä¼¼ç‰¹å¾çš„æ ·æœ¬è¿›è¡Œåˆ†ç±»ã€‚èšç±»åˆ†æåœ¨åˆ†ç±»æ—¶éœ€è¦ç¡®å®šä¸€ç§èšç±»å‡†åˆ™æ¥è¯„ä»·èšç±»æ–¹æ³•çš„å¥½åï¼Œå¸¸ç”¨çš„èšç±»å‡†åˆ™æœ‰<code>è¯¯å·®å¹³æ–¹å’Œ</code>ã€<code>ç±»é—´è·ç¦»å’Œ</code>ã€<code>ç¦»æ•£åº¦</code>ç­‰ã€‚èšç±»æ–¹æ³•æœ‰å¾ˆå¤šç§ï¼Œå¸¸è§çš„æ–¹æ³•æœ‰ï¼š<code>å±‚æ¬¡èšç±»</code>ã€<code>åŠ¨æ€èšç±»æ³•</code>å’Œ<code>å†³ç­–æ ‘èšç±»æ³•</code>ç­‰ã€‚ç”±äºèšç±»ä¸ºçº¿æ€§åˆ†ç±»å™¨ï¼Œ<strong>å®ƒåœ¨è„‘ç”µä¿¡å·åˆ†ç±»ä¸­çš„ç¼ºç‚¹æ˜¯å¯¹è„‘ç”µä¿¡å·çš„ç‰¹å¾è¦æ±‚å¾ˆé«˜ï¼Œéš¾ä»¥å¤„ç†å¤æ‚çš„åˆ†ç±»é—®é¢˜ï¼Œå®¹æ˜“é€ æˆåˆ†è¾¨ç‡ä½ã€‚</strong></p>]]></content>
    
    
    <summary type="html">è„‘æœºæ¥å£ï¼ˆBCIï¼‰ï¼Œæ˜¯ä¸€ç§é€šè¿‡æ£€æµ‹ä¸­æ¢ç¥ç»ç³»ç»Ÿæ´»åŠ¨å¹¶å°†å…¶è½¬åŒ–ä¸ºäººå·¥è¾“å‡ºï¼Œæ¥æ›¿ä»£ã€ä¿®å¤ã€å¢å¼ºã€è¡¥å……æˆ–è€…æ”¹å–„ä¸­æ¢ç¥ç»ç³»ç»Ÿçš„æ­£å¸¸è¾“å‡ºï¼Œä»è€Œæ”¹å˜ä¸­æ¢ç¥ç»ç³»ç»Ÿä¸å†…å¤–ç¯å¢ƒä¹‹é—´çš„äº¤äº’ä½œç”¨çš„æŠ€æœ¯ã€‚</summary>
    
    
    
    <category term="è„‘æœºäº¤äº’" scheme="https://www.buildworld.cn/categories/%E8%84%91%E6%9C%BA%E4%BA%A4%E4%BA%92/"/>
    
    
    <category term="BCI" scheme="https://www.buildworld.cn/tags/BCI/"/>
    
  </entry>
  
  <entry>
    <title>BigData--Hiveæ•°æ®ä»“åº“å·¥å…·</title>
    <link href="https://www.buildworld.cn/2020/06/08/BigData-Hive%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E5%B7%A5%E5%85%B7/"/>
    <id>https://www.buildworld.cn/2020/06/08/BigData-Hive%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E5%B7%A5%E5%85%B7/</id>
    <published>2020-06-08T04:38:51.000Z</published>
    <updated>2020-07-20T08:21:53.510Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Hive"><a href="#Hive" class="headerlink" title="Hive"></a>Hive</h2><h3 id="ä¸€ã€Hiveå…¥é—¨"><a href="#ä¸€ã€Hiveå…¥é—¨" class="headerlink" title="ä¸€ã€Hiveå…¥é—¨"></a>ä¸€ã€Hiveå…¥é—¨</h3><h4 id="1ã€HiveåŠŸèƒ½"><a href="#1ã€HiveåŠŸèƒ½" class="headerlink" title="1ã€HiveåŠŸèƒ½"></a>1ã€HiveåŠŸèƒ½</h4><p><img src="https://file.buildworld.cn/img/20200608124512.png"></p><ul><li>1ï¼‰Hiveå¤„ç†çš„æ•°æ®å­˜å‚¨åœ¨HDFS</li><li>2ï¼‰Hiveåˆ†ææ•°æ®åº•å±‚çš„å®ç°æ˜¯MapReduce</li><li>3ï¼‰æ‰§è¡Œç¨‹åºè¿è¡Œåœ¨Yarnä¸Š</li></ul><h4 id="2ã€Hiveçš„ä¼˜ç¼ºç‚¹"><a href="#2ã€Hiveçš„ä¼˜ç¼ºç‚¹" class="headerlink" title="2ã€Hiveçš„ä¼˜ç¼ºç‚¹"></a>2ã€Hiveçš„ä¼˜ç¼ºç‚¹</h4><h5 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h5><ul><li>ï¼ˆ1) æ“ä½œæ¥å£é‡‡ç”¨ç±»SQLè¯­æ³•ï¼Œæä¾›å¿«é€Ÿå¼€å‘çš„èƒ½åŠ›ï¼ˆç®€å•ã€å®¹æ˜“ä¸Šæ‰‹ï¼‰ã€‚</li><li>ï¼ˆ2) é¿å…äº†å»å†™MapReduceï¼Œå‡å°‘å¼€å‘äººå‘˜çš„å­¦ä¹ æˆæœ¬ã€‚</li><li>ï¼ˆ3) Hiveçš„æ‰§è¡Œå»¶è¿Ÿæ¯”è¾ƒé«˜ï¼Œå› æ­¤Hiveå¸¸ç”¨äºæ•°æ®åˆ†æï¼Œå¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜çš„åœºåˆã€‚</li><li>ï¼ˆ4) Hiveä¼˜åŠ¿åœ¨äºå¤„ç†å¤§æ•°æ®ï¼Œå¯¹äºå¤„ç†å°æ•°æ®æ²¡æœ‰ä¼˜åŠ¿ï¼Œå› ä¸ºHiveçš„æ‰§è¡Œå»¶è¿Ÿæ¯”è¾ƒé«˜ã€‚</li><li>ï¼ˆ5) Hiveæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥å®ç°è‡ªå·±çš„å‡½æ•°ã€‚</li></ul><h5 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><ul><li>ï¼ˆ1ï¼‰è¿­ä»£å¼ç®—æ³•æ— æ³•è¡¨è¾¾</li><li>ï¼ˆ2ï¼‰æ•°æ®æŒ–æ˜æ–¹é¢ä¸æ“…é•¿ï¼Œç”±äºMapReduceæ•°æ®å¤„ç†æµç¨‹çš„é™åˆ¶ï¼Œæ•ˆç‡æ›´é«˜çš„ç®—æ³•å´æ— æ³•å®ç°ã€‚</li><li>ï¼ˆ3ï¼‰Hiveè‡ªåŠ¨ç”Ÿæˆçš„MapReduceä½œä¸šï¼Œé€šå¸¸æƒ…å†µä¸‹ä¸å¤Ÿæ™ºèƒ½åŒ–</li><li>ï¼ˆ4ï¼‰Hiveè°ƒä¼˜æ¯”è¾ƒå›°éš¾ï¼Œç²’åº¦è¾ƒç²—</li></ul><h4 id="3ã€Hiveæ¶æ„"><a href="#3ã€Hiveæ¶æ„" class="headerlink" title="3ã€Hiveæ¶æ„"></a>3ã€Hiveæ¶æ„</h4><p><img src="https://file.buildworld.cn/img/20200613100142.png"></p><ul><li>ï¼ˆ1ï¼‰<strong>è§£æå™¨ï¼ˆSQL Parserï¼‰</strong>ï¼šå°†SQLå­—ç¬¦ä¸²è½¬æ¢æˆæŠ½è±¡è¯­æ³•æ ‘ASTï¼Œè¿™ä¸€æ­¥ä¸€èˆ¬éƒ½ç”¨ç¬¬ä¸‰æ–¹å·¥å…·åº“å®Œæˆï¼Œæ¯”å¦‚antlrï¼›å¯¹ASTè¿›è¡Œè¯­æ³•åˆ†æï¼Œæ¯”å¦‚è¡¨æ˜¯å¦å­˜åœ¨ã€å­—æ®µæ˜¯å¦å­˜åœ¨ã€SQLè¯­ä¹‰æ˜¯å¦æœ‰è¯¯ã€‚</li><li>ï¼ˆ2ï¼‰<strong>ç¼–è¯‘å™¨ï¼ˆPhysical Planï¼‰ï¼š</strong>å°†ASTç¼–è¯‘ç”Ÿæˆé€»è¾‘æ‰§è¡Œè®¡åˆ’ã€‚</li><li>ï¼ˆ3ï¼‰<strong>ä¼˜åŒ–å™¨ï¼ˆQuery Optimizerï¼‰ï¼š</strong>å¯¹é€»è¾‘æ‰§è¡Œè®¡åˆ’è¿›è¡Œä¼˜åŒ–ã€‚</li><li>ï¼ˆ4ï¼‰<strong>æ‰§è¡Œå™¨ï¼ˆExecutionï¼‰ï¼š</strong>æŠŠé€»è¾‘æ‰§è¡Œè®¡åˆ’è½¬æ¢æˆå¯ä»¥è¿è¡Œçš„ç‰©ç†è®¡åˆ’ã€‚å¯¹äºHiveæ¥è¯´ï¼Œå°±æ˜¯MR/Sparkã€‚</li></ul><h4 id="4ã€Hiveçš„è¿è¡Œæœºåˆ¶"><a href="#4ã€Hiveçš„è¿è¡Œæœºåˆ¶" class="headerlink" title="4ã€Hiveçš„è¿è¡Œæœºåˆ¶"></a>4ã€Hiveçš„è¿è¡Œæœºåˆ¶</h4><p><strong>Hiveé€šè¿‡ç»™ç”¨æˆ·æä¾›çš„ä¸€ç³»åˆ—äº¤äº’æ¥å£ï¼Œæ¥æ”¶åˆ°ç”¨æˆ·çš„<code>æŒ‡ä»¤(SQL)</code>ï¼Œä½¿ç”¨è‡ªå·±çš„<code>Driver</code>ï¼Œç»“åˆ<code>å…ƒæ•°æ®(MetaStore)</code>ï¼Œå°†è¿™äº›æŒ‡ä»¤ç¿»è¯‘æˆMapReduceï¼Œæäº¤åˆ°Hadoopä¸­æ‰§è¡Œï¼Œæœ€åï¼Œå°†æ‰§è¡Œè¿”å›çš„ç»“æœè¾“å‡ºåˆ°ç”¨æˆ·äº¤äº’æ¥å£ã€‚</strong></p><p><img src="https://file.buildworld.cn/img/20200613102931.png"></p><h3 id="äºŒã€Hiveæ•°æ®ç±»å‹"><a href="#äºŒã€Hiveæ•°æ®ç±»å‹" class="headerlink" title="äºŒã€Hiveæ•°æ®ç±»å‹"></a>äºŒã€Hiveæ•°æ®ç±»å‹</h3><h4 id="1ã€åŸºæœ¬æ•°æ®ç±»å‹"><a href="#1ã€åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="1ã€åŸºæœ¬æ•°æ®ç±»å‹"></a>1ã€åŸºæœ¬æ•°æ®ç±»å‹</h4><table><thead><tr><th align="center">Hiveæ•°æ®ç±»å‹</th><th align="center">Javaæ•°æ®ç±»å‹</th><th>é•¿åº¦</th><th>ä¾‹å­</th></tr></thead><tbody><tr><td align="center">TINYINT</td><td align="center">byte</td><td>1byteæœ‰ç¬¦å·æ•´æ•°</td><td>20</td></tr><tr><td align="center">SMALINT</td><td align="center">short</td><td>2byteæœ‰ç¬¦å·æ•´æ•°</td><td>20</td></tr><tr><td align="center"><strong>INT</strong></td><td align="center">int</td><td>4byteæœ‰ç¬¦å·æ•´æ•°</td><td>20</td></tr><tr><td align="center"><strong>BIGINT</strong></td><td align="center">long</td><td>8byteæœ‰ç¬¦å·æ•´æ•°</td><td>20</td></tr><tr><td align="center">BOOLEAN</td><td align="center">boolean</td><td>å¸ƒå°”ç±»å‹ï¼Œtrueæˆ–è€…false</td><td>TRUE  FALSE</td></tr><tr><td align="center">FLOAT</td><td align="center">float</td><td>å•ç²¾åº¦æµ®ç‚¹æ•°</td><td>3.14159</td></tr><tr><td align="center"><strong>DOUBLE</strong></td><td align="center">double</td><td>åŒç²¾åº¦æµ®ç‚¹æ•°</td><td>3.14159</td></tr><tr><td align="center"><strong>STRING</strong></td><td align="center">string</td><td>å­—ç¬¦ç³»åˆ—ã€‚å¯ä»¥æŒ‡å®šå­—ç¬¦é›†ã€‚å¯ä»¥ä½¿ç”¨å•å¼•å·æˆ–è€…åŒå¼•å·ã€‚</td><td>â€˜now is the timeâ€™ â€œfor all good menâ€</td></tr><tr><td align="center">TIMESTAMP</td><td align="center"></td><td>æ—¶é—´ç±»å‹</td><td></td></tr><tr><td align="center">BINARY</td><td align="center"></td><td>å­—èŠ‚æ•°ç»„</td><td></td></tr></tbody></table><h4 id="2ã€é›†åˆæ•°æ®ç±»å‹"><a href="#2ã€é›†åˆæ•°æ®ç±»å‹" class="headerlink" title="2ã€é›†åˆæ•°æ®ç±»å‹"></a>2ã€é›†åˆæ•°æ®ç±»å‹</h4><table><thead><tr><th align="center">æ•°æ®ç±»å‹</th><th>æè¿°</th><th align="left">è¯­æ³•ç¤ºä¾‹</th></tr></thead><tbody><tr><td align="center">STRUCT</td><td>å’Œcè¯­è¨€ä¸­çš„structç±»ä¼¼ï¼Œéƒ½å¯ä»¥é€šè¿‡â€œç‚¹â€ç¬¦å·è®¿é—®å…ƒç´ å†…å®¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæŸä¸ªåˆ—çš„æ•°æ®ç±»å‹æ˜¯STRUCT{first STRING, last STRING},é‚£ä¹ˆç¬¬1ä¸ªå…ƒç´ å¯ä»¥é€šè¿‡å­—æ®µ.firstæ¥å¼•ç”¨ã€‚</td><td align="left">struct()ä¾‹å¦‚struct&lt;street:string, city:string&gt;</td></tr><tr><td align="center">MAP</td><td>MAPæ˜¯ä¸€ç»„é”®-å€¼å¯¹å…ƒç»„é›†åˆï¼Œä½¿ç”¨æ•°ç»„è¡¨ç¤ºæ³•å¯ä»¥è®¿é—®æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæŸä¸ªåˆ—çš„æ•°æ®ç±»å‹æ˜¯MAPï¼Œå…¶ä¸­é”®-&gt;å€¼å¯¹æ˜¯â€™firstâ€™-&gt;â€™Johnâ€™å’Œâ€™lastâ€™-&gt;â€™Doeâ€™ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡å­—æ®µå[â€˜lastâ€™]è·å–æœ€åä¸€ä¸ªå…ƒç´ </td><td align="left">map()ä¾‹å¦‚map&lt;string, int&gt;</td></tr><tr><td align="center">ARRAY</td><td>æ•°ç»„æ˜¯ä¸€ç»„å…·æœ‰ç›¸åŒç±»å‹å’Œåç§°çš„å˜é‡çš„é›†åˆã€‚è¿™äº›å˜é‡ç§°ä¸ºæ•°ç»„çš„å…ƒç´ ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ éƒ½æœ‰ä¸€ä¸ªç¼–å·ï¼Œç¼–å·ä»é›¶å¼€å§‹ã€‚ä¾‹å¦‚ï¼Œæ•°ç»„å€¼ä¸º[â€˜Johnâ€™, â€˜Doeâ€™]ï¼Œé‚£ä¹ˆç¬¬2ä¸ªå…ƒç´ å¯ä»¥é€šè¿‡æ•°ç»„å[1]è¿›è¡Œå¼•ç”¨ã€‚</td><td align="left">Array()ä¾‹å¦‚array<string></td></tr></tbody></table><h4 id="3ã€ç±»å‹è½¬åŒ–"><a href="#3ã€ç±»å‹è½¬åŒ–" class="headerlink" title="3ã€ç±»å‹è½¬åŒ–"></a>3ã€ç±»å‹è½¬åŒ–</h4><blockquote><p>Hiveçš„åŸå­æ•°æ®ç±»å‹æ˜¯å¯ä»¥è¿›è¡Œéšå¼è½¬æ¢çš„ï¼Œç±»ä¼¼äºJavaçš„ç±»å‹è½¬æ¢ï¼Œä¾‹å¦‚æŸè¡¨è¾¾å¼ä½¿ç”¨<code>INT</code>ç±»å‹ï¼Œ<code>TINYINT</code>ä¼šè‡ªåŠ¨è½¬æ¢ä¸º<code>INT</code>ç±»å‹ï¼Œä½†æ˜¯Hiveä¸ä¼šè¿›è¡Œåå‘è½¬åŒ–ï¼Œä¾‹å¦‚ï¼ŒæŸè¡¨è¾¾å¼ä½¿ç”¨TINYINTç±»å‹ï¼ŒINTä¸ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºTINYINTç±»å‹ï¼Œå®ƒä¼šè¿”å›é”™è¯¯ï¼Œé™¤éä½¿ç”¨<code>CAST</code>æ“ä½œã€‚</p></blockquote><ul><li>ï¼ˆ1ï¼‰ä»»ä½•æ•´æ•°ç±»å‹éƒ½å¯ä»¥éšå¼åœ°è½¬æ¢ä¸ºä¸€ä¸ªèŒƒå›´æ›´å¹¿çš„ç±»å‹ï¼Œå¦‚TINYINTå¯ä»¥è½¬æ¢æˆINTï¼ŒINTå¯ä»¥è½¬æ¢æˆBIGINTã€‚</li><li>ï¼ˆ2ï¼‰æ‰€æœ‰æ•´æ•°ç±»å‹ã€FLOATå’ŒSTRINGç±»å‹éƒ½å¯ä»¥éšå¼åœ°è½¬æ¢æˆDOUBLEã€‚</li><li>ï¼ˆ3ï¼‰TINYINTã€SMALLINTã€INTéƒ½å¯ä»¥è½¬æ¢ä¸ºFLOATã€‚</li><li>ï¼ˆ4ï¼‰BOOLEANç±»å‹ä¸å¯ä»¥è½¬æ¢ä¸ºä»»ä½•å…¶å®ƒçš„ç±»å‹ã€‚</li></ul><h3 id="ä¸‰ã€DDLæ•°æ®å®šä¹‰"><a href="#ä¸‰ã€DDLæ•°æ®å®šä¹‰" class="headerlink" title="ä¸‰ã€DDLæ•°æ®å®šä¹‰"></a>ä¸‰ã€DDLæ•°æ®å®šä¹‰</h3><p>â€‹    </p><h4 id="1ã€å»ºè¡¨è¯­æ³•"><a href="#1ã€å»ºè¡¨è¯­æ³•" class="headerlink" title="1ã€å»ºè¡¨è¯­æ³•"></a>1ã€å»ºè¡¨è¯­æ³•</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">CREATE [EXTERNAL] TABLE [IF NOT EXISTS] table_name </span><br><span class="line"></span><br><span class="line">[(col_name data_type [COMMENT col_comment], ...)] </span><br><span class="line"></span><br><span class="line">[COMMENT table_comment] </span><br><span class="line"></span><br><span class="line">[PARTITIONED BY (col_name data_type [COMMENT col_comment], ...)] </span><br><span class="line"></span><br><span class="line">[CLUSTERED BY (col_name, col_name, ...) </span><br><span class="line"></span><br><span class="line">[SORTED BY (col_name [ASC|DESC], ...)] INTO num_buckets BUCKETS] </span><br><span class="line"></span><br><span class="line">[ROW FORMAT row_format] </span><br><span class="line"></span><br><span class="line">[STORED AS file_format] </span><br><span class="line"></span><br><span class="line">[LOCATION hdfs_path]</span><br><span class="line"></span><br><span class="line">[TBLPROPERTIES (property_name=property_value, ...)]</span><br><span class="line"></span><br><span class="line">[AS select_statement]</span><br></pre></td></tr></table></figure><ul><li>ï¼ˆ1ï¼‰CREATE TABLE åˆ›å»ºä¸€ä¸ªæŒ‡å®šåå­—çš„è¡¨ã€‚å¦‚æœç›¸åŒåå­—çš„è¡¨å·²ç»å­˜åœ¨ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼›ç”¨æˆ·å¯ä»¥ç”¨ IF NOT EXISTS é€‰é¡¹æ¥å¿½ç•¥è¿™ä¸ªå¼‚å¸¸ã€‚</li><li>ï¼ˆ2ï¼‰EXTERNALå…³é”®å­—å¯ä»¥è®©ç”¨æˆ·åˆ›å»ºä¸€ä¸ªå¤–éƒ¨è¡¨ï¼Œåœ¨å»ºè¡¨çš„åŒæ—¶å¯ä»¥æŒ‡å®šä¸€ä¸ªæŒ‡å‘å®é™…æ•°æ®çš„è·¯å¾„ï¼ˆLOCATIONï¼‰ï¼Œåœ¨åˆ é™¤è¡¨çš„æ—¶å€™ï¼Œå†…éƒ¨è¡¨çš„å…ƒæ•°æ®å’Œæ•°æ®ä¼šè¢«ä¸€èµ·åˆ é™¤ï¼Œè€Œå¤–éƒ¨è¡¨åªåˆ é™¤å…ƒæ•°æ®ï¼Œä¸åˆ é™¤æ•°æ®ã€‚</li><li>ï¼ˆ3ï¼‰COMMENTï¼šä¸ºè¡¨å’Œåˆ—æ·»åŠ æ³¨é‡Šã€‚</li><li>ï¼ˆ4ï¼‰PARTITIONED BYåˆ›å»ºåˆ†åŒºè¡¨</li><li>ï¼ˆ5ï¼‰CLUSTERED BYåˆ›å»ºåˆ†æ¡¶è¡¨</li><li>ï¼ˆ6ï¼‰SORTED BYä¸å¸¸ç”¨ï¼Œå¯¹æ¡¶ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—å¦å¤–æ’åº</li><li>ï¼ˆ7ï¼‰ROW FORMAT </li></ul><p>DELIMITED [FIELDS TERMINATED BY char] [COLLECTION ITEMS TERMINATED BY char]</p><pre><code>[MAP KEYS TERMINATED BY char] [LINES TERMINATED BY char] </code></pre><p>  | SERDE serde_name [WITH SERDEPROPERTIES (property_name=property_value, property_name=property_value, â€¦)]</p><p>ç”¨æˆ·åœ¨å»ºè¡¨çš„æ—¶å€™å¯ä»¥è‡ªå®šä¹‰SerDeæˆ–è€…ä½¿ç”¨è‡ªå¸¦çš„SerDeã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šROW FORMAT æˆ–è€…ROW FORMAT DELIMITEDï¼Œå°†ä¼šä½¿ç”¨è‡ªå¸¦çš„SerDeã€‚åœ¨å»ºè¡¨çš„æ—¶å€™ï¼Œç”¨æˆ·è¿˜éœ€è¦ä¸ºè¡¨æŒ‡å®šåˆ—ï¼Œç”¨æˆ·åœ¨æŒ‡å®šè¡¨çš„åˆ—çš„åŒæ—¶ä¹Ÿä¼šæŒ‡å®šè‡ªå®šä¹‰çš„SerDeï¼ŒHiveé€šè¿‡SerDeç¡®å®šè¡¨çš„å…·ä½“çš„åˆ—çš„æ•°æ®ã€‚</p><p>SerDeæ˜¯Serialize/Deserilizeçš„ç®€ç§°ï¼Œ hiveä½¿ç”¨Serdeè¿›è¡Œè¡Œå¯¹è±¡çš„åºåˆ—ä¸ååºåˆ—åŒ–ã€‚</p><ul><li>ï¼ˆ8ï¼‰STORED ASæŒ‡å®šå­˜å‚¨æ–‡ä»¶ç±»å‹</li></ul><p>å¸¸ç”¨çš„å­˜å‚¨æ–‡ä»¶ç±»å‹ï¼šSEQUENCEFILEï¼ˆäºŒè¿›åˆ¶åºåˆ—æ–‡ä»¶ï¼‰ã€TEXTFILEï¼ˆæ–‡æœ¬ï¼‰ã€RCFILEï¼ˆåˆ—å¼å­˜å‚¨æ ¼å¼æ–‡ä»¶ï¼‰</p><p>å¦‚æœæ–‡ä»¶æ•°æ®æ˜¯çº¯æ–‡æœ¬ï¼Œå¯ä»¥ä½¿ç”¨STORED AS TEXTFILEã€‚å¦‚æœæ•°æ®éœ€è¦å‹ç¼©ï¼Œä½¿ç”¨ STORED AS SEQUENCEFILEã€‚</p><ul><li>ï¼ˆ9ï¼‰LOCATION ï¼šæŒ‡å®šè¡¨åœ¨HDFSä¸Šçš„å­˜å‚¨ä½ç½®ã€‚</li><li>ï¼ˆ10ï¼‰ASï¼šåè·ŸæŸ¥è¯¢è¯­å¥ï¼Œæ ¹æ®æŸ¥è¯¢ç»“æœåˆ›å»ºè¡¨ã€‚</li><li>ï¼ˆ11ï¼‰LIKEå…è®¸ç”¨æˆ·å¤åˆ¶ç°æœ‰çš„è¡¨ç»“æ„ï¼Œä½†æ˜¯ä¸å¤åˆ¶æ•°æ®ã€‚</li></ul><h4 id="2ã€ç®¡ç†è¡¨ä¸å¤–éƒ¨è¡¨çš„äº’ç›¸è½¬æ¢"><a href="#2ã€ç®¡ç†è¡¨ä¸å¤–éƒ¨è¡¨çš„äº’ç›¸è½¬æ¢" class="headerlink" title="2ã€ç®¡ç†è¡¨ä¸å¤–éƒ¨è¡¨çš„äº’ç›¸è½¬æ¢"></a>2ã€ç®¡ç†è¡¨ä¸å¤–éƒ¨è¡¨çš„äº’ç›¸è½¬æ¢</h4><ul><li>ï¼ˆ1ï¼‰æŸ¥è¯¢è¡¨çš„ç±»å‹</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; desc formatted student2;</span><br><span class="line"></span><br><span class="line">Table Type:       MANAGED_TABLE</span><br></pre></td></tr></table></figure><ul><li>ï¼ˆ2ï¼‰ä¿®æ”¹å†…éƒ¨è¡¨student2ä¸ºå¤–éƒ¨è¡¨</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table student2 set tblproperties(&#x27;EXTERNAL&#x27;=&#x27;TRUE&#x27;);</span><br></pre></td></tr></table></figure><ul><li>ï¼ˆ3ï¼‰æŸ¥è¯¢è¡¨çš„ç±»å‹</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; desc formatted student2;</span><br><span class="line"></span><br><span class="line">Table Type:       EXTERNAL_TABLE</span><br></pre></td></tr></table></figure><ul><li>ï¼ˆ4ï¼‰ä¿®æ”¹å¤–éƒ¨è¡¨student2ä¸ºå†…éƒ¨è¡¨</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table student2 set tblproperties(&#x27;EXTERNAL&#x27;=&#x27;FALSE&#x27;);</span><br></pre></td></tr></table></figure><ul><li>ï¼ˆ5ï¼‰æŸ¥è¯¢è¡¨çš„ç±»å‹</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hive (default)&gt; desc formatted student2;</span><br><span class="line"></span><br><span class="line">Table Type:       MANAGED_TABLE</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š(â€˜EXTERNALâ€™=â€™TRUEâ€™)å’Œ(â€˜EXTERNALâ€™=â€™FALSEâ€™)ä¸ºå›ºå®šå†™æ³•ï¼ŒåŒºåˆ†å¤§å°å†™ï¼</strong></p><h3 id="å››ã€DMLæ•°æ®æ“ä½œ"><a href="#å››ã€DMLæ•°æ®æ“ä½œ" class="headerlink" title="å››ã€DMLæ•°æ®æ“ä½œ"></a>å››ã€DMLæ•°æ®æ“ä½œ</h3><h4 id="1ã€æ•°æ®å¯¼å…¥"><a href="#1ã€æ•°æ®å¯¼å…¥" class="headerlink" title="1ã€æ•°æ®å¯¼å…¥"></a>1ã€æ•°æ®å¯¼å…¥</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hive&gt;</span><span class="bash"> load data [<span class="built_in">local</span>] inpath <span class="string">&#x27;/opt/module/datas/student.txt&#x27;</span> [overwrite] into table student [partition (partcol1=val1,â€¦)];</span></span><br></pre></td></tr></table></figure><ul><li>ï¼ˆ1ï¼‰**load data:**è¡¨ç¤ºåŠ è½½æ•°æ®</li><li>ï¼ˆ2ï¼‰**local:**è¡¨ç¤ºä»æœ¬åœ°åŠ è½½æ•°æ®åˆ°hiveè¡¨ï¼›å¦åˆ™ä»HDFSåŠ è½½æ•°æ®åˆ°hiveè¡¨</li><li>ï¼ˆ3ï¼‰**inpath:**è¡¨ç¤ºåŠ è½½æ•°æ®çš„è·¯å¾„</li><li>ï¼ˆ4ï¼‰**overwrite:**è¡¨ç¤ºè¦†ç›–è¡¨ä¸­å·²æœ‰æ•°æ®ï¼Œå¦åˆ™è¡¨ç¤ºè¿½åŠ </li><li>ï¼ˆ5ï¼‰**into table:**è¡¨ç¤ºåŠ è½½åˆ°å“ªå¼ è¡¨</li><li>ï¼ˆ6ï¼‰**student:**è¡¨ç¤ºå…·ä½“çš„è¡¨</li><li>ï¼ˆ7ï¼‰**partition:**è¡¨ç¤ºä¸Šä¼ åˆ°æŒ‡å®šåˆ†åŒº</li></ul><h3 id="äº”ã€æŸ¥è¯¢"><a href="#äº”ã€æŸ¥è¯¢" class="headerlink" title="äº”ã€æŸ¥è¯¢"></a>äº”ã€æŸ¥è¯¢</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[WITH CommonTableExpression (, CommonTableExpression)*]  (Note: Only available</span><br><span class="line"> starting with Hive 0.13.0)</span><br><span class="line">SELECT [ALL | DISTINCT] select_expr, select_expr, ...</span><br><span class="line"> FROM table_reference</span><br><span class="line"> [WHERE where_condition]</span><br><span class="line"> [GROUP BY col_list]</span><br><span class="line"> [ORDER BY col_list]</span><br><span class="line"> [CLUSTER BY col_list</span><br><span class="line">  | [DISTRIBUTE BY col_list] [SORT BY col_list]</span><br><span class="line"> ]</span><br><span class="line"> [LIMIT number]</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Hiveæ˜¯åŸºäºHadoopçš„ä¸€ä¸ªæ•°æ®ä»“åº“å·¥å…·ï¼Œå¯ä»¥å°†ç»“æ„åŒ–çš„æ•°æ®æ–‡ä»¶æ˜ å°„ä¸ºä¸€å¼ è¡¨ï¼Œå¹¶æä¾›ç±»SQLæŸ¥è¯¢åŠŸèƒ½ã€‚</summary>
    
    
    
    <category term="BigData" scheme="https://www.buildworld.cn/categories/BigData/"/>
    
    
    <category term="Hive" scheme="https://www.buildworld.cn/tags/Hive/"/>
    
    <category term="SQL" scheme="https://www.buildworld.cn/tags/SQL/"/>
    
  </entry>
  
  <entry>
    <title>BigData--Zookeeperä»‹ç»å’Œä½¿ç”¨</title>
    <link href="https://www.buildworld.cn/2020/06/07/BigData-Zookeeper%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8/"/>
    <id>https://www.buildworld.cn/2020/06/07/BigData-Zookeeper%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8/</id>
    <published>2020-06-07T10:15:19.000Z</published>
    <updated>2020-09-07T12:37:18.332Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h2><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><h4 id="å¼€å¯Zookeeper"><a href="#å¼€å¯Zookeeper" class="headerlink" title="å¼€å¯Zookeeper"></a>å¼€å¯Zookeeper</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop102 zookeeper-3.4.10]# /opt/module/zookeeper-3.4.10/bin/zkServer.sh start</span><br><span class="line">[root@hadoop103 zookeeper-3.4.10]# /opt/module/zookeeper-3.4.10/bin/zkServer.sh start</span><br><span class="line">[root@hadoop104 zookeeper-3.4.10]# /opt/module/zookeeper-3.4.10/bin/zkServer.sh start</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹çŠ¶æ€"><a href="#æŸ¥çœ‹çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹çŠ¶æ€"></a>æŸ¥çœ‹çŠ¶æ€</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/module/zookeeper-3.4.10/bin/zkServer.sh status</span><br></pre></td></tr></table></figure><h4 id="åœæ­¢Zookeeper"><a href="#åœæ­¢Zookeeper" class="headerlink" title="åœæ­¢Zookeeper"></a>åœæ­¢Zookeeper</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/module/zookeeper-3.4.10/bin/zkServer.sh stop</span><br></pre></td></tr></table></figure><h3 id="1ã€Zookeeperå·¥ä½œæœºåˆ¶"><a href="#1ã€Zookeeperå·¥ä½œæœºåˆ¶" class="headerlink" title="1ã€Zookeeperå·¥ä½œæœºåˆ¶"></a>1ã€Zookeeperå·¥ä½œæœºåˆ¶</h3><p><img src="https://file.buildworld.cn/img/20200606173824.png"></p><h3 id="2ã€Zookeeperç‰¹ç‚¹"><a href="#2ã€Zookeeperç‰¹ç‚¹" class="headerlink" title="2ã€Zookeeperç‰¹ç‚¹"></a>2ã€Zookeeperç‰¹ç‚¹</h3><p><img src="https://file.buildworld.cn/img/20200606174415.png"></p><ul><li>1ï¼‰Zookeeperï¼šä¸€ä¸ªé¢†å¯¼è€…ï¼ˆLeaderï¼‰ï¼Œå¤šä¸ªè·Ÿéšè€…ï¼ˆFollowerï¼‰ç»„æˆçš„é›†ç¾¤ã€‚</li><li><strong>2ï¼‰é›†ç¾¤ä¸­åªè¦æœ‰åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹å­˜æ´»ï¼ŒZookeeperé›†ç¾¤å°±èƒ½æ­£å¸¸æœåŠ¡ã€‚</strong></li><li>3ï¼‰å…¨å±€æ•°æ®ä¸€è‡´ï¼šæ¯ä¸ªServerä¿å­˜ä¸€ä»½ç›¸åŒçš„æ•°æ®å‰¯æœ¬ï¼ŒClientæ— è®ºè¿æ¥åˆ°å“ªä¸ªServerï¼Œæ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ã€‚</li><li>4ï¼‰æ›´æ–°è¯·æ±‚é¡ºåºè¿›è¡Œï¼Œæ¥è‡ªåŒä¸€ä¸ªClientçš„æ›´æ–°è¯·æ±‚æŒ‰å…¶å‘é€é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</li><li>5ï¼‰æ•°æ®æ›´æ–°åŸå­æ€§ï¼Œä¸€æ¬¡æ•°æ®æ›´æ–°è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚</li><li>6ï¼‰å®æ—¶æ€§ï¼Œåœ¨ä¸€å®šæ—¶é—´èŒƒå›´å†…ï¼ŒClientèƒ½è¯»åˆ°æœ€æ–°æ•°æ®ã€‚</li></ul><h3 id="3ã€å®¢æˆ·ç«¯å‘½ä»¤"><a href="#3ã€å®¢æˆ·ç«¯å‘½ä»¤" class="headerlink" title="3ã€å®¢æˆ·ç«¯å‘½ä»¤"></a>3ã€å®¢æˆ·ç«¯å‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤åŸºæœ¬è¯­æ³•</th><th>åŠŸèƒ½æè¿°</th></tr></thead><tbody><tr><td>help</td><td>æ˜¾ç¤ºæ‰€æœ‰æ“ä½œå‘½ä»¤</td></tr><tr><td>ls path [watch]</td><td>ä½¿ç”¨ ls å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰znodeä¸­æ‰€åŒ…å«çš„å†…å®¹</td></tr><tr><td>ls2 path [watch]</td><td>æŸ¥çœ‹å½“å‰èŠ‚ç‚¹æ•°æ®å¹¶èƒ½çœ‹åˆ°æ›´æ–°æ¬¡æ•°ç­‰æ•°æ®</td></tr><tr><td>create</td><td>æ™®é€šåˆ›å»º-s  å«æœ‰åºåˆ—-e  ä¸´æ—¶ï¼ˆé‡å¯æˆ–è€…è¶…æ—¶æ¶ˆå¤±ï¼‰</td></tr><tr><td>get path [watch]</td><td>è·å¾—èŠ‚ç‚¹çš„å€¼</td></tr><tr><td>set</td><td>è®¾ç½®èŠ‚ç‚¹çš„å…·ä½“å€¼</td></tr><tr><td>stat</td><td>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</td></tr><tr><td>delete</td><td>åˆ é™¤èŠ‚ç‚¹</td></tr><tr><td>rmr</td><td>é€’å½’åˆ é™¤èŠ‚ç‚¹</td></tr></tbody></table><h3 id="4ã€Javaç›¸å…³å¼€å‘"><a href="#4ã€Javaç›¸å…³å¼€å‘" class="headerlink" title="4ã€Javaç›¸å…³å¼€å‘"></a>4ã€Javaç›¸å…³å¼€å‘</h3><h4 id="1ï¼‰POMæ–‡ä»¶è®¾ç½®"><a href="#1ï¼‰POMæ–‡ä»¶è®¾ç½®" class="headerlink" title="1ï¼‰POMæ–‡ä»¶è®¾ç½®"></a>1ï¼‰POMæ–‡ä»¶è®¾ç½®</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.zookeeper/zookeeper --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2ï¼‰Javaä»£ç ä½¿ç”¨"><a href="#2ï¼‰Javaä»£ç ä½¿ç”¨" class="headerlink" title="2ï¼‰Javaä»£ç ä½¿ç”¨"></a>2ï¼‰Javaä»£ç ä½¿ç”¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.buildworld.zookeeper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.CreateMode;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.KeeperException;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooDefs;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooKeeper;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.data.Stat;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> MiChong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-06-07 14:13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZkClient</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ZooKeeper zkClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CONNECT_URL = <span class="string">&quot;192.168.162.102:2181,192.168.162.103:2181,192.168.162.104:2181&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SESSION_TIME_OUT = <span class="number">2000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    ** åˆ›å»ºå®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        zkClient = <span class="keyword">new</span> ZooKeeper(CONNECT_URL, SESSION_TIME_OUT, (e) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å‘½ä»¤æ‰§è¡Œå®Œæˆå›è°ƒï¼&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ç›®å½•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> KeeperException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InterruptedException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ls</span><span class="params">()</span> <span class="keyword">throws</span> KeeperException, InterruptedException </span>&#123;</span><br><span class="line">        List&lt;String&gt; children = zkClient.getChildren(<span class="string">&quot;/&quot;</span>, event -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç›®å½•è·å–å®Œæˆï¼&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">for</span> (String path : children) &#123;</span><br><span class="line">            System.out.println(path);</span><br><span class="line">        &#125;</span><br><span class="line">        Thread.sleep(Long.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºç›®å½•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> KeeperException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InterruptedException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">create</span><span class="params">()</span> <span class="keyword">throws</span> KeeperException, InterruptedException </span>&#123;</span><br><span class="line">        String path = zkClient.create(<span class="string">&quot;/Idea&quot;</span>,</span><br><span class="line">                <span class="string">&quot;234567&quot;</span>.getBytes(),</span><br><span class="line">                ZooDefs.Ids.CREATOR_ALL_ACL,</span><br><span class="line">                CreateMode.EPHEMERAL);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ›å»ºçš„è·¯å¾„ï¼š&quot;</span>+path);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–æŒ‡å®šç›®å½•ä¸‹é¢çš„æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> KeeperException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InterruptedException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">get</span><span class="params">()</span> <span class="keyword">throws</span> KeeperException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] data = zkClient.getData(<span class="string">&quot;/test&quot;</span>, <span class="keyword">true</span>, <span class="keyword">new</span> Stat());</span><br><span class="line">        String s = <span class="keyword">new</span> String(data);</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›´æ–°æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> KeeperException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InterruptedException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">()</span> <span class="keyword">throws</span> KeeperException, InterruptedException </span>&#123;</span><br><span class="line">        Stat stat = zkClient.setData(<span class="string">&quot;/test&quot;</span>, <span class="string">&quot;hello world&quot;</span>.getBytes(), <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] data = zkClient.getData(<span class="string">&quot;/test&quot;</span>, <span class="keyword">true</span>, stat);</span><br><span class="line">        String s = <span class="keyword">new</span> String(data);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ›´æ–°ä¹‹åçš„æ•°æ®ï¼š&quot;</span>+s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–èŠ‚ç‚¹çŠ¶æ€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> KeeperException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InterruptedException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stat</span><span class="params">()</span> <span class="keyword">throws</span> KeeperException, InterruptedException </span>&#123;</span><br><span class="line">        Stat exists = zkClient.exists(<span class="string">&quot;/test&quot;</span>, <span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">if</span> (exists == <span class="keyword">null</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;èŠ‚ç‚¹ä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(exists.getDataLength());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> KeeperException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InterruptedException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> <span class="keyword">throws</span> KeeperException, InterruptedException </span>&#123;</span><br><span class="line">        Stat exists = zkClient.exists(<span class="string">&quot;/test&quot;</span>, <span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">if</span> (exists != <span class="keyword">null</span>)&#123;</span><br><span class="line">            zkClient.delete(<span class="string">&quot;/test&quot;</span>,exists.getVersion());</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;èŠ‚ç‚¹ä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€Zookeeperå†…éƒ¨åŸç†"><a href="#5ã€Zookeeperå†…éƒ¨åŸç†" class="headerlink" title="5ã€Zookeeperå†…éƒ¨åŸç†"></a>5ã€Zookeeperå†…éƒ¨åŸç†</h3><h4 id="1ï¼‰èŠ‚ç‚¹ç±»å‹"><a href="#1ï¼‰èŠ‚ç‚¹ç±»å‹" class="headerlink" title="1ï¼‰èŠ‚ç‚¹ç±»å‹"></a>1ï¼‰èŠ‚ç‚¹ç±»å‹</h4><p><img src="https://file.buildworld.cn/img/20200607122957.png"></p><h4 id="2ï¼‰Statç»“æ„ä½“"><a href="#2ï¼‰Statç»“æ„ä½“" class="headerlink" title="2ï¼‰Statç»“æ„ä½“"></a>2ï¼‰Statç»“æ„ä½“</h4><ul><li>1ï¼‰czxid-åˆ›å»ºèŠ‚ç‚¹çš„äº‹åŠ¡zxid</li></ul><p><strong>æ¯æ¬¡ä¿®æ”¹ZooKeeperçŠ¶æ€éƒ½ä¼šæ”¶åˆ°ä¸€ä¸ªzxidå½¢å¼çš„æ—¶é—´æˆ³ï¼Œä¹Ÿå°±æ˜¯ZooKeeperäº‹åŠ¡IDã€‚</strong><br><strong>äº‹åŠ¡IDæ˜¯ZooKeeperä¸­æ‰€æœ‰ä¿®æ”¹æ€»çš„æ¬¡åºã€‚æ¯ä¸ªä¿®æ”¹éƒ½æœ‰å”¯ä¸€çš„zxidï¼Œå¦‚æœzxid1å°äºzxid2ï¼Œé‚£ä¹ˆzxid1åœ¨zxid2ä¹‹å‰å‘ç”Ÿã€‚</strong></p><ul><li>2ï¼‰ctime - znodeè¢«åˆ›å»ºçš„æ¯«ç§’æ•°(ä»1970å¹´å¼€å§‹)</li><li>3ï¼‰mzxid - znodeæœ€åæ›´æ–°çš„äº‹åŠ¡zxid</li><li>4ï¼‰mtime - znodeæœ€åä¿®æ”¹çš„æ¯«ç§’æ•°(ä»1970å¹´å¼€å§‹)</li><li>5ï¼‰pZxid-znodeæœ€åæ›´æ–°çš„å­èŠ‚ç‚¹zxid</li><li>6ï¼‰cversion - znodeå­èŠ‚ç‚¹å˜åŒ–å·ï¼Œznodeå­èŠ‚ç‚¹ä¿®æ”¹æ¬¡æ•°</li><li>7ï¼‰dataversion - znodeæ•°æ®å˜åŒ–å·</li><li>8ï¼‰aclVersion - znodeè®¿é—®æ§åˆ¶åˆ—è¡¨çš„å˜åŒ–å·</li><li>9ï¼‰ephemeralOwner- å¦‚æœæ˜¯ä¸´æ—¶èŠ‚ç‚¹ï¼Œè¿™ä¸ªæ˜¯znodeæ‹¥æœ‰è€…çš„session idã€‚å¦‚æœä¸æ˜¯ä¸´æ—¶èŠ‚ç‚¹åˆ™æ˜¯0ã€‚</li><li>10ï¼‰dataLength- znodeçš„æ•°æ®é•¿åº¦</li><li>11ï¼‰numChildren - znodeå­èŠ‚ç‚¹æ•°é‡</li></ul><h4 id="3ï¼‰ç›‘å¬åŸç†"><a href="#3ï¼‰ç›‘å¬åŸç†" class="headerlink" title="3ï¼‰ç›‘å¬åŸç†"></a>3ï¼‰ç›‘å¬åŸç†</h4><p><img src="https://file.buildworld.cn/img/20200607165333.png"></p><h4 id="4ï¼‰é€‰ä¸¾æœºåˆ¶"><a href="#4ï¼‰é€‰ä¸¾æœºåˆ¶" class="headerlink" title="4ï¼‰é€‰ä¸¾æœºåˆ¶"></a>4ï¼‰é€‰ä¸¾æœºåˆ¶</h4><ul><li>ï¼ˆ1ï¼‰åŠæ•°æœºåˆ¶ï¼šé›†ç¾¤ä¸­åŠæ•°ä»¥ä¸Šæœºå™¨å­˜æ´»ï¼Œé›†ç¾¤å¯ç”¨ã€‚æ‰€ä»¥Zookeeperé€‚åˆå®‰è£…å¥‡æ•°å°æœåŠ¡å™¨ã€‚</li><li>ï¼ˆ2ï¼‰Zookeeperè™½ç„¶åœ¨é…ç½®æ–‡ä»¶ä¸­å¹¶æ²¡æœ‰æŒ‡å®šMasterå’ŒSlaveã€‚ä½†æ˜¯ï¼ŒZookeeperå·¥ä½œæ—¶ï¼Œæ˜¯æœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¸ºLeaderï¼Œå…¶ä»–åˆ™ä¸ºFollowerï¼ŒLeaderæ˜¯é€šè¿‡å†…éƒ¨çš„é€‰ä¸¾æœºåˆ¶ä¸´æ—¶äº§ç”Ÿçš„ã€‚</li><li>ï¼ˆ3ï¼‰ä»¥ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜æ•´ä¸ªé€‰ä¸¾çš„è¿‡ç¨‹ã€‚</li></ul><p><strong>é€‰ä¸¾æµç¨‹</strong></p><p><img src="https://file.buildworld.cn/img/20200607171940.png"></p><p>ï¼ˆ1ï¼‰æœåŠ¡å™¨1å¯åŠ¨ï¼Œå‘èµ·ä¸€æ¬¡é€‰ä¸¾ã€‚æœåŠ¡å™¨1æŠ•è‡ªå·±ä¸€ç¥¨ã€‚æ­¤æ—¶æœåŠ¡å™¨1ç¥¨æ•°ä¸€ç¥¨ï¼Œä¸å¤ŸåŠæ•°ä»¥ä¸Šï¼ˆ3ç¥¨ï¼‰ï¼Œé€‰ä¸¾æ— æ³•å®Œæˆï¼ŒæœåŠ¡å™¨1çŠ¶æ€ä¿æŒä¸ºLOOKINGï¼›</p><p>ï¼ˆ2ï¼‰æœåŠ¡å™¨2å¯åŠ¨ï¼Œå†å‘èµ·ä¸€æ¬¡é€‰ä¸¾ã€‚æœåŠ¡å™¨1å’Œ2åˆ†åˆ«æŠ•è‡ªå·±ä¸€ç¥¨å¹¶äº¤æ¢é€‰ç¥¨ä¿¡æ¯ï¼šæ­¤æ—¶æœåŠ¡å™¨1å‘ç°æœåŠ¡å™¨2çš„IDæ¯”è‡ªå·±ç›®å‰æŠ•ç¥¨æ¨ä¸¾çš„ï¼ˆæœåŠ¡å™¨1ï¼‰å¤§ï¼Œæ›´æ”¹é€‰ç¥¨ä¸ºæ¨ä¸¾æœåŠ¡å™¨2ã€‚æ­¤æ—¶æœåŠ¡å™¨1ç¥¨æ•°0ç¥¨ï¼ŒæœåŠ¡å™¨2ç¥¨æ•°2ç¥¨ï¼Œæ²¡æœ‰åŠæ•°ä»¥ä¸Šç»“æœï¼Œé€‰ä¸¾æ— æ³•å®Œæˆï¼ŒæœåŠ¡å™¨1ï¼Œ2çŠ¶æ€ä¿æŒLOOKING</p><p>ï¼ˆ3ï¼‰æœåŠ¡å™¨3å¯åŠ¨ï¼Œå‘èµ·ä¸€æ¬¡é€‰ä¸¾ã€‚æ­¤æ—¶æœåŠ¡å™¨1å’Œ2éƒ½ä¼šæ›´æ”¹é€‰ç¥¨ä¸ºæœåŠ¡å™¨3ã€‚æ­¤æ¬¡æŠ•ç¥¨ç»“æœï¼šæœåŠ¡å™¨1ä¸º0ç¥¨ï¼ŒæœåŠ¡å™¨2ä¸º0ç¥¨ï¼ŒæœåŠ¡å™¨3ä¸º3ç¥¨ã€‚æ­¤æ—¶æœåŠ¡å™¨3çš„ç¥¨æ•°å·²ç»è¶…è¿‡åŠæ•°ï¼ŒæœåŠ¡å™¨3å½“é€‰Leaderã€‚æœåŠ¡å™¨1ï¼Œ2æ›´æ”¹çŠ¶æ€ä¸ºFOLLOWINGï¼ŒæœåŠ¡å™¨3æ›´æ”¹çŠ¶æ€ä¸ºLEADINGï¼›</p><p>ï¼ˆ4ï¼‰æœåŠ¡å™¨4å¯åŠ¨ï¼Œå‘èµ·ä¸€æ¬¡é€‰ä¸¾ã€‚æ­¤æ—¶æœåŠ¡å™¨1ï¼Œ2ï¼Œ3å·²ç»ä¸æ˜¯LOOKINGçŠ¶æ€ï¼Œä¸ä¼šæ›´æ”¹é€‰ç¥¨ä¿¡æ¯ã€‚äº¤æ¢é€‰ç¥¨ä¿¡æ¯ç»“æœï¼šæœåŠ¡å™¨3ä¸º3ç¥¨ï¼ŒæœåŠ¡å™¨4ä¸º1ç¥¨ã€‚æ­¤æ—¶æœåŠ¡å™¨4æœä»å¤šæ•°ï¼Œæ›´æ”¹é€‰ç¥¨ä¿¡æ¯ä¸ºæœåŠ¡å™¨3ï¼Œå¹¶æ›´æ”¹çŠ¶æ€ä¸ºFOLLOWINGï¼›</p><p>ï¼ˆ5ï¼‰æœåŠ¡å™¨5å¯åŠ¨ï¼ŒåŒ4ä¸€æ ·å½“å°å¼Ÿã€‚</p><h4 id="5ï¼‰å†™æ•°æ®æµç¨‹"><a href="#5ï¼‰å†™æ•°æ®æµç¨‹" class="headerlink" title="5ï¼‰å†™æ•°æ®æµç¨‹"></a>5ï¼‰å†™æ•°æ®æµç¨‹</h4><p><img src="https://file.buildworld.cn/img/20200607172236.png"></p>]]></content>
    
    
    <summary type="html">Apache ZooKeeper is an effort to develop and maintain an open-source server which enables highly reliable distributed coordination.</summary>
    
    
    
    <category term="BigData" scheme="https://www.buildworld.cn/categories/BigData/"/>
    
    
    <category term="Zookeeper" scheme="https://www.buildworld.cn/tags/Zookeeper/"/>
    
  </entry>
  
  <entry>
    <title>BigData--Yarnèµ„æºè°ƒåº¦å™¨</title>
    <link href="https://www.buildworld.cn/2020/06/03/BigData-Yarn%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6%E5%99%A8/"/>
    <id>https://www.buildworld.cn/2020/06/03/BigData-Yarn%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6%E5%99%A8/</id>
    <published>2020-06-03T08:19:03.000Z</published>
    <updated>2020-06-04T02:32:51.139Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Yarnèµ„æºè°ƒåº¦å™¨"><a href="#Yarnèµ„æºè°ƒåº¦å™¨" class="headerlink" title="Yarnèµ„æºè°ƒåº¦å™¨"></a>Yarnèµ„æºè°ƒåº¦å™¨</h2><p><strong>YARNä¸»è¦ç”±<code>ResourceManager</code>ã€<code>NodeManager</code>ã€<code>ApplicationMaster</code>å’Œ<code>Container</code>ç­‰ç»„ä»¶æ„æˆ</strong></p><h3 id="1ã€YARNæ¶æ„"><a href="#1ã€YARNæ¶æ„" class="headerlink" title="1ã€YARNæ¶æ„"></a>1ã€YARNæ¶æ„</h3><p><img src="https://file.buildworld.cn/img/20200603135942.png"></p><h3 id="2ã€YARNå·¥ä½œæœºåˆ¶"><a href="#2ã€YARNå·¥ä½œæœºåˆ¶" class="headerlink" title="2ã€YARNå·¥ä½œæœºåˆ¶"></a>2ã€YARNå·¥ä½œæœºåˆ¶</h3><p><img src="https://file.buildworld.cn/img/image-20200603142713125.png"></p><h4 id="å·¥ä½œæœºåˆ¶è¯¦è§£"><a href="#å·¥ä½œæœºåˆ¶è¯¦è§£" class="headerlink" title="å·¥ä½œæœºåˆ¶è¯¦è§£"></a>å·¥ä½œæœºåˆ¶è¯¦è§£</h4><ul><li><p>â€‹    ï¼ˆ1ï¼‰MRç¨‹åºæäº¤åˆ°å®¢æˆ·ç«¯æ‰€åœ¨çš„èŠ‚ç‚¹ã€‚</p></li><li><p>â€‹    ï¼ˆ2ï¼‰<code>YarnRunner</code>å‘<code>ResourceManager</code>ç”³è¯·ä¸€ä¸ª<code>Application</code>ã€‚</p></li><li><p>â€‹    ï¼ˆ3ï¼‰RMå°†è¯¥åº”ç”¨ç¨‹åºçš„èµ„æºè·¯å¾„è¿”å›ç»™<code>YarnRunner</code>ã€‚</p></li><li><p>â€‹    ï¼ˆ4ï¼‰è¯¥ç¨‹åºå°†è¿è¡Œæ‰€éœ€èµ„æºæäº¤åˆ°HDFSä¸Šã€‚</p></li><li><p>â€‹    ï¼ˆ5ï¼‰ç¨‹åºèµ„æºæäº¤å®Œæ¯•åï¼Œç”³è¯·è¿è¡Œ<code>mrAppMaster</code>ã€‚</p></li><li><p>â€‹    ï¼ˆ6ï¼‰RMå°†ç”¨æˆ·çš„è¯·æ±‚åˆå§‹åŒ–æˆä¸€ä¸ªTaskã€‚</p></li><li><p>â€‹    ï¼ˆ7ï¼‰å…¶ä¸­ä¸€ä¸ª<code>NodeManager</code>é¢†å–åˆ°Taskä»»åŠ¡ã€‚</p></li><li><p>â€‹    ï¼ˆ8ï¼‰è¯¥<code>NodeManager</code>åˆ›å»ºå®¹å™¨<code>Container</code>ï¼Œå¹¶äº§ç”ŸMRAppmasterã€‚</p></li><li><p>â€‹    ï¼ˆ9ï¼‰<code>Container</code>ä»HDFSä¸Šæ‹·è´èµ„æºåˆ°æœ¬åœ°ã€‚</p></li><li><p>â€‹    ï¼ˆ10ï¼‰<code>MRAppmaster</code>å‘RM ç”³è¯·è¿è¡Œ<code>MapTask</code>èµ„æºã€‚</p></li><li><p>â€‹    ï¼ˆ11ï¼‰RMå°†è¿è¡Œ<code>MapTask</code>ä»»åŠ¡åˆ†é…ç»™å¦å¤–ä¸¤ä¸ª<code>NodeManager</code>ï¼Œå¦ä¸¤ä¸ª<code>NodeManager</code>åˆ†åˆ«é¢†å–ä»»åŠ¡å¹¶åˆ›å»ºå®¹å™¨ã€‚</p></li><li><p>â€‹    ï¼ˆ12ï¼‰MRå‘ä¸¤ä¸ªæ¥æ”¶åˆ°ä»»åŠ¡çš„<code>NodeManager</code>å‘é€ç¨‹åºå¯åŠ¨è„šæœ¬ï¼Œè¿™ä¸¤ä¸ª<code>NodeManager</code>åˆ†åˆ«å¯åŠ¨<code>MapTask</code>ï¼Œ<code>MapTask</code>å¯¹æ•°æ®åˆ†åŒºæ’åºã€‚</p></li><li><p>â€‹    ï¼ˆ13ï¼‰<code>MrAppMaster</code>ç­‰å¾…æ‰€æœ‰<code>MapTask</code>è¿è¡Œå®Œæ¯•åï¼Œå‘RMç”³è¯·å®¹å™¨ï¼Œè¿è¡Œ<code>ReduceTask</code>ã€‚</p></li><li><p>â€‹    ï¼ˆ14ï¼‰<code>ReduceTask</code>å‘<code>MapTask</code>è·å–ç›¸åº”åˆ†åŒºçš„æ•°æ®ã€‚</p></li><li><p>â€‹    ï¼ˆ15ï¼‰ç¨‹åºè¿è¡Œå®Œæ¯•åï¼Œ<code>MR</code>ä¼šå‘<code>RM</code>ç”³è¯·æ³¨é”€è‡ªå·±ã€‚</p></li></ul><h3 id="3ã€ä½œä¸šæäº¤"><a href="#3ã€ä½œä¸šæäº¤" class="headerlink" title="3ã€ä½œä¸šæäº¤"></a>3ã€ä½œä¸šæäº¤</h3><h4 id="1ï¼‰ä½œä¸šæäº¤è¿‡ç¨‹ä¹‹YARN"><a href="#1ï¼‰ä½œä¸šæäº¤è¿‡ç¨‹ä¹‹YARN" class="headerlink" title="1ï¼‰ä½œä¸šæäº¤è¿‡ç¨‹ä¹‹YARN"></a>1ï¼‰ä½œä¸šæäº¤è¿‡ç¨‹ä¹‹YARN</h4><p><img src="https://file.buildworld.cn/img/image-20200603142713125.png"></p><p><strong>æäº¤ä½œä¸šè¯¦è§£</strong></p><h5 id="ï¼ˆ1ï¼‰ä½œä¸šæäº¤"><a href="#ï¼ˆ1ï¼‰ä½œä¸šæäº¤" class="headerlink" title="ï¼ˆ1ï¼‰ä½œä¸šæäº¤"></a>ï¼ˆ1ï¼‰ä½œä¸šæäº¤</h5><ul><li>ç¬¬1æ­¥ï¼šClientè°ƒç”¨<code>job.waitForCompletion</code>æ–¹æ³•ï¼Œå‘æ•´ä¸ªé›†ç¾¤æäº¤MapReduceä½œä¸šã€‚</li><li>ç¬¬2æ­¥ï¼šClientå‘RMç”³è¯·ä¸€ä¸ªä½œä¸šidã€‚</li><li>ç¬¬3æ­¥ï¼šRMç»™Clientè¿”å›è¯¥jobèµ„æºçš„æäº¤è·¯å¾„å’Œä½œä¸šidã€‚</li><li>ç¬¬4æ­¥ï¼šClientæäº¤jaråŒ…ã€åˆ‡ç‰‡ä¿¡æ¯å’Œé…ç½®æ–‡ä»¶åˆ°æŒ‡å®šçš„èµ„æºæäº¤è·¯å¾„ã€‚</li><li>ç¬¬5æ­¥ï¼šClientæäº¤å®Œèµ„æºåï¼Œå‘RMç”³è¯·è¿è¡Œ<code>MrAppMaster</code>ã€‚</li></ul><h5 id="ï¼ˆ2ï¼‰ä½œä¸šåˆå§‹åŒ–"><a href="#ï¼ˆ2ï¼‰ä½œä¸šåˆå§‹åŒ–" class="headerlink" title="ï¼ˆ2ï¼‰ä½œä¸šåˆå§‹åŒ–"></a>ï¼ˆ2ï¼‰ä½œä¸šåˆå§‹åŒ–</h5><ul><li>ç¬¬6æ­¥ï¼šå½“RMæ”¶åˆ°Clientçš„è¯·æ±‚åï¼Œå°†è¯¥jobæ·»åŠ åˆ°å®¹é‡è°ƒåº¦å™¨ä¸­ã€‚</li><li>ç¬¬7æ­¥ï¼šæŸä¸€ä¸ªç©ºé—²çš„NMé¢†å–åˆ°è¯¥Jobã€‚</li><li>ç¬¬8æ­¥ï¼šè¯¥NMåˆ›å»º<code>Container</code>ï¼Œå¹¶äº§ç”Ÿ<code>MRAppmaster</code>ã€‚</li><li>ç¬¬9æ­¥ï¼šä¸‹è½½Clientæäº¤çš„èµ„æºåˆ°æœ¬åœ°ã€‚</li></ul><h5 id="ï¼ˆ3ï¼‰ä»»åŠ¡åˆ†é…"><a href="#ï¼ˆ3ï¼‰ä»»åŠ¡åˆ†é…" class="headerlink" title="ï¼ˆ3ï¼‰ä»»åŠ¡åˆ†é…"></a>ï¼ˆ3ï¼‰ä»»åŠ¡åˆ†é…</h5><ul><li>ç¬¬10æ­¥ï¼š<code>MrAppMaster</code>å‘RMç”³è¯·è¿è¡Œå¤šä¸ªMapTaskä»»åŠ¡èµ„æºã€‚</li><li>ç¬¬11æ­¥ï¼šRMå°†è¿è¡Œ<code>MapTask</code>ä»»åŠ¡åˆ†é…ç»™å¦å¤–ä¸¤ä¸ª<code>NodeManager</code>ï¼Œå¦ä¸¤ä¸ª<code>NodeManager</code>åˆ†åˆ«é¢†å–ä»»åŠ¡å¹¶åˆ›å»ºå®¹å™¨ã€‚</li></ul><h5 id="ï¼ˆ4ï¼‰ä»»åŠ¡è¿è¡Œ"><a href="#ï¼ˆ4ï¼‰ä»»åŠ¡è¿è¡Œ" class="headerlink" title="ï¼ˆ4ï¼‰ä»»åŠ¡è¿è¡Œ"></a>ï¼ˆ4ï¼‰ä»»åŠ¡è¿è¡Œ</h5><ul><li>ç¬¬12æ­¥ï¼šMRå‘ä¸¤ä¸ªæ¥æ”¶åˆ°ä»»åŠ¡çš„<code>NodeManager</code>å‘é€ç¨‹åºå¯åŠ¨è„šæœ¬ï¼Œè¿™ä¸¤ä¸ª<code>NodeManager</code>åˆ†åˆ«å¯åŠ¨<code>MapTask</code>ï¼Œ<code>MapTask</code>å¯¹æ•°æ®åˆ†åŒºæ’åºã€‚</li><li>ç¬¬13æ­¥ï¼š<code>MrAppMaster</code>ç­‰å¾…æ‰€æœ‰<code>MapTask</code>è¿è¡Œå®Œæ¯•åï¼Œå‘RMç”³è¯·å®¹å™¨ï¼Œè¿è¡Œ<code>ReduceTask</code>ã€‚</li><li>ç¬¬14æ­¥ï¼š<code>ReduceTask</code>å‘<code>MapTask</code>è·å–ç›¸åº”åˆ†åŒºçš„æ•°æ®ã€‚</li><li>ç¬¬15æ­¥ï¼šç¨‹åºè¿è¡Œå®Œæ¯•åï¼ŒMRä¼šå‘RMç”³è¯·æ³¨é”€è‡ªå·±ã€‚</li></ul><h5 id="ï¼ˆ5ï¼‰è¿›åº¦å’ŒçŠ¶æ€æ›´æ–°"><a href="#ï¼ˆ5ï¼‰è¿›åº¦å’ŒçŠ¶æ€æ›´æ–°" class="headerlink" title="ï¼ˆ5ï¼‰è¿›åº¦å’ŒçŠ¶æ€æ›´æ–°"></a>ï¼ˆ5ï¼‰è¿›åº¦å’ŒçŠ¶æ€æ›´æ–°</h5><p>YARNä¸­çš„ä»»åŠ¡å°†å…¶è¿›åº¦å’ŒçŠ¶æ€(åŒ…æ‹¬counter)è¿”å›ç»™åº”ç”¨ç®¡ç†å™¨, å®¢æˆ·ç«¯æ¯ç§’(é€šè¿‡<code>mapreduce.client.progressmonitor.pollinterval</code>è®¾ç½®)å‘åº”ç”¨ç®¡ç†å™¨è¯·æ±‚è¿›åº¦æ›´æ–°, å±•ç¤ºç»™ç”¨æˆ·ã€‚</p><h5 id="ï¼ˆ6ï¼‰ä½œä¸šå®Œæˆ"><a href="#ï¼ˆ6ï¼‰ä½œä¸šå®Œæˆ" class="headerlink" title="ï¼ˆ6ï¼‰ä½œä¸šå®Œæˆ"></a>ï¼ˆ6ï¼‰ä½œä¸šå®Œæˆ</h5><p>é™¤äº†å‘åº”ç”¨ç®¡ç†å™¨è¯·æ±‚ä½œä¸šè¿›åº¦å¤–, å®¢æˆ·ç«¯æ¯5ç§’éƒ½ä¼šé€šè¿‡è°ƒç”¨<code>waitForCompletion()</code>æ¥æ£€æŸ¥ä½œä¸šæ˜¯å¦å®Œæˆã€‚æ—¶é—´é—´éš”å¯ä»¥é€šè¿‡<code>mapreduce.client.completion.pollinterva</code>læ¥è®¾ç½®ã€‚ä½œä¸šå®Œæˆä¹‹å, åº”ç”¨ç®¡ç†å™¨å’ŒContainerä¼šæ¸…ç†å·¥ä½œçŠ¶æ€ã€‚ä½œä¸šçš„ä¿¡æ¯ä¼šè¢«ä½œä¸šå†å²æœåŠ¡å™¨å­˜å‚¨ä»¥å¤‡ä¹‹åç”¨æˆ·æ ¸æŸ¥ã€‚</p><h4 id="2ï¼‰ä½œä¸šæäº¤è¿‡ç¨‹ä¹‹MapReduce"><a href="#2ï¼‰ä½œä¸šæäº¤è¿‡ç¨‹ä¹‹MapReduce" class="headerlink" title="2ï¼‰ä½œä¸šæäº¤è¿‡ç¨‹ä¹‹MapReduce"></a>2ï¼‰ä½œä¸šæäº¤è¿‡ç¨‹ä¹‹MapReduce</h4><p><img src="https://file.buildworld.cn/img/20200603145736.png"></p><h3 id="4ã€èµ„æºè°ƒåº¦å™¨"><a href="#4ã€èµ„æºè°ƒåº¦å™¨" class="headerlink" title="4ã€èµ„æºè°ƒåº¦å™¨"></a>4ã€èµ„æºè°ƒåº¦å™¨</h3><p><strong>Hadoopä½œä¸šè°ƒåº¦å™¨ä¸»è¦æœ‰ä¸‰ç§ï¼š<code>FIFO</code>ã€<code>Capacity Scheduler</code>å’Œ<code>Fair Scheduler</code>ã€‚</strong></p><h4 id="1ï¼‰å…ˆè¿›å…ˆå‡ºè°ƒåº¦å™¨ï¼ˆFIFOï¼‰"><a href="#1ï¼‰å…ˆè¿›å…ˆå‡ºè°ƒåº¦å™¨ï¼ˆFIFOï¼‰" class="headerlink" title="1ï¼‰å…ˆè¿›å…ˆå‡ºè°ƒåº¦å™¨ï¼ˆFIFOï¼‰"></a>1ï¼‰å…ˆè¿›å…ˆå‡ºè°ƒåº¦å™¨ï¼ˆFIFOï¼‰</h4><p><img src="https://file.buildworld.cn/img/20200603152207.png"></p><h4 id="2ï¼‰å®¹é‡è°ƒåº¦å™¨ï¼ˆCapacity-Schedulerï¼‰"><a href="#2ï¼‰å®¹é‡è°ƒåº¦å™¨ï¼ˆCapacity-Schedulerï¼‰" class="headerlink" title="2ï¼‰å®¹é‡è°ƒåº¦å™¨ï¼ˆCapacity Schedulerï¼‰"></a>2ï¼‰å®¹é‡è°ƒåº¦å™¨ï¼ˆCapacity Schedulerï¼‰</h4><p><img src="https://file.buildworld.cn/img/20200603153023.png"></p><ul><li>1ã€æ”¯æŒå¤šä¸ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—å¯é…ç½®ä¸€å®šçš„èµ„æºé‡ï¼Œæ¯ä¸ªé˜Ÿåˆ—é‡‡ç”¨FIFOè°ƒåº¦ç­–ç•¥ã€‚</li><li>2ã€ä¸ºäº†é˜²æ­¢åŒä¸€ä¸ªç”¨æˆ·çš„ä½œä¸šç‹¬å é˜Ÿåˆ—ä¸­çš„èµ„æºï¼Œè¯¥è°ƒåº¦å™¨ä¼šå¯¹åŒä¸€ç”¨æˆ·æäº¤çš„ä½œä¸šæ‰€å èµ„æºé‡è¿›è¡Œé™å®šã€‚</li><li>3ã€é¦–å…ˆï¼Œè®¡ç®—æ¯ä¸ªé˜Ÿåˆ—ä¸­æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡æ•°ä¸å…¶åº”è¯¥åˆ†å¾—çš„è®¡ç®—èµ„æºä¹‹é—´çš„æ¯”å€¼ï¼Œé€‰æ‹©ä¸€ä¸ªè¯¥æ¯”å€¼æœ€å°çš„é˜Ÿåˆ—â€”â€”æœ€é—²çš„ã€‚</li><li>4ã€å…¶æ¬¡ï¼ŒæŒ‰ç…§ä½œä¸šä¼˜å…ˆçº§å’Œæäº¤æ—¶é—´é¡ºåºï¼ŒåŒæ—¶è€ƒè™‘ç”¨æˆ·èµ„æºé‡é™åˆ¶å’Œå†…å­˜é™åˆ¶å¯¹é˜Ÿåˆ—å†…ä»»åŠ¡æ’åºã€‚</li><li>5ã€ä¸‰ä¸ªé˜Ÿåˆ—åŒæ—¶æŒ‰ç…§ä»»åŠ¡çš„å…ˆåé¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œæ¯”å¦‚ï¼Œjob11ã€job21å’Œjob31åˆ†åˆ«æ’åœ¨é˜Ÿåˆ—æœ€å‰é¢ï¼Œå…ˆè¿è¡Œï¼Œä¹Ÿæ˜¯å¹¶è¡Œè¿è¡Œã€‚</li></ul><h4 id="3ï¼‰å…¬å¹³è°ƒåº¦å™¨ï¼ˆFair-Schedulerï¼‰"><a href="#3ï¼‰å…¬å¹³è°ƒåº¦å™¨ï¼ˆFair-Schedulerï¼‰" class="headerlink" title="3ï¼‰å…¬å¹³è°ƒåº¦å™¨ï¼ˆFair Schedulerï¼‰"></a>3ï¼‰å…¬å¹³è°ƒåº¦å™¨ï¼ˆFair Schedulerï¼‰</h4><p><img src="https://file.buildworld.cn/img/20200603154212.png"></p><p><strong>æ”¯æŒå¤šé˜Ÿåˆ—å¤šç”¨æˆ·ï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¸­çš„èµ„æºé‡å¯ä»¥é…ç½®ï¼ŒåŒä¸€é˜Ÿåˆ—ä¸­çš„ä½œä¸šå…¬å¹³å…±äº«é˜Ÿåˆ—ä¸­æ‰€æœ‰èµ„æºã€‚</strong></p><p><strong>åœ¨åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œjobçš„èµ„æºç¼ºé¢è¶Šå¤§ï¼Œè¶Šå…ˆè·å¾—èµ„æºä¼˜å…ˆæ‰§è¡Œã€‚ä½œä¸šæ˜¯æŒ‰ç…§ç¼ºé¢çš„é«˜ä½æ¥å…ˆåæ‰§è¡Œçš„ï¼Œè€Œä¸”å¯ä»¥çœ‹åˆ°ä¸Šå›¾æœ‰å¤šä¸ªä½œä¸šåŒæ—¶è¿è¡Œã€‚</strong></p>]]></content>
    
    
    <summary type="html">ç‹—å­ä»Šå¤©é€€å½¹äº†ğŸ’”</summary>
    
    
    
    <category term="BigData" scheme="https://www.buildworld.cn/categories/BigData/"/>
    
    
    <category term="Hadoop" scheme="https://www.buildworld.cn/tags/Hadoop/"/>
    
    <category term="Yarn" scheme="https://www.buildworld.cn/tags/Yarn/"/>
    
  </entry>
  
</feed>
